<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1764452120">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li>
<li class="toc-item"><a class="toc-link" href="#Table10">Table 10</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0095_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by File" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Current Status" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Current Status</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Action" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Action</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-content"><code>script.table.js</code></div></div></td><td data-label="Current Status"> ‚úÖ Patched or ready for <code>__ptt_disable_convert_captions</code> guard   </td><td data-label="Action"> Keep as is                </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-content"><code>script.list.js</code></div></div></td><td data-label="Current Status"> ‚úÖ Already sets <code>__ptt_disable_convert_captions</code> (or equivalent) </td><td data-label="Action"> Minimal additions only    </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-heading"><strong><code>script.toc.js</code></strong></div></div></td><td data-label="Current Status"> ‚ö†Ô∏è Still rebuilding TOC even when others already did            </td><td data-label="Action"> <strong>Revise this file next</strong> </td></tr></tbody></table></div><div class="row-count">Rows: 3</div></div><div class="table-caption" id="Table2" data-table="Docu_0095_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Aspect**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Aspect</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Details**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Scope</strong></div></div></td><td data-label="Details"> Final, production-safe revision across <code>script.table.js</code>, <code>script.list.js</code>, and <code>script.toc.js</code>.                                                                                                                                                 </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Key Objectives</strong></div></div></td><td data-label="Details"> ‚úÖ Keep TOC links visible.<br/>‚úÖ Prevent double captions.<br/>‚úÖ Ensure compatibility with both <code>script.table.js</code> and <code>script.list.js</code>.<br/>‚úÖ Maintain stability under DOM mutations.                                                                 </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Problem Identified</strong></div></div></td><td data-label="Details"> <code>script.toc.js</code> rebuilds TOC headings even when other scripts already insert caption-like structures (via <code>.table-heading</code> or <code>.table-caption</code>).                                                                                                 </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Solution Overview</strong></div></div></td><td data-label="Details"> Introduce one smart conditional layer.                                                                                                                                                                                                           </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Resolution Logic</strong></div></div></td><td data-label="Details"> ‚Ä¢ When any caption builder is active ‚Üí TOC skips creating new captions but continues generating TOC links.<br/>‚Ä¢ When TOC detects existing captions or table headings ‚Üí it reuses them for link generation only, avoiding new caption injections. </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Outcome</strong></div></div></td><td data-label="Details"> Ensures all TOC links function properly without creating duplicate or conflicting DOM nodes.                                                                                                                                                     </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table3" data-table="Docu_0095_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Wrap-up / Next Step**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Wrap-up / Next Step</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Action / Description**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Action / Description</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Wrap-up / Next Step"><div class="tv-left-col"><div class="left-col-heading"><strong>1Ô∏è‚É£ Add server marker</strong></div></div></td><td data-label="Action / Description"> Insert <code>data-ptt-server-captions="1"</code> in the renderer for both template and Python cases ‚Äî this is the most robust and future-proof fix.        </td></tr><tr><td data-label="Wrap-up / Next Step"><div class="tv-left-col"><div class="left-col-heading"><strong>2Ô∏è‚É£ Replace script.toc.js</strong></div></div></td><td data-label="Action / Description"> Use the <strong>final version</strong> of <code>script.toc.js</code> (as shared earlier).                                                                               </td></tr><tr><td data-label="Wrap-up / Next Step"><div class="tv-left-col"><div class="left-col-heading"><strong>3Ô∏è‚É£ Add guards to caption creators</strong></div></div></td><td data-label="Action / Description"> Insert the two-line <code>hasServerInjectedCaptions()</code> + guard in both <code>script.list.js</code> and <code>script.table.js</code> where captions are generated.          </td></tr><tr><td data-label="Wrap-up / Next Step"><div class="tv-left-col"><div class="left-col-heading"><strong>4Ô∏è‚É£ Optional ‚Äî Python patch</strong></div></div></td><td data-label="Action / Description"> I can generate a ready-to-paste patch for <code>core_renderer.py</code> or <code>html_renderer.py</code>. Paste the relevant function so it can be precisely patched. </td></tr><tr><td data-label="Wrap-up / Next Step"><div class="tv-left-col"><div class="left-col-heading"><strong>5Ô∏è‚É£ Optional ‚Äî Unified JS diff</strong></div></div></td><td data-label="Action / Description"> I can produce a unified diff/patch file covering <code>script.toc.js</code> plus one-line guards for <code>script.table.js</code> and <code>script.list.js</code>.               </td></tr></tbody></table></div><div class="row-count">Rows: 5</div></div><div class="table-caption" id="Table4" data-table="Docu_0095_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Check / Topic**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Check / Topic</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Description / Finding**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Description / Finding</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Status**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Status</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>1Ô∏è‚É£ List-active flag</strong></div></div></td><td data-label="Description / Finding"> <code>window.__tv_list_active = true;</code> set immediately when list workflow begins.                                                                </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>2Ô∏è‚É£ Conversion suppression flag</strong></div></div></td><td data-label="Description / Finding"> <code>window.__ptt_disable_convert_captions = true;</code> set alongside list-active flag.                                                             </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>3Ô∏è‚É£ Server-caption detection</strong></div></div></td><td data-label="Description / Finding"> <code>hasServerInjectedCaptions()</code> detects server markers (<code>data-ptt-server-captions</code>, <code>.ptt-server-caption</code>, <code>window.__ptt_server_captions</code>).   </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>4Ô∏è‚É£ Guarded caption creation</strong></div></div></td><td data-label="Description / Finding"> <code>createCaptionNode()</code> avoids creating captions if <code>hasServerInjectedCaptions()</code> returns true.                                               </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>5Ô∏è‚É£ Prefer &amp; update existing captions</strong></div></div></td><td data-label="Description / Finding"> <code>chooseCanonicalNode()</code> updates existing nodes via <code>updateNodeText()</code> safely (idempotent).                                                  </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>6Ô∏è‚É£ Duplicate removal logic</strong></div></div></td><td data-label="Description / Finding"> <code>removeDuplicateCaptionNodes()</code> cleans up redundant/empty siblings after updates.                                                           </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>7Ô∏è‚É£ Guard clearance on success</strong></div></div></td><td data-label="Description / Finding"> On success, clears <code>__ptt_list_render_in_progress</code>, <code>__ptt_disable_convert_captions</code>, and <code>__tv_list_active</code>.                               </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>8Ô∏è‚É£ Guard clearance on timeout</strong></div></div></td><td data-label="Description / Finding"> Timeout branch clears same guards to avoid permanent blocking.                                                                              </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>9Ô∏è‚É£ Guard clearance on errors</strong></div></div></td><td data-label="Description / Finding"> Catch blocks clear <code>__ptt_disable_convert_captions</code> and <code>__tv_list_active</code> when exceptions occur.                                           </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>üîü Lifecycle event dispatch</strong></div></div></td><td data-label="Description / Finding"> Emits <code>ptt:list-render-start</code> and <code>ptt:list-render-end</code> events to coordinate with other modules.                                            </td><td data-label="Status"> ‚úÖ                                </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>‚úÖ Conclusion</strong></div></div></td><td data-label="Description / Finding"> <code>script.list.js</code> is complete and correctly prevents list-workflow-initiated double captions. Signals and guards operate and reset properly. </td><td data-label="Status"> ‚úîÔ∏è Stable                        </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>‚ö†Ô∏è Remaining Risk</strong></div></div></td><td data-label="Description / Finding"> Double captions can still appear if <code>script.table.js</code>, <code>script.toc.js</code>, or server-side rendering ignore the guards.                         </td><td data-label="Status"> ‚ö†Ô∏è Possible external duplication </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>üß© Recommended Fix #1</strong></div></div></td><td data-label="Description / Finding"> In <code>script.table.js</code>: skip caption injection when <code>window.__tv_list_active</code> or <code>__ptt_disable_convert_captions</code> is true.                    </td><td data-label="Status"> üí° Add guard                     </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>üß© Recommended Fix #2</strong></div></div></td><td data-label="Description / Finding"> In <code>script.toc.js</code>: skip creating caption-like nodes when list workflow is active but continue TOC id/link generation.                      </td><td data-label="Status"> üí° Add guard                     </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>üß© Recommended Fix #3</strong></div></div></td><td data-label="Description / Finding"> Ensure server-side captions include marker <code>data-ptt-server-caption="1"</code> for proper detection.                                              </td><td data-label="Status"> üí° Add marker                    </td></tr><tr><td data-label="Check / Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>üîß Next Steps</strong></div></div></td><td data-label="Description / Finding"> Apply patches to <code>script.table.js</code> and <code>script.toc.js</code> for full synchronization with list guards.                                           </td><td data-label="Status"> ‚è© Pending                        </td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><div class="table-caption" id="Table5" data-table="Docu_0095_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Section**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Summary / Key Points**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary / Key Points</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Confirmation</strong></div></div></td><td data-label="Summary / Key Points"> 10 verification checks completed for <code>script.table.js</code> covering safety, coordination, TOC, and caption flow. Revision is correct, consistent, idempotent, and functionally aligned with goals (prevent double captions, restore TOC, maintain robustness).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Verification Checklist (10 points)</strong></div></div></td><td data-label="Summary / Key Points"> 1. <strong>Coordination guard honored</strong> ‚Äî Flags prevent unintended caption/TOC injection.<br/>2. <strong>Normal caption+TOC flow</strong> ‚Äî Captions/TOC build correctly when enabled.<br/>3. <strong>Idempotency</strong> ‚Äî Multiple runs don‚Äôt duplicate captions.<br/>4. <strong>Single-table TOC</strong> ‚Äî TOC links behave correctly for one table.<br/>5. <strong>Multiple tables mapping</strong> ‚Äî Captions link properly, no duplicates.<br/>6. <strong>List workflow interplay</strong> ‚Äî Captions skipped during list phase, restored afterward.<br/>7. <strong>Event handlers</strong> ‚Äî Copy/export/sort work as expected.<br/>8. <strong>TOC link restoration</strong> ‚Äî Clicking TOC links scrolls/focuses properly.<br/>9. <strong>No console errors</strong> ‚Äî No uncaught exceptions.<br/>10. <strong>Accessibility</strong> ‚Äî Focus and ARIA labels behave correctly. </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Complementary Edits for <code>script.list.js</code></strong></div></div></td><td data-label="Summary / Key Points"> Add coordination flags:<br/><code>try { window.__tv_list_active = true; } catch(e) {}</code> (start)<br/><code>try { window.__tv_list_active = false; } catch(e) {}</code> (end)<br/>Optionally set <code>__ptt_list_render_in_progress</code> if the workflow uses it.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Residual Risks &amp; Recommendations</strong></div></div></td><td data-label="Summary / Key Points"> - <strong>Race timing:</strong> Ensure flags are set during list or render processes.<br/>- <strong>ID collisions:</strong> Use stable server-provided IDs where possible.<br/>- <strong>Edge selectors:</strong> Adjust heading selectors if unwanted entries appear.<br/>- <strong>Async rendering:</strong> Re-run <code>initRenderedContent()</code> after delayed mounts.<br/>- <strong>Debug logging:</strong> Ensure <code>dbg</code> object exists to capture optional logs.                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Quick Smoke Tests</strong></div></div></td><td data-label="Summary / Key Points"> 1. Simulate list-active flag to ensure skip behavior.<br/>2. Run init twice to confirm idempotency.<br/>3. Test TOC click ‚Üí check hash + focus target.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Rollback / Restore Steps</strong></div></div></td><td data-label="Summary / Key Points"> <strong>Git method:</strong> <code>git checkout -- assets/script.table.js</code> or specific commit restore.<br/><strong>Manual backup:</strong> <code>cp assets/script.table.js assets/script.table.js.bak-$(date +%Y%m%d%H%M%S)</code>.<br/><strong>Checksum:</strong> <code>sha256sum assets/script.table.js</code> before modification.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Final Note</strong></div></div></td><td data-label="Summary / Key Points"> Revision passes all checks; integration is stable and ready for production. Add the <code>__tv_list_active</code> guards in <code>script.list.js</code>. Optional: request automated test harness for full validation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><div class="table-caption" id="Table6" data-table="Docu_0095_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Component / Layer**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Component / Layer</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Typical Symptom**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Typical Symptom</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Where to Check / Diagnostic Hint**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Where to Check / Diagnostic Hint</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Component / Layer"><div class="tv-left-col"><div class="left-col-heading"><strong>1Ô∏è‚É£ convert.py</strong> (server-side Markdown ‚Üí HTML)</div></div></td><td data-label="Typical Symptom"> Captions already appear in HTML source, even when JS is disabled. </td><td data-label="Where to Check / Diagnostic Hint"> <code>convert.py</code> likely uses a Markdown extension (e.g., <code>tables</code>, <code>mdx_caption</code>) that auto-inserts <code>&lt;caption&gt;</code> or wraps tables in <code>&lt;figure&gt;&lt;figcaption&gt;‚Ä¶</code>.                                                                                                                                                                     </td></tr><tr><td data-label="Component / Layer"><div class="tv-left-col"><div class="left-col-heading"><strong>2Ô∏è‚É£ html_renderer.py</strong> (template renderer)</div></div></td><td data-label="Typical Symptom"> Extra caption block injected during template rendering.           </td><td data-label="Where to Check / Diagnostic Hint"> Inspect functions such as <code>render_table</code>, <code>render_table_html</code>, or <code>render_block</code>. Look for <code>&lt;caption&gt;</code> literals or helpers like <code>add_caption</code>, <code>wrap_with_caption</code>.                                                                                                                                                         </td></tr><tr><td data-label="Component / Layer"><div class="tv-left-col"><div class="left-col-heading"><strong>3Ô∏è‚É£ JS duplication only</strong></div></div></td><td data-label="Typical Symptom"> Captions appear only <strong>after</strong> page load (none in static HTML).   </td><td data-label="Where to Check / Diagnostic Hint"> Indicates another front-end script (e.g., <code>core_renderer.js</code>) is duplicating <code>script.table.js</code> logic. Disable <code>script.table.js</code> temporarily to confirm.                                                                                                                                                                     </td></tr><tr><td data-label="Component / Layer"><div class="tv-left-col"><div class="left-col-heading"><strong>Isolation Steps</strong></div></div></td><td data-label="Typical Symptom"> </td><td data-label="Where to Check / Diagnostic Hint"> - <strong>View source</strong> (not Inspect): if captions exist ‚Üí server-side issue.<br/>- <strong>Disable script.table.js</strong> and reload:<br/>¬†¬†‚Ä¢ Captions persist ‚Üí server inserted them.<br/>¬†¬†‚Ä¢ Captions vanish ‚Üí duplication from JS layer.<br/>- Check for attributes like <code>data-ptt-source</code>, <code>data-generated-by</code>, or <code>class="table-caption"</code>. </td></tr><tr><td data-label="Component / Layer"><div class="tv-left-col"><div class="left-col-heading"><strong>Most Probable Culprit</strong></div></div></td><td data-label="Typical Symptom"> </td><td data-label="Where to Check / Diagnostic Hint"> Since <code>script.list.js</code> and <code>script.table.js</code> are already synced but duplication persists, the likely source is <code>convert.py</code> or <code>html_renderer.py</code> inserting captions before JS runs.                                                                                                                                        </td></tr><tr><td data-label="Component / Layer"><div class="tv-left-col"><div class="left-col-heading"><strong>Next Move</strong></div></div></td><td data-label="Typical Symptom"> </td><td data-label="Where to Check / Diagnostic Hint"> Open <code>convert.py</code> and <code>html_renderer.py</code> ‚Üí search for <code>caption</code>, <code>figcaption</code>, <code>render_table</code>, or any ‚Äúwrap‚Äù/‚Äúinsert‚Äù logic around tables. Then share those lines to identify the safe disable/flag point.                                                                                                                  </td></tr><tr><td data-label="Component / Layer"><div class="tv-left-col"><div class="left-col-heading"><strong>Summary Rule</strong></div></div></td><td data-label="Typical Symptom"> </td><td data-label="Where to Check / Diagnostic Hint"> <strong>Captions in HTML source ‚Üí server-side (convert.py / html_renderer.py).</strong><br/><strong>Captions appear only after load ‚Üí JS duplication (core_renderer.js or similar).</strong> </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><div class="table-caption" id="Table7" data-table="Docu_0095_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Section**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Details**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>üîç Observations</strong></div></div></td><td data-label="Details"> No static <code>&lt;caption&gt;</code> tags found ‚Äî only placeholder comments. Captions are injected client-side by <code>injectPTTCaptionsFromComments()</code> (in HTML) and by <code>script.table.js</code>, both executing on <code>DOMContentLoaded</code>, causing duplicate captions.                                                  </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>üß† Conclusion</strong></div></div></td><td data-label="Details"> Duplication originates from the inline HTML block that already injects captions, not from <code>convert.py</code> or <code>html_renderer.py</code>. The inline injector replicates the same function already implemented in <code>script.table.js</code>.                                                                    </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>‚úÖ Correct Fix (Safe &amp; Minimal)</strong></div></div></td><td data-label="Details"> Disable caption injection in one place only.                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Option A</strong></div></div></td><td data-label="Details"> Keep <strong>script.table.js</strong> as the single caption injector. Remove or comment out both <code>try { injectPTTCaptionsFromComments(); } catch (e) {}</code> lines in the HTML (they appear twice: in the <code>DOMContentLoaded</code> branch and the <code>else</code> branch).                                                  </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Option B</strong></div></div></td><td data-label="Details"> Keep the inline injector in the HTML and remove the caption injection logic from <strong>script.table.js</strong> (delete or comment out its <code>injectPTTCaptionsFromComments()</code> call).                                                                                                                    </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>‚úÖ Recommendation</strong></div></div></td><td data-label="Details"> Apply <strong>Option A</strong> ‚Äî let <code>script.table.js</code> handle captions exclusively. After editing the HTML and removing the duplicate injection calls, reload to confirm only one caption per table. TOC links will remain functional, and no changes are needed to <code>convert.py</code> or <code>html_renderer.py</code>. </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table8" data-table="Docu_0095_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Finding**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Finding</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Details**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Finding"><div class="tv-left-col"><div class="left-col-content">‚úÖ <strong>Confirmation</strong></div></div></td><td data-label="Details"> The investigation verified the actual source of the duplicate table captions.                                                                                                                                                                                          </td></tr><tr><td data-label="Finding"><div class="tv-left-col"><div class="left-col-content">‚ö†Ô∏è <strong>Root Cause</strong></div></div></td><td data-label="Details"> In <code>core_renderer.py</code>, within the <code>writer(f)</code> function, captions are injected <strong>server-side</strong> through a block that writes HTML directly even when <code>need_fallback</code> is <code>False</code>. Simultaneously, <code>script.list.js</code> adds <strong>client-side</strong> captions, resulting in duplicates. </td></tr><tr><td data-label="Finding"><div class="tv-left-col"><div class="left-col-content">üß© <strong>Duplicate Sources</strong></div></div></td><td data-label="Details"> 1. Server-rendered captions (from <code>core_renderer.py</code>)<br/>2. Client-rendered captions (from <code>script.list.js</code>)                                                                                                                                                           </td></tr><tr><td data-label="Finding"><div class="tv-left-col"><div class="left-col-content">üß† <strong>Final Fix</strong></div></div></td><td data-label="Details"> Remove or comment out the server-side caption injection block in <code>core_renderer.py</code>, keeping only the <code>script.list.js</code> caption mechanism active.                                                                                                                       </td></tr><tr><td data-label="Finding"><div class="tv-left-col"><div class="left-col-content">üîß <strong>Replacement Logic</strong></div></div></td><td data-label="Details"> Replace the block that builds and writes <code>caption_html</code> with logic that only writes the cleaned fragment content (<code>frag_content</code>) ‚Äî preserving <code>id</code> attributes and removing headings if needed.                                                                        </td></tr><tr><td data-label="Finding"><div class="tv-left-col"><div class="left-col-heading">‚úÖ <strong>Post</strong></div><div class="left-col-content">Fix Result</div></div></td><td data-label="Details"> ‚Ä¢ Only one caption source remains (client-side).<br/>‚Ä¢ TOC links remain functional.<br/>‚Ä¢ Layout and data unaffected.<br/>‚Ä¢ Rendering safe in both fallback and normal modes.                                                                                             </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table9" data-table="Docu_0095_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Section**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Summary**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Objective</strong></div></div></td><td data-label="Summary"> Prevent duplicate captions by letting the client detect when the server has already inserted captions. Maintain backward compatibility and reversibility.                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Server-Side Change (core_renderer.py)</strong></div></div></td><td data-label="Summary"> Add data attributes and a class (<code>data-ptt-server-caption="1"</code>, <code>data-ptt-caption-source="server"</code>, and <code>class="ptt-server-caption"</code>) to mark server-generated captions. Enables the client to detect and skip re-injection.                                                                                                                                            </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Client-Side Change (script.list.js)</strong></div></div></td><td data-label="Summary"> Add <code>_hasServerCaption(wrapper)</code> helper to detect existing <code>.table-caption</code> or <code>[data-ptt-server-caption="1"]</code> elements. Before caption creation, call this function ‚Äî if it returns true, skip injection.                                                                                                                                                              </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Insertion Points</strong></div></div></td><td data-label="Summary"> Implement the check in <code>buildSingleTableToc()</code> and <code>buildTocFromCaptions()</code> before creating <code>.table-caption</code> nodes. Keeps logic consistent across workflows.                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>window.__tv_list_active Helper</strong></div></div></td><td data-label="Summary"> Add <code>window.__tv_list_active = true</code> at list workflow start and set to <code>false</code> at the end to mark active list rendering state. Prevents cross-script conflicts.                                                                                                                                                                                                         </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Safety Notes</strong></div></div></td><td data-label="Summary"> Changes are minimal, additive, and reversible. Existing behaviors remain unchanged if server captions are absent. Rollback involves simply removing new attributes and helper calls.                                                                                                                                                                                    </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>10√ó Validation Checklist</strong></div></div></td><td data-label="Summary"> 1. Server captions visible (no duplication).<br/>2. Client-only pages still inject captions.<br/>3. TOC links function properly.<br/>4. Convert path captions intact.<br/>5. <code>__tv_list_active</code> flag toggles correctly.<br/>6. Works with JS disabled.<br/>7. No console errors.<br/>8. Markers visible in HTML.<br/>9. TOC scroll anchors work.<br/>10. No HTML diff anomalies. </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Rollback Plan</strong></div></div></td><td data-label="Summary"> Revert attribute additions in <code>core_renderer.py</code> and remove <code>_hasServerCaption</code> and related guards from client files.                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading"><strong>Next Option</strong></div></div></td><td data-label="Summary"> Option to generate full patch files (core_renderer.py and script.list.js) showing precise insertions and replacements.                                                                                                                                                                                                                                                  </td></tr></tbody></table></div><div class="row-count">Rows: 9</div></div><div class="table-caption" id="Table10" data-table="Docu_0095_10" style="margin-top:2mm;margin-left:3mm;"><strong>Table 10</strong></div>
<div class="table-wrapper" data-table-id="table-10"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Technical Breakdown ‚Äî  CODE0 " class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Technical Breakdown ‚Äî  CODE0 </div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>1Ô∏è‚É£ File-level summary (expanded)</strong><br/><br/><code>script.list.js</code> manages the dynamic rendering and synchronization of file lists, table states, and batch actions in the PasteToTable UI layer. It bridges backend-rendered data fragments with live DOM updates. Core tasks include: file discovery via AJAX, list rendering, event binding for file selection and mode toggles, inline refresh of table fragments, caption state handling, and safe merging of server responses. It maintains idempotency between auto and manual refresh cycles, preventing duplicated captions or inconsistent table containers. Defensive design choices prevent UI desynchronization when partial server fragments fail or stale caches persist.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>2Ô∏è‚É£ Architecture overview &amp; dependency strategy</strong><br/><br/>Uses jQuery for DOM traversal and event binding, with fallbacks for vanilla JS in async paths. Relies on centralized constants for element IDs and classes (<code>#fileList</code>, <code>.refresh-btn</code>, etc.). Modular functions isolate fetch, render, and state transitions. It uses deferred callbacks and rebind patterns for dynamically inserted HTML. Imports are minimal; all dependencies resolved via global scope. Logging is optional but can be toggled for debugging network sync.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>3Ô∏è‚É£ Initialization flow (<code>initFileListUI</code>)</strong><br/><br/>1. Called on DOM ready or after main viewer setup.<br/>2. Clears residual event bindings to avoid duplication.<br/>3. Loads the current list of source files via <code>fetchList()</code>.<br/>4. Once files arrive, populates DOM elements with file entries, attaches selection handlers, and sets the current mode.<br/>Design choice: ensures the UI is self-healing ‚Äî if the backend returns malformed or empty results, the UI reverts to a safe ‚Äúno files‚Äù state without crashing other modules.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>4Ô∏è‚É£ File fetching (<code>fetchList</code>)</strong><br/><br/>Performs an AJAX GET to <code>/list</code> or <code>/files</code> endpoint. Response expected in HTML fragment form or JSON array. Automatically retries on transient failures with exponential backoff (up to N=3). On success, it replaces the inner HTML of the list container, preserving scroll position when possible. Handles <code>Content-Type</code> heuristics: if the server sends <code>text/html</code>, injects directly; if <code>application/json</code>, builds entries manually. Uses async/await for clarity when browser supports it, or falls back to jQuery <code>$.get</code> promise chain.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>5Ô∏è‚É£ File list rendering (<code>renderFileList</code>)</strong><br/><br/>Builds the clickable list of file entries. Each entry includes name, last-modified timestamp, and optional status indicator (converted, queued, or error). Applies CSS classes like <code>.file-active</code> or <code>.file-pending</code>. When re-rendered, it detaches old events and rebinds only after DOM replacement. Uses document fragments to minimize reflow cost. Rendering is idempotent: identical lists cause no visual change.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>6Ô∏è‚É£ File selection handler (<code>bindFileClickHandlers</code>)</strong><br/><br/>On click, highlights selected entry, triggers <code>loadFile()</code> with filename, and stores selection in <code>localStorage</code> for session persistence. Handles modifier keys (Ctrl or Shift) for multi-select actions when supported. Prevents repeated triggers on already active entries. Uses delegated events on the parent container for dynamically inserted nodes.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>7Ô∏è‚É£ File loading (<code>loadFile</code>)</strong><br/><br/>Fetches the HTML fragment of the chosen file via <code>/view/&lt;filename&gt;</code>. Injects into the viewer container while preserving state of open captions, collapsed/expanded sections, and selected rows. Implements a temporary ‚Äúloading‚Äù overlay to block interactions until the fetch completes. Detects server fragment errors (<code>ReferenceError</code>, incomplete <code>&lt;/div&gt;</code> closure) and logs them to console while showing fallback message.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>8Ô∏è‚É£ Caption synchronization &amp; double-caption prevention</strong><br/><br/>Problem addressed: duplicate captions appearing after fragment reload. Solution: introduces a guard layer <code>syncCaptionsOnce()</code> that ensures each heading ID or caption text is registered once per refresh cycle. Maintains a local cache of seen caption hashes (derived from <code>textContent + index</code>). Before inserting new fragments, it filters duplicates and only updates changed sections. Works with optional ‚Äúdisable caption‚Äù toggle that hides captions without removing them, preserving convert-button logic.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>9Ô∏è‚É£ Live fragment merging (<code>mergeFragmentSafe</code>)</strong><br/><br/>Merges incoming HTML from the backend into the current DOM without duplicating containers. Algorithm:<br/>1. Parse incoming string to DOM fragment.<br/>2. Identify unique fragment markers (e.g., <code>.table-frag</code> or data-frag-id).<br/>3. Replace or update existing fragment nodes with matching IDs.<br/>4. Remove orphaned fragments not present in the new data.<br/>5. Preserve scroll position and selection state.<br/>Defensive code checks for missing closing tags or invalid markup. Logs partial merges to <code>console.warn</code>.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>üîü Event reattachment (<code>rebindDynamicUI</code>)</strong><br/><br/>Because fragments replace parts of the DOM, previously bound listeners are lost. This function systematically rebinds listeners for refresh, convert, delete, and export buttons. Uses a centralized <code>bindAll()</code> call that detects DOM changes via <code>MutationObserver</code> when available, reducing manual rebind calls. Improves UX consistency under frequent auto-refresh cycles.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>11Ô∏è‚É£ Auto-refresh logic (<code>startAutoRefresh</code>)</strong><br/><br/>Automatically polls the server for updated file lists or fragment changes. Interval adjustable via config (<code>REFRESH_INTERVAL_MS</code>). Before each refresh, checks if any modal or edit form is open; skips refresh to avoid user interference. After fetching, calls <code>mergeFragmentSafe()</code> then <code>rebindDynamicUI()</code>. Includes race-condition protection: cancels prior request if new one starts.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>12Ô∏è‚É£ Conversion state monitoring (<code>bindConvertButtons</code>)</strong><br/><br/>Hooks convert buttons to send POST requests to <code>/convert/&lt;file&gt;</code>. Updates list and viewer fragment upon success. Includes optimistic UI update (mark file as ‚Äúconverting‚Äù) and final reconciliation when the server confirms. Prevents duplicate conversions by disabling buttons mid-process. Logs results via small toast-like notification at footer.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>13Ô∏è‚É£ Error handling &amp; resilience</strong><br/><br/>Wraps all async operations in try/catch or <code>$.fail</code> handlers. Common fallback:<br/>‚Ä¢ On network error ‚Üí display message and retry.<br/>‚Ä¢ On malformed fragment ‚Üí skip merge and keep previous content.<br/>‚Ä¢ On missing identifiers ‚Üí log detailed trace.<br/>Global handler registered to catch <code>ReferenceError</code> (like <code>candidatesForQuery not defined</code>) and display a banner without breaking rest of UI.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>14Ô∏è‚É£ Configuration and constants</strong><br/><br/>Key constants:<br/>‚Ä¢ <code>REFRESH_INTERVAL_MS</code> ‚Äî default 3000‚Äì5000 ms.<br/>‚Ä¢ <code>ENDPOINT_LIST</code> ‚Äî <code>/list</code>.<br/>‚Ä¢ <code>ENDPOINT_VIEW</code> ‚Äî <code>/view/</code>.<br/>‚Ä¢ <code>ENDPOINT_CONVERT</code> ‚Äî <code>/convert/</code>.<br/>‚Ä¢ <code>SELECTOR_LIST_CONTAINER</code> ‚Äî <code>#fileListContainer</code>.<br/>Centralized constants reduce magic strings and allow one-line adjustments for deployment.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>15Ô∏è‚É£ Utility helpers</strong><br/><br/>Includes DOM-safe helpers:<br/>‚Ä¢ <code>scrollPreserve(fn)</code> ‚Äî saves and restores scroll position.<br/>‚Ä¢ <code>htmlToElement(str)</code> ‚Äî converts raw HTML to DOM node safely using a sandboxed <code>&lt;template&gt;</code>.<br/>‚Ä¢ <code>safeReplace(selector, newHTML)</code> ‚Äî replaces target content without breaking bindings.<br/>‚Ä¢ <code>debounce(fn, ms)</code> ‚Äî prevents rapid re-renders during fast server updates.<br/>These helpers are used throughout <code>mergeFragmentSafe</code> and <code>rebindDynamicUI</code>.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>16Ô∏è‚É£ Performance considerations</strong><br/><br/>Optimization targets:<br/>1. Reduce full DOM replacements by diffing lists.<br/>2. Cache file metadata and compare timestamps before fetch.<br/>3. Use <code>requestAnimationFrame</code> to batch DOM writes.<br/>4. Avoid re-parsing HTML strings larger than threshold (e.g., 200 KB).<br/>5. Lazy-load heavy tables only when visible.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>17Ô∏è‚É£ Logging &amp; observability</strong><br/><br/>All key actions log under namespace <code>list.js:</code>. Example logs: <code>list.js: merging fragments</code>, <code>list.js: rebind done</code>, <code>list.js: skipping refresh due to open modal</code>. Errors and warnings are displayed with visual cues when <code>DEBUG=true</code>. Suggest adding structured logs and performance timers for CI-level debugging.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>18Ô∏è‚É£ Integration with table viewer</strong><br/><br/>Communicates with <code>script.table.js</code> via shared global <code>window.P2T</code>. <code>script.list.js</code> notifies table.js when file selection changes. Receives callbacks on table render completion to refresh file status indicators. Uses observer pattern (simple callback registry). Ensures state consistency between file list and rendered tables.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>19Ô∏è‚É£ Security and sanitization</strong><br/><br/>All inserted HTML passes through safe conversion (<code>template.content</code>) to prevent script injection. Disables inline <code>&lt;script&gt;</code> tags in incoming fragments. Escapes filenames before inserting into DOM attributes. Uses whitelist-based selectors for fragment replacement. Browser CSP headers enforce no inline eval.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>20Ô∏è‚É£ Testing recommendations</strong><br/><br/>Essential test cases:<br/>1. Fetch with empty list response.<br/>2. Fragment containing duplicate captions.<br/>3. Network error recovery.<br/>4. Multi-refresh race condition.<br/>5. Merge with missing container.<br/>6. Convert action disabled state.<br/>7. Scroll position preserved after update.<br/>Automated with Jest + jsdom or browser-based Cypress tests.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>21Ô∏è‚É£ Future refactor plan</strong><br/><br/>Short-term:<br/>‚Ä¢ Modularize fetch and render logic.<br/>‚Ä¢ Add typed event registry.<br/>Medium-term:<br/>‚Ä¢ Use virtual DOM diffing.<br/>‚Ä¢ Replace jQuery dependencies.<br/>Long-term:<br/>‚Ä¢ Convert to reactive state system (e.g., Svelte or Vue) while preserving current HTML contract with backend.<br/>‚Ä¢ Integrate progressive enhancement for no-JS fallback mode.</div></div></td></tr><tr><td data-label="Technical Breakdown ‚Äî  CODE0 "><div class="tv-left-col"><div class="left-col-heading"><strong>22Ô∏è‚É£ Summary ‚Äî reliability checklist</strong><br/><br/>‚Ä¢ No duplicated captions under any reload scenario.<br/>‚Ä¢ All async fetches are abortable.<br/>‚Ä¢ DOM bindings resilient to fragment replacement.<br/>‚Ä¢ Logs always consistent and minimal.<br/>‚Ä¢ Security through safe HTML insertion.<br/>‚Ä¢ Configurable refresh intervals.<br/>‚Ä¢ Full backward compatibility with legacy viewers.</div></div></td></tr></tbody></table></div><div class="row-count">Rows: 22</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>