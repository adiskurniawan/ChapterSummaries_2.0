<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761160183">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8037_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>ðŸ“Œ Module Overview â€” exhaustive</strong><br><br><strong>Purpose:</strong> Client-side utilities for PasteToTable and Table Viewer. Provide table lifecycle orchestration, user-friendly exports, search and robust highlight, stable row identity, accessible TOC generation, responsive UI adjustments, and graceful fallbacks when host capabilities are absent. The module focuses on DOM-first operation with optional captured-source precedence when raw input was provided by the user. It is intentionally defensive: recover from DOM mutation, missing features, or partial integration with host helpers.<br><br><strong>High-level responsibilities:</strong><br>1. Initialize and normalize rendered tables in the page.<br>2. Provide deterministic row identity and restore original order on demand.<br>3. Provide multi-format export and copy utilities that prefer captured source.<br>4. Provide search with Unicode-normalized highlight that preserves inner HTML.<br>5. Provide responsive control layout and accessible keyboard affordances.<br>6. Offer hooks for virtualization and external utilities via <code>tvUtils</code> and <code>tvConfig</code>.<br><br><strong>Design goals:</strong> resilient defaults, minimal breaking changes to public API, observable failure modes (toasts/logs), and composability for host applications. </td></tr><tr><td data-label="Summary"> <strong>Public API contract â€” stable surface & semantics</strong><br><br><strong>Exposed functions (global):</strong><br>- <code>window.PasteToTable.initRenderedContent()</code> â€” idempotent initialization that prepares tables for interaction.<br>- <code>window.exportTableCSV(btn,{filename})</code>, <code>window.exportTableMarkdown(btn,{filename})</code>, <code>window.exportTableJSON(btn,{filename})</code>, <code>window.exportTableXLSX(btn,{filename})</code>, <code>window.exportTableHTML(btn,{filename})</code>, <code>window.exportTablePDF(btn,{filename})</code> â€” single-table exports.<br>- <code>window.exportAllTablesMarkdown({filename})</code>, <code>window.exportAllTablesHTML({filename})</code>, <code>window.exportAllBtnHandler()</code> â€” multi-table exports.<br>- <code>window.copyTablePlain</code>, <code>window.copyTableMarkdown</code>, <code>window.copyAllTablesPlain</code>, <code>window.copyAllTablesMarkdown</code> â€” copy flows.<br>- <code>window.toggleTable</code>, <code>window.toggleAllTables</code>, <code>window.resetAllTables</code>, <code>window.searchTable</code>, <code>window.backToTop</code> â€” UI helpers.<br><br><strong>Design contract:</strong> Functions do not return data. They perform UI actions and side effects. They do not throw uncaught exceptions. For host telemetry they use <code>console</code> and <code>tvUtils.showToast</code> where provided. Do not rely on server access. </td></tr><tr><td data-label="Summary"> <strong>Initialization lifecycle & idempotence</strong><br><br><strong>initRenderedContent</strong> is the canonical bootstrap entry. It performs the following ordered steps to guarantee deterministic initialization across dynamic hosts:<br>1. Wrap raw <code>table</code> elements in <code>.table-container</code> if missing.<br>2. Configure TOC builders: prefer <code>window.PTToc</code> integration, fallback to <code>buildSingleTableToc</code> and <code>buildTocFromCaptions</code>.<br>3. Assign <code>data-tv-uid</code> to all rows and capture <code>originalRowOrders[tableIdx]</code>.<br>4. Capture each cell's <code>innerHTML</code> into <code>data-orig-html</code>.<br>5. Attach event handlers to per-wrapper action buttons (<code>handlers</code> list) using idempotent guards.<br>6. Initialize <code>sortStates</code> per table and call <code>updateHeaderSortUI</code>.<br><br><strong>Idempotence:</strong> Guards and dataset flags ensure safe repeated calls after partial DOM updates. </td></tr><tr><td data-label="Summary"> <strong>TOC construction â€” algorithms, accessibility, and fallbacks</strong><br><br><strong>buildSingleTableToc</strong> (single table pages):<br>- Operates only when exactly one <code>.table-wrapper</code> exists.<br>- Locates <code>#tocBar</code> and creates or finds <code>#tocBarList</code>.<br>- Iterates tbody rows, assigns stable <code>id</code> values (<code>tv-row-&lt;n&gt;</code>) and constructs <code>li&gt;a</code> links with <code>href=&quot;#id&quot;</code> and <code>aria-label</code>.<br>- Click handler smooth-scrolls into view, updates history, and focuses the target.<br><br><strong>buildTocFromCaptions</strong> (multi-table pages):<br>- Scans <code>.table-caption[id]</code> elements and creates TOC entries.<br>- Copies nodes into both <code>#toc</code> and <code>#tocBar</code> if present.<br>- Uses a 6-line proximity heuristic to link captured source blocks.<br><br><strong>Accessibility:</strong> All links set <code>aria-label</code>. Scrolling is sticky-header-aware. Focus is attempted on target rows. </td></tr><tr><td data-label="Summary"> <strong>Row identity, snapshot, and reset semantics (robustness guarantees)</strong><br><br><strong>UID assignment:</strong> <code>_ensureRowUidsAndSnapshot(table, tableIdx)</code> enumerates <code>tbody.rows</code> and assigns <code>data-tv-uid</code> where missing using <code>_tv_row_uid_counter</code>, ensuring unique IDs across page lifecycle. Stores the snapshot in <code>originalRowOrders[tableIdx]</code> for later restoration.<br><br><strong>Reset:</strong> <code>resetAllTables()</code> reorders rows according to <code>originalRowOrders</code>. Rebuilds <code>data-orig-html</code>, resets <code>sortStates</code> and header UI, clears search, triggers <code>searchTable()</code>, and shows toast if <code>tvUtils.showToast</code> exists.<br><br><strong>Guarantee:</strong> Reset operation is best-effort; unmatched rows appended at end to avoid data loss. </td></tr><tr><td data-label="Summary"> <strong>Sorting semantics & numeric heuristics (detailed)</strong><br><br><strong>State machine:</strong> Each column cycles through 0 = natural, 1 = ascending, 2 = descending. <code>sortStates[tableIdx][colIdx]</code> tracks each state. Only one column active at a time.<br><br><strong>Comparison algorithm:</strong><br>- Extract <code>textContent</code> trimmed.<br>- Try numeric detection by stripping commas and whitespace, calling <code>parseFloat</code>.<br>- If both numeric and not <code>NaN</code>, compare numerically; else use <code>localeCompare</code>.<br><br><strong>Edge cases:</strong> Currency, parentheses negatives, locale-specific separators not fully supported. Sorting re-appends rows to <code>tbody</code>. </td></tr><tr><td data-label="Summary"> <strong>Header UI updates and ARIA</strong><br><br><strong>updateHeaderSortUI(tableIdx)</strong> updates <code>th</code> elements to reflect the current sort state (<code>sort-state-0</code>, <code>sort-state-1</code>, <code>sort-state-2</code>) and updates <code>aria-sort</code> to <code>none</code>, <code>ascending</code>, or <code>descending</code>. <code>.sort-icon</code> innerHTML is replaced with inline SVG for stylable direction arrows. </td></tr><tr><td data-label="Summary"> <strong>Search pipeline and Unicode-normalized matching</strong><br><br><strong>searchTable</strong> workflow:<br>1. Read search input via <code>getSearchEl()</code> and compute <code>filterNorm</code> using <code>normalizeForSearchLocal</code>. <br>2. Iterate each <code>.table-container table</code> and for each <code>tbody.rows</code> clear prior highlights via <code>clearHighlights()</code> and test matches. <br>3. <code>normalizeForSearchLocal</code> performs <code>NFD</code> Unicode normalization, strips combining marks (<code>\u0300-\u036f</code>), removes non-letter/number punctuation using <code>\p{L}\p{N}</code> or fallback to <code>\w</code>, collapses whitespace and lowercases. This ensures diacritic-insensitive matching. <br>4. Rows without matches are hidden (<code>display: none</code>) while matches are left visible. Optionally highlight cells with <code>highlightMatches()</code> when <code>window.tvConfig.highlight</code> is true. <br>5. After processing all rows the algorithm calls <code>tableVirtualizer.refresh()</code> or <code>.update()</code> hooks if present so virtualization layers can adjust. <br>6. Scroll to the first matching row respecting <code>stickyMainHeader</code> offset. <br><br><strong>Note:</strong> Search is debounced by default hooking into <code>tvUtils.debounce</code> or the module fallback.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Summary"> <strong>Highlighting engine â€” character-level mapping and preservation of HTML</strong><br><br><strong>Problem:</strong> Highlighting user-provided needle while preserving existing inner HTML and not breaking tags or code spans.<br><br><strong>Solution â€” <code>buildNormalizedMapForCell</code> + <code>highlightMatches</code>:</strong><br>- <code>buildNormalizedMapForCell</code> uses a <code>TreeWalker</code> to traverse <code>TEXT_NODE</code>s only. For each text node it computes a per-codepoint normalized representation. It NFD-normalizes characters, strips combining marks, and filters non-alphanumeric characters with Unicode-aware regex where available. It constructs <code>normStr</code> concatenation and a <code>map</code> array mapping each normalized character index to <code>{ nodeIndex, offsetInNode }</code>. It also returns the <code>nodes</code> array of original text nodes for reassembly.<br>- <code>highlightMatches</code> searches <code>normStr</code> for the normalized needle. For each match (found in reverse order to preserve offsets) it maps the normalized start/end to original node offsets and performs safe <code>splitText</code> operations to isolate the matched text. It creates <code>&lt;mark&gt;</code> nodes and rewraps contiguous nodes spanning the match inside a single <code>&lt;mark&gt;</code> to preserve DOM structure. Surrogate-pair aware codepoint calculations ensure emoji and astral-plane characters are not split incorrectly.<br><br><strong>Complexity & memory:</strong> O(chars) time and O(chars) extra mapping memory per cell. For large cells this is expensive; recommend size thresholds and optional worker offload.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Summary"> <strong>Captured source heuristics and preference resolution</strong><br><br><strong>Goal:</strong> Prefer the user's original pasted source for copy/export flows to preserve fidelity of formatting and to produce most useful output for editing workflows.<br><br><strong>Mechanisms:</strong><br>- <code>attachSourceSnapshotters</code> watches <code>#paste</code> input and convert button clicks to snapshot captured source to <code>window.__tv_last_source</code> and time-stamp it in <code>window.__tv_last_source_ts</code> for recency checks.<br>- <code>findMarkdownTableBlocks</code> scans the captured source for contiguous pipe-based table blocks with a separator line matching <code>-{3,}</code> heuristics. It returns <code>[ { start, end, lines }]</code> candidate blocks.<br>- <code>getPreferredSourceForTable(table)</code> tries multiple heuristics in order: proximity-to-title (within 6 lines), header-count match, header-first-cell substring match, single-block fallback, title substring match in source. If none match returns <code>null</code> indicating to use DOM reconstruction. <br><br><strong>Rationale:</strong> Careful heuristics reduce mis-selection when document contains multiple tables or multi-part content.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Summary"> <strong>Markdown conversion, escaping, and linebreak handling</strong><br><br><strong>tableToMarkdownLines(table, title)</strong> constructs a pipe-table suitable for pasting into Markdown editors. It escapes characters as pipeline. It converts cell internal newlines to <code>&lt;br&gt;</code> to preserve line breaks in single-cell multiline content. The header row and separator row are produced deterministically. The title, when present, is output as <code>**Title**</code> followed by a blank line. This produces a readable editorial representation rather than a perfect round-trip for all possible cell HTML.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Summary"> <strong>Copy flows and precedence</strong><br><br><strong>copyTablePlain(btn)</strong> attempts DOM extraction to produce a tab-separated text representation with the wrapper <code>h3</code> title as a top-line header. It uses <code>window.tvUtils.copyToClipboard</code> or <code>showCopyModal</code> fallback and surfaces success/failure to user via <code>showToast</code> when available. If no table is available it falls back to <code>window.__tv_last_source</code>.<br><br><strong>copyTableMarkdown(btn)</strong> tries <code>getPreferredSourceForTable</code> first, then <code>tableToMarkdownLines</code>, then global captured source. This ensures the most author-friendly output is chosen first.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>Export formats: detailed behaviors and edge cases</strong><br><br><strong>CSV (<code>exportTableCSV</code>)</strong>:<br>- Fields are quoted only when containing <code>&quot;</code>, <code>,</code>, or newline. Quotes inside fields are doubled. Lines use CRLF <code>\r\n</code>. A UTF-8 BOM (<code>\uFEFF</code>) is prepended for compatibility with old Excel expectations. Filenames sanitized via <code>sanitizeFileName()</code> helper. If <code>downloadBlob</code> is present it is used, otherwise users are encouraged to use <code>showCopyModal</code> fallback.<br><br><strong>Markdown (<code>exportTableMarkdown</code>, <code>exportAllTablesMarkdown</code>)</strong>:<br>- Prefer the captured source block if available and likely matches the table. Otherwise convert DOM to Markdown using <code>tableToMarkdownLines</code>. Multi-table export concatenates tables separated by blank lines. Uses <code>downloadBlob</code> when present. <br><br><strong>JSON (<code>exportTableJSON</code>)</strong>:<br>- Header extraction chooses <code>thead</code> first or falls back to the first row. Cells are trimmed and assigned to header keys. JSON is pretty-printed with 2-space indentation. No type coercion applied. If headers are duplicated they will collide; recommend callers sanitize header names beforehand for production use. <br><br><strong>XLSX (<code>exportTableXLSX</code>)</strong>:<br>- Prefer <code>window.XLSX</code> (SheetJS). Uses <code>aoa_to_sheet</code> and <code>book_append_sheet</code>/<code>writeFile</code> where available. Sheet names truncated to 31 characters. If SheetJS is absent create a TSV fallback and warn via <code>showToast</code>. For binary creation when <code>XLSX.write</code> returns an array, wrap into a <code>Blob</code> and use <code>downloadBlob</code>. <br><br><strong>HTML (<code>exportTableHTML</code>, <code>exportAllTablesHTML</code>)</strong>:<br>- <code>_buildStandaloneHTML</code> produces a minimal readable template including CSS and <code>&lt;h1&gt;</code> title. Export prefers captured source if it begins with <code>&lt;</code>. Otherwise uses <code>table.outerHTML</code>. If captured source is present and not duplicative, include it in a <code>&lt;details&gt;&lt;pre&gt;</code> block for reference. Escaping of <code>&lt;</code>/<code>&gt;</code> is applied for text nodes included in the <code>&lt;pre&gt;</code> block, but captured HTML fragments are not sanitized â€” host must sanitize before sharing publicly. <br><br><strong>PDF (<code>exportTablePDF</code>)</strong>:<br>- Opens a new window with the generated HTML and calls <code>print()</code> after a short timeout to invoke the browser print dialog. This is dependent on popup permissions and browser print behavior. Where blocked, a toast informs user. </td></tr><tr><td data-label="Summary"> <strong>_buildStandaloneHTML template â€” CSS & structure</strong><br><br><strong>Template specifics:</strong><br>- Minimal inline CSS for legibility: system-ui font stack, <code>table{border-collapse:collapse}</code>, <code>th,td{border:1px solid #ccc;padding:6px}</code>. <br>- <code>&lt;h1&gt;</code> shows the title. <br>- <code>&lt;details&gt;&lt;summary&gt;</code> used to optionally show original source. <br><br><strong>Security note:</strong> This template does not perform deep sanitization. When hosting export server-side sanitize using a library like <code>DOMPurify</code> or treat the export as user-controlled content.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>Handler binding pattern & idempotency</strong><br><br><strong>Pattern:</strong> Central <code>handlers</code> list with <code>{ sel, fn }</code> tuples iterated over <code>.table-wrapper</code>. For each selected button the code ensures no <code>onclick</code> attribute exists and that <code>data-tvHandlerAttached</code> is not already set. It then attaches <code>click</code> handler that calls <code>h.fn(this)</code> wrapped in try/catch. This respects inline handlers and prevents duplicate attachments across multiple <code>initRenderedContent</code> calls.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Summary"> <strong>UI optimization details for responsive layouts and accessibility</strong><br><br><strong>optimizeTableControls</strong> specifics:<br>- Detects <code>isMobile</code> using <code>matchMedia(&#x27;(max-width:600px)&#x27;)</code>. On mobile, reduces paddings and groups action buttons into <code>.copy-buttons</code> with flexflow. Moves <code>.toggle-table-btn</code> into header first-child for easier thumb reach. Adds accessible attributes where appropriate. <br><br><strong>ARIA & keyboard interactions:</strong><br>- <code>aria-sort</code> updated on <code>th</code> elements. TOC links supplied with <code>aria-label</code>. <code>/</code> focuses search unless currently editing input. <code>Escape</code> triggers <code>backToTop</code>. Scroll to matches accounts for <code>stickyMainHeader</code> offset to avoid occlusion.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Summary"> <strong>Feature detection & pluggability</strong><br><br><strong>Hooks respected:</strong> <code>window.tvUtils</code> functions (<code>copyToClipboard</code>, <code>downloadBlob</code>, <code>showToast</code>, <code>showCopyModal</code>, <code>sanitizeFileName</code>, <code>debounce</code>) and <code>window.tvConfig</code> flags (e.g., <code>highlight</code>, <code>debounceMs</code>) are used when present. <code>window.PTToc</code>, <code>window.XLSX</code>, and <code>window.tableVirtualizer</code> support are included via feature detection. This design allows host applications to supply optimized implementations or security-hardened download/clipboard helpers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Summary"> <strong>Error handling, observability, and recommended host instrumentation</strong><br><br><strong>Current pattern:</strong> Widely used <code>try/catch</code> that swallows most DOM-related errors and surfaces only minimal console logs and <code>showToast</code> notifications for user-visible failures. <br><br><strong>Recommendation:</strong> Provide <code>window.PasteToTable.onError = function(err, context){}</code> hook that receives error objects and optional context (function name, args, tableId). Provide <code>window.PasteToTable.getState()</code> returning an object with <code>originalRowOrders</code>, <code>sortStates</code>, <code>_tv_row_uid_counter</code> for debugging. Add <code>tvConfig.logLevel</code> to toggle console verbosity. These changes preserve current silent behavior in production but enable debuggability during development.                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Summary"> <strong>Security analysis & mitigations</strong><br><br><strong>Risks identified:</strong><br>1. Exported HTML may include untrusted HTML fragments from <code>__tv_last_source</code> and be downloadable without sanitization. <br>2. <code>window.open</code> fallback for export may be blocked by popup blockers and produce inconsistent UX. <br>3. <code>getPreferredSourceForTable</code> may select an HTML fragment by mistake when multiple similar tables exist. <br><br><strong>Mitigations:</strong><br>- Add <code>tvConfig.allowHtmlInExport</code> defaulting to <code>false</code> so captured HTML is treated as plain text by default. <br>- Allow hosts to provide <code>tvUtils.sanitizeHtml(html)</code> to sanitize HTML before inclusion in exports. <br>- Document explicit warnings in README and release notes.                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Summary"> <strong>Performance profiling & thresholds</strong><br><br><strong>Complexity:</strong><br>- Row/cell loops are O(r * c) per operation. <br>- <code>buildNormalizedMapForCell</code> is O(k) for k characters in a cell and allocates mapping arrays proportionate to k. <br><br><strong>Practical thresholds:</strong><br>- For very large tables (>5000 rows) avoid running <code>highlightMatches</code> across all cells. <br>- For extremely long cell contents (>10k characters) skip mapping or process only first N characters. <br><br><strong>Optimization suggestions:</strong><br>1. Expose <code>tvConfig.maxHighlightChars</code> and <code>tvConfig.maxHighlightCellsPerRun</code>. <br>2. Provide an optional WebWorker <code>highlightWorker</code> that accepts cell HTML and needle and returns ranges to mark. <br>3. Use virtualization for rendering and keep <code>searchTable</code> limited to visible slices when virtualizer present (<code>tableVirtualizer</code>).                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>Edge cases, gotchas, and behavioral clarifications</strong><br><br>1. <code>originalRowOrders</code> index alignment depends on <code>.table-container table</code> NodeList snapshot. Inserting new tables before calling <code>initRenderedContent()</code> changes indices. Call <code>initRenderedContent()</code> after major DOM mutations. <br>2. Header extraction for JSON uses first <code>thead</code> row or falls back to the first row. If header cells are missing the generated keys will be <code>Col1</code>, <code>Col2</code>, etc. <br>3. <code>exportTableXLSX</code> with SheetJS expects <code>XLSX.utils.aoa_to_sheet</code>â€”older SheetJS distributions with different API surfaces may require adapter shims. <br>4. <code>formatCellForMarkdown</code> escapes <code>|</code> but leaves <code>&lt;br&gt;</code> for newlines. This helps editors sustain line breaks but is not strictly Markdown standard for multi-line cells.                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>Testing matrix â€” unit, integration, and manual smoke tests</strong><br><br><strong>Unit tests (prioritized):</strong><br>- <code>getPreferredSourceForTable</code> variations: title proximity, header match, single block, header substring. <br>- <code>split_table_row</code> and <code>formatCellForMarkdown</code> behavior with escaped pipes and inline code spans. <br>- <code>buildNormalizedMapForCell</code> with diacritics, surrogate pairs, and multi-node HTML. <br>- <code>highlightMatches</code> spanning text nodes and code spans. <br>- <code>sortTableByColumn</code> numeric vs string sorting and reset to natural order. <br><br><strong>Integration tests:</strong><br>- <code>initRenderedContent</code> idempotence across multiple calls and dynamic DOM injections. <br>- Export flows when <code>tvUtils</code> helpers missing and present. <br>- <code>exportTableXLSX</code> flows with and without SheetJS. <br><br><strong>Manual smoke tests:</strong><br>- Large table with 10k rows verify performance and highlight throttle. <br>- Browser popup blocking behavior for HTML/PDF export. <br>- Multi-table doc ensure <code>exportAllTablesHTML</code> combines properly. </td></tr><tr><td data-label="Summary"> <strong>Developer ergonomics & debug helpers</strong><br><br><strong>Recommended additions:</strong><br>1. <code>window.PasteToTable.onError</code> hook as noted. <br>2. <code>window.PasteToTable.getState()</code> returning an object shaped <code>{ originalRowOrders, sortStates, _tv_row_uid_counter }</code>. <br>3. <code>window.PasteToTable.setConfig(cfg)</code> to allow runtime adjustment of <code>tvConfig</code> values without modifying global object directly. <br>4. <code>tvUtils.debug</code> integration for in-memory logs that can be downloaded for issue triage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Summary"> <strong>Migration & backward compatibility guidance</strong><br><br>1. Maintain exposed global function names. Do not change <code>data-tv-uid</code> semantics. <br>2. When introducing <code>allowHtmlInExport</code> keep default <code>false</code>. <br>3. If changing <code>data-orig-html</code> handling ensure <code>resetAllTables()</code> still honors prior semantics to avoid breaking highlight/reset flows. <br>4. Add deprecation notices before removing behavior such as permissive escaping in <code>exportTableHTML</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Summary"> <strong>Suggested phased hardening roadmap</strong><br><br><strong>Phase 0 â€” quick wins:</strong><br>- Add <code>onError</code> hook, add <code>getState()</code>, document <code>tvUtils</code> contract. <br>- Add <code>tvConfig.maxHighlightChars = 5000</code> default and skip highlight for larger cells. <br><br><strong>Phase 1 â€” sanitization & security:</strong><br>- Introduce <code>tvConfig.allowHtmlInExport = false</code> and integrate <code>tvUtils.sanitizeHtml</code> for HTML export fallback. <br>- Add server-side sanitization docs. <br><br><strong>Phase 2 â€” performance:</strong><br>- Offload heavy highlight mapping to worker. <br>- Add <code>maxSearchCandidates</code> and use virtualizer hooks to limit search to visible rows. <br><br><strong>Phase 3 â€” internationalization & correctness:</strong><br>- Add locale-aware numeric parsing for sorting. <br>- Improve filename normalization to NFKC with transliteration for legacy systems.                                                                                                                                                                                                                  </td></tr><tr><td data-label="Summary"> <strong>Sample unit test pseudocode (concise)</strong><br><br><code>test_getPreferredSource_prefers_near_title()</code>:<br>1. given <code>source</code> with title line and table block within 3 lines <br>2. when <code>getPreferredSourceForTable(table)</code> called <br>3. expect returned block equals that table block.<br><br><code>test_buildNormalizedMap_handles_surrogates()</code>:<br>1. create cell with text containing emoji and diacritics <br>2. call <code>buildNormalizedMapForCell(cell)</code> <br>3. assert <code>normStr</code> length equals expected normalized character count and <code>map</code> matches node offsets.<br><br><code>test_sort_numeric_then_string()</code>:<br>1. table with mixed numeric-looking and string values <br>2. call <code>sortTableByColumn</code> and assert ascending numeric order then descending then reset to original using <code>originalRowOrders</code>. </td></tr><tr><td data-label="Summary"> <strong>Release notes template for module update</strong><br><br><strong>vX.Y.Z â€” highlights:</strong><br>- Added <code>exportTableHTML</code>/<code>exportAllTablesHTML</code> with captured-source preference.<br>- Improved search highlighting with Unicode normalization and surrogate pair safety.<br>- Added mobile UI optimization in <code>optimizeTableControls</code>.<br>- Exposed <code>PasteToTable.initRenderedContent</code> for external invocation.<br><br><strong>Changelog:</strong><br>- Fix: stable row UIDs assigned to all <code>tbody</code> rows.<br>- Perf: skip heavy highlight for cells > <code>tvConfig.maxHighlightChars</code>.<br><br><strong>Upgrade note:</strong> Call <code>PasteToTable.initRenderedContent()</code> after dynamic DOM patches.                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>Operational checklist prior to production rollout</strong><br><br>1. Add <code>tvUtils.downloadBlob</code> and <code>tvUtils.copyToClipboard</code> server-side safe wrappers where needed.<br>2. Enable <code>tvUtils.sanitizeHtml</code> or set <code>tvConfig.allowHtmlInExport=false</code>.<br>3. Add monitoring around <code>onError</code> hook to capture any silent catches during user testing.<br>4. Run performance tests with representative datasets and enable virtualizer for large data.<br>5. Update README with <code>tvUtils</code> contract and recommended host integrations.                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>Quick remediation steps for user-facing issues</strong><br><br><strong>If sorting appears wrong:</strong> ensure <code>originalRowOrders</code> entries exist and that <code>data-tv-uid</code> attributes are present. Call <code>PasteToTable.initRenderedContent()</code> to reassign UIDs if needed.<br><strong>If export missing SheetJS features:</strong> include <code>assets/xlsx.full.min.js</code> or provide <code>tvUtils.downloadBlob</code> to handle blob downloads.<br><strong>If highlighting fails silently:</strong> set <code>tvConfig.highlight=false</code> and consult <code>onError</code> logs; consider raising <code>maxHighlightChars</code>.                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Summary"> <strong>Final risk assessment & prioritized mitigations</strong><br><br><strong>Top risks:</strong><br>1. Silent <code>try/catch</code> hides developer-visible errors.<br>2. Exported captured HTML may leak scripts or unsafe markup.<br>3. Highlighting cost on huge cells can degrade UX.<br><br><strong>Priority mitigations:</strong><br>- Add <code>onError</code> hook and optional verbose logs.<br>- Integrate <code>tvUtils.sanitizeHtml</code> in export flow and add <code>allowHtmlInExport</code> opt-in.<br>- Add size thresholds and worker offload for highlight.                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Summary"> <strong>Acceptance criteria (definitive)</strong><br><br>1. <code>initRenderedContent()</code> is idempotent and wraps tables when required.<br>2. TOC builders operate for single-table and multi-table scenarios and generate accessible links.<br>3. Sorting cycles and header UI updates match <code>sortStates</code>.<br>4. Search properly normalizes Unicode and highlights occurrences without breaking inner HTML.<br>5. Exports prefer captured source and fall back deterministically to DOM conversions.<br>6. Host hooks (<code>tvUtils</code>, <code>tvConfig</code>) are honored when present.<br>7. No uncaught exceptions propagate to page main thread under normal actions.                                                                                                                                                               </td></tr><tr><td data-label="Summary"> <strong>Next-step options for you</strong><br><br>1. Approve this breakdown and ask for a prioritized patch list implementing <code>onError</code>, <code>getState</code>, and <code>allowHtmlInExport</code>.<br>2. Ask for a concrete PR diff that implements the top three mitigations.<br>3. Request a minimal test harness HTML page that includes <code>script.table.js</code> and tests the key flows.                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr></tbody></table></div><div class="row-count">Rows: 32</div></div><div class="table-caption" id="Table2" data-table="Book_8037_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>Appendix A â€” highlight worker pseudocode</strong><br><br>Offload mapping and match-finding to a worker. Worker receives <code>{ html, needle, maxChars }</code> and returns <code>[{startNodePath, startOffset, endNodePath, endOffset}]</code> ranges relative to the input DOM fragment or returns <code>[]</code> when skipped.<br><br>Example pseudocode:<br><code>js&lt;br&gt;// worker.js&lt;br&gt;onmessage = function(ev){&lt;br&gt;  const { html, needle, maxChars } = ev.data;&lt;br&gt;  // parse html into nodes (DOMParser)&lt;br&gt;  // build normalized map&lt;br&gt;  // find matches&lt;br&gt;  // send back ranges or []&lt;br&gt;};&lt;br&gt;</code><br><br>Benefit: avoids blocking the main thread for large cells and preserves DOM safety when main thread applies minimal changes. </td></tr><tr><td data-label="Summary"> <strong>Appendix B â€” example integration recipe (React host)</strong><br><br>Load <code>script.table.js</code> as an asset. After React renders table markup into container, call:<br><code>js&lt;br&gt;useEffect(()=&gt;{&lt;br&gt;  if(window.PasteToTable &amp;&amp; typeof window.PasteToTable.initRenderedContent===&#x27;function&#x27;)&lt;br&gt;    window.PasteToTable.initRenderedContent();&lt;br&gt;}, [data]);&lt;br&gt;</code><br><br>Provide <code>tvUtils</code> shim for download and clipboard in the host app. Optionally set:<br><code>js&lt;br&gt;window.tvConfig = { highlight:true, allowHtmlInExport:false, maxHighlightChars:5000 };&lt;br&gt;</code>                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>Appendix C â€” detailed troubleshooting checklist</strong><br><br>1. No handlers on buttons: check that <code>initRenderedContent()</code> ran after DOM insertion.<br>2. Wrong export content: captured source mismatch; check <code>window.__tv_last_source</code> and timestamp.<br>3. Sorting not resetting: <code>originalRowOrders</code> missing; re-run <code>initRenderedContent()</code>.<br>4. Highlight not showing: verify <code>tvConfig.highlight === true</code> and that cell lengths are under <code>tvConfig.maxHighlightChars</code>.<br>5. XLSX export generates TSV: <code>window.XLSX</code> not loaded. Include <code>xlsx.full.min.js</code>.                                                                                                                               </td></tr><tr><td data-label="Summary"> <strong>Appendix D â€” recommended CI unit tests list</strong><br><br>- <code>test_table_export_markdown_prefers_captured_source</code><br>- <code>test_sort_numeric_detection_with_commas</code><br>- <code>test_highlight_surrogate_pairs_and_combining_marks</code><br>- <code>test_reset_restores_original_order</code><br>- <code>test_copy_fallbacks_when_clipboard_api_missing</code><br>- <code>test_export_html_includes_original_when_non_dupe</code><br><br>Each test should run in a headless browser environment (Puppeteer / Playwright) with instrumentation for <code>window.PasteToTable.getState()</code> and <code>window.__tv_last_source</code>.                                                                 </td></tr><tr><td data-label="Summary"> <strong>Appendix E â€” suggested PR diff plan (top 3 mitigations)</strong><br><br>1. Add <code>onError</code> hook and <code>_reportError</code> calls across existing catch blocks where errors are logged.<br>2. Add <code>getState()</code> returning snapshots for debugging.<br>3. Add <code>tvConfig.allowHtmlInExport</code> flag that defaults to false and update <code>exportTableHTML</code>/<code>exportAllTablesHTML</code> to treat captured source as plaintext unless the flag is <code>true</code> and <code>tvUtils.sanitizeHtml</code> is present.<br><br>Produce small, safe commits each touching a single function and add tests for each behavior.                                                             </td></tr><tr><td data-label="Summary"> <strong>Appendix F â€” sample small diffs (conceptual)</strong><br><br><code>+ function _reportError(err, ctx){ if(window.PasteToTable &amp;&amp; typeof window.PasteToTable.onError===&#x27;function&#x27;) window.PasteToTable.onError(err, ctx); }</code><br><code>+ window.PasteToTable.getState = function(){ return { originalRowOrders, sortStates, _tv_row_uid_counter }; }</code><br><code>+ if(!window.tvConfig.allowHtmlInExport) treat captured source as text in exportTableHTML</code><br><br>These are minimal and safe to review.                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>Appendix G â€” long-form examples of failure & recovery</strong><br><br><strong>Scenario 1:</strong> Host injects tables dynamically after SPA navigation. Symptoms: no handlers on buttons. Recovery: call <code>PasteToTable.initRenderedContent()</code> after DOM injection. Add to host router hooks.<br><br><strong>Scenario 2:</strong> Captured source contains multiple pipe tables and wrong one exported. Symptoms: exported markdown does not match the table visually. Recovery: inspect <code>window.__tv_last_source</code> and call <code>getPreferredSourceForTable(table)</code> in console to see match reasoning. For higher fidelity add a UI toggle to force DOM fallback. </td></tr><tr><td data-label="Summary"> <strong>Appendix H â€” glossary of internal names & arrays</strong><br><br><code>originalRowOrders</code> â€” array of arrays mapping tableIdx -> array of <code>data-tv-uid</code> strings.<br><code>sortStates</code> â€” array of arrays mapping tableIdx -> per-column state 0/1/2.<br><code>_tv_row_uid_counter</code> â€” global monotonic counter for UIDs.<br><code>data-orig-html</code> â€” per-cell dataset storing original <code>innerHTML</code> to restore after highlighting.                                                                                                                                                                                                                           </td></tr><tr><td data-label="Summary"> <strong>Appendix I â€” closing recommendations</strong><br><br>1. Ship with <code>tvConfig.allowHtmlInExport=false</code> and a recommended <code>tvUtils.sanitizeHtml</code> implementation.<br>2. Add <code>onError</code> and <code>getState</code> for observability.<br>3. Add worker offload for highlights when <code>maxHighlightChars</code> exceeded.<br>4. Include example <code>tvUtils</code> shim in repository docs.<br><br>These changes provide immediate safety and debuggability while preserving current UX.                                                                                                                                                                                </td></tr></tbody></table></div><div class="row-count">Rows: 9</div></div><div class="table-caption" id="Table3" data-table="Book_8037_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Phase / Area**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Phase / Area</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Actions / Improvements**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Actions / Improvements</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Phase / Area"> <strong>1. Cell & Row Normalization</strong>   </td><td data-label="Actions / Improvements"> - Merge multi-line content into single logical cell<br>- Detect placeholders (<code>???</code>, <code>Document name</code>) and mark as <code>placeholder=True</code><br>- Pad uneven rows to consistent column count </td></tr><tr><td data-label="Phase / Area"> <strong>2. Content Validation</strong>         </td><td data-label="Actions / Improvements"> - Flag missing deadlines (<code>Due date: ???</code>)<br>- Detect incomplete sentences (no punctuation)<br>- Highlight typos or suspicious words (e.g., â€œposedâ€ â†’ â€œpostedâ€)                     </td></tr><tr><td data-label="Phase / Area"> <strong>3. Inline Symbols & Footnotes</strong> </td><td data-label="Actions / Improvements"> - Preserve Unicode symbols (âš ï¸, emoji)<br>- Maintain footnote references <code>[n]</code> tied to correct cells<br>- Add HTML/CSS warning class <code>.ptt-warning</code> for flagged cells                </td></tr><tr><td data-label="Phase / Area"> <strong>4. Multi-line Numeric Cells</strong>   </td><td data-label="Actions / Improvements"> - Keep multi-currency lines (e.g., <code>VND 1,000\nUSD 50</code>) inside one cell<br>- Optional: align numbers right for HTML output<br>- Use <code>&lt;br&gt;</code> or Markdown soft breaks for readability   </td></tr><tr><td data-label="Phase / Area"> <strong>5. Output Consistency</strong> </td><td data-label="Actions / Improvements"> - Internal representation: <code>List[List[Cell]]</code> with <code>text</code>, <code>placeholder</code>, <code>warnings</code><br>- Markdown: retain soft breaks & footnotes<br>- HTML: use <code>&lt;table&gt;</code>, <code>&lt;tr&gt;</code>, <code>&lt;td&gt;</code> with warning classes   </td></tr><tr><td data-label="Phase / Area"> <strong>6. Quality & Audit</strong>    </td><td data-label="Actions / Improvements"> - Ensure all rows have equal column count<br>- Generate review summary of placeholders & warnings<br>- Add unit tests for: multi-line cells, missing deadlines, multi-currency, footnotes, symbols </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>