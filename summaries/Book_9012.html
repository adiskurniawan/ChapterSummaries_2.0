<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;}</style>
<link rel="stylesheet" href="assets/style.css?v=1759437780">
<link rel="stylesheet" href="assets/overrides.css?v=1759437780">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header"><div><h1>Tables Viewer v2.1</h1></div><div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" type="search" placeholder="Search" aria-label="Search tables" style="min-width:420px; width:44ch;"/>
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllMdBtn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy all tables as markdown">Copy All Tables (Markdown)</button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset all tables">Reset All Tables</button>
</div></div>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#table-1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#table-2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#table-3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#table-4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#table-5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#table-6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#table-7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#table-8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#table-9">Table 9</a></li></ul></div></div>
<div class="tv-fragment" id="frag-1">
<div class="table-wrapper" data-table-id="table-1"><h3 id="table-1">Table 1</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>                         </td><td data-label="Conceptual Notes">Concurrent fragment rendering pipeline. Accepts heterogeneous inputs (DataFrame, list-of-dicts, list-of-lists, markdown, HTML, file paths, bytes). Normalizes text, extracts pipe-markdown and HTML `<table>` blocks, converts to DataFrame-like objects, renders each fragment (possibly in parallel), writes atomically to `tmp_frag_dir`, and returns `(fragments_map, frag_row_counts, total_rows, warnings)`.</td></tr><tr><td data-label="Logic / Structure"><strong>Input normalization</strong>             </td><td data-label="Conceptual Notes">`_normalize_table_text` cleans unicode (NFKC), removes zero-width chars, NBSP -> space, converts en/em dashes to hyphen, collapses repeated hyphens and `<br>` tags. Handles bytes -> decoded text, Path/file -> read content, dict/list detection, and wraps bare dicts. Uses optional `convert.parse_markdown_tables` first, then local `_extract_pipe_tables_from_markdown`, then renderer.render() â†’ `_extract_table_blocks_from_html`. Non-table strings are skipped.</td></tr><tr><td data-label="Logic / Structure"><strong>Table extraction & conversion</strong>   </td><td data-label="Conceptual Notes">`_extract_pipe_tables_from_markdown` parses GitHub-style pipe tables preserving escaped `|` and inline backticks. `_parse_table_html_regex` and `_extract_table_blocks_from_html` extract `<table>` blocks via regex. `_convert_rows_to_df_like` tries to build `pandas.DataFrame` if available; falls back to list-of-dicts or list-of-lists.</td></tr><tr><td data-label="Logic / Structure"><strong>Rendering flow</strong>                  </td><td data-label="Conceptual Notes">Build `inputs` list of normalized table-like items. Determine `worker_count = min(len(inputs), max_workers)` then submit `_render_job(idx, df)` to ThreadPoolExecutor. `_render_job` uses `_call_render_table` which prefers `core_table.render_table` if present else `_simple_render_table`. Writes fragment file atomically using `_atomic_stream_write` if available or tmp+`os.replace`.</td></tr><tr><td data-label="Logic / Structure"><strong>Metadata extraction</strong>             </td><td data-label="Conceptual Notes">After job completion, futures are inspected to extract `title_id`/`title_text` via `<h3 id="...">` regex, `sections` via `div.section-heading` id regex, and `row_count` via counting `<tr>` (prefers `<tbody>`). Populates `fragments_map[idx]`, `frag_row_counts[idx]`, increments `total_rows`, and aggregates `warnings`.</td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & edge cases</strong>      </td><td data-label="Conceptual Notes">- Optional dependencies: `_atomic_stream_write`, `_render_table_helper`, `_convert_parse_markdown_tables`, and `pandas` may be absent; code falls back but behavior differs.<br>- Regex-based HTML parsing is brittle vs real HTML; complex markup may misparse.<br>- Mixed column counts produce dicts or raw rows that downstream `render_table` must accept.<br>- Skips non-table strings silently; may hide user errors.<br>- Concurrent writes/read in shared tmp dir risk collisions if tmp naming not unique across runs.</td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong>      </td><td data-label="Conceptual Notes">- Prefer `bs4` or an HTML parser for robust table extraction when available; document parity tests for regex fallback.<br>- Use UUID-prefixed temp fragment filenames to avoid collisions across runs/processes.<br>- Validate fragment schema after render (ensure `title_id`, `content` present) and surface richer warnings including source index.<br>- Add a configurable size cap per fragment and stream large outputs to disk to avoid high memory use.<br>- Centralize extraction logic (shared with `core_renderer`) to avoid duplication and drift.</td></tr><tr><td data-label="Logic / Structure"><strong>Tests / verification</strong>            </td><td data-label="Conceptual Notes">Unit tests for normalization, pipe-table extraction, HTML extraction (regex vs bs4 parity), and `_convert_rows_to_df_like` with/without pandas. Integration tests: feed mixed input shapes and assert correct `fragments_map` entries, atomic write behavior, and fallback paths. Concurrency tests: run with `max_workers>1` and assert stable results and no file collisions.</td></tr><tr><td data-label="Logic / Structure"><strong>Performance / operational notes</strong> </td><td data-label="Conceptual Notes">ThreadPoolExecutor handles IO/CPU mix; choose `max_workers` carefully. Atomic writes reduce partial-file risk. For very large tables, current approach builds full HTML in memory per fragment; consider streaming and backpressure. Logging at INFO for fragment completion is helpful; include debug traces on parse failures.</td></tr><tr><td data-label="Logic / Structure"><strong>Public API wrappers</strong>             </td><td data-label="Conceptual Notes">Exposes `render_fragments_concurrently`, `normalize_table_text`, `extract_pipe_tables_from_markdown`, `extract_table_blocks_from_html`, `convert_rows_to_df_like`, and `simple_render_table`. These are stable hooks for testing and reuse by `core_renderer`.</td></tr></tbody></table></div><div class='row-count'></div></div>
</div><div class="tv-fragment" id="frag-2">
<div class="table-wrapper" data-table-id="table-2"><h3 id="table-2">Table 2</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>: locate/create assets dir, ensure minimal CSS/JS/worker files, and copy project assets when available. Provides `prepare_assets(cfg, out_dir)` and `write_overrides_css(out_dir, left_width, right_width)`.                          </td><td data-label="Conceptual Notes">Centralized asset provisioning for render_html. Returns `(assets_dir, style_fallback, script_fallback, assets_written_flag)` so renderer can embed or link assets.</td></tr><tr><td data-label="Logic / Structure"><strong>Project helpers vs fallbacks</strong>: tries to import `.assets` helpers (`_copy_assets_impl`, `_write_overrides_impl`, `_EMBED_STYLE`, `_EMBED_SCRIPT`). If present uses them; otherwise uses internal fallbacks.                                    </td><td data-label="Conceptual Notes">Preferred path uses project-provided copy/write logic. Embedded fallbacks supply minimal style/script strings.</td></tr><tr><td data-label="Logic / Structure"><strong>Asset discovery & copy</strong>: `_copy_from_source_assets` searches candidate locations (repo-level `assets`, cwd/assets, package parent assets, render package assets). Copies files only when target missing or small. Returns True if any copied. </td><td data-label="Conceptual Notes">Conservative copying to avoid overwriting real project assets. Candidate ordering determines precedence. Copy uses `shutil.copy2`.</td></tr><tr><td data-label="Logic / Structure"><strong>Atomic writes & placeholders</strong>: `_atomic_write_text` uses `tempfile.mkstemp` + `os.replace`. `_ensure_non_empty_file` writes fallback when file missing or <10 bytes. Worker and overrides placeholders created if missing.                    </td><td data-label="Conceptual Notes">Ensures no zero-byte assets. Atomic write reduces partial-write risk. Threshold avoids clobbering intentionally tiny files.</td></tr><tr><td data-label="Logic / Structure"><strong>write_overrides_css</strong>: calls project impl if available; else writes generated overrides.css into `assets/` using `_atomic_write_text`. Encodes left/right width CSS vars.                                                                      </td><td data-label="Conceptual Notes">Allows runtime layout tuning. Non-fatal fallback ensures overrides exist even without project helper.</td></tr><tr><td data-label="Logic / Structure"><strong>Diagnostics & logging</strong>: logs candidate copy attempts, assets_written flag, and file listing. Does not raise on failures; logs debug traces.                                                                                                   </td><td data-label="Conceptual Notes">Non-fatal behavior fits render pipeline resilience. Good for CI logging.</td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & edge cases</strong>                                                                                                                                                                                                                   </td><td data-label="Conceptual Notes">- Permissions or disk errors during copy/atomic write.<br>- Candidate detection may miss intended assets if project layout is nonstandard.<br>- Very large files (xlsx 930KB) copied unnecessarily; can be slow.<br>- Race conditions if multiple processes write same assets dir concurrently.<br>- `<em>EMBED</em>*` empty means minimal placeholders only.</td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong>                                                                                                                                                                                                                   </td><td data-label="Conceptual Notes">- Use package resource APIs for embedded defaults (pkg_resources/importlib.resources).<br>- Make candidate list configurable via `cfg.assets_sources` and add explicit priority.<br>- Skip copying large files by size threshold or opt-in. <br>- Add content-hash check to avoid redundant copies; surface copy results (which files copied).<br>- Provide a dry-run and a force-overwrite option.</td></tr><tr><td data-label="Logic / Structure"><strong>Tests / verification</strong>                                                                                                                                                                                                                         </td><td data-label="Conceptual Notes">- Unit: simulate missing/small files and assert placeholders created and non-clobber behavior.<br>- Integration: project-provided `_copy_assets_impl` vs fallback path.<br>- Edge: simulate permission errors and tmpfile failures.</td></tr><tr><td data-label="Logic / Structure"><strong>Performance / operational notes</strong>                                                                                                                                                                                                              </td><td data-label="Conceptual Notes">Copying is I/O-bound; keep copies minimal. Atomic writes use same-directory temp files which require sufficient disk space and permissions.</td></tr></tbody></table></div><div class='row-count'></div></div>
</div><div class="tv-fragment" id="frag-3">
<div class="table-wrapper" data-table-id="table-3"><h3 id="table-3">Table 3</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose / API</strong>                </td><td data-label="Conceptual Notes">Provide atomic-write and directory utilities used by renderer. Public exports: `_atomic_write`, `_atomic_stream_write`, `_ensure_dir`, `tmp_frag_dir_for`.</td></tr><tr><td data-label="Logic / Structure"><strong>Implementation selection</strong>     </td><td data-label="Conceptual Notes">Prefer project-provided implementations from `io_utils` when present. Fallbacks `_default_write_atomic`, `_default_stream_write`, `_ensure_dir_path` implemented here.</td></tr><tr><td data-label="Logic / Structure"><strong>Atomic write semantics</strong>       </td><td data-label="Conceptual Notes">`_default_write_atomic(path, writer)` writes to a same-directory NamedTemporaryFile, calls `writer(tf)`, flush/fsync best-effort, then `os.replace(tmp, path)` for atomic swap. Cleans up tmp on failure and re-raises.</td></tr><tr><td data-label="Logic / Structure"><strong>Streaming support</strong>            </td><td data-label="Conceptual Notes">`_default_stream_write` delegates to `_default_write_atomic` to mirror `io_utils` streaming API. Exported as `_atomic_stream_write`.</td></tr><tr><td data-label="Logic / Structure"><strong>Directory utilities</strong>          </td><td data-label="Conceptual Notes">`_ensure_dir_path` tries `Path.mkdir(parents=True, exist_ok=True)` then falls back to `os.makedirs`. Non-raising in normal conditions.</td></tr><tr><td data-label="Logic / Structure"><strong>Tmp fragment dir</strong>             </td><td data-label="Conceptual Notes">`tmp_frag_dir_for(out_dir)` => `.frags_<timestamp_ms><em><pid></em><uuid8>` created inside `out_dir`. Falls back to `out_dir` on failure.</td></tr><tr><td data-label="Logic / Structure"><strong>Re-exports & selection logic</strong> </td><td data-label="Conceptual Notes">Module-level `_atomic_write/_atomic_stream_write/_ensure_dir` are bound to project impls if found, else to defaults. `<strong>all</strong>` re-exports these names.</td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & edge cases</strong>   </td><td data-label="Conceptual Notes">- Project `io_utils` may be absent â†’ fallbacks used.<br>- fsync may fail or be no-op; atomicity semantics vary per OS/filesystem.<br>- Temp-file creation/replace may fail on permission or cross-device moves (but same-dir temp mitigates cross-device).<br>- Caller writer exceptions bubble up; caller must handle.</td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong>   </td><td data-label="Conceptual Notes">- Add optional retry/backoff for transient replace/fsync errors.<br>- Validate writer returned state and surface diagnostics (path of tmp file on error).<br>- Provide a context-manager wrapper to simplify usage and ensure cleanup.<br>- Add unit tests that simulate writer exceptions and concurrent writers.</td></tr><tr><td data-label="Logic / Structure"><strong>Tests / verification</strong>         </td><td data-label="Conceptual Notes">Unit: ensure atomic replace semantics, tmp file cleanup on writer failure, tmp_frag_dir naming uniqueness. Integration: verify re-export resolution when `io_utils` provides alternative API names.</td></tr></tbody></table></div><div class='row-count'></div></div>
</div><div class="tv-fragment" id="frag-4">
<div class="table-wrapper" data-table-id="table-4"><h3 id="table-4">Table 4</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by Logic / Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic / Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose / API</strong>              </td><td data-label="Conceptual Notes">Provide HTML sanitization utilities. Primary entry: `sanitize_html(html_text: str, allow_tables: bool = False) -> str`. Use `bleach` if available; otherwise use a conservative fallback HTMLParser-based cleaner.</td></tr><tr><td data-label="Logic / Structure"><strong>Configuration constants</strong>    </td><td data-label="Conceptual Notes">`ALLOWED_TAGS`, `ALLOWED_ATTRIBUTES`, `ALLOWED_PROTOCOLS`, `IMG_DATA_MIME` (strict data:image base64 regex), `TABLE_TAGS`. These drive what is preserved when `allow_tables=True`.</td></tr><tr><td data-label="Logic / Structure"><strong>URL safety</strong>                 </td><td data-label="Conceptual Notes">`is_safe_url(url)` allows relative URLs, http/https/mailto, and `data:` only when matching `IMG_DATA_MIME`. Rejects other schemes.</td></tr><tr><td data-label="Logic / Structure"><strong>Attr filtering</strong>             </td><td data-label="Conceptual Notes">`_attr_allowed_for_tag(attr, tag)` checks `ALLOWED_ATTRIBUTES` with wildcard suffix support (e.g., `data-<em>`, `aria-</em>`).</td></tr><tr><td data-label="Logic / Structure"><strong>Primary flows</strong>              </td><td data-label="Conceptual Notes">`bleach_clean` uses `bleach.clean` and `bleach.linkify` when available, then post-processes attributes with a regex (`ATTRS_RE`) to re-validate and escape attribute values. `fallback_clean` uses `FallbackCleaner` (HTMLParser) to emit only allowed tags/attrs and escape text nodes.</td></tr><tr><td data-label="Logic / Structure"><strong>Hardening</strong>                  </td><td data-label="Conceptual Notes">`sanitize_html` selects allowed tags based on `allow_tables`. It neutralizes `<script>` tokens and strips inline `on*` attributes via regex post-pass. Returns safe string.</td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & edge cases</strong> </td><td data-label="Conceptual Notes">- `bleach` absence uses fallback which is conservative but may differ in output. <br>- `ATTRS_RE` and regex-based post-processing can be brittle on complex markup. <br>- `data:` image strictness may reject some valid variants. <br>- Linkify and post-processing may alter attribute ordering or whitespace.</td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong> </td><td data-label="Conceptual Notes">- Prefer `bleach` (or libxml) with canonical attribute parsing; avoid regex post-processing where possible. <br>- Add unit tests for `data:` image edge cases, relative URLs, and malicious payloads. <br>- Consider CSP guidance and canonicalize/normalize URLs before checking. <br>- Expose a small diagnostic mode to report why an attribute/tag was dropped.</td></tr><tr><td data-label="Logic / Structure"><strong>Tests / verification</strong>       </td><td data-label="Conceptual Notes">- Unit tests: allowed tag/attr preservation, `allow_tables` behavior, `is_safe_url` cases, `IMG_DATA_MIME` strictness, script-neutralization, linkify regressions. <br>- Fuzz HTML inputs to ensure no XSS leakage.</td></tr></tbody></table></div><div class='row-count'></div></div>
</div><div class="tv-fragment" id="frag-5">
<div class="table-wrapper" data-table-id="table-5"><h3 id="table-5">Table 5</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>                    </td><td data-label="Conceptual Notes">Project-level asset helpers used by `core_assets.prepare_assets`. Provide on-disk assets when available or conservative fallbacks when missing.</td></tr><tr><td data-label="Logic / Structure"><strong>Key functions & constants</strong>  </td><td data-label="Conceptual Notes">`_EMBED_STYLE` (fallback CSS), `_EMBED_SCRIPT` (fallback JS), `copy_assets(output_dir: str) -> None`, `write_overrides_css(output_dir: str, left_width: float, right_width: float) -> str`.</td></tr><tr><td data-label="Logic / Structure"><strong>Control / data flow</strong>        </td><td data-label="Conceptual Notes">`core_assets.prepare_assets` may call `copy_assets` to populate `output_dir/assets`. If project `assets` dir exists two levels up it is copied; otherwise minimal fallback files are written. `write_overrides_css` computes CSS using width params, writes `overrides.css` and returns the string.</td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & behavior</strong>   </td><td data-label="Conceptual Notes">Functions are intentionally tolerant: they do not raise on individual file copy/write failures. They attempt best-effort writes and log failures. `write_overrides_css` will still return CSS even if disk write fails.</td></tr><tr><td data-label="Logic / Structure"><strong>Side effects & guarantees</strong>  </td><td data-label="Conceptual Notes">Preserves file names and content verbatim when copying. Writes conservative placeholders when source missing. `write_overrides_css` injects left/right width into CSS. Functions may silently succeed with partial content on permission or disk errors.</td></tr><tr><td data-label="Logic / Structure"><strong>Tests / verification</strong>       </td><td data-label="Conceptual Notes">Unit test copy from sample project `assets` dir and verify files present and non-empty. Test missing source path results in fallback files with `_EMBED_STYLE/_EMBED_SCRIPT`. Test `write_overrides_css` returns expected CSS and actually writes `overrides.css` when permitted.</td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong> </td><td data-label="Conceptual Notes">- Make writes atomic (use `io_utils._atomic_stream_write`) to avoid partial files.<br>- Return status object `{written:bool, files:[..], errors:[..]}` instead of swallowing failures.<br>- Add explicit manifest of expected asset filenames for easier testing.</td></tr><tr><td data-label="Logic / Structure"><strong>Public contract</strong>            </td><td data-label="Conceptual Notes">`copy_assets` populates `<output_dir>/assets`. `write_overrides_css` writes and returns CSS string. Consumers (core_assets/core_renderer) should assume best-effort semantics and check for file existence if needed.</td></tr></tbody></table></div><div class='row-count'></div></div>
</div><div class="tv-fragment" id="frag-6">
<div class="table-wrapper" data-table-id="table-6"><h3 id="table-6">Table 6</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>                    </td><td data-label="Conceptual Notes">Central typed config and small aliases used across the render package. Provides a single `RenderConfig` dataclass carrying runtime options.</td></tr><tr><td data-label="Logic / Structure"><strong>Key exports / types</strong>        </td><td data-label="Conceptual Notes">`RenderResult = Dict[str, Any]`<br>`TableLike = Any`<br>`RenderConfig` dataclass.</td></tr><tr><td data-label="Logic / Structure"><strong>RenderConfig fields</strong>        </td><td data-label="Conceptual Notes">- `log_level`<br>- `assets_dir`<br>- `embed_assets`<br>- `bundle_assets`<br>- `cache_size`<br>- `table_render_timeout_ms`<br>- `split_threshold`<br>- `max_workers`<br>- `table_row_limit`<br>- `cancel_event`<br>- `progress_callback`<br>- `gzip_out`<br>Defaults provided for sensible local runs.</td></tr><tr><td data-label="Logic / Structure"><strong>Utility methods</strong>            </td><td data-label="Conceptual Notes">`resolved_assets_dir(out_dir: Path) -> Path` resolves `assets_dir` fallback to `<out_dir>/assets`.</td></tr><tr><td data-label="Logic / Structure"><strong>Control / data flow</strong>        </td><td data-label="Conceptual Notes">`RenderConfig` is created by CLI or callers and passed into `core_renderer`, `core_fragments`, and asset helpers to coordinate behavior (workers, embedding, timeouts, cancellation, progress callbacks).</td></tr><tr><td data-label="Logic / Structure"><strong>Concurrency / cancelation</strong>  </td><td data-label="Conceptual Notes">- `cancel_event: Optional[Event]` allows cooperative cancellation across threads.<br>- `max_workers` coordinates concurrency limits.</td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & edge cases</strong> </td><td data-label="Conceptual Notes">- Non-path `assets_dir` types tolerated but should be Path/str.<br>- `progress_callback` may be None; implementations must check.<br>- `cancel_event` must be a `threading.Event` or None; otherwise misuse may silently fail.</td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong> </td><td data-label="Conceptual Notes">- Add type hints for `progress_callback` signature.<br>- Validate `max_workers` and `table_render_timeout_ms` in `<strong>post_init</strong>` to fail fast.<br>- Provide `from_env()` and `from_cli(args)` constructors for consistent creation.</td></tr><tr><td data-label="Logic / Structure"><strong>Tests / verification</strong>       </td><td data-label="Conceptual Notes">- Unit tests for `resolved_assets_dir`.<br>- Behavior with `assets_dir` as str/Path/None.<br>- Cancellation propagation using a stub `cancel_event`.</td></tr></tbody></table></div><div class='row-count'></div></div>
</div><div class="tv-fragment" id="frag-7">
<div class="table-wrapper" data-table-id="table-7"><h3 id="table-7">Table 7</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>              </td><td data-label="Conceptual Notes">Minimal CLI entrypoint to render a page from tables. Uses argparse and calls render_page.</td></tr><tr><td data-label="Logic / Structure"><strong>Key actions</strong>          </td><td data-label="Conceptual Notes">Parse `input` and `output` args. <br>Build a `RenderConfig`. <br>Call `render_page(all_tables, output, default_md, config)`.</td></tr><tr><td data-label="Logic / Structure"><strong>Imports</strong>              </td><td data-label="Conceptual Notes">`from .core import render_page` (likely wrong). <br>`from .types import RenderConfig`. <br>`from .markdown import markdown_to_html as default_md`.</td></tr><tr><td data-label="Logic / Structure"><strong>Data/control flow</strong>    </td><td data-label="Conceptual Notes">`all_tables` is an empty list placeholder. <br>CLI constructs `RenderConfig` and forwards it to renderer.</td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes / bugs</strong> </td><td data-label="Conceptual Notes">1. `from .core import render_page` â€” no `core.py` in package. Should import from package API (`from .core_compat import render_page` or `from . import render_page` if `<strong>init</strong>.py` re-exports). <br>2. `RenderConfig(dark_mode=args.dark)` â€” `RenderConfig` has no `dark_mode` field. Raises `TypeError`.</td></tr><tr><td data-label="Logic / Structure"><strong>Minimal fixes</strong>        </td><td data-label="Conceptual Notes">Change import to `from .core_compat import render_page` or `from . import render_page`. <br>Use valid config field (e.g., set `embed_assets` or add `dark_mode` to `RenderConfig`). <br>Or construct config via `RenderConfig()` then set a `dark_mode` attribute explicitly if you prefer dynamic attributes.</td></tr><tr><td data-label="Logic / Structure"><strong>Notes</strong>                </td><td data-label="Conceptual Notes">CLI intentionally renders an empty page when no table input is provided. <br>Extend CLI to accept CSV/JSON/DSV inputs or pickled DataFrames if needed.</td></tr></tbody></table></div><div class='row-count'></div></div>
</div><div class="tv-fragment" id="frag-8">
<div class="table-wrapper" data-table-id="table-8"><h3 id="table-8">Table 8</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>                    </td><td data-label="Conceptual Notes">Package-level re-exports. Provide stable public API surface for `render` package.</td></tr><tr><td data-label="Logic / Structure"><strong>Code</strong>                       </td><td data-label="Conceptual Notes">`from .core_compat import render_html, render_table, render_page`<br>`<strong>all</strong> = ["render_html", "render_table", "render_page"]`</td></tr><tr><td data-label="Logic / Structure"><strong>Control / data flow</strong>        </td><td data-label="Conceptual Notes">Consumers can `from render import render_html` or `from render import render_page`.<br>`core_compat` acts as the canonical compatibility shim.</td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes</strong>              </td><td data-label="Conceptual Notes">If `core_compat` import fails, the package import fails.<br>Re-exports must match names available in `core_compat`.</td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong> </td><td data-label="Conceptual Notes">1. Add `<strong>version</strong>` passthrough.<br>2. Add `get_import_diagnostics()` passthrough for easier debugging.</td></tr><tr><td data-label="Logic / Structure"><strong>Tests / verification</strong>       </td><td data-label="Conceptual Notes">1. `import render; assert hasattr(render, "render_html")`.<br>2. CI should validate re-exports across packaging scenarios.</td></tr></tbody></table></div><div class='row-count'></div></div>
</div><div class="tv-fragment" id="frag-9">
<div class="table-wrapper" data-table-id="table-9"><h3 id="table-9">Table 9</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>                    </td><td data-label="Conceptual Notes">Minimal, conservative markdownâ†’HTML converter focused on safe inline rendering for table cells and preserving pipe-tables. Exports `markdown_to_html` and `get_markdown_renderer`.</td></tr><tr><td data-label="Logic / Structure"><strong>Sanitization</strong>               </td><td data-label="Conceptual Notes">`_sanitize_html` strips dangerous tags and event attributes, allowlists simple tags/attrs and escapes the rest. Intended as final safety layer for markdown output.</td></tr><tr><td data-label="Logic / Structure"><strong>Code stashing</strong>              </td><td data-label="Conceptual Notes">`_stash_code` captures fenced blocks and inline code into placeholders; `_restore_code_placeholders` reinserts them as escaped `<pre><code>` and `<code>`. Handles variable fence tokens.</td></tr><tr><td data-label="Logic / Structure"><strong>Underscore handling</strong>        </td><td data-label="Conceptual Notes">`_preprocess_underscores_outside_placeholders` protects underscores inside words and escaped underscores so markdown processors do not turn them into emphasis. Placeholders are preserved.</td></tr><tr><td data-label="Logic / Structure"><strong>Inline-only cell rendering</strong> </td><td data-label="Conceptual Notes">`_render_cell_inline` renders cell content with inline-only rules: stash inline code, handle emphasis `*` only, protect placeholders, html-escape remaining text, run `_sanitize_html`. Returns safe fragment for `<td>/<th>`.</td></tr><tr><td data-label="Logic / Structure"><strong>Table detection & stashing</strong> </td><td data-label="Conceptual Notes">`_stash_tables` finds contiguous pipe-table blocks outside fenced code, replaces with `@@TABLEn@@` placeholders. `_render_table_block` converts pipe-block to `<table><thead>...<tbody>...`. Placeholders are re-inserted later.</td></tr><tr><td data-label="Logic / Structure"><strong>Fallback markdown path</strong>     </td><td data-label="Conceptual Notes">`_fallback_markdown_to_html` implements emphasis, restores code and table placeholders, wraps non-pre/table blocks in `<p>`. Uses `_sanitize_html` at end.</td></tr><tr><td data-label="Logic / Structure"><strong>python-markdown path</strong>       </td><td data-label="Conceptual Notes">`markdown_to_html` tries `markdown` package first: stash code/tables, preprocess underscores, call `markdown.markdown` with conservative extensions, restore placeholders, sanitize. Falls back to `_fallback_markdown_to_html` if unavailable or fails.</td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & edge cases</strong> </td><td data-label="Conceptual Notes">- Table detection conservative; may miss malformed tables or treat adjacent pipes incorrectly. <br>- `_sanitize_html` is permissive relative to `sanitize.py` but removes dangerous tags. <br>- Regex-based HTML handling can be brittle on complex markup.</td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong> </td><td data-label="Conceptual Notes">- Rely on `sanitize.py` central sanitizer for consistency. <br>- Add unit tests for nested backticks, escaped pipes, mixed fence tokens, and inline-only rendering in table cells. <br>- Consider using an HTML parser for `_sanitize_html` instead of regex.</td></tr><tr><td data-label="Logic / Structure"><strong>Public contract</strong>            </td><td data-label="Conceptual Notes">`markdown_to_html(md_text)` returns sanitized HTML string suitable for render pipeline. `get_markdown_renderer()` returns callable for `convert.py` and other callers.</td></tr></tbody></table></div><div class='row-count'></div></div>
</div><script src="assets/xlsx.full.min.js?v=1759437780" defer></script>
<script src="assets/inlineblock_guard.js?v=1759437780" defer></script>
<script src="assets/script.js?v=1759437780" defer></script>
<script src="assets/worker.js?v=1759437780" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
</script>

<script>
  (function(){
    function startGuard() {
      try {
        if (window.inlineBlockGuard) {
          window.inlineBlockGuard({ root: document.body, maxRetries: 3, retryDelay: 100, observeDynamic: true, telemetry: function(r){ try{ console.info('inlineBlockGuard report', r); }catch(e){} }});
        } else if (window.inlineBlockObserver) {
          try { window.inlineBlockObserver(document.body); } catch(e) {}
        }
      } catch(e) {}
    }
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', startGuard);
    else startGuard();
  })();
</script>

</div>
</body>
</html>