<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761618820">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8018_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Inputs (what to split / consume)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Inputs (what to split / consume)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Code changes &amp; rationale (what each split/module must contain)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Code changes & rationale (what each split/module must contain)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Inputs (what to split / consume)"> 1. Boot / idempotent guard (<code>__tv_revised_script_installed</code>, <code>__tv_sort_delegated_attached</code>, etc.)                                              </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> Extract into <code>bootstrap.js</code>. Ensure single-run guards and minimal console diag. Rationale: prevents double-applying handlers when file reloaded or both TV2.1 and PTT bundles exist. Keep extremely small and synchronous.                                                                              </td></tr><tr><td data-label="Inputs (what to split / consume)"> 2. Public config & API (<code>window.tvConfig</code>, <code>setTvSearchConfig</code>)                                                                                 </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> New <code>config.js</code> module. Expose <code>getConfig()</code> and <code>setConfig(cfg)</code> and apply defaults. Rationale: centralizes runtime tuning and makes split testing safe. Lightweight and safe to run early.                                                                                                            </td></tr><tr><td data-label="Inputs (what to split / consume)"> 3. Base-path detection (<code>detectScriptBase</code>, <code>TV_BASE</code>, <code>ensureIndexAndWorkerAttrs</code>)                                                             </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>path-utils.js</code>. Return base, build candidate URLs, and set <code>window.__tv_base</code>, <code>tvIndexUrl</code>, <code>tvWorkerUrl</code>. Rationale: used by extra loader and asset lookups. Must run before extra loader.                                                                                                           </td></tr><tr><td data-label="Inputs (what to split / consume)"> 4. Extra loader (<code>createScriptElement</code>, <code>loadExtraSequentially</code>, <code>startExtraLoader</code>)                                                            </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>extra-loader.js</code>. Sequential load strategy with idempotent attach flag. Rationale: isolated network-side logic, easier to test and to stub in unit tests.                                                                                                                                              </td></tr><tr><td data-label="Inputs (what to split / consume)"> 5. Early-hide CSS injection for MD export                                                                                                       </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>ui-earlyhide.js</code> or small CSS-inject module. Rationale: reduce flicker; safe to run immediately. Keep CSS string isolated and removable for tests.                                                                                                                                                     </td></tr><tr><td data-label="Inputs (what to split / consume)"> 6. Small cross-cutting helpers (<code>safe</code>, <code>isString</code>, <code>joinUrl</code>, <code>once</code>, <code>safeSetHTML</code>)                                                           </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>helpers.js</code>. All small pure helpers and <code>safeSetHTML</code> fallback. Rationale: shared by many modules; avoids duplication across splits.                                                                                                                                                                   </td></tr><tr><td data-label="Inputs (what to split / consume)"> 7. DOM utilities (<code>_ensureElement</code>, <code>getSearchEl</code>, <code>getTableFromButton</code>, <code>safeGetTBody</code>)                                                        </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>dom-utils.js</code>. Simple selectors, safe wrappers. Rationale: centralize selector lists and allow future changes in one place.                                                                                                                                                                            </td></tr><tr><td data-label="Inputs (what to split / consume)"> 8. Toast system (<code>showToast</code>, queue, <code>_ensureToastContainer</code>)                                                                                   </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>toast.js</code>. Encapsulate queue, styles, ARIA. Rationale: independent UI component that many actions call. Keeps DOM clutter controlled and testable.                                                                                                                                                     </td></tr><tr><td data-label="Inputs (what to split / consume)"> 9. Copy modal (<code>showCopyModal</code>)                                                                                                                 </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>copy-modal.js</code>. Self-contained DOM overlay and copy/download flows. Rationale: standalone UX element used by copy fallback.                                                                                                                                                                            </td></tr><tr><td data-label="Inputs (what to split / consume)"> 10. Clipboard & download helpers (<code>copyToClipboard</code>, <code>tryLegacyCopy</code>, <code>downloadBlob</code>, <code>sanitizeFileName</code>)                                       </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>io-utils.js</code>. Rationale: centralize browser capability detection and fallback behavior for copy/download.                                                                                                                                                                                              </td></tr><tr><td data-label="Inputs (what to split / consume)"> 11. Search & highlight (<code>normalizeForSearchLocal</code>, <code>buildNormalizedMapForCell</code>, <code>highlightMatches</code>, <code>clearHighlights</code>, <code>searchTable</code>, debounce) </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>search-highlight.js</code>. Rationale: complex text-normalization and tree-walking logic deserves its own file. Expose <code>searchTable()</code> and <code>clearHighlights()</code> API. Keep <code>debounce</code> here or in helpers.                                                                                                      </td></tr><tr><td data-label="Inputs (what to split / consume)"> 12. Row UID snapshot & sorting state (<code>_ensureRowUidsAndSnapshot</code>, <code>originalRowOrders</code>, <code>_tv_row_uid_counter</code>, <code>sortStates</code>)                    </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>row-state.js</code>. Rationale: persistent table-state management; required by sort/reset flows. Must be loaded before sort/reorder module.                                                                                                                                                                  </td></tr><tr><td data-label="Inputs (what to split / consume)"> 13. Sorting & reordering (<code>sortTableByColumn</code>, <code>updateHeaderSortUI</code>, delegated sort handler wiring)                                             </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>sort-reorder.js</code>. Rationale: implements stable reorder by appending existing nodes to preserve IDs. Use <code>row-state</code> and <code>dom-utils</code>. Expose <code>headerSortButtonClicked</code>. Keep delegated listener registration idempotent in bootstrap.                                                                   </td></tr><tr><td data-label="Inputs (what to split / consume)"> 14. Reorder / reset (<code>resetAllTables</code>, per-table reset logic<code>)                                                                                  | </code>reset.js<code>. Rationale: uses </code>row-state<code> snapshot to restore original order. Contains updateHeaderSortUI calls and state resets.                                                                                                                                                                           15. Row counts and UI labels (</code>updateRowCounts<code>, row-count DOM updates</code>)                                                                        </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>counts.js</code>. Rationale: small module invoked after search/sort/reveal to avoid repeated DOM scans. Export one function.                                                                                                                                                                                 </td></tr><tr><td data-label="Inputs (what to split / consume)"> 16. Table TOC builder (<code>buildSingleTableToc</code>, minimalTopicFallback<code>, patch bootstrap)                                                           | </code>toc.js<code>. Rationale: assigns stable row ids and builds single-table TOC. Must run early so snapshots keep stable UIDs. Export </code>buildSingleTableToc<code> and </code>triggerTopicFallback<code>.                                                                                                                           17. Mobile/control optimizations (</code>optimizeTableControls<code>, media query hookup</code>)                                                                 </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>controls-opt.js</code>. Rationale: viewport-specific styling adjustments and copy-buttons grouping. Runs on resize / mql events. Keep debounced.                                                                                                                                                             </td></tr><tr><td data-label="Inputs (what to split / consume)"> 18. Per-wrapper handlers attach/management (<code>attachPerWrapperHandlers</code>, idempotent mark via <code>data-tvHandlerAttached</code>)                           </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>handlers.js</code>. Rationale: central place to attach per-button handlers. Reveal flow calls this after buttons unhidden. Avoid double-bind.                                                                                                                                                                </td></tr><tr><td data-label="Inputs (what to split / consume)"> 19. Hide-only functions (<code>hideExportMarkdownOption</code>, <code>hideResetAllTablesOption</code>)                                                                </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>hide-ui.js</code>. Rationale: purely declarative DOM hiding. Keep as opt-in utilities that run on initial load and as scheduled retries.                                                                                                                                                                     </td></tr><tr><td data-label="Inputs (what to split / consume)"> 20. Export helpers — CSV/Markdown/JSON/XLSX/PDF (<code>tableToMarkdownLines</code>, <code>formatCellForMarkdown</code>, export*<code>)                                     | </code>exporters/<code> folder split into </code>export-csv.js<code>, </code>export-json.js<code>, </code>export-md.js<code>, </code>export-pdf.js<code>, </code>export-xlsx.js<code>. Rationale: XLSX builder is large and must be isolated. Exporters call </code>getTableFromButton<code>, </code>downloadBlob<code>. Prefer to prefer SheetJS path then embedded builder then TSV fallback.   21. Embedded XLSX builder (CRC32, ZIP builder, XML parts, </code>__ptt_buildXlsxBlob<code>)                                                                | </code>exporters/export-xlsx-embedded.js<code>. Rationale: substantial binary logic. Isolate to avoid forcing load when not needed. Make it conditionally loaded by </code>export-xlsx.js<code> (dynamic import).                                                                                                               22. Embedded XLSX loader shim for SheetJS fallback (</code>assets/xlsx.full.min.js<code> reference)                                                        | </code>exporters/export-xlsx.js<code> dynamic logic. Rationale: try global </code>XLSX<code> first, else call embedded builder. Keep no global side effects.                                                                                                                                                                    23. PDF export (</code>exportTablePDF<code>)                                                                                                               | </code>export-pdf.js<code>. Rationale: small but deals with </code>window.open<code> and print. Isolate for testing.                                                                                                                                                                                                            24. Adopted PTT behaviors (Fetch wrappers, </code>_fetchWithRetries<code>, </code>apiPost<code>, </code>apiRender<code>, </code>apiConvert<code>, </code>apiSave<code>)                                | </code>ptt-api.js<code>. Rationale: server interactions. Keep network config and retries local. Expose </code>apiRender<code>, </code>apiConvert<code>, </code>apiSave<code>.                                                                                                                                                                         25. PTT flows: </code>doRender<code>, </code>doConvert<code>, </code>doSave<code>, </code>_wireAdoptedButtons<code>, </code>_fetchWithRetries<code> integration                                        | </code>ptt-actions.js<code>. Rationale: high-level flows that call server APIs, reveal buttons and call </code>safeSetHTML<code>. Must orchestrate </code>markButtonsHiddenForAllWrappers<code> and </code>revealButtonsForRenderedTables<code>.                                                                                                      26. Button hide/reveal (</code>markButtonsHiddenForAllWrappers<code>, </code>revealButtonsForRenderedTables<code>, TV_HIDE_UNTIL_CONVERT_CLASS</code>)                      </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"> <code>reveal-buttons.js</code>. Rationale: controls initial invisible state and idempotent reveal after Convert/Render. Expose <code>markHidden()</code> and <code>reveal()</code>. Important to run before handlers attach to avoid double-bind.                                                                                        </td></tr><tr><td data-label="Inputs (what to split / consume)"> 27. Adopted UI top-level wiring (<code>_wireAdoptedButtons</code>, top-level button wiring idempotent flags, removal of Hide Paste Box<code>)                   | </code>ptt-wiring.js<code>. Rationale: wires header-level actions to </code>doConvert<code>, </code>doRender<code>, </code>doSave<code>, </code>resetAll<code>. Should run after DOM ready but before other per-wrapper handlers if server markup already revealed.                                                                                              28. Delegated event listeners (sort delegation, TOC delegation, keydown handler for &quot;/&quot; and Escape)                                             | </code>delegation.js<code>. Rationale: single global delegated listeners kept idempotent via window flags. Must be present once.                                                                                                                                                                                     29. PasteToTable router (</code>window.PasteToTable.routeHtmlToAreas<code>)                                                                                | </code>router.js<code>. Rationale: page-provided hook used by </code>safeSetHTML<code>. Keep small and testable.                                                                                                                                                                                                                30. Diagnostics/logging &amp; small final export (</code>console.info<code> TV_BASE/index/worker)                                                              | </code>diag.js`. Rationale: centralized low-impact logging. Allow a config flag to mute.                                                                                                                                                                                                                      </td><td data-label="Code changes &amp; rationale (what each split/module must contain)"></td></tr></tbody></table></div><div class="row-count">Rows: 19</div></div><div class="table-caption" id="Table2" data-table="Book_8018_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Inputs (what to split / consume / inspect)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Inputs (what to split / consume / inspect)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Code changes &amp; rationale (what to do, why, and constraints)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Code changes & rationale (what to do, why, and constraints)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Inputs (what to split / consume / inspect)"> 1. <code>assets/script.js</code> (current PTT merged script)                 </td><td data-label="Code changes &amp; rationale (what to do, why, and constraints)"> Single-file target for the fix. Keep one-file change rule. Implement idempotent guards and remove duplicate global listener attachments. Preserve public API (<code>window.PasteToTable</code>, <code>window.doConvert</code>, <code>window.doRender</code>, etc.). Rationale: minimal-risk patching and compatibility.                                                                                                                                                    </td></tr><tr><td data-label="Inputs (what to split / consume / inspect)"> 2. TV2.1 reference behavior (sorting, export, TOC, highlight)     </td><td data-label="Code changes &amp; rationale (what to do, why, and constraints)"> Align sort UI and behavior to TV2.1: single delegated sort handler, <code>sort-state-*</code> classes, <code>aria-sort</code> updates, and stable row UID reorder (move nodes, do not clone). Rationale: behavioral parity and stable DOM identity.                                                                                                                                                                                                             </td></tr><tr><td data-label="Inputs (what to split / consume / inspect)"> 3. index.html markup and selectors                                </td><td data-label="Code changes &amp; rationale (what to do, why, and constraints)"> Use existing selectors present in <code>index.html</code>: <code>#paste</code>, <code>.table-wrapper</code>, <code>.table-container table</code>, <code>.copy-buttons</code>, header buttons (<code>#convertBtn</code>, <code>#renderBtn</code>, <code>#exportAllBtn</code>, <code>#saveBtn</code>), <code>#tocBar</code>, and <code>#search</code>. Rationale: keep compatibility with templates; do not change HTML.                                                                                                                                             </td></tr><tr><td data-label="Inputs (what to split / consume / inspect)"> 4. XLSX export logic (SheetJS, embedded builder, TSV fallback)    </td><td data-label="Code changes &amp; rationale (what to do, why, and constraints)"> Fix flow order: prefer global <code>XLSX</code> API if present; if not, use embedded builder that constructs correct <code>[Content_Types].xml</code>, <code>xl/workbook.xml</code>, <code>xl/worksheets/sheet1.xml</code>, <code>xl/styles.xml</code>, and ZIP central dir (STORE method). Ensure <code>aoa</code> normalization to fixed column width. Ensure binary write uses ArrayBuffer/Uint8Array to Blob properly. Rationale: produce Excel-readable .xlsx reliably without requiring external lib. </td></tr><tr><td data-label="Inputs (what to split / consume / inspect)"> 5. Event binding duplication (multiple scripts loaded / re-run)   </td><td data-label="Code changes &amp; rationale (what to do, why, and constraints)"> Add and check idempotent flags on <code>window</code> (<code>__tv_revised_script_installed</code>, <code>__tv_sort_delegated_attached</code>, <code>__tv_toc_delegated_attached</code>) and per-element <code>data-tvHandlerAttached</code>. Remove inline double-bind risk by not reattaching handlers when flags present. Rationale: avoid duplicate handler execution and memory leaks.                                                                                                       </td></tr><tr><td data-label="Inputs (what to split / consume / inspect)"> 6. Per-wrapper handlers and reveal flow (PTT: hide until Convert) </td><td data-label="Code changes &amp; rationale (what to do, why, and constraints)"> Ensure buttons are initially hidden via injected <code>.tv-hidden-before-convert</code> class and revealed only after successful <code>doConvert</code>/<code>doRender</code>. When reveal runs, attach only then <code>attachPerWrapperHandlers()</code> idempotently. Rationale: enforce appear-after-convert behavior and avoid double-bind.                                                                                                                                       </td></tr><tr><td data-label="Inputs (what to split / consume / inspect)"> 7. Delegated listeners (sort, TOC, global keydown)                </td><td data-label="Code changes &amp; rationale (what to do, why, and constraints)"> Use one delegated <code>document.addEventListener(&#x27;click&#x27;, ...)</code> for sort and one for TOC. Use window flags so delegation attaches once. Keydown for "/" and "Escape" attached once. Rationale: fewer listeners, lower memory, correct priority.                                                                                                                                                                                               </td></tr><tr><td data-label="Inputs (what to split / consume / inspect)"> 8. Copy/Clipboard (<code>copyToClipboard</code>, fallback<code>)                  | Use </code>navigator.clipboard.writeText<code> when available with </code>tryLegacyCopy<code> fallback using a readonly textarea. Ensure asynchronous success/fail flows show toast or copy modal. Do not rely on </code>document.execCommand<code> only. Rationale: robust clipboard across browsers.                                                                                                                                                                       9. Download helpers (</code>downloadBlob<code>, </code>sanitizeFileName<code>)          | Ensure URL.revokeObjectURL after use. Sanitize filenames against invalid characters. Rationale: consistent file downloads and avoid resource leaks.                                                                                                                                                                                                                                                                                         10. Toast &amp; copy modal UI                                         | Keep single toast container and queue. Use small accessible ARIA attributes. Rationale: user feedback consistent and non-blocking.                                                                                                                                                                                                                                                                                                          11. Search &amp; highlight (unicode safe)                             | Keep </code>normalize('NFD')<code>, remove diacritics, handle surrogate pairs and emoji safely. Build normalized map to correlate text nodes to normalized positions and insert </code><mark><code> ranges only on matched nodes. Keep </code>c.dataset.origHtml<code> snapshots for safe restore. Rationale: accurate highlighting without breaking markup.                                                                                                                 12. Row UID snapshot &amp; reset                                      | On initial DOM stable point run </code>_ensureRowUidsAndSnapshot(table, idx)<code> to assign </code>data-tv-uid<code> and store </code>originalRowOrders[idx]<code>. Reset uses this snapshot to reorder by appending nodes. Rationale: reset restores original order and preserves nodes.                                                                                                                                                                                   13. Sorting algorithm                                             | Numeric-aware sort (parseFloat after removing commas/spaces). Cycle states: 0→1 (asc)→2 (desc)→0 (original). On reset use </code>originalRowOrders<code>. Update header UI and </code>aria-sort<code>. Rationale: match TV2.1 and accessible sorting.                                                                                                                                                                                                             14. Optimize controls for mobile                                  | Use </code>matchMedia('(max-width:600px)')<code> and debounce resizing. Group copy buttons into </code>.copy-buttons<code> container and apply icon-only sizing for </code>.icon-only<code> class on mobile. Rationale: preserve compact mobile UX.                                                                                                                                                                                                                          15. Toggle/collapse behavior                                      | </code>toggleTable(btn)<code> toggles </code>.table-collapsed<code> class on wrapper and updates button text. </code>toggleAllTables()<code> toggles all wrappers. Ensure persisted state only via localStorage if originally supported (respect existing </code>uiMode<code> style behavior). Rationale: parity with TV2.1.                                                                                                                                                            16. Export CSV/JSON/Markdown/PDF                                  | Keep current logic but harden: use </code>thead<code> when available for JSON headers, and use proper quoting/encoding for CSV (</code>\uFEFF<code> prefix). For PDF, open new window and call </code>print()<code> after writing doc; handle blocked popups gracefully. Rationale: reliable exports.                                                                                                                                                                        17. Embedded VBA/Styles omissions                                 | Keep minimal styles in </code>styles.xml<code> (no advanced number formats). Rationale: produce simple but widely compatible .xlsx files without Excel-specific bells.                                                                                                                                                                                                                                                                                 18. Extra loader and base detection                               | Use robust </code>detectScriptBase()<code> and </code>loadExtraSequentially()<code> to attempt </code>extra.js<code> candidates. Set </code>window.__tv_base<code>. Rationale: preserve asset resolution in varying hosting configurations.                                                                                                                                                                                                                                             19. PTT server flows (</code>apiRender<code>, </code>apiConvert<code>, </code>apiSave<code>)       | Keep </code>_fetchWithRetries<code>, timeout and backoff. On successful server </code>html<code> response, call </code>safeSetHTML(container, payload.html)<code>. After server-render/convert call </code>revealButtonsForRenderedTables()<code>. Rationale: integrate server and client flows safely.                                                                                                                                                                                 20. Diagnostics &amp; idempotence                                     | Console.info for </code>tv:base<code>, </code>tv:index-url<code>, and </code>tv:worker-url<code>. Keep guard to avoid repeated logging. Rationale: aid debugging without spam.                                                                                                                                                                                                                                                                                               21. Tests &amp; verification checklist                                | Add smoke test steps for each verification point (see your 15-point checklist) and ensure logs show no uncaught exceptions in normal flows. Rationale: acceptance criteria before committing.                                                                                                                                                                                                                                               22. Rollback snapshot &amp; patch                                     | When patching </code>assets/script.js<code> create </code>assets/script.js.bak.timestamp<code> and produce a diff/patch file </code>assets/script.js.patch<code>. Provide rollback commands. Rationale: single-file rollback path.                                                                                                                                                                                                                                           23. Changelog &amp; deliverables                                      | Include brief changelog header inside the revised script and external </code>CHANGELOG.md<code> entry per release guidelines. Rationale: traceability.                                                                                                                                                                                                                                                                                                 24. Performance &amp; memory                                          | Debounce expensive operations (search, resize). Avoid per-row closures that capture large scopes. Rationale: prevent leaks and keep page responsive for large tables.                                                                                                                                                                                                                                                                       25. Security &amp; CSP                                                | Avoid </code>eval<code>/new Function. Use safe DOM APIs. Rationale: compatibility with strict CSP hosts.                                                                                                                                                                                                                                                                                                                                               26. Non-editable assets rule                                      | Do not modify </code>assets/style.css<code> or locked render folder. Only change </code>assets/script.js<code>. Rationale: constraint compliance.                                                                                                                                                                                                                                                                                                                 27. Accessibility                                                 | Keep aria attributes for sort and toast. Ensure keyboard &quot;/&quot; focuses search and Escape triggers </code>backToTop()<code>. Rationale: accessible UX.                                                                                                                                                                                                                                                                                                    28. Edge cases: no table, empty table, invalid HTML               | Export functions should show toast warnings and not throw. Rationale: resilience on malformed input.                                                                                                                                                                                                                                                                                                                                        29. Concurrency &amp; reentrancy                                      | Use inflight flags (</code>_renderInFlight<code>) to block duplicate Render/Convert calls. Rationale: avoid race conditions and duplicate server calls.                                                                                                                                                                                                                                                                                                30. Final commit gating                                           | Only produce revised </code>assets/script.js` after automated smoke tests and manual checkpoints pass and after your approval. Provide patch and rollback. Rationale: one-file-at-a-time safety.                                                                                                                                                                                                                                                </td><td data-label="Code changes &amp; rationale (what to do, why, and constraints)"></td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table3" data-table="Book_8018_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Functionality"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Functionality</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Target file"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Target file</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Functionality"> Initialization, event wiring            </td><td data-label="Target file"> <code>core_init.js</code>     </td></tr><tr><td data-label="Functionality"> Table operations (selection, traversal) </td><td data-label="Target file"> <code>table_ops.js</code>     </td></tr><tr><td data-label="Functionality"> XLSX export                             </td><td data-label="Target file"> <code>export_xlsx.js</code>   </td></tr><tr><td data-label="Functionality"> CSV export                              </td><td data-label="Target file"> <code>export_csv.js</code>    </td></tr><tr><td data-label="Functionality"> TOC and collapse toggle logic           </td><td data-label="Target file"> <code>toc_manager.js</code>   </td></tr><tr><td data-label="Functionality"> Persistence and localStorage            </td><td data-label="Target file"> <code>state_persist.js</code> </td></tr><tr><td data-label="Functionality"> Copy-to-clipboard and UI feedback       </td><td data-label="Target file"> <code>ui_feedback.js</code>   </td></tr><tr><td data-label="Functionality"> Compatibility shims                     </td><td data-label="Target file"> <code>compat.js</code>        </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table4" data-table="Book_8018_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by TV2.1 (reference)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">TV2.1 (reference)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by PTT (current)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PTT (current)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="TV2.1 (reference)"> <strong>1. Top guard / idempotency</strong><br>1. No top-level global guard.<br>2. Script immediately executes inside IIFE.                                                                                                                                                                  </td><td data-label="PTT (current)"> <strong>1. Top guard / idempotency</strong><br>1. Adds <code>if (window.__tv_revised_script_installed) return;</code> and sets <code>window.__tv_revised_script_installed = true</code>.<br>2. Prevents double-apply if file loaded multiple times.<br><strong>Risk/Note:</strong> safe; prevents duplicate initialization.                             </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>2. Public config / API</strong><br>1. <code>defaultConfig = { highlight:true, debounceMs:150, chunkSize:300 }</code>.<br>2. Exposes <code>window.tvConfig</code> and <code>window.setTvSearchConfig</code>.                                                                                                           </td><td data-label="PTT (current)"> <strong>2. Public config / API</strong><br>1. Same defaultConfig values and same <code>setTvSearchConfig</code> with identical guard logic.<br>2. No behavioral difference.                                                                                                                                                     </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>3. Small helpers</strong><br>1. <code>safe(fn)</code>, <code>isString</code>, <code>joinUrl</code>, <code>once</code> present.<br>2. <code>joinUrl</code> resilient to URL building.                                                                                                                                                        </td><td data-label="PTT (current)"> <strong>3. Small helpers</strong><br>1. Same helpers plus <code>safeSetHTML(container, html)</code> added.<br>2. <code>safeSetHTML</code> prefers <code>window.PasteToTable.routeHtmlToAreas</code> then falls back to container or <code>tables-viewer</code>.<br><strong>Risk/Note:</strong> preserves compatibility with index.html router. Desirable change.              </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>4. Detect script base</strong><br>1. <code>detectScriptBase()</code> checks <code>document.currentScript</code> then scans scripts for <code>/assets/script.js</code> or <code>script.js</code>.<br>2. Fallback to <code>location.origin + pathname dir</code>.                                                                             </td><td data-label="PTT (current)"> <strong>4. Detect script base</strong><br>1. Same detection logic present.<br>2. Also sets <code>window.__tv_base = TV_BASE</code>. Functionally identical.                                                                                                                                                                     </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>5. Ensure index/worker attrs</strong><br>1. <code>ensureIndexAndWorkerAttrs(base)</code> sets <code>data-index-url</code> and <code>data-worker-url</code> on body if missing.<br>2. Exposes <code>window.tvIndexUrl</code> and <code>window.tvWorkerUrl</code>.                                                                            </td><td data-label="PTT (current)"> <strong>5. Ensure index/worker attrs</strong><br>1. Same implementation and usage.<br>2. No difference.                                                                                                                                                                                                              </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>6. Extra.js loader</strong><br>1. <code>createScriptElement</code>, <code>loadExtraSequentially</code>, <code>startExtraLoader()</code> with candidate paths array.<br>2. Avoids async race by sequential loading.                                                                                                    </td><td data-label="PTT (current)"> <strong>6. Extra.js loader</strong><br>1. Same sequential loader implementation and candidate list.<br>2. Same DOMContentLoaded attach logic.<br>No difference.                                                                                                                                                      </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>7. Early-hide Export Markdown CSS</strong><br>1. Injects <code>&lt;style data-tv-early-hide-md&gt;</code> with selectors to hide markdown export UI to reduce flicker.<br>2. Immediately runs.                                                                                                        </td><td data-label="PTT (current)"> <strong>7. Early-hide Export Markdown CSS</strong><br>1. PTT retains the same injection.<br>2. No difference.                                                                                                                                                                                                        </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>8. normalizeForSearchLocal & debounce</strong><br>1. <code>normalizeForSearchLocal</code> uses <code>normalize(&#x27;NFD&#x27;)</code> + diacritics strip + Unicode class regex plus fallback.<br>2. <code>debounce(fn, wait)</code> typical timer.                                                                             </td><td data-label="PTT (current)"> <strong>8. normalizeForSearchLocal & debounce</strong><br>1. Identical functions and fallbacks.<br>2. No difference.                                                                                                                                                                                                 </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>9. Clipboard & download helpers</strong><br>1. <code>copyToClipboard</code> uses Clipboard API then <code>tryLegacyCopy</code> with textarea + <code>execCommand</code>.<br>2. <code>sanitizeFileName</code>, <code>downloadBlob</code> implemented.                                                                                        </td><td data-label="PTT (current)"> <strong>9. Clipboard & download helpers</strong><br>1. Same copy & download helpers.<br>2. PTT keeps same behavior.<br>No difference.                                                                                                                                                                                </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>10. Toast system</strong><br>1. <code>_ensureToastContainer</code>, <code>_computeToastDuration</code>, <code>showToast</code>, <code>_processToastQueue</code>, <code>_hideActiveToast</code>, <code>_dismissToastById</code>.<br>2. Inline styling, color mapping for types.                                                                         </td><td data-label="PTT (current)"> <strong>10. Toast system</strong><br>1. Same toast system.<br>2. Minor variation: both scripts identical in logic and styles; PTT copies unchanged.<br>No difference.                                                                                                                                                </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>11. Copy modal</strong><br>1. <code>showCopyModal(text, {title})</code> builds overlay, textarea, select/copy/download buttons.<br>2. Uses <code>copyToClipboard</code>, <code>downloadBlob</code>.                                                                                                                   </td><td data-label="PTT (current)"> <strong>11. Copy modal</strong><br>1. Same implementation.<br>2. PTT removed an inline <code>whiteSpace</code> comment earlier; behavior preserved.<br>No functional change.                                                                                                                                                    </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>12. Utilities: getSearchEl / getTableFromButton</strong><br>1. <code>getSearchEl()</code> attempts <code>#searchBox</code>, <code>#searchInput</code>, <code>#search</code>.<br>2. <code>getTableFromButton(btn)</code> climbs to <code>.table-wrapper</code> or <code>.table-container</code>.                                                                   </td><td data-label="PTT (current)"> <strong>12. Utilities: getSearchEl / getTableFromButton</strong><br>1. Identical utilities.<br>2. PTT includes same selectors.<br>No change.                                                                                                                                                                         </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>13. buildSingleTableToc</strong><br>1. Builds a compact TOC for single <code>.table-wrapper</code>.<br>2. Assigns stable <code>row.id</code> fallback <code>tv-row-N</code> and handles duplicates.<br>3. Adds <code>ul.single-toc-list</code> and anchors scroll smoothly.                                                      </td><td data-label="PTT (current)"> <strong>13. buildSingleTableToc</strong><br>1. Same behavior and API exposure <code>window.buildSingleTableToc</code>.<br>2. PTT calls <code>buildSingleTableToc()</code> similarly during DOMContentLoaded.<br>No difference.                                                                                                             </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>14. Storage: originalRowOrders, UIDs</strong><br>1. <code>originalRowOrders = []</code>, <code>_tv_row_uid_counter = 1</code>, <code>sortStates = []</code>.<br>2. <code>safeGetTBody(table)</code> returns <code>table.tBodies[0]</code>.                                                                                                  </td><td data-label="PTT (current)"> <strong>14. Storage: originalRowOrders, UIDs</strong><br>1. Same variable names and intent.<br>2. <code>_ensureRowUidsAndSnapshot(table, tableIdx)</code> present in both.<br>Implementation identical: sets <code>data-tv-uid = &#x27;tvuid-&#x27; + counter</code> and records order.<br><strong>Risk/Note:</strong> consistent snapshotting across both files. </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>15. updateHeaderSortUI</strong><br>1. Applies <code>sort-state-*</code> classes and updates <code>aria-sort</code>.<br>2. Renders SVG icons for states (0/1/2).                                                                                                                                            </td><td data-label="PTT (current)"> <strong>15. updateHeaderSortUI</strong><br>1. Same implementation.<br>2. No difference noted.                                                                                                                                                                                                                        </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>16. Sorting logic (start)</strong><br>1. <code>sortTableByColumn(tableIdx, colIdx)</code> reads rows from <code>tbody</code>, computes numeric fallback, toggles state 0→1→2→0, sorts, appends existing nodes to <code>tbody</code> to reorder without cloning.<br>2. Restores <code>data.origHtml</code> for cells when needed. </td><td data-label="PTT (current)"> <strong>16. Sorting logic (start)</strong><br>1. Identical algorithm and in-place append approach.<br>2. PTT retains same reset-to-original using <code>originalRowOrders[tableIdx]</code>.<br>No difference in core algorithm.                                                                                                 </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>17. Differences observed so far (summary)</strong><br>1. TV2.1 minimal, focused single-file.<br>2. No <code>__tv_revised_script_installed</code> guard.<br>3. No <code>safeSetHTML</code>.                                                                                                                 </td><td data-label="PTT (current)"> <strong>17. Differences observed so far (summary)</strong><br>1. PTT adds:<br>1) top-level idempotency guard,<br>2) <code>safeSetHTML</code> router-aware insertion,<br>3) minor comments and diagnostics.<br>2. Additions are defensive and compatible.<br>3. No breaking changes in the compared sections.                    </td></tr></tbody></table></div><div class="row-count">Rows: 17</div></div><div class="table-caption" id="Table5" data-table="Book_8018_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by TV2.1 (reference)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">TV2.1 (reference)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by PTT (current)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PTT (current)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="TV2.1 (reference)"> <strong>18. Per-cell original HTML snapshot</strong><br>1. On init, sets <code>c.dataset.origHtml = c.innerHTML</code> for each cell to restore highlights.<br>2. Also set after reorders.                                        </td><td data-label="PTT (current)"> <strong>18. Per-cell original HTML snapshot</strong><br>1. Same behavior.<br>PTT sets <code>dataset.origHtml</code> in same locations.<br>No change.                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>19. formatCellForMarkdown / tableToMarkdownLines</strong><br>1. Escapes pipes, preserves newlines as <code>&lt;br&gt;</code>, builds header + separators.                                                                       </td><td data-label="PTT (current)"> <strong>19. formatCellForMarkdown / tableToMarkdownLines</strong><br>1. Identical implementations.                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>20. Copy / Export functions (plain, markdown, all)</strong><br>1. <code>copyTablePlain</code>, <code>copyTableMarkdown</code>, <code>copyAllTablesPlain</code>, <code>copyAllTablesMarkdown</code> using <code>copyToClipboard</code> and fallback <code>showCopyModal</code>.   </td><td data-label="PTT (current)"> <strong>20. Copy / Export functions</strong><br>1. Same functions preserved.<br>PTT retains same toasts and fallbacks.                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>21. Export helpers (CSV, Markdown, JSON)</strong><br>1. <code>exportTableCSV</code>, <code>exportTableMarkdown</code>, <code>exportTableJSON</code> build strings/blobs then <code>downloadBlob</code>.                                                    </td><td data-label="PTT (current)"> <strong>21. Export helpers (CSV, Markdown, JSON)</strong><br>1. Same.<br>PTT unchanged.                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>22. Export XLSX (TV2.1 path)</strong><br>1. Prefers <code>window.XLSX</code> SheetJS if present.<br>2. Fallback to TSV with <code>.xlsx</code> extension and warn.<br>3. No embedded XLSX builder in TV2.1.                          </td><td data-label="PTT (current)"> <strong>22. Export XLSX (PTT path)</strong><br>1. Adds embedded XLSX builder (<code>__ptt_*</code> helpers) to build valid ZIP/XML workbook if SheetJS unavailable.<br>2. Keeps SheetJS path first, then embedded builder, then TSV fallback.<br>3. Risk: embedded builder increases code size but implements true <code>.xlsx</code>. Good patch.                                                                                                                                                                                           </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>23. XLSX builder details</strong><br>1. Not present.                                                                                                                                                           </td><td data-label="PTT (current)"> <strong>23. XLSX builder details</strong><br>1. Implements UTF-8 encoder, CRC32, ZIP builder (STORE), XML parts: sheet, workbook, rels, content-types, styles.<br>2. Creates Blob and <code>downloadBlob</code>.<br>3. Tested fallback if any step fails.                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>24. PDF export</strong><br>1. Opens print window with HTML wrapper and <code>table.outerHTML</code>.                                                                                                                      </td><td data-label="PTT (current)"> <strong>24. PDF export</strong><br>1. Same behavior.<br>PTT unchanged.                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>25. resetAllTables</strong><br>1. Reorders to original snapshot using <code>originalRowOrders</code>.<br>2. Restores <code>sortStates</code> and header UI.<br>3. Expands wrappers and clears search.                                </td><td data-label="PTT (current)"> <strong>25. resetAllTables</strong><br>1. Same logic.<br>PTT identical.                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>26. hideResetAllTablesOption</strong><br>1. Hides UI elements matching selectors and text needles.                                                                                                             </td><td data-label="PTT (current)"> <strong>26. hideResetAllTablesOption</strong><br>1. Same.<br>PTT identical.                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>27. hideExportMarkdownOption</strong><br>1. Hides markdown export UI (selectors + text needles).<br>2. TV2.1 injected early CSS but still runs JS hide.                                                        </td><td data-label="PTT (current)"> <strong>27. hideExportMarkdownOption</strong><br>1. Same behavior;<br>PTT also injects early-hide CSS.                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>28. clearHighlights, buildNormalizedMapForCell, highlightMatches</strong><br>1. TreeWalker-based normalized map to place <code>&lt;mark&gt;</code> elements.<br>2. Robust handling of surrogate pairs and combining diacritics. </td><td data-label="PTT (current)"> <strong>28. clearHighlights, buildNormalizedMapForCell, highlightMatches</strong><br>1. Identical complex implementation in both files.<br>No change.                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>29. searchTable</strong><br>1. Debounced, hides rows that don’t match, highlights matches, scrolls to first match, updates counts.<br>2. Calls virtualizer refresh if present.                                 </td><td data-label="PTT (current)"> <strong>29. searchTable</strong><br>1. Same behavior.<br>PTT keeps same UI scroll offset and virtualizer hooks.                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>30. optimizeTableControls (mobile)</strong><br>1. Moves copy buttons into <code>.copy-buttons</code>, adds compact sizing for mobile, manipulates inline styles where necessary.                                          </td><td data-label="PTT (current)"> <strong>30. optimizeTableControls (mobile)</strong><br>1. Same.<br>PTT also removes legacy classes, ensures <code>table-toggle-inline</code>, and clears inline overrides.<br>No functional change.                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>31. Debounced resize / matchMedia</strong><br>1. Adds resize and media query listeners for optimizeTableControls.                                                                                              </td><td data-label="PTT (current)"> <strong>31. Debounced resize / matchMedia</strong><br>1. Same.<br>PTT identical.                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>32. Delegated click: sorting & TOC</strong><br>1. TV2.1 attaches global delegated click handlers (twice? single listener in file).                                                                             </td><td data-label="PTT (current)"> <strong>32. Delegated click: sorting & TOC</strong><br>1. PTT adds guards <code>window.__tv_sort_delegated_attached</code> and <code>window.__tv_toc_delegated_attached</code> to avoid duplicate listeners.<br>2. Safer for double-load scenarios. Good.                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>33. backToTop scroll handler</strong><br>1. Listens to window scroll to toggle <code>#backToTop</code> display.                                                                                                           </td><td data-label="PTT (current)"> <strong>33. backToTop scroll handler</strong><br>1. Same.<br>PTT identical.                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>34. Exposed functions</strong><br>1. TV2.1 attaches multiple functions to <code>window</code> (headerSortButtonClicked, toggleTable, copyTablePlain, etc.).                                                               </td><td data-label="PTT (current)"> <strong>34. Exposed functions</strong><br>1. PTT exposes same set.<br>Additionally ensures <code>window.doRender/doConvert/doSave</code> are exposed later.<br>No unexpected leaks.                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>35. Diagnostics logs</strong><br>1. TV2.1 logs base and urls.                                                                                                                                                  </td><td data-label="PTT (current)"> <strong>35. Diagnostics logs</strong><br>1. PTT logs similar startup message plus <code>tv:script loaded (buttons hidden until convert)</code>.<br>Benign.                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>36. Adopted button behaviors (not in TV2.1)</strong><br>1. TV2.1 lacks PasteToTable server-side adaptors.                                                                                                      </td><td data-label="PTT (current)"> <strong>36. Adopted button behaviors</strong><br>1. PTT adopts top-level app behaviors: <code>_ADOPTED_CONFIG</code>, selector helpers <code>_$/ _all</code>, <code>_fetchWithRetries</code>, <code>_parseResponseSafely</code>, <code>apiPost</code>, <code>apiRender</code>, <code>apiConvert</code>, <code>apiSave</code>.<br>2. Adds <code>_toast</code> wrapper.<br>3. Adds <code>doRender</code>, <code>doConvert</code>, <code>doSave</code>, and <code>resetAll</code> wrappers that call server endpoints and fallback to local parsing.<br>4. Behavior integrates server endpoints; non-breaking for Table Viewer pages.                                    </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>37. Button wiring idempotency</strong><br>1. TV2.1 attached per-wrapper handlers during DOMContentLoaded without explicit per-button _attached flags (but uses dataset.tvHandlerAttached in some spots).       </td><td data-label="PTT (current)"> <strong>37. Button wiring idempotency</strong><br>1. PTT centralizes <code>attachPerWrapperHandlers()</code> and top-level <code>_wireAdoptedButtons()</code> which set <code>_pttAdopted</code> flags on buttons to avoid double-bind.<br>2. Also defers attaching per-wrapper handlers until reveal to avoid duplicates. Good.                                                                                                                                                                                                                        </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>38. Hide-until-convert feature (PTT addition)</strong><br>1. Not present in TV2.1.                                                                                                                             </td><td data-label="PTT (current)"> <strong>38. Hide-until-convert</strong><br>1. PTT injects <code>.tv-hidden-before-convert</code> style and functions <code>markButtonsHiddenForAllWrappers()</code> and <code>revealButtonsForRenderedTables()</code> to hide action buttons until Convert/Render runs.<br>2. Buttons are identified and hidden except toggles.<br>3. On reveal it removes class, calls <code>attachPerWrapperHandlers()</code> and <code>optimizeTableControls()</code>.<br>4. Risk: if server-side UI expects buttons visible pre-convert this changes UX intentionally. Matches PTT goals. </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>39. Routing integration</strong><br>1. TV2.1 simply injects HTML using DOM operations.                                                                                                                         </td><td data-label="PTT (current)"> <strong>39. Routing integration</strong><br>1. PTT adds <code>safeSetHTML</code> which prefers <code>PasteToTable.routeHtmlToAreas</code> so that <code>index.html</code> router receives fragments correctly.<br>2. PTT <code>index.html</code> provided earlier implements that route.<br>Compatible.                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>40. Remove Hide Paste Box UI</strong><br>1. Not in TV2.1.                                                                                                                                                      </td><td data-label="PTT (current)"> <strong>40. Remove Hide Paste Box UI</strong><br>1. PTT removes <code>#togglePasteBtn</code> server-provided toggles where present to simplify UX.<br>Non-critical DOM removal.                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>41. Fetch retries and timeouts</strong><br>1. TV2.1 had no <code>_fetchWithRetries</code>.                                                                                                                                </td><td data-label="PTT (current)"> <strong>41. Fetch retries and timeouts</strong><br>1. PTT implements <code>_fetchWithRetries</code> with abort timeout, retries, backoff, jitter.<br>Improves robustness for server calls.                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>42. Render / Convert fallbacks</strong><br>1. TV2.1 had no <code>doRender/doConvert</code> server wrappers.                                                                                                               </td><td data-label="PTT (current)"> <strong>42. Render / Convert fallbacks</strong><br>1. PTT’s <code>doRender</code> tries server <code>/api/render</code> then falls back to local <code>parseFirstTableFromText</code> and <code>renderConceptualTable</code> if available.<br>2. <code>doConvert</code> similar for <code>/api/convert</code>.<br>Adds graceful degradation.                                                                                                                                                                                                                                             </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>43. Save behavior</strong><br>1. TV2.1 had export/save helpers but not top-level <code>doSave</code> with server <code>/save</code>.                                                                                                 </td><td data-label="PTT (current)"> <strong>43. Save behavior</strong><br>1. PTT implements <code>doSave</code> sending HTML to <code>/save</code> and falls back to client-side download of full HTML wrapper.<br>Good safety net.                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>44. Wire top-level buttons</strong><br>1. TV2.1 attaches some handlers to server-provided toolbar buttons.                                                                                                     </td><td data-label="PTT (current)"> <strong>44. Wire top-level buttons</strong><br>1. PTT wires Export All -> <code>doSave</code>, Clear -> <code>resetAll</code>, Convert -> <code>doConvert</code>, Render -> <code>doRender</code>, Save HTML -> <code>doSave</code>.<br>Adds <code>_pttAdopted</code> flags.<br>Idempotent.                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>45. Final DOMContentLoaded differences</strong><br>1. Both run heavy init on DOMContentLoaded. TV2.1 attaches handlers and snapshots.                                                                          </td><td data-label="PTT (current)"> <strong>45. Final DOMContentLoaded differences</strong><br>1. PTT does same plus initial <code>markButtonsHiddenForAllWrappers()</code> to hide actions until convert runs and attaches adopted buttons wiring.<br>2. Ensures not to attach per-wrapper action handlers until reveal to avoid double-bind.                                                                                                                                                                                                                        </td></tr></tbody></table></div><div class="row-count">Rows: 28</div></div><div class="table-caption" id="Table6" data-table="Book_8018_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by TV2.1 (reference)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">TV2.1 (reference)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by PTT (current)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PTT (current)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="TV2.1 (reference)"> <strong>46. Extra loader (TV_BASE detection)</strong><br><br>1. <code>detectScriptBase()</code> uses <code>document.currentScript</code> then scans scripts for <code>/assets/script.js</code> or <code>script.js</code>.<br>2. Fallback to <code>location.origin + pathname</code> trimmed. </td><td data-label="PTT (current)"> <strong>46. Extra loader (TV_BASE detection)</strong><br><br>1. Same pattern in PTT. Both compute <code>TV_BASE</code> and expose <code>window.__tv_base</code>. No functional change.     </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>47. ensureIndexAndWorkerAttrs</strong><br><br>1. Sets <code>data-index-url</code> and <code>data-worker-url</code> on body if missing.<br>2. Exposes <code>window.tvIndexUrl</code> and <code>window.tvWorkerUrl</code>.                                                  </td><td data-label="PTT (current)"> <strong>47. ensureIndexAndWorkerAttrs</strong><br><br>1. Identical in PTT. Called early in both.                                                                     </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>48. createScriptElement / loadExtraSequentially</strong><br><br>1. Both implement sequential candidate loading with onload, onerror, small retry delay.                                                                       </td><td data-label="PTT (current)"> <strong>48. createScriptElement / loadExtraSequentially</strong><br><br>1. Identical semantics. PTT also used in additional adopted loader but no behavioral change. </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>49. startExtraLoader guard</strong><br><br>1. TV2.1 checks <code>_tv_extra_loader_attached</code>, <code>window.tvExtra</code>, or existing <code>script[src*=&quot;extra.js&quot;]</code> and logs on skip.                                                             </td><td data-label="PTT (current)"> <strong>49. startExtraLoader guard</strong><br><br>1. PTT same. No double-load risk for extra.js.                                                                    </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>50. Early-hide Export Markdown CSS injection</strong><br><br>1. TV2.1 injects style <code>[data-tv-early-hide-md]</code>.                                                                                                                </td><td data-label="PTT (current)"> <strong>50. Early-hide Export Markdown CSS injection</strong><br><br>1. PTT injects identical CSS early. No difference.                                              </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>51. TOC building & row id assignment</strong><br><br>1. <code>buildSingleTableToc()</code> creates per-row id, anchors, assigns <code>row.id</code> and attaches click smooth-scroll.                                                               </td><td data-label="PTT (current)"> <strong>51. TOC building & row id assignment</strong><br><br>1. PTT same. Both call it early (DOMContentLoaded + delayed). PTT also exposes <code>buildSingleTableToc</code>.   </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>52. Row UID snapshot ordering (originalRowOrders)</strong><br><br>1. TV2.1 <code>_ensureRowUidsAndSnapshot</code> adds <code>data-tv-uid</code> and records list per table.                                                                         </td><td data-label="PTT (current)"> <strong>52. Row UID snapshot ordering</strong><br><br>1. PTT identical. Both rely on <code>originalRowOrders</code> for reset/sort reset.                                       </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>53. sortStates paradigm</strong><br><br>1. <code>sortStates</code> per table column with 0/1/2 semantics. <code>updateHeaderSortUI</code> updates aria-sort and icon HTML.                                                                          </td><td data-label="PTT (current)"> <strong>53. sortStates paradigm</strong><br><br>1. PTT identical. Both reset other columns when sorting a column.                                                    </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>54. Reordering technique</strong><br><br>1. Both reorder by appending existing <code>tbody</code> nodes (no cloning) to preserve IDs and anchors.                                                                                        </td><td data-label="PTT (current)"> <strong>54. Reordering technique</strong><br><br>1. Identical. Preserves ids/anchors.                                                                                </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>55. Toast implementation</strong><br><br>1. TV2.1 toast uses container <code>#tv-toast-container</code>, role/status, durations computed by <code>_computeToastDuration</code>.                                                                     </td><td data-label="PTT (current)"> <strong>55. Toast implementation</strong><br><br>1. PTT identical. Same DOM layout and styles set inline.                                                            </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table7" data-table="Book_8018_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by TV2.1 (reference)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">TV2.1 (reference)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by PTT (current)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PTT (current)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="TV2.1 (reference)"> <strong>56. Copy modal</strong><br><br>1. Modal <code>#tv-copy-modal</code> creation, textarea, copy/download/select controls.                                                                                                                  </td><td data-label="PTT (current)"> <strong>56. Copy modal</strong><br><br>1. PTT identical. Minor whitespace comment differences only.                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>57. Delegation idempotency</strong><br><br>1. TV2.1 attaches delegated click listeners but does not set global attachment guards consistently.                                                                               </td><td data-label="PTT (current)"> <strong>57. Delegation idempotency</strong><br><br>1. PTT introduces guards <code>window.__tv_sort_delegated_attached</code> and <code>window.__tv_toc_delegated_attached</code> to avoid duplicate global listeners if script loaded multiple times. Safer.                                                                                                                                                                 </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>58. Module-liveness flags</strong><br><br>1. TV2.1 does not set a top-level single-load installed flag.                                                                                                                      </td><td data-label="PTT (current)"> <strong>58. Module-liveness flags</strong><br><br>1. PTT sets <code>window.__tv_revised_script_installed</code> to prevent double-apply. This is new and prevents duplicate side-effects.                                                                                                                                                                                                                         </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>59. Namespace hygiene</strong><br><br>1. TV2.1 exposes many functions on <code>window</code> (searchTable, exportTableXLSX, etc.).                                                                                                      </td><td data-label="PTT (current)"> <strong>59. Namespace hygiene</strong><br><br>1. PTT exposes same functions and also adds <code>doRender</code>, <code>doConvert</code>, <code>doSave</code>, <code>_wireAdoptedButtons</code>, <code>_ADOPTED_CONFIG</code>, and internal <code>_ptt</code> helpers. All added under <code>window</code> where necessary. <code>window.PasteToTable</code> preserved by PTT.                                                                                                                  </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>60. Adopted minimal router integration</strong><br><br>1. TV2.1 had no <code>safeSetHTML</code> wrapper relying on direct innerHTML assignments.                                                                                        </td><td data-label="PTT (current)"> <strong>60. Adopted minimal router integration</strong><br><br>1. PTT added <code>safeSetHTML</code> which prefers <code>PasteToTable.routeHtmlToAreas</code> if present. Compatible and prevents clobbering full-page responses.                                                                                                                                                                                            </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>61. Topic fallback + extra.js patch</strong><br><br>1. TV2.1 appended a small appended patch that attempts to load extra.js and runs <code>minimalTopicFallback</code>. It exposes <code>__tv_patch_diag</code> and <code>__tv_trigger_topic_fallback</code>. </td><td data-label="PTT (current)"> <strong>61. Topic fallback + extra.js patch</strong><br><br>1. PTT includes similar appended loader code in its two scripts (both contain extra.js loader and topic fallback). The PTT variant and TV2.1 variant are functionally similar.<br>2. Risk: duplicated fallback blocks across files could run twice, but PTT sets <code>window.__tv_extra_loader_patched</code> in its appended patch to avoid repeat. </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>62. Error logging policy</strong><br><br>1. TV2.1 uses silent catches everywhere and limited <code>console.warn/info</code> in certain places.                                                                                          </td><td data-label="PTT (current)"> <strong>62. Error logging policy</strong><br><br>1. PTT follows same conservative “silent” pattern.<br>2. Adds some additional <code>console.debug</code> and <code>console.info(&#x27;tv:script loaded...&#x27;)</code> at end. No noisy logs expected in normal ops.                                                                                                                                                                 </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>63. Security / XSS considerations</strong><br><br>1. Both use <code>innerHTML</code> in <code>safeSetHTML</code> fallback and <code>table.outerHTML</code> for PDF.                                                                                           </td><td data-label="PTT (current)"> <strong>63. Security / XSS considerations</strong><br><br>1. PTT mitigates by preferring <code>PasteToTable.routeHtmlToAreas</code> which can choose safe insertion.<br>2. Both rely on server-provided HTML being trusted. No changes to sanitization.                                                                                                                                                           </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>64. Performance and memory</strong><br><br>1. TV2.1 uses DOM reorders, debounced resize and search. No worker usage in core.                                                                                                 </td><td data-label="PTT (current)"> <strong>64. Performance and memory</strong><br><br>1. PTT identical plus embedded XLSX builder which consumes extra memory briefly when building zip arrays.<br>2. Embedded builder uses typed arrays and is efficient.<br>3. No persistent memory leaks introduced.                                                                                                                                   </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>65. XLSX builder correctness</strong><br><br>1. TV2.1 falls back to TSV; depends on external SheetJS for true xlsx.                                                                                                          </td><td data-label="PTT (current)"> <strong>65. XLSX builder correctness</strong><br><br>1. PTT supplies embedded ZIP/XML generator with CRC32 and correct central directory.<br>2. Produces legitimate .xlsx blobs for simple sheets.<br>3. Risk: complex Excel features not supported.<br>4. Benefit: no dependency on SheetJS.                                                                                                          </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table8" data-table="Book_8018_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by TV2.1 (reference)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">TV2.1 (reference)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by PTT (current)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PTT (current)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="TV2.1 (reference)"> <strong>66. UX difference: Hide-until-convert</strong><br><br>1. TV2.1 shows action buttons as provided by server.                  </td><td data-label="PTT (current)"> <strong>66. UX difference: Hide-until-convert</strong><br><br>1. PTT hides non-toggle action buttons by adding <code>.tv-hidden-before-convert</code> class and CSS.<br>2. Buttons are revealed after successful convert/render or manual reveal.<br>3. This intentionally changes pre-convert UX. Confirm expected.                                                                                                                                 </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>67. Button wiring timing</strong><br><br>1. TV2.1 attaches per-wrapper handlers on DOMContentLoaded immediately.            </td><td data-label="PTT (current)"> <strong>67. Button wiring timing</strong><br><br>1. PTT marks buttons hidden early, delays attaching some per-wrapper handlers until reveal, and wires top-level adopted buttons earlier via <code>_wireAdoptedButtons</code>.<br>2. Minimizes double-bind.                                                                                                                                                                                          </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>68. Tests/hooks added</strong><br><br>1. TV2.1 calls <code>updateRowCounts()</code> and <code>optimizeTableControls()</code> at end.              </td><td data-label="PTT (current)"> <strong>68. Tests/hooks added</strong><br><br>1. PTT calls same and also exposes <code>__tv_patch_diag</code> in appended patch and <code>window.__tv_trigger_topic_fallback</code>.<br>2. Also exposes <code>window.doRender/doConvert/doSave</code> for e2e use.                                                                                                                                                                                                         </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>69. Backwards compatibility with index.html</strong><br><br>1. TV2.1 expects certain selectors and paste panel elements.    </td><td data-label="PTT (current)"> <strong>69. Backwards compatibility with index.html</strong><br><br>1. PTT preserved compatibility and added <code>safeSetHTML</code> and a router in provided index.html.<br>2. PTT index.html includes paste textarea moved to header; PTT script accounts for that (<code>getPasteTextarea()</code> checks various selectors). Good compatibility.                                                                                                           </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>70. Recovery and rollback</strong><br><br>1. TV2.1 file was single script.                                                  </td><td data-label="PTT (current)"> <strong>70. Recovery and rollback</strong><br><br>1. PTT adds no automatic rollback logic.<br>2. Recommended to snapshot original script.js and commit new file atomically. (This is in your Plan).                                                                                                                                                                                                                                       </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>71. Potential conflicts</strong><br><br>1. TV2.1 may be loaded alongside other revisions causing duplicate listeners.       </td><td data-label="PTT (current)"> <strong>71. Potential conflicts</strong><br><br>1. PTT substantially reduces conflict risk via installed guards (<code>__tv_revised_script_installed</code>, delegated guards, loader patched flags).<br>2. This prevents most double-bind / double-execute scenarios.                                                                                                                                                                               </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>72. Minor differences in string/constant naming</strong><br><br>1. TV2.1 uses <code>tvConfig</code>, <code>TV_BASE</code>, <code>_tv_row_uid_counter</code>. </td><td data-label="PTT (current)"> <strong>72. Minor differences in string/constant naming</strong><br><br>1. PTT keeps same names but adds <code>_ADOPTED_CONFIG</code>, <code>TV_HIDE_UNTIL_CONVERT_CLASS</code>, and <code>__ptt_</code> prefixes for embedded xlsx helpers to avoid collisions.<br>2. Good practice.                                                                                                                                                                                      </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>73. Accessibility retention</strong><br><br>1. TV2.1 sets <code>aria-sort</code>, <code>role=&quot;status&quot;</code> for toasts, <code>aria-live</code> etc.         </td><td data-label="PTT (current)"> <strong>73. Accessibility retention</strong><br><br>1. PTT preserves all ARIA attributes.<br>2. No regressions observed.                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>74. Summary of behavioral deltas</strong><br><br>1. TV2.1 baseline.                                                         </td><td data-label="PTT (current)"> <strong>74. Summary of behavioral deltas</strong><br><br>1. PTT preserves all TV2.1 behaviors.<br>2. Adds: embedded XLSX builder, robust delegated handler guards, hide-until-convert UX, doRender/doConvert/doSave server wrappers with retries and fallbacks, safeSetHTML router preference, and idempotent button wiring.<br>3. All changes are additive or protective.                                                                </td></tr><tr><td data-label="TV2.1 (reference)"> <strong>75. Recommended acceptance checks before deploy</strong><br><br>1. n/a                                                      </td><td data-label="PTT (current)"> <strong>75. Recommended acceptance checks before deploy</strong><br><br>1. Verify UI: Convert reveals buttons and they work.<br>2. Verify sorting and reset preserve IDs/anchors.<br>3. Export XLSX: test with and without SheetJS; confirm real .xlsx opens in Excel.<br>4. Confirm no duplicate toasts or double-click side-effects.<br>5. Run lint and run small browser smoke test for event counts.<br>6. Keep rollback patch ready. </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>