<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1766667377">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0097_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Area"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Area</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Diagnosis &amp; Root cause"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagnosis & Root cause</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Prevention / Safeguards / Tests"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Prevention / Safeguards / Tests</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Area"> Problem statement                    </td><td data-label="Diagnosis &amp; Root cause"> Captions get injected twice because server render and client init both append caption nodes for the same table. </td><td data-label="Prevention / Safeguards / Tests"> Make caption insertion idempotent. Before inserting probe for canonical marker or matching caption. Unit tests: render+client runs produce one caption. Metric: <code>ptt.captions.duplicates</code>.                                                          </td></tr><tr><td data-label="Area"> Canonical marker strategy            </td><td data-label="Diagnosis &amp; Root cause">                                                      Multiple subsystems create captions with no shared marker. </td><td data-label="Prevention / Safeguards / Tests"> Require every caption-producer to set <code>data-ptt-caption-source=&quot;server                                                                                                                                                                              | client | fallback&quot;</code>. Insertion only if no existing caption for tableId. Test: dual-insert scenario asserts single caption and correct source. </td></tr><tr><td data-label="Area"> ID & anchor coordination             </td><td data-label="Diagnosis &amp; Root cause">                       Mismatched or non-deterministic table IDs cause separate captions for same logical table. </td><td data-label="Prevention / Safeguards / Tests"> Standardize <code>getTableId(table)</code> contract: prefer existing <code>id</code> → heading id → deterministic <code>TableN</code> using doc fingerprint. Probe DOM by <code>data-ptt-target=tableId</code> before insert. Tests: id-collision, missing-id, deterministic generation.        </td></tr><tr><td data-label="Area"> Precedence rules                     </td><td data-label="Diagnosis &amp; Root cause">                                      No clear ownership; server and client both think they must create caption. </td><td data-label="Prevention / Safeguards / Tests"> Define ownership config <code>data-ptt-caption-owner=server                                                                                                                                                                                              | client | prefer-server</code>. Respect server unless owner allows replacement. Tests: server non-replaceable, replaceable, missing server caption.  </td></tr><tr><td data-label="Area"> De-duplication algorithm             </td><td data-label="Diagnosis &amp; Root cause">                                                   Blind appends cause duplicates; repeated runs multiply nodes. </td><td data-label="Prevention / Safeguards / Tests"> Two-step insert: probe → update if found → insert+mark if not. Use <code>data-ptt-caption-id</code> token for idempotency. Tests: repeated calls (×5) yield one caption, stable token.                                                                         </td></tr><tr><td data-label="Area"> Race conditions                      </td><td data-label="Diagnosis &amp; Root cause">                                        Client/server timing and MutationObservers can interleave and re-insert. </td><td data-label="Prevention / Safeguards / Tests"> Use render-complete flag (<code>data-ptt-render-complete</code>) and debounce mutation-driven builds. Atomic insertion logic. Simulate delays and assert one caption.                                                                                          </td></tr><tr><td data-label="Area"> Caption normalization                </td><td data-label="Diagnosis &amp; Root cause">                                Visually identical captions differ by whitespace/<code>&lt;br&gt;</code> and fail equality tests. </td><td data-label="Prevention / Safeguards / Tests"> Normalize text before compare: collapse whitespace, convert <code>&lt;br&gt;</code>↔<code>\n</code>, strip trivial tags. If normalized equal treat as same. Tests: variants with <code>&lt;br&gt;</code>, <code>\n</code>, extra spaces.                                                                    </td></tr><tr><td data-label="Area"> Client fallback vs server preference </td><td data-label="Diagnosis &amp; Root cause">                                                         Some pages prefer client-side captions (i18n, dynamic). </td><td data-label="Prevention / Safeguards / Tests"> Make owner configurable per page. If <code>prefer-server</code> but server absent after timeout, client inserts and marks as client-owned. Tests for owner configs and timeout behavior.                                                                       </td></tr><tr><td data-label="Area"> Visibility & accessibility           </td><td data-label="Diagnosis &amp; Root cause">                                                              Naive removal may break ARIA links or TOC anchors. </td><td data-label="Prevention / Safeguards / Tests"> When reconciling preserve/merge ARIA attributes. Ensure the canonical caption has <code>id</code> used for TOC. Accessibility tests (axe) verify label presence and focusability.                                                                              </td></tr><tr><td data-label="Area"> Logging & observability              </td><td data-label="Diagnosis &amp; Root cause">                                                                   Silent logic makes regressions hard to debug. </td><td data-label="Prevention / Safeguards / Tests"> Emit structured CustomEvent <code>ptt:caption:reconciled</code> and console events with <code>{tableId, action, existingSource, newSource}</code>. Track metrics: <code>ptt.captions.duplicates</code>, <code>ptt.captions.reconciliations</code>. CI asserts zero duplicates for sample pages. </td></tr><tr><td data-label="Area"> Defensive UI                         </td><td data-label="Diagnosis &amp; Root cause">                                                              If duplicates slip to prod, layout and a11y break. </td><td data-label="Prevention / Safeguards / Tests"> Non-destructive hide: keep first canonical visible, add <code>aria-hidden=&quot;true&quot;</code> + <code>data-ptt-duplicate=&quot;1&quot;</code> to others. Idle cleanup removes old duplicates. Test: inject multiples and verify single visible.                                           </td></tr><tr><td data-label="Area"> Test matrix (must-cover)             </td><td data-label="Diagnosis &amp; Root cause">   Real-world triggers: server-only, client-only, simultaneous, delayed, different text, MutationObserver churn. </td><td data-label="Prevention / Safeguards / Tests"> For each scenario assert: one caption, correct <code>data-ptt-caption-source</code>, TOC links to caption id. Include race simulators and headless DOM tests.                                                                                                  </td></tr><tr><td data-label="Area"> Rollout strategy                     </td><td data-label="Diagnosis &amp; Root cause">                                                                               High-risk UI change across teams. </td><td data-label="Prevention / Safeguards / Tests"> Feature-flag reconciliation. Canary: dev → staging → small% canary → full. Start with long debounce and detailed sampling logs in staging. Rollback by disabling flag.                                                                              </td></tr><tr><td data-label="Area"> Documentation & contract             </td><td data-label="Diagnosis &amp; Root cause">                                                                   Teams must align on ownership and attributes. </td><td data-label="Prevention / Safeguards / Tests"> Update Prompt_07 docs: contracts for <code>getTableId()</code>, <code>data-ptt-caption-source</code>, <code>data-ptt-caption-owner</code>, normalization rules, and reconciliation policy. Add diagram and PR checklist requiring server/client signoff.                             </td></tr><tr><td data-label="Area"> Monitoring & alerts                  </td><td data-label="Diagnosis &amp; Root cause">                                                                      Need early warning if duplicates reappear. </td><td data-label="Prevention / Safeguards / Tests"> Metric alert: <code>ptt.captions.duplicates &gt; threshold</code> over 5m. Emit sample DOM snapshot and event timeline on alert. Run automated remediation guide for ops.                                                                                         </td></tr></tbody></table></div><div class="row-count">Rows: 15</div></div><div class="table-caption" id="Table2" data-table="Docu_0097_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Focus Area &amp; Step"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Focus Area & Step</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Problem Description"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Problem Description</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Impact / Resolution Summary"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Impact / Resolution Summary</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Focus Area &amp; Step"> <strong>Observation (Step 1)</strong>           </td><td data-label="Problem Description"> Possible <strong>duplicated caption injection</strong> during list-to-table or table-refresh operations.                    </td><td data-label="Impact / Resolution Summary"> Creates visual clutter and inconsistent table semantics.                         </td></tr><tr><td data-label="Focus Area &amp; Step"> <strong>Source Identification (Step 2)</strong> </td><td data-label="Problem Description"> Redundant calls in <code>script.list.js</code> and <code>script.table.js</code> cause multiple captions after sequential file loads. </td><td data-label="Impact / Resolution Summary"> Each render may double up the <code>&lt;caption&gt;</code> node.                                  </td></tr><tr><td data-label="Focus Area &amp; Step"> <strong>Mechanism (Step 3)</strong>             </td><td data-label="Problem Description"> Caption logic triggers inside both <code>__ptt_load_files_seq</code> and table renderer without deduplication.            </td><td data-label="Impact / Resolution Summary"> DOM accumulates multiple <code>&lt;caption&gt;</code> elements per table instance.                </td></tr><tr><td data-label="Focus Area &amp; Step"> <strong>Failure Mode (Step 4)</strong>          </td><td data-label="Problem Description"> Browser displays duplicate captions; TOC indexing repeats them.                                                </td><td data-label="Impact / Resolution Summary"> Unclean output, inconsistent TOC labeling, user confusion.                       </td></tr><tr><td data-label="Focus Area &amp; Step"> <strong>Resolution Strategy (Step 5)</strong>   </td><td data-label="Problem Description"> Add <strong>caption deduplication guard</strong>: skip or replace if identical caption text already exists.                 </td><td data-label="Impact / Resolution Summary"> Guarantees one caption per table and eliminates redundancy.                      </td></tr><tr><td data-label="Focus Area &amp; Step"> <strong>Integration Point (Step 6)</strong>     </td><td data-label="Problem Description"> Implement guard in <strong><code>script.table.js</code></strong> where table DOM is built, not in the loader.                          </td><td data-label="Impact / Resolution Summary"> Centralized protection even under multiple render calls.                         </td></tr><tr><td data-label="Focus Area &amp; Step"> <strong>Verification Plan (Step 7)</strong>     </td><td data-label="Problem Description"> Reload and merge files sequentially, inspect final DOM.                                                        </td><td data-label="Impact / Resolution Summary"> Each table keeps exactly one <code>&lt;caption&gt;</code>; repeat loads do not multiply captions. </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><div class="table-caption" id="Table3" data-table="Docu_0097_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Factor"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Factor</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Client-side (script.list.js)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Client-side (script.list.js)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Server-side (server.py)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Server-side (server.py)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Factor">  <strong>Authority / canonical source</strong> </td><td data-label="Client-side (script.list.js)"> Client is ephemeral per user and can be out-of-sync with saved content. Risk of divergent captions.                  </td><td data-label="Server-side (server.py)"> Server can be authoritative. Captions stored alongside files remain consistent across all clients. Best for published lists.                     </td></tr><tr><td data-label="Factor"> <strong>Race conditions & idempotency</strong> </td><td data-label="Client-side (script.list.js)"> Higher risk. Must implement version tokens, fuzzy mapping and idempotent applier. Complex when renderer mutates DOM. </td><td data-label="Server-side (server.py)"> Lower risk. Server emits final HTML/markdown with captions already present. No client applier needed. Eliminates race between convert and apply. </td></tr><tr><td data-label="Factor">    <strong>XSS / sanitization surface</strong> </td><td data-label="Client-side (script.list.js)"> Larger attack surface. Client must sanitize before DOM insertion; different browsers may behave differently.         </td><td data-label="Server-side (server.py)"> Smaller surface if server sanitizes before emitting. Easier to enforce sanitization rules, CSP headers, and HTML-encoding on server.             </td></tr><tr><td data-label="Factor">       <strong>Performance / bandwidth</strong> </td><td data-label="Client-side (script.list.js)"> Lighter server load but clients may do repeated DOM scans. Extra JS and timers.                                      </td><td data-label="Server-side (server.py)"> Slightly heavier server work at generation time. Minimal client cost. Cached server responses reduce overall load.                               </td></tr><tr><td data-label="Factor">    <strong>Caching & CDN friendliness</strong> </td><td data-label="Client-side (script.list.js)"> Harder to cache per-client DOM changes. Captions applied client-side not visible in cached HTML.                     </td><td data-label="Server-side (server.py)"> Easy to cache and serve canonical pages with captions. Better for CDN and offline-first UX.                                                      </td></tr><tr><td data-label="Factor">    <strong>Consistency across clients</strong> </td><td data-label="Client-side (script.list.js)"> Potential inconsistency if different client versions or feature flags run.                                           </td><td data-label="Server-side (server.py)"> Uniform across all clients and compatible with older/JS-disabled clients.                                                                        </td></tr><tr><td data-label="Factor">      <strong>Offline / low-JS clients</strong> </td><td data-label="Client-side (script.list.js)"> Fails for JS-disabled or limited JS environments (captions missing).                                                 </td><td data-label="Server-side (server.py)"> Works for users without JS and for bots (SEO).                                                                                                   </td></tr><tr><td data-label="Factor"> <strong>Complex mapping (index→table)</strong> </td><td data-label="Client-side (script.list.js)"> Client must heuristically map runtime index to DOM; fragile when content shifts.                                     </td><td data-label="Server-side (server.py)"> Server knows exact mapping at render time; deterministic insertion into correct table node.                                                      </td></tr><tr><td data-label="Factor">        <strong>User-editable captions</strong> </td><td data-label="Client-side (script.list.js)"> Easier to let user edit in browser; need to persist back to server to make canonical.                                </td><td data-label="Server-side (server.py)"> Preferable to persist edits server-side; server then regenerates canonical output.                                                               </td></tr><tr><td data-label="Factor">         <strong>Deployment complexity</strong> </td><td data-label="Client-side (script.list.js)"> Simple to release (push JS). But requires careful concurrency fixes and testing across clients.                      </td><td data-label="Server-side (server.py)"> Requires server change and possibly template changes. More controlled rollout, easier to test in staging.                                        </td></tr><tr><td data-label="Factor">               <strong>Rollback safety</strong> </td><td data-label="Client-side (script.list.js)"> Quick revert via client script but risk of residual client caches.                                                   </td><td data-label="Server-side (server.py)"> Revert by redeploying server; cached pages might need cache purge; safer for long-term correctness.                                              </td></tr><tr><td data-label="Factor">        <strong>Auditability / logging</strong> </td><td data-label="Client-side (script.list.js)"> Client logs ephemeral. Hard to centralize telemetry about caption correctness.                                       </td><td data-label="Server-side (server.py)"> Server can record which captions were injected, versions, and who changed them for audit and metrics.                                            </td></tr><tr><td data-label="Factor">                    <strong>SEO / bots</strong> </td><td data-label="Client-side (script.list.js)"> Captions injected client-side may be invisible to crawlers.                                                          </td><td data-label="Server-side (server.py)"> Server-injected captions are visible to search bots and external processors.                                                                     </td></tr></tbody></table></div><div class="row-count">Rows: 13</div></div><div class="table-caption" id="Table4" data-table="Docu_0097_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Component"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Component</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Required Change"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Required Change</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Reason"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Reason</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Component"> <strong><code>server.py</code></strong>                  </td><td data-label="Required Change"> Add a rendering layer that injects canonical <code>&lt;caption&gt;</code> elements into tables generated for the <em>list form workflow</em>. Include versioning (<code>data-ptt-caption-version</code>) and ensure HTML is sanitized. </td><td data-label="Reason"> Moves caption creation from client to the authoritative backend, preventing duplication and race conditions.               </td></tr><tr><td data-label="Component"> <strong><code>script.list.js</code></strong>             </td><td data-label="Required Change"> Remove or disable caption creation and DOM-write logic. Keep only logic to <em>display</em> captions already present from the server and to <em>read</em> metadata (e.g., caption version, user edit status).     </td><td data-label="Reason"> Avoids redundant DOM modification while retaining UX functions like highlighting, navigation, or caption editing triggers. </td></tr><tr><td data-label="Component"> <strong>Optional (<code>script.table.js</code>)</strong> </td><td data-label="Required Change"> Add defensive check: before rendering, verify whether a <code>&lt;caption&gt;</code> already exists. Skip injection entirely for <em>list workflow</em>.                                                                    </td><td data-label="Reason"> Adds robustness in mixed workflows (manual paste vs list import).                                                          </td></tr></tbody></table></div><div class="row-count">Rows: 3</div></div><div class="table-caption" id="Table5" data-table="Docu_0097_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by File"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Reason for Recheck"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Reason for Recheck</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Confidence"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Confidence</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"> <code>script.table.js</code> </td><td data-label="Reason for Recheck"> To verify client-side alignment with <code>&lt;div class=&quot;table-wrapper&quot;&gt;</code> structure                                                        </td><td data-label="Confidence"> 95%        </td></tr><tr><td data-label="File"> <code>script.list.js</code>  </td><td data-label="Reason for Recheck"> Ensure list-driven workflow doesn’t duplicate captions injected by <code>server.py</code>                                                      </td><td data-label="Confidence"> 96%        </td></tr><tr><td data-label="File"> <code>server.py</code>       </td><td data-label="Reason for Recheck"> Confirm caption injection logic for list workflows uses consistent structure and doesn’t conflict with <code>_wrap_each_table_with_ui()</code> </td><td data-label="Confidence"> 98%        </td></tr><tr><td data-label="File"> <code>index.html</code>      </td><td data-label="Reason for Recheck"> Confirm inclusion order of injected CSS/JS matches <code>html_renderer</code>’s auto-injection                                                 </td><td data-label="Confidence"> 97%        </td></tr></tbody></table></div><div class="row-count">Rows: 4</div></div><div class="table-caption" id="Table6" data-table="Docu_0097_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Area"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Area</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Diagnosis &amp; Root cause"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagnosis & Root cause</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Prevention / Safeguards / Tests"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Prevention / Safeguards / Tests</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Area"> Problem statement </td><td data-label="Diagnosis &amp; Root cause"> Captions are created twice because server render and client init both append caption nodes for the same logical table. </td><td data-label="Prevention / Safeguards / Tests"> Make caption insertion idempotent. Probe for canonical marker or matching caption before inserting. Unit tests: server+client runs produce one caption. Metric: <code>ptt.captions.duplicates</code>. </td><td data-label="Notes"> Ensure single source of truth per page or per-table. </td></tr><tr><td data-label="Area"> Canonical marker strategy </td><td data-label="Diagnosis &amp; Root cause"> Multiple subsystems create captions with no shared marker. </td><td data-label="Prevention / Safeguards / Tests"> Require producers to set <code>data-ptt-caption-source=&quot;server|client|fallback&quot;</code>. Insert only if no existing canonical caption for <code>tableId</code>. Test: dual-insert scenario yields one caption with correct source. </td><td data-label="Notes"> Use simple enum values to avoid parsing errors. </td></tr><tr><td data-label="Area"> Table ID contract </td><td data-label="Diagnosis &amp; Root cause"> Mismatched or non-deterministic table IDs cause separate captions for the same logical table. </td><td data-label="Prevention / Safeguards / Tests"> Standardize <code>getTableId(table)</code> contract: prefer <code>id</code> → heading id → deterministic <code>TableN</code> using a document fingerprint. Probe DOM by <code>data-ptt-target=tableId</code> before insert. Tests: id-collision, missing-id, deterministic generation. </td><td data-label="Notes"> Document algorithm and examples. </td></tr><tr><td data-label="Area"> Precedence & ownership </td><td data-label="Diagnosis &amp; Root cause"> No clear ownership; server and client both create captions. </td><td data-label="Prevention / Safeguards / Tests"> Define page-level ownership <code>data-ptt-caption-owner=server|client|prefer-server</code>. Respect owner. If owner is server and server caption absent after timeout, client may insert as client-owned. Tests: server non-replaceable, replaceable, timeout fallback. </td><td data-label="Notes"> Owner configuration must be set by page template or site config. </td></tr><tr><td data-label="Area"> De-duplication algorithm </td><td data-label="Diagnosis &amp; Root cause"> Blind appends and repeated runs multiply nodes. </td><td data-label="Prevention / Safeguards / Tests"> Two-step insert: probe → update if found → insert+mark if not. Use <code>data-ptt-caption-id</code> token for idempotency. Tests: repeated calls ×5 yield one caption with stable token. </td><td data-label="Notes"> Token generation deterministic for same content+tableId. </td></tr><tr><td data-label="Area"> Race conditions & observers </td><td data-label="Diagnosis &amp; Root cause"> MutationObservers and interleaved renders can re-insert captions. </td><td data-label="Prevention / Safeguards / Tests"> Use a <code>data-ptt-render-complete</code> flag and debounce mutation-driven builds. Make insertion atomic (check-and-set). Simulate delays and assert single caption. </td><td data-label="Notes"> Prefer central insertion point when possible. </td></tr><tr><td data-label="Area"> Caption normalization </td><td data-label="Diagnosis &amp; Root cause"> Visually identical captions differ by whitespace or <code>&lt;br&gt;</code> and fail equality tests. </td><td data-label="Prevention / Safeguards / Tests"> Normalize text before compare: collapse whitespace, convert <code>&lt;br&gt;</code>↔<code>\n</code>, strip trivial tags. If normalized equal, treat as same. Tests: variants with <code>&lt;br&gt;</code>, <code>\n</code>, extra spaces. </td><td data-label="Notes"> Apply same normalization on server and client. </td></tr><tr><td data-label="Area"> Accessibility & anchors </td><td data-label="Diagnosis &amp; Root cause"> Naive removal may break ARIA links or TOC anchors. </td><td data-label="Prevention / Safeguards / Tests"> When reconciling preserve/merge ARIA attributes. Ensure canonical caption has <code>id</code> used by TOC. Accessibility tests (axe) verify label presence and focusability. </td><td data-label="Notes"> Merge attributes rather than dropping them. </td></tr><tr><td data-label="Area"> Defensive UI for duplicates </td><td data-label="Diagnosis &amp; Root cause"> If duplicates slip to prod, layout and a11y break. </td><td data-label="Prevention / Safeguards / Tests"> Non-destructive hide: keep first canonical visible; add <code>aria-hidden=&quot;true&quot;</code> + <code>data-ptt-duplicate=&quot;1&quot;</code> to others. Idle cleanup task removes old duplicates. Test: inject multiples and verify single visible. </td><td data-label="Notes"> Avoid removing nodes immediately to preserve anchors until cleanup runs. </td></tr><tr><td data-label="Area"> Logging & observability </td><td data-label="Diagnosis &amp; Root cause"> Silent logic makes regressions hard to debug. </td><td data-label="Prevention / Safeguards / Tests"> Emit structured CustomEvent <code>ptt:caption:reconciled</code> and console events with <code>{tableId, action, existingSource, newSource}</code>. Track metrics: <code>ptt.captions.duplicates</code>, <code>ptt.captions.reconciliations</code>. CI asserts zero duplicates for sample pages. </td><td data-label="Notes"> Include DOM snapshot in sampled events. </td></tr><tr><td data-label="Area"> Test matrix (must-cover) </td><td data-label="Diagnosis &amp; Root cause"> Need end-to-end coverage of real-world triggers. </td><td data-label="Prevention / Safeguards / Tests"> Scenarios: server-only, client-only, simultaneous, delayed, different text, MutationObserver churn. For each assert: one caption, correct <code>data-ptt-caption-source</code>, TOC links to caption id. Include race simulators and headless DOM tests. </td><td data-label="Notes"> Run in CI with controlled timing variations. </td></tr><tr><td data-label="Area"> Rollout & rollout safety </td><td data-label="Diagnosis &amp; Root cause"> High-risk UI change across teams. </td><td data-label="Prevention / Safeguards / Tests"> Feature-flag reconciliation. Canary rollout: dev → staging → small% canary → full. Start with long debounce and detailed sampling logs in staging. Rollback by disabling flag. </td><td data-label="Notes"> Use telemetry to gate rollout progression. </td></tr><tr><td data-label="Area"> Documentation & contract </td><td data-label="Diagnosis &amp; Root cause"> Teams must align on ownership and attributes. </td><td data-label="Prevention / Safeguards / Tests"> Update Prompt_07 docs with contracts: <code>getTableId()</code>, <code>data-ptt-caption-source</code>, <code>data-ptt-caption-owner</code>, normalization rules, reconciliation policy. Add diagram and PR checklist requiring server/client signoff. </td><td data-label="Notes"> Add example snippets and negative tests in docs. </td></tr><tr><td data-label="Area"> Monitoring & alerts </td><td data-label="Diagnosis &amp; Root cause"> Need early warning if duplicates reappear. </td><td data-label="Prevention / Safeguards / Tests"> Alert: <code>ptt.captions.duplicates &gt; threshold</code> over 5m. Emit sample DOM snapshot and event timeline on alert. Provide automated remediation playbook for ops. </td><td data-label="Notes"> Tune threshold during canary. </td></tr><tr><td data-label="Area"> Component changes (recommended) </td><td data-label="Diagnosis &amp; Root cause"> Where to implement changes to avoid duplication. </td><td data-label="Prevention / Safeguards / Tests"> <strong>server.py</strong>: inject canonical <code>&lt;caption&gt;</code> for list workflows; add <code>data-ptt-caption-version</code>, sanitize HTML. <strong>script.list.js</strong>: remove caption creation; only display/read metadata. <strong>script.table.js</strong> (optional): defensive check to skip insertion if caption exists. Tests per file and integration tests. </td><td data-label="Notes"> Prefer server-first for published content; keep client for dynamic/i18n cases only. </td></tr><tr><td data-label="Area"> Roles & tradeoffs </td><td data-label="Diagnosis &amp; Root cause"> Summary of client vs server pros/cons </td><td data-label="Prevention / Safeguards / Tests"> Client: flexible, editable, higher race/XSS risk, not visible to bots. Server: authoritative, cache-friendly, consistent, better for SEO and low-JS clients. </td><td data-label="Notes"> Use server where possible; allow client fallback for dynamic needs. </td></tr><tr><td data-label="Area"> Verification recheck list </td><td data-label="Diagnosis &amp; Root cause"> Files to re-inspect after changes </td><td data-label="Prevention / Safeguards / Tests"> <code>script.table.js</code> (95%): verify guard and wrapper alignment. <code>script.list.js</code> (96%): ensure list workflow relies on server caption. <code>server.py</code> (98%): confirm injection matches <code>_wrap_each_table_with_ui()</code>. <code>index.html</code> (97%): confirm injection order for CSS/JS. </td><td data-label="Notes"> Run 10x randomized DOM replay tests and 5x race simulations. </td></tr></tbody></table></div><div class="row-count">Rows: 17</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>