<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1764743456">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0119_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Module Region**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Module Region</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **convert.py Output / Behavior**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>convert.py Output / Behavior</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **script.toc.js Logic / Responsibilities**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>script.toc.js Logic / Responsibilities</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Contract Between Modules**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Contract Between Modules</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Module Region"> <strong>1. Heading Generation</strong>                   </td><td data-label="convert.py Output / Behavior"> • <code>render_table()</code> builds <code>&lt;table&gt;</code> structure.<br>• Emits <code>&lt;h3 class=&quot;table-heading&quot;&gt;…&lt;/h3&gt;</code>.<br>• Optional caption via <code>emit_caption()</code>. </td><td data-label="script.toc.js Logic / Responsibilities"> • <code>PTToc.config.headingSelector</code> targets table-heading & captions.<br>• <code>buildItemsFromHeadings()</code> extracts text, normalizes, generates IDs, builds TOC entries. </td><td data-label="Contract Between Modules"> • Python emits headings; JS auto-detects them.<br>• JS generates safe IDs; none required from Python.       </td></tr><tr><td data-label="Module Region"> <strong>2. Table Region Emission</strong>                </td><td data-label="convert.py Output / Behavior"> Emits structured <code>&lt;table&gt;&lt;thead&gt;…&lt;/thead&gt;&lt;tbody&gt;…&lt;/tbody&gt;&lt;/table&gt;</code> with rows only.                                                        </td><td data-label="script.toc.js Logic / Responsibilities"> • <code>buildItemsFromSingleTable()</code> activates when only one table is present.<br>• Extracts <code>&lt;tbody&gt;</code> rows, generates row IDs, assigns Topic 1, Topic 2, etc.        </td><td data-label="Contract Between Modules"> • Python must not include row IDs.<br>• Python must emit <code>&lt;tbody&gt;</code>.<br>• JS deterministically numbers rows. </td></tr><tr><td data-label="Module Region"> <strong>3. Content Root Structure</strong>               </td><td data-label="convert.py Output / Behavior"> Wraps everything inside <code>&lt;div id=&quot;content&quot;&gt;</code>.                                                                                             </td><td data-label="script.toc.js Logic / Responsibilities"> • <code>getContentRoot()</code> identifies <code>#content</code> as root.<br>• MutationObserver watches for changes.                                                                   </td><td data-label="Contract Between Modules"> • Python must keep all headings/tables inside <code>#content</code>.<br>• JS rebuilds TOC when DOM changes.            </td></tr><tr><td data-label="Module Region"> <strong>4. Single vs. Multi-Table Output</strong>        </td><td data-label="convert.py Output / Behavior"> • Multi-table: emits headings before each table.<br>• Single-table: heading optional, usually absent.                                     </td><td data-label="script.toc.js Logic / Responsibilities"> • If <code>tables.length === 1</code>: row-mode.<br>• If <code>tables.length &gt; 1</code>: heading-mode.                                                                                 </td><td data-label="Contract Between Modules"> • Python's structure aligns with JS detection rules.                                                        </td></tr><tr><td data-label="Module Region"> <strong>5. Heading Text Inconsistencies</strong>         </td><td data-label="convert.py Output / Behavior"> May output mixed-case, multi-line, <code>&lt;br&gt;</code> tags, or Unicode punctuation in headings.                                                       </td><td data-label="script.toc.js Logic / Responsibilities"> • <code>_normalize_heading_text()</code> strips newlines/<code>&lt;br&gt;</code>, collapses whitespace, trims punctuation, lowercases for IDs, preserves human-readable text.                </td><td data-label="Contract Between Modules"> • Python does not sanitize; JS fully normalizes.                                                            </td></tr><tr><td data-label="Module Region"> <strong>6. Absence of IDs</strong>                       </td><td data-label="convert.py Output / Behavior"> Provides no IDs for headings, tables, or rows.                                                                                            </td><td data-label="script.toc.js Logic / Responsibilities"> • <code>ensureId()</code> generates unique and collision-safe IDs.                                                                                                          </td><td data-label="Contract Between Modules"> • Python emits plain HTML; JS builds anchor infrastructure.                                                 </td></tr><tr><td data-label="Module Region"> <strong>7. Emission Order</strong>                       </td><td data-label="convert.py Output / Behavior"> Output order: <code>&lt;h3&gt;</code> → <code>&lt;table&gt;</code> repeated in sequence.                                                                                    </td><td data-label="script.toc.js Logic / Responsibilities"> • <code>querySelectorAll()</code> reads in document order.<br>• TOC entries follow same order.                                                                              </td><td data-label="Contract Between Modules"> • JS mirrors Python’s emission order exactly.                                                               </td></tr><tr><td data-label="Module Region"> <strong>8. Page-Level TOC Containers</strong>            </td><td data-label="convert.py Output / Behavior"> Relies on external template elements: <code>#tocList</code>, <code>#tocBarList</code>.                                                                          </td><td data-label="script.toc.js Logic / Responsibilities"> • Safely clears containers.<br>• Populates with TOC items.<br>• Uses <code>data-pt-target</code> and <code>aria-current</code> for navigation.                                         </td><td data-label="Contract Between Modules"> • JS integrates with containers; Python remains static.                                                     </td></tr><tr><td data-label="Module Region"> <strong>9. Sticky Header Layout</strong>                 </td><td data-label="convert.py Output / Behavior"> Template includes <code>&lt;div id=&quot;stickyMainHeader&quot;&gt;</code>.                                                                                          </td><td data-label="script.toc.js Logic / Responsibilities"> • <code>onTocClick()</code> subtracts header height for precise scroll alignment.                                                                                           </td><td data-label="Contract Between Modules"> • Scroll calculations assume Python's static header layout.                                                 </td></tr><tr><td data-label="Module Region"> <strong>10. Static HTML; No Dynamic DOM</strong>         </td><td data-label="convert.py Output / Behavior"> Python does not modify DOM after load.                                                                                                    </td><td data-label="script.toc.js Logic / Responsibilities"> • MutationObserver + debounced rebuild logic to adapt to dynamic client views.                                                                                   </td><td data-label="Contract Between Modules"> • JS guarantees TOC sync even if content is reloaded client-side.                                           </td></tr><tr><td data-label="Module Region"> <strong>11. Caption-less or Heading-less Tables</strong> </td><td data-label="convert.py Output / Behavior"> Some tables produced without captions or headings.                                                                                        </td><td data-label="script.toc.js Logic / Responsibilities"> • Falls back to row-mode.<br>• If row-mode empty, fallback back to heading-mode.<br>• Never throws errors.                                                       </td><td data-label="Contract Between Modules"> • JS ensures graceful TOC behavior regardless of Python omissions.                                          </td></tr><tr><td data-label="Module Region"> <strong>12. No JavaScript Events in Python</strong>      </td><td data-label="convert.py Output / Behavior"> Pure static output.                                                                                                                       </td><td data-label="script.toc.js Logic / Responsibilities"> Provides full navigation stack: smooth scrolling, click delegation, hash highlighting, rebuild safety, history.replaceState.                                     </td><td data-label="Contract Between Modules"> • JS enhances navigation without altering Python output.                                                    </td></tr><tr><td data-label="Module Region"> <strong>Summary Matrix</strong>                          </td><td data-label="convert.py Output / Behavior"> <strong>convert.py Role</strong>                                                                                                                       </td><td data-label="script.toc.js Logic / Responsibilities"> <strong>script.toc.js Responsibility</strong>                                                                                                                                 </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Emits headings                                                                                                                            </td><td data-label="script.toc.js Logic / Responsibilities"> Reads & normalizes for TOC                                                                                                                                       </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Emits tables                                                                                                                              </td><td data-label="script.toc.js Logic / Responsibilities"> Detects single/multi-table mode                                                                                                                                  </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Emits <code>&lt;tbody&gt;</code> rows                                                                                                                      </td><td data-label="script.toc.js Logic / Responsibilities"> Generates Topic N anchors                                                                                                                                        </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Provides <code>#content</code>                                                                                                                       </td><td data-label="script.toc.js Logic / Responsibilities"> Observes & rebuilds TOC                                                                                                                                          </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Leaves IDs blank                                                                                                                          </td><td data-label="script.toc.js Logic / Responsibilities"> Generates safe IDs                                                                                                                                               </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Outputs noisy text                                                                                                                        </td><td data-label="script.toc.js Logic / Responsibilities"> Normalizes for labels                                                                                                                                            </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Defines document order                                                                                                                    </td><td data-label="script.toc.js Logic / Responsibilities"> Mirrors order                                                                                                                                                    </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Uses sticky header                                                                                                                        </td><td data-label="script.toc.js Logic / Responsibilities"> Applies scroll offset                                                                                                                                            </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Provides TOC containers                                                                                                                   </td><td data-label="script.toc.js Logic / Responsibilities"> Populates final TOC                                                                                                                                              </td><td data-label="Contract Between Modules">                                                                                                             </td></tr><tr><td data-label="Module Region"> —                                           </td><td data-label="convert.py Output / Behavior"> Static output                                                                                                                             </td><td data-label="script.toc.js Logic / Responsibilities"> Dynamic regeneration support                                                                                                                                     </td><td data-label="Contract Between Modules">                                                                                                             </td></tr></tbody></table></div><div class="row-count">Rows: 23</div></div><div class="table-caption" id="Table2" data-table="Docu_0119_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Region**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Region</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **convert.py Output Behavior (Ground Truth)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>convert.py Output Behavior (Ground Truth)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **script.toc.js Behavior After Revision (Validated Match)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>script.toc.js Behavior After Revision (Validated Match)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Region"> <strong>1. Heading Emission</strong>          </td><td data-label="convert.py Output Behavior (Ground Truth)"> Emits section/table titles as:<br>• <code>&lt;h3 class=&quot;table-heading&quot;&gt;Title&lt;/h3&gt;</code><br>• Sometimes <code>&lt;div class=&quot;table-caption&quot;&gt;Title&lt;/div&gt;</code><br>No IDs included. </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> TOC builder targets exactly:<br><code>h3.table-heading, .table-caption, .table-heading</code><br>Auto-generates IDs safely; preserves existing if any present.                    </td></tr><tr><td data-label="Region"> <strong>2. Multi-table Mode</strong>          </td><td data-label="convert.py Output Behavior (Ground Truth)"> Each table is preceded by a heading (h3.table-heading). These headings represent top-level navigation sections for multi-table documents.              </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> For more than 1 table, TOC collects heading nodes and generates TOC entries from them using normalized text.                                                           </td></tr><tr><td data-label="Region"> <strong>3. Single-table Mode</strong>         </td><td data-label="convert.py Output Behavior (Ground Truth)"> In single-table HTML, output contains only one table and no heading for internal rows. No row IDs are emitted.                                         </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> Detects exactly one table → switches to topic-row mode:<br>Generates <code>Topic 1</code>, <code>Topic 2</code>, … using table <code>&lt;tbody&gt;</code> rows and assigns stable row IDs (<code>row-*</code>).          </td></tr><tr><td data-label="Region"> <strong>4. Table Structure</strong>           </td><td data-label="convert.py Output Behavior (Ground Truth)"> Ensures <code>&lt;table&gt;</code> → <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code> structure.<br>Rows inside <code>&lt;tbody&gt;</code> are the intended “topics” for single-table navigation.                    </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> Row extraction logic uses primary <code>&lt;tbody&gt;</code> scan; fallback excludes <code>&lt;thead&gt;</code> to avoid selecting header rows.                                                          </td></tr><tr><td data-label="Region"> <strong>5. Content Root</strong>              </td><td data-label="convert.py Output Behavior (Ground Truth)"> convert.py outputs all HTML inside <code>&lt;div id=&quot;content&quot;&gt;…&lt;/div&gt;</code>.                                                                                        </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS uses <code>#content</code> as root; fallback to <code>#tables-viewer</code> or <code>&lt;body&gt;</code> to preserve backward compatibility.                                                               </td></tr><tr><td data-label="Region"> <strong>6. ID Policy</strong>                 </td><td data-label="convert.py Output Behavior (Ground Truth)"> convert.py never generates element IDs for headings, rows, or sections.                                                                                </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS auto-generates collision-safe IDs:<br>• Prefix: <code>table-</code> for headings<br>• Prefix: <code>row-</code> for rows<br>Ensures uniqueness and avoids overwriting any existing IDs.   </td></tr><tr><td data-label="Region"> <strong>7. Text Normalization</strong>        </td><td data-label="convert.py Output Behavior (Ground Truth)"> Heading text can contain line breaks, <code>&lt;br&gt;</code>, Unicode dashes, spacing irregularities.                                                                  </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS normalizes text:<br>• Removes <code>&lt;br&gt;</code> noise<br>• Removes newlines<br>• Collapses whitespace<br>• Strips leading/trailing punctuation<br>Guarantees clean TOC labels. </td></tr><tr><td data-label="Region"> <strong>8. TOC Locations</strong>             </td><td data-label="convert.py Output Behavior (Ground Truth)"> convert.py relies on outer HTML template to provide TOC containers (<code>#tocList</code>, <code>#tocBarList</code>).                                                        </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS targets only:<br>• <code>#tocList</code><br>• <code>#tocBarList</code><br>Skips silently if they don’t exist.                                                                             </td></tr><tr><td data-label="Region"> <strong>9. Sticky Header Offset</strong>      </td><td data-label="convert.py Output Behavior (Ground Truth)"> Layout includes <code>&lt;div id=&quot;stickyMainHeader&quot;&gt;</code> which affects anchor scroll offset.                                                                      </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS reads its height and subtracts it when scrolling to anchors; ensures correct visual alignment.                                                                      </td></tr><tr><td data-label="Region"> <strong>10. Mutation Handling</strong>        </td><td data-label="convert.py Output Behavior (Ground Truth)"> convert.py emits fixed HTML but client-side may dynamically swap/replace content (SPA architecture).                                                   </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS attaches MutationObserver on content root to auto-rebuild TOC on table/heading changes.                                                                             </td></tr><tr><td data-label="Region"> <strong>11. Legacy Compatibility</strong>     </td><td data-label="convert.py Output Behavior (Ground Truth)"> Older templates sometimes emitted <code>&lt;h3 class=&quot;table-heading&quot;&gt;</code> without captions or with extra wrappers.                                                </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS handles both legacy and modern heading structures using inclusive selectors and defensive parsing.                                                                  </td></tr><tr><td data-label="Region"> <strong>12. Row Labeling Contract</strong>    </td><td data-label="convert.py Output Behavior (Ground Truth)"> No built-in labels; grouping/sequence logic handled server-side only.                                                                                  </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS enforces deterministic labels: <code>Topic N</code> matching TV2.1 and earlier behavior.                                                                                       </td></tr><tr><td data-label="Region"> <strong>13. Safety & No Side Effects</strong> </td><td data-label="convert.py Output Behavior (Ground Truth)"> convert.py assumes headings can be manipulated by client logic without updating HTML.                                                                  </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS adds no structural changes except safe <code>id</code> injection; no mutation of table structure; supports repeat rebuilds idempotently.                                       </td></tr><tr><td data-label="Region"> <strong>14. Hash + ARIA Behavior</strong>     </td><td data-label="convert.py Output Behavior (Ground Truth)"> No native ARIA or highlight behavior; client JS responsible.                                                                                           </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS updates <code>aria-current=&quot;page&quot;</code> for active TOC entries; uses <code>data-pt-target</code> for robust linking behavior.                                                            </td></tr><tr><td data-label="Region"> <strong>15. Navigation Logic</strong>         </td><td data-label="convert.py Output Behavior (Ground Truth)"> convert.py does not provide scrolling logic.                                                                                                           </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS provides smooth-scroll with fallback; updates URL hash via history.replaceState for consistent behavior.                                                            </td></tr><tr><td data-label="Region"> <strong>16. Error Tolerance</strong>          </td><td data-label="convert.py Output Behavior (Ground Truth)"> convert.py may output missing captions, empty tables, or unusual sequences.                                                                            </td><td data-label="script.toc.js Behavior After Revision (Validated Match)"> JS includes defensive try/catch around all DOM reads/writes; will always succeed silently without throwing.                                                            </td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><div class="table-caption" id="Table3" data-table="Docu_0119_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Element / ID"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Element / ID</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Purpose in index.html"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Purpose in index.html</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Required contract for script.toc.js and convert.py"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Required contract for script.toc.js and convert.py</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Element / ID"> <code>#content</code>                                               </td><td data-label="Purpose in index.html">         Primary insertion point for rendered HTML (<code>convert.py</code> server responses). </td><td data-label="Required contract for script.toc.js and convert.py"> convert.py should place tables/headings inside <code>#content</code> (or <code>#tables-viewer</code> fallback). script.toc.js uses <code>contentSelector: &#x27;#content&#x27;</code> — must exist or JS will fallback to <code>#tables-viewer</code> or <code>document.body</code>. </td></tr><tr><td data-label="Element / ID"> <code>#tables-viewer</code>                                         </td><td data-label="Purpose in index.html"> Client-side container for interactive tables (routeHtmlToAreas inserts HTML here). </td><td data-label="Required contract for script.toc.js and convert.py"> convert.py HTML may be routed here. script.toc.js observes this region via MutationObserver fallback; ensure selectors present.                                                                                     </td></tr><tr><td data-label="Element / ID"> <code>#page-area</code>                                             </td><td data-label="Purpose in index.html">                                                     Full-page HTML rendering area. </td><td data-label="Required contract for script.toc.js and convert.py"> If server returns full page HTML, <code>routeHtmlToAreas</code> places it here. script.toc.js should ignore full-page payloads (TOC rebuild still safe).                                                                       </td></tr><tr><td data-label="Element / ID"> <code>#toc</code> / <code>#tocList</code>                                      </td><td data-label="Purpose in index.html">                                                      Main TOC container in header. </td><td data-label="Required contract for script.toc.js and convert.py"> Must be present if top TOC expected. script.toc.js silently no-ops if absent. convert.py does not produce it.                                                                                                       </td></tr><tr><td data-label="Element / ID"> <code>#tocBar</code> / <code>#tocBarList</code>                                </td><td data-label="Purpose in index.html">                                      TOC bar in tables viewer (single-line links). </td><td data-label="Required contract for script.toc.js and convert.py"> script.toc.js populates <code>#tocBarList</code>. Keep <code>#tocBarList</code> as <code>&lt;ul&gt;</code> for predictable insertion.                                                                                                                      </td></tr><tr><td data-label="Element / ID"> <code>#stickyMainHeader</code>                                      </td><td data-label="Purpose in index.html">                                       Sticky header used to compute scroll offset. </td><td data-label="Required contract for script.toc.js and convert.py"> If present, script.toc.js reads <code>offsetHeight</code> to adjust scroll target. If absent, offset = 0.                                                                                                                      </td></tr><tr><td data-label="Element / ID"> <code>&lt;textarea id=&quot;paste&quot;&gt;</code> & <code>&lt;form id=&quot;render-form&quot;&gt;</code>      </td><td data-label="Purpose in index.html">                                                                  Paste/convert UI. </td><td data-label="Required contract for script.toc.js and convert.py"> <code>render-form</code> must be non-submitting or JS prevents submit (index already prevents). convert.py receives server POST if used; not required for TOC.                                                                 </td></tr><tr><td data-label="Element / ID"> <code>&lt;!-- PTT-CAPTION:base:Caption text --&gt;</code> (comment nodes) </td><td data-label="Purpose in index.html">                       Optional server-side comment to inject captions client-side. </td><td data-label="Required contract for script.toc.js and convert.py"> index.html includes <code>injectPTTCaptionsFromComments()</code> to convert comments into <code>&lt;caption class=&quot;table-caption&quot;&gt;</code>. convert.py may produce such comments — loader will convert them to real captions before TOC init. </td></tr><tr><td data-label="Element / ID"> <code>#tables-placeholder</code>                                    </td><td data-label="Purpose in index.html">                                                  Placeholder when no tables exist. </td><td data-label="Required contract for script.toc.js and convert.py"> Optional. No direct contract, used by UI.                                                                                                                                                                           </td></tr><tr><td data-label="Element / ID"> <code>#status</code>, <code>#resultCount</code>                                </td><td data-label="Purpose in index.html">                                                                       UX feedback. </td><td data-label="Required contract for script.toc.js and convert.py"> Save/copy handlers update status; not used by TOC but useful in test assertions for save actions.                                                                                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table4" data-table="Docu_0119_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by convert.py (server)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">convert.py (server)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by index.html placeholder / hook"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">index.html placeholder / hook</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by script.toc.js consumer &amp; logic"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">script.toc.js consumer & logic</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="convert.py (server)"> <code>render_table()</code> produces <code>&lt;h3 class=&quot;table-heading&quot;&gt;</code> before table       </td><td data-label="index.html placeholder / hook"> <code>h3.table-heading</code> present in <code>#content</code>                           </td><td data-label="script.toc.js consumer &amp; logic"> <code>buildItemsFromHeadings()</code> selects <code>h3.table-heading</code>, normalizes text, <code>ensureId(h, &#x27;table-&#x27;)</code>, create TOC link                  </td></tr><tr><td data-label="convert.py (server)"> <code>render_table()</code> may emit <code>&lt;div class=&quot;table-caption&quot;&gt;</code>                   </td><td data-label="index.html placeholder / hook"> <code>.table-caption</code> in DOM (or injected from comment)                 </td><td data-label="script.toc.js consumer &amp; logic"> <code>buildItemsFromHeadings()</code> finds <code>.table-caption</code> and treats like heading                                                         </td></tr><tr><td data-label="convert.py (server)"> <code>render_table()</code> produces <code>&lt;table&gt; &lt;tbody&gt; &lt;tr&gt;…</code>                         </td><td data-label="index.html placeholder / hook"> <code>&lt;table&gt;</code> inside <code>#content</code> / <code>#tables-viewer</code>                     </td><td data-label="script.toc.js consumer &amp; logic"> <code>buildItemsFromSingleTable()</code> uses <code>&lt;tbody&gt;</code> rows (or <code>tr</code> excluding <code>thead</code>) to create <code>row-</code> ids and labels <code>Topic N</code>           </td></tr><tr><td data-label="convert.py (server)"> convert.py may include <code>&lt;!-- PTT-CAPTION:... --&gt;</code> comment                 </td><td data-label="index.html placeholder / hook"> Comments exist in DOM inside <code>#content</code>                            </td><td data-label="script.toc.js consumer &amp; logic"> <code>injectPTTCaptionsFromComments()</code> (index.html init) converts to <code>&lt;caption class=&quot;table-caption&quot;&gt;</code> before invoking <code>PTToc.build()</code> </td></tr><tr><td data-label="convert.py (server)"> convert.py emits noisy heading text (newlines, <code>&lt;br&gt;</code>)                    </td><td data-label="index.html placeholder / hook"> Raw DOM text nodes inside headings                                 </td><td data-label="script.toc.js consumer &amp; logic"> <code>_normalize_heading_text()</code> removes newlines/<code>br</code>, collapses whitespace, trims punctuation for labels/ids                         </td></tr><tr><td data-label="convert.py (server)"> convert.py does not set ids                                               </td><td data-label="index.html placeholder / hook"> No <code>id</code> attributes on headings/rows                                </td><td data-label="script.toc.js consumer &amp; logic"> <code>ensureId()</code> assigns stable IDs (prefix <code>table-</code> / <code>row-</code>), avoids collisions                                                     </td></tr><tr><td data-label="convert.py (server)"> convert.py order of headers/tables                                        </td><td data-label="index.html placeholder / hook"> Document order in <code>#content</code>                                       </td><td data-label="script.toc.js consumer &amp; logic"> <code>document.querySelectorAll</code> returns nodes in document order; JS preserves order when generating TOC entries                       </td></tr><tr><td data-label="convert.py (server)"> convert.py produces table wrappers <code>.table-wrapper</code> (initially opacity 0) </td><td data-label="index.html placeholder / hook"> CSS in index.html sets <code>.table-wrapper</code> opacity 0 and reveal logic </td><td data-label="script.toc.js consumer &amp; logic"> <code>revealWrappers()</code> toggles opacity to 1 after DOM ready; MutationObserver ensures wrappers are revealed after dynamic updates     </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table5" data-table="Docu_0119_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Symptom"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Symptom</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Probable Root Cause"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Probable Root Cause</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Mitigation / Test"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Mitigation / Test</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Symptom"> No TOC rendered                                    </td><td data-label="Probable Root Cause"> <code>#tocList</code> / <code>#tocBarList</code> missing OR JS not loaded                                                          </td><td data-label="Mitigation / Test"> Verify script order (<code>script.toc.js</code> loaded deferred), ensure UL IDs exist. Add smoke test to assert presence after init.                                                                                                                                                </td></tr><tr><td data-label="Symptom"> TOC entries but clicking scrolls to wrong position </td><td data-label="Probable Root Cause"> Sticky header height misread (dynamic change after click)                                                    </td><td data-label="Mitigation / Test"> Recompute headerHeight on click (already done). Test with large header heights; assert final element visible.                                                                                                                                                            </td></tr><tr><td data-label="Symptom"> Duplicate IDs appended repeatedly on rebuild       </td><td data-label="Probable Root Cause"> <code>ensureId()</code> generating new id because previous id was not persisted or DOM replaced without id preservation </td><td data-label="Mitigation / Test"> Convert.py should not re-render with different structure; if client-side re-render replaces nodes, ensure nodes are stable or server includes <code>data-stable-id</code> attribute to preserve. Add test to ensure calling <code>PTToc.build()</code> twice yields same anchors for same DOM. </td></tr><tr><td data-label="Symptom"> Empty TOC items in single-table mode               </td><td data-label="Probable Root Cause"> Table <code>&lt;tbody&gt;</code> empty or server emitted rows as <code>&lt;div&gt;</code> not <code>&lt;tr&gt;</code>                                           </td><td data-label="Mitigation / Test"> Ensure convert.py emits <code>&lt;tr&gt;</code> rows. Add parser assertion.                                                                                                                                                                                                               </td></tr><tr><td data-label="Symptom"> Caption comment injection missed                   </td><td data-label="Probable Root Cause"> Comment format mismatch or comment nodes outside walker root                                                 </td><td data-label="Mitigation / Test"> Validate comments presence and that <code>injectPTTCaptionsFromComments()</code> runs before TOC init. Use unit test that inserts comment and checks caption creation.                                                                                                              </td></tr><tr><td data-label="Symptom"> Accessibility regressions                          </td><td data-label="Probable Root Cause"> Links missing <code>aria-label</code> or <code>role</code>                                                                         </td><td data-label="Mitigation / Test"> Tests to verify <code>aria-current</code> toggles and each anchor has <code>aria-label</code> and <code>data-pt-target</code>.                                                                                                                                                                            </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table6" data-table="Docu_0119_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Area"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Area</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Test Scope"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Test Scope</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Area"> <strong>Basic Initialization</strong>           </td><td data-label="Test Scope"> Load <code>index.html</code> with <code>script.toc.js</code> stubbed. Assert <code>window.PTToc</code> exists and <code>PTToc.init</code> is a function.                                                                                                       </td></tr><tr><td data-label="Area"> <strong>Heading Mode</strong>                   </td><td data-label="Test Scope"> Insert 2 headings and 2 tables into <code>#content</code>. Run <code>PTToc.build()</code>. Assert <code>#tocList &gt; li &gt; a</code> count is 2, labels normalized, and each <code>href</code> points to <code>#table-…</code>.                                               </td></tr><tr><td data-label="Area"> <strong>Single-Table Row Mode</strong>          </td><td data-label="Test Scope"> Insert one table with multiple <code>&lt;tr&gt;</code> rows. Run <code>PTToc.build()</code>. Assert <code>#tocBarList</code> entry count equals the number of rows and labels resolve to <code>Topic 1</code>, <code>Topic 2</code>, etc.                                       </td></tr><tr><td data-label="Area"> <strong>Caption Injection from Comment</strong> </td><td data-label="Test Scope"> Place <code>&lt;!-- PTT-CAPTION:base:My Cap --&gt;</code> before a table. Run <code>injectPTTCaptionsFromComments()</code> then <code>PTToc.build()</code>. Assert <code>&lt;caption class=&quot;table-caption&quot;&gt;My Cap&lt;/caption&gt;</code> exists and TOC includes the caption. </td></tr><tr><td data-label="Area"> <strong>ID Uniqueness</strong>                  </td><td data-label="Test Scope"> Create two headings with identical text. Run <code>PTToc.build()</code>. Assert both anchors exist and their generated IDs are unique (<code>table-x</code>, <code>table-x-1</code>).                                                               </td></tr><tr><td data-label="Area"> <strong>Scroll Offset</strong>                  </td><td data-label="Test Scope"> Set <code>#stickyMainHeader</code> height to 80 px. Simulate clicking an anchor. Assert scroll target subtracts the 80 px offset (stub <code>getBoundingClientRect</code>).                                                              </td></tr><tr><td data-label="Area"> <strong>MutationObserver Rebuild</strong>       </td><td data-label="Test Scope"> Run <code>PTToc.build()</code>. Append a new heading and table. Assert TOC updates after debounce.                                                                                                                            </td></tr><tr><td data-label="Area"> <strong>Resilience</strong>                     </td><td data-label="Test Scope"> Remove <code>#tocList</code> (set to <code>null</code>). Run <code>PTToc.build()</code>. Assert no uncaught exceptions occur.                                                                                                                       </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table7" data-table="Docu_0119_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Contract Area"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Contract Area</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Requirement"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Requirement</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Contract Area"> <strong>Content Root Presence</strong>         </td><td data-label="Requirement"> <code>#content</code> must exist, or <code>#tables-viewer</code> must exist. If missing, PTTOC falls back to <code>document.body</code> (functional but noisy).                                                                   </td></tr><tr><td data-label="Contract Area"> <strong>Table Row Structure</strong>           </td><td data-label="Requirement"> All server-generated tables must contain <code>&lt;tbody&gt;</code> for data rows. Without <code>&lt;tbody&gt;</code>, JS row selection may mis-handle edge cases (e.g., nested tables).                                           </td></tr><tr><td data-label="Contract Area"> <strong>Heading Selector Coverage</strong>     </td><td data-label="Requirement"> <code>convert.py</code> must emit one of: <code>h3.table-heading</code>, <code>div.table-caption</code>, or any <code>*.table-heading</code>. Missing headings cause missing TOC entries and may trigger single-table fallback.              </td></tr><tr><td data-label="Contract Area"> <strong>No Pre-existing ID Collisions</strong> </td><td data-label="Requirement"> <code>convert.py</code> must avoid generating IDs that deliberately collide with reserved patterns (<code>table-…</code>, <code>row-…</code>). JS will suffix collisions safely, but server should not create them intentionally. </td></tr><tr><td data-label="Contract Area"> <strong>Sticky Header Element</strong>         </td><td data-label="Requirement"> <code>#stickyMainHeader</code> must exist when layout uses a sticky header. If present but dynamically sized, scroll offset may vary; JS reads <code>offsetHeight</code> at click time.                                </td></tr><tr><td data-label="Contract Area"> <strong>PTT-CAPTION Comment Format</strong>    </td><td data-label="Requirement"> Must match <code>PTT-CAPTION:&lt;base&gt;:&lt;caption text&gt;</code>. Incorrect formats are ignored, and caption injection will not occur.                                                                             </td></tr><tr><td data-label="Contract Area"> <strong>TOC Containers</strong>                </td><td data-label="Requirement"> At least one of <code>#tocList</code> or <code>#tocBarList</code> must exist when a TOC is expected. If missing, JS no-ops and TOC does not render (no error thrown, but functionality lost).                          </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><div class="table-caption" id="Table8" data-table="Docu_0119_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Area**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Area</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **convert.py Output / Behavior**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>convert.py Output / Behavior</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **script.toc.js Logic / Behavior**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>script.toc.js Logic / Behavior</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Compatibility Point**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Compatibility Point</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Area"> <strong>Heading Detection</strong>             </td><td data-label="convert.py Output / Behavior"> Emits headings via:<br>• <code>&lt;h3 class=&quot;table-heading&quot;&gt;…&lt;/h3&gt;</code><br>• Optional <code>&lt;div class=&quot;table-caption&quot;&gt;…&lt;/div&gt;</code> </td><td data-label="script.toc.js Logic / Behavior"> Uses selector:<br><code>h3.table-heading, .table-caption, .table-heading</code>                      </td><td data-label="Compatibility Point"> JS matches every heading/caption Python emits.                    </td></tr><tr><td data-label="Area"> <strong>ID Generation</strong>                 </td><td data-label="convert.py Output / Behavior"> Provides no IDs for headings, tables, or rows.                                                                 </td><td data-label="script.toc.js Logic / Behavior"> Auto-generates unique, collision-safe IDs.                                                </td><td data-label="Compatibility Point"> ID system fully JS-driven; Python remains clean.                  </td></tr><tr><td data-label="Area"> <strong>Single-Table Mode</strong>             </td><td data-label="convert.py Output / Behavior"> Produces one table with <code>&lt;tbody&gt;</code> rows.                                                                        </td><td data-label="script.toc.js Logic / Behavior"> Detects single table and generates “Topic 1, Topic 2…” from rows.                         </td><td data-label="Compatibility Point"> Row-based TOC is triggered correctly.                             </td></tr><tr><td data-label="Area"> <strong>Multi-Table Mode</strong>              </td><td data-label="convert.py Output / Behavior"> Emits multiple tables, each with its own heading.                                                              </td><td data-label="script.toc.js Logic / Behavior"> Detects multiple headings and builds TOC sections.                                        </td><td data-label="Compatibility Point"> Table-heading mode is aligned with Python output.                 </td></tr><tr><td data-label="Area"> <strong>Content Root Structure</strong>        </td><td data-label="convert.py Output / Behavior"> Wraps output in:<br><code>&lt;div id=&quot;content&quot;&gt; … &lt;/div&gt;</code>                                                              </td><td data-label="script.toc.js Logic / Behavior"> Uses <code>#content</code> as primary root; falls back to alternatives only if missing.              </td><td data-label="Compatibility Point"> Root-level structure matches exactly.                             </td></tr><tr><td data-label="Area"> <strong>Sticky Header Offset</strong>          </td><td data-label="convert.py Output / Behavior"> Layout uses <code>id=&quot;stickyMainHeader&quot;</code>.                                                                           </td><td data-label="script.toc.js Logic / Behavior"> Scroll logic subtracts header height for alignment.                                       </td><td data-label="Compatibility Point"> Scrolling behavior matches Python’s page layout.                  </td></tr><tr><td data-label="Area"> <strong>Anchor Link Containers</strong>        </td><td data-label="convert.py Output / Behavior"> Template provides:<br>• <code>#tocList</code><br>• <code>#tocBarList</code>                                                          </td><td data-label="script.toc.js Logic / Behavior"> JS populates these containers with TOC items.                                             </td><td data-label="Compatibility Point"> Containers expected by JS are present.                            </td></tr><tr><td data-label="Area"> <strong>Anchor Structure & Navigation</strong> </td><td data-label="convert.py Output / Behavior"> Static HTML only; no IDs or navigation hooks.                                                                  </td><td data-label="script.toc.js Logic / Behavior"> JS builds anchors, manages hash updates, smooth scrolling, and active-state highlighting. </td><td data-label="Compatibility Point"> Navigation layer is fully compatible with Python’s static output. </td></tr><tr><td data-label="Area"> <strong>Overall Alignment</strong>             </td><td data-label="convert.py Output / Behavior"> Emits headings, tables, captions, and structure consistently.                                                  </td><td data-label="script.toc.js Logic / Behavior"> Detects single/multi modes, normalizes text, builds IDs, and renders TOC.                 </td><td data-label="Compatibility Point"> Full compatibility. No mismatches identified.                     </td></tr></tbody></table></div><div class="row-count">Rows: 9</div></div><div class="table-caption" id="Table9" data-table="Docu_0119_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Area**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Area</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Before Revision (Observed in your current server.py + core_renderer.py)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Before Revision (Observed in your current server.py + core_renderer.py)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **After Revision — Final Corrected Structure (Expanded Technical Description)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>After Revision — Final Corrected Structure (Expanded Technical Description)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Area"> <strong>1. Request Context Architecture</strong>      </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> No unified <code>request_ctx</code> object exists. server.py extracts action/fromList/client_req_id but never forwards a structured context into the renderer. core_renderer.inject_captions() expects such context but never receives it, leaving its gating logic fully disconnected from actual request flows. </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Introduce a single authoritative <code>request_ctx</code> structure constructed in server.py and passed directly into renderer entry points: <code>{action, client_req_id, group_id, fromList, source, book_prefix}</code>. renderer-side logic can reliably determine whether captions should be injected. Eliminates all ambiguity and ensures complete alignment between HTTP layer and render pipeline. </td></tr><tr><td data-label="Area"> <strong>2. Action/Source Propagation</strong>         </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> server.py receives action=="load_group" from the client but never sets meta["action"] nor meta["source"]. Fragments therefore lack the required meta.source="group_load", preventing caption-eligible fragments from passing injection gates.                                                          </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Establish strict propagation: when group-load occurs, server explicitly sets <code>request_ctx.action=&quot;load_group&quot;</code> and assigns all fragments <code>meta.source=&quot;group_load&quot;</code> and <code>meta.sanitized=True</code> (post-sanitization phase). Guarantees correct state for each fragment before injection.                                                                                                 </td></tr><tr><td data-label="Area"> <strong>3. Caption Injection Trigger Path</strong>    </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> inject_captions() is never called anywhere. render_html() does not invoke it, and server.py never invokes it, resulting in zero caption payloads regardless of client request.                                                                                                                         </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Define a single deterministic trigger location: before final HTML is generated, renderer receives fragments_map + request_ctx and calls inject_captions() one time. If request_ctx matches gating criteria, fragment metadata is enriched with caption fields and meta.injected=True. No other layer invokes injection.                                                               </td></tr><tr><td data-label="Area"> <strong>4. Rendering Pipeline Contract</strong>       </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> Pipeline unclear: render_html() expects fragment metadata to be pre-injected, but no upstream code performs injection. html_renderer attempts to infer injection status from output HTML, generating inconsistent flows.                                                                               </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Establish a stable 3-stage contract: (1) fragments built, sanitized, sourced; (2) caption injection applied according to strict rules; (3) HTML construction emits deterministic payload blocks. html_renderer becomes a passive consumer of well-defined metadata rather than an inference layer.                                                                                    </td></tr><tr><td data-label="Area"> <strong>5. Fragment Metadata Structure</strong>       </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> meta structures differ depending on origin modules. Keys like meta.sanitized, meta.source, table_meta.caption_ids, table_meta.stable_block_id are not guaranteed. Missing fields cause injection to silently skip.                                                                                     </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Normalization phase ensures every fragment has canonical metadata: <code>meta.source</code>, <code>meta.sanitized</code>, <code>meta.injected</code>, and <code>table_meta</code> (with guaranteed fields). Injection logic relies on a normalized, validated metadata graph. Eliminates inconsistent outcomes and silent bypasses.                                                                                               </td></tr><tr><td data-label="Area"> <strong>6. Required Gating Enforcement</strong>       </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> inject_captions() has strict conditions but since request_ctx and meta.source/meta.sanitized never align, no fragment ever becomes eligible. Actual gating never occurs.                                                                                                                               </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Gating rules become meaningful: injection executes only when <code>request_ctx.action==&quot;load_group&quot;</code> AND <code>fragment.meta.source==&quot;group_load&quot;</code> AND <code>fragment.meta.sanitized==True</code>. Any mismatch results in clean skip with visible logs. Ensures safety and predictability.                                                                                                                </td></tr><tr><td data-label="Area"> <strong>7. Table Identifier Reliability</strong>      </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> Many fragments lack table_id or data-table-id. Downstream JS must guess table identifiers, which often fails, especially for complex group loads.                                                                                                                                                      </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Introduce guaranteed ID assignment using deterministic sequences or stable hashes. Each table has stable <code>table_id</code> and <code>data_table_id</code> before injection. Downstream script never needs to guess or reconstruct identifiers.                                                                                                                                                          </td></tr><tr><td data-label="Area"> <strong>8. Caption Grouping & Ordering</strong>       </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> Captions belonging to the same group (multi-table cluster) may appear out of order due to nondeterministic dict iteration or missing caption_seq.                                                                                                                                                      </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Revised grouping: group fragments by group_id; deterministically order them via caption_seq or fallback stable index ordering. Injection always returns stable, repeatable ordering independent of run or environment.                                                                                                                                                                </td></tr><tr><td data-label="Area"> <strong>9. Caption HTML Handling</strong>             </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> Some captions use raw HTML, sometimes sanitized, sometimes stripped; inconsistent across modules. Payload size may become excessive.                                                                                                                                                                   </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Caption HTML must be sanitized upstream; renderer enforces this requirement. Payload reduces HTML to safe, trimmed, text-oriented content. Prevents unsafe HTML, reduces payload size, and keeps client parsing deterministic.                                                                                                                                                        </td></tr><tr><td data-label="Area"> <strong>10. Payload Builder Logic</strong>            </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> payload shapes vary across calls. Some keys omitted, some structure inconsistent, leading to client desync.                                                                                                                                                                                            </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Standardize payload object: <code>{ table_id, data_table_id, caption_html, caption_ids, group_id, source, order }</code>. Each injection event produces a predictable schema. Downstream JS becomes fully deterministic.                                                                                                                                                                         </td></tr><tr><td data-label="Area"> <strong>11. Payload Serialization & Emission</strong> </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> Multiple modules (core_renderer, html_renderer) independently assemble or modify payloads, creating duplicate or mismatched scripts inside final HTML.                                                                                                                                                 </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> payload generation centralized in core_renderer. html_renderer only embeds already-complete payloads. Final HTML includes exactly one <code>&lt;script data-caption-payload&gt;</code> per injected fragment and one window.PTT bootstrap script.                                                                                                                                                      </td></tr><tr><td data-label="Area"> <strong>12. Duplicate Injection Prevention</strong>   </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> Re-renders or retries can accidentally re-inject captions because no idempotency check exists.                                                                                                                                                                                                         </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Injection is idempotent: if meta.injected==True, injection skips the fragment. Guarantees no duplicate payloads even under retry, fallback, or repeated render calls.                                                                                                                                                                                                                 </td></tr><tr><td data-label="Area"> <strong>13. Logging Model</strong>                    </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> Logging dispersed and inconsistent; fails to expose why injection didn't happen. Hard to trace group-load failures.                                                                                                                                                                                    </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Structured lifecycle logging: gating decision, grouping formation, ID assignment, injection start/end, skip reasons, payload emission. Debug-level logs show deep metadata and grouping state.                                                                                                                                                                                        </td></tr><tr><td data-label="Area"> <strong>14. Error Tolerance & Fallbacks</strong>      </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> Missing metadata or malformed fragments often cause hidden failures or exceptions that break rendering.                                                                                                                                                                                                </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Defensive guards across all stages: if metadata invalid, injection skips safely with logs; rendering continues normally. Renderer never crashes due to malformed caption meta.                                                                                                                                                                                                        </td></tr><tr><td data-label="Area"> <strong>15. Server–Renderer Interface</strong>        </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> server.py expects a renderer exposing render_from_text/convert_text_to_html; core_renderer offers only render_html() and inject_captions(). Integration incomplete.                                                                                                                                    </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Provide thin compatibility wrapper: render_from_text(text, request_ctx) → fragments → inject_captions() → final html/meta. Ensures seamless integration with server’s fallback resolution chain without rewriting server logic.                                                                                                                                                       </td></tr><tr><td data-label="Area"> <strong>16. Client-Side Dependency Reduction</strong> </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> Client JS often infers ordering, IDs, and grouping, leading to mismatches and inconsistent caption placement.                                                                                                                                                                                          </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Server provides authoritative canonical payload ordering. Client only performs deterministic injection using given IDs. Eliminates heuristics on the client side.                                                                                                                                                                                                                     </td></tr><tr><td data-label="Area"> <strong>17. End-to-End Contract Stability</strong>    </td><td data-label="Before Revision (Observed in your current server.py + core_renderer.py)"> End-to-end behavior differs depending on which internal module executed first. Payloads unstable across runs.                                                                                                                                                                                          </td><td data-label="After Revision — Final Corrected Structure (Expanded Technical Description)"> Revised pipeline ensures: identical inputs → identical fragments → identical payload order → identical script emission → identical client behavior. Fully deterministic, repeatable system.                                                                                                                                                                                           </td></tr></tbody></table></div><div class="row-count">Rows: 17</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>