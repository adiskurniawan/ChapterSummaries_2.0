<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1760503065">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8017_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Concept / Functionality**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Concept / Functionality</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Unified Understanding (Table Viewer 2.1 vs PasteToTable)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Unified Understanding (Table Viewer 2.1 vs PasteToTable)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Concept / Functionality"> <strong>Core parsing and sanitization</strong> </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> Must be identical. Use Table Viewer 2.1’s tested logic for markdown table parsing, sanitization, inline code, escaped pipes, and consistent DataFrame cleaning.                  </td></tr><tr><td data-label="Concept / Functionality"> <strong>Rendering logic</strong>               </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> Use the same <code>render_df_to_html_preserve_code</code> and fallback HTML builder from TV2.1. No typographic differences allowed.                                                         </td></tr><tr><td data-label="Concept / Functionality"> <strong>Entry behavior</strong>                </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> PasteToTable must support both <strong>web server</strong> (<code>create_app</code>) and <strong>batch</strong> (<code>--batch</code> or env var). TV2.1 runs <strong>batch only</strong>.                                                    </td></tr><tr><td data-label="Concept / Functionality"> <strong>Configuration system</strong>          </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> PasteToTable must call <code>load_env()</code> and read runtime config. TV2.1 uses hard-coded paths.                                                                                        </td></tr><tr><td data-label="Concept / Functionality"> <strong>Logging</strong>                       </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> PasteToTable uses <code>make_logger</code>. TV2.1 prints to console. Replace all prints with logger calls in unified version.                                                               </td></tr><tr><td data-label="Concept / Functionality"> <strong>Dependency handling</strong>           </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> PasteToTable should import <code>pandas</code> only inside functions (lazy import). TV2.1 imports at top level.                                                                             </td></tr><tr><td data-label="Concept / Functionality"> <strong>Error handling</strong>                </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> PasteToTable must catch and log errors safely to prevent server crashes. TV2.1 can fail fast.                                                                                    </td></tr><tr><td data-label="Concept / Functionality"> <strong>Renderer loading</strong>              </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> PasteToTable must import both <code>create_app</code> (for web) and <code>_load_renderer_callable()</code> (for batch). TV2.1 loads <code>render_html</code> dynamically.                                         </td></tr><tr><td data-label="Concept / Functionality"> <strong>File output</strong>                   </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> Both must output deterministic <code>.html</code> files. PasteToTable should use <code>ensure_dir()</code> and avoid touching locked folders.                                                          </td></tr><tr><td data-label="Concept / Functionality"> <strong>Platform compatibility</strong>        </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> Keep <code>freeze_support()</code> for Windows compatibility.                                                                                                                               </td></tr><tr><td data-label="Concept / Functionality"> <strong>Benchmark requirement</strong>         </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> Typography and output must visually match Book_9001 benchmark exactly.                                                                                                           </td></tr><tr><td data-label="Concept / Functionality"> <strong>Result</strong>                        </td><td data-label="Unified Understanding (Table Viewer 2.1 vs PasteToTable)"> Final merged <code>main.py</code> = Table Viewer 2.1 logic inside PasteToTable framework, safe for both web and batch, logger-based, config-driven, typographically identical to benchmark. </td></tr></tbody></table></div><div class="row-count">Rows: 12</div></div><div class="table-caption" id="Table2" data-table="Book_8017_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by File"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Strategy"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Strategy</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Reason"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Reason</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"> main.py                </td><td data-label="Strategy"> <strong>M (merge)</strong>   </td><td data-label="Reason"> Merge Table Viewer <code>main.py</code> features (world-class CLI, parser hooks, config-driven flags) into PasteToTable <code>main.py</code>. Preserve PasteToTable runtime and add Table Viewer options. </td></tr><tr><td data-label="File"> server.py              </td><td data-label="Strategy"> <strong>M (merge)</strong>   </td><td data-label="Reason"> Merge Table Viewer server-safe parsing endpoints and input validation while preserving existing Flask behavior and data flow.                                                       </td></tr><tr><td data-label="File"> html_renderer.py       </td><td data-label="Strategy"> <strong>M (merge)</strong>   </td><td data-label="Reason"> Integrate Table Viewer markdown→HTML rendering and inline-code handling into <code>html_renderer.py</code> for web output. Keep web routes and streaming intact.                               </td></tr><tr><td data-label="File"> utils.py               </td><td data-label="Strategy"> <strong>M (merge)</strong>   </td><td data-label="Reason"> Merge Table Viewer helpers (parsing utilities, canonicalization, robust logging) into <code>utils.py</code>. Ensure no duplicate responsibilities with locked <code>render/</code>.                       </td></tr><tr><td data-label="File"> templates/index.html   </td><td data-label="Strategy"> <strong>R (replace)</strong> </td><td data-label="Reason"> Replace with Table Viewer 2.1 base/table split template adapted to PasteToTable route names and configuration. Must match typography exactly.                                       </td></tr><tr><td data-label="File"> assets/script.js       </td><td data-label="Strategy"> <strong>M (merge)</strong>   </td><td data-label="Reason"> Keep current collapse logic. Merge Table Viewer client features: persistence, copy-to-clipboard, export hooks. Maintain compatibility with locked <code>style.css</code>.                      </td></tr><tr><td data-label="File"> assets/worker.js       </td><td data-label="Strategy"> <strong>M (merge)</strong>   </td><td data-label="Reason"> Add Table Viewer optional client-worker tasks where appropriate. Keep backwards-compatible progressive enhancement.                                                                 </td></tr><tr><td data-label="File"> render/convert.py      </td><td data-label="Strategy"> <strong>X (locked)</strong>  </td><td data-label="Reason"> <strong>Locked</strong>. Cannot be changed. Table Viewer parsing logic must be adapted into the editable files above or wrapped without modifying this file.                                     </td></tr><tr><td data-label="File"> render/core.py         </td><td data-label="Strategy"> <strong>X (locked)</strong>  </td><td data-label="Reason"> <strong>Locked</strong>. No edits allowed.                                                                                                                                                       </td></tr><tr><td data-label="File"> render/markdown.py     </td><td data-label="Strategy"> <strong>X (locked)</strong>  </td><td data-label="Reason"> <strong>Locked</strong>. No edits allowed.                                                                                                                                                       </td></tr><tr><td data-label="File"> render/sanitize.py     </td><td data-label="Strategy"> <strong>X (locked)</strong>  </td><td data-label="Reason"> <strong>Locked</strong>. No edits allowed.                                                                                                                                                       </td></tr><tr><td data-label="File"> render/io_utils.py     </td><td data-label="Strategy"> <strong>X (locked)</strong>  </td><td data-label="Reason"> <strong>Locked</strong>. No edits allowed.                                                                                                                                                       </td></tr><tr><td data-label="File"> render/* (other files) </td><td data-label="Strategy"> <strong>X (locked)</strong>  </td><td data-label="Reason"> <strong>Locked</strong>. All files under <code>render/</code> are immutable per user rule.                                                                                                                  </td></tr><tr><td data-label="File"> assets/style.css       </td><td data-label="Strategy"> <strong>X (locked)</strong>  </td><td data-label="Reason"> <strong>Locked</strong>. Must not be modified. Table Viewer typography must be matched by adapting templates and JS only.                                                                        </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><div class="table-caption" id="Table3" data-table="Book_8017_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Analysis / Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Analysis / Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>File snapshot</strong>                  </td><td data-label="Analysis / Notes"> The script is about 100 KB, built in plain JavaScript. It defines <code>window.PasteToTable</code> as the main namespace. Functions include UI init, event binding, conversion, and DOM rendering. No frameworks. Uses a few ES6+ features and a MutationObserver.                                                                                                                </td></tr><tr><td data-label="Section"> <strong>Observable issue</strong>               </td><td data-label="Analysis / Notes"> When you click <strong>Convert</strong>, the toolbar buttons appear to move or duplicate.  <br>1️⃣ Movement → layout / flex reflow.  <br>2️⃣ Duplication → JS is appending new HTML without removing the old one.                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Core cause zones</strong>               </td><td data-label="Analysis / Notes"> 1️⃣ Functions: <code>renderConvertedTables</code>, <code>updateViewer</code>, <code>refreshTableEvents</code>.  <br>2️⃣ Patterns: <code>insertAdjacentHTML</code>, <code>appendChild</code>, <code>innerHTML +=</code>.  <br>3️⃣ Observers: watching <code>#tables-viewer</code>.  <br>4️⃣ Bindings: direct <code>.addEventListener</code> inside <code>initUI()</code>.                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Append vs Replace</strong>              </td><td data-label="Analysis / Notes"> 1️⃣ <code>insertAdjacentHTML(&#x27;beforeend&#x27;, html)</code> adds → duplicates.  <br>2️⃣ <code>appendChild(fragment)</code> adds → duplicates.  <br>3️⃣ <code>innerHTML = html</code> replaces → safe.  <br>4️⃣ Best: <code>replaceChildren(fragment)</code> — atomic, removes previous nodes and their listeners.                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Recommended injection block</strong> </td><td data-label="Analysis / Notes"> <code>js&amp;lt;br&amp;gt;const tpl = document.createElement(&#x27;template&#x27;);&amp;lt;br&amp;gt;tpl.innerHTML = safeHtml.trim();&amp;lt;br&amp;gt;const frag = tpl.content;&amp;lt;br&amp;gt;if (window.PasteToTable.observer) window.PasteToTable.observer.disconnect();&amp;lt;br&amp;gt;container.replaceChildren(frag);&amp;lt;br&amp;gt;if (window.PasteToTable.observer) window.PasteToTable.observer.observe(container, window.PasteToTable.__observerOpts);</code> </td></tr><tr><td data-label="Section"> <strong>Convert button safety</strong>          </td><td data-label="Analysis / Notes"> 1️⃣ Add idempotent guard:  <br><code>js&lt;br&gt;if (!window.PasteToTable.__convertBound) {&lt;br&gt; convertBtn.addEventListener(&#x27;click&#x27;, onConvert);&lt;br&gt; window.PasteToTable.__convertBound = true;&lt;br&gt;}&lt;br&gt;</code>  <br>2️⃣ Optionally debounce inside <code>onConvert</code> to block double clicks: <code>if (busy) return;</code>.                                                                            </td></tr><tr><td data-label="Section"> <strong>Event delegation</strong>               </td><td data-label="Analysis / Notes"> 1️⃣ Replace per-node bindings with one delegated listener:  <br><code>js&lt;br&gt;document.addEventListener(&#x27;click&#x27;, e =&gt; {&lt;br&gt; const btn = e.target.closest(&#x27;[data-action]&#x27;);&lt;br&gt; if (btn) handleAction(btn);&lt;br&gt;});&lt;br&gt;</code>  <br>2️⃣ Generated buttons keep <code>data-action</code> attributes only.  <br>3️⃣ Removes risk of multiple handlers on each re-render.                           </td></tr><tr><td data-label="Section"> <strong>Visual movement vs duplicates</strong>  </td><td data-label="Analysis / Notes"> 1️⃣ Movement → Flex wrap re-flow as table width recalculates.  <br>2️⃣ Duplication → Old <code>.table-wrapper</code> still present under new one.  <br>3️⃣ To test, run <code>$$(&#x27;#tables-viewer .table-wrapper&#x27;).length</code> before and after Convert.  <br>4️⃣ If the number increases, duplication confirmed.                                                                           </td></tr><tr><td data-label="Section"> <strong>Quick hotfix (non-destructive)</strong> </td><td data-label="Analysis / Notes"> <code>js&lt;br&gt;const existing = container.querySelectorAll(&#x27;.table-wrapper&#x27;);&lt;br&gt;existing.forEach(n =&gt; n.remove());&lt;br&gt;container.insertAdjacentHTML(&#x27;beforeend&#x27;, html);&lt;br&gt;</code>  <br>Removes old wrappers before appending. Works even if other code expects append.                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Atomic replace (preferred)</strong>     </td><td data-label="Analysis / Notes"> <code>js&lt;br&gt;const tpl = document.createElement(&#x27;template&#x27;);&lt;br&gt;tpl.innerHTML = html;&lt;br&gt;container.replaceChildren(tpl.content);&lt;br&gt;</code>  <br>This single call deletes prior children and inserts new DOM safely.                                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>Observer debounce</strong>              </td><td data-label="Analysis / Notes"> 1️⃣ If observer triggers many small updates, wrap callback:  <br><code>js&lt;br&gt;let moTimer=null;&lt;br&gt;observer=new MutationObserver(muts=&gt;{&lt;br&gt; clearTimeout(moTimer);&lt;br&gt; moTimer=setTimeout(()=&gt;handleMutations(muts),80);&lt;br&gt;});&lt;br&gt;</code>  <br>2️⃣ Reduces duplicate reactions.                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Layout lock (optional CSS)</strong>     </td><td data-label="Analysis / Notes"> Add:  <br><code>css&lt;br&gt;.copy-buttons{min-width:220px;}&lt;br&gt;</code>  <br>Keeps toolbar from wrapping during Convert animation.                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Section"> <strong>Inline <code>onclick</code> cleanup</strong>       </td><td data-label="Analysis / Notes"> 1️⃣ Generated HTML uses <code>onclick=&quot;toggleTable(this)&quot;</code>.  <br>2️⃣ If duplication continues, switch to data-action + delegated handler.  <br>3️⃣ Inline handlers run even when node is cloned; delegation avoids that.                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Test checklist (DevTools)</strong>      </td><td data-label="Analysis / Notes"> 1️⃣ Before Convert → <code>$$(&#x27;#tables-viewer .table-wrapper&#x27;).length</code>.  <br>2️⃣ Click Convert → check count again.  <br>3️⃣ If grows → append used.  <br>4️⃣ Insert <code>console.count(&#x27;observer&#x27;)</code> inside MutationObserver to confirm extra triggers.  <br>5️⃣ <code>monitorEvents(document.querySelector(&#x27;#convertBtn&#x27;),&#x27;click&#x27;)</code> to catch multiple binds.                        </td></tr><tr><td data-label="Section"> <strong>Console sanity patch</strong>           </td><td data-label="Analysis / Notes"> <code>js&lt;br&gt;(()=&gt;{&lt;br&gt; const c=document.getElementById(&#x27;tables-viewer&#x27;);&lt;br&gt; const tpl=document.createElement(&#x27;template&#x27;);&lt;br&gt; tpl.innerHTML=c.innerHTML;&lt;br&gt; c.replaceChildren(tpl.content);&lt;br&gt; console.log(&#x27;atomic replace test complete&#x27;);&lt;br&gt;})();&lt;br&gt;</code>  <br>Run this once to prove replacement stops duplication.                                                     </td></tr><tr><td data-label="Section"> <strong>Performance perspective</strong>        </td><td data-label="Analysis / Notes"> 1️⃣ <code>innerHTML</code> re-parsing is fine for tables of a few KB.  <br>2️⃣ If tables become huge, consider incremental render or <code>DocumentFragment</code>.  <br>3️⃣ Atomic replacement keeps observer and events clean, which is better for long sessions.                                                                                                                          </td></tr><tr><td data-label="Section"> <strong>Final trace plan</strong>               </td><td data-label="Analysis / Notes"> 1️⃣ Locate each function that writes to <code>#tables-viewer</code>.  <br>2️⃣ Confirm whether it clears or replaces.  <br>3️⃣ Check observer callback for self-mutation.  <br>4️⃣ Guard <code>initUI()</code> against multiple binds.  <br>5️⃣ Replace append logic with <code>replaceChildren</code>.  <br>6️⃣ Re-test count after Convert.                                                            </td></tr><tr><td data-label="Section"> <strong>Next action choice</strong>             </td><td data-label="Analysis / Notes"> A) I can draft a precise patch (diff-style) to change only the insertion code and add the guards.  <br>B) Or produce a stand-alone console test harness you can run without editing files to confirm root cause.  <br>Pick A or B and I’ll prepare it.                                                                                                                 </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table4" data-table="Book_8017_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Aspect**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Aspect</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **PasteToTable `templates/index.html`**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>PasteToTable <code>templates/index.html</code></strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Benchmark `Book_9001.html` (Tables Viewer v2.1)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Benchmark <code>Book_9001.html</code> (Tables Viewer v2.1)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Task for `assets/script.js` (and possible split plan)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Task for <code>assets/script.js</code> (and possible split plan)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"> <strong>Header actions</strong>                  </td><td data-label="PasteToTable templates/index.html"> Buttons: <code>Export All</code>, <code>Clear</code>, <code>Toggle Paste</code>, <code>Convert</code>, <code>Render</code>, <code>Save</code>. Each uses <code>data-action</code> attributes.                             </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark buttons mostly for Copy All, Collapse All, Theme toggle, Reset.          </td><td data-label="Task for assets/script.js (and possible split plan)"> Implement one unified event delegation handler that maps <code>data-action</code> to functions. Create separate modules: <code>ui_header.js</code> for header controls, <code>export_all.js</code> for multi-table exports.                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Aspect"> <strong>Paste textarea behavior</strong>         </td><td data-label="PasteToTable templates/index.html"> Inline paste box (<code>#paste</code>) inside header. Original <code>#paste-panel</code> hidden for backward compatibility.                                        </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark has no paste box (tables pre-rendered).                                  </td><td data-label="Task for assets/script.js (and possible split plan)"> Add logic in <code>ui_paste.js</code>: manage paste focus, autosize height, and toggle visibility. Ensure no duplication when toggled. Handle hidden legacy <code>#paste-panel</code>.                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Aspect"> <strong>TOC handling</strong>                    </td><td data-label="PasteToTable templates/index.html"> <code>#toc</code> and <code>#tocBar</code> placeholders, lists empty until populated.                                                                              </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark TOC auto-generated from table captions and IDs.                          </td><td data-label="Task for assets/script.js (and possible split plan)"> Add <code>toc.js</code>: scan <code>.table-caption</code> elements, populate both <code>#tocList</code> and <code>#tocBarList</code>. Include click scroll, highlight current table, and responsive collapse on mobile.                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Aspect"> <strong>Table structure / wrappers</strong>      </td><td data-label="PasteToTable templates/index.html"> <code>.table-wrapper</code>, <code>.table-container</code>, <code>.tv-table</code> markup present. Inline <code>onclick</code> attributes call <code>copyTablePlain</code>, <code>exportTableXLSX</code>, etc. </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark tables identical in structure but event handlers wired programmatically. </td><td data-label="Task for assets/script.js (and possible split plan)"> Refactor inline handlers into modular imports. Example: <code>table_copy.js</code> (copy plain/markdown), <code>table_export.js</code> (CSV, JSON, XLSX, PDF), <code>table_toggle.js</code> (collapse/expand), <code>table_sort.js</code> (column sort).                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Aspect"> <strong>Export All / Save / Convert</strong>     </td><td data-label="PasteToTable templates/index.html"> <code>data-action=&quot;export-xlsx&quot;</code> and <code>data-action=&quot;save&quot;</code> present.                                                                                </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark allows per-table exports, not bulk.                                      </td><td data-label="Task for assets/script.js (and possible split plan)"> Build central <code>export_manager.js</code>: iterate <code>.table-wrapper</code> nodes, trigger exports sequentially. Create <code>save_manager.js</code>: bundle tables as HTML, save via Blob. Integrate <code>convert_manager.js</code>: handle <code>/api/render</code> POST request.                                                                                                                                                                                                                   </td></tr><tr><td data-label="Aspect"> <strong>Route HTML fragments</strong>            </td><td data-label="PasteToTable templates/index.html"> Inline script defines <code>PasteToTable.routeHtmlToAreas</code>.                                                                                       </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark doesn’t need routing (static HTML).                                      </td><td data-label="Task for assets/script.js (and possible split plan)"> Move routing into <code>router.js</code>: manage fragment replacement, preserve scroll position, manage fade transitions. Keep fallback <code>window.PasteToTable.routeHtmlToAreas</code> for compatibility.                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Aspect"> <strong>Search box (<code>#search</code>)</strong>          </td><td data-label="PasteToTable templates/index.html"> Present but no JS inlined.                                                                                                                   </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark implements search filter on TOC or table text.                           </td><td data-label="Task for assets/script.js (and possible split plan)"> Add <code>search.js</code>: filter visible <code>.table-wrapper</code> or <code>.table-caption</code> elements by keyword. Highlight matches. Integrate debounce for performance.                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Aspect"> <strong>Table sorting</strong>                   </td><td data-label="PasteToTable templates/index.html"> Buttons <code>.sort-btn sort-state-0</code> exist but no attached logic.                                                                                </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark implements toggle sorting (asc/desc/none).                               </td><td data-label="Task for assets/script.js (and possible split plan)"> Add <code>table_sort.js</code>: detect clicked header, toggle sort order, update visual icon, and sort rows accordingly. Store sort state per table.                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Aspect"> <strong>Collapse table toggle</strong>           </td><td data-label="PasteToTable templates/index.html"> Button <code>.toggle-table-btn</code> triggers <code>toggleTable(this)</code> inline.                                                                              </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark uses dynamic collapse/expand of table body.                              </td><td data-label="Task for assets/script.js (and possible split plan)"> Move logic to <code>table_toggle.js</code>: animate collapse via <code>max-height</code> or <code>display:none</code>. Maintain aria-expanded state.                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Aspect"> <strong>Copy / Export per-table buttons</strong> </td><td data-label="PasteToTable templates/index.html"> Inline <code>onclick=&quot;copyTablePlain(this)&quot;</code>, <code>exportTableCSV(this)</code>, etc.                                                                        </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark uses JS event binding.                                                   </td><td data-label="Task for assets/script.js (and possible split plan)"> Replace inline with delegated event system. Use consistent namespace under <code>window.PasteToTable</code>. Verify each export function uses same utility pipeline.                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Aspect"> <strong>Result count / status</strong>           </td><td data-label="PasteToTable templates/index.html"> Elements <code>#resultCount</code> and <code>#status</code> exist for showing table count or server response.                                                      </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark displays progress and metadata.                                          </td><td data-label="Task for assets/script.js (and possible split plan)"> Implement <code>ui_status.js</code>: update status bar and result count dynamically on table updates or server response.                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Aspect"> <strong>Worker usage</strong>                    </td><td data-label="PasteToTable templates/index.html"> <code>worker.js</code> loaded deferred.                                                                                                                 </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark not explicitly uses worker.                                              </td><td data-label="Task for assets/script.js (and possible split plan)"> Keep <code>worker.js</code> for background conversion or export tasks. <code>script.js</code> should offload heavy XLSX or PDF generation to worker.                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Aspect"> <strong>Responsive handling</strong>             </td><td data-label="PasteToTable templates/index.html"> Header hide rules via CSS for mobile.                                                                                                        </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark handles collapse via CSS/JS hybrid.                                      </td><td data-label="Task for assets/script.js (and possible split plan)"> Add <code>responsive.js</code>: manage header collapse, TOC collapse, and ensure focus management (aria-hidden toggles).                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Aspect"> <strong>Error handling</strong>                  </td><td data-label="PasteToTable templates/index.html"> Only console warnings in routeHtmlToAreas.                                                                                                   </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark static HTML no error handling needed.                                    </td><td data-label="Task for assets/script.js (and possible split plan)"> Add <code>error_handler.js</code>: capture and log user-visible errors (alerts minimal). Wrap network requests and exports safely.                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Aspect"> <strong>Performance / initialization</strong>    </td><td data-label="PasteToTable templates/index.html"> No global initialization script except inline route.                                                                                         </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark static, no runtime needed.                                               </td><td data-label="Task for assets/script.js (and possible split plan)"> Add <code>init.js</code>: wait for DOMContentLoaded, then initialize all modules. Use IIFE to prevent scope leaks.                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Aspect"> <strong>Accessibility (ARIA / keyboard)</strong> </td><td data-label="PasteToTable templates/index.html"> All ARIA attributes correct but no keyboard shortcuts.                                                                                       </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark partially implements ARIA roles only.                                    </td><td data-label="Task for assets/script.js (and possible split plan)"> Add <code>accessibility.js</code>: handle keyboard navigation between tables, Enter to collapse, Ctrl+F focusing search, etc.                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Aspect"> <strong>Potential split plan summary</strong>    </td><td data-label="PasteToTable templates/index.html"> Single monolithic file now.                                                                                                                  </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Modular benchmark functions handled by backend.                                    </td><td data-label="Task for assets/script.js (and possible split plan)"> Split <code>assets/script.js</code> into:  <br>1. <code>init.js</code> (entry)  <br>2. <code>router.js</code>  <br>3. <code>ui_header.js</code>  <br>4. <code>ui_paste.js</code>  <br>5. <code>table_copy.js</code>  <br>6. <code>table_export.js</code>  <br>7. <code>table_toggle.js</code>  <br>8. <code>table_sort.js</code>  <br>9. <code>toc.js</code>  <br>10. <code>search.js</code>  <br>11. <code>ui_status.js</code>  <br>12. <code>error_handler.js</code>  <br>13. <code>responsive.js</code>  <br>14. optional <code>worker_controller.js</code>. Each file under <code>assets/js/</code>. Build via bundler if needed. </td></tr><tr><td data-label="Aspect"> <strong>Testing focus</strong>                   </td><td data-label="PasteToTable templates/index.html"> Manual verification only.                                                                                                                    </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1)"> Benchmark deterministic.                                                           </td><td data-label="Task for assets/script.js (and possible split plan)"> Add <code>test.js</code> harness for quick DOM sanity check. Verify every button triggers correct handler once.                                                                                                                                                                                                                                                                                                                                                  </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table5" data-table="Book_8017_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Aspect**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Aspect</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **PasteToTable `templates/index.html`**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>PasteToTable <code>templates/index.html</code></strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Benchmark `Book_9001.html` (Tables Viewer v2.1)** ([GitHub][1])"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Benchmark <code>Book_9001.html</code> (Tables Viewer v2.1)</strong> </div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"> <strong>Doctype / head / meta</strong>                           </td><td data-label="PasteToTable templates/index.html"> <code>&lt;!doctype html&gt;</code> + lang, charset, viewport, description, theme-color present. Two small inline <code>&lt;style&gt;</code> blocks for header and mobile override.                                                                                                                                                                                                                                                             </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Same <code>&lt;!doctype html&gt;</code> and meta presence. Benchmark page includes similar meta and inline style behavior used to present tables.                                                                                                                             </td></tr><tr><td data-label="Aspect"> <strong>Title / Description</strong>                             </td><td data-label="PasteToTable templates/index.html"> Title: <em>PasteToTable — Tables Viewer + PasteToTable</em>. Description meta references merging of projects.                                                                                                                                                                                                                                                                                                       </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark uses "Tables Viewer v2.1" style headings and content; page is focused on table navigation and chapter content.                                                                                                                                     </td></tr><tr><td data-label="Aspect"> <strong>Sticky header</strong>                                   </td><td data-label="PasteToTable templates/index.html"> Present and intentionally kept unchanged. Contains controls (Export All, Clear, Toggle Paste, Convert, Render, Save) and a fixed-width 8cm paste textarea in header.                                                                                                                                                                                                                                         </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark header shows table controls (Theme, Collapse All, Copy All, Reset) and TOC. Functionally similar but wording differs.                                                                                                                              </td></tr><tr><td data-label="Aspect"> <strong>Paste input placement</strong>                           </td><td data-label="PasteToTable templates/index.html"> Inline fixed-width paste textarea in header (<code>width:8cm</code>). Original hidden <code>#paste-panel</code> retained for compatibility.                                                                                                                                                                                                                                                                                        </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark shows an accessible UI for table controls; paste box placement in benchmark differs (table-focused view).                                                                                                                                          </td></tr><tr><td data-label="Aspect"> <strong>TOC / navigation</strong>                                </td><td data-label="PasteToTable templates/index.html"> <code>#toc</code> and <code>#tocBar</code> present; <code>#tocList</code> and <code>#tocBarList</code> placeholders included. <code>routeHtmlToAreas</code> will insert server fragments into page.                                                                                                                                                                                                                                                                 </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark includes explicit list of tables and chapter headings; TOC and list are visible by default.                                                                                                                                                        </td></tr><tr><td data-label="Aspect"> <strong>Table wrapper / markup</strong>                          </td><td data-label="PasteToTable templates/index.html"> Uses <code>.table-wrapper</code>, <code>.table-container</code>, <code>.tv-table</code> with <code>thead</code>/<code>tbody</code>, <code>.tv-col-left</code>, and <code>.th-with-sort</code>. Matches TV2.1 element names and classes.                                                                                                                                                                                                                                                   </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark tables use identical structural elements and class names for TV2.1 output. Markup and semantics align.                                                                                                                                             </td></tr><tr><td data-label="Aspect"> <strong>Toolbar / per-table controls</strong>                    </td><td data-label="PasteToTable templates/index.html"> Buttons for Copy Plain, Copy Markdown, Export CSV/JSON/XLSX/PDF/MD and Collapse toggle are present with <code>onclick</code> inline handlers. Also <code>Export All</code> in header.                                                                                                                                                                                                                                              </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark shows per-table copy/export and collapse controls; semantics and available actions match.                                                                                                                                                          </td></tr><tr><td data-label="Aspect"> <strong>UI enhancement injection (renderer expectation)</strong> </td><td data-label="PasteToTable templates/index.html"> <code>html_renderer.py</code> injection expects <code>data-ptt-json</code> or <code>.ptt-table</code> wrappers; index.html contains examples and placeholders but relies on <code>script.js</code> and server to emit those attributes.                                                                                                                                                                                                                  </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark page is produced by renderer and contains the canonical table HTML fragments; it may already match the <code>.tv-table</code> structure.                                                                                                                      </td></tr><tr><td data-label="Aspect"> <strong>Scripts / assets</strong>                                </td><td data-label="PasteToTable templates/index.html"> Loads <code>xlsx.full.min.js</code>, <code>assets/script.js</code>, <code>assets/worker.js</code> deferred. Links <code>assets/style.css</code> and <code>assets/overrides.css</code>. Uses <code>defer</code> and routing helper <code>PasteToTable.routeHtmlToAreas</code>.                                                                                                                                                                                                             </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark page includes similar JS-driven behaviors and progressive enhancement; exact asset names differ but functional requirements (copy/export/collapse) are same.                                                                                       </td></tr><tr><td data-label="Aspect"> <strong>Noscript & accessibility</strong>                        </td><td data-label="PasteToTable templates/index.html"> <code>noscript</code> notices present. ARIA attributes on header, nav, tables, and roles provided. Mobile header-hide CSS included.                                                                                                                                                                                                                                                                                     </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark also contains noscript message and accessible labels; both pages cover basic a11y.                                                                                                                                                                 </td></tr><tr><td data-label="Aspect"> <strong>Server fragment handling</strong>                        </td><td data-label="PasteToTable templates/index.html"> <code>routeHtmlToAreas</code> implements fragment vs full-page detection and inserts into <code>#page-area</code> or <code>#tables-viewer</code>. Designed to accept renderer fragments matching benchmark structure.                                                                                                                                                                                                                         </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark is already the rendered static output—no routing required when serving full page.                                                                                                                                                                  </td></tr><tr><td data-label="Aspect"> <strong>Differences / Risks</strong>                             </td><td data-label="PasteToTable templates/index.html"> - Fixed <code>8cm</code> paste width may cause horizontal overflow on some devices.  <br> - Inline <code>onclick</code> assumes <code>script.js</code> exports functions (<code>copyTablePlain</code>, <code>exportTableXLSX</code>, etc.). Missing functions yield console errors but not break rendering. <br> - UI injection via <code>data-ptt-*</code> depends on server-rendered attributes; index.html includes examples but relies on <code>html_renderer</code> to produce them. </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> - Benchmark is authoritative output with many content-heavy table fragments. It shows real data and TOC rendered. <br> - Benchmark content includes long chapter text and many tables; index.html is a UI shell that will host those fragments via the API.  </td></tr><tr><td data-label="Aspect"> <strong>Conclusion</strong>                                      </td><td data-label="PasteToTable templates/index.html"> Page is intentionally preserved and compatible with TV2.1 markup. Leave unchanged. Follow-up checks recommended: verify <code>assets/*</code> files exist; confirm <code>script.js</code> implements referenced handlers; test <code>/api/render</code> returns <code>.table-wrapper</code> fragments with expected attributes.                                                                                                                          </td><td data-label="Benchmark Book_9001.html (Tables Viewer v2.1) ([GitHub][1])"> Benchmark confirms the target structure and visual style. Index.html is aligned and ready to receive benchmark-like fragments.                                                                                                                               </td></tr></tbody></table></div><div class="row-count">Rows: 13</div></div><div class="table-caption" id="Table6" data-table="Book_8017_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Category"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Category</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Table Viewer 2.1 (`utils.py`)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Table Viewer 2.1 (<code>utils.py</code>)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by PasteToTable (`utils.py`)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable (<code>utils.py</code>)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Category"> <strong>File Purpose</strong>                        </td><td data-label="Table Viewer 2.1 (utils.py)"> Markdown and list parsing utilities.                                            </td><td data-label="PasteToTable (utils.py)"> Unified environment, logging, I/O, and parsing utilities for both systems.                                   </td></tr><tr><td data-label="Category"> <strong>Imports</strong>                             </td><td data-label="Table Viewer 2.1 (utils.py)"> <code>re</code>, <code>typing</code> only.                                                            </td><td data-label="PasteToTable (utils.py)"> Adds <code>os</code>, <code>sys</code>, <code>logging</code>, <code>hashlib</code>, <code>pathlib</code>, <code>tempfile</code>; retains <code>re</code>, <code>typing</code>.                       </td></tr><tr><td data-label="Category"> <strong>Logger</strong>                              </td><td data-label="Table Viewer 2.1 (utils.py)"> None.                                                                           </td><td data-label="PasteToTable (utils.py)"> <code>_logger</code>, <code>init_logger()</code>, <code>make_logger()</code> with default formats.                                            </td></tr><tr><td data-label="Category"> <strong>Environment Helpers</strong>                 </td><td data-label="Table Viewer 2.1 (utils.py)"> None.                                                                           </td><td data-label="PasteToTable (utils.py)"> <code>load_env()</code>, <code>validate_env_keys()</code> for <code>.env</code> management and sanity checks.                                 </td></tr><tr><td data-label="Category"> <strong>Filesystem Helpers</strong>                  </td><td data-label="Table Viewer 2.1 (utils.py)"> None.                                                                           </td><td data-label="PasteToTable (utils.py)"> <code>ensure_dir()</code>, <code>safe_join()</code>, <code>safe_remove()</code>, <code>atomic_write()</code>, <code>atomic_write_bytes()</code>, <code>checksum_file()</code>. </td></tr><tr><td data-label="Category"> <strong>Numeric Helper</strong>                      </td><td data-label="Table Viewer 2.1 (utils.py)"> None.                                                                           </td><td data-label="PasteToTable (utils.py)"> <code>try_int()</code> for safe conversion.                                                                             </td></tr><tr><td data-label="Category"> <strong>Markdown / Table Parsing</strong>            </td><td data-label="Table Viewer 2.1 (utils.py)"> <code>normalize_whitespace</code>, <code>split_table_row</code>, <code>is_table_separator</code>, <code>parse_table</code>. </td><td data-label="PasteToTable (utils.py)"> Identical implementations preserved verbatim.                                                                </td></tr><tr><td data-label="Category"> <strong>List / Text Parsing</strong>                 </td><td data-label="Table Viewer 2.1 (utils.py)"> <code>is_list_item</code>, <code>extract_list</code>, <code>safe_slug</code>, <code>chunk_lines</code>, <code>strip_comments</code>.   </td><td data-label="PasteToTable (utils.py)"> Same code retained with identical regex logic and semantics.                                                 </td></tr><tr><td data-label="Category"> <strong>Regex Handling</strong>                      </td><td data-label="Table Viewer 2.1 (utils.py)"> Inline within parsing functions.                                                </td><td data-label="PasteToTable (utils.py)"> Same, no logic difference.                                                                                   </td></tr><tr><td data-label="Category"> <strong>Safety Guards</strong>                       </td><td data-label="Table Viewer 2.1 (utils.py)"> Basic validation inside each parser.                                            </td><td data-label="PasteToTable (utils.py)"> Added broader try/except for filesystem and environment functions, none around parsing.                      </td></tr><tr><td data-label="Category"> <strong>Backward Compatibility</strong>              </td><td data-label="Table Viewer 2.1 (utils.py)"> N/A (standalone).                                                               </td><td data-label="PasteToTable (utils.py)"> Declares <code>__all__</code> for explicit exports, ensuring old module imports remain valid.                           </td></tr><tr><td data-label="Category"> <strong>Design Comment Block</strong>                </td><td data-label="Table Viewer 2.1 (utils.py)"> Minimal.                                                                        </td><td data-label="PasteToTable (utils.py)"> Added top docstring describing merge strategy and scope.                                                     </td></tr><tr><td data-label="Category"> <strong>Length & Scope</strong>                      </td><td data-label="Table Viewer 2.1 (utils.py)"> ~130 lines.                                                                     </td><td data-label="PasteToTable (utils.py)"> ~450 lines (additional helper groups).                                                                       </td></tr><tr><td data-label="Category"> <strong>Dependency on Other Modules</strong>         </td><td data-label="Table Viewer 2.1 (utils.py)"> None.                                                                           </td><td data-label="PasteToTable (utils.py)"> None; remains standalone.                                                                                    </td></tr><tr><td data-label="Category"> <strong>Cross-Project Use</strong>                   </td><td data-label="Table Viewer 2.1 (utils.py)"> Dedicated to Table Viewer.                                                      </td><td data-label="PasteToTable (utils.py)"> Shared between PasteToTable and Table Viewer for consistent table logic.                                     </td></tr><tr><td data-label="Category"> <strong>Functional Changes in Parsing Logic</strong> </td><td data-label="Table Viewer 2.1 (utils.py)"> None.                                                                           </td><td data-label="PasteToTable (utils.py)"> None. All parsing behavior identical.                                                                        </td></tr><tr><td data-label="Category"> <strong>Integration Readiness</strong>               </td><td data-label="Table Viewer 2.1 (utils.py)"> Local markdown tools.                                                           </td><td data-label="PasteToTable (utils.py)"> Ready for CLI, server, and HTML renderer usage.                                                              </td></tr><tr><td data-label="Category"> <strong>Overall Difference Summary</strong>          </td><td data-label="Table Viewer 2.1 (utils.py)"> Minimalist parser utility.                                                      </td><td data-label="PasteToTable (utils.py)"> Superset that adds system robustness, error handling, and consistent logging.                                </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table7" data-table="Book_8017_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Aspect**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Aspect</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **`templates/index.html` (PTT)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong><code>templates/index.html</code> (PTT)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Benchmark `Book_9001.html` (TV2.1)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Benchmark <code>Book_9001.html</code> (TV2.1)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Script tasks (detailed) — `assets/script.js` split plan &amp; implementation notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Script tasks (detailed) — <code>assets/script.js</code> split plan & implementation notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"> Doctype / head / meta          </td><td data-label="templates/index.html (PTT)"> <code>&lt;!doctype html&gt;</code> + charset, viewport, description, theme-color. Two inline style blocks (header + mobile hide). Links to <code>assets/style.css</code>, <code>overrides.css</code>, <code>favicon</code>, <code>manifest</code>. </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark has same doctype/meta and inline styling to support table visuals.   </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> No script change. Ensure script reads <code>&lt;meta&gt;</code> where needed. Provide small <code>meta-utils.js</code> if scripts need to read asset hash or config.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Aspect"> Page shell vs full page        </td><td data-label="templates/index.html (PTT)"> Shell + header + <code>#tables-viewer</code> placeholder + <code>#page-area</code> for full responses. Contains example tables and template markup.                                                         </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark is an actual full rendered page with many fragments already present. </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Router (<code>router.js</code>) must detect fragment vs full-page (same heuristic as inline <code>routeHtmlToAreas</code>). Implement <code>routeHtmlToAreas(html, meta)</code> with robust detection: check <code>&lt;!doctype</code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Aspect"> Asset loading order            </td><td data-label="templates/index.html (PTT)"> <code>xlsx.full.min.js</code> (deferred) then <code>assets/script.js</code> (deferred), <code>worker.js</code> deferred.                                                                                               </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark uses client features, may not include these specific assets.         </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Keep <code>xlsx</code> for XLSX export. <code>init.js</code> must wait for <code>DOMContentLoaded</code> and then ensure <code>xlsx</code> and worker availability before enabling export buttons. Provide feature-detect functions: <code>hasXLSX()</code>, <code>hasWorker()</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Aspect"> Header controls                </td><td data-label="templates/index.html (PTT)"> Buttons with <code>data-action</code> attributes. Inline paste textarea <code>#paste</code> fixed 8cm. <code>render-form</code> kept for compatibility.                                                                </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark header presents controls but layout differs.                         </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Implement <code>ui_header.js</code>: <strong>event delegation</strong> on header container. Map <code>data-action</code> → handler function. Example mapping: <code>{ &quot;convert&quot;: handleConvert, &quot;render&quot;: handleRender, &quot;export-xlsx&quot;: handleExportAllXLSX }</code>. Provide <code>registerHeaderHandlers()</code> called by <code>init.js</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Aspect"> Inline onclicks present        </td><td data-label="templates/index.html (PTT)"> Many inline <code>onclick=&quot;copyTablePlain(this)&quot;</code> etc.                                                                                                                                     </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark binds programmatically.                                              </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Remove reliance on inline handlers. Create <code>event-delegate.js</code> that binds to document and listens for <code>click</code> events on elements with <code>data-action</code> or class names. Implement helpers: <code>getTableElement(el)</code>, <code>getTableId(el)</code>, <code>getTableData(el)</code> (returns parsed table DOM + optional <code>data-ptt-json</code>). Replace each inline function with module function. Maintain backward-compatible global functions that call new delegates for sites that still call inline APIs.                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Aspect"> Per-table controls and APIs    </td><td data-label="templates/index.html (PTT)"> Buttons: copy-plain, copy-markdown, export-csv/json/xlsx/pdf, collapse toggle. <code>data-*</code> attributes available.                                                                         </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark has similar per-table controls wired to JS.                          </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Split into modules:<br><strong>table_copy.js</strong>: expose <code>copyTablePlain(el)</code> and <code>copyTableMarkdown(el)</code> and also programmatic API <code>copyTable(tableNode, format)</code>.<br>Implementation details:<br>- Extract table data from DOM or <code>data-ptt-json</code>.<br>- For Markdown: generate pipe table with proper escaping of `                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Aspect"> Export CSV/JSON                </td><td data-label="templates/index.html (PTT)"> Buttons exist; CSV/JSON must be produced client-side or server-side.                                                                                                                  </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark supports CSV export.                                                 </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> <strong>table_export.js</strong>: functions <code>exportTableCSV(el)</code>, <code>exportTableJSON(el)</code>, <code>exportTableXLSX(el)</code>, <code>exportTablePDF(el)</code>. Details:<br>- CSV: generate via row iteration; join by comma; escape with quotes; use BOM <code>\ufeff</code> for Excel compatibility. Provide <code>downloadBlob(filename, blob)</code> util.<br>- JSON: canonicalize rows to array of objects <code>{col: value}</code>; use <code>JSON.stringify(obj, null, 2)</code>.<br>- XLSX: use existing <code>xlsx.full.min.js</code> (SheetJS). Provide <code>tableToSheet</code> utility that maps header -> columns; SheetJS workbook creation then <code>XLSX.write</code> to blob; offload to <code>worker.js</code> for large tables (postMessage protocol: <code>{cmd: &quot;xlsx&quot;, tableHtml: &quot;&lt;table...&gt;&quot;}</code> returns <code>{ok:true, blob}</code> ).<br>- PDF: minimal: open window with printable HTML, or offload to <code>worker</code> with <code>pdf-lib</code> if included. For now: provide graceful fallback <code>alert(&quot;PDF export requires worker support&quot;)</code> and implement later. </td></tr><tr><td data-label="Aspect"> Export All / Save All          </td><td data-label="templates/index.html (PTT)"> <code>Export All</code> button in header expects aggregated behavior.                                                                                                                            </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark may not have bulk export.                                            </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> <strong>export_manager.js</strong>: iterate <code>.table-wrapper</code> nodes; for each call <code>table_export.js</code> functions or stream a combined workbook. For XLSX: build multiple sheets named from <code>data-table</code> or caption. Provide progress UI and cancellation. Use worker for large tasks (protocol outlined below).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Aspect"> Collapse / Toggle              </td><td data-label="templates/index.html (PTT)"> <code>.toggle-table-btn</code> with inline <code>onclick</code>.                                                                                                                                            </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark supports collapse per table and collapse-all.                        </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> <strong>table_toggle.js</strong>: implement <code>toggleTable(el)</code> and <code>toggleAll(state)</code>.<br>Implementation:<br>- Use class <code>.collapsed</code> on <code>.table-wrapper</code> and set <code>aria-expanded</code> on button.<br>- Animate with <code>max-height</code> CSS transitions or just toggle <code>display</code> for simplicity. Ensure keyboard accessible; respond to Enter/Space on focused toggle button.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Aspect"> Sorting                        </td><td data-label="templates/index.html (PTT)"> <code>.sort-btn</code> elements present with states.                                                                                                                                             </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark allows toggling sort.                                                </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> <strong>table_sort.js</strong>: implement stable sort of table rows by column index. API: <code>sortTable(tableNode, colIndex, direction)</code> where <code>direction</code> in <code>[&#x27;asc&#x27;,&#x27;desc&#x27;,&#x27;none&#x27;]</code>. Maintain sort-state in <code>data-*</code> attr or WeakMap. For performance, detach <code>tbody</code>, sort array of row nodes using cell textContent trimmed and numeric detection, then append back. Update <code>sort-icon</code> class to reflect state.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Aspect"> TOC population & navigation    </td><td data-label="templates/index.html (PTT)"> <code>#tocList</code>, <code>#tocBarList</code>, <code>#tocBar</code> exist.                                                                                                                                           </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark includes full TOC generated server-side.                             </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> <strong>toc.js</strong>: on init or after <code>routeHtmlToAreas</code>, scan <code>.table-caption</code> and <code>.ptt-table</code> wrappers to populate both lists. Create anchor links to <code>#TableX</code>. Implement highlight-on-scroll using <code>IntersectionObserver</code>. Provide <code>buildToc()</code> and <code>refreshToc()</code> APIs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Aspect"> routeHtmlToAreas               </td><td data-label="templates/index.html (PTT)"> Inline simple router inserted.                                                                                                                                                        </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark is static.                                                           </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Move router to <code>router.js</code>. Add resilience:<br>- Preserve existing <code>page-area</code> children if full page detected.<br>- When inserting fragment, run <code>postProcessTables()</code> to attach event listeners and run UI injection (wrap tables if <code>data-ptt</code> present). Return boolean.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Aspect"> UI injection expectations      </td><td data-label="templates/index.html (PTT)"> <code>html_renderer</code> may emit <code>data-ptt-json</code> or <code>&lt;script type=&quot;application/json&quot; data-ptt=&quot;TableX&quot;&gt;</code>. Index has examples.                                                                 </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark output is already proper HTML fragments.                             </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> <strong>postprocess.js</strong>: after fragment is inserted run:<br>1. <code>attachHandlers()</code> to bind delegated listeners.<br>2. <code>decorateTables()</code> to add toolbar if missing via <code>_default_toolbar_html()</code> logic.<br>3. <code>hydrateDataAttributes()</code> to parse <code>data-ptt-json</code> into in-memory cache to avoid reserializing. Use WeakMap <code>tableId -&gt; parsedData</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Aspect"> Worker protocol                </td><td data-label="templates/index.html (PTT)"> <code>worker.js</code> exists.                                                                                                                                                                   </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark may not use worker.                                                  </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Standardize worker messages: `{id: <uuid>, cmd: "xlsx"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Aspect"> Data extraction format         </td><td data-label="templates/index.html (PTT)"> Tables may be delivered as DOM or <code>data-ptt-json</code>.                                                                                                                                    </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark has DOM table.                                                       </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Define <code>extractTableData(tableNode) -&gt; {id, caption, headers:[], rows:[[]], meta:{}}</code>. If <code>data-ptt-json</code> present parse safely with <code>JSON.parse</code> on unescaped content. Provide <code>normalizeCellValue()</code> to trim but preserve inline code and <code>&lt;code&gt;</code> tags.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Aspect"> Clipboard & fallback           </td><td data-label="templates/index.html (PTT)"> Inline handlers assume global functions.                                                                                                                                              </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark likely uses programmatic binding.                                    </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Provide <code>clipboard.js</code> utilities: <code>writeText(text) -&gt; Promise</code>. Provide visual feedback: copy toast, focus management, and screen-reader announcement via <code>#status</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Aspect"> Search                         </td><td data-label="templates/index.html (PTT)"> <code>#search</code> input present.                                                                                                                                                              </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark supports search in TOC or page.                                      </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> <strong>search.js</strong>: implement debounced search (300ms). Behavior: when user types, filter <code>.table-wrapper</code> by textContent match across table caption + table body. Update <code>#resultCount</code>. Use case-insensitive matching and highlight matched terms with <code>&lt;mark&gt;</code> (use safe DOM manipulation to avoid breaking code elements). Provide optimization: pre-index text per table on init.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Aspect"> Accessibility                  </td><td data-label="templates/index.html (PTT)"> ARIA attributes present on header, nav, tables.                                                                                                                                       </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark includes similar ARIA support.                                       </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Accessibility tasks:<br>- Ensure all actionable elements have <code>role</code> and <code>aria-label</code> if necessary.<br>- Keyboard: <code>Tab</code> navigation flows, Enter triggers conversion/render, Space toggles collapse. Implement <code>accessibility.js</code> with <code>addKeyboardShortcuts()</code> configurable: <code>Ctrl+K</code> focus search, <code>Ctrl+Shift+C</code> copy current table. Provide <code>aria-live</code> updates for copy/export statuses.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Aspect"> Error handling & logging       </td><td data-label="templates/index.html (PTT)"> Minimal inline console warns.                                                                                                                                                         </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark pages typically static.                                              </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> <strong>error_handler.js</strong>: central <code>handleError(err, context)</code> that logs to console and optionally displays non-intrusive UI using <code>#status</code>. Wrap network calls, worker calls, and export tasks with try/catch. Provide <code>reportErrorToServer(err)</code> hook (optional).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Aspect"> Initialization & lifecycle     </td><td data-label="templates/index.html (PTT)"> Inline IIFE registers <code>routeHtmlToAreas</code>.                                                                                                                                             </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark no init.                                                             </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> <strong>init.js</strong> responsibilities:<br>1. Wait for DOMContentLoaded.<br>2. Initialize feature-detection (XLSX, Worker).<br>3. Register header delegation, router, postprocess hooks.<br>4. Hydrate existing DOM tables by calling <code>postprocess.decorateTables()</code> and <code>attachHandlers()</code>.<br>5. Expose <code>window.PasteToTable</code> API for backward compatibility with methods: <code>convert(text)</code>, <code>renderFragment(html)</code>, <code>exportAll(format)</code>, <code>getTableData(id)</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Aspect"> Testing strategy               </td><td data-label="templates/index.html (PTT)"> Manual verification recommended.                                                                                                                                                      </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark verified static output.                                              </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Provide <code>test/harness.js</code> and <code>test/data/fragment-sample.html</code>. Tests to run in browser console or headless:<br>- Button click simulation for each <code>data-action</code>.<br>- Copy to clipboard success (mocking navigator.clipboard).<br>- Export XLSX produces non-empty blob.<br>- Router fragment insertion correctness.<br>- Accessibility: ARIA presence and keyboard triggers.<br>Document tests and expected outcomes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Aspect"> Performance considerations     </td><td data-label="templates/index.html (PTT)"> Page loads with sample tables; heavy operations offloaded to worker.                                                                                                                  </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark pages larger; server may pre-render for performance.                 </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Implement lazy-binding: do not parse all tables on load if there are > N (e.g., 50). Use <code>IntersectionObserver</code> to attach heavy handlers (virtualize) on visible tables. For exports use streaming where possible.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Aspect"> Security considerations        </td><td data-label="templates/index.html (PTT)"> <code>routeHtmlToAreas</code> injects server HTML; must avoid executing inline scripts included in fragments.                                                                                    </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark served static; server controls content.                              </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Sanitize server fragments: prefer server to strip <code>&lt;script&gt;</code> or <code>html_renderer</code> to return safe fragments. On client side, when inserting HTML use <code>innerHTML</code> only for trusted fragments. For third-party content, parse and remove <code>&lt;script&gt;</code> tags. Document trust model and require server-side sanitization.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Aspect"> Backwards compatibility        </td><td data-label="templates/index.html (PTT)"> Index.html kept unchanged; inline onclicks present.                                                                                                                                   </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark uses programmatic binding.                                           </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Provide compatibility layer: global functions <code>window.copyTablePlain = function(el){ return window.PasteToTable?.copy?.plain(el) }</code> mapping to new modules. Keep these minimal thin wrappers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Aspect"> Build / split & bundling       </td><td data-label="templates/index.html (PTT)"> Single <code>assets/script.js</code> file currently.                                                                                                                                             </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark likely small or server-provided.                                     </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Splitting plan and filenames (recommended): <code>assets/js/init.js</code>, <code>assets/js/router.js</code>, <code>assets/js/ui_header.js</code>, <code>assets/js/ui_paste.js</code>, <code>assets/js/toc.js</code>, <code>assets/js/table_copy.js</code>, <code>assets/js/table_export.js</code>, <code>assets/js/table_toggle.js</code>, <code>assets/js/table_sort.js</code>, <code>assets/js/search.js</code>, <code>assets/js/postprocess.js</code>, <code>assets/js/worker_controller.js</code>, <code>assets/js/error_handler.js</code>, <code>assets/js/accessibility.js</code>, <code>assets/js/test_harness.js</code>.<br>Bundling:<br>- Use simple rollup/webpack or a concatenation script for deployment. Keep sourcemap support. For rapid integration, ship a single <code>script.js</code> that imports or concatenates modules in dev.                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Aspect"> Minimal fallback behaviors     </td><td data-label="templates/index.html (PTT)"> Index includes <code>noscript</code>. Inline <code>routeHtmlToAreas</code> fallback exists.                                                                                                                 </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark does not require fallback.                                           </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Ensure every module has graceful fallback when API missing (Clipboard, Worker, SheetJS). Feature-detect and notify user via <code>#status</code> or disable buttons.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Aspect"> Developer APIs & documentation </td><td data-label="templates/index.html (PTT)"> Index.html expects functions with given names.                                                                                                                                        </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark static.                                                              </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Produce <code>docs/JS_API.md</code> listing public functions, event names, worker message protocol, data extraction format, and sample usage. Also include <code>CHANGELOG</code> and integration checklist.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Aspect"> Delivery & rollout plan        </td><td data-label="templates/index.html (PTT)"> Keep <code>index.html</code> unchanged.                                                                                                                                                          </td><td data-label="Benchmark Book_9001.html (TV2.1)"> Benchmark matching required visually.                                          </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Implementation steps:<br>1. Create modular JS files under <code>assets/js/</code> per split plan. <br>2. Provide <code>script.js</code> that bootstraps <code>init.js</code> and conditionally loads modules (dynamic import) for large features.<br>3. Run functional tests with <code>test_harness.js</code>. <br>4. Deploy to staging and run visual diff vs <code>Book_9001.html</code>. <br>5. Iterate fixes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Aspect"> Priority quick wins            </td><td data-label="templates/index.html (PTT)"> N/A                                                                                                                                                                                   </td><td data-label="Benchmark Book_9001.html (TV2.1)"> N/A                                                                            </td><td data-label="Script tasks (detailed) — assets/script.js split plan &amp; implementation notes"> Immediate steps for minimal risk:<br>- Implement <code>event-delegate.js</code> and attach to header and table-controls.<br>- Implement <code>table_copy.js</code> and <code>table_export.csv</code> (CSV is easiest); wire Export CSV/XLSX buttons to disable until XLSX available.<br>- Implement <code>router.js</code> based on existing <code>routeHtmlToAreas</code> IIFE. These deliver most UX value with low risk.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr></tbody></table></div><div class="row-count">Rows: 29</div></div><div class="table-caption" id="Table8" data-table="Book_8017_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Aspect**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Aspect</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **TV2.1 `html_renderer.py` (source)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>TV2.1 <code>html_renderer.py</code> (source)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **PasteToTable `html_renderer.py` (revised)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>PasteToTable <code>html_renderer.py</code> (revised)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"> <strong>Primary purpose</strong>               </td><td data-label="TV2.1 html_renderer.py (source)">                                   Compatibility wrapper exposing <code>render_*</code> from <code>render</code> package with conservative postprocessing and fallbacks. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same core purpose plus non-destructive UI injection and per-table toolbar wrappers.                                                                                         </td></tr><tr><td data-label="Aspect"> <strong>Exports</strong>                       </td><td data-label="TV2.1 html_renderer.py (source)">                                                                        <code>render_html</code>, <code>render_table</code>, <code>render_page</code>, config helpers, diagnostics. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same exports plus <code>create_app</code> shim exported.                                                                                                                               </td></tr><tr><td data-label="Aspect"> <strong>Config defaults</strong>               </td><td data-label="TV2.1 html_renderer.py (source)">                                                                     <code>ensure_title</code>, <code>minify_html</code>, <code>process_path_outputs</code>, <code>page_title_class/id</code>. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same defaults plus table UI keys: <code>table_ui_css</code>, <code>table_ui_js</code>, <code>table_ui_max_attr_json_len</code>, <code>table_ui_toolbar_html</code>.                                                     </td></tr><tr><td data-label="Aspect"> <strong>Import strategy</strong>               </td><td data-label="TV2.1 html_renderer.py (source)">     Insert project root to <code>sys.path</code>. Try <code>render.core_compat</code>, fallback to <code>render.core_renderer</code>. Nonfatal optional helpers. Records attempts. </td><td data-label="PasteToTable html_renderer.py (revised)"> Identical import strategy and nonfatal helper imports. Records attempts.                                                                                                    </td></tr><tr><td data-label="Aspect"> <strong>Wrappers</strong>                      </td><td data-label="TV2.1 html_renderer.py (source)">                                                           <code>_wrap_callable</code> applies <code>ensure_title</code>, optional minify, and safe bytes/path handling. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same wrapper but extended to inject UI assets (<code>_inject_ui_assets</code>) and wrap tables with toolbar (<code>_wrap_each_table_with_ui</code>).                                              </td></tr><tr><td data-label="Aspect"> <strong>Title postprocessing</strong>          </td><td data-label="TV2.1 html_renderer.py (source)">                                                                        <code>_ensure_title_attrs_in_str</code> ensures first <code>&lt;h1&gt;</code> has configured class/id. </td><td data-label="PasteToTable html_renderer.py (revised)"> Identical implementation and use.                                                                                                                                           </td></tr><tr><td data-label="Aspect"> <strong>HTML minifier</strong>                 </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                      Conservative <code>_minify_html_str</code> preserving protected blocks. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same minifier reused with same regex tokenization.                                                                                                                          </td></tr><tr><td data-label="Aspect"> <strong>Diagnostics</strong>                   </td><td data-label="TV2.1 html_renderer.py (source)">                                                                              <code>get_import_diagnostics</code>, <code>_try_msgs</code>, <code>generate_diagnostic_report</code>. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same diagnostics with additional sample postprocessing showing UI-wrapped sample.                                                                                           </td></tr><tr><td data-label="Aspect"> <strong>Fallback renderers</strong>            </td><td data-label="TV2.1 html_renderer.py (source)"> Safe <code>_fallback_render_html/_fallback_render_table/_fallback_render_page</code> that preserve inline `<code> </code>code<code> </code><code> and write bytes via </code>_process_bytes`. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same fallback renderers adapted to accept <code>output_path</code> optional and return path/str. Behavior preserved.                                                                   </td></tr><tr><td data-label="Aspect"> <strong>UI injection</strong>                  </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                                 None. Focused on safe rendering and minify/title. </td><td data-label="PasteToTable html_renderer.py (revised)"> Adds <code>_inject_ui_assets</code> to insert CSS/JS links safely and <code>_wrap_each_table_with_ui</code> to wrap <code>&lt;table&gt;</code> with toolbar and optional JSON payload script.                      </td></tr><tr><td data-label="Aspect"> <strong>Asset discovery/utilities</strong>     </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                                     Tries to import <code>render.core_assets</code> helpers. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same, and configured to reference <code>table_ui_css</code> and <code>table_ui_js</code> paths (non-destructive).                                                                                 </td></tr><tr><td data-label="Aspect"> <strong>create_app</strong>                    </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                                             Not provided (TV2.1 used batch tool). </td><td data-label="PasteToTable html_renderer.py (revised)"> Adds backward-compatible <code>create_app(cfg)</code> that delegates to <code>server.create_app</code> when present or provides Flask fallback with <code>/api/convert</code>, <code>/api/render</code>, <code>/api/health</code>. </td></tr><tr><td data-label="Aspect"> <strong>API surface</strong>                   </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                                          <code>render_*</code>, config helpers, diagnostics. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same plus <code>create_app</code> and small API endpoints in fallback app (non-invasive).                                                                                              </td></tr><tr><td data-label="Aspect"> <strong>Table wrapping payload</strong>        </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                                                                               N/A </td><td data-label="PasteToTable html_renderer.py (revised)"> Produces <code>data-ptt-json</code> attribute when JSON small; otherwise emits <code>&lt;script type=&quot;application/json&quot; data-ptt=&quot;TableX&quot;&gt;…&lt;/script&gt;</code>. Respects <code>table_ui_max_attr_json_len</code>.  </td></tr><tr><td data-label="Aspect"> <strong>Safety & non-destructive rule</strong> </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                                                 Does not modify <code>render/*</code> files. </td><td data-label="PasteToTable html_renderer.py (revised)"> Also does not modify <code>render/*</code> or <code>assets/style.css</code>. Injects references only into produced HTML output.                                                                   </td></tr><tr><td data-label="Aspect"> <strong>Logging & error handling</strong>      </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                         <code>_record</code>, <code>_try_msgs</code>, <code>_logger</code>, non-throwing wrappers. </td><td data-label="PasteToTable html_renderer.py (revised)"> Same patterns; added <code>_logger.exception</code> points around UI injection.                                                                                                        </td></tr><tr><td data-label="Aspect"> <strong>Compatibility risk</strong>            </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                                 Low; conservative fallbacks and no hard failures. </td><td data-label="PasteToTable html_renderer.py (revised)"> Low; UI injection is best-effort and wrapped in try/except to remain non-fatal.                                                                                             </td></tr><tr><td data-label="Aspect"> <strong>Behavioral difference</strong>         </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                              Pure renderer compatibility and safe postprocessing. </td><td data-label="PasteToTable html_renderer.py (revised)"> Adds UI ergonomics for PasteToTable (toolbar, copy/export hooks) without altering render logic.                                                                             </td></tr><tr><td data-label="Aspect"> <strong>Conclusion / readiness</strong>        </td><td data-label="TV2.1 html_renderer.py (source)">                                                                                 Provides authoritative parsing → HTML pipeline and safe fallback. </td><td data-label="PasteToTable html_renderer.py (revised)"> Keeps TV2.1 semantics intact and extends safely for PTT UI. Ready to proceed to next file.                                                                                  </td></tr></tbody></table></div><div class="row-count">Rows: 19</div></div><div class="table-caption" id="Table9" data-table="Book_8017_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Compare File**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Compare File</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Purpose of Comparison**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Purpose of Comparison</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Compare File"> <strong>main.py</strong>              </td><td data-label="Purpose of Comparison"> Identify Table Viewer’s advanced parsing, CLI, and configuration logic to merge into PasteToTable main entry without breaking startup flow.  </td></tr><tr><td data-label="Compare File"> <strong>server.py</strong>            </td><td data-label="Purpose of Comparison"> Align endpoint handling, file storage, and render pipeline with Table Viewer’s input validation and rendering dispatch.                      </td></tr><tr><td data-label="Compare File"> <strong>html_renderer.py</strong>     </td><td data-label="Purpose of Comparison"> Compare full Markdown→HTML rendering flow, especially inline code, table generation, and fragment stitching.                                 </td></tr><tr><td data-label="Compare File"> <strong>utils.py</strong>             </td><td data-label="Purpose of Comparison"> Compare helper structures: normalization, safe filename utilities, logging format, and runtime diagnostics.                                  </td></tr><tr><td data-label="Compare File"> <strong>templates/index.html</strong> </td><td data-label="Purpose of Comparison"> Compare typography, table layout, header/footer positions, and TOC handling.                                                                 </td></tr><tr><td data-label="Compare File"> <strong>assets/script.js</strong>     </td><td data-label="Purpose of Comparison"> Compare button binding logic, persistence, TOC, export, and copy-to-clipboard interactions.                                                  </td></tr><tr><td data-label="Compare File"> <strong>assets/worker.js</strong>     </td><td data-label="Purpose of Comparison"> Check if Table Viewer used background tasks for exports or previews; merge if present.                                                       </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>