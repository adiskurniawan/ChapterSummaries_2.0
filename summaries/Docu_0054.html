<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1764452107">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0054_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Project Structure**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Project Structure</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Project Structure"><div class="tv-left-col"><div class="left-col-content">PasteToTable<br/>├─ main.py<br/>├─ server.py<br/>├─ html_renderer.py<br/>├─ utils.py<br/>├─ render<br/>│  ├─ <strong>init</strong>.py<br/>│  ├─ core_compat.py<br/>│  ├─ core_table.py — table-level helpers, render_table wrapper<br/>│  ├─ core_assets.py — asset discovery, embedding, copy logic<br/>│  ├─ core_io.py — atomic write, tmp dirs, path checks<br/>│  ├─ core_utils.py — misc helpers (sanitize, streaming, sri_attr)<br/>│  ├─ core_renderer.py<br/>│  ├─ core_fragments.py<br/>│  ├─ convert.py<br/>│  ├─ markdown.py<br/>│  ├─ sanitize.py<br/>│  ├─ io_utils.py<br/>│  ├─ assets.py<br/>│  ├─ cli.py<br/>│  └─ types.py<br/>├─ assets<br/>│  ├─ script.core.js<br/>│  ├─ script.table.js<br/>│  ├─ script.toc.js<br/>│  ├─ overrides.css<br/>│  ├─ style.css<br/>│  ├─ extra.js<br/>│  └─ worker.js — optional: future client-side features<br/>├─ templates<br/>│  └─ index.html<br/>└─ saved_tables<br/><br/>Project structure for PasteToTable:<br/><code>render/</code> — core rendering modules for tables, HTML assembly, sanitization, and conversion.<br/><code>assets/</code> — CSS, JS, and worker scripts for styling and interactivity.<br/><code>templates/</code> — contains the main HTML template for rendering outputs.<br/><code>saved_tables/</code> — stores generated tables.<br/>Root scripts (<code>main.py</code>, <code>server.py</code>, <code>html_renderer.py</code>, <code>utils.py</code>) coordinate the conversion workflow and backend operations.</div></div></td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table2" data-table="Docu_0054_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Plan / Notes" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Plan / Notes</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading">You want to save Markdown (.md) files from the UI. Current state</div><div class="left-col-content">server.py already has /convert and /save (HTML), enforcing MAX_PASTE_SIZE with helpers _safe_filename, storage path, and atomic flush. index.html has a visible Save button dispatching ptt:save-request. utils.py, render/core_io.py, main.py, extra.js, and batch logic exist and are suitable.</div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading">Approach</div><div class="left-col-content">edit one file at a time in this order and test after each change. Files to revise (single-file rule): server.py, assets/script.save.js, index.html (minor include), optional utils.py (likely unchanged).</div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading"><strong>server.py</strong>: Add POST /save-md endpoint. Accept JSON {markdown, filename} or form data. Enforce MAX_PASTE_SIZE, check len(markdown). Coerce filename with _safe_filename, append .md. Save atomically under STORAGE_PATH. Return JSON {ok, status, path, id} with 200/201. Reuse existing logging and error handling. Keep /save (HTML) unchanged.</div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading"><strong>assets/script.save.js</strong>: Client-side script. On load, register listener for ptt:save-request and #saveBtn click. Read markdown from #paste, fallback to page-area if empty. Prompt for filename if missing, append .md. Optional client-side size check against MAX_PASTE_SIZE. Send POST /save-md via fetch(JSON). Handle response, update #status, optionally download/open saved file. Dispatch ptt:save-response for other scripts.</div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading"><strong>index.html</strong>: Include <script defer="" src="assets/script.save.js"></script> if not already included. Existing inline save dispatcher works with new script.</div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading"><strong>Implementation details (server)</strong>: Only POST allowed. Enforce content-length and markdown size. Sanitize filename to avoid path traversal. Atomic write. Return proper JSON on success or error (400/413/500). Security headers preserved. Optionally sanitize content but store raw markdown.</div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading"><strong>Implementation details (client)</strong>: Register listener, read markdown, prompt filename, size check, fetch POST JSON, handle server response, update UI, trigger download/open, dispatch event. Graceful fallback and accessibility. Works on Chrome/Firefox/Edge and mobile.</div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading"><strong>Tests / Verification (Server, 13)</strong>: POST /save-md accepts JSON; &gt;MAX_PASTE_SIZE returns 413; empty markdown 400; filename sanitized and appended with .md; path inside STORAGE_PATH; atomic write; file readable; STORAGE_PATH created if missing; concurrent saves handled; response JSON contains ok, path, id; logging contains actions and errors; GET /saved/<id> works for HTML only; security headers present.</id></div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading"><strong>Tests / Verification (Client, 12)</strong>: Save triggers ptt:save-request; filename prompt appears; prevents &gt;MAX_PASTE_SIZE; #status shows messages; errors displayed; saved path opens/downloads; fallback works; works on all browsers and mobile; accessible; cancelable events honored; no JS console exceptions; works with existing site save scripts.</div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading"><strong>Quick cURL tests</strong>: JSON POST: <code>curl -v -X POST http://127.0.0.1:5000/save-md -H "Content-Type: application/json" -d '{"markdown":"# Hello\nThis is a note.","filename":"my-note.md"}'</code>. Form POST: <code>curl -v -X POST http://127.0.0.1:5000/save-md -F "markdown=@./notes.txt;type=text/plain" -F "filename=my-note.md"</code>.</div></div></td></tr><tr><td data-label="Plan / Notes"><div class="tv-left-col"><div class="left-col-heading"><strong>Acceptance criteria</strong>: Server and client code implemented; Save button triggers new script; saved .md files appear in STORAGE_PATH and retrievable; security and size checks pass; all 25 verification checks succeed.</div></div></td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table3" data-table="Docu_0054_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Topic" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Topic</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Enhancement / Behavior" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Enhancement / Behavior</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Acceptance criteria &amp; tests" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Acceptance criteria &amp; tests</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Feature summary</div></div></td><td data-label="Enhancement / Behavior"> Add <code>POST /save-md</code> and <code>assets/script.save.js</code>. Minor include in <code>index.html</code>.                                                                                                                                                                                              </td><td data-label="Acceptance criteria &amp; tests"> Endpoint exists; client triggers it; <code>.md</code> files appear in <code>STORAGE_PATH</code>. Unit + integration tests pass.                  </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Route</div></div></td><td data-label="Enhancement / Behavior"> <code>POST /save-md</code> only.                                                                                                                                                                                                                                                        </td><td data-label="Acceptance criteria &amp; tests"> 201 on success; 400/413/415/500 on respective errors. Test HTTP status codes.                                              </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading">Accepted content</div><div class="left-col-content">types</div></div></td><td data-label="Enhancement / Behavior"> Accept <code>application/json</code>, <code>multipart/form-data</code>, <code>application/x-www-form-urlencoded</code>.                                                                                                                                                                                       </td><td data-label="Acceptance criteria &amp; tests"> 415 on other types. Tests: JSON POST and multipart form POST succeed.                                                      </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Required fields</div></div></td><td data-label="Enhancement / Behavior"> <code>markdown</code> required; <code>filename</code> optional.                                                                                                                                                                                                                                    </td><td data-label="Acceptance criteria &amp; tests"> Missing or empty <code>markdown</code> → 400. Test missing and empty cases.                                                           </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Size enforcement</div></div></td><td data-label="Enhancement / Behavior"> Enforce <code>MAX_PASTE_SIZE</code> measured as UTF-8 bytes. Check <code>Content-Length</code> if present.                                                                                                                                                                                         </td><td data-label="Acceptance criteria &amp; tests"> <code>Content-Length</code> &gt; limit → 413; actual bytes &gt; limit → 413. Test both header and payload.                                  </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Filename sanitization</div></div></td><td data-label="Enhancement / Behavior"> Use <code>_safe_filename()</code>. Append <code>.md</code> if missing. Truncate to max length.                                                                                                                                                                                                     </td><td data-label="Acceptance criteria &amp; tests"> Unsafe names cleaned; <code>.md</code> suffix present. Test <code>../../etc/passwd</code>, special chars, long names.                            </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Path traversal defense</div></div></td><td data-label="Enhancement / Behavior"> Resolve final path and verify it starts with <code>os.path.abspath(STORAGE_PATH)</code>.                                                                                                                                                                                                </td><td data-label="Acceptance criteria &amp; tests"> Invalid resolved path → 400 <code>invalid_filename</code>. Test traversal attempt.                                                    </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Uniqueness / collisions</div></div></td><td data-label="Enhancement / Behavior"> If target exists append <code>-&lt;uuid&gt;</code> to base name to avoid overwrite.                                                                                                                                                                                                           </td><td data-label="Acceptance criteria &amp; tests"> No file overwritten. Test duplicate save concurrently.                                                                     </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Atomic write</div></div></td><td data-label="Enhancement / Behavior"> Use existing atomic helper or fallback: tempfile in same dir, <code>os.fsync</code>, <code>os.replace</code>.                                                                                                                                                                                      </td><td data-label="Acceptance criteria &amp; tests"> No partial file. Simulate interrupt; verify file is either old or fully written.                                           </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Storage location</div></div></td><td data-label="Enhancement / Behavior"> Save under <code>STORAGE_PATH</code>. Create directory if missing.                                                                                                                                                                                                                      </td><td data-label="Acceptance criteria &amp; tests"> <code>STORAGE_PATH</code> auto-created. Test creation and permissions.                                                                </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Response schema</div></div></td><td data-label="Enhancement / Behavior"> Success JSON: <code>{ok:true,status:"saved",id,filename,rel_path,size}</code>. No absolute FS paths.                                                                                                                                                                                    </td><td data-label="Acceptance criteria &amp; tests"> Response keys present and correct types. Tests validate schema.                                                            </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Error schema</div></div></td><td data-label="Enhancement / Behavior"> Error JSON: <code>{ok:false,error:"code",details?: "..."}.</code> </td><td data-label="Acceptance criteria &amp; tests"> Consistent error shapes. Tests for all error cases.                                                                        </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Logging</div></div></td><td data-label="Enhancement / Behavior"> Info on success <code>save-md saved id=... filename=... size=... client=...</code>. Warn on client errors. Error stacktrace on exceptions.                                                                                                                                              </td><td data-label="Acceptance criteria &amp; tests"> Logs contain entries for save attempts. Inspect logs during tests.                                                         </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Security (content)</div></div></td><td data-label="Enhancement / Behavior"> Store raw markdown. Do not render server-side. Rendering pipeline must sanitize later.                                                                                                                                                                                       </td><td data-label="Acceptance criteria &amp; tests"> Raw saved; rendering uses <code>render/sanitize.py</code> when converting to HTML. Security audit recommended.                        </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Security (surface)</div></div></td><td data-label="Enhancement / Behavior"> Prevent path traversal and dangerous filename chars; do not expose absolute paths.                                                                                                                                                                                           </td><td data-label="Acceptance criteria &amp; tests"> Validate resolved path prefix. Test for path leakage in responses.                                                         </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Concurrency</div></div></td><td data-label="Enhancement / Behavior"> Atomic write + unique suffix.                                                                                                                                                                                                                                                </td><td data-label="Acceptance criteria &amp; tests"> Concurrent saves succeed and create distinct files. Test with parallel clients.                                            </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Client script</div></div></td><td data-label="Enhancement / Behavior"> <code>assets/script.save.js</code> registers events, reads <code>#paste</code> fallback <code>page-area</code>, prompts filename, optional client-side size check, POST JSON, updates <code>#status</code>, dispatch <code>ptt:save-response</code>.                                                                                </td><td data-label="Acceptance criteria &amp; tests"> Save button triggers script; UI updated; events dispatched. Browser tests across Chrome/Firefox/Edge and mobile emulation. </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">index.html change</div></div></td><td data-label="Enhancement / Behavior"> Add <code>&lt;script src="assets/script.save.js" defer&gt;&lt;/script&gt;</code> if missing.                                                                                                                                                                                                        </td><td data-label="Acceptance criteria &amp; tests"> Page loads; old save unchanged; new save flow works. Test page load and save interaction.                                  </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Response exposure</div></div></td><td data-label="Enhancement / Behavior"> Return <code>rel_path</code> or <code>url</code> only if safe public route exists.                                                                                                                                                                                                                 </td><td data-label="Acceptance criteria &amp; tests"> No absolute FS paths. Tests verify returned values are safe.                                                               </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading">Rate</div><div class="left-col-content">limit / auth</div></div></td><td data-label="Enhancement / Behavior"> Not implemented here; document need for throttling/auth at project level.                                                                                                                                                                                                    </td><td data-label="Acceptance criteria &amp; tests"> Documented. Security review recommended.                                                                                   </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Error handling details</div></div></td><td data-label="Enhancement / Behavior"> 400 bad data, 413 too large, 415 unsupported media, 500 server error.                                                                                                                                                                                                        </td><td data-label="Acceptance criteria &amp; tests"> Tests trigger each and validate JSON and status.                                                                           </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">cURL examples</div></div></td><td data-label="Enhancement / Behavior"> Provide JSON and multipart examples for QA.                                                                                                                                                                                                                                  </td><td data-label="Acceptance criteria &amp; tests"> Examples function against a running server. Test via CI or manual QA.                                                      </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Rollout strategy</div></div></td><td data-label="Enhancement / Behavior"> One-file edits. Start with <code>server.py</code>. Test. Then <code>assets/script.save.js</code>. Then <code>index.html</code>.                                                                                                                                                                               </td><td data-label="Acceptance criteria &amp; tests"> Each file change passes its tests before moving to next. CI run after each commit.                                         </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Backout plan</div></div></td><td data-label="Enhancement / Behavior"> Remove route and script include to rollback. <code>/save</code> remains unchanged.                                                                                                                                                                                                      </td><td data-label="Acceptance criteria &amp; tests"> Rollback validated by running existing test-suite.                                                                         </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Observability</div></div></td><td data-label="Enhancement / Behavior"> Structured logs; include request id if available; client IP.                                                                                                                                                                                                                 </td><td data-label="Acceptance criteria &amp; tests"> Logs readable and searchable. Tests confirm log lines on save.                                                             </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Docs</div></div></td><td data-label="Enhancement / Behavior"> Add short README section describing endpoint, fields, size limits, cURL examples.                                                                                                                                                                                            </td><td data-label="Acceptance criteria &amp; tests"> README updated and matches implementation. Test docs for accuracy.                                                         </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading">Edge</div><div class="left-col-content">case rules</div></div></td><td data-label="Enhancement / Behavior"> If filename missing → <code>untitled-&lt;id&gt;.md</code>. If exists → append <code>-&lt;id&gt;</code>. Size measured as bytes. Accept shorter <code>Content-Length</code>.                                                                                                                                               </td><td data-label="Acceptance criteria &amp; tests"> Tests for each explicit edge case.                                                                                         </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Tests (server list)</div></div></td><td data-label="Enhancement / Behavior"> 13 server tests: JSON success, multipart success, &gt;limit 413, empty 400, sanitize filename, path inside STORAGE_PATH, atomic write, file readable, STORAGE_PATH created, concurrent saves, response JSON, logs, <code>/save</code> unaffected.                                          </td><td data-label="Acceptance criteria &amp; tests"> All server tests pass in CI.                                                                                               </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Tests (client list)</div></div></td><td data-label="Enhancement / Behavior"> 12 client tests: event emitted, prompt works, client-side size prevention, status messages, errors displayed, saved path opens if url provided, fallback works, cross-browser, accessible, cancelable events honored, no console exceptions, coexists with existing scripts. </td><td data-label="Acceptance criteria &amp; tests"> Client automated/browser tests and manual smoke tests pass.                                                                </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Implementation errors to avoid</div></div></td><td data-label="Enhancement / Behavior"> Returning absolute paths; changing <code>/save</code> behavior; partial writes; allowing traversal.                                                                                                                                                                                     </td><td data-label="Acceptance criteria &amp; tests"> Tests and code review to prevent regressions.                                                                              </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-content">Security reminders</div></div></td><td data-label="Enhancement / Behavior"> Storing user text is fine. Sanitize at render time. Consider auth/rate-limit for public deployment.                                                                                                                                                                          </td><td data-label="Acceptance criteria &amp; tests"> Security checklist included; recommend audit before public exposure.                                                       </td></tr></tbody></table></div><div class="row-count">Rows: 31</div></div><div class="table-caption" id="Table4" data-table="Docu_0054_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Topic**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria." class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria.</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Feature summary</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Add <code>POST /save-md</code> to save raw Markdown files and a small client script <code>assets/script.save.js</code>. Keep existing <code>/save</code> unchanged. Purpose: reliable, auditable Markdown export from UI. Acceptance: endpoint reachable, client calls succeed, <code>.md</code> files stored under <code>STORAGE_PATH</code>, tests pass.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Route &amp; method</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> <strong>Route:</strong> <code>POST /save-md</code> only.  <strong>Behavior:</strong> accept only POST.  <strong>Errors:</strong> respond with <code>405 Method Not Allowed</code> for other methods.  <strong>Status codes:</strong> <code>201 Created</code> on success; <code>400</code>, <code>413</code>, <code>415</code>, <code>500</code> as appropriate.  <strong>Tests:</strong> method rejection; 201 on valid requests; correct error codes for invalid requests.                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Accepted content-types</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Accept these formats:  <br/><br/>  1. <code>application/json</code> (preferred) — body: <code>{"markdown":"...", "filename":"..."}</code>. <br/><br/>  2. <code>multipart/form-data</code> — fields: <code>markdown</code> (text or file upload) and optional <code>filename</code>. <br/><br/>  3. <code>application/x-www-form-urlencoded</code> — fields <code>markdown</code> and <code>filename</code>. <br/><br/>  Reject other types with <code>415 Unsupported Media Type</code>.  <strong>Tests:</strong> JSON POST passes; multipart POST passes; unsupported type yields 415.                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Parsing &amp; validation</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> <strong>Required field:</strong> <code>markdown</code> (non-empty after trim).  <strong>Optional:</strong> <code>filename</code>.  <strong>Parsing rules:</strong> read as UTF-8, use <code>errors='replace'</code>.  <strong>Empty/missing:</strong> return <code>400</code> with consistent JSON error.  <strong>Tests:</strong> missing/empty markdown → 400; correct multi-format parsing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Size enforcement</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Enforce <code>MAX_PASTE_SIZE</code> measured in UTF-8 bytes. Procedure:  <br/><br/>  1. If <code>Content-Length</code> header present and <code>Content-Length &gt; MAX_PASTE_SIZE + 1024</code>, return <code>413</code> immediately. <br/><br/>  2. After reading payload, compute <code>payload_bytes = len(markdown.encode('utf-8'))</code>. If <code>payload_bytes &gt; MAX_PASTE_SIZE</code>, return <code>413</code>. <br/><br/> <strong>Tests:</strong> Content-Length overflow; actual payload overflow even if Content-Length smaller.                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Filename rules</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> <strong>Sanitize:</strong> call <code>_safe_filename(filename)</code>. If result empty set base to <code>untitled</code>.  <strong>Extension:</strong> append <code>.md</code> if missing.  <strong>Length:</strong> truncate basename to safe filesystem length (e.g., 255).  <strong>Collision:</strong> if final path exists, append <code>-&lt;uuid&gt;</code> before <code>.md</code>.  <strong>Tests:</strong> special chars removed; extension appended; long names truncated; duplicates handled.                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Path traversal defense</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Compute <code>dest_abspath = os.path.abspath(os.path.join(STORAGE_PATH, safe_name))</code>. Verify <code>dest_abspath.startswith(os.path.abspath(STORAGE_PATH) + os.sep)</code>. If not, return <code>400 invalid_filename</code>. <strong>Tests:</strong> attempt <code>../../etc/passwd</code> style names are rejected.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Storage &amp; permissions</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Ensure <code>STORAGE_PATH</code> exists: <code>os.makedirs(STORAGE_PATH, exist_ok=True)</code>. Set directory and file permissions sensibly (<code>0o755</code> for dirs, <code>0o644</code> for files) if policy requires. <strong>Tests:</strong> directory creation; file permissions check.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Atomic write &amp; concurrency</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Use atomic write: prefer existing <code>render/core_io</code> helper. Fallback pattern:  <br/><br/>  1. Create temp file in same dir: <code>tempfile.NamedTemporaryFile(dir=STORAGE_PATH, delete=False)</code>. <br/><br/>  2. Write payload bytes, <code>f.flush()</code>, <code>os.fsync(f.fileno())</code>, close. <br/><br/>  3. <code>os.replace(temp_path, dest_path)</code> for atomic move. <br/><br/>  4. If dest exists, use unique name strategy described above. <br/><br/> <strong>Tests:</strong> simulate interrupt; concurrent saves produce unique files; no partial files on disk.                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Response schema</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> <strong>Success (201):</strong> JSON:  <br/><br/> <code>{ "ok": true, "status": "saved", "id": "&lt;uuid&gt;", "filename": "&lt;final_filename.md&gt;", "rel_path": "&lt;path/relative/to/STORAGE_PATH&gt;", "size": &lt;bytes&gt; }</code> <br/><br/> <strong>Note:</strong> Do <strong>not</strong> return absolute server filesystem paths. Include <code>url</code> only if secure public route exists.  <strong>Errors:</strong> <code>{ "ok": false, "error": "&lt;code&gt;", "details": "&lt;message&gt;" }</code>.  <strong>Tests:</strong> validate keys, types and absence of absolute paths.                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Logging &amp; observability</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> On success: log INFO <code>save-md saved id=&lt;id&gt; filename=&lt;filename&gt; size=&lt;bytes&gt; client=&lt;remote_addr&gt;</code>.  On client errors: log WARNING with reason. On exceptions: log ERROR with stacktrace. Include request id if available. <strong>Tests:</strong> logs contain entries for success and failure cases.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Security of stored content</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Store raw markdown only. Do not render at save time. Any future serving or HTML conversion must run through <code>render/sanitize.py</code> or equivalent whitelist sanitizer. Document this requirement. <strong>Tests:</strong> saved content equals input; security audit note added to README.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Rate-limiting &amp; auth</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Not implemented in this patch. Recommend project-level controls for production: authentication, per-user quotas, IP rate limits. Document requirement and flag for ops. <strong>Tests:</strong> document only; security team review recommended.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Client script behavior</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Implement <code>assets/script.save.js</code> to:  <br/><br/>  1. Register <code>ptt:save-request</code> listener and hook <code>#saveBtn</code> click. <br/><br/>  2. Read markdown from <code>#paste</code> or fallback <code>page-area</code>. <br/><br/>  3. If <code>filename</code> missing prompt user; default to <code>untitled.md</code>. <br/><br/>  4. Optional client-side size check against <code>MAX_PASTE_SIZE</code>. <br/><br/>  5. POST JSON to <code>/save-md</code>, handle JSON response. <br/><br/>  6. Update <code>#status</code> with outcome. Dispatch <code>ptt:save-response</code> with server response.  <br/><br/> <strong>Tests:</strong> UI triggers event; status messages display; no console errors; cross-browser checks.                                                                                                                                                                           </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>index.html change</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Minimal: add <code>&lt;script src="assets/script.save.js" defer&gt;&lt;/script&gt;</code> if missing. Do not alter existing save behaviors. Ensure new script cooperates via events. <strong>Tests:</strong> page loads; both old and new save flows function.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Collision policy</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Do not silently overwrite. Prefer user-friendly auto-rename: append <code>-&lt;uuid&gt;</code> when filename exists. Document returned <code>filename</code> in response. <strong>Tests:</strong> save same filename twice yields two files with distinct names.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Error handling details</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Use machine-friendly <code>error</code> codes plus human <code>details</code>. Example codes: <code>missing_markdown</code>, <code>payload_too_large</code>, <code>invalid_filename</code>, <code>unsupported_media_type</code>, <code>server_error</code>. <strong>Tests:</strong> each error path returns expected code and JSON.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>cURL examples</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> JSON POST example: <br/><br/> <code>curl -v -X POST http://127.0.0.1:5000/save-md \</code><br/><code>  -H "Content-Type: application/json" \</code><br/><code>  -d '{"markdown":"# Hello\\nNote","filename":"my-note.md"}'</code> <br/><br/> Multipart/form example: <br/><br/> <code>curl -v -X POST http://127.0.0.1:5000/save-md \</code><br/><code>  -F "markdown=@./notes.txt;type=text/plain" \</code><br/><code>  -F "filename=my-note.md"</code> </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Server tests (summary)</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Required server tests (13):  <br/><br/>  1. JSON POST success: returns 201, file exists, size correct.  <br/><br/>  2. Multipart POST success.  <br/><br/>  3. Missing <code>markdown</code> → 400.  <br/><br/>  4. Empty <code>markdown</code> → 400.  <br/><br/>  5. Payload &gt; <code>MAX_PASTE_SIZE</code> → 413.  <br/><br/>  6. Content-Length &gt; limit → 413.  <br/><br/>  7. Filename sanitized and <code>.md</code> appended.  <br/><br/>  8. Path traversal attempts rejected.  <br/><br/>  9. <code>STORAGE_PATH</code> auto-created.  <br/><br/> 10. Atomic write yields no partial files after simulated interrupt.  <br/><br/> 11. Duplicate filename saved as unique file.  <br/><br/> 12. Response JSON schema validated.  <br/><br/> 13. Existing <code>/save</code> route unaffected.                                                                               </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Client tests (summary)</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Required client/browser tests (12):  <br/><br/>  1. Save triggers <code>ptt:save-request</code>.  <br/><br/>  2. Filename prompt appears when needed.  <br/><br/>  3. Client-side size prevention works (optional).  <br/><br/>  4. <code>#status</code> updates for success and error.  <br/><br/>  5. Errors shown and accessible.  <br/><br/>  6. If server returns <code>url</code>, saved file opens/downloads.  <br/><br/>  7. Fallback works when <code>#paste</code> missing.  <br/><br/>  8. No JS console exceptions.  <br/><br/>  9. Script coexists with other save scripts.  <br/><br/> 10. Works on Chrome/Firefox/Edge.  <br/><br/> 11. Works in mobile emulation.  <br/><br/> 12. Event dispatch is cancelable and honored.                                                                                                                </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Acceptance checklist</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> All items below must be true before merge:  <br/><br/>  1. <code>POST /save-md</code> implemented and reachable.  <br/><br/>  2. Endpoint accepts JSON and multipart.  <br/><br/>  3. Enforces <code>MAX_PASTE_SIZE</code> in UTF-8 bytes.  <br/><br/>  4. Filenames sanitized, <code>.md</code> appended.  <br/><br/>  5. Prevents path traversal.  <br/><br/>  6. Uses atomic write and ensures no partial files.  <br/><br/>  7. Collision handling produces unique filenames.  <br/><br/>  8. Returns 201 with correct JSON and no absolute paths.  <br/><br/>  9. Logs save attempts and errors.  <br/><br/> 10. Existing <code>/save</code> unchanged.  <br/><br/> 11. Client script triggers endpoint and updates UI.  <br/><br/> 12. README updated with examples and security notes.  <br/><br/> 13. All server and client tests listed above pass. </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Implementation hazards to avoid</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Do not return absolute filesystem paths. Do not overwrite existing files silently. Do not assume <code>Content-Length</code> is accurate. Always validate resolved destination path. Use <code>os.replace</code> for atomicity and <code>fsync</code> before replace. Ensure temp files are created on same filesystem as <code>STORAGE_PATH</code>. These checks prevent common security and integrity issues.                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Topic"><div class="tv-left-col"><div class="left-col-heading"><strong>Next step deliverable</strong></div></div></td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> I will produce a single-file patch for <code>server.py</code> that implements the full spec above: imports, route handler, parsing, validation, atomic write (using existing helper or fallback), logging, and test stubs. After <code>server.py</code> is verified we will add <code>assets/script.save.js</code> and the <code>index.html</code> include. Confirm and I will generate the <code>server.py</code> patch now.                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr></tbody></table></div><div class="row-count">Rows: 23</div></div><div class="table-caption" id="Table5" data-table="Docu_0054_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Aspect" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Aspect</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Enhancement" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Enhancement</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-content">Web UI</div></div></td><td data-label="Enhancement"> Add a <strong>Save Table</strong> button to allow users to save one or multiple tables directly from the web interface.                                                                                                 </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-content">Batch mode</div></div></td><td data-label="Enhancement"> Already parses Markdown/CSV files into tables, sanitizes Dropbox paths, and optionally generates HTML via renderer or fallback.                                                                            </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-content">Table rendering</div></div></td><td data-label="Enhancement"> Preserve inline <code>code</code>, avoid auto <code>&lt;br&gt;</code>, sanitize sensitive paths.                                                                                                                                       </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-content">Config</div></div></td><td data-label="Enhancement"> Uses <code>load_env()</code> for paths, batch flags, port, host, storage.                                                                                                                                             </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-content">JS/HTML integration</div></div></td><td data-label="Enhancement"> Current <code>index.html</code> is minimal; it lacks interactive buttons. Enhancement requires adding buttons (e.g., Save), linking them to client-side JS (likely <code>script.table.js</code> or <code>extra.js</code>) for table export. </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-content">Goal</div></div></td><td data-label="Enhancement"> Provide a <strong>user-friendly way to load saved tables, save them under new names, and integrate seamlessly with the existing PTT workflow</strong>, without breaking batch or web mode.                              </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table6" data-table="Docu_0054_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by File" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Purpose of Revision" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Purpose of Revision</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Notes / Verification Points" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Notes / Verification Points</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-content"><code>server.py</code></div></div></td><td data-label="Purpose of Revision"> Add endpoints to list saved tables (<code>GET /api/saved_tables</code>) and load one (<code>GET /api/saved_tables/&lt;name&gt;</code>). </td><td data-label="Notes / Verification Points"> Check import correctness, path safety, JSON formatting, atomic reads, error handling.                                    </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-content"><code>templates/index.html</code></div></div></td><td data-label="Purpose of Revision"> Add toolbar button for “Load saved table(s)” and modal container for list UI.                               </td><td data-label="Notes / Verification Points"> Ensure IDs unique, inline styles minimal, DOM placement correct.                                                         </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-content"><code>assets/extra.js</code> (or append to <code>script.table.js</code>)</div></div></td><td data-label="Purpose of Revision"> Client-side logic to fetch saved table list, load content into paste input, and handle modal show/hide.     </td><td data-label="Notes / Verification Points"> Validate fetch URLs, JSON parsing, error handling, interaction with existing paste input function (<code>handlePastedInput</code>). </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-heading"><code>render/core_io.py</code> (optional / check</div><div class="left-col-content">if-needed)</div></div></td><td data-label="Purpose of Revision"> Confirm atomic write function exists and could be reused for future POST/save endpoint.                     </td><td data-label="Notes / Verification Points"> Verify signature, safe fallback if missing, avoid overwriting existing saved tables.                                     </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-content"><code>utils.py</code> (optional)</div></div></td><td data-label="Purpose of Revision"> If needed, minor helpers for safe path normalization or modal utility.                                      </td><td data-label="Notes / Verification Points"> Keep lightweight, do not interfere with existing helpers.                                                                </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-content"><code>main.py</code></div></div></td><td data-label="Purpose of Revision"> Confirm Flask app or server startup recognizes new endpoints.                                               </td><td data-label="Notes / Verification Points"> Check blueprint registration or direct app inclusion.                                                                    </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-content"><code>assets/style.css</code></div></div></td><td data-label="Purpose of Revision"> Optional minor CSS for modal display, basic responsiveness.                                                 </td><td data-label="Notes / Verification Points"> Keep minimal, ensure no clash with overrides.css.                                                                        </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><div class="table-caption" id="Table7" data-table="Docu_0054_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Change Area" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change Area</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Details" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Details</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Content-Length Enforcement</strong></div></div></td><td data-label="Details"> Added <code>_enforce_content_length</code> in <code>before_request</code> to limit body-bearing requests (POST/PUT/PATCH) to <code>MAX_PASTE_SIZE</code>. Returns <code>413</code> if exceeded.                                                      </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Security Headers</strong></div></div></td><td data-label="Details"> Added <code>_set_minimal_security_headers</code> in <code>after_request</code> with <code>X-Content-Type-Options</code>, <code>X-Frame-Options</code>, <code>Referrer-Policy</code>, <code>Permissions-Policy</code>. Non-invasive; uses <code>setdefault</code>.                     </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Template Cache Flush / Cache Busting</strong></div></div></td><td data-label="Details"> Added <code>_clear_jinja_template_cache</code> helper. <code>/convert</code> endpoint respects <code>v</code> query param or <code>FLUSH_TEMPLATES_ON_RENDER</code> config to flush Jinja cache.                                                     </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Reference-Style Footnote Stripping</strong></div></div></td><td data-label="Details"> <code>_strip_ref_footnotes</code> now removes <code>([ref][n])</code>, <code>[ref][n]</code>, <code>[n]</code> early in preprocessing to prevent them reaching renderers.                                                                            </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Escape Leading List Markers in Tables</strong></div></div></td><td data-label="Details"> <code>_escape_leading_list_markers_in_table_cells</code> escapes numeric or <code>-/*/+</code> at start of pipe-table cells, preventing Markdown from interpreting them as lists.                                              </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Renderer Fallback Logic</strong></div></div></td><td data-label="Details"> <code>_render_text_with_fallbacks</code> consolidated multiple fallbacks: <code>render_from_text</code> preferred, candidate modules/functions tried, finally <code>&lt;pre&gt;</code> escape. Adds <code>meta["converted"]=False</code> if fallback used. </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Convert Endpoint</strong></div></div></td><td data-label="Details"> <code>/convert</code> now: strips footnotes, escapes leading list markers, enforces max size, optionally flushes cache, adds post-render guard if <code>&lt;table&gt;</code> missing.                                                </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Save Endpoint</strong></div></div></td><td data-label="Details"> <code>/save</code> uses <code>_safe_filename</code>, tries <code>save_html_atomic</code>, falls back to atomic tempfile write. Returns consistent JSON with <code>path</code> and <code>id</code>.                                                              </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Get Saved Endpoint</strong></div></div></td><td data-label="Details"> <code>/saved/&lt;file_id&gt;</code> uses <code>read_saved</code> helper or falls back to storage path. Validates <code>commonpath</code> to prevent directory traversal.                                                                        </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Compatibility API Routes</strong></div></div></td><td data-label="Details"> Added <code>/api/convert</code>, <code>/api/render</code>, <code>/api/health</code> as aliases.                                                                                                                                           </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Logging Improvements</strong></div></div></td><td data-label="Details"> More info logs: feature flags, cache-bust flush, CORS enabled. Debug logs on manifest 404, preprocessing failure, save/read failures.                                                                    </td></tr><tr><td data-label="Change Area"><div class="tv-left-col"><div class="left-col-heading"><strong>Minor Fixes</strong></div></div></td><td data-label="Details"> Coerces integers safely (<code>_coerce_int</code>), safe filenames, robust exception handling everywhere.                                                                                                           </td></tr></tbody></table></div><div class="row-count">Rows: 12</div></div><div class="table-caption" id="Table8" data-table="Docu_0054_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Aspect" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Aspect</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Status / Notes" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Status / Notes</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Form / Convert endpoint</strong></div></div></td><td data-label="Status / Notes"> <code>#render-form</code> posts to <code>/api/render</code>. Matches updated <code>/convert</code> route. ✅                                                                                                                                                                                                                      </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Paste textarea</strong></div></div></td><td data-label="Status / Notes"> Fixed width 8 cm, non-resizable. Compatible with <code>_escape_leading_list_markers_in_table_cells</code>. ✅                                                                                                                                                                                               </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Cache-busting</strong></div></div></td><td data-label="Status / Notes"> <code>&lt;link&gt;</code> tags include <code>v=%%ASSET_HASH%%</code>. Good for CSS/JS; consider adding <code>v</code> support for <code>/convert</code> fetch if client-side uses query param. ✅                                                                                                                                                  </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Saved tables</strong></div></div></td><td data-label="Status / Notes"> <code>&lt;section id="saved"&gt;</code> present but hidden. Server now stores in configurable path. JS to fetch list not included. ⚠️ Need client-side fetch to populate saved tables.                                                                                                                           </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>TOC / Header</strong></div></div></td><td data-label="Status / Notes"> <code>#toc</code> and <code>#tocBar</code> exist. JS <code>PTToc.init</code> handles TOC population. Compatible. ✅                                                                                                                                                                                                               </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Tables placeholder</strong></div></div></td><td data-label="Status / Notes"> <code>#tables-placeholder</code> ready for dynamic injection. ✅                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Route HTML to areas</strong></div></div></td><td data-label="Status / Notes"> <code>PasteToTable.routeHtmlToAreas</code> correctly handles full-page vs fragment responses. ✅                                                                                                                                                                                                            </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>MutationObserver</strong></div></div></td><td data-label="Status / Notes"> Watches <code>#tables-viewer</code> to reveal <code>.table-wrapper</code>. Compatible with dynamically injected tables. ✅                                                                                                                                                                                             </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Modal / Copy</strong></div></div></td><td data-label="Status / Notes"> <code>#tv-copy-modal-template</code> exists. Matches <code>script.table.js</code> expectations. ✅                                                                                                                                                                                                                     </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Legacy alias</strong></div></div></td><td data-label="Status / Notes"> <code>copyAllMdBtn</code> delegated to <code>copyAllTablesBtn</code>. ✅                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>JS load order</strong></div></div></td><td data-label="Status / Notes"> XLSX → TOC → Core → Table → Tweaks → Worker. Correct. ✅                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Accessibility / ARIA</strong></div></div></td><td data-label="Status / Notes"> Roles, labels, <code>aria-live</code> present. ✅                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Security / headers</strong></div></div></td><td data-label="Status / Notes"> No inline JS/CSP violations; compatible with minimal headers from server. ✅                                                                                                                                                                                                                     </td></tr><tr><td data-label="Aspect"><div class="tv-left-col"><div class="left-col-heading"><strong>Outstanding improvements</strong></div></div></td><td data-label="Status / Notes"> 1. Add client-side fetch logic to populate <code>#saved</code> section from <code>/saved/&lt;file_id&gt;</code> or list endpoint.<br/>2. Ensure <code>/convert</code> fetch uses cache-busting query <code>v</code>. <br/>3. Optional: enhance table copy/export buttons to respect new save path (<code>tables</code>). </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>