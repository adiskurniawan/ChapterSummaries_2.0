<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761757969">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8056_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Very detailed conceptual notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Very detailed conceptual notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Very detailed conceptual notes"> <strong>ðŸ“Œ Section: File Overview (purpose & contract)</strong><br><strong>Purpose:</strong> Client-side controller for saving markdown to <code>POST /save-md</code>. Handles UI status, size guards, filename prompting, optional description, evented integration points, and a programmatic API (<code>window.PTT_SAVE</code>).<br><strong>Contract:</strong> Sends JSON <code>{ markdown, filename, description }</code>. Expects server JSON <code>{ ok: true false, filename?, url?, id?, rel_path?, size?, description? }</code>. Backward compatible with earlier versions that did not send <code>description</code>. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Configuration constants</strong><br><code>DEFAULT_MAX_PASTE_SIZE</code> sets client-side guard for UTF-8 bytes. <code>SAVE_ENDPOINT</code> is the POST URL. IDs (<code>STATUS_ID</code>, <code>SAVE_BTN_ID</code>, <code>PASTE_ID</code>, <code>FALLBACK_AREA_ID</code>, <code>DESCRIPTION_ID</code>) are DOM hooks. Change these only when you also update HTML/templates. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Utilities: safeTrim / readElementText / getMeta</strong><br><code>safeTrim</code> normalizes inputs and prevents exceptions. <code>readElementText</code> picks <code>.value</code> if present else textContent; robust against missing elements. <code>getMeta</code> reads <code>&lt;meta name=&quot;...&quot;&gt;</code> for configurable defaults. These functions isolate DOM variations and keep higher-level logic pure. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>getClientMaxSize</strong><br>Priority: <code>window.PTT_CONFIG.MAX_PASTE_SIZE</code> â†’ meta <code>ptt-max-paste-size</code> â†’ default. Returns integer bytes. Purpose: fail-fast client-side to avoid uploading huge payloads. Not authoritative; server must also enforce limits. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>utf8BytesLength</strong><br>Uses <code>TextEncoder().encode(str).length</code> when available. Falls back to <code>unescape(encodeURIComponent(str)).length</code>. Reason: byte-length matters for server/storage quotas. Important: different encodings on server could change byte counts; treat as an estimate unless server returns <code>size</code>. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>ensureMdSuffix / promptFilename</strong><br><code>ensureMdSuffix</code> enforces <code>.md</code>. <code>promptFilename</code> sanitizes user input (strip path separators, replace forbidden chars, trim length). Security note: client-side sanitization is UX only. Server must canonicalize and reject unsafe paths. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>promptDescription</strong><br>New behavior. Uses <code>window.prompt</code> as a minimal UI. Returns <code>null</code> on explicit cancel. Returns <code>&#x27;&#x27;</code> if user leaves blank. Trims and bounds length to 1000 chars. Design tradeoff: <code>prompt()</code> is synchronous and simple. Consider replacing with on-page UI for better UX and accessibility. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>updateStatus (ARIA live)</strong><br>Writes to <code>#status</code> if present. Otherwise creates an offscreen <code>#ptt-live-status</code> with <code>aria-live=&quot;polite&quot;</code>. Ensures screen-reader feedback even when visible status element is absent. When <code>isError</code> true sets <code>role=&quot;alert&quot;</code>. Minimal DOM mutation to avoid layout thrash. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>dispatchResponseEvent</strong><br>Emits <code>CustomEvent(&#x27;ptt:save-md-response&#x27;, { detail })</code>. Fires for success, failure, cancellation, and network errors. Event is non-cancelable and bubbles. Keep payload stable for downstream handlers. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>postSaveMarkdown (network layer)</strong><br>Encodes body as JSON <code>{ markdown, filename, description }</code> and uses <code>fetch</code> with <code>credentials: &#x27;same-origin&#x27;</code> and <code>cache: &#x27;no-store&#x27;</code>. Parses <code>resp.text()</code> then attempts <code>JSON.parse</code>. Returns <code>{ status, ok, json }</code>. Tolerant of non-JSON or empty responses; surfaces parsing errors as structured failure. Note: does not implement timeout â€” integrate with AbortController if needed. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>doSaveAction (core flow)</strong><br>1. Resolve markdown from <code>opts.markdown</code>, <code>#paste</code>, or fallback area.<br>2. Validate presence.<br>3. Check client size limit using <code>utf8BytesLength</code>.<br>4. Resolve filename: <code>opts.filename</code> or prompt.<br>5. Resolve description: <code>opts.description</code> if provided â†’ <code>#description</code> element â†’ meta default â†’ prompt.<br>6. Short-circuit and dispatch structured error objects for missing content, user cancels, and payload-too-large.<br>7. Call <code>postSaveMarkdown</code> and interpret <code>result.ok &amp;&amp; json.ok</code> as success; build <code>successDetail</code> including <code>description</code> echoed from server if present. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Event wiring: onSaveButtonClick & namespaced request</strong><br><code>onSaveButtonClick</code> dispatches a cancelable <code>ptt:save-md-request</code> event. Handlers can set <code>event.detail.markdown</code>, <code>.filename</code>, <code>.description</code> or cancel. After dispatch, <code>onSaveButtonClick</code> reads <code>detail</code> and calls <code>doSaveAction</code>. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>attachHandlers & programmatic API</strong><br>Attaches click handler to <code>#saveBtn</code> unless <code>data-__tv_save_attached</code> indicates core already owns the button. Adds a global listener for <code>ptt:save-md-request</code>. Exposes <code>window.PTT_SAVE.save(opts)</code> and <code>getClientMaxSize</code>. If <code>window.PTT_SAVE</code> exists, attaches <code>saveMd</code> alias. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Error handling strategy</strong><br>Uniform structured error objects: <code>{ ok:false, error: &#x27;code&#x27;, details: &#x27;message&#x27;, ... }</code>. Codes: <code>missing_markdown</code>, <code>payload_too_large</code>, <code>cancelled</code>, <code>cancelled_by_handler</code>, <code>invalid_server_response</code>, <code>server_error</code>, <code>network_error</code>, <code>client_error</code>. All branches call <code>dispatchResponseEvent</code>. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Backward compatibility and non-breaking changes</strong><br>Existing integrations that relied on previous payload or events continue to work. <code>description</code> is optional. Programmatic calls can pass <code>description</code> in <code>opts</code> or via <code>ptt:save-md-request.detail.description</code>. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Security considerations</strong><br>Client-side filename sanitization is UX only. Server must validate <code>filename</code>, prevent directory traversal, enforce ACLs, enforce server-side paste size, and sanitize stored <code>description</code>. Use <code>Content-Security-Policy</code> and <code>X-Content-Type-Options</code>. Consider rate-limiting the <code>/save-md</code> endpoint. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Accessibility considerations</strong><br><code>aria-live</code> fallback ensures SR users get status updates. <code>prompt()</code> is accessible but modal and awkward for screen-reader users. For better accessibility implement inline modal or form with focus management and labels. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Testing checklist (unit + integration)</strong><br>Unit: test utilities. Event-level: dispatch <code>ptt:save-md-request</code>. Network: mock <code>fetch</code>. UI: click <code>#saveBtn</code> with and without <code>#description</code>. Accessibility: verify <code>aria-live</code> content appears. Edge cases: huge payload, cancel prompt, malformed server JSON. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Performance & UX tradeoffs</strong><br><code>prompt()</code> is synchronous but simple. For frequent saves use inline modal or form to avoid blocking. Avoid heavy computation in save flow. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Server integration recommendations</strong><br>Server should validate and sanitize <code>filename</code> and <code>description</code>; store <code>description</code> with metadata; return <code>{ filename, url, size, id, description }</code>. On error return <code>{ ok:false, error, details }</code>. Enforce server-side size and auth. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Extensibility & integration patterns</strong><br>1. Host can intercept <code>ptt:save-md-request</code> to show modal and set details.<br>2. Host can call <code>window.PTT_SAVE.save({ markdown, filename, description })</code>.<br>3. Replace <code>promptDescription</code> with inline modal but preserve API/events. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Diagnostics & instrumentation</strong><br>Add <code>console.debug</code> hooks. Emit performance markers around <code>postSaveMarkdown</code>. Expose <code>window.__ptt_save_diag</code> for telemetry. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Migration notes (if replacing older script)</strong><br>Keep event names unchanged. Preserve cancelable semantics. Add <code>description</code> only as optional. Maintain API compatibility. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Summary â€” prioritized action items</strong><br>Short-term: replace script to add <code>description</code>. Medium: replace <code>prompt()</code> with modal. Long-term: add timeout, canonical size, richer diagnostics. </td></tr></tbody></table></div><div class="row-count">Rows: 24</div></div><div class="table-caption" id="Table2" data-table="Book_8056_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Very detailed conceptual notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Very detailed conceptual notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Very detailed conceptual notes"> <strong>ðŸ“Œ Top-level config & constants</strong><br><strong>Purpose:</strong> Centralize runtime knobs and safety caps.<br><strong>Key fields:</strong> <code>LIST_BTN_ID</code>, <code>PASTE_ID</code>, <code>STATUS_ID</code>, <code>STORAGE_INDEX_ENDPOINTS</code> (fallback order), <code>FILE_FETCH_TIMEOUT_MS = 12000</code>, <code>MAX_LIST_ITEMS = 5000</code>, <code>SELECT_VISIBLE_SIZE</code>.<br><strong>Design notes:</strong> Keep these at top to allow runtime overrides (e.g., <code>window.tvIndexUrl</code> or <code>data-index-url</code>). <code>MAX_LIST_ITEMS</code> prevents unbounded DOM or memory blow-ups when server returns huge indexes. <code>FILE_FETCH_TIMEOUT_MS</code> balances UX vs network reliability; consider exposure to user or per-request override for flaky networks. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Utilities: safeTrim / basenameFromPath / encodedSavedUrlFor / urlForEntryLegacy</strong><br><strong>Responsibilities:</strong> small, pure helpers for normalization and URL construction.<br>â€¢ <code>safeTrim(s)</code> â€” defensive trim to avoid throwing on <code>null</code>/<code>undefined</code>.<br>â€¢ <code>basenameFromPath(p)</code> â€” splits on <code>/</code> to get file base. Used to present friendly names from paths/URLs.<br>â€¢ <code>encodedSavedUrlFor(relPath)</code> â€” encodes path segments and returns <code>&#x27;/saved/&#x27; + enc&#x27;</code> unless <code>relPath</code> is absolute. Creates consistent server fetch URLs but assumes server uses <code>/saved/&lt;segments&gt;</code> route.<br>â€¢ <code>urlForEntryLegacy(entry)</code> â€” fallback to compute a URL from entry name.<br><strong>Subtleties:</strong> Functions must remain side-effect free. <code>encodedSavedUrlFor</code> may break with different server roots; consider injecting base prefix. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>updateStatus & aria-live management</strong><br><strong>Purpose:</strong> UX and accessibility for background actions.<br><strong>Behavior:</strong> Uses <code>#status</code> if exists; otherwise creates hidden <code>#ptt-live-status</code> with <code>aria-live=&quot;polite&quot;</code>.<br><strong>Notes:</strong> Good fallback for screen readers. Use <code>role=&quot;alert&quot;</code> only for errors. Rate-limit updates if fetch loop is frequent. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>createModal (generic modal factory)</strong><br><strong>Purpose:</strong> Accessible, self-contained modal for group and prefix selectors.<br><strong>Behavior and features:</strong> overlay with <code>role=&quot;dialog&quot;</code> and <code>aria-modal=&quot;true&quot;</code>, focus management, Escape-key removal, outside-click-to-close, Close button.<br><strong>Styling:</strong> uses CSS variables (<code>--panel</code>, <code>--text</code>, <code>--border</code>).<br><strong>Design notes:</strong> Returns <code>{overlay, panel, close}</code>. Avoids 3rd-party dependencies. Promise-based <code>open()</code> API optional for async lifecycle. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>fetchFileWithTimeout (network primitive)</strong><br><strong>Purpose:</strong> Fetch text with abort-on-timeout.<br><strong>Behavior:</strong> Uses <code>AbortController</code>, <code>setTimeout</code> to abort, <code>fetch</code> with <code>{cache:&#x27;no-store&#x27;, credentials:&#x27;same-origin&#x27;}</code>. Resolves <code>res.text()</code>. Errors propagate.<br><strong>Subtleties & risks:</strong> Fixed per-request timeout. Safe for small groups. Consider bounded parallelism, retry/backoff for large groups. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>normalizeGroupsIndex / normalizeIndexData (index parsing)</strong><br><strong>Purpose:</strong> Normalize many server index shapes into canonical client format.<br><strong>Handled shapes:</strong> <code>{ groups: [...] }</code>, <code>{ files: [...] }</code>, simple string arrays, array of objects with <code>name/url/description</code>.<br><strong>Output shape:</strong> Groups: <code>{name, description, files, url, tags, count}</code>. File lists: <code>{name, url, description}</code>.<br><strong>Design strengths:</strong> Defensive parsing prevents client crash. <code>MAX_LIST_ITEMS</code> enforces limit.<br><strong>Edge cases:</strong> Non-UTF8 text or huge descriptions may inflate DOM. Consider truncation or lazy-expansion. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>fetchGroupsIndexFirst (endpoint probing & fallback logic)</strong><br><strong>Purpose:</strong> Attempt endpoints in order and normalize first usable response.<br><strong>Behavior:</strong> Iterate <code>STORAGE_INDEX_ENDPOINTS</code>, fetch â†’ <code>res.text()</code> â†’ JSON parse â†’ detect format â†’ fallback to line-splitting plain-text. Returns <code>{type:&#x27;none&#x27;}</code> if none succeed.<br><strong>Robustness:</strong> Multiple formats, uses <code>cache:no-store</code>.<br><strong>Improvements:</strong> Add <code>Accept: application/json</code>, handle compressed responses, instrument endpoint failures. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>presentGroupsSelector (primary UI flow)</strong><br><strong>Purpose:</strong> Render searchable group list.<br><strong>Structure:</strong> Search input, scrolling list, each row: title, optional description, count badge, <code>Load</code> button.<br><strong>Behavior:</strong> <code>renderList(filter)</code> filters by name/description. <code>Load</code> closes modal and runs <code>loadGroupFiles(g)</code>. Fetched files appended with <code>\n\n</code> into <code>#paste</code> or <code>#page-area</code>, triggers Convert.<br><strong>Concurrency & UX:</strong> Serial fetch with <code>setTimeout(next,60)</code> between fetches to reduce head-of-line blocking, maintain order. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>presentPrefixSelector (legacy / prefix grouping)</strong><br><strong>Purpose:</strong> Fallback for flat file lists.<br><strong>Flow:</strong> Build prefix map keyed by first 9 chars. Select change shows <code>previewPanel</code>. <code>Load Selected</code> fetches matching files, auto-triggers Convert.<br><strong>UX nuance:</strong> Previews rendered via <code>textContent</code> to avoid XSS. Legacy compatibility layer; alternative grouping recommended if server metadata available. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>buildPrefixMap</strong><br><strong>Purpose:</strong> Bucket flat file lists by short fixed prefix.<br><strong>Behavior:</strong> First 9 chars as key, sort each bucket by name.<br><strong>Tradeoffs:</strong> Simple, deterministic, but brittle if meaningful prefixes exceed 9 chars. Nested folders suggest splitting by last directory segment. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>triggerConvertIfAvailable (integration point)</strong><br><strong>Purpose:</strong> Trigger client-side Convert after loading files.<br><strong>Strategy:</strong> Tries selectors in descending specificity: <code>#convertBtn</code>, <code>button[data-action=&quot;convert&quot;]</code>, <code>.convert</code>, <code>button#convert</code>, <code>window.convert()</code>. Uses <code>click()</code> then <code>setTimeout(...,40)</code>.<br><strong>Notes:</strong> Pragmatic, best-effort. Prefer explicit app event if available. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>attachListHandler (button wiring)</strong><br><strong>Purpose:</strong> Bind file-list modal to <code>#listBtn</code> once.<br><strong>Behavior:</strong> Idempotent using <code>btn.dataset.__ptt_list_attached</code>. Click triggers <code>fetchGroupsIndexFirst()</code> then presents groups or prefix selector.<br><strong>Edge cases:</strong> If <code>#listBtn</code> inserted later, call <code>attachListHandler()</code> after insertion. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Error handling and defensive coding</strong><br><strong>Approach:</strong> <code>try/catch</code> around DOM/async operations to avoid fatal exceptions. Status messages surface failures. Fetch errors append HTML comments for visibility.<br><strong>Risks:</strong> Swallowing exceptions may hide root causes. Optional <code>window.__ptt_debug = true</code> for console.error. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Security & XSS considerations</strong><br><strong>Safety:</strong> Dynamic text uses <code>textContent</code>. File content placed in <code>textarea.value</code> or <code>page.textContent</code>. Previews use <code>textContent</code> only.<br><strong>Caveats:</strong> Combined file contents may later be interpreted as HTML. Sanitize <code>description</code> if server untrusted. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Accessibility (a11y)</strong><br><strong>Practices:</strong> Modal uses <code>role=&quot;dialog&quot;</code> and <code>aria-modal</code>, focus set to first control, <code>aria-live</code> region for status, buttons have <code>aria-label</code>.<br><strong>Gaps:</strong> No focus trap. Recommend keyboard shortcuts for open/select. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Performance & scalability analysis</strong><br><strong>Network:</strong> Worst-case N requests for N files, serial approach â†’ O(N) wall time.<br><strong>CPU:</strong> Lightweight DOM updates.<br><strong>Memory:</strong> <code>MAX_LIST_ITEMS</code> prevents huge index arrays.<br><strong>Recommendations:</strong> Bounded parallel fetch pool, cancel button, lazy-load large groups, progress UI. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Race conditions & lifecycle issues</strong><br><strong>Cases:</strong><br>â€¢ Modal closed while fetch loop runs â†’ current code closes modal before fetch.<br>â€¢ Multiple Load clicks â†’ overlapping fetch loops; mitigation: disable button until completion.<br>â€¢ <code>triggerConvertIfAvailable()</code> may fail if template changes; prefer explicit event dispatch. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Test matrix & QA checklist</strong><br><strong>Unit/integration checks:</strong><br>â€¢ JSON <code>groups/index</code> with/without <code>description</code>.<br>â€¢ Flat index newline-separated.<br>â€¢ Absolute URLs.<br>â€¢ Large group (100+ files).<br>â€¢ Network timeout simulation.<br>â€¢ Accessibility: keyboard & screen reader.<br>â€¢ Security: <code>&lt;script&gt;</code> in description escapes correctly. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Instrumentation & diagnostics to add</strong><br><strong>Telemetry:</strong><br>â€¢ <code>console.time()</code> for <code>fetchGroupsIndexFirst</code> and <code>loadGroupFiles</code>.<br>â€¢ <code>window.__ptt_list_diag</code> with counters: endpoints tried, files fetched, failures.<br>â€¢ Optional <code>data-</code> attribute on modal showing source endpoint. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Short-term engineering improvements</strong><br>1. Add bounded parallel fetch pool.<br>2. Add per-load <code>AbortController</code> for cancellation.<br>3. Disable Load button during fetches.<br>4. Make <code>/saved/</code> base injectable.<br>5. Replace selector guessing in <code>triggerConvertIfAvailable</code> with single event <code>ptt:files-loaded</code>. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Long-term roadmap items</strong><br>1. Server provides structured metadata with folder, timestamps, snippet.<br>2. Pagination or cursored index endpoints for huge repos.<br>3. Streaming API for large groups.<br>4. Authenticated requests and ETag caching.<br>5. Centralized error reporting and progress UI. </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Summary / quick verdict</strong><br>Robust and pragmatic. Safely parses indexes, presents accessible modal, loads paste area defensively. Main limitations: serial network, lack of cancellation and instrumentation. Addressing parallelism, explicit convert signaling, and cancel mechanism elevates to world-class for heavy workloads. </td></tr></tbody></table></div><div class="row-count">Rows: 22</div></div><div class="table-caption" id="Table3" data-table="Book_8056_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Category"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Category</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Specification"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Specification</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Category"> <strong>Filename</strong>             </td><td data-label="Specification"> <code>groups_index.json</code> at project root                                                                                            </td></tr><tr><td data-label="Category"> <strong>Encoding</strong>             </td><td data-label="Specification"> UTF-8, compact JSON, <code>\n</code> line endings                                                                                         </td></tr><tr><td data-label="Category"> <strong>Atomic writes</strong>        </td><td data-label="Specification"> Write to <code>.tmp</code> file, then <code>os.replace()</code>                                                                                      </td></tr><tr><td data-label="Category"> <strong>Backups</strong>              </td><td data-label="Specification"> Keep last 3 copies (<code>groups_index.json.1</code>, <code>.2</code>, <code>.3</code>)                                                                         </td></tr><tr><td data-label="Category"> <strong>Fields</strong>               </td><td data-label="Specification"> <code>name</code>, <code>description</code>, <code>files</code> (required); optional <code>url</code>, <code>tags</code>, <code>count</code>                                                     </td></tr><tr><td data-label="Category"> <strong>Limits</strong>               </td><td data-label="Specification"> <code>name â‰¤ 50 chars</code>, <code>description â‰¤ 200 chars</code>                                                                                   </td></tr><tr><td data-label="Category"> <strong>Fallback</strong>             </td><td data-label="Specification"> If missing or corrupted, rebuild from filenames                                                                                </td></tr><tr><td data-label="Category"> <strong>Trigger points</strong>       </td><td data-label="Specification"> 1. After batch save (<code>/save</code> endpoint) <br> 2. Server startup <br> 3. Manual CLI trigger <br> 4. Cron or periodic regeneration </td></tr><tr><td data-label="Category"> <strong>Consistency</strong>          </td><td data-label="Specification"> Eventual (10â€“30 s lag acceptable)                                                                                              </td></tr><tr><td data-label="Category"> <strong>Validation</strong>           </td><td data-label="Specification"> No absolute paths; must match JSON schema                                                                                      </td></tr><tr><td data-label="Category"> <strong>Access (server)</strong>      </td><td data-label="Specification"> <code>/groups/index</code> â†’ serves JSON with <code>Cache-Control: max-age=10</code>                                                                 </td></tr><tr><td data-label="Category"> <strong>Access (client)</strong>      </td><td data-label="Specification"> Displays list of group <code>name</code> + <code>description</code>                                                                                  </td></tr><tr><td data-label="Category"> <strong>Security</strong>             </td><td data-label="Specification"> Read-only by server; sanitize text to prevent XSS                                                                              </td></tr><tr><td data-label="Category"> <strong>Performance</strong>          </td><td data-label="Specification"> Static JSON served directly; <1 MB typical                                                                                     </td></tr><tr><td data-label="Category"> <strong>Versioning</strong>           </td><td data-label="Specification"> Field <code>&quot;version&quot;: 1</code> for future schema updates                                                                                 </td></tr><tr><td data-label="Category"> <strong>Admin override</strong>       </td><td data-label="Specification"> Manual edits in <code>groups_index.json</code> preserved                                                                                  </td></tr><tr><td data-label="Category"> <strong>Extraction heuristic</strong> </td><td data-label="Specification"> Description = first non-empty line of first file in group if not manually set                                                  </td></tr><tr><td data-label="Category"> <strong>Search</strong>               </td><td data-label="Specification"> Optional pre-normalized search field (future)                                                                                  </td></tr><tr><td data-label="Category"> <strong>Logging</strong>              </td><td data-label="Specification"> Log each generation (timestamp, duration, group count)                                                                         </td></tr><tr><td data-label="Category"> <strong>Safety</strong>               </td><td data-label="Specification"> Sanitize text, strip control characters, truncate long text                                                                    </td></tr></tbody></table></div><div class="row-count">Rows: 20</div></div><div class="table-caption" id="Table4" data-table="Book_8056_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Component / Area**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Component / Area</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Purpose**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Purpose</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Implementation Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Implementation Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Component / Area"> <strong>App factory</strong> (<code>create_app</code>) </td><td data-label="Purpose"> Central entry creating Flask app </td><td data-label="Implementation Notes"> Configures storage path, limits, optional CORS, limiter, logging, and security headers.                                                                                </td></tr><tr><td data-label="Component / Area"> <strong>Imports and fallbacks</strong>      </td><td data-label="Purpose"> Ensures robust startup           </td><td data-label="Implementation Notes"> Uses local <code>_make_basic_logger</code>; attempts dynamic imports for <code>html_renderer</code>, <code>render</code>, and <code>utils</code>. Fallbacks if unavailable.                                        </td></tr><tr><td data-label="Component / Area"> <strong>Regex preprocessors</strong>        </td><td data-label="Purpose"> Clean up Markdown input          </td><td data-label="Implementation Notes"> <code>_strip_ref_footnotes</code> removes <code>[1]</code>, <code>[Dropbox][1]</code> patterns; <code>_escape_leading_list_markers_in_table_cells</code> prevents <code>1.</code> or <code>-</code> being parsed as list in table cells. </td></tr><tr><td data-label="Component / Area"> <strong>Content length guard</strong>       </td><td data-label="Purpose"> Prevents abuse                   </td><td data-label="Implementation Notes"> Rejects POST/PUT/PATCH over <code>MAX_PASTE_SIZE</code> (default 300 KB).                                                                                                         </td></tr><tr><td data-label="Component / Area"> <strong>Cache management</strong>           </td><td data-label="Purpose"> Control template reloading       </td><td data-label="Implementation Notes"> <code>_clear_jinja_template_cache()</code> flushes Jinja cache when <code>/convert?v=â€¦</code> requested.                                                                                     </td></tr><tr><td data-label="Component / Area"> <strong>Group index helper</strong>         </td><td data-label="Purpose"> Maintains file grouping index    </td><td data-label="Implementation Notes"> <code>_trigger_groups_index_async()</code> spawns background thread to regenerate <code>groups_index.json</code>.                                                                            </td></tr><tr><td data-label="Component / Area"> <strong>Endpoints: core</strong>            </td><td data-label="Purpose">                                  </td><td data-label="Implementation Notes">                                                                                                                                                                        </td></tr><tr><td data-label="Component / Area"> <code>/</code>                            </td><td data-label="Purpose"> Serve main <code>index.html</code>          </td><td data-label="Implementation Notes"> From <code>templates</code> or static fallback.                                                                                                                                   </td></tr><tr><td data-label="Component / Area"> <code>/convert</code>                     </td><td data-label="Purpose"> Convert Markdown â†’ HTML table    </td><td data-label="Implementation Notes"> Uses <code>render_from_text</code> if present; otherwise multiple fallbacks; ensures <code>&lt;table&gt;</code> present; returns JSON <code>{html, meta}</code>.                                              </td></tr><tr><td data-label="Component / Area"> <code>/save</code>                        </td><td data-label="Purpose"> Save rendered HTML               </td><td data-label="Implementation Notes"> Atomic write via <code>save_html_atomic</code> or manual tempfile replacement; returns JSON with file path + id.                                                                  </td></tr><tr><td data-label="Component / Area"> <code>/save-md</code>                     </td><td data-label="Purpose"> Save raw Markdown                </td><td data-label="Implementation Notes"> Handles JSON, multipart, or form data; atomic <code>.md</code> save with unique suffix; async index rebuild.                                                                      </td></tr><tr><td data-label="Component / Area"> <code>/saved/&lt;id&gt;</code>                  </td><td data-label="Purpose"> Serve saved file                 </td><td data-label="Implementation Notes"> Reads from <code>STORAGE_PATH</code>; validates path containment.                                                                                                                 </td></tr><tr><td data-label="Component / Area"> <strong>Endpoints: utilities</strong>       </td><td data-label="Purpose">                                  </td><td data-label="Implementation Notes">                                                                                                                                                                        </td></tr><tr><td data-label="Component / Area"> <code>/health</code>                      </td><td data-label="Purpose"> Simple health probe              </td><td data-label="Implementation Notes"> Returns <code>{ok: true}</code>.                                                                                                                                                  </td></tr><tr><td data-label="Component / Area"> <code>/manifest.json</code>               </td><td data-label="Purpose"> Serve manifest                   </td><td data-label="Implementation Notes"> Looks in <code>/assets</code> or project root.                                                                                                                                    </td></tr><tr><td data-label="Component / Area"> <code>/assets/&lt;file&gt;</code>               </td><td data-label="Purpose"> Static assets passthrough        </td><td data-label="Implementation Notes"> Returns file or 404.                                                                                                                                                   </td></tr><tr><td data-label="Component / Area"> <code>/saved/index</code>                 </td><td data-label="Purpose"> Lists saved files                </td><td data-label="Implementation Notes"> Returns JSON array of saved filenames.                                                                                                                                 </td></tr><tr><td data-label="Component / Area"> <code>/groups/index</code>                </td><td data-label="Purpose"> Lists grouped files              </td><td data-label="Implementation Notes"> Returns <code>groups_index.json</code> or computes prefixes dynamically.                                                                                                          </td></tr><tr><td data-label="Component / Area"> <strong>API aliases</strong>                </td><td data-label="Purpose"> Legacy compatibility             </td><td data-label="Implementation Notes"> <code>/api/convert</code>, <code>/api/render</code>, <code>/api/health</code> map to main endpoints.                                                                                                    </td></tr><tr><td data-label="Component / Area"> <strong>Security headers</strong>           </td><td data-label="Purpose"> Baseline protection              </td><td data-label="Implementation Notes"> Adds <code>X-Content-Type-Options</code>, <code>X-Frame-Options</code>, <code>Referrer-Policy</code>, <code>Permissions-Policy</code>.                                                                             </td></tr><tr><td data-label="Component / Area"> <strong>CLI entrypoint</strong>             </td><td data-label="Purpose"> <code>python server.py</code> run mode      </td><td data-label="Implementation Notes"> Reads env <code>FLASK_HOST</code>, <code>FLASK_PORT</code>, <code>FLASK_DEBUG</code>; launches app.                                                                                                     </td></tr></tbody></table></div><div class="row-count">Rows: 21</div></div><div class="table-caption" id="Table5" data-table="Book_8056_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Function"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Function</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Role"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Role</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Fit with Plan"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Fit with Plan</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Function"> <code>_default_write_atomic</code>  </td><td data-label="Role"> Writes safely to temp file + <code>os.replace()</code> </td><td data-label="Fit with Plan"> Exactly matches <em>atomic update</em> rule for <code>groups_index.json</code> </td></tr><tr><td data-label="Function"> <code>atomic_write_text()</code>    </td><td data-label="Role"> UTF-8 text writer with atomic semantics     </td><td data-label="Fit with Plan"> Use this for writing the JSON index                          </td></tr><tr><td data-label="Function"> <code>ensure_dir()</code>           </td><td data-label="Role"> Race-safe directory creator                 </td><td data-label="Fit with Plan"> Ensures parent folder for index exists                       </td></tr><tr><td data-label="Function"> <code>_ensure_dir_path()</code>     </td><td data-label="Role"> Internal mkdir fallback                     </td><td data-label="Fit with Plan"> Satisfies durability on all OS                               </td></tr><tr><td data-label="Function"> <code>_atomic_stream_write()</code> </td><td data-label="Role"> Stream variant                              </td><td data-label="Fit with Plan"> Optional for JSON streaming                                  </td></tr><tr><td data-label="Function"> CSV utilities            </td><td data-label="Role"> Unrelated but harmless                      </td><td data-label="Fit with Plan"> Leave unchanged                                              </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table6" data-table="Book_8056_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Item"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Item</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Status"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Status</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Key findings"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Key findings</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Action / Verification"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Action / Verification</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Item"> Scope of work               </td><td data-label="Status"> Complete (design + code snippets delivered) </td><td data-label="Key findings"> You requested groups_index.json feature and safer server I/O. I provided <code>render/core_io.py</code>, <code>render/groups_index.py</code> (generator), and a revised <code>server.py</code>.                                                 </td><td data-label="Action / Verification"> Confirm files placed in repo. Run tests below.                                                                                                </td></tr><tr><td data-label="Item"> <code>server.py</code> (final revised) </td><td data-label="Status">                                   Delivered </td><td data-label="Key findings"> Routes: <code>/convert</code>, <code>/save</code>, <code>/save-md</code>, <code>/saved/*</code>, <code>/saved/index</code>, <code>/groups/index</code>. Async trigger for index regeneration. Security headers and content-length guard present. Uses flexible generator import. </td><td data-label="Action / Verification"> Verify runtime import errors. Start app and exercise endpoints.                                                                               </td></tr><tr><td data-label="Item"> <code>render/core_io.py</code>         </td><td data-label="Status">                          Present & reviewed </td><td data-label="Key findings"> Implements atomic write, atomic_stream, ensure_dir, tmp frag dir, CSV helpers. Suitable for writing <code>groups_index.json</code>.                                                                                       </td><td data-label="Action / Verification"> Use <code>atomic_write_text()</code> to write index. Confirm file perms and no leftover tmp files.                                                       </td></tr><tr><td data-label="Item"> <code>render/groups_index.py</code>    </td><td data-label="Status">                Delivered earlier in session </td><td data-label="Key findings"> Generator: scans storage, groups by prefix, preserves manual descriptions, atomic write via rotate_backups + atomic_write_bytes. Produces compact JSON.                                                        </td><td data-label="Action / Verification"> Place under <code>render/</code>. Run <code>python -m render.cli</code> or call function to generate index.                                                         </td></tr><tr><td data-label="Item"> Atomic write & backups      </td><td data-label="Status">                                 Implemented </td><td data-label="Key findings"> <code>core_io.atomic_write_*</code> and <code>groups_index.rotate_backups</code> patterns provided. Writes use same-dir tmp + <code>os.replace</code>. Backups <code>groups_index.json.1</code> etc.                                                       </td><td data-label="Action / Verification"> Test concurrent writes. Confirm backup rotation count.                                                                                        </td></tr><tr><td data-label="Item"> Input sanitization          </td><td data-label="Status">                                 Implemented </td><td data-label="Key findings"> Normalization strips control chars, collapses whitespace, truncates to limits (name â‰¤50, desc â‰¤200). Preprocessor escapes list markers in table cells.                                                         </td><td data-label="Action / Verification"> Validate on representative files with control chars and leading list markers.                                                                 </td></tr><tr><td data-label="Item"> Schema & format             </td><td data-label="Status">                                 Implemented </td><td data-label="Key findings"> <code>{version, generated_at, groups:[{name,description,files,optional url,tags,count}]}</code>. UTF-8, compact JSON, newline-terminated.                                                                                 </td><td data-label="Action / Verification"> Validate JSON against schema. Check <code>generated_at</code> ISO format.                                                                                </td></tr><tr><td data-label="Item"> Triggers                    </td><td data-label="Status">             Implemented (best-effort async) </td><td data-label="Key findings"> Triggers: after save/save-md (threaded), server start (recommended insertion), CLI/manual, cron. Async uses <code>_trigger_groups_index_async</code>.                                                                     </td><td data-label="Action / Verification"> Ensure <code>render.groups_index.generate_groups_index</code> is importable or <code>utils.write_groups_index</code> exists.                                        </td></tr><tr><td data-label="Item"> Fallback behavior           </td><td data-label="Status">                                 Implemented </td><td data-label="Key findings"> If <code>groups_index.json</code> missing or unreadable <code>/groups/index</code> dynamically scans <code>STORAGE_PATH</code> and groups by prefix.                                                                                            </td><td data-label="Action / Verification"> Test when <code>groups_index.json</code> removed or corrupted.                                                                                           </td></tr><tr><td data-label="Item"> Security & headers          </td><td data-label="Status">                                 Implemented </td><td data-label="Key findings"> <code>X-Content-Type-Options</code>, <code>X-Frame-Options</code>, <code>Referrer-Policy</code>, <code>Permissions-Policy</code>. Client must escape descriptions when rendering HTML.                                                                     </td><td data-label="Action / Verification"> Confirm client uses <code>textContent</code> or equivalent.                                                                                              </td></tr><tr><td data-label="Item"> Limits & enforcement        </td><td data-label="Status">                                 Implemented </td><td data-label="Key findings"> <code>MAX_PASTE_SIZE</code> default 300000 bytes enforced via <code>request.content_length</code> (413 responses). Note: chunked uploads with unknown content-length may bypass check.                                               </td><td data-label="Action / Verification"> If needed, add explicit streaming read limits.                                                                                                </td></tr><tr><td data-label="Item"> Backup & rollback policy    </td><td data-label="Status">                                 Implemented </td><td data-label="Key findings"> <code>rotate_backups(path, keep=3)</code> in generator.                                                                                                                                                                   </td><td data-label="Action / Verification"> Verify existing backups after multiple regenerations.                                                                                         </td></tr><tr><td data-label="Item"> Logging & audit             </td><td data-label="Status">                       Partially implemented </td><td data-label="Key findings"> <code>logger.info</code> and <code>logger.exception</code> used. Generator logs regeneration. No structured audit store.                                                                                                             </td><td data-label="Action / Verification"> Add audit log file or retention policy if required.                                                                                           </td></tr><tr><td data-label="Item"> Tests recommended           </td><td data-label="Status">                                Not executed </td><td data-label="Key findings"> Checklist provided earlier.                                                                                                                                                                                    </td><td data-label="Action / Verification"> Run these: 1) generate index via CLI, 2) POST <code>/save-md</code>, 3) GET <code>/groups/index</code>, 4) corrupt index and confirm fallback, 5) concurrent saves. </td></tr><tr><td data-label="Item"> Remaining risks             </td><td data-label="Status">                   Needs manual verification </td><td data-label="Key findings"> - Missing <code>render/groups_index.py</code> in repo path or different signature. <br> - <code>io_utils</code> overrides may change behavior. <br> - Chunked uploads bypass content-length guard.                                   </td><td data-label="Action / Verification"> Run integration tests and adjust <code>_trigger_groups_index_async</code> to call generator explicitly if different signature.                           </td></tr><tr><td data-label="Item"> Next-step priority          </td><td data-label="Status">                                        High </td><td data-label="Key findings"> 1) Drop <code>render/groups_index.py</code> into <code>render/</code>. <br> 2) Ensure <code>render/core_io.py</code> is imported by generator. <br> 3) Start server and run test checklist.                                                               </td><td data-label="Action / Verification"> I can produce a test script or a unified diff. Select one.                                                                                    </td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><div class="table-caption" id="Table7" data-table="Book_8056_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Step"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Step</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Plan &amp; Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Plan & Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Step"> <strong>1. Requirements Review</strong>         </td><td data-label="Plan &amp; Notes"> Analyze current <code>server.py</code> and confirm goals: preserve existing <code>description</code> from Excel/VBA, update files/groups logic safely, maintain full backward compatibility. Confirm which endpoints (<code>/save-md</code>, <code>/groups/index</code>, <code>/convert</code>) are in scope. </td></tr><tr><td data-label="Step"> <strong>2. Static vs Dynamic Groups</strong>    </td><td data-label="Plan &amp; Notes"> Identify where <code>groups_index.json</code> is used: static (pre-written by Excel/VBA) vs dynamic generation (scanning storage). Ensure logic prioritizes <strong>existing descriptions</strong> when static index is present.                                               </td></tr><tr><td data-label="Step"> <strong>3. Safe Update of Groups</strong>       </td><td data-label="Plan &amp; Notes"> Refactor <code>groups_index()</code> so that <code>description</code> is never overwritten unless missing. Introduce helper function <code>_get_existing_description(group_name)</code> to centralize this logic.                                                                       </td></tr><tr><td data-label="Step"> <strong>4. File Naming & Storage</strong>       </td><td data-label="Plan &amp; Notes"> Review <code>_safe_md_filename</code> and <code>_atomic_write_bytes_to_path</code> to confirm atomic writes, collision handling, unique IDs, and proper permissions. Ensure new logic preserves backward-compatible filenames.                                               </td></tr><tr><td data-label="Step"> <strong>5. Batch vs Single Save</strong>        </td><td data-label="Plan &amp; Notes"> Audit <code>/save-md</code> route: batch saves must not overwrite existing descriptions; single saves remain unchanged. Prepare clear separation in code paths.                                                                                                   </td></tr><tr><td data-label="Step"> <strong>6. Rendering & Preprocessing</strong>   </td><td data-label="Plan &amp; Notes"> Ensure <code>_render_text_with_fallbacks</code> and <code>_escape_leading_list_markers_in_table_cells</code> remain untouched. Verify they donâ€™t interfere with table metadata.                                                                                              </td></tr><tr><td data-label="Step"> <strong>7. Logging & Debugging</strong>         </td><td data-label="Plan &amp; Notes"> Keep logging consistent (<code>logger.info</code>, <code>logger.exception</code>). Add optional debug logs to trace <strong>description preservation</strong> during batch saves.                                                                                                         </td></tr><tr><td data-label="Step"> <strong>8. Security & Path Checks</strong>      </td><td data-label="Plan &amp; Notes"> Maintain <code>_set_minimal_security_headers</code> and path checks in <code>/saved/&lt;file_id&gt;</code> to prevent directory traversal. Ensure new logic doesnâ€™t introduce risks.                                                                                               </td></tr><tr><td data-label="Step"> <strong>9. Testing Plan</strong>                </td><td data-label="Plan &amp; Notes"> - Single save with new tables<br>- Batch save with mixed new/existing groups<br>- Confirm descriptions from Excel remain intact<br>- Validate <code>/groups/index</code> JSON output<br>- Confirm <code>/convert</code> and <code>/save</code> endpoints remain stable                  </td></tr><tr><td data-label="Step"> <strong>10. Documentation & Deployment</strong> </td><td data-label="Plan &amp; Notes"> Update inline docstrings and comments about <code>description</code> preservation. Keep code drop-in ready. Confirm tested on staging before production deployment.                                                                                               </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>