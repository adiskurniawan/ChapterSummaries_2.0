<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761383177">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8034_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by File"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Top issues / observations (checked 10×)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Top issues / observations (checked 10×)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Severity"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Severity</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Concrete fixes / action items"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Concrete fixes / action items</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Tests to run"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Tests to run</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"> <strong><code>main.py</code></strong>                                           </td><td data-label="Top issues / observations (checked 10×)"> 1. Good unified entry (web + batch).<br>2. Robust renderer loader and safe pandas use.<br>3. <code>create_app</code> fallback may be <code>None</code> and silently aborts.<br>4. Env boolean parsing slightly permissive.<br>5. <code>load_env()</code> returns dict of strings so <code>cfg.get(&quot;P2T_BATCH&quot;)</code> logic OK but needs documented expectations.<br>6. Batch grouping heuristic is intricate but acceptable.                      </td><td data-label="Severity"> 1. Medium </td><td data-label="Concrete fixes / action items"> 1. Add clearer error message + non-zero exit if <code>create_app</code> missing in web mode.<br>2. Validate existence of <code>md_folder</code> earlier and bail with informative log.<br>3. Document pandas requirement for batch mode.                            </td><td data-label="Tests to run"> 1. Unit: run web mode with missing html_renderer -> fails clearly.<br>2. Run batch mode with/without pandas.<br>3. Integration: sample md folder -> output created.  </td></tr><tr><td data-label="File"> <strong><code>html_renderer.py</code></strong>                                  </td><td data-label="Top issues / observations (checked 10×)"> 1. Well-constructed wrapper + conservative minifier.<br>2. Good table-wrapping & newline→<code>&lt;br&gt;</code> logic inside <code>&lt;td&gt;</code> (preserves <code>&lt;pre&gt;/&lt;code&gt;</code>).<br>3. HTML minifier via token split may join text nodes unexpectedly.<br>4. Regex-based <code>&lt;h1&gt;</code> attribute injection may fail on complex h1 fragments.<br>5. <code>_MINIFY_TOKEN_RE</code> heavy use could alter whitespace in scripts/styles with unusual content. </td><td data-label="Severity">   1. High </td><td data-label="Concrete fixes / action items"> 1. Add unit tests for <code>_minify_html_str</code> with edge tokens.<br>2. Make <code>_H1_RE</code> replacement use HTML parser fallback (BeautifulSoup) when available.<br>3. Add small safeguard: do not minify when <code>&lt;pre&gt;</code> or <code>&lt;code&gt;</code> length above threshold. </td><td data-label="Tests to run"> 1. Pass varied HTML samples through <code>render_html</code> and confirm id/class on first <code>&lt;h1&gt;</code> preserved.<br>2. Run minifier on scripts/styles and ensure no content change. </td></tr><tr><td data-label="File"> <strong><code>server.py</code></strong>                                         </td><td data-label="Top issues / observations (checked 10×)"> 1. Strong security posture: content-length enforcement on body methods and after_request headers.<br>2. Good renderer fallback chain.<br>3. Manifest lookup logs debug only.<br>4. <code>/health</code> returns uptime=True instead of numeric uptime.<br>5. <code>render_from_text</code> import attempts are broad.                                                                                                        </td><td data-label="Severity">    1. Low </td><td data-label="Concrete fixes / action items"> 1. Return numeric uptime for <code>/health</code>.<br>2. Improve manifest 404 log to info when expected missing.<br>3. Ensure <code>MAX_PASTE_SIZE</code> cast safe (already done).                                                                                 </td><td data-label="Tests to run"> 1. <code>/convert</code> with oversized body -> 413.<br>2. Manifest absent -> 404 but log visible.<br>3. Saved file roundtrip test.                                             </td></tr><tr><td data-label="File"> <strong><code>utils.py</code></strong>                                          </td><td data-label="Top issues / observations (checked 10×)"> 1. Clean consolidated helpers.<br>2. <code>load_env()</code> merges into env but doesn't return typed values (strings only) — expected.<br>3. <code>atomic_write</code> robust.<br>4. <code>split_table_row</code> handles backticks & escaped pipes.<br>5. <code>is_table_separator</code> good.<br>6. <code>ensure_dir</code> ignores chmod failures silently (acceptable).                                                                                 </td><td data-label="Severity">    1. Low </td><td data-label="Concrete fixes / action items"> 1. Document <code>load_env</code> string-only contract.<br>2. Add small unit for <code>split_table_row</code> with nested backticks.                                                                                                                                </td><td data-label="Tests to run"> 1. <code>.env</code> parsing.<br>2. <code>split_table_row</code> edge cases.<br>3. atomic_write atomicity.                                                                                 </td></tr><tr><td data-label="File"> <strong><code>assets</code> module (copy_assets / write_overrides_css)</strong> </td><td data-label="Top issues / observations (checked 10×)"> 1. Copies assets defensively and writes fallbacks.<br>2. <code>project_assets_dir</code> resolution uses <code>__file__</code> + ".." which is OK.<br>3. <code>write_overrides_css</code> returns CSS string and writes file.<br>4. Includes left/right width formatting.                                                                                                                                                               </td><td data-label="Severity">    1. Low </td><td data-label="Concrete fixes / action items"> 1. Make <code>project_assets_dir</code> resolution robust when package installed (use package resources fallback).<br>2. Add exception-safe atomic write via <code>atomic_write</code> from utils.                                                                  </td><td data-label="Tests to run"> 1. Run copy_assets when repo assets missing -> fallback written.<br>2. Overrides CSS contains left/right widths.                                                     </td></tr><tr><td data-label="File"> <strong>CLI (<code>tables_viewer</code>/script)</strong>                        </td><td data-label="Top issues / observations (checked 10×)"> 1. Minimal, robust.<br>2. Tries multiple import fallbacks for <code>render_html</code>.<br>3. <code>RenderConfig</code> constructor probing is defensive.                                                                                                                                                                                                                                                                    </td><td data-label="Severity">    1. Low </td><td data-label="Concrete fixes / action items"> 1. Add clearer error when all render imports fail.<br>2. Normalize return codes for CLI (0 success, >0 failure).                                                                                                                              </td><td data-label="Tests to run"> 1. Call CLI with file/dir.<br>2. Run with RenderConfig missing, verify exit codes.                                                                                   </td></tr><tr><td data-label="File"> <strong><code>render/convert.py</code></strong>                                 </td><td data-label="Top issues / observations (checked 10×)"> 1. Very thorough markdown/CSV parsing and <code>render_table</code>.<br>2. Preserves single-line breaks inside cells by converting <code>\n</code> → markdown line-break (two spaces + <code>\n</code>) unless within code.<br>3. Alignment detection; <code>_SimpleDF</code> shim fallback.<br>4. Heavy reliance on pandas when available — acceptable.<br>5. Regexes and backtick handling are careful.                                          </td><td data-label="Severity"> 1. Medium </td><td data-label="Concrete fixes / action items"> 1. Add unit tests for inline-newline preservation vs <code>&lt;pre&gt;/&lt;code&gt;</code>.<br>2. Document interplay between <code>markdown_to_html_func</code> and <code>sanitize_bold_html</code>.<br>3. Confirm no double-escaping when input already HTML.                             </td><td data-label="Tests to run"> 1. Varied cell contents (inline code, <code>&lt;pre&gt;</code>, single newline).<br>2. Alignment detection with numeric columns.<br>3. CSV fallback tests.                            </td></tr><tr><td data-label="File"> <strong><code>render/core_assets.py</code></strong>                             </td><td data-label="Top issues / observations (checked 10×)"> 1. Robust asset discovery, atomic copy, manifest SRI creation, fingerprinting.<br>2. Good fallback to embedded content.<br>3. Careful <code>_atomic_copy_dispatch</code>.                                                                                                                                                                                                                                         </td><td data-label="Severity">    1. Low </td><td data-label="Concrete fixes / action items"> 1. Add explicit exception handling for large directories to avoid long loops.<br>2. Ensure <code>compute_sri</code> uses <code>sha384</code> default (already does).<br>3. Add unit to verify manifest mapping when fingerprinting enabled.                         </td><td data-label="Tests to run"> 1. Fingerprinted copy.<br>2. Manifest generation.<br>3. resolve_asset_name with hashed filenames.                                                                    </td></tr><tr><td data-label="File"> <strong><code>core_compat.py</code></strong>                                    </td><td data-label="Top issues / observations (checked 10×)"> 1. Thin compatibility shim re-exporting <code>core_renderer</code> / <code>core_table</code>.<br>2. Raises helpful ImportError if missing.                                                                                                                                                                                                                                                                                   </td><td data-label="Severity">    1. Low </td><td data-label="Concrete fixes / action items"> 1. Consider softer fallback (warn rather than raise) for better dev experience in some environments — only if package policy allows.                                                                                                          </td><td data-label="Tests to run"> 1. Test: import when internals present / absent.                                                                                                                     </td></tr><tr><td data-label="File"> <strong><code>render/core_fragments.py</code></strong>                          </td><td data-label="Top issues / observations (checked 10×)"> 1. Advanced fragment extraction & concurrent rendering.<br>2. Good normalization and detection of csv/markdown/html.<br>3. Concurrency implementation well-guarded (thread/process fallback).<br>4. Heavy reliance on picklability for process workers.<br>5. <code>_parse_table_html_regex</code> is approximate (acceptable as BS4 fallback exists).                                                            </td><td data-label="Severity"> 1. Medium </td><td data-label="Concrete fixes / action items"> 1. Add small guard for memory when inputs huge (stream samples only).<br>2. Improve renderer picklability check (try pickling first element rather than whole renderer).<br>3. Add unit tests for asset detection heuristics.                 </td><td data-label="Tests to run"> 1. Large number of small tables concurrently.<br>2. Process fallback when renderer not picklable.<br>3. HTML table extraction with/without bs4.                      </td></tr><tr><td data-label="File"> <strong><code>render/core_io.py</code></strong>                                 </td><td data-label="Top issues / observations (checked 10×)"> 1. Good atomic write patterns and tmp dir naming.<br>2. CSV encoding/dialect detection present.<br>3. <strong>Two critical issues found (fixed in earlier analysis):</strong> <code>read_csv_rows</code> ignored provided <code>delimiter</code> and had off-by-one in <code>max_rows</code> logic.<br>4. <code>_default_stream_write</code> only text-mode — no binary fallback.                                                                               </td><td data-label="Severity">   1. High </td><td data-label="Concrete fixes / action items"> 1. Fix <code>read_csv_rows</code> to honor <code>delimiter</code> and correct max_rows check.<br>2. Add binary-aware <code>_default_stream_write</code> (or document text-only semantics).<br>3. Add explicit <code>csv.Error</code> handling in <code>_detect_csv_dialect</code>.                   </td><td data-label="Tests to run"> 1. <code>read_csv_rows</code> with `delimiter='                                                                                                                                 </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table2" data-table="Book_8034_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **File / Area**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>File / Area</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Refined World-Class Conceptual Review (Checked ×10)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Refined World-Class Conceptual Review (Checked ×10)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Priority**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Priority</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Next Conceptual Actions**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Next Conceptual Actions</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File / Area"> <strong>main.py</strong>                  </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Acts as the unified control layer bridging CLI, web, and batch. Design shows robust modular loading and graceful fallback. Key conceptual focus: resilience vs. silent failure. <code>create_app</code> absence should be explicit, not quiet. Documentation clarity ensures maintainers understand env parsing and batch mode grouping rationale. </td><td data-label="Priority">      🟡      </td><td data-label="Next Conceptual Actions"> Clarify control flow hierarchy in documentation; explicitly define expected behavior for missing app factories.                                               </td></tr><tr><td data-label="File / Area"> <strong>html_renderer.py</strong>         </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> The conceptual heart of user-visible rendering. Strong inline sanitation, deterministic <code>&lt;br&gt;</code> conversion inside <code>&lt;td&gt;</code>, and careful whitespace collapse demonstrate professional attention. Conceptual risk: token-based minifier operates syntactically, not semantically.                                                            </td><td data-label="Priority">      🔴      </td><td data-label="Next Conceptual Actions"> Replace token-based minifier with DOM-aware approach for correctness; conceptually separate “beautify” vs. “minify” to preserve semantics.                    </td></tr><tr><td data-label="File / Area"> <strong>server.py</strong>                </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Represents the runtime orchestration between HTTP and render pipeline. Conceptually sound: explicit content length control and stateless API design. Potential fragility: manifest discovery and health endpoint semantics (currently boolean).                                                                                         </td><td data-label="Priority">      🟢      </td><td data-label="Next Conceptual Actions"> Reframe health endpoint to structured telemetry concept; strengthen observability story for system introspection.                                             </td></tr><tr><td data-label="File / Area"> <strong>utils.py</strong>                 </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Conceptually elegant utility layer: functional purity + atomic safety. <code>load_env()</code> typeless return reflects simplicity over strictness—acceptable if documented. The utilities encapsulate repeatable safety primitives, vital for resilience culture.                                                                                 </td><td data-label="Priority">      🟢      </td><td data-label="Next Conceptual Actions"> Elevate docstring philosophy: “utilities define safety boundaries.” Future conceptual work: introduce type hints to define expectations formally.             </td></tr><tr><td data-label="File / Area"> <strong>assets subsystem</strong>         </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Encapsulates reproducibility: deterministic copying and fingerprint creation. Strong philosophy of immutability and traceability. Conceptual design parallels software supply-chain integrity.                                                                                                                                          </td><td data-label="Priority">      🟢      </td><td data-label="Next Conceptual Actions"> Extend the conceptual narrative into reproducible build theory; assets manifest = “trust anchor.”                                                             </td></tr><tr><td data-label="File / Area"> <strong>CLI launcher</strong>             </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Minimalism meets resilience. Its multiple import strategies embody a self-healing principle: “run even when context drifts.”                                                                                                                                                                                                            </td><td data-label="Priority">      🟢      </td><td data-label="Next Conceptual Actions"> Frame the CLI as a “resilience adapter.” Document rationale behind multi-signature probing for maintainers.                                                   </td></tr><tr><td data-label="File / Area"> <strong>render/convert.py</strong>        </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Conceptual crux of data normalization: transforms human irregularity into machine consistency. Beautifully balances markdown parsing, alignment, and preservation of authorial intent. Conceptual issue: reliance on implicit pandas context vs. deterministic internal schema.                                                         </td><td data-label="Priority">      🟡      </td><td data-label="Next Conceptual Actions"> Strengthen philosophy of explicit schema declaration; codify “80% verbatim fidelity” as invariant.                                                            </td></tr><tr><td data-label="File / Area"> <strong>render/core_assets.py</strong>    </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Expresses the trust boundary between code and artifact. Manifest fingerprinting and SRI logic enforce verifiability—a cryptographic trust pattern.                                                                                                                                                                                      </td><td data-label="Priority">      🟢      </td><td data-label="Next Conceptual Actions"> Conceptually link SRI computation to supply-chain verification; elevate design doc to show provenance model.                                                  </td></tr><tr><td data-label="File / Area"> <strong>core_compat.py</strong>           </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Embodies long-term stability ethos. Ensures conceptual contract continuity.                                                                                                                                                                                                                                                             </td><td data-label="Priority">      🟢      </td><td data-label="Next Conceptual Actions"> Document design philosophy: “compatibility layers as institutional memory.”                                                                                   </td></tr><tr><td data-label="File / Area"> <strong>render/core_fragments.py</strong> </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Conceptually represents <em>parallel cognition</em>: concurrent parsing of fragments mirrors human parallel comprehension. Risk lies in ungoverned memory consumption when fragment population scales.                                                                                                                                         </td><td data-label="Priority">      🟡      </td><td data-label="Next Conceptual Actions"> Integrate conceptual guardrail—adaptive concurrency that scales with context size, not static thread count.                                                   </td></tr><tr><td data-label="File / Area"> <strong>render/core_io.py</strong>        </td><td data-label="Refined World-Class Conceptual Review (Checked ×10)"> Fundamental I/O abstraction: atomic persistence of semantic data. Its conceptual flaw—parameter ignorance and single-mode writer—reflects mismatch between <em>interface intent</em> and <em>execution behavior.</em>                                                                                                                                 </td><td data-label="Priority">      🔴      </td><td data-label="Next Conceptual Actions"> Re-align conceptual contract: arguments must be respected; writing must honor polymorphic data modes. Introduce invariant: “function signature truthfulness.” </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table3" data-table="Book_8034_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>📌 Full-file ANALYSIS: <code>main.py</code> — PasteToTable unified entry (web + optional batch Table Viewer features)</strong><br><br><strong>Scope & Deliverable:</strong> Silent absorption of the provided <code>main.py</code>. Single-table SAMPLE_OUTPUT-style analysis containing: high-level assessment, logical components, function/class records, cross-function notes, public API, testing matrix, 25-point audit (PASS / FAIL / ADVISORY), 10-pass verification summary, prioritized actionable checklist, risks & mitigations, deliverables/next steps, and final verification note. Ten careful verification passes completed. Benchmark reference included. <br><br><strong>High-level assessment (concise):</strong> Robust and conservative. Clear separation of web vs batch flows. Strengths: defensive imports, local pandas imports to avoid hard dependency for web-only runs, dynamic renderer loading, dropbox path sanitizer, inline-code-preserving HTML fallback, fragment cleanup, atomic intent for fallback outputs. Weaknesses: widespread <code>except Exception: pass</code> hides root causes; pandas-dependent code paths lack explicit startup validation for batch mode; pandas API fallbacks use deprecated args without explicit version gating; renderer plugin execution is potentially high-risk; no unit tests or CI snippets included. <br><br><strong>Logical components / subsystems:</strong> imports & logger init; renderer loader (<code>_load_renderer_callable</code>); CSV reader shim (<code>_safe_read_csv</code>); markdown table parser (<code>parse_markdown_tables</code> plus helpers <code>_flush_pipe_block</code>, <code>_flush_csv_block</code>); inline markdown-to-HTML (<code>markdown_to_html</code>); Dropbox path sanitizer (<code>_sanitize_cell_text_for_dropbox</code>, <code>_sanitize_dropbox_paths_df</code>); DataFrame → HTML renderers (<code>render_df_to_html_preserve_code</code>, <code>render_df_to_html</code>); fragment cleanup (<code>_cleanup_fragments_safe</code>); batch orchestration (<code>_run_batch</code>); CLI/web entry (<code>main</code>, <code>__main__</code> guard). <br><br><strong>Function / class records (structured summaries):</strong><br><strong>_load_renderer_callable</strong> — Dynamically loads <code>render_html</code> from local <code>html_renderer.py</code> or installed module; sets global <code>render_html</code>; logs info/warning; silent on failures beyond warnings. Purpose: optional pluggable renderer for batch HTML. Edge: arbitrary module execution risk; validate callable signature. <br><br><strong>_safe_read_csv</strong> — Local-imports pandas and attempts <code>read_csv</code> robustly across pandas versions; accepts string or file-like; uses <code>engine=&#x27;python&#x27;</code> and multiple fallback argument sets; rewinds file-like between attempts. Purpose: tolerant CSV parsing for pipe-delimited sections. Edge: raises if pandas missing; deprecated kwargs used in fallbacks; ensure <code>f.seek(0)</code> works for all file-likes. <br><br><strong>parse_markdown_tables</strong> — Scans content line-by-line, skips fenced code blocks, collects pipe-blocks and CSV-like blocks, flushes via helpers to produce list of pandas.DataFrame; conservative removal of separator rows and empty columns; preserves inline backticks and escaped pipes. Purpose: extract Markdown/CSV tables robustly. Edge: silent failures return empty list; behavior deterministic but needs unit tests for edge cases. <br><br><strong>markdown_to_html</strong> — Minimal inline markdown conversion: preserves inline code via placeholders, applies bold/italic regex replacements, avoids automatic <code>&lt;br&gt;</code> insertion. Purpose: safe fallback for renderer. Edge: regex may mis-handle complex/nested markdown; intentional conservative scope. <br><br><strong>_sanitize_cell_text_for_dropbox / _sanitize_dropbox_paths_df</strong> — Regex-based redaction of Windows and POSIX paths that contain 'dropbox'; returns <code>&lt;redacted&gt;</code> or basename. Purpose: avoid leaking local paths. Edge: may be overzealous if 'dropbox' appears legitimately; idempotent. <br><br><strong>render_df_to_html_preserve_code / render_df_to_html</strong> — Replace inline backtick code with placeholders, call <code>DataFrame.to_html(escape=True)</code>, then restore <code>&lt;code&gt;</code> tags; wrap in container div. Purpose: preserve inline <code>code</code> in HTML fallback. Edge: large DataFrames cause significant memory and CPU; consider streaming or pagination for >threshold. <br><br><strong>_cleanup_fragments_safe</strong> — Remove <code>.frags_*</code> dirs and <code>.fragments</code> under targets using <code>shutil.rmtree(ignore_errors=True)</code>. Purpose: cleanup rendering artifacts. Edge: ignores exceptions; returns list of removed paths. <br><br><strong>_run_batch</strong> — End-to-end batch: ensure pandas present, load renderer, group markdown files by filename prefix, parse tables, sanitize, call renderer if available else write minimal fallback HTML, cleanup fragments. Purpose: Table Viewer-style batch export. Edge: extensive <code>try/except</code> blocks swallow errors while allowing processing to continue; missing pandas logs error and returns. <br><br><strong>main</strong> — Loads config via <code>load_env()</code>, ensures storage dir, determines batch mode from env/CLI, runs <code>_run_batch</code> or starts web app via <code>create_app</code>. Purpose: unified entry for CLI and web. Edge: if <code>create_app</code> None, web aborts with log. <br><br><strong>Cross-function notes & interactions:</strong> <code>_run_batch</code> depends on <code>parse_markdown_tables</code>, sanitizer, <code>_load_renderer_callable</code>, and render helpers. <code>markdown_to_html</code> is passed into renderer when available. Global <code>render_html</code> and <code>logger</code> are only globals. <code>pandas</code> is imported lazily in multiple places. Many exception handlers swallow errors to preserve batch progress; this reduces debuggability. consider raising or logging stack traces for critical failures. <br><br><strong>Public API & contracts:</strong> No <code>__all__</code>. Practical public callables: <code>main()</code> (CLI), <code>parse_markdown_tables()</code> and <code>_run_batch()</code> (for programmatic reuse), <code>render_df_to_html()</code> for fallback rendering. Implicit contract: <code>parse_markdown_tables</code> returns <code>List[pandas.DataFrame]</code>. <code>render_html</code> expected signature: <code>(all_tables, output_html, markdown_to_html)</code>. <br><br><strong>Testing matrix (recommended tests):</strong> Unit tests for <code>parse_markdown_tables</code> (pipe tables, escaped pipes, code fences ignored, malformed tables), <code>_safe_read_csv</code> (StringIO and file-like rewind, pandas absent behavior), <code>markdown_to_html</code> (inline code/bold/italic and edge escapes), sanitizer (Windows/POSIX path redaction and false-positive cases), <code>render_df_to_html_preserve_code</code> (inline code preserved, large table handling), <code>_run_batch</code> (renderer present/absent, fallback writes, dry-run behavior), <code>main</code> (env and CLI batch switches, missing create_app abort). Integration tests: end-to-end batch with sample md files, web-mode with mocked <code>create_app</code>. Performance tests: parse large MD and large DataFrame to measure memory/time and ensure thresholds enforce safe behavior. <br><br><strong>25-point audit (PASS / FAIL / ADVISORY):</strong> 1. Syntax validity — <strong>PASS</strong>. 2. Top-level side-effect minimization — <strong>PASS</strong>. 3. Explicit exception handling — <strong>ADVISORY</strong> (replace silent <code>except: pass</code> with logged handling). 4. Dependency management — <strong>ADVISORY</strong> (pandas optional but batch requires it; add explicit checks/requirements). 5. Type hints presence — <strong>ADVISORY</strong> (partial; add annotations). 6. Default values correctness — <strong>PASS</strong>. 7. Fallback behavior correctness — <strong>PASS</strong>. 8. Input validation & sanitization — <strong>PASS</strong> (Dropbox sanitizer present). 9. I/O safety — <strong>ADVISORY</strong> (use atomic writes for fallback HTML). 10. Security-sensitive calls — <strong>ADVISORY</strong> (dynamic import of renderer; treat plugin as HIGH risk). 11. Logging adequacy — <strong>ADVISORY</strong> (good logger; increase debug-level stack traces). 12. Performance hotspots identified — <strong>PASS</strong>. 13. Memory management — <strong>ADVISORY</strong> (large DataFrame handling needs streaming/pagination). 14. Concurrency / multi-process safety — <strong>PASS</strong>. 15. Deterministic outputs — <strong>PASS</strong>. 16. Error reporting to user — <strong>ADVISORY</strong> (return codes and clearer CLI messages needed). 17. Testability — <strong>ADVISORY</strong> (good function boundaries; tests absent). 18. Encoding handling — <strong>PASS</strong> (UTF-8 for reads/writes). 19. Resource cleanup — <strong>PASS</strong>. 20. Backward compatibility caution — <strong>PASS</strong> (pandas-compat fallbacks present). 21. No locked-file modification — <strong>PASS</strong>. 22. Documentation & discoverability — <strong>ADVISORY</strong> (add module docstring and examples). 23. Sanitization coverage — <strong>PASS</strong> (Dropbox paths); consider PII patterns. 24. CSP / HTML safety — <strong>PASS</strong> (escape used). 25. CI readiness — <strong>ADVISORY</strong> (add GitHub Actions snippet). <br><br><strong>10-pass verification loop (executed conceptually ×10) — summary:</strong> All deterministic checks stable across iterations. Findings: parse determinism stable; fallback HTML deterministic; sanitizer idempotent; renderer-load behavior stable; silent exceptions remain and were consistently suppressing stack traces (ADVISORY). Large-file memory pressure identified in thought experiments (ADVISORY). Pandas-absent behavior consistent: batch aborts with log; web mode unaffected if pandas unused. <br><br><strong>Final prioritized actionable checklist (top 12 items):</strong> 1. Replace broad <code>except: pass</code> with <code>except Exception as e:</code> plus <code>logger.debug(traceback.format_exc())</code> and contextual warnings. (Critical) 2. Explicitly require or check pandas at batch startup; exit non-zero with a clear message if missing. (High) 3. Normalize pandas API usage: detect pandas version and use <code>on_bad_lines</code> when available; remove deprecated kwargs paths or gate them by version. (High) 4. Implement atomic writes for fallback HTML: write to temp file and <code>os.replace()</code> to final path. Add <code>--dry-run</code> option. (Medium) 5. Validate <code>render_html</code> signature and require user opt-in or signature for third-party renderer plugins. (High) 6. Add unit tests and a GitHub Actions CI snippet to run flake8/pytest and the 25-point checks. (High) 7. Add config-driven thresholds to avoid <code>to_html</code> for very large DataFrames; provide pagination or streaming fallback. (Medium) 8. Add explicit CLI exit codes for common failure modes. (Medium) 9. Add docstrings and a module header explaining contracts, locked-files note, and benchmark reference. (Low) 10. Improve <code>_safe_read_csv</code> rewind robustness and add tests for file-like edge-cases. (Medium) 11. Add instrumentation hooks (timing logs) around heavy operations. (Low) 12. Consider optional HMAC/GPG signature for accepted <code>html_renderer.py</code> plugin. (Advisory) <br><br><strong>Quick risks & mitigations (concise):</strong> Hidden exceptions reduce debuggability → log stack traces and escalate critical errors. Missing pandas causes silent abort in batch → check and fail fast with clear message. Renderer plugin can execute arbitrary code → require signature or explicit opt-in and validate callable shape. Large tables may blow memory → threshold checks and streaming/pagination. <br><br><strong>Deliverables & next steps (on your approval):</strong> If you approve fixes I will produce a single-file patch implementing prioritized items 1–4 and 8: replace silent exception handlers with logged handlers; add batch-mode pandas check with clear exit code; normalize <code>read_csv</code> fallbacks by pandas version detection; implement atomic fallback HTML writes and <code>--dry-run</code>; include unit test stubs for <code>parse_markdown_tables</code>, <code>_safe_read_csv</code>, markdown sanitizer and HTML fallback; provide a 10-point verification checklist and rollback instructions with original checksum. If you choose analysis-only, no changes will be made. <br><br><strong>Final verification statement:</strong> Analysis completed with 10 careful conceptual verification passes. AST-level structure, parsing heuristics, sanitization, fallback paths, and deterministic outputs validated. Items marked ADVISORY require action as listed above. This single-table SAMPLE_OUTPUT is complete and includes the required benchmark reference: [https://adiskurniawan.github.io/ChapterSummaries_2.0/summaries/Book_9001.html#Table4](https://adiskurniawan.github.io/ChapterSummaries_2.0/summaries/Book_9001.html#Table4). </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table4" data-table="Book_8034_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by File"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Role / Purpose"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Role / Purpose</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Major behaviors &amp; guarantees"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Major behaviors & guarantees</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Key functions (signature → short description)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Key functions (signature → short description)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Defensive/fallbacks &amp; edge-case handling"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Defensive/fallbacks & edge-case handling</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Risks / Compatibility notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Risks / Compatibility notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"> <code>render/core_utils.py</code> </td><td data-label="Role / Purpose"> Small utility helpers used across render package to sanitize IDs/paths, minimal HTML passthrough, SRI attr helper, lightweight fragment checks and safe streaming of iterables. </td><td data-label="Major behaviors &amp; guarantees"> Lightweight, dependency-free helpers that are intentionally conservative and non-failing; intended to be safe to call in many contexts (CLI, web, worker). </td><td data-label="Key functions (signature → short description)"> <code>_sanitize_id(x: Optional[str], idx: Optional[int]=None) -&gt; str</code> → produce safe HTML id (alnum / <code>-</code> / <code>_</code>), collapse dashes, fallback <code>id-{idx}</code>.<br> <code>_sanitize_output_path(x: Any) -&gt; str</code> → stringify path, fallback <code>&quot;output.html&quot;</code>.<br> <code>_sanitize_html_whitelist(s: Any) -&gt; str</code> → minimal pass-through wrapper (real sanitization delegated elsewhere).<br> <code>_sri_attr(url: str, cdn_integrity: Optional[dict]=None) -&gt; str</code> → return <code> integrity=&quot;...&quot; crossorigin=&quot;anonymous&quot;</code> if mapping present.<br> <code>_frag_contains_rows(content: Optional[str]) -&gt; bool</code> → quick regex check for <code>&lt;tbody&gt;\s*&lt;tr</code>.<br> <code>_take_and_stream(rows_iterable: Iterable[Any], n: int) -&gt; (List, Iterable)</code> → non-destructive take-N with defensive fallbacks. </td><td data-label="Defensive/fallbacks &amp; edge-case handling"> All functions wrap implementation in <code>try/except</code> and log debug on failure. Fallback values: empty string or safe literal (<code>&quot;output.html&quot;</code>, <code>id-{idx}</code>) are returned rather than raising. <code>_take_and_stream</code> handles non-iterables, broken iterators, and falls back to materializing list if necessary. Regex usage is simple and bounded to avoid ReDoS surface. </td><td data-label="Risks / Compatibility notes"> Very low-risk utilities, but note:<br>• <code>_sanitize_html_whitelist</code> is <strong>not</strong> a full sanitizer — callers must use real sanitizer (file documents this).<br>• <code>_sri_attr</code> relies on exact key membership in provided mapping — callers must normalize URLs.<br>• <code>_frag_contains_rows</code> is a heuristic (regex) and may miss unusual table markup (whitespace, comments, uppercase variants covered by <code>IGNORECASE</code> but complex HTML may break).<br>• <code>_take_and_stream</code> may materialize large iterables when fallback runs — callers should prefer already-indexable sequences for large data.<br>• Logging at debug only; errors are swallowed which is intentional but may hide upstream problems if logging not enabled. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table5" data-table="Book_8034_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by File"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Role / Purpose"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Role / Purpose</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Major behaviors &amp; guarantees"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Major behaviors & guarantees</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Key functions (signature → short description)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Key functions (signature → short description)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Defensive/fallbacks &amp; edge-case handling"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Defensive/fallbacks & edge-case handling</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Risks / Compatibility notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Risks / Compatibility notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"> <code>markdown.py</code> </td><td data-label="Role / Purpose"> Conservative, self-contained Markdown → HTML pipeline optimized for safe inline rendering of table cells and robust pipe-table / CSV detection. Provides a pluggable MarkdownRenderer, light allowlist sanitizer, code stashing, underscore-preservation, and an optional in-memory LRU cache. </td><td data-label="Major behaviors &amp; guarantees"> - Attempts python-markdown first (pluggable <code>MarkdownRenderer</code>) then a pure-python fallback. <br>- Preserves underscores inside words, preserves inline code, and renders table cells with inline-only rules. <br>- Ensures contiguous pipe/CSV blocks outside fenced code are stashed and converted to <code>&lt;table&gt;</code> HTML fragments. <br>- Best-effort sanitization and external-link <code>rel</code> enforcement applied to final output. <br>- Optional thread-safe LRU cache for rendered outputs. </td><td data-label="Key functions (signature → short description)"> <code>markdown_to_html(md_text: Optional[str]) -&gt; str</code> → top-level converter (tries renderer, falls back to <code>_fallback_markdown_to_html</code>). <br><code>get_markdown_renderer(config: Optional[Dict]) -&gt; Callable[..., str]</code> → returns callable <code>.convert</code>. <br><code>MarkdownRenderer.convert(prepped, fenced_map=None, inline_map=None, table_map=None, nl2br=None) -&gt; str</code> → uses python-markdown then restores placeholders and strips <code>&lt;br&gt;</code> in <code>&lt;td&gt;/&lt;th&gt;</code> when configured. <br><code>_stash_code(text) -&gt; (text, fenced_map, inline_map)</code> → placeholders for fenced & inline code. <br><code>_stash_tables(text) -&gt; (text, table_map)</code> → detects/extracts pipe & CSV blocks (outside fenced code). <br><code>_render_table_block(raw_lines) -&gt; str</code> and <code>_render_csv_block(raw_lines) -&gt; str</code> → produce plain <code>&lt;table&gt;...&lt;/table&gt;</code> using <code>_render_cell_inline</code>. <br><code>_render_cell_inline(text) -&gt; str</code> → inline-only rendering for cell content (emphasis with <code>*</code>, code spans), then sanitizes. <br><code>configure_render_cache(enabled,maxsize)</code> → toggle LRU cache. </td><td data-label="Defensive/fallbacks &amp; edge-case handling"> - Multiple layered fallbacks: if python-markdown or renderer fails, <code>_fallback_markdown_to_html</code> runs (uses same placeholders, inline renderer). <br>- Code & table placeholders prevent accidental processing of fenced/inline code when pre-processing underscores. <br>- Underscore preprocessor protects word-internal underscores and converts escapes; it avoids touching placeholders. <br>- Table stashing avoids fenced blocks and detects simple CSV blocks (uses <code>csv.reader</code> but falls back to naive split). <br>- Sanitizer is conservative: removes dangerous tags/events, escapes unknown tags, and only allows a small tag/attr set; <code>_enforce_link_rel</code> adds <code>rel</code> to external links. <br>- Thread-safety: renderer cache and default renderer guarded by locks. <br>- Cache operations guarded by locks and tolerant of missing python-markdown. </td><td data-label="Risks / Compatibility notes"> - Sanitizer is regex-based and small; may not match full HTML parsing semantics — risk of bypass if maliciously crafted HTML (recommend using an HTML parser sanitizer for high-security contexts). <br>- Placeholder tokens (<code>@@FENCED...@@</code>, etc.) could theoretically collide with user content (low but present). <br>- Heuristics for CSV/header detection and table detection can misclassify complex inputs (quoted multiline CSV, irregular rows). <br>- Relies on optional external <code>markdown</code> package; behavior differs if unavailable. <br>- Regex-heavy processing may be slower on very large documents; cache helps but must be enabled explicitly. <br>- <code>MarkdownRenderer</code> creates a fresh python-markdown instance per call (isolation vs. cost tradeoff). <br>- <code>strip_table_br</code> semantics: default in module-level getter preserves <code>&lt;br&gt;</code> in cells (settable), callers must be aware. <br>- XSS residual risk: light sanitizer + placeholder restore increases attack surface vs. a full DOM sanitizer. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table6" data-table="Book_8034_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by File"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Role / Purpose"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Role / Purpose</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Major behaviors &amp; guarantees"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Major behaviors & guarantees</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Key functions (signature → short description)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Key functions (signature → short description)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Defensive/fallbacks &amp; edge-case handling"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Defensive/fallbacks & edge-case handling</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Risks / Compatibility notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Risks / Compatibility notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"> <code>render/sanitize.py</code> </td><td data-label="Role / Purpose"> Central HTML sanitizer used by renderer stack (safe-by-default cleaning, optional table allowance). Exposes <code>sanitize_html</code> as the primary API. </td><td data-label="Major behaviors &amp; guarantees"> - Removes/neutralizes dangerous tags and attributes (script, iframe, embed, on* handlers, style).<br>- By default <strong>disallows <code>&lt;br&gt;</code></strong> to avoid break-injection in table cells.<br>- Accepts bleach if installed (preferred path) and falls back to an <code>HTMLParser</code>-based cleaner otherwise.<br>- Only allows safe URL schemes (<code>http/https/mailto</code>), relative URLs, and <strong>strict</strong> base64 image data URIs for common image types. </td><td data-label="Key functions (signature → short description)"> <code>sanitize_html(html_text: str, allow_tables: bool = False) -&gt; str</code> → top-level cleaner that chooses allowed tags and runs bleach or fallback, then neutralizes script tags outside code/pre.<br><code>is_safe_url(url: Optional[str]) -&gt; bool</code> → checks scheme and strict data:image pattern.<br><code>bleach_clean(html_text: str, allowed_tags: Optional[List[str]] = None) -&gt; str</code> → uses bleach, linkify, and post-processes attributes conservatively.<br><code>fallback_clean(html_text: str, allowed_tags: Optional[List[str]] = None) -&gt; str</code> → HTMLParser-based fallback using <code>FallbackCleaner</code>.<br><code>FallbackCleaner</code> (class) → tokenizes and emits only allowed tags/attributes; escapes data.<br><code>_neutralize_script_tags_outside_code(text: str) -&gt; str</code> → escapes <code>&lt;script&gt;</code> tokens outside <code>&lt;pre&gt;/&lt;code&gt;</code>.<br><code>_attr_allowed_for_tag(attr_name, tag) -&gt; bool</code> → wildcard-aware attribute check. </td><td data-label="Defensive/fallbacks &amp; edge-case handling"> - Two-path implementation: <strong>bleach</strong> path with post-processing of attributes (regex-based start-tag sanitizer) and <strong>FallbackCleaner</strong> (HTMLParser) when bleach unavailable.<br>- Strict data image regex (<code>IMG_DATA_MIME</code>) to limit allowed <code>data:</code> URIs.<br>- Attribute whitelist supports <code>*</code> and wildcard suffixes (e.g., <code>aria-*</code>, <code>data-*</code>) and rejects event handlers/style.<br>- After cleaning, script tokens are neutralized outside code/pre to avoid both execution and mangling of literal code examples.<br>- <code>allow_tables</code> parameter removes table tags from allowed set when False. </td><td data-label="Risks / Compatibility notes"> - Post-processing of bleach output uses regex to reparse start-tags — regex is brittle vs. a true DOM parser; malformed/edge-case HTML could produce unexpected results.<br>- Bleach-dependent behavior: different runtime surface if bleach missing (linkify, attribute handling differences).<br>- <code>IMG_DATA_MIME</code> is strict (only png/jpeg/jpg/gif/webp) — legitimate data-URIs of other image types will be dropped.<br>- HTMLParser fallback may escape or alter input formatting (affects rich markup fidelity).<br>- Removing <code>&lt;br&gt;</code> globally can change intended formatting; callers must set <code>allow_tables</code>/downstream handling deliberately.<br>- Performance: large documents run through regex/post-processing may be slower; bleach is faster/more robust when present. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>