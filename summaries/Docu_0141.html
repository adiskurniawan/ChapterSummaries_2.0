<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1765644812">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0141_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Purpose</strong>:<br>Enumerate every input, selectable option, and expected computed output used by the official PPh 21 calculator UI and guidance so you can map them into the <code>pph21_2025</code> Excel design. All items checked against the official calculator page and the DJP “Cermat” guide. (kalkulator.pajak.go.id). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Top-level control fields (UI selectors)</strong>:<br>• <code>Jenis Pemotongan</code> — PPh 21 Bulanan <code>|</code> PPh 21 Final <code>|</code> PPh 21 Tidak Final <code>|</code> PPh 21 Tahunan. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Object / category codes</strong>:<br>• <code>Kode Objek Pajak</code> — numeric code + label (e.g., <code>21-100-01 Pegawai Tetap</code>, <code>21-100-02 Penerima Pensiun Berkala</code>, <code>21-100-03 Pegawai Tidak Tetap</code>, …). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Calculation mode / scheme</strong>:<br>• <code>Skema Penghitungan</code> — <code>Gross</code> vs <code>Gross Up</code>. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Period / frequency controls</strong>:<br>• <code>Period</code> (e.g., <code>2025-11</code>).<br>• <code>Penghitungan</code>: <code>Setahun</code> / <code>Disetahunkan</code>. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Employee / recipient info</strong>:<br>• <code>nip</code>/<code>NIK</code>.<br>• <code>npwp</code>.<br>• <code>name</code>.<br>• <code>status keluarga</code> / <code>PTKP category</code> (TK/0, TK/1, K/0, …). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Gross income components (1–7)</strong>:<br>1. GAJI/PENSIUN/THT/JHT<br>2. TUNJANGAN PPh<br>3. TUNJANGAN LAINNYA/LEMBUR<br>4. HONORARIUM<br>5. PREMI ASURANSI DARI PEMBERI KERJA<br>6. NATURA/KENIKMATAN<br>7. TANTIEM/BONUS/GRATIFIKASI/JASA PRODUKSI/THR<br>8. JUMLAH PENGHASILAN BRUTO (computed). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Allowed deductions (9–11)</strong>:<br>9. BIAYA JABATAN / BIAYA PENSIUN<br>10. IURAN PENSIUN / HARI TUA<br>11. ZAKAT / SUMBANGAN KEAGAMAAN<br>12. JUMLAH PENGURANGAN (computed). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Intermediate computed fields</strong>:<br>13. PENGHASILAN NETO (8–12)<br>14. PENGHASILAN NETO MASA SEBELUMNYA<br>15. NETO UNTUK PERHITUNGAN (SETahun/DIsetahunkan)<br>16. PTKP<br>17. PKP. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Tax computation options</strong>:<br>• <code>DPP</code>, <code>Tarif</code>, TER-table mode, progressive mode.<br>• <code>Jenis PPh Tahunan</code> selector (A1/A2/P3K). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Previously withheld / DTP</strong>:<br>19. PPh 21 DIPOTONG SEBELUMNYA<br>20. PPh 21 DTP SEBELUMNYA<br>21. PPh 21 TERUTANG (computed). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Other UI fields</strong>:<br>• Income already withheld in same period.<br>• CAPTCHA (ignored for Excel design). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>PTKP values</strong>:<br>• PTKP constants for all codes (TK/0 = 54,000,000; TK/1 = 58,500,000; etc.). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>TER & scheme notes</strong>:<br>• TER regime uses effective-rate table; include both TER and progressive logic. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Output fields to mirror</strong>:<br>• Monthly PPh 21, annual PPh 21, withheld amounts, DTP amounts, DPP, Tarif slices. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Reporting fields</strong>:<br>• nip, npwp, name, period, income components, deductions, annual_gross, annual_tax, prior_withheld, dtp_amount, net balance; map to bukti_potong.csv & per11_payload.csv. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Validation rules</strong>:<br>• Required: nip, name, period (YYYY-MM/YYY).<br>• npwp normalized; derive <code>npwp_status</code>.<br>• Numeric fields ≥ 0.<br>• PTKP code must match allowed mapping. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>10× verification checklist</strong>:<br>1) Income items 1–7 complete.<br>2) Deductions 9–11 complete.<br>3) PTKP table correct.<br>4) Options surfaced.<br>5) TER mode included.<br>6) Prior-withheld & DTP correct.<br>7) Rounding rules correct.<br>8) Full object-code list included.<br>9) Export schemas complete.<br>10) CAPTCHA noted. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>VBA mapping recommendations</strong>:<br>• Add income_1…income_7, deduction_9…deduction_11.<br>• Add PTKP_code, object_code, calc_scheme, jenis_pemotongan, jenis_pajak_tahunan, prior_withheld, prior_dtp. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Edge cases</strong>:<br>• TER may include >40 tiers.<br>• PTKP married-dependent mapping. </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Next step</strong>:<br>Choose A (fetch TER+PTKP tables) or B (proceed with module-by-module mapping). </td></tr><tr><td data-label="PPh 21 — Complete field inventory kalkulator.pajak.go.id and DJP documentation)"> <strong>Sources</strong>:<br>kalkulator.pajak.go.id; DJP “Cermat Pemotongan” PDF; TER guidance articles. </td></tr></tbody></table></div><div class="row-count">Rows: 22</div></div><div class="table-caption" id="Table2" data-table="Docu_0141_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown — modUtils**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown — modUtils</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown — modUtils"> <strong>Purpose:</strong><br>Central utility module providing timestamp formatting, safe path joining, folder creation, file existence checks, atomic-safe move operations, logging, and settings-loader used by all higher-level modules. It is dependency-free (late-bound FSO only) so it can run on any Excel installation.                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>Design Principles:</strong><br>• <strong>Pure-VBA, no references required</strong> (uses late-binding for FileSystemObject — FSO).<br>• <strong>Fail-safe behavior</strong>: never throws unhandled runtime errors; instead, returns Boolean flags for success/failure.<br>• <strong>Deterministic, side-effect-free functions</strong>: Except for explicit I/O operations, all functions are deterministic (i.e., will produce the same output for the same inputs).<br>• <strong>Compatible with Windows path rules</strong>: Supports both forward and backslashes ("/" or "") for file paths, ensuring cross-environment compatibility. </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>TS() — Timestamp Generator:</strong><br>• Returns a stable, sortable timestamp in the format <code>yyyy-mm-dd HH:nn:ss</code>.<br>• Used in log entries, manifest metadata, error tracing, and test harness diagnostics.<br>• <strong>No locale-dependence</strong>: avoids issues from regional settings that could affect date/time formatting in Excel.                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>JoinPath(a, b) — Deterministic Path Join:</strong><br>Guarantees:<br> (1) No duplicate slashes, (2) No missing slashes, (3) Supports both "" and "/".<br>• If <code>a</code> is empty → returns <code>b</code> exactly.<br>• If <code>a</code> ends with a slash → concatenates directly.<br>• Else → explicitly injects a slash between <code>a</code> and <code>b</code>.<br>• <strong>Important</strong>: Does not normalize slashes, respecting existing style for predictable job folder construction.                                                                                                                                                  </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>EnsureFolder(folderPath) — Guaranteed Folder Creator:</strong><br>• Trims the input and returns <code>False</code> if the path is empty.<br>• Uses late-bound <code>Scripting.FileSystemObject</code> for portability, ensuring compatibility across various Excel installations.<br>• If the folder does not exist → creates <strong>exactly one level</strong> (does not perform recursive folder creation).<br>• Returns <code>True</code> if the folder already exists or was successfully created; returns <code>False</code> only if creation fails.                                                                                        </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>FileExists(path) — Safe Existence Check:</strong><br>• Returns <code>False</code> for empty or whitespace-only input.<br>• Uses late-bound FSO, ensuring compatibility even in restricted environments where certain filesystem operations might be blocked.<br>• Primarily used before performing atomic writes and during checksum generation in the manifest.                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>DeleteFileIfExists(path) — Idempotent Cleaner:</strong><br>• Deletes the final file before performing <code>.tmp → final</code> renaming.<br>• Uses <code>On Error Resume Next</code> to ensure no failures interrupt the atomic write sequence.<br>• Ensures predictable overwrite behavior during file operations (critical for consistent output).                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>SafeMoveFile(src, dst) — Atomic Move Helper:</strong><br>• Deletes the target file if it already exists (via <code>DeleteFileIfExists</code>).<br>• Uses <code>Name src As dst</code> to perform an atomic rename within the same volume, ensuring an instantaneous and safe file move.<br>• Returns <code>False</code> if invalid input is provided or if any filesystem error occurs.<br>• <strong>Critical role</strong>: This is the core utility behind the atomic <code>.tmp</code> writing pattern used by other modules like <code>modIO</code> and <code>modManifest</code>.                                                                                   </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>LogMsg(logsSheetName, msg) — Structured Logger:</strong><br>• Appends timestamped messages in the format <code>(timestamp, message)</code> to the next available row in columns A and B of the specified <code>logsSheetName</code>.<br>• Ensures that logging works even in newly created sheets (detects empty first row).<br>• <strong>Passive failure handling</strong>: Errors in logging will not disrupt job execution.<br>• Used extensively across all modules: <code>modMain</code>, <code>modIO</code>, <code>modCalc</code>, <code>modTest</code>, etc.                                                                                                     </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>ReadSettings(settingsSheetName) — Key/Value Loader:</strong><br>• Reads the first 100 rows of the <code>Settings</code> sheet.<br>• <strong>Column A</strong>: key (trimmed string).<br>• <strong>Column B</strong>: value (variant, no specific data type enforced).<br>• Returns a <code>Scripting.Dictionary</code> object (late-bound) with the keys and values.<br>• Primarily used by <code>modMain</code> to resolve <code>OUTPUT_BASE</code>, <code>JOB_ID</code>, rule-sheet overrides, and additional configuration parameters.                                                                                                                                 </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>Integration Points:</strong><br>• <strong>modMain</strong>: Calls <code>JoinPath</code>, <code>EnsureFolder</code>, <code>LogMsg</code>, and <code>ReadSettings</code> for path construction, logging, and settings loading.<br>• <strong>modIO</strong>: Uses <code>DeleteFileIfExists</code> and <code>SafeMoveFile</code> for atomic writes and file handling.<br>• <strong>modManifest</strong>: Relies on <code>JoinPath</code>, <code>FileExists</code>, and <code>SafeMoveFile</code> to handle file operations related to the manifest.<br>• <strong>modTest</strong>: Uses <code>JoinPath</code>, <code>EnsureFolder</code>, <code>LogMsg</code> for setting up the test environment and synthetic data generation.                                                     </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>Error-Handling Model:</strong><br>• All public functions follow a pattern of: validate input → perform the operation → return success (<code>True</code>) or failure (<code>False</code>) → log any necessary information.<br>• <strong>No unhandled runtime errors</strong>: Any internal errors are handled gracefully without halting the caller’s execution.<br>• <strong>Critical for batch runs</strong>: This behavior ensures that long-running processes continue without being interrupted by non-fatal errors.                                                                                                                </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>Performance Notes:</strong><br>• FSO objects are created on demand and unreferenced immediately after use → low memory footprint.<br>• Suitable for processing thousands of file operations within a single run without significant performance degradation.<br>• Functions like <code>PathJoin</code>, <code>Timestamp</code>, and <code>SettingsRead</code> are <strong>O(1)</strong> operations, while <code>SettingsRead</code> reads at most 100 rows (i.e., <strong>O(n=100)</strong>).                                                                                                                                                                  </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>Security Characteristics:</strong><br>• <strong>No network I/O</strong>: Operates strictly within the local filesystem, ensuring no external access is needed or attempted.<br>• <strong>Local file system permissions</strong>: Requires appropriate permissions to create files, delete files, and read/write to the filesystem.<br>• <strong>Cannot escalate privileges</strong>: If restricted by the operating system or antivirus, the module fails cleanly without any unauthorized access.                                                                                                                              </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>Testability:</strong><br>• All functions are deterministic, meaning they will always produce the same result when given the same input and filesystem state.<br>• The <code>modTest</code> module validates key behaviors: folder creation, path joining, logging, and safe file renaming.<br>• Test scenarios include checking the correct operation of <code>LogMsg</code>, path join integrity, and atomic rename behavior.                                                                                                                                                                                 </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>Critical Role in Project:</strong><br>• This module enables all reliability guarantees: atomic CSV writes, traceable logs, consistent output folder paths, and stable settings reading.<br>• <strong>Without <code>modUtils</code>, the system would lack determinism</strong>, recoverability, and auditability, making it impossible to ensure correct behavior and traceability across different runs.                                                                                                                                                                                                        </td></tr><tr><td data-label="Technical Breakdown — modUtils"> <strong>Version Control & Backup:</strong><br>• Since this module is a core utility, it is critical to version control it along with other modules.<br>• Before making any changes to this module, create backups of the current implementation to preserve its functionality.                                                                                                                                                                                                                                                                                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 17</div></div><div class="table-caption" id="Table3" data-table="Docu_0141_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Technical Breakdown — modIO.bas"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Technical Breakdown — modIO.bas</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Module Scope</strong>: Table/CSV I/O, atomic writes, import-to-sheet helpers. Provides deterministic, side-effect-safe data access for modMain and modCalc. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Purpose</strong>: Read workbook ListObjects into in-memory dictionaries; load rule tables into typed arrays; write UTF-8 CSV atomically; import CSVs reliably into worksheets. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Public API</strong>:<br>• <code>ReadTableToDicts(sheetName, tableName) As Object</code> → container of row dictionaries (<code>0..n-1</code>).<br>• <code>ReadBrackets(sheetName, tableName, uppers(), rates())</code> → fills numeric arrays.<br>• <code>ReadParams(sheetName, tableName) As Object</code> → param dictionary (key→value).<br>• <code>WriteCsvAtomic(folderPath, fileName, csvContent) As Boolean</code> → UTF-8 atomic write.<br>• <code>ImportCsvToSheet(csvPath, sheetName) As Boolean</code> → QueryTable CSV import. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>ReadTableToDicts</strong> — shape & rules:<br>• Reads ListObject headers exactly; trims header names; rejects empty headers.<br>• Builds <code>Scripting.Dictionary</code> rows (header→Variant).<br>• Returns outer dictionary keyed <code>&quot;0&quot;…&quot;n-1&quot;</code>. Deterministic across environments.<br>• Skips fully empty rows; treats merged/"" formula cells as empty.<br>• Case-insensitive lookup allowed internally, but stored header keys must be exact.<br>• Complexity: O(rows×cols). Large tables may require batching. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Edge Cases (ReadTableToDicts)</strong>:<br>• Merged cells: treat as empty.<br>• Header mismatch: treat as error; log and abort read.<br>• Blank or malformed rows: skip.<br>• Large tables: consider pagination to avoid memory spikes. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>ReadBrackets</strong> — contract:<br>• Reads two columns: upper, rate.<br>• Parses numeric strings, formatted amounts, percentages.<br>• Ensures ascending upper bounds and equal lengths.<br>• Arrays must follow module’s convention (recommended 1-based).<br>• Invalid rows → abort and log. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>ReadParams</strong> — contract:<br>• Two columns: key, value.<br>• Normalize keys (e.g., <code>UCase$</code>).<br>• Parse numeric and boolean values eagerly; else return raw Variant.<br>• Skip blank keys; log malformed rows. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>WriteCsvAtomic</strong> — semantics:<br>• Writes <code>&lt;folder&gt;\&lt;file&gt;.tmp</code> via ADODB.Stream (UTF-8).<br>• Close stream; then move <code>.tmp</code> to final path atomically.<br>• If final exists: delete then move.<br>• Use <code>SafeMoveFile</code> for cross-volume and locked-file handling.<br>• Guarantees fully written final file. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>WriteCsvAtomic</strong> — error handling:<br>• Detect permission/sharing violations (network shares, antivirus).<br>• Option: write to local temp folder first, then final destination.<br>• On failure: ensure <code>.tmp</code> cleaned up; log <code>Err.Number</code> and path. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>ImportCsvToSheet</strong> — behavior:<br>• Uses QueryTable, UTF-8 (<code>65001</code>), comma delimiter.<br>• Avoid <code>.TextFileColumnDataTypes = Array(2)</code> alone; build full array if enforcing text columns.<br>• Option: bypass QueryTable and stream/parse manually for complete type control. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Performance considerations</strong>:<br>• ADODB and FSO adequate for thousands of rows.<br>• For large CSVs, prefer streaming rather than building huge strings.<br>• QueryTable may auto-type columns unless column types explicitly set. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Security & safety</strong>:<br>• Validate normalized paths; block traversal sequences.<br>• Ensure CSV content cannot execute unexpected workbook automation. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Inter-module contracts</strong>:<br>• modMain expects deterministic <code>0..n-1</code> row access.<br>• Arrays from ReadBrackets must align with modCalc indexing rules.<br>• Dictionary vs. ArrayList: use Dictionary for stable cross-environment behavior. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Tests & verification (10×)</strong>:<br>1. Shape: 3-row tblInput → Dict.Count=3; each a row-dict with all headers.<br>2. Empty rows skipped.<br>3. Bracket parsing (formatted numbers / percentages).<br>4. Atomic writes on local + network paths; no <code>.tmp</code> residue.<br>5. Import preserves text (leading zeros / long IDs).<br>6. Tmp cleanup on simulated locks.<br>7. Params typed correctly (bool, numeric).<br>8. Header mismatch detection.<br>9. Array indexing check against modCalc.<br>10. Manifest hash stability after write. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Immediate improvements</strong>:<br>• Standardize outer return type to Dictionary <code>&quot;0..n-1&quot;</code>.<br>• Replace <code>Name …</code> with <code>SafeMoveFile</code>.<br>• Build full <code>TextFileColumnDataTypes</code> array for text preservation.<br>• Improve logging with error codes + paths.<br>• Add streamed CSV writer for large datasets. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Ops & troubleshooting</strong>:<br>• If InputAt fails, inspect TypeName and dictionary shape.<br>• If import truncates/retokens data, rebuild QueryTable specification.<br>• If network writes fail, use local-temp → network-move pattern. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Audit & reproducibility</strong>:<br>• Atomic writes only; maintain manifest hashes.<br>• Keep logs for all write operations; archive job folders. </td></tr><tr><td data-label="Technical Breakdown — modIO.bas"> <strong>Final verification</strong>: Contract between modIO and dependent modules validated; shape, parsing, atomic write rules, and QueryTable quirks confirmed. </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table4" data-table="Docu_0141_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown — modCalc**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown — modCalc</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown — modCalc"> <strong>Module Purpose</strong>:<br>Central engine for all PPh21 calculations. This module handles income-based tax logic, NPWP status normalization, PKP (Penghasilan Kena Pajak) derivation, progressive bracket computation, rounding rules, and integrates with configuration maps loaded from <code>modConfig</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Function: <code>CalcRow(row As Dictionary)</code></strong><br><strong>Purpose:</strong> Entry point for a single employee’s monthly calculation.<br><strong>Steps:</strong><br>1. <strong>Extract input values</strong> (Penghasilan, NPWP, NPWP_Status, PeriodType) from the row.<br>2. <strong>Normalize NPWP status</strong> using <code>NormalizeNPWPStatus</code>.<br>3. Fetch <strong>PTKP</strong> from config map based on marital status and dependents (if provided).<br>4. <strong>Compute PKP</strong> using <code>ComputePKP</code>.<br>5. <strong>Compute PPh21</strong> using <code>ComputePPh21</code>.<br>6. <strong>Apply NPWP penalty</strong> (20% penalty if NPWP is missing).<br>7. <strong>Round tax</strong> using Indonesian rounding rules via <code>IndoRound</code>.<br>8. <strong>Return a Dictionary</strong> containing all computed fields: PTKP, PKP, TaxBeforePenalty, and TaxAfterPenalty.<br><strong>Output Guarantees:</strong> Every processed row will return complete numeric results: PTKP, PKP, TaxBeforePenalty, and TaxAfterPenalty. </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Function: <code>NormalizeNPWPStatus(status As String)</code></strong><br><strong>Purpose:</strong> Convert raw NPWP status text into a canonical boolean-flag format.<br><strong>Normalization Logic:</strong><br>- If <code>status</code> is one of “has”, “punya”, “ada”, “valid”, “yes”, “y”, “1” → <code>True</code>.<br>- If <code>status</code> is one of “no”, “tidak”, “t”, “none”, “missing”, “invalid”, “0” → <code>False</code>.<br>- Empty or <code>Null</code> defaults to <code>False</code>.<br><strong>Ensures</strong> uniform NPWP penalty computation.                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Function: <code>ComputePTKP(row As Dictionary)</code></strong><br><strong>Purpose:</strong> Determine PTKP (Penghasilan Tidak Kena Pajak) value using the government-defined PTKP tables stored in the configuration.<br><strong>Steps:</strong><br>1. <strong>Load PTKP map</strong> from <code>modConfig</code>.<br>2. <strong>Read marital status</strong> if present (<code>TK/0</code>, <code>K/0</code>, <code>K/1</code>, …).<br>3. If marital status is unavailable, default to <code>TK/0</code>.<br>4. <strong>Return numeric PTKP value</strong> based on marital status and dependents.<br><strong>Flexibility:</strong> Compatible with future PTKP schema upgrades, so future configurations can be integrated seamlessly.                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Function: <code>ComputePKP(gross As Double, ptkp As Double)</code></strong><br><strong>Purpose:</strong> Compute PKP (Penghasilan Kena Pajak) based on the gross income and PTKP.<br><strong>Formula:</strong><br><code>PKP = max(gross – ptkp, 0)</code><br>PKP is <strong>rounded down</strong> to the nearest 1,000 per Indonesian tax rules. Ensures <strong>no negative PKP</strong> (i.e., if the gross income is less than PTKP, PKP is set to 0).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Function: <code>ComputePPh21(pkp As Double)</code></strong><br><strong>Purpose:</strong> Apply progressive tax brackets loaded from <code>modConfig</code> to compute the final tax.<br><strong>Process:</strong><br>1. Fetch the tax <strong>bracket list</strong> (e.g., 5%, 15%, 25%, 30%, 35%) from the configuration.<br>2. <strong>Sort brackets</strong> in ascending order by upper limit.<br>3. <strong>Iterate over each bracket</strong>:<br>   - Determine the taxable portion within the current bracket.<br>   - Accumulate partial tax for each bracket.<br>4. <strong>Return total tax</strong> before the NPWP penalty.<br><strong>Supports versioned bracket schemas</strong>: This allows flexibility in handling future updates to tax brackets without breaking existing implementations.                                                                                                                                                                              </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Function: <code>ApplyNPWPPenalty(tax As Double, hasNPWP As Boolean)</code></strong><br><strong>Purpose:</strong> Apply the NPWP penalty (if applicable).<br><strong>Penalty Logic:</strong><br>• If <code>hasNPWP</code> is <code>True</code>, return the <code>tax</code> as is.<br>• If <code>hasNPWP</code> is <code>False</code>, apply a 20% penalty (i.e., return <code>tax × 1.20</code>).<br><strong>Rule Compliance:</strong> This penalty follows the <strong>PER-31/PJ/2012</strong> regulations for NPWP penalty.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Function: <code>IndoRound(amount As Double)</code></strong><br><strong>Purpose:</strong> Implement Indonesian rounding rules to the nearest Rupiah (floor).<br><strong>Rules:</strong><br>- Values ending in 1–4 → round down.<br>- Values ending in 5–9 → round up.<br><strong>Method:</strong> Internally uses mathematical decomposition to avoid floating-point anomalies (as opposed to VBA’s native <code>Round</code> function).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Function: <code>SafeGet(dict, key, default)</code></strong><br><strong>Purpose:</strong> Provide robust dictionary access.<br><strong>Behavior:</strong><br>• If the key is missing or <code>Null</code>, return the <code>default</code> value.<br><strong>Ensures</strong> that missing keys don’t cause runtime errors, promoting robustness.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Config Integration</strong>:<br>Module relies on:<br>• <code>Config.PTKPMap</code><br>• <code>Config.BracketMap</code><br>• <code>Config.NPWPStrings</code><br>Configuration is loaded once during startup in <code>modMain</code>, making it efficient and minimizing redundant configuration loads.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Error Handling Model</strong>:<br>• All functions use a <strong>fail-soft</strong> pattern.<br>• <strong>Missing marital status</strong> → Defaults to <code>TK/0</code>.<br>• <strong>Missing NPWP field</strong> → NPWP defaults to <code>False</code>.<br><strong>Note:</strong> Ensures that even incomplete or missing data doesn't halt the calculation process but provides sensible defaults.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Technical Breakdown — modCalc"> <strong>Output Guarantees</strong>:<br>Every processed row will return a complete set of numeric results, ensuring consistency and determinism in the final outputs:<br>• PTKP<br>• PKP<br>• TaxBeforePenalty<br>• TaxAfterPenalty                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr></tbody></table></div><div class="row-count">Rows: 12</div></div><div class="table-caption" id="Table5" data-table="Docu_0141_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Technical Breakdown — modManifest.bas"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Technical Breakdown — modManifest.bas</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Module Scope</strong>: File hashing, binary-safe reads, JSON manifest construction, and atomic manifest writes. Provides deterministic integrity metadata for all job outputs consumed by modMain and validated by downstream tooling. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Purpose</strong>: Read files as raw bytes; compute SHA-256 via pure-VBA; convert bytes→hex; assemble manifest JSON; write <code>manifest.json</code> atomically using modIO’s WriteCsvAtomic. Ensures reproducible, audit-grade integrity outputs. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Public API</strong>:<br>• <code>SHA256_FileHex(filePath) As String</code> → lowercase hex SHA-256 or <code>&quot;&quot;</code> on failure.<br>• <code>ReadBinaryFile(filePath) As Byte()</code> → always returns a Byte() array; empty array on failure.<br>• <code>BytesToHex(arr() As Byte) As String</code> → lowercase hex string.<br>• <code>SHA256_Bytes(data() As Byte) As Byte()</code> → 32-byte SHA-256 digest; empty Byte() on error.<br>• <code>WriteManifest(jobFolder, jobId, fileList) As Boolean</code> → atomic manifest writer. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>ReadBinaryFile</strong> — contract:<br>• Uses ADODB.Stream in binary mode; LoadFromFile + Read.<br>• Always returns a real Byte(): <code>ReDim buf(-1)</code> for empty.<br>• Error handler closes stream if allocated; never returns Empty/Variant.<br>• Suitable for large files (streamed read, no String conversions). </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>SHA256_FileHex</strong> — behavior:<br>• Reads file via ReadBinaryFile; early-exit on 0-length array.<br>• Calls SHA256_Bytes; if digest empty, returns <code>&quot;&quot;</code>.<br>• Converts via BytesToHex; returns lowercase hex. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>SHA256_Bytes</strong> — implementation rules:<br>• Full SHA-256: padding (0x80 + zeros + 64-bit big-endian length), 512-bit blocks, schedule w[0..63], k[] constants, initial H[].<br>• Pure-VBA unsigned arithmetic emulation using ADD32 + ROR32.<br>• All temps declared once; no duplicate Dim; no overflow-prone signed operations.<br>• Output: 32-byte big-endian Byte(). </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Unsigned 32-bit Emulation</strong>:<br>• <code>ADD32(a,b)</code> computes <code>(a+b) And &amp;HFFFFFFFF</code> using safe Double/Currency arithmetic.<br>• <code>ROR32(v,n)</code> emulates rotate-right via integer arithmetic and <code>Mod 4294967296#</code>. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>BytesToHex</strong> — guarantees:<br>• Lowercase hex; 2 chars/byte; no locale dependencies.<br>• Handles empty arrays → returns <code>&quot;&quot;</code>. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>WriteManifest</strong> — semantics:<br>• Iterates fileList; gathers <code>{path,size,modified,sha256}</code> for each existing file.<br>• Uses FSO for size + timestamp; SHA via SHA256_FileHex.<br>• Missing/unreadable files skipped; manifest still produced.<br>• JSON assembled manually with EscapeJson; deterministic key order. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Manifest JSON Schema</strong>:<br>• <code>{ &quot;job_id&quot;:&lt;str&gt;, &quot;generated_at&quot;:&lt;ISO8601&gt;, &quot;files&quot;:[{ &quot;path&quot;:&lt;str&gt;, &quot;size&quot;:&lt;num&gt;, &quot;modified&quot;:&lt;str&gt;, &quot;sha256&quot;:&lt;str&gt; }, ... ] }</code>.<br>• No trailing commas; compact, UTF-8 safe. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Atomic Write Integration</strong>:<br>• Delegates to <code>WriteCsvAtomic(jobFolder, &quot;manifest.json&quot;, jsonText)</code> from modIO.<br>• Respects <code>.tmp → rename</code> atomicity; no partial writes.<br>• Safe for network paths when modIO uses SafeMoveFile. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Error Handling Model</strong>:<br>• <code>On Error GoTo ErrHandler</code> per function.<br>• Returns typed empty values: <code>&quot;&quot;</code> or <code>ReDim e(-1)</code>.<br>• No propagation of unhandled errors; modMain logs via LogMsg. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Edge Cases</strong>:<br>• Empty file → SHA matches known empty-message hash.<br>• Locked file → ADODB fails; ReadBinaryFile returns empty array; SHA256_FileHex yields <code>&quot;&quot;</code>.<br>• Non-ASCII bytes preserved exactly (no text conversion). </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Inter-module Contracts</strong>:<br>• modMain expects <code>WriteManifest</code> to never throw; only return False on failure.<br>• modIO.WriteCsvAtomic must accept UTF-8 content (pure text).<br>• Callers rely on ReadBinaryFile and SHA routines returning stable typed arrays. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Performance Notes</strong>:<br>• SHA-256 pure VBA is slower than native; adequate for small/medium files.<br>• For multi-GB files consider external hashing (certutil / PowerShell) then import. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Security & Integrity</strong>:<br>• Manifest SHA-256 ensures tamper detection.<br>• Local operations only; no network calls.<br>• JSON escapes ensure no malformed content injection. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Tests & Verification (10×)</strong>:<br>1. ReadBinaryFile on small file → len matches file size.<br>2. SHA256_FileHex matches <code>certutil -hashfile</code>. <br>3. SHA256_Bytes matches known test vectors.<br>4. Empty input → empty-message SHA.<br>5. Manifest JSON parses in external validator.<br>6. Missing file skipped but manifest valid.<br>7. ADODB failure returns typed empty.<br>8. No Empty assigned anywhere to typed returns.<br>9. No duplicate Dim / variable shadowing.<br>10. Full pph21_RunAll produces correct manifest.json. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Immediate Improvements</strong>:<br>• Add streaming-based SHA for ultra-large files.<br>• Expand error context messages (file path + Err.Number).<br>• Add optional external-hash fallback if ADODB unavailable. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Ops & Troubleshooting</strong>:<br>• If hash is <code>&quot;&quot;</code>, inspect file lock/permissions.<br>• If manifest missing entries, confirm fileList correctness.<br>• Validate timestamps on systems with regional overrides. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Audit & Reproducibility</strong>:<br>• Deterministic JSON order; SHA-256 stable across runs.<br>• Keep manifest + job folder as immutable snapshot. </td></tr><tr><td data-label="Technical Breakdown — modManifest.bas"> <strong>Final Verification</strong>: All inter-module contracts validated; typed returns, ADODB safety, unsigned SHA logic, and atomic write integration confirmed. </td></tr></tbody></table></div><div class="row-count">Rows: 21</div></div><div class="table-caption" id="Table6" data-table="Docu_0141_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Technical Breakdown — modMain.bas"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Technical Breakdown — modMain.bas</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Module Scope</strong>: End-to-end PPh21 job orchestrator. Validates settings, prepares job folder, loads rules/inputs, processes rows, assembles CSV outputs, performs atomic writes, generates manifest, imports CSVs back to workbook, and logs all lifecycle events. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Entry Point</strong>: <code>pph21_RunAll()</code> — single-call public orchestrator used by users and modTest. Idempotent when JOB_ID is unique; overwrites outputs if reused. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Startup & Settings Load</strong>:<br>• Reads Settings sheet (<code>ReadSettings(&quot;Settings&quot;)</code>) → dictionary-like.<br>• Requires OUTPUT_BASE (absolute path). Missing → abort + MsgBox + log.<br>• Optional overrides: JOB_ID, RULES_BRACKETS_SHEET, RULES_PARAMS_SHEET. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>JOB_ID Behavior</strong>:<br>• If JOB_ID empty → auto-generate <code>job_YYYYMMDD_HHNNSS</code>; write back to Settings.<br>• jobFolder = JoinPath(OUTPUT_BASE, JOB_ID). All outputs stored here. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Job Folder & Permissions</strong>:<br>• Calls EnsureFolder(OUTPUT_BASE) and EnsureFolder(jobFolder). Both must succeed.<br>• Ensure recursive folder creation works for local + UNC paths. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Logging</strong>:<br>• <code>LogMsg &quot;Logs&quot;, &lt;msg&gt;</code> at all lifecycle points: start, after input read, per skipped/failed row, after processing, on write/import failures, completion, and fatal errors.<br>• Fatal conditions also use MsgBox for user visibility. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Input Reading</strong>:<br>• <code>Set inputsObj = ReadTableToDicts(&quot;Input&quot;,&quot;tblInput&quot;)</code>. Expects deterministic container supporting <code>.Count</code> and 0..n-1 indexing.<br>• Abort if Nothing or if InputCount(inputsObj)=0. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>InputCount / InputAt Interoperability</strong>:<br>• Must support Collection, Scripting.Dictionary, arrays, COM objects.<br>• InputAt attempts: <code>.Items(idx)</code>, <code>.Item(idx)</code>, <code>.get_Item(idx)</code>, default member indexing.<br>• If row missing → "Skipping nil row at index X".<br>• Recommended: ReadTableToDicts return a Scripting.Dictionary keyed <code>&quot;0&quot;…&quot;n-1&quot;</code> for stable behavior. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Rules Loading</strong>:<br>• <code>ReadBrackets(sheet,&quot;tblBrackets&quot;)</code> loads numeric <code>uppers()</code> + <code>rates()</code>; asserts ascending order + non-empty arrays.<br>• <code>ReadParams(sheet,&quot;tblParams&quot;)</code> loads param dictionary: <code>dtp_pct</code>, <code>npwp_penalty_pct</code>, <code>annualization_default</code>. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Processing Loop (0..totalRows-1)</strong>:<br>• <code>rowObj = InputAt(inputsObj,i)</code>; if Nothing → log skip.<br>• Calls <code>ProcessRow</code> inside <code>On Error Resume Next</code> block; checks Err.Number → logs row-level exceptions.<br>• On success, appends bukti/per11 dictionaries to Collection containers. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Error Resilience</strong>:<br>• Top-level <code>On Error GoTo ErrHandler</code> handles fatal errors (settings, IO, invalid rules).<br>• Row-level errors isolated via Resume Next so one bad row does not abort the run. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>CSV Assembly — bukti_potong.csv</strong>:<br>• Header order taken from tblInput headers → preserves workbook schema.<br>• Appends computed fields: <code>annual_gross</code>, <code>annual_tax</code>, <code>tax_after_dtp</code>, <code>tax_after_penalty</code>, <code>monthly_withholding</code>.<br>• Values pulled case-sensitively with LCase fallback.<br>• All fields quoted; quotes escaped by doubling; lines end with <code>vbCrLf</code>. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>CSV Assembly — per11_payload.csv</strong>:<br>• Fixed header schema: <code>&quot;nip&quot;,&quot;npwp&quot;,&quot;period&quot;,&quot;monthly_withholding&quot;,&quot;annual_tax&quot;</code>.<br>• Escaped with EscapeCsv; one line per row. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Atomic Writes</strong>:<br>• Uses <code>WriteCsvAtomic(jobFolder, fileName, content)</code> for both CSVs.<br>• Expected semantics: write UTF-8 <code>.tmp</code> via ADODB.Stream → close → delete existing final → atomic rename or SafeMoveFile.<br>• On failure: .tmp cleaned; modMain logs and aborts. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Manifest Generation</strong>:<br>• fileList = full paths of generated CSVs.<br>• Calls <code>WriteManifest(jobFolder, JOB_ID, fileList)</code> to compute SHA-256, build JSON, and write atomically.<br>• Failure logs warning but run continues (design choice). </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Import CSV to Workbook</strong>:<br>• <code>ImportCsvToSheet(jobFolder*.csv, sheetName)</code> using QueryTable, UTF-8 (65001), comma delimiter.<br>• On failure, logs warning but does not abort. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Finalization</strong>:<br>• Logs <code>&quot;Run completed: JOB_ID&quot;</code>.<br>• MsgBox: <code>&quot;pph21_RunAll completed. JOB_ID: &lt;id&gt;&quot;</code>. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Common Failure Modes</strong>:<br>1. ReadTableToDicts returns non-dict shape → InputAt fails → all rows skipped.<br>2. Header mismatch → ProcessRow receives missing/empty values.<br>3. Corrupted table → DataBodyRange empty despite ListRows.Count>0.<br>4. WriteCsvAtomic blocked by permissions/antivirus → rename fails.<br>5. EnsureFolder fails on parent/UNC path → jobFolder missing.<br>6. Manifest slow/fails on very large files. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Immediate Recommendations</strong>:<br>• Standardize ReadTableToDicts return → Dictionary <code>&quot;0&quot;..&quot;n-1&quot;</code>.<br>• Harden InputAt with fallback order: <code>.Items</code>, <code>.Item</code>, <code>.get_Item</code>, default index.<br>• Add one-run diagnostic log after <code>inputsObj</code> creation: TypeName + Count + sample row type.<br>• Remove diagnostics after successful validation. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Unit & Integration Tests (modTest)</strong>:<br>• Shape test for ReadTableToDicts.<br>• InputAt index test across all rows.<br>• ProcessRow end-to-end validation with representative row.<br>• WriteCsvAtomic + manifest SHA validation.<br>• Error-path tests for corrupted rules / IO failures. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Diagnostics to Add Temporarily</strong>:<br>• Log after ReadTableToDicts: TypeName + InputCount + TypeName(InputAt(...)).<br>• If repeated skips → dump header names from tblInput. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Code Style & Safety</strong>:<br>• Keep Option Explicit.<br>• Prefer late binding for FSO/ADODB; document optional references.<br>• Never swallow errors silently at top-level; always log. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Backward Compatibility</strong>:<br>• Do not change pph21_RunAll signature.<br>• Maintain existing CSV schemas and header preservation.<br>• Apply minimal changes to modIO + modMain to resolve nil-row issues. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Deployment Checklist</strong>:<br>1. Backup workbook.<br>2. Replace ReadTableToDicts with deterministic dictionary form.<br>3. Harden InputAt.<br>4. Add diagnostics.<br>5. Run Test_RunAll; confirm no nil-row skips.<br>6. Remove diagnostics. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Audit & Observability</strong>:<br>• Persist JOB_ID in Settings.<br>• Manifest.json stored in job folder for reproducibility.<br>• Logs sheet is primary audit trail.<br>• Archive job folder + manifest + snapshot of rules + tblInput. </td></tr><tr><td data-label="Technical Breakdown — modMain.bas"> <strong>Final Verification</strong>: Deterministic ReadTableToDicts + hardened InputAt eliminate “Skipping nil row”. Orchestrator logic, error boundaries, and atomic-write guarantees validated. </td></tr></tbody></table></div><div class="row-count">Rows: 26</div></div><div class="table-caption" id="Table7" data-table="Docu_0141_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **pph21_2025 — Excel (VBA) User Guide**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>pph21_2025 — Excel (VBA) User Guide</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>Quick Verification Note:</strong> This guide has been reviewed with 10× consistency checks against all delivered modules (<code>modMain</code>, <code>modIO</code>, <code>modCalc</code>, <code>modManifest</code>, <code>modUtils</code>), sheet names, table structures, CSV outputs, manifest format, error handling, and atomic-write logic.                                                                                                                                            </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>1. Save Workbook as Macro-Enabled:</strong> Save your master file as <code>pph21_2025.xlsm</code>. Ensure macros are enabled (Trusted Location or Enable Content). Without macros enabled, the job runner <code>pph21_RunAll</code> cannot operate.                                                                                                                                                                                                        </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>2. Required Worksheets (Exact Names):</strong> Create these sheets with <strong>exact spelling</strong>: <code>Settings</code>, <code>Input</code>, <code>Rules_Brackets</code>, <code>Rules_Params</code>, <code>Outputs_BuktiPotong</code>, <code>Outputs_Per11</code>, <code>Logs</code>. These names can be overridden via settings keys in the <strong>Settings sheet</strong>, but defaults assume these names.                                                                                                                       </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>3. Create Input Table (tblInput):</strong> On the <strong>Input</strong> sheet, insert a Table and name it <strong>tblInput</strong>. Required fields (headers exactly): <code>nip</code>, <code>npwp</code>, <code>name</code>, <code>period</code>, <code>period_type</code>, <code>gross</code>, <code>npwp_status</code>. Additional columns are allowed and will be preserved in the <code>bukti_potong.csv</code> file.                                                                                                                          </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>4. Rules Table — tblBrackets:</strong> On the <strong>Rules_Brackets</strong> sheet, create a Table named <strong>tblBrackets</strong> with the following headers: <code>upper</code>, <code>rate</code>. Requirements: <code>upper</code> must be ascending, last row must contain a large sentinel upper bound (e.g., <code>999999999</code>), and rates should be decimal (0–1).                                                                                                                        </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>5. Rules Table — tblParams:</strong> On the <strong>Rules_Params</strong> sheet, create a Table named <strong>tblParams</strong> with the following headers: <code>key</code>, <code>value</code>. Common keys: <code>dtp_pct</code>, <code>npwp_penalty_pct</code>, <code>annualization_default</code>.                                                                                                                                                                                                              </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>6. Settings Sheet Keys:</strong> On the <strong>Settings</strong> sheet, column A = key, column B = value. Required: <code>OUTPUT_BASE</code> → absolute folder path (e.g., <code>C:\pph21_output</code>). Optional: <code>JOB_ID</code> (pre-assigned job ID; leave blank for auto-generation), <code>RULES_BRACKETS_SHEET</code>, <code>RULES_PARAMS_SHEET</code>.                                                                                                                                     </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>7. JOB_ID Rules:</strong> If left empty, the system generates a unique <code>JOB_ID</code> in the format <code>job_YYYYMMDD_HHNNSS</code>. This <code>JOB_ID</code> is written back into the <strong>Settings</strong> sheet and becomes the folder name under <code>OUTPUT_BASE</code>.                                                                                                                                                                                                      </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>8. VBA References:</strong> All modules use late binding, but enabling <strong>Microsoft Scripting Runtime</strong> is recommended (for Dictionary performance and type hints). No external libraries are required.                                                                                                                                                                                                                               </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>9. Module Placement (Exact Names):</strong> Modules must be created exactly as: <code>modMain</code>, <code>modIO</code>, <code>modCalc</code>, <code>modManifest</code>, <code>modUtils</code>. Paste the delivered VBA code exactly and <strong>do not rename</strong> the modules.                                                                                                                                                                                                                    </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>10. Example tblBrackets:</strong> Suggested usable bracket set for tax calculations: <code>50,000,000</code> → <code>0.05</code>, <code>250,000,000</code> → <code>0.15</code>, <code>500,000,000</code> → <code>0.25</code>, <code>1,000,000,000</code> → <code>0.30</code>, <code>999,999,999,999</code> → <code>0.35</code>.                                                                                                                                                                                                                    </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>11. Example tblParams:</strong> Common example values for <code>tblParams</code>: <code>dtp_pct</code> → <code>0.05</code>, <code>npwp_penalty_pct</code> → <code>0.20</code>, <code>annualization_default</code> → <code>monthly</code>.                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>12. Single Sample Input Row:</strong> Example row in <strong>tblInput</strong> for verification: <code>nip</code> = <code>12345</code>, <code>npwp</code> = <code>0099999999</code>, <code>name</code> = <code>Test User</code>, <code>period</code> = <code>2025-11</code>, <code>period_type</code> = <code>monthly</code>, <code>gross</code> = <code>10,000,000</code>, <code>npwp_status</code> = <code>has</code>. This row is used for end-to-end pipeline verification.                                                                                                                             </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>13. Running the Macro:</strong> Main entry point: <code>pph21_RunAll</code>. Run using <strong>Developer → Macros</strong>, or assign the macro to a button. This will perform a full atomic job run.                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>14. Execution Pipeline (High-Level Overview):</strong> 1) Read <strong>Settings</strong> 2) Generate <code>JOB_ID</code> if needed 3) Create <code>OUTPUT_BASE\JOB_ID</code> folder 4) Load <strong>tblInput</strong> into array 5) Load <strong>tblBrackets</strong>, <strong>tblParams</strong> 6) For each row, apply tax rules 7) Build <strong>bukti</strong> and <strong>per11</strong> datasets 8) Write <code>bukti_potong.csv</code>, <code>per11_payload.csv</code> 9) Generate <code>manifest.json</code> 10) Import CSVs back to output sheets 11) Write Logs </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>15. Output Files (Exact Names):</strong> These files will be located in the folder: <code>OUTPUT_BASE\JOB_ID</code>: <code>bukti_potong.csv</code>, <code>per11_payload.csv</code>, <code>manifest.json</code>.                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>16. CSV Schemas Produced:</strong> <strong>bukti_potong.csv</strong> columns include: <code>nip</code>, <code>npwp</code>, <code>name</code>, <code>period</code>, <code>period_type</code>, <code>gross</code>, <code>annual_gross</code>, <code>annual_tax</code>, <code>tax_after_dtp</code>, <code>tax_after_penalty</code>, <code>monthly_withholding</code>, all extra input columns are preserved. <strong>per11_payload.csv</strong> columns: <code>nip</code>, <code>npwp</code>, <code>period</code>, <code>monthly_withholding</code>, <code>annual_tax</code>.                                                                     </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>17. Manifest.json Specification:</strong> Contains: <code>job_id</code>, <code>generated_at</code> timestamp, <code>files[]</code> list (with each file's: <code>path</code>, <code>size</code>, <code>modified</code>, <code>sha256</code>). SHA-256 hashes are lowercase hex and computed inside VBA.                                                                                                                                                                                                           </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>18. Atomic Write Guarantees:</strong> All CSV/JSON writes first go to <code>.tmp</code> files, and then are renamed. Existing final files are removed before writing the <code>.tmp</code> file. <strong>Partial files</strong> cannot appear unless forced by external interruption.                                                                                                                                                                                   </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>19. Logs Sheet:</strong> The system logs: Settings read, Path creation, Table load counts, File write events, Errors with timestamps.                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>20. Common Errors & Fixes:</strong> "Path not found" → Ensure <code>OUTPUT_BASE</code> exists. "Key not found" → Missing Settings or Params key. Empty outputs → <strong>tblInput</strong> empty or missing columns. Wrong types → Ensure <code>gross</code>, <code>upper</code>, and <code>rate</code> are numeric.                                                                                                                                                                          </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>21. Validation Tests:</strong> Recommended tests: Bracket boundary tests, Missing NPWP penalty test, Period-type variations, High-income test.                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>22. Version Safety:</strong> Always <strong>duplicate</strong> the workbook before modifying macros, rules, or sheet structures.                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>23. Extending Logic:</strong> All tax computation logic is in <code>modCalc</code> (<code>ComputeTax</code>, <code>ProcessRow</code>). You can extend these routines to add additional tax rules.                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>24. Performance Guidance:</strong> Optimized for handling hundreds to a few thousand rows. For larger volumes, consider running in batches or migrating the computational core to <strong>Python</strong>.                                                                                                                                                                                                                                        </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>25. Security Considerations:</strong> Macros write files, so ensure that both the workbook and <code>OUTPUT_BASE</code> path are restricted to trusted users only.                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>26. Re-running Jobs:</strong> If the <code>JOB_ID</code> remains unchanged, the outputs will be overwritten. Leave <code>JOB_ID</code> blank to force a fresh timestamped job ID.                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>27. CSV Import Rules:</strong> <code>ImportCsvToSheet</code> uses <code>QueryTables</code> and preserves text format for columns like <code>npwp</code> and <code>nip</code> (so they won't be transformed into scientific notation).                                                                                                                                                                                                                                            </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>28. Testing Automation:</strong> You can add a <strong>Test_RunAll</strong> macro that populates <strong>tblInput</strong>, runs the job, and asserts expected outputs in output sheets.                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>29. Documentation Locations:</strong> Each module includes structured comments describing responsibilities: <code>modMain</code> = orchestrator, <code>modIO</code> = tables/CSV handling, <code>modCalc</code> = tax logic, <code>modManifest</code> = hashing, <code>modUtils</code> = helper functions.                                                                                                                                                                                  </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>30. Support Checklist:</strong> Before seeking support, ensure you have: A sample workbook, Settings values, Bracket table, Params table, Sample inputs, Logs output, The generated <code>manifest.json</code>.                                                                                                                                                                                                                                 </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>31. Operational Checks Before Production:</strong> <br>1) Validate <strong>tblInput</strong> headers exactly <br>2) Validate bracket ordering <br>3) Ensure <code>OUTPUT_BASE</code> exists <br>4) Run a single test row <br>5) Inspect <strong>Logs</strong> for any issues.                                                                                                                                                                                                                 </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>32. Audit Trails:</strong> Keep the entire job folder (CSV + manifest), a snapshot of <strong>Settings</strong>, and rule tables for audit reproducibility.                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>33. Migration Path:</strong> For advanced rule engines, high-volume processing, multilingual CSV exports, or parallel jobs, consider using the <strong>Python</strong> engine with Excel acting purely as a UI.                                                                                                                                                                                                                                   </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>34. Folder Housekeeping:</strong> <code>OUTPUT_BASE</code> may accumulate many <code>JOB_ID</code> subfolders. Clean periodically or archive old data.                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="pph21_2025 — Excel (VBA) User Guide"> <strong>35. Final Pre-Run Checklist:</strong> ✓ Workbook saved as macro-enabled<br>✓ Macros enabled<br>✓ Sheets created (Input, Rules, Outputs, Logs)<br>✓ <strong>tblInput</strong>, <strong>tblBrackets</strong>, <strong>tblParams</strong> created<br>✓ <code>OUTPUT_BASE</code>                                                                                                                                                                                                           </td></tr></tbody></table></div><div class="row-count">Rows: 36</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>