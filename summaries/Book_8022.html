<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1760623819">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8022_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Module**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Module</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Step**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Step</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Checks / Verification Points**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Checks / Verification Points</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Expected Result / Action / Enhancement**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Expected Result / Action / Enhancement</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Module"> <strong>script.table.js</strong> </td><td data-label="Step"> Step 1   </td><td data-label="Checks / Verification Points"> Render tables of all sizes & types (simple, nested, multi-header, wide, deep) </td><td data-label="Expected Result / Action / Enhancement"> Tables rendered pixel-perfect vs benchmark. Enhancement: Add virtualization for >1000 rows to maintain <200 ms render.                     </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 2   </td><td data-label="Checks / Verification Points"> Sorting (single/multi-column, numeric, string, date, mixed types)             </td><td data-label="Expected Result / Action / Enhancement"> Sorting correct, stable, instant feedback. Enhancement: add sort indicator arrows and accessible labels for ARIA.                          </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 3   </td><td data-label="Checks / Verification Points"> Collapse/Expand toggle                                                        </td><td data-label="Expected Result / Action / Enhancement"> Smooth animation; ARIA attributes update; keyboard accessible. Enhancement: Persistent state via localStorage/sessionStorage.              </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 4   </td><td data-label="Checks / Verification Points"> Copy to clipboard                                                             </td><td data-label="Expected Result / Action / Enhancement"> Works for all table types; preserves formatting; works for hidden/collapsed rows. Enhancement: Fallback for Safari/IE; notification toast. </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 5   </td><td data-label="Checks / Verification Points"> Export (CSV, JSON, Excel, HTML)                                               </td><td data-label="Expected Result / Action / Enhancement"> Blob generated correctly; downloads work on mobile/desktop; no data corruption. Enhancement: Optional timestamped filenames.               </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 6   </td><td data-label="Checks / Verification Points"> Row/column selection                                                          </td><td data-label="Expected Result / Action / Enhancement"> Multiple selection via Shift/Ctrl; highlight persists. Enhancement: Keyboard navigation support (arrows + space).                          </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 7   </td><td data-label="Checks / Verification Points"> Dynamic table insertion                                                       </td><td data-label="Expected Result / Action / Enhancement"> New tables render automatically without reloading modules. Enhancement: MutationObserver optimized for performance.                        </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 8   </td><td data-label="Checks / Verification Points"> Performance under stress                                                      </td><td data-label="Expected Result / Action / Enhancement"> 100+ tables; 10k+ rows cumulative; measure render, sorting, collapse/expand. Enhancement: Log metrics; warn if >200 ms binding.            </td></tr><tr><td data-label="Module"> <strong>script.dom.js</strong>   </td><td data-label="Step"> Step 1   </td><td data-label="Checks / Verification Points"> Modal UI (copy/export/search)                                                 </td><td data-label="Expected Result / Action / Enhancement"> Focus trap works; backdrop prevents accidental click; smooth open/close. Enhancement: Fade animation and ESC key close.                    </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 2   </td><td data-label="Checks / Verification Points"> Toast/notification                                                            </td><td data-label="Expected Result / Action / Enhancement"> Stack multiple notifications; auto-dismiss; no overlap; accessible. Enhancement: ARIA live region; optional sound alert.                   </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 3   </td><td data-label="Checks / Verification Points"> Search/filter functionality                                                   </td><td data-label="Expected Result / Action / Enhancement"> Regex, partial, case-sensitive supported; table highlights matches. Enhancement: Incremental search; debounce for performance.             </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 4   </td><td data-label="Checks / Verification Points"> Resize events                                                                 </td><td data-label="Expected Result / Action / Enhancement"> Table headers re-align; layout responsive. Enhancement: Throttle resize events to minimize reflow.                                         </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 5   </td><td data-label="Checks / Verification Points"> TOC scroll-sync                                                               </td><td data-label="Expected Result / Action / Enhancement"> Highlight active section on scroll; click navigates correctly. Enhancement: Smooth scroll polyfill; offset calculation for sticky headers. </td></tr><tr><td data-label="Module"> <strong>script.main.js</strong>  </td><td data-label="Step"> Step 1   </td><td data-label="Checks / Verification Points"> Module lifecycle bootstrap                                                    </td><td data-label="Expected Result / Action / Enhancement"> Modules initialize in correct order; no console errors. Enhancement: Lazy-load optional modules to improve startup.                        </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 2   </td><td data-label="Checks / Verification Points"> Delegate binding                                                              </td><td data-label="Expected Result / Action / Enhancement"> Event delegation works on dynamic tables and modals. Enhancement: Passive event listeners for scroll/touch.                                </td></tr><tr><td data-label="Module">                     </td><td data-label="Step"> Step 3   </td><td data-label="Checks / Verification Points"> Initialization timing                                                         </td><td data-label="Expected Result / Action / Enhancement"> DOMContentLoaded vs window.load verified; fallback for delayed DOM injection. Enhancement: Retry mechanism for tables added post-load.     </td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><div class="table-caption" id="Table2" data-table="Book_8022_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Module**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Module</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Step**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Step</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Checks / Verification Points**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Checks / Verification Points</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Expected Result / Action / Enhancement**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Expected Result / Action / Enhancement</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Module"> <strong>script.convert.js</strong>   </td><td data-label="Step"> Step 1   </td><td data-label="Checks / Verification Points"> Textarea → table conversion      </td><td data-label="Expected Result / Action / Enhancement"> Correctly parses tabs, commas, line breaks; headers preserved. Enhancement: Auto-detect delimiter; configurable CSV/TSV/custom.                 </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 2   </td><td data-label="Checks / Verification Points"> Table → textarea conversion      </td><td data-label="Expected Result / Action / Enhancement"> Formatting consistent; compatible with clipboard and export. Enhancement: Optional Markdown export for editors.                                 </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 3   </td><td data-label="Checks / Verification Points"> Edge cases                       </td><td data-label="Expected Result / Action / Enhancement"> Empty lines, inconsistent columns, special characters, emojis handled. Enhancement: Warn user for malformed input but allow partial conversion. </td></tr><tr><td data-label="Module"> <strong>script.toc.js</strong>       </td><td data-label="Step"> Step 1   </td><td data-label="Checks / Verification Points"> TOC generation                   </td><td data-label="Expected Result / Action / Enhancement"> Correct hierarchy, anchors, ID mapping. Enhancement: Collapsible nested TOC; keyboard navigation.                                               </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 2   </td><td data-label="Checks / Verification Points"> Scroll sync                      </td><td data-label="Expected Result / Action / Enhancement"> Active section highlighted accurately during scroll. Enhancement: Smooth debounce; support virtualized tables.                                  </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 3   </td><td data-label="Checks / Verification Points"> Navigation links                 </td><td data-label="Expected Result / Action / Enhancement"> Clicking scrolls to correct section; offset matches sticky headers. Enhancement: Optional history pushState for back/forward navigation.        </td></tr><tr><td data-label="Module"> <strong>script.utils.js</strong>     </td><td data-label="Step"> Step 1   </td><td data-label="Checks / Verification Points"> Utility function correctness     </td><td data-label="Expected Result / Action / Enhancement"> Clipboard, debounce, throttle, helpers verified. Enhancement: Safe fallback for older browsers; unit tests.                                     </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 2   </td><td data-label="Checks / Verification Points"> Idle-safe hooks                  </td><td data-label="Expected Result / Action / Enhancement"> Worker communication idle-safe; no console errors. Enhancement: Optional queue system for worker tasks; retry logic.                            </td></tr><tr><td data-label="Module"> <strong>Global Enhancements</strong> </td><td data-label="Step"> Step 1   </td><td data-label="Checks / Verification Points"> Accessibility                    </td><td data-label="Expected Result / Action / Enhancement"> ARIA labels, keyboard navigation, focus management, live regions. Enhancement: WCAG 2.2 compliance.                                             </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 2   </td><td data-label="Checks / Verification Points"> Performance                      </td><td data-label="Expected Result / Action / Enhancement"> Table virtualization, throttled scroll/resize/search, lazy initialization. Enhancement: Logging render metrics; warn if slow.                   </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 3   </td><td data-label="Checks / Verification Points"> Visual/UX Parity                 </td><td data-label="Expected Result / Action / Enhancement"> Pixel-perfect rendering, smooth animations, consistent typography. Enhancement: Visual diff snapshot against benchmark.                         </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 4   </td><td data-label="Checks / Verification Points"> Error Handling                   </td><td data-label="Expected Result / Action / Enhancement"> Graceful fallback for clipboard/export failures. Enhancement: User feedback via toast/modal; dev-mode logging.                                  </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 5   </td><td data-label="Checks / Verification Points"> Integration Hooks                </td><td data-label="Expected Result / Action / Enhancement"> window.PasteToTable API exposed; no global leakage. Enhancement: Future-proof for worker.js or utils.js modules.                                </td></tr><tr><td data-label="Module">                         </td><td data-label="Step"> Step 6   </td><td data-label="Checks / Verification Points"> QA Metrics & Logging             </td><td data-label="Expected Result / Action / Enhancement"> Logs render, sorting, toggle timings; counts tables, rows, columns. Enhancement: Auto-report mismatches for visual diff tests.                  </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><div class="table-caption" id="Table3" data-table="Book_8022_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Input / Problem (Legacy or Requirement)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Input / Problem (Legacy or Requirement)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Change &amp; Effect (World-Class Modular Execution)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Change & Effect (World-Class Modular Execution)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Input / Problem (Legacy or Requirement)"> Legacy script mixed sorting, collapsing, copying, exporting, and row rendering in a single procedural block. Event bindings duplicated across tables. </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Split into modular, deterministic functions inside <code>window.PasteToTable</code>. Each function handles a single responsibility. Reduced redundancy and clarified execution order.                      </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Tables Viewer v2.1 allowed per-table collapse but PasteToTable only had global collapse behavior.                                                     </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Implemented per-table <code>Collapse</code> button with independent state. Each wrapper’s <code>.toggle-collapse</code> binds to its own table section. Uses data-attributes for identification and ARIA consistency. </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Old version relied on inline <code>onclick</code> attributes, violating ES6 modular design.                                                                      </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> All event logic now bound programmatically via <code>PTT.bindTableEvents()</code>, attached during <code>init</code>. Removes all inline HTML JS.                                                                     </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Sorting used non-deterministic comparator and ignored header type (text, numeric, mixed).                                                             </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Introduced <code>PTT.sortTable()</code> with dynamic comparator detection. Parses numeric, date, or string automatically. Ensures stable sorting with fallback to string compare.                          </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Sorting state was not preserved visually (no arrow indicators).                                                                                       </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Each sortable header toggles <code>data-sort-order</code> and updates visual arrow element. ARIA attributes updated (<code>aria-sort</code>). Improves UX parity with Tables Viewer.                                  </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Collapse toggle caused layout jump due to CSS height manipulation.                                                                                    </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Revised logic to toggle <code>display: none</code> on <code>.table-wrapper-content</code> instead of modifying height. Ensures smooth, deterministic layout and reduces reflow cost.                                  </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Clipboard copy relied on deprecated <code>execCommand(&#x27;copy&#x27;)</code>.                                                                                            </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Integrated modern asynchronous <code>navigator.clipboard.writeText()</code> with safe fallback to legacy execCommand for older browsers. No user-visible errors.                                           </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Export to CSV used hardcoded column delimiters and unescaped commas.                                                                                  </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added <code>PTT.exportCSV()</code> using <code>Blob</code> and <code>URL.createObjectURL</code>. Escapes quotes and commas per RFC 4180. Guarantees identical CSV output as Tables Viewer v2.1.                                  </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Markdown export feature absent in legacy PasteToTable.                                                                                                </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added <code>PTT.exportMarkdown()</code> to convert current table into Markdown format. Follows same column width logic as Tables Viewer. Uses <code>navigator.clipboard</code> for instant copy.                      </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Copy and Export buttons used global selectors and conflicted when multiple tables existed.                                                            </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Scoped actions under each <code>.table-wrapper</code>. <code>this.closest(&#x27;.table-wrapper&#x27;)</code> isolates context. Eliminates cross-table interference.                                                             </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Collapse All and Expand All behavior inconsistent when tables nested.                                                                                 </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added global <code>PTT.toggleAllTables(state)</code> referencing each wrapper’s stored collapse flag. Uses <code>forEach</code> over <code>.table-wrapper</code>. Stable even with dynamically added tables.                     </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> No consistent highlight after sorting or search interaction.                                                                                          </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> <code>PTT.highlightRow()</code> and <code>PTT.clearHighlights()</code> add transient <code>highlighted</code> class. Timeout auto-clears for UX parity. Prevents permanent CSS states.                                           </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Legacy <code>copyToClipboard()</code> showed no feedback on success/failure.                                                                                     </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Integrated visual toast via <code>PTT.showToast()</code> from <code>script.dom.js</code> interface. Success and error handled explicitly. Accessibility role = <code>status</code>.                                              </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Sorting numeric columns with empty cells produced NaN issues.                                                                                         </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Comparator normalized empty strings to <code>-Infinity</code> for ascending and <code>Infinity</code> for descending to keep empty rows stable at bottom.                                                             </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Collapse state not persisted on re-sort.                                                                                                              </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> After sorting, collapse state reapplied by re-checking wrapper attribute. Maintains UX continuity.                                                                                              </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Search filtering in <code>script.dom.js</code> caused row index mismatch after sort.                                                                             </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added <code>PTT.reindexVisibleRows()</code> called post-sort and post-filter. Recalculates index column numbers accurately.                                                                                </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Event handlers not re-bound after dynamic row insertion (via convert module).                                                                         </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added <code>PTT.refreshBindings()</code> to detach and reattach listeners after DOM mutation. Integrated with <code>MutationObserver</code> from <code>script.dom.js</code>.                                                     </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> CSV export failed on cells containing newlines.                                                                                                       </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Sanitization replaces <code>\n</code> with <code>&quot;\\n&quot;</code> before join. Maintains structural integrity in CSV.                                                                                                     </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Markdown export spacing misaligned for numeric vs text cells.                                                                                         </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added padding computation based on column max length. Ensures monospace alignment identical to benchmark Book_9001 output.                                                                      </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> No error handling around Blob download.                                                                                                               </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added try/catch around <code>Blob</code> creation and <code>anchor.click()</code>. Graceful degradation to copy-only mode if unsupported.                                                                             </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> <code>PTT.appendRows()</code> used DOM innerHTML concatenation causing re-parsing overhead.                                                                      </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Switched to <code>DocumentFragment</code> creation and single DOM append for efficiency. Cuts render time by ~30 % for 100+ tables.                                                                        </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Row addition didn’t trigger reindexing.                                                                                                               </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Integrated <code>PTT.reindexVisibleRows()</code> call inside <code>appendRows()</code> to ensure consistent numbering.                                                                                                </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Missing <code>runSelfCheck</code> for runtime validation.                                                                                                        </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> New <code>PTT.runSelfCheck()</code> runs post-init diagnostics verifying table count, buttons presence, event bindings, and accessibility roles. Logs pass/fail results to console.                        </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Global namespace pollution from <code>function</code> declarations.                                                                                              </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Everything now inside closure bound to <code>window.PasteToTable</code> object. Prevents accidental collisions.                                                                                            </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Inconsistent timing of <code>DOMContentLoaded</code> vs module imports.                                                                                          </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> All modules rely on unified lifecycle hook from <code>script.main.js</code>. <code>PTT.initTables()</code> invoked after DOM ready.                                                                                   </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Redundant querySelectors executed per event.                                                                                                          </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Cached table wrappers at init. Handlers reference local variables instead of repeated DOM queries. Reduces CPU overhead.                                                                        </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> No unit-level fallback for missing Clipboard API.                                                                                                     </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> <code>PTT.clipboardSafe()</code> checks for API existence and warns once. Returns boolean for UI disable. Prevents runtime exception in Safari.                                                            </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Exported CSV filenames static (<code>data.csv</code>).                                                                                                           </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Now dynamic: <code>&quot;PasteToTable_&quot; + tableID + &quot;.csv&quot;</code>. Ensures file traceability.                                                                                                                   </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Visual table headers lacked proper focus ring on keyboard navigation.                                                                                 </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Headers receive <code>tabindex=&quot;0&quot;</code>. Arrow keys navigate sort directions. Accessibility compliance with WCAG 2.1.                                                                                    </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Collapse toggle icon static.                                                                                                                          </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Toggles <code>fa-chevron-up</code> / <code>fa-chevron-down</code> to reflect state. Matches Tables Viewer visual behavior.                                                                                            </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Missing ARIA labels on control buttons.                                                                                                               </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added <code>aria-label</code> for all interactive elements: Copy, Export CSV, Export MD, Collapse, Expand. Improves screen reader experience.                                                              </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Inconsistent spacing in generated Markdown.                                                                                                           </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> <code>PTT.markdownify()</code> normalizes table width to consistent pipe delimiters. Compatible with GitHub Markdown tables.                                                                               </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> <code>querySelectorAll(&#x27;.copy-button&#x27;)</code> too generic.                                                                                                       </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Scoped with <code>.table-wrapper .copy-button</code> to avoid collisions.                                                                                                                                  </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Duplicate console logs during multi-table operations.                                                                                                 </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Centralized <code>PTT.log()</code> function with silent default; enabled only under debug mode.                                                                                                            </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Browser freeze risk for large tables during sort.                                                                                                     </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added async yield using <code>requestAnimationFrame()</code> on large data sets (>200 rows). Maintains UI responsiveness.                                                                                  </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Re-sorts on same column didn’t toggle order correctly.                                                                                                </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Preserves <code>lastSortColumn</code> and <code>lastSortOrder</code> states per table wrapper. Toggles logically.                                                                                                     </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Sorting ignored <code>thead &gt; th</code> span structure in some templates.                                                                                        </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Adjusted selector to use <code>closest(&#x27;th&#x27;)</code> from click target. Handles nested elements safely.                                                                                                     </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Old code had no unbinding mechanism before rebuild.                                                                                                   </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> <code>PTT.unbindTableEvents()</code> detaches all listeners before rebinding to prevent stacking.                                                                                                          </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Export markdown used textContent causing loss of inner HTML formatting (bold/italic).                                                                 </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Converts <code>&lt;b&gt;</code> and <code>&lt;i&gt;</code> tags to Markdown equivalents. Ensures text fidelity.                                                                                                                   </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> No confirmation of overall integration between modules.                                                                                               </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> <code>runSelfCheck()</code> verifies that <code>PTT.showToast</code> and <code>PTT.reindexVisibleRows</code> from other modules exist before binding. Logs dependency status.                                                    </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Incomplete error trapping on Clipboard rejection (user denied permission).                                                                            </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added <code>.catch()</code> block with message “Clipboard access denied.” displayed through toast.                                                                                                         </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Collapsing one table scrolled the page unexpectedly due to focus.                                                                                     </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Prevented default focus movement; stored scroll position before toggle; restored after toggle.                                                                                                  </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Legacy script lacked internal documentation.                                                                                                          </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Each function now prefixed with JSDoc comment (purpose, params, returns). Matches world-class maintainability standard.                                                                         </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Sorting case sensitivity inconsistent.                                                                                                                </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> String comparator uses <code>localeCompare()</code> with <code>{ sensitivity: &#x27;base&#x27; }</code> for consistent results across languages.                                                                                </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> <code>appendRows()</code> duplicated <code>&lt;tr&gt;</code> attributes from template incorrectly.                                                                                </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Now clones only <code>innerHTML</code> safely, removing duplicated IDs.                                                                                                                                    </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> <code>Collapse All</code> performance degraded with 50+ tables.                                                                                                  </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Batch update via <code>requestAnimationFrame()</code> per 10 tables. Reduces reflow thrashing.                                                                                                             </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> UI glitch when toggling collapse before table initialized.                                                                                            </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Defensive guard: <code>if (!wrapper.classList.contains(&#x27;initialized&#x27;)) return;</code> prevents premature action.                                                                                           </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Missing integration with global metrics collector.                                                                                                    </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Hooks <code>PTT.metricRecord(eventType, tableID)</code> if available, ensuring performance metrics consistency with Book_8022 Table 2 QA plan.                                                             </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Code readability uneven.                                                                                                                              </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Strict 2-space indentation, ≤100 cols per line, ESLint pass = 0 warnings.                                                                                                                       </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> No explicit teardown method.                                                                                                                          </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Added <code>PTT.destroyTable()</code> to remove events and free memory. Supports dynamic page replacements.                                                                                                </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> No support for auto-numbered headers.                                                                                                                 </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Adds optional <code>PTT.autoNumberHeaders()</code> for academic tables needing enumerated columns.                                                                                                         </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Missing unit-level test compatibility.                                                                                                                </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Each public function callable independently, enabling Jest or browser-based tests.                                                                                                              </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Lacked version tagging.                                                                                                                               </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> Header comment at top: <code>// script.table.js — PasteToTable v2.1.0-jsrefactor (2025-10-15)</code> ensures traceability.                                                                                 </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Missing strict mode.                                                                                                                                  </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> File wrapped in <code>&#x27;use strict&#x27;;</code> block. Ensures safer variable declarations.                                                                                                                     </td></tr><tr><td data-label="Input / Problem (Legacy or Requirement)"> Needed parity validation with Book_9001 (Tables Viewer).                                                                                              </td><td data-label="Change &amp; Effect (World-Class Modular Execution)"> All visual and behavioral parity metrics confirmed identical for sorting animation, copy feedback, and collapse iconography.                                                                    </td></tr></tbody></table></div><div class="row-count">Rows: 55</div></div><div class="table-caption" id="Table4" data-table="Book_8022_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Required File"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Required File</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Purpose"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Purpose</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Required File"> <code>script.utils.js</code>                          </td><td data-label="Purpose"> Defines global helpers like <code>__tv_utils</code>, <code>copyToClipboard</code>, <code>downloadBlob</code>, etc. Needed to confirm shim safety and prevent double definitions. </td></tr><tr><td data-label="Required File"> <code>script.convert.js</code>                        </td><td data-label="Purpose"> Handles text→table parsing and export logic. Required to verify compatibility of markdown/plain export calls from <code>script.dom.js</code>.              </td></tr><tr><td data-label="Required File"> <code>script.table.js</code>                          </td><td data-label="Purpose"> Contains row filtering, highlighting, and search logic. Needed to ensure table indexing (<code>tableIdx</code>) and sorting interoperate correctly.        </td></tr><tr><td data-label="Required File"> <code>script.main.js</code>                           </td><td data-label="Purpose"> Initializes modules, event listeners, and top-level startup sequence. Needed to verify when DOM functions are loaded and avoid race conditions. </td></tr><tr><td data-label="Required File"> <code>index.html</code> (final build used in browser) </td><td data-label="Purpose"> Ensures button bindings, modal elements, and <code>&lt;script&gt;</code> inclusion order are correct.                                                            </td></tr></tbody></table></div><div class="row-count">Rows: 5</div></div><div class="table-caption" id="Table5" data-table="Book_8022_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Input / Problem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Input / Problem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Change &amp; Effect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change & Effect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Input / Problem"> Multiple projects used different clipboard/download helpers. </td><td data-label="Change &amp; Effect"> Provides lazy shims <code>_copyToClipboard</code> and <code>_downloadBlob</code> that prefer global helpers then fall back to internal implementation. Ensures compatibility with <code>__tv_utils</code> or legacy globals without overwriting existing functions.                             </td></tr><tr><td data-label="Input / Problem"> No centralized toast queue or ARIA support.                  </td><td data-label="Change &amp; Effect"> Implements <code>_ensureToastContainer</code>, <code>_toastQueue</code>, <code>_activeToast</code> and <code>showToast()</code> with <code>role=&quot;status&quot;</code> and <code>aria-live=&quot;polite&quot;</code>. Queued display, computed durations, accessible focus handling, and dismiss logic added.                                     </td></tr><tr><td data-label="Input / Problem"> Toasts lacked visual polish and lifecycle.                   </td><td data-label="Change &amp; Effect"> Animated show/hide, close button, auto-dismiss with computed duration, and fallback to <code>alert()</code> if DOM unavailable. Queue processing prevents overlap.                                                                                                        </td></tr><tr><td data-label="Input / Problem"> Copy interactions inconsistent across browsers.              </td><td data-label="Change &amp; Effect"> <code>showCopyModal()</code> provides a robust modal fallback with select, copy, download. Uses shims for clipboard/download. Focus management added.                                                                                                                     </td></tr><tr><td data-label="Input / Problem"> No unified search element accessor.                          </td><td data-label="Change &amp; Effect"> <code>getSearchEl()</code> centralizes search element selection used by <code>searchTable()</code> and other modules.                                                                                                                                                                </td></tr><tr><td data-label="Input / Problem"> Button→table resolution brittle.                             </td><td data-label="Change &amp; Effect"> <code>getTableFromButton()</code> resolves table context via <code>.closest(&#x27;.table-wrapper&#x27;)/.table-container</code> or <code>[data-table-id]</code>. Reduces mis-scoped actions when buttons are outside direct markup.                                                                       </td></tr><tr><td data-label="Input / Problem"> Single-table TOC only handled partially.                     </td><td data-label="Change &amp; Effect"> <code>buildSingleTableToc()</code> supports single-wrapper pages: generates safe row IDs, creates TOC list, smooth scroll and history replaceState. Ignores multi-table pages.                                                                                            </td></tr><tr><td data-label="Input / Problem"> Row UID snapshot logic inconsistent across modules.          </td><td data-label="Change &amp; Effect"> <code>_ensureRowUidsAndSnapshot</code> aligns with <code>window.originalRowOrders</code> and <code>_tv_row_uid_counter</code>. Writes key-aware snapshots via <code>_getTableKey</code>, <code>_readOriginalOrder</code>, <code>_writeOriginalOrder</code>. Harmonizes with <code>script.table.js</code> snapshot usage.                    </td></tr><tr><td data-label="Input / Problem"> Header sort UI not keyed to table IDs.                       </td><td data-label="Change &amp; Effect"> <code>updateHeaderSortUI</code> reads sort state via keyed <code>sortStates</code> object. Updates <code>.sort-btn</code> classes and <code>aria-sort</code>. Matches keyed state model in <code>script.table.js</code>.                                                                                              </td></tr><tr><td data-label="Input / Problem"> Sorting implementation varied and produced reflow thrash.    </td><td data-label="Change &amp; Effect"> <code>sortTableByColumn</code> uses table-keyed states, numeric detection, stable reset to original order using snapshot, resets other column states, and batches DOM moves with <code>DocumentFragment</code>. Minimizes reflow.                                                    </td></tr><tr><td data-label="Input / Problem"> Toggle collapse behavior not scoped or accessible.           </td><td data-label="Change &amp; Effect"> <code>toggleTable</code> and <code>toggleAllTables</code> operate on <code>.table-wrapper</code>, update button text, and update global toggle label. Keeps per-wrapper state.                                                                                                                  </td></tr><tr><td data-label="Input / Problem"> Row counts inconsistent after operations.                    </td><td data-label="Change &amp; Effect"> <code>updateRowCounts</code> recalculates per-wrapper totals and visible counts. Called after sort, toggle, search, and append events.                                                                                                                                    </td></tr><tr><td data-label="Input / Problem"> Markdown export/formatting missing fidelity.                 </td><td data-label="Change &amp; Effect"> <code>formatCellForMarkdown</code> and <code>tableToMarkdownLines</code> escape pipes and convert newlines to <code>&lt;br&gt;</code>. Produces consistent GitHub-compatible Markdown.                                                                                                                </td></tr><tr><td data-label="Input / Problem"> Copy/export functions scattered and unsafe on failures.      </td><td data-label="Change &amp; Effect"> <code>copyTablePlain</code>, <code>copyTableMarkdown</code>, <code>copyAllTablesPlain</code>, <code>copyAllTablesMarkdown</code> use shims and fallback to <code>showCopyModal</code> on failure. Provide toasts for feedback.                                                                                        </td></tr><tr><td data-label="Input / Problem"> Highlight/search fragile for Unicode/diacritics.             </td><td data-label="Change &amp; Effect"> <code>buildNormalizedMapForCell</code> and <code>highlightMatches</code> build text-node maps and mark matches while preserving node boundaries and diacritics normalization. This avoids corrupting inline markup.                                                                  </td></tr><tr><td data-label="Input / Problem"> Search normalization duplicated in multiple places.          </td><td data-label="Change &amp; Effect"> <code>searchTable</code> contains local normalization closures to produce <code>filterNorm</code>. It applies to each cell and highlights matches when <code>tvConfig.highlight</code> is set. First-match scroll logic included.                                                               </td></tr><tr><td data-label="Input / Problem"> Mobile/controls layout unspecified.                          </td><td data-label="Change &amp; Effect"> <code>optimizeTableControls</code> rearranges header controls for narrow screens. Uses matchMedia listener and debounced resize handler. Provides copy-buttons grouping and inline toggle handling.                                                                       </td></tr><tr><td data-label="Input / Problem"> Global state format mismatch (array vs object).              </td><td data-label="Change &amp; Effect"> <code>_getSortStatesArray</code> transforms legacy array state into object keyed structure. Bridges old and new state storage formats gracefully.                                                                                                                         </td></tr><tr><td data-label="Input / Problem"> No public API exposure defined.                              </td><td data-label="Change &amp; Effect"> Exposes many functions to <code>window</code> (showToast, showCopyModal, getSearchEl, sortTableByColumn, toggleTable, updateRowCounts, copy functions, highlight functions, optimizeTableControls). Ensures other modules can call DOM utilities without direct coupling. </td></tr><tr><td data-label="Input / Problem"> No defensive guards for missing DOM or when used in SSR.     </td><td data-label="Change &amp; Effect"> Most functions wrapped in try/catch and fall back to no-op or <code>alert()</code>. Prevents runtime exceptions in non-browser contexts.                                                                                                                                  </td></tr><tr><td data-label="Input / Problem"> Accessibility gaps not fully enforced.                       </td><td data-label="Change &amp; Effect"> Adds <code>role</code>, <code>aria-live</code>, <code>aria-modal</code> for modal/toast and <code>aria-sort</code> for headers. Tabindex and focus behavior applied in header handlers where needed. Meets baseline WCAG affordances.                                                                      </td></tr><tr><td data-label="Input / Problem"> No mutation observer ties to rebind events.                  </td><td data-label="Change &amp; Effect"> <code>script.dom.js</code> does not create the observer itself but exposes utilities (<code>_ensureRowUidsAndSnapshot</code>, <code>optimizeTableControls</code>, <code>getTableFromButton</code>) for <code>script.main.js</code> or <code>script.table.js</code> to hook. This keeps DOM responsibilities separated.           </td></tr><tr><td data-label="Input / Problem"> Version and logging trace absent.                            </td><td data-label="Change &amp; Effect"> Adds console.info at load for debug trace. <code>showToast</code> and internal flows silent by default unless dev console/<code>tvConfig</code> debug toggles used.                                                                                                                  </td></tr></tbody></table></div><div class="row-count">Rows: 23</div></div><div class="table-caption" id="Table6" data-table="Book_8022_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Input / Problem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Input / Problem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Change &amp; Effect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change & Effect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Input / Problem"> Multiple projects provide different clipboard/download helpers. Code assumed globals that may not exist.        </td><td data-label="Change &amp; Effect"> Introduced lazy shims <code>_copyToClipboard</code> and <code>_downloadBlob</code> that prefer existing global functions (<code>window.copyToClipboard</code>, <code>window.__tv_utils.copyToClipboard</code>, <code>window.downloadBlob</code>) then fall back to safe DOM implementations. Effect: no runtime exception when other modules provide util functions. Allows <code>script.table.js</code> to call clipboard/download indirectly and remain decoupled. </td></tr><tr><td data-label="Input / Problem"> Toast UI inconsistent, non-queued, and not accessible.                                                          </td><td data-label="Change &amp; Effect"> Implemented a queued toast system (<code>_toastQueue</code>, <code>_activeToast</code>) with <code>_ensureToastContainer()</code> creating an ARIA <code>role=&quot;status&quot;</code> container. <code>showToast()</code> computes duration, animates entry/exit, provides close button, and restores focus. Effect: predictable, accessible notifications; prevents toast clobbering; consistent feedback for copy/export actions called from table module.      </td></tr><tr><td data-label="Input / Problem"> No computed toast duration; long messages get truncated or disappear.                                           </td><td data-label="Change &amp; Effect"> <code>_computeToastDuration()</code> scales duration by message length and type (error/warn/success). Effect: users have time to read larger messages; avoids premature dismissal.                                                                                                                                                                                                                            </td></tr><tr><td data-label="Input / Problem"> Copy fallback UX missing when Clipboard API fails.                                                              </td><td data-label="Change &amp; Effect"> <code>showCopyModal()</code> provides a modal with textarea, Select All, Copy, and Download. Uses shims for copy/download. Effect: guaranteed fallback path for copy/export operations, preserving user flow without console errors. Modal uses <code>aria-modal=true</code> and focus trapping patterns.                                                                                                                </td></tr><tr><td data-label="Input / Problem"> Buttons and table controls live in varied DOM positions so <code>closest()</code> may fail in some templates.              </td><td data-label="Change &amp; Effect"> <code>getTableFromButton()</code> resolves table by <code>.closest(&#x27;.table-wrapper&#x27;)</code>, <code>.closest(&#x27;.table-container&#x27;)</code>, or nearest <code>[data-table-id]</code>. Effect: robust resolution when actions are triggered from header, toolbar, or external control. Eliminates mis-targeted copy/export actions.                                                                                                                  </td></tr><tr><td data-label="Input / Problem"> Legacy code saved original row orders in different formats (array vs object).                                   </td><td data-label="Change &amp; Effect"> <code>_getTableKey</code>, <code>_readOriginalOrder</code>, <code>_writeOriginalOrder</code>, <code>_getSortStatesArray</code> implement a key-aware storage layer. They accept legacy arrays and migrate them into keyed objects without data loss. Effect: <code>script.table.js</code> can read/write snapshots consistently across old and new pages.                                                                                                 </td></tr><tr><td data-label="Input / Problem"> Sorting UI required per-table keyed state rather than global array index based.                                 </td><td data-label="Change &amp; Effect"> <code>updateHeaderSortUI()</code> reads keyed <code>sortStates</code> per table key and updates <code>.sort-btn</code> classes and <code>aria-sort</code>. Visual icons injected into <code>.sort-icon</code>. Effect: sorting indicators are correct even when tables are added/removed or when table order differs from DOM index.                                                                                                                      </td></tr><tr><td data-label="Input / Problem"> Sorting DOM moves caused heavy reflow on large tables.                                                          </td><td data-label="Change &amp; Effect"> <code>sortTableByColumn()</code> batches reordering using <code>DocumentFragment</code>. Numeric detection uses parseFloat after stripping thousands separators. State transitions 0→1→2→0 with original order restoration using snapshot UIDs. Effect: stable sort, restores original order, reduces reflow thrash and matches Book_8022 performance target.                                                            </td></tr><tr><td data-label="Input / Problem"> Toggle collapse implementations interfered with global controls and lost per-wrapper state.                     </td><td data-label="Change &amp; Effect"> <code>toggleTable()</code> toggles <code>.table-collapsed</code> on <code>.table-wrapper</code>, updates single wrapper button text and <code>toggleAllBtn</code> label. <code>toggleAllTables()</code> uses batched operations for many wrappers. Effect: per-table independent collapse and reliable global toggle.                                                                                                                                     </td></tr><tr><td data-label="Input / Problem"> Row counts not updated after dynamic operations.                                                                </td><td data-label="Change &amp; Effect"> <code>updateRowCounts()</code> recomputes visible/total rows for each wrapper and is invoked after sort, filter, append, toggle actions. Effect: accurate readouts in UI and parity with benchmark metadata.                                                                                                                                                                                                  </td></tr><tr><td data-label="Input / Problem"> Markdown formatting lost pipes or multiline cells.                                                              </td><td data-label="Change &amp; Effect"> <code>formatCellForMarkdown()</code> escapes `                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Input / Problem"> Copy-all and export-all actions were brittle and could fail silently.                                           </td><td data-label="Change &amp; Effect"> <code>copyAllTablesPlain()</code> and <code>copyAllTablesMarkdown()</code> iterate wrappers safely, aggregate results, and fall back to <code>showCopyModal()</code> on failure. Effect: robust multi-table export with user feedback.                                                                                                                                                                                              </td></tr><tr><td data-label="Input / Problem"> Search/highlight naive implementation broke inline markup and failed with diacritics/unicode.                   </td><td data-label="Change &amp; Effect"> Implemented <code>buildNormalizedMapForCell()</code> and <code>highlightMatches()</code> which walk text nodes, normalize NFD, strip combining marks, construct a map of normalized positions to nodes, then insert <code>&lt;mark&gt;</code> wrappers preserving node boundaries. Effect: accurate highlighting for diacritics and complex inline elements without destroying HTML structure.                                            </td></tr><tr><td data-label="Input / Problem"> Search normalization duplicated in callers and inconsistent.                                                    </td><td data-label="Change &amp; Effect"> <code>searchTable()</code> includes a local normalization closure using <code>.normalize(&#x27;NFD&#x27;)</code> and regex strip of combining marks with fallbacks for environments lacking Unicode property escapes. Effect: consistent filter across all cells; avoids false negatives on accented characters.                                                                                                                   </td></tr><tr><td data-label="Input / Problem"> First-match scrolling sometimes focused hidden headers or clipped under sticky header.                          </td><td data-label="Change &amp; Effect"> <code>searchTable()</code> computes <code>rect = row.getBoundingClientRect()</code> and subtracts <code>#stickyMainHeader</code> offset before smooth scroll. Effect: matched row is visible and not obscured by sticky headers.                                                                                                                                                                                                    </td></tr><tr><td data-label="Input / Problem"> Mobile header controls crowded and inconsistent across templates.                                               </td><td data-label="Change &amp; Effect"> <code>optimizeTableControls()</code> groups copy buttons into <code>.copy-buttons</code>, moves toggle into header, and applies responsive styles. Uses <code>matchMedia</code> listener and debounced resize handling. Effect: better mobile ergonomics without changing CSS file.                                                                                                                                                 </td></tr><tr><td data-label="Input / Problem"> No debounce/optimization for resize or matchMedia change.                                                       </td><td data-label="Change &amp; Effect"> <code>_debouncedOptimize</code> wraps <code>optimizeTableControls()</code> with a 120ms debounce and correct event binding for <code>addEventListener</code> vs <code>addListener</code>. Effect: avoids layout thrash on frequent resize events.                                                                                                                                                                                              </td></tr><tr><td data-label="Input / Problem"> Exposed functions inconsistent with table module expectations.                                                  </td><td data-label="Change &amp; Effect"> Script exposes many helper functions to <code>window</code> (e.g., <code>showToast</code>, <code>showCopyModal</code>, <code>getSearchEl</code>, <code>sortTableByColumn</code>, <code>updateHeaderSortUI</code>, <code>searchTable</code>, etc.). Effect: <code>script.table.js</code> can call these functions safely. Explicit exposure reduces coupling ambiguity.                                                                                                                     </td></tr><tr><td data-label="Input / Problem"> No MutationObserver present to trigger rebind after dynamic table injection.                                    </td><td data-label="Change &amp; Effect"> Intentionally left out to preserve separation of concerns. <code>script.dom.js</code> exposes <code>_ensureRowUidsAndSnapshot</code> and <code>optimizeTableControls</code> so <code>script.main.js</code> or <code>script.table.js</code> can register observers as needed. Effect: keeps DOM utilities lightweight and allows central control of observers in main/bootstrap module.                                                                    </td></tr><tr><td data-label="Input / Problem"> Error handling often silent, causing debugging difficulty.                                                      </td><td data-label="Change &amp; Effect"> Most functions wrapped in try/catch; key failures fallback to <code>alert()</code> or <code>console.warn()</code> for developer visibility. <code>console.info</code> at load indicates module presence. Effect: production-safe but observable during dev.                                                                                                                                                                         </td></tr><tr><td data-label="Input / Problem"> ARIA attributes applied but not fully consistent (e.g., header tabbability, modal focus).                       </td><td data-label="Change &amp; Effect"> Headers get <code>tabindex</code> and <code>aria-sort</code> updated by <code>updateHeaderSortUI()</code> where used; modal uses <code>role=dialog</code> and <code>aria-modal</code>. Effect: baseline accessibility satisfied. Full WCAG audits may require small aria-text adjustments.                                                                                                                                                                </td></tr><tr><td data-label="Input / Problem"> Legacy global state used arrays masquerading as objects.                                                        </td><td data-label="Change &amp; Effect"> <code>_getSortStatesArray()</code> converts legacy arrays into keyed object format and preserves <code>__legacy</code> for backward compatibility. Effect: safer upgrades with no data loss across versions.                                                                                                                                                                                                             </td></tr><tr><td data-label="Input / Problem"> No automatic reconciliation between keyed table IDs and DOM index ordering.                                     </td><td data-label="Change &amp; Effect"> <code>_getTableKey()</code> attempts to use <code>data-tv-table-id</code> or <code>window._ensureTableId</code> when present; otherwise falls back to index. Effect: robust key selection that works across templating systems.                                                                                                                                                                                                     </td></tr><tr><td data-label="Input / Problem"> Copy/download shims return inconsistent value types (some return Promise, others boolean).                      </td><td data-label="Change &amp; Effect"> Shims try to maintain Promise semantics for <code>_copyToClipboard</code> and synchronous boolean for <code>_downloadBlob</code> where possible. Calling code handles both via <code>.then().catch()</code> and try/catch. Effect: compatibility with both async Clipboard API and synchronous fallback.                                                                                                                            </td></tr><tr><td data-label="Input / Problem"> Tiny UI differences between Tables Viewer and PasteToTable (button wording, order)                              </td><td data-label="Change &amp; Effect"> <code>toggle</code> text and <code>toggleAllBtn</code> labels follow exact phrasing "Collapse Table"/"Expand Table" and "Collapse All Tables"/"Expand All Tables" to match benchmark. Effect: text parity with Book_8022/Book_9001.                                                                                                                                                                                      </td></tr><tr><td data-label="Input / Problem"> No unit hooks for headless testing (Jest/Playwright).                                                           </td><td data-label="Change &amp; Effect"> Public functions are callable on <code>window</code>, enabling headless runners to call <code>searchTable()</code>, <code>copyTablePlain()</code>, <code>sortTableByColumn()</code> directly. Effect: testable surface without DOM shims.                                                                                                                                                                                                      </td></tr><tr><td data-label="Input / Problem"> Potential race: <code>script.table.js</code> may call <code>updateHeaderSortUI</code> before <code>script.dom.js</code> attaches it to <code>window</code>. </td><td data-label="Change &amp; Effect"> <code>script.dom.js</code> assigns exposures at bottom (`window.updateHeaderSortUI = window.updateHeaderSortUI                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Input / Problem"> Missing explicit teardown API for toast/modal when single page app swaps DOM.                                   </td><td data-label="Change &amp; Effect"> Functions remain passive; consumer should call <code>document.getElementById(&#x27;tv-toast-container&#x27;)?.remove()</code> and remove <code>#tv-copy-modal</code> when unloading. Effect: memory freed on consumer side; propose adding <code>window.tvDomDestroy()</code> in next patch if needed.                                                                                                                                        </td></tr><tr><td data-label="Input / Problem"> Logging controlled by <code>tvConfig</code> not present in all pages.                                                      </td><td data-label="Change &amp; Effect"> Module uses local <code>console.info</code> and silent catches. Effect: non-intrusive in production; can be extended to <code>tvConfig.debug</code> if available.                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Input / Problem"> Small CSS expectations (e.g., <code>--panel</code>, <code>--text</code>) may be missing in user CSS.                                  </td><td data-label="Change &amp; Effect"> Inline fallbacks use <code>#fff</code> / <code>#111</code> ensuring legible toasts even if CSS variables absent. Effect: robust visuals without dependency on style.css edits.                                                                                                                                                                                                                                           </td></tr></tbody></table></div><div class="row-count">Rows: 30</div></div><div class="table-caption" id="Table7" data-table="Book_8022_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>High-level</strong>                            </td><td data-label="Details"> <strong>script.dom.js</strong> – DOM helpers, toasts, copy modal, search/highlight, UI optimizations, exposes functions on <code>window</code>. <strong>script.table.js</strong> – per-table behavior: collapse, sorting, copy/export, appendRows, UID snapshot, header UI updates. Consumes DOM shims (<code>showToast</code>, <code>_copyToClipboard</code>) and exposes APIs (<code>attachPerWrapperHandlers</code>, <code>updateHeaderSortUI</code>, <code>headerSortButtonClicked</code>, etc.). <strong>script.convert.js</strong> – handles render/convert/save flows. Injects HTML, assigns table IDs/snapshots, and calls <code>markButtonsHiddenForAllWrappers</code>, <code>revealButtonsForRenderedTables</code>, <code>attachPerWrapperHandlers</code>, <code>updateRowCounts</code>, <code>buildSingleTableToc</code>, and <code>_ensureDelegatedHandlers</code>. <strong>script.main.js</strong> – orchestrates bootstrap: wraps tables, assigns UIDs if helper missing, wires search and global handlers, and calls fallback attachers when <code>attachPerWrapperHandlers</code> missing.                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Section"> <strong>showToast</strong>                             </td><td data-label="Details"> Provided by <code>script.dom.js</code> (exposed as <code>window.showToast</code>). Called by <code>script.table.js</code> (<code>_toast</code>) and <code>script.convert.js</code> (<code>tv_toast</code>) as a preferred host implementation. If missing, both modules have local fallback to create toasts.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Clipboard / download helpers</strong>          </td><td data-label="Details"> <code>script.dom.js</code> defines <code>_copyToClipboard</code> shim and <code>_downloadBlob</code> shim (prefers <code>window.__tv_utils</code> or global functions). <code>script.table.js</code> uses internal <code>_copyToClipboard</code> and <code>_downloadBlob</code> implementations but also checks <code>PTT.downloadBlob/PTT.sanitizeFileName</code> and <code>PTT.worker</code>. <code>script.convert.js</code> uses <code>tv_copyText</code> and <code>_downloadBlob</code> and prefers <code>window.showToast</code>. <strong>Risk:</strong> inconsistent return types (<code>Promise</code> vs <code>boolean</code>). Modules already use <code>.then/.catch</code> and <code>try/catch</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Section"> <strong>UID / original order snapshots</strong>        </td><td data-label="Details"> <code>script.table.js</code> uses <code>window.originalRowOrders</code>, <code>window._tv_row_uid_counter</code>, <code>window._ensureRowUidsAndSnapshot</code>. <code>script.dom.js</code> provides <code>_ensureRowUidsAndSnapshot</code> compatible helper and keyed read/write (<code>_readOriginalOrder</code>, <code>_writeOriginalOrder</code>). <code>script.main.js</code> supplies a fallback <code>_ensureRowUidsAndSnapshot</code> if not present. <code>script.convert.js</code> assigns <code>data-tvId</code> and <code>data-tvUid</code> and keeps <code>tv._snapshots</code>. <strong>Effect:</strong> snapshot model reconciled via keyed and legacy array formats.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section"> <strong>Sorting UI and header clicks</strong>          </td><td data-label="Details"> <code>script.table.js</code> implements <code>sortTableByColumn</code>, <code>updateHeaderSortUI</code>, <code>headerSortButtonClicked</code>. <code>script.dom.js</code> also implements <code>sortTableByColumn</code> & <code>updateHeaderSortUI</code> (compatible keyed variant). <code>script.convert.js</code> sets up delegated header click handler (<code>_ensureDelegatedHandlers</code>) that calls <code>window.headerSortButtonClicked(tableIdx, colIdx, hit)</code>. <code>script.main.js</code> attaches per-wrapper handlers fallback if <code>attachPerWrapperHandlers</code> absent. <strong>Risk:</strong> duplicate implementations must be consistent; current code uses the same state keys and compatible algorithms.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Event binding and idempotence</strong>         </td><td data-label="Details"> <code>script.table.js</code> exposes <code>attachPerWrapperHandlers()</code> and idempotent per-button binding. <code>script.convert.js</code> installs delegated handlers (<code>_ensureDelegatedHandlers</code>) and also calls <code>attachFallbackCopyHandlers</code> after injection. <code>script.main.js</code> calls <code>attachPerWrapperHandlersIfMissing()</code> on DOM ready to ensure handlers exist. <strong>Effect:</strong> handlers safe and not double-bound; each module guards with flags.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Table rendering pipeline</strong>              </td><td data-label="Details"> <code>script.convert.js</code> performs <code>doRender</code> / <code>doConvert</code>: inject HTML, <code>assignTableIds</code>, <code>markButtonsHiddenForAllWrappers</code>, <code>revealButtonsForRenderedTables</code>, <code>attachPerWrapperHandlers</code>, <code>attachFallbackCopyHandlers</code>, <code>optimizeTableControls</code>, <code>updateRowCounts</code>, <code>_ensureDelegatedHandlers</code>, <code>buildSingleTableToc</code>. <code>script.table.js</code> must respond to these calls: <code>bindWrapper</code>, <code>appendRows</code>, <code>attachPerWrapperHandlers</code>, <code>updateHeaderSortUI</code>, <code>updateRowCounts</code>. <code>script.dom.js</code> supplies many of these functions or shims. <strong>Risk:</strong> order of these calls matters. <code>assignTableIds → attachPerWrapperHandlers → revealButtonsForRenderedTables</code> is expected.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>TOC and scroll sync</strong>                   </td><td data-label="Details"> <code>script.convert.js</code> calls <code>buildSingleTableToc()</code> after render/convert. <code>script.dom.js</code> exports <code>buildSingleTableToc</code> (fallback builder). <code>script.table.js</code> references <code>script.toc.js</code> behavior optionally. <strong>Note:</strong> <code>script.toc.js</code> not provided; fallback flows present.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Integration risks and recommendations</strong> </td><td data-label="Details"> <strong>Load order:</strong> current safe pattern uses DOMContentLoaded listeners. For zero race ensure recommended load order: <code>script.dom.js → script.table.js → script.convert.js → script.main.js</code>. <code>script.main.js</code> can still be earlier because it waits for DOM, but having main last avoids fallback attachers running before other modules load. <strong>Duplicate sort implementations:</strong> <code>script.dom.js</code> and <code>script.table.js</code> both provide sorting functions. They use compatible logic and keyed state. Keep both but consolidate to single canonical implementation later. <strong>Clipboard/download return types:</strong> unify shims to always return a <code>Promise</code> for <code>_copyToClipboard</code> and a <code>Promise/boolean</code> for <code>_downloadBlob</code>. <strong>State shape:</strong> <code>window.originalRowOrders</code> can be array or object. Both modules handle transitions. Keep keyed object shape going forward; consider an adaptor to migrate legacy arrays on init. <strong>MutationObserver:</strong> neither <code>script.dom.js</code> nor <code>script.convert.js</code> installs a <code>MutationObserver</code> centrally. <code>script.main.js</code> could register one to call <code>attachPerWrapperHandlers()</code> after dynamic DOM injection. Recommended but not required. <strong>Missing files:</strong> <code>script.utils.js</code> and <code>script.toc.js</code> not provided. Provide them if they exist. <code>script.utils.js</code> often supplies <code>__tv_utils</code> used by shims. </td></tr><tr><td data-label="Section"> <strong>Next steps</strong>                            </td><td data-label="Details"> 1. Produce an <strong>integration risk matrix</strong> (detailed per function) and a minimal patch list to remove duplicate sorting code and unify shims. <br>2. Perform <strong>Silent Analysis ×10</strong> on <code>script.table.js</code> and <code>script.dom.js</code> again jointly focusing on exact function signatures where they overlap (<code>sortTableByColumn</code>, <code>updateHeaderSortUI</code>, <code>_ensureRowUidsAndSnapshot</code>). <br>3. Prepare recommended exact load order and a tiny <code>script.main.js</code> tweak (1-line) to add a <code>MutationObserver</code> to call <code>attachPerWrapperHandlers()</code> after injected nodes appear. <br>4. Optional: if <code>script.utils.js</code> and <code>script.toc.js</code> are available, provide them for full coverage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table8" data-table="Book_8022_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Input / Problem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Input / Problem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Change &amp; Effect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change & Effect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Input / Problem"> Collapse button per table sometimes toggles globally or mislabels text                  </td><td data-label="Change &amp; Effect"> Make toggle handler locate <code>.table-wrapper</code> defensively, update only buttons inside that wrapper, set <code>aria-expanded</code> consistently, and avoid touching global state. Effect: per-table collapse is isolated and ARIA-compliant.        </td></tr><tr><td data-label="Input / Problem"> Toggle-all button state out of sync after per-table toggles                             </td><td data-label="Change &amp; Effect"> Update toggle-all text only from a single query of wrappers after each toggle. Effect: toggle-all reflects real state.                                                                                                                 </td></tr><tr><td data-label="Input / Problem"> Inline <code>onclick</code> or prior handlers cause duplicate handlers or non-idempotent bindings  </td><td data-label="Change &amp; Effect"> Remove inline <code>onclick</code> where possible, check <code>dataset.tvHandlerAttached</code> and <code>_ptt_clickHandler</code> before adding, store handler references to allow safe rebind/remove. Effect: idempotent handler attachment.                          </td></tr><tr><td data-label="Input / Problem"> Header sort UI and logic inconsistent with keyed sort state (<code>sortStates</code> vs keyed map) </td><td data-label="Change &amp; Effect"> Read/write sort state through <code>_getSortStatesArray</code> abstraction, use table key (data attributes) when available. Update header UI generation to read keyed state. Effect: stable per-table sorting state and correct ARIA <code>aria-sort</code>. </td></tr><tr><td data-label="Input / Problem"> Sorting reset doesn't restore original snapshot reliably                                </td><td data-label="Change &amp; Effect"> Ensure <code>_ensureRowUidsAndSnapshot</code> writes snapshot using same key scheme and <code>originalRowOrders</code> accessor compatible with array or object forms. Use snapshot for reset. Effect: reset restores original order reliably.               </td></tr><tr><td data-label="Input / Problem"> Delegated clicks (document-level) may conflict with per-wrapper handlers                </td><td data-label="Change &amp; Effect"> Keep delegated handlers minimal and idempotent. Per-wrapper handlers are preferred; delegate as fallback. Effect: no double-invocation.                                                                                                </td></tr><tr><td data-label="Input / Problem"> Search highlight breaks node boundaries or loses original HTML                          </td><td data-label="Change &amp; Effect"> Ensure per-cell <code>data-orig-html</code> snapshot before any DOM modifications. Use normalized map + tree-walker highlight that restores from snapshot. Effect: highlights reversible and robust across runs.                                  </td></tr><tr><td data-label="Input / Problem"> Clipboard/download helpers inconsistent across modules                                  </td><td data-label="Change &amp; Effect"> Use shim functions that prefer <code>__tv_utils</code> then fallback. Do not duplicate implementations. Effect: single source of truth for copy/download.                                                                                         </td></tr><tr><td data-label="Input / Problem"> Table container wrapping inconsistent causing selector mismatches                       </td><td data-label="Change &amp; Effect"> Idempotent <code>wrapTables()</code> that creates <code>.table-container</code> once and preserves structure. Effect: DOM structure consistent for other modules.                                                                                            </td></tr><tr><td data-label="Input / Problem"> Mobile/table controls rearrangement sometimes re-parent nodes incorrectly               </td><td data-label="Change &amp; Effect"> Conservative DOM moves with checks; restore classes (<code>table-toggle-inline</code>) and avoid moving if already parented. Effect: responsive layout stable.                                                                                    </td></tr><tr><td data-label="Input / Problem"> Toast/modal implementations duplicated and inconsistent                                 </td><td data-label="Change &amp; Effect"> Use host <code>showToast</code> when present else local toast; ensure <code>tv_toast</code> and <code>showToast</code> interoperate. Effect: unified UX for notifications.                                                                                              </td></tr><tr><td data-label="Input / Problem"> attachPerWrapperHandlers and optimizeTableControls order race                           </td><td data-label="Change &amp; Effect"> Ensure <code>attachPerWrapperHandlers()</code> idempotent and callable after reveal; <code>optimizeTableControls()</code> can be called safely multiple times. Effect: predictable final UI.                                                                 </td></tr><tr><td data-label="Input / Problem"> Missing <code>tabindex</code>, <code>role</code>, or ARIA on sortable headers for keyboard users              </td><td data-label="Change &amp; Effect"> Ensure <code>th</code> elements gain <code>tabindex=0</code>, <code>role=columnheader</code>, and <code>aria-sort</code> attribute set by UI update. Add keydown handler for Enter/Space. Effect: keyboard-accessible sorting.                                                     </td></tr><tr><td data-label="Input / Problem"> Per-cell <code>origHtml</code> not created early enough (search runs first)                        </td><td data-label="Change &amp; Effect"> Run <code>ensurePerCellOrigHtml()</code> during DOM-ready and after render/convert. Effect: highlights and copy produce correct content.                                                                                                          </td></tr><tr><td data-label="Input / Problem"> Worker / SheetJS export paths may exist; click handlers must prefer module API          </td><td data-label="Change &amp; Effect"> Handler calls should try <code>PTT</code>/<code>window</code> export functions, then fallback to local functions. Effect: compatibility with both old and new modules.                                                                                       </td></tr></tbody></table></div><div class="row-count">Rows: 15</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>