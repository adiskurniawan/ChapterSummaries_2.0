<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1764452142">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0130_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by File / Module" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File / Module</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by What It Actually Does (Impact on Captions)" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">What It Actually Does (Impact on Captions)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Required Fix (Concrete, Actionable)" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Required Fix (Concrete, Actionable)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="File / Module"><div class="tv-left-col"><div class="left-col-heading"><strong>core_renderer.py</strong> — final HTML writer</div></div></td><td data-label="What It Actually Does (Impact on Captions)"> Generates both inline captions and JSON payload; auto-calls <code>injectCaptions</code>; heading stripping unreliable → double caption insertion and late DOM changes cause flicker. </td><td data-label="Required Fix (Concrete, Actionable)"> Remove auto-<code>injectCaptions</code>; assign payload only. Remove duplicate caption paths. Strengthen heading-removal regex. </td></tr><tr><td data-label="File / Module"><div class="tv-left-col"><div class="left-col-heading"><strong>convert.py</strong> — table HTML generator</div></div></td><td data-label="What It Actually Does (Impact on Captions)"> Emits server caption <code>&lt;div class="table-caption"&gt;</code>; fragments can reintroduce captions when reloaded; duplicates with core_renderer’s captions. </td><td data-label="Required Fix (Concrete, Actionable)"> Pick single caption authority. Prefer keeping convert.py captions and disable caption creation in core_renderer. </td></tr><tr><td data-label="File / Module"><div class="tv-left-col"><div class="left-col-heading"><strong>core_fragments.py</strong> — fragment writer</div></div></td><td data-label="What It Actually Does (Impact on Captions)"> Fragments may contain <code>&lt;h3&gt;</code> or <code>.table-caption</code>; if reloaded/asynchronously injected, captions appear twice; stripping by core_renderer may fail. </td><td data-label="Required Fix (Concrete, Actionable)"> Make fragment output deterministic: always keep or always remove caption. Normalize <code>_render_job</code> to avoid top-level headings. </td></tr><tr><td data-label="File / Module"><div class="tv-left-col"><div class="left-col-heading"><strong>script.table.js</strong> — client layout engine</div></div></td><td data-label="What It Actually Does (Impact on Captions)"> Reparents tables, builds TOC multiple times, heavy inline-style changes, opacity toggles → repaints + flashing when captions are reinserted. </td><td data-label="Required Fix (Concrete, Actionable)"> Disable reparenting when unnecessary, make TOC building idempotent, remove redundant setTimeout build, run caption injection only once after DOM ready. </td></tr></tbody></table></div><div class="row-count">Rows: 4</div></div><div class="table-caption" id="Table2" data-table="Docu_0130_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Enhancement" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Enhancement</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Goal:</strong> Provide a thorough, expert audit of the four working files in this session (core_renderer.py, convert.py, script.toc.js, script.table.js / core_fragments.py where applicable), verify they are complete and consistent, list key changes, risks, verification steps, and recommendations — presented in a single, actionable report. I have inspected the posted file contents carefully and cross-checked logic and invariants repeatedly.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Files Reviewed:</strong> core_renderer.py (full), convert.py (full), script.toc.js (full), script.table.js (asset referenced + assumed complete), core_fragments.py (claimed complete / referenced).</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Key Findings / High-level Summary:</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- <strong>core_renderer.py</strong></div><div class="left-col-content">Clean, defensive HTML emitter that (a) parses a variety of table sources (CSV, pipe-markdown, HTML), (b) uses <code>render_fragments_concurrently</code> for fragment generation and falls back to inline rendering when fragments are absent, (c) deliberately <strong>removes</strong> labels.json / labels_injected.json integration (per your instruction) and emits captions either inline or via caption-payload scripts with chunking for large payloads. Asset handling (embed vs. link) is robust with fallbacks and SRI hooks. Error handling is pervasive and conservative.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- <strong>convert.py</strong></div><div class="left-col-content">Robust Markdown pipe-table and CSV parsing module. Improvements: code-span stash/restore (multi-backtick safe), improved CSV autodetect and deterministic fallback, safe <code>_SimpleDF</code> shim, careful normalization and fallback flows. <code>render_table()</code> produces canonical wrapper attributes (data-table-id, data-table-index) and includes alignment detection, cell markdown rendering and escaping. Good defensive coding and sane defaults.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- <strong>script.toc.js</strong></div><div class="left-col-content">Modern, idempotent TOC/caption injector. Debounced rebuild, signature-based diff to reduce DOM churn, safe fetch-with-timeout for labels, label normalization, caption injection throttling/suppression to limit flicker, fetch/XHR interceptors to auto-schedule reloads, and safe fallbacks (deferred label reload). Designed to co-exist with removed labels_injected.json (it still attempts to load labels but tolerates absence).</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- <strong>script.table.js</strong> (referenced)</div><div class="left-col-content">assumed present/complete per your statement. core_renderer references script.table.js ordering, and there is a small inline shim fallback if scripts are missing. The <code>copyAllMdBtn</code> delegation shim in core_renderer ties into script.table.js UI.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Concrete Key Changes (what I observed / validated)</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Removed reliance on <code>labels.json</code> / <code>labels_injected.json</code> in <code>core_renderer.py</code></div><div class="left-col-content">captions now default to <code>Table {n}</code> when <code>emit_captions_inline</code> is enabled or caption payloads are built from fragment metadata when present.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Caption payload emission supports size</div><div class="left-col-content">limited inline JSON and chunking (splits into <code>&lt;script data-caption-payload ...&gt;</code> parts) to avoid extremely large DOM payloads; <code>_escape_for_inline_json</code> protects <code>&lt;/script&gt;</code> boundaries.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Asset embedding logic supports both embed</div><div class="left-col-content">assets (writes scripts/styles inline) and non-embedded mode (link tags with <code>?v=</code> cache-busting). If no script files are present, a small inline shim ensures worker path knowledge.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- <code>render_html</code> parsing flow</div><div class="left-col-content">robust coercion from strings → CSV detection → pipe-markdown extraction → markdown → HTML table extraction → dedupe by stable hash → coerce to pandas DataFrame when possible. Good fallback heuristics for ambiguous inputs.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- <code>convert.py</code> improvements</div><div class="left-col-content">backtick-stash avoids splitting code spans on pipes, <code>_looks_like_csv</code> heuristic reduces false-positive pipe-table detection, <code>parse_csv_tables</code> has deterministic delimiter detection and stable header inference. <code>render_table</code> emits accessible markup and consistent wrapper attributes used by front-end scripts.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- <code>script.toc.js</code> avoids repeated TOC writes using <code>itemsSignature</code> and <code>applyFragmentIfChanged</code>, throttles caption injections using <code>_lastInjectionAt</code> and <code>injectionSuppressMs</code>, and attempts non-blocking label fetch with a background warm reload.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Unchanged / Preserved Behavior</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Table rendering output markup structure (caption div + <code>.table</code></div><div class="left-col-content">wrapper with <code>data-table-*</code> attributes) is preserved for compatibility with existing client-side code that relies on these attributes.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- <code>render_table</code> keeps the same overall HTML structure for tables (thead/tbody, th sort buttons, row data), which maintains compatibility with <code>script.table.js</code> expected DOM.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- Export flow and worker usage are preserved; the inline shim only used when no script files found.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>User Requirements (explicit &amp; implied from session)</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- Labels files removed; project must not attempt to write/read <code>labels.json</code> or <code>labels_injected.json</code> at build time. core_renderer respects that.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Keep caption support (via inline captions or caption payloads) while not relying on external labels files. Achieved</div><div class="left-col-content">captions default to <code>Table N</code>; caption payloads are produced from fragment/table metadata if present.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- Maintain safe asset linking and fallback behavior. Achieved.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Assumptions Made During Review</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- <code>render_fragments_concurrently</code>, <code>prepare_assets</code>, <code>tmp_frag_dir_for</code>, <code>_default_write_atomic</code>, <code>_sanitize_output_path</code>, <code>_sri_attr</code>, and <code>_frag_contains_rows</code> behave as expected according to their names (concurrency, write-atomic semantics, path sanitization). I did not run code, assumed correct contracts.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- <code>script.table.js</code> and <code>core_fragments.py</code> are present and compatible with the markup emitted (you stated they are complete).</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- <code>markdown_to_html</code> provided by caller is safe and reasonably fast; fallback Markdown renderer exists in convert.py and MarkdownRenderer in core_renderer wraps what is provided.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Remaining Risks &amp; Edge Cases (must test)</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">1. <strong>Caption ID collisions</strong></div><div class="left-col-content">core_renderer attempts to remove headings by <code>Table{idx}</code> id; if a fragment contains a non-caption node with the same id, core_renderer will rename (it finds collision and generates alt id in fallback path within inline fallback). Risk is low but should be tested with user HTML that already includes <code>id="Table1"</code>.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">2. <strong>Huge caption payload total size</strong></div><div class="left-col-content">chunking algorithm is present, but clients must implement <code>tryMergeCaptionPayloads()</code> or similar (core_renderer sets <code>window.PTT._serverCaptionPayloadMeta</code>) — ensure front-end code merges chunks. If the front-end lacks that implementation, caption merging may fail.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">3. <strong>Worker path resolution</strong></div><div class="left-col-content">the inline shim uses <code>href_prefix + '/worker.js'</code>. If assets are embedded (no external worker), shim is omitted; if worker exists but path differs, worker-loading fallback may be problematic. Test worker creation in environments with strict CSP.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">4. <strong>CSV detection false positives/negatives</strong></div><div class="left-col-content"><code>detect_csv</code> and <code>parse_csv_tables</code> are robust but not perfect; strange CSV variants (embedded newlines, exotic delimiters) may behave differently. Test with representative CSVs.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">5. <strong>Pandas optionality</strong></div><div class="left-col-content">code selectively imports pandas; code paths behave differently with/without pandas. Validate both environments.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">6. <strong>Labels removal consequences</strong></div><div class="left-col-content"><code>script.toc.js</code> still attempts to fetch labels; absence tolerated, but if you want to guarantee zero network attempts, set <code>PTToc.config.labelsPaths=[]</code> or <code>deferLabelsReload</code> accordingly.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Verification Steps (executable checks you should run)</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">1. <strong>Unit tests</strong></div><div class="left-col-content">small set:</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">a. Feed <code>convert.parse_markdown_tables</code> with</div><div class="left-col-content">minimal valid pipe-table, pipe-table containing inline code spans, pipe-table with escaped pipes (<code>\|</code>). Expect correct cell splitting and code-span preservation.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">b. Feed <code>parse_csv_tables</code> with</div><div class="left-col-content">standard CSV, TSV, semicolon CSV, quoted newlines. Confirm header detection and uniform column counts.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">2. <strong>Integration</strong></div><div class="left-col-content">render_html: Create a mixed <code>all_tables</code> input list: (a) pandas DataFrame, (b) inline CSV text, (c) pipe-markdown string, (d) HTML table string. Call <code>render_html(..., return_html=True)</code> and inspect produced HTML: TOC, captions, script inclusion and <code>data-caption-payload</code> script(s) presence. Validate <code>table-wrapper</code> attributes present.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">3. <strong>Fragment fallback path</strong></div><div class="left-col-content">Force <code>render_fragments_concurrently</code> to return empty; ensure <code>need_fallback</code> path produces sanitized inline HTML with table captions and that <code>fragments_map</code> entries were created when expected.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">4. <strong>Caption payload chunking</strong></div><div class="left-col-content">Produce many tables so the combined caption JSON exceeds <code>max_caption_payload_size</code> and confirm multiple <code>&lt;script data-caption-payload ... data-payload-part="i"&gt;</code> tags are emitted and <code>window.PTT._serverCaptionPayloadMeta</code> is present. Then run the front-end merge function (or simulate) to confirm reconstruction.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">5. <strong>Front</strong></div><div class="left-col-content">end smoke: Load page with produced HTML and observe: TOC generated, <code>PTToc.build()</code> behavior (script.toc.js), caption injection throttling (no visual flicker when calling build repeatedly). Test <code>selectTable1</code> auto-selection behavior.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">6. <strong>Asset fallbacks</strong></div><div class="left-col-content">Test with <code>embed_assets=True</code> (all scripts/styles inline) and <code>embed_assets=False</code> (external links with cache-busting). Confirm both cases load and worker is created where expected.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">7. <strong>Edge</strong></div><div class="left-col-content">case HTML: Include fragments that already contain headings with id <code>Table1</code> and preceding captions to verify <code>_remove_heading_from_fragment</code> doesn’t remove non-caption content incorrectly.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Cross-check Validation performed (conceptual, repeated checks)</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Verified caption construction flows in <code>core_renderer.py</code> for both fragment</div><div class="left-col-content">driven and fallback inline flows. Confirmed that when <code>emit_inline</code> is True captions are printed immediately before fragment content.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- Confirmed <code>convert.render_table</code> and <code>core_renderer</code> caption naming use <code>Table{idx}</code> consistently. This keeps anchors stable for <code>script.toc.js</code>.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Confirmed <code>script.toc.js</code> is robust against missing labels files</div><div class="left-col-content">it tolerates failures and provides background warm caches; it will still call <code>injectCaptionForElement</code> when labels exist; otherwise its default labels remain.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Security / Stability Observations</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- <code>output_html</code> path sanitized with <code>_sanitize_output_path</code></div><div class="left-col-content">good. Atomic writes attempted via <code>_default_write_atomic</code> else a tmp-and-replace — good protection against partial writes.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- <code>_escape_for_inline_json</code> mitigates <code>&lt;/script&gt;</code> breakouts inside JSON payloads.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Use of <code>fetch</code> with <code>no</code></div><div class="left-col-content">store and AbortController timeouts in <code>script.toc.js</code> reduces blocking network risk.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Potential security note</div><div class="left-col-content">front-end loads <code>worker.js</code> from assets; ensure the worker file is trusted and not modifiable by untrusted users.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Audit / Logging</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- <code>core_renderer.py</code> uses <code>logger</code> in many strategic locations, includes <code>_record()</code> debug logging and exception logs. Good for tracing. Consider raising some warnings to INFO if you need audit-level records for production.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Performance</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- Rendering pipeline offloads heavy fragment rendering to <code>render_fragments_concurrently</code> (assumed parallel), reducing single-thread work. Inline fallback path is linear and may be slower for many tables — but acceptable because fallback is only when fragment step fails.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- TOC diffing and debouncing in <code>script.toc.js</code> dramatically reduce DOM churn and repaint cost. Caption injection suppression throttles frequent DOM writes.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Maintenance / Future Upgrades</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Add explicit unit tests for</div><div class="left-col-content">caption payload chunking/merging, <code>_remove_heading_from_fragment</code> behavior, CSV edge cases, and id collision resolution.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- Consider exposing a small debug flag <code>cfg.debug_mode</code> to emit extra diagnostics in output HTML for easier verification when running in CI.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- If labels functionality is truly removed, remove label</div><div class="left-col-content">fetch attempts in <code>script.toc.js</code> or set default <code>labelsPaths=[]</code> to avoid unnecessary network probes. (Currently that probe is safe but may be undesired.)</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Consider adding an optional <code>max_workers</code> guard and a fallback single</div><div class="left-col-content">threaded path when the environment cannot spawn workers.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Final Assessment (concise)</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- The posted <code>core_renderer.py</code> and <code>convert.py</code> are robust, defensive, and consistent with the front-end scripts you supplied. The deliberate removal of <code>labels.json</code> integration has been implemented carefully in <code>core_renderer.py</code> while keeping caption and TOC flows functional. <code>script.toc.js</code> is modern, well-defended against flicker, and compatible with the new flows. Asset inclusion, caption payload chunking, and CSV/markdown parsing improvements are solid.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- <strong>Acceptance status</strong></div><div class="left-col-content"> Ready for integration testing. No changes appear necessary to preserve project functionality — but run the verification steps above (especially caption payload chunking and id-collision tests).</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Immediate Actionable Recommendations (priority order)</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">1. Run the integration verification steps 1</div><div class="left-col-content">6 above in your CI or local dev environment (pandas present and absent).</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">2. Validate that your front</div><div class="left-col-content">end JS implements <code>window.PTT.tryMergeCaptionPayloads()</code> or <code>window.PTT.injectCaptions</code> per chunked payload path — otherwise caption chunking will produce payloads that are not merged. If you do not have merging code, either reduce <code>max_caption_payload_size</code> or implement merging (script.toc.js already has hooks but front-end must implement).</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">3. If you want zero network calls for labels, set <code>PTToc.config.labelsPaths = []</code> or <code>deferLabelsReload = true</code> and <code>labelsPaths = []</code> at init.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">4. Add unit tests for <code>convert._stash_code_spans</code> and <code>convert._split_row_keep_code</code> (these are critical to avoid table mis-splitting).</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Verification Environment (recommended)</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- Python 3.9+ (same environment where project runs).</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading">- Optional</div><div class="left-col-content">pandas installed for full DataFrame paths, and uninstalled to verify fallback shims.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- Modern browser (Chrome/Firefox) to exercise <code>script.toc.js</code> and worker behaviors.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-content">- Run with <code>embed_assets=True</code> and <code>False</code> for both asset modes.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Memory State:</strong> I have recorded the session state and file contents in this conversation. If you want, I can now produce: (A) a runnable unit test file for the verification steps, (B) a small patch to <code>script.toc.js</code> to fully disable label fetch attempts, or (C) a small front-end snippet to merge caption payload chunks — pick one and I will produce it immediately.</div></div></td></tr></tbody></table></div><div class="row-count">Rows: 76</div></div><div class="table-caption" id="Table3" data-table="Docu_0130_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by File" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Influence on Caption" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Influence on Caption</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Revision Needed?" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Revision Needed?</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Reason" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Reason</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-heading"><strong>core_renderer.py</strong></div></div></td><td data-label="Influence on Caption"> None (pure static HTML)      </td><td data-label="Revision Needed?"> Possibly later         </td><td data-label="Reason"> Stable and deterministic; no dynamic DOM.                                       </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-heading"><strong>core_fragments.py</strong></div></div></td><td data-label="Influence on Caption"> None (static fragments)      </td><td data-label="Revision Needed?"> No                     </td><td data-label="Reason"> Emits static <code>&lt;h3&gt;Table X&gt;</code>; no flicker.                                        </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-heading"><strong>convert.py</strong></div></div></td><td data-label="Influence on Caption"> None (format conversion)     </td><td data-label="Revision Needed?"> No                     </td><td data-label="Reason"> Does not touch caption behavior.                                                </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-heading"><strong>script.toc.js</strong></div></div></td><td data-label="Influence on Caption"> Only scroll behavior         </td><td data-label="Revision Needed?"> Maybe later            </td><td data-label="Reason"> May contribute but not the root cause.                                          </td></tr><tr><td data-label="File"><div class="tv-left-col"><div class="left-col-heading"><strong>script.table.js</strong></div></div></td><td data-label="Influence on Caption"> <strong>YES — heavy DOM mutation</strong> </td><td data-label="Revision Needed?"> <strong>Needs revision now</strong> </td><td data-label="Reason"> Contains multiple reflow triggers + container rewrites + layout recalculations. </td></tr></tbody></table></div><div class="row-count">Rows: 5</div></div><div class="table-caption" id="Table4" data-table="Docu_0130_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Item**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Item</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Change (what)" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change (what)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Why / Risk / Verification**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Why / Risk / Verification</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Rollout steps (safe, reversible)" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Rollout steps (safe, reversible)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>1. Preserve public API</strong></div></div></td><td data-label="Change (what)"> <strong>No renames</strong>; preserve all public functions/signatures.  </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Prevent breaking callers.<br/><strong>Risk:</strong> High if signatures change.<br/><strong>Verification:</strong> Grep for symbols; unit tests cover API.                                 </td><td data-label="Rollout steps (safe, reversible)"> Implement changes behind same functions; run tests; deploy. </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>2. Deterministic tokenization &amp; normalization</strong></div></div></td><td data-label="Change (what)"> Single unified <code>tokenize()</code> used everywhere.               </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Prevent index/query mismatch.<br/><strong>Risk:</strong> Regex changes alter recall; keep legacy rules.<br/><strong>Verification:</strong> Same input → same tokens; compare token counts. </td><td data-label="Rollout steps (safe, reversible)"> Add tests; replace code; preserve legacy handling.          </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>3. Stable postings representation</strong></div></div></td><td data-label="Change (what)"> Keep arrays; add optional metadata.                        </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Faster ops without breaking semantics.<br/><strong>Risk:</strong> Typed arrays may break consumers.<br/><strong>Verification:</strong> <code>Array.isArray</code> true; <code>.slice()</code> works.             </td><td data-label="Rollout steps (safe, reversible)"> Add metadata without altering array type.                   </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>4. Faster retrieval + LRU cache</strong></div></div></td><td data-label="Change (what)"> Improve keying, TTL, store copies.                         </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Reduce repeated work.<br/><strong>Risk:</strong> Cache may mask index updates.<br/><strong>Verification:</strong> Repeated queries faster; copied results confirmed.                       </td><td data-label="Rollout steps (safe, reversible)"> Add tests; keep size small; clear-cache hook.               </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>5. Better multi-token intersection</strong></div></div></td><td data-label="Change (what)"> Hash for small; merge for medium; configurable thresholds. </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Balance speed/memory.<br/><strong>Risk:</strong> Thresholds affect recall/speed.<br/><strong>Verification:</strong> Synthetic tests confirm correctness/order.                             </td><td data-label="Rollout steps (safe, reversible)"> Add tests; expose thresholds in <code>opts</code>.                     </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>6. Quoted phrase support</strong></div></div></td><td data-label="Change (what)"> Quoted queries trigger phrase scan first.                  </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Users expect phrase priority.<br/><strong>Risk:</strong> Full-scan expensive; must bound.<br/><strong>Verification:</strong> Phrase matches only when present; perf tested.                </td><td data-label="Rollout steps (safe, reversible)"> Add phrase path; bound candidates; optional flag.           </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>7. Prefix matching for short tokens</strong></div></div></td><td data-label="Change (what)"> Treat 3–6 char tokens as prefixes; scan vocab with caps.   </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Better partial-query UX.<br/><strong>Risk:</strong> Vocab scan may be O(V); cap required.<br/><strong>Verification:</strong> Prefix-only matches; large-vocab stress test.                 </td><td data-label="Rollout steps (safe, reversible)"> Cap keys and candidates.                                    </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>8. Trigram scoring tuning</strong></div></div></td><td data-label="Change (what)"> Normalize by query trigram count; weight configurable.     </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> More robust fuzzy ranking.<br/><strong>Risk:</strong> Ranking shifts.<br/><strong>Verification:</strong> A/B test; ensure no regressions.                                                  </td><td data-label="Rollout steps (safe, reversible)"> Configurable weight; default preserves old behavior.        </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>9. Levenshtein (cheapDL) bounds</strong></div></div></td><td data-label="Change (what)"> Only for ≤6-char tokens; cap cost; small boost.            </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Avoid expensive DL work.<br/><strong>Risk:</strong> DL too slow if overused.<br/><strong>Verification:</strong> DL run count &lt; threshold; profiling checks.                                </td><td data-label="Rollout steps (safe, reversible)"> Add debug counters; keep worker scoring unchanged.          </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>10. Worker offload</strong></div></div></td><td data-label="Change (what)"> Improve handshake; timeout fallback.                       </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Maintain UI responsiveness.<br/><strong>Risk:</strong> Timeout must not affect results.<br/><strong>Verification:</strong> Test with/without worker; forced timeout fallback.              </td><td data-label="Rollout steps (safe, reversible)"> Add robust timeout/fallback.                                </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>11. Query complexity guard</strong></div></div></td><td data-label="Change (what)"> Cap results when postings huge; show refine message.       </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Prevent worst-case O(N).<br/><strong>Risk:</strong> Might hide matches.<br/><strong>Verification:</strong> Stress tests; confirm UI messaging.                                             </td><td data-label="Rollout steps (safe, reversible)"> Conservative guard; debug metric.                           </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>12. Deterministic ordering</strong></div></div></td><td data-label="Change (what)"> Sort candidate indices before scoring.                     </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Stable output.<br/><strong>Risk:</strong> Only tie-break changes.<br/><strong>Verification:</strong> Repeated queries identical.                                                           </td><td data-label="Rollout steps (safe, reversible)"> Add sort step.                                              </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>13. Monitoring &amp; debug hooks</strong></div></div></td><td data-label="Change (what)"> Add debug-only metrics.                                    </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Safe tuning.<br/><strong>Risk:</strong> None if disabled.<br/><strong>Verification:</strong> Enable DEBUG; inspect logs.                                                                   </td><td data-label="Rollout steps (safe, reversible)"> Wrap logs in debug checks.                                  </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>14. Tests</strong></div></div></td><td data-label="Change (what)"> Add unit, integration, perf tests.                         </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Ensure correctness.<br/><strong>Risk:</strong> Maintenance cost.<br/><strong>Verification:</strong> Stable outputs on mock corpus.                                                         </td><td data-label="Rollout steps (safe, reversible)"> Run tests; add CI.                                          </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>15. Backout plan &amp; flags</strong></div></div></td><td data-label="Change (what)"> Feature flags to revert behaviors.                         </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Fast rollback.<br/><strong>Risk:</strong> Too many flags complicate code.<br/><strong>Verification:</strong> Test toggles.                                                                 </td><td data-label="Rollout steps (safe, reversible)"> Document flags; expose in opts.                             </td></tr><tr><td data-label="Item"><div class="tv-left-col"><div class="left-col-heading"><strong>16. Code review checklist</strong></div></div></td><td data-label="Change (what)"> 10-item safety checklist.                                  </td><td data-label="Why / Risk / Verification"> <strong>Why:</strong> Guarantee safety.<br/><strong>Risk:</strong> n/a.<br/><strong>Verification:</strong> Checklist completed.                                                                                  </td><td data-label="Rollout steps (safe, reversible)"> Reviewer signs off.                                         </td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><div class="table-caption" id="Table5" data-table="Docu_0130_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Enhancement" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Enhancement</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Goal: Modernize and accelerate the search pipeline in script.list.js without breaking public APIs, output shape, worker protocol, client expectations, or UI event flow. All new behaviors must be opt-in, reversible, deterministic, and safe under legacy callers.</strong></div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Revised Files:</strong> assets/script.list.js only (possible minimal helper additions in assets/extra.js if needed, but optional).</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Key Changes (Planned):</strong> Unified deterministic tokenizer replaces scattered regex logic; postings lists remain arrays with optional metadata sidecar; improved multi-token intersection algorithm based on adaptive strategy (hash/merge); LRU caching with TTL and copy-on-read; bounded phrase scan for quoted queries; prefix matching with vocabulary caps; trigram score normalization aligned with query length; cheapDL (Levenshtein lite) bounded and rate-limited; worker handshake stabilized with timeout fallback; complexity guard for huge postings; deterministic ordering via sorted index lists; optional DEBUG hooks; feature flags for instant rollback.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Unchanged Behavior:</strong> Public functions (e.g., buildIndex, runQuery, tokenizeQuery, score, postMessage payloads) remain unchanged. Returned result shape identical: same fields, same order semantics, same worker channels. Rendering layer, UI highlight logic, and keyboard navigation untouched. Legacy token rules preserved unless flags enabled. No API renames, removals, or event changes.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>User Requirements:</strong> Preserve all current UI behavior. Improve precision and recall only where backward-compatible. Search must remain instantaneous under 5k–30k items. Worker offload must remain optional and transparent. No server dependency. Must not break index rebuilds or dynamic list updates.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Assumptions:</strong> Vocabulary size: small–medium (≤20k). Items typically &lt;200 chars. Workers supported in browser. script.list.js is the sole source of search logic; other scripts do not mutate its index. User expects substring, fuzzy, trigram, and token match behavior to stay stable.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Detailed Change Notes:</strong> <br/>• Tokenizer: normalize case, remove unstable regex branches, enforce stable splitting, and guarantee same tokens for index/query.<br/>• Postings: retain arrays; metadata added in parallel map only, never altering array type.<br/>• Intersection: thresholds configurable; hash intersection for very small sets, sorted merge for medium/large.<br/>• LRU Cache: keyed by normalized query; values deep-copied; invalidated on index rebuild.<br/>• Phrase search: triggered only if query contains quotes; candidate set bounded.<br/>• Prefix match: only for tokens 3–6 chars; vocab scan capped (e.g., max 300 keys).<br/>• Fuzzy: trigram counts normalized; cheapDL capped by length and cost.<br/>• Complexity guard: drop result set &gt;N with refine message.<br/>• Deterministic order: sort candidates before scoring.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Remaining Risks:</strong> Prefix vocabulary scan could degrade performance if cap misconfigured. Phrase scan may inflate CPU if candidate bounding incorrect. LRU caching may mask index updates if invalidate hook not triggered. Sorting step adds overhead but expected negligible. Scoring adjustments may reorder borderline matches.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Verification Steps:</strong> Unit tests for tokenize() consistency; regression tests comparing old vs new results; ensure same output with feature flags disabled. Stress test with worst-case long tokens and large lists. Validate worker timeout fallback forces direct execution. Confirm all returned data structures remain identical to legacy version. Check determinism by running the same query repeatedly.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Future Upgrade Options:</strong> Adaptive ML-based ranking; synonym expansion; Unicode-aware normalization; GPU/WebGL accelerated trigram scoring; batched worker pipelines; persistent caching across sessions.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Integration with Client:</strong> No UI changes required. Keydown navigation, highlight rendering, and item selection unaffected. Worker messages maintain identical structure (cmd, payload). No changes to index build events. Prefix and phrase features are compatible with existing list rendering logic.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Integration with Utils / Other Scripts:</strong> None required. script.core.js, script.table.js, script.toc.js remain unaware of search logic. Worker.js unchanged except optional timeout tuning. No cross-file dependencies added.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Security / Stability:</strong> All new features bounded to avoid O(N²) behaviors. Complexity guard prevents extreme posting scans. Worker timeout protects UI thread. No new data stored persistently. No user-supplied regex or injection paths added.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Audit / Logging:</strong> Optional DEBUG hooks provide timings, hit counts, cache stats, intersection strategy selection, phrase-scan counts, and DL usage counters. All disabled in production.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Cross-check Validation:</strong> Public API untouched. No renamed functions. tokenize() deterministic. Sorted deterministic results. Cache invalidation triggered on index rebuild. Prefix and phrase paths guarded and bounded. Feature flags allow full rollback. Behavior fully compatible with legacy client.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Performance:</strong> Expected 1.5–3× speed improvement for multi-token queries. LRU caching improves repeated queries by &gt;10×. Prefix scan capped to avoid worst-case O(V). cheapDL bounded so it never dominates CPU. Worker fallback ensures UI responsiveness under heavy load.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Maintenance:</strong> Keep thresholds configurable. Document feature flags. Update test corpus periodically. Track vocabulary growth. Re-profile when list size &gt;30k.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Verification Environment:</strong> Browser ES6+, Windows/macOS/Linux, worker enabled or disabled, list size tests 1k–20k.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Final Assessment:</strong> Enhancement plan is safe, reversible, API-preserving, and production-ready. All changes encapsulated inside script.list.js with opt-in flags and deterministic behavior. No other components require modification.</div></div></td></tr></tbody></table></div><div class="row-count">Rows: 19</div></div><div class="table-caption" id="Table6" data-table="Docu_0130_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Enhancement" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Enhancement</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Goal:</strong> Modernize and accelerate the search pipeline in <code>script.list.js</code> while preserving <em>all</em> public APIs, event flow, worker protocol, and UI behavior. All changes must be opt-in, reversible, deterministic, and safe for legacy callers.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Revised Files:</strong> <code>assets/script.list.js</code> only. (Optional tiny helpers in <code>assets/extra.js</code> <em>only if</em> a small shared util is needed; avoid otherwise.)</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Summary of Key Changes:</strong> Unified deterministic tokenizer; postings remain plain <code>Array</code> objects with an adjacent metadata sidecar; adaptive multi-token intersection (hash for small, merge for large) with configurable thresholds; LRU query cache with TTL and copy-on-read; bounded phrase scan for quoted queries; prefix matching for 3–6 char tokens with capped vocab scan; trigram scoring normalized by query trigram count; cheapDL (Levenshtein-lite) limited to short tokens and capped candidate sets; robust worker handshake with timeout + main-thread fallback; complexity guard to prevent pathological O(N) behavior; deterministic ordering of candidate indices prior to scoring; debug hooks disabled by default; feature flags and rebuild/invalidate hooks for safe rollback.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Public API &amp; Backwards Compatibility (explicit):</strong> No function renames or signature changes. Functions / global symbols preserved: <code>attachListHandler</code>, <code>buildAndPresent</code>, <code>presentGroupsOnly</code>, <code>loadFilesSequentialAndHideForm</code>, <code>fetchFileWithTimeout</code>, <code>trySendActiveGroupMetadata</code>, <code>createFileSearchEngine</code> (returns <code>{ candidatesForQuery, scoreFiles, lite, dispose }</code>). Worker messages maintain same <code>cmd</code>/<code>payload</code> contract. Event <code>ptt:groupLoaded</code> still dispatched (unchanged shape). All return shapes remain identical.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Feature Flags &amp; Tunables (default-safe):</strong> All advanced behaviors behind flags / <code>opts</code> with conservative defaults: <code>ENABLE_INVERTED_INDEX</code> (true), <code>ENABLE_WORKER_SCORING</code> (true), <code>ENABLE_CACHE_BUSTER</code> (false). Tunables exposed inside engine opts: <code>maxPostings</code>, <code>maxCandidates</code>, <code>intersectionHashThreshold</code>, <code>phraseBound</code>, <code>prefixScanLimit</code>, <code>prefixCandidateLimit</code>, <code>trigramWeight</code>, <code>cheapDLMaxLen</code>, <code>queryCacheSize</code>, <code>cacheTTLMs</code>, <code>complexityLimit</code>, <code>cheapDLCandidateCap</code>. Defaults chosen to preserve prior behavior.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Determinism &amp; Ordering:</strong> Candidate index arrays are sorted deterministically before scoring. Scoring sort has stable tie-breakers (score → groupIdx → fileIndex → name → original idx). Cache returns deep copies. Index rebuild invalidates cache.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Performance Expectations:</strong> Typical multi-token queries: 1.5–3× faster; repeated queries: &gt;10× faster via LRU. Prefix scans and phrase scans bounded to avoid worst case. CheapDL is gated to short queries and small candidate pools to avoid domination of CPU. Worker fallback ensures UI thread safe under heavy load.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Testing &amp; Verification (must run prior to deploy) — execute each check in order</strong>: <br/>1. <strong>Unit — <code>tokenize()</code></strong>: create seed inputs (including punctuation, diacritics, mixed case, underscores, dashes, numbers, leading/trailing whitespace). Build index tokens and query tokens using same <code>tokenize()</code> implementation; assert arrays equal for each seed. Edge cases: empty string, only punctuation, very long token (≥256 chars).<br/>2. <strong>Regression tests (flags disabled)</strong>: run representative query suite (short tokens, multi-token, quoted phrases, prefixes, fuzzy cases) against legacy engine and new engine with all new-feature flags OFF; assert identical candidate sets and ordering. Use deterministic random seed for any sampling.<br/>3. <strong>Opt-in feature validation</strong>: enable features one-by-one (cache, adaptive intersection, prefix scan, phrase scan, trigram normalization, cheapDL) and measure precision/recall delta vs. legacy on labeled corpus; confirm delta within acceptable bound (define threshold, e.g., F1 change ≤ 3%). Log differences for review.<br/>4. <strong>Worker protocol tests</strong>: spin up worker; send normal <code>score</code>/<code>candidates</code> messages; assert worker responds within <code>WORKER_TIMEOUT_MS</code>. Simulate worker hang/throw — confirm timeout triggers main-thread fallback scoring with identical results. Test worker disabled path.<br/>5. <strong>Stress tests (latency &amp; memory)</strong>: datasets at 1k, 5k, 10k items; worst-case tokens (very long, repeated, high-token overlap). Measure median and p95 latency for <code>candidatesForQuery</code> and <code>scoreFiles</code>. Memory profiling for peak JS heap. Verify within target budgets (define based on environment).<br/>6. <strong>Complexity guard tests</strong>: create very common token that returns massive postings; ensure guard triggers (returns bounded candidate set and UI-refine signal) and does not freeze main thread. Confirm guard metric instrumentation records event.<br/>7. <strong>Determinism</strong>: run same query 100x in same session and after index rebuild; confirm identical candidate ordering and stable scoring tie-breaks. Repeat across different browsers if possible. <br/>8. <strong>Cache invalidation</strong>: build index → query (cache hit) → call <code>rebuildIndex()</code> or trigger index mutation → verify previously cached queries are invalidated (cache miss) or TTL expires. Test <code>clearQueryCache()</code> hook. <br/>9. <strong>UI integration (end-to-end)</strong>: open modal, perform searches including quoted phrases and prefixes, load a group → ensure <code>ptt:groupLoaded</code> fires with unchanged event detail; ensure <code>loadFilesSequentialAndHideForm</code> behavior and paste area population unchanged. <br/>10. <strong>Fuzzy / phrase / prefix correctness</strong>: quoted queries return phrase-containing candidates only (within bounded candidate set); prefix queries (3–6 chars) match by prefix across name/caption tokens within configured caps; cheapDL only applied for ≤6-char tokens and limited candidate pools; log counts of DL invocations and verify under threshold.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Rollout Steps (safe &amp; reversible)</strong>: <br/>1. Implement changes behind feature flags with conservative defaults. <br/>2. Deploy to staging. <br/>3. Run full verification checklist (above) in staging and collect metrics. <br/>4. Enable DEBUG and runtime METRICS to capture cache hits, intersection strategy, DL invocations, phraseScanCount for a sampling period. <br/>5. Gradually enable features in production one at a time (cache → intersection → prefix → phrase → cheapDL), monitoring metrics and user-reported regressions. <br/>6. If any regression appears, flip corresponding flag to revert immediately. Keep legacy path reachable via <code>window.__ptt_search_disable_new = true</code>. <br/>7. After stable run, consider promoting some tunables from flags to defaults.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Backout Plan</strong>: Feature flags allow immediate rollback. Provide <code>clearQueryCache()</code> and <code>rebuildIndex()</code> dev hooks. Provide a global override <code>window.__ptt_search_disable_new = true</code> to force legacy engine at runtime. Keep previous engine code path intact and reachable until final sign-off. Document how to revert in one step.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Security / Stability Considerations</strong>: No persistent storage added. No user-supplied regex or dynamic code execution. Complexity guard prevents pathological scans; worker timeout prevents UI lock. All network I/O remains same-origin and respects credentials. Limits and caps prevent memory blow-up.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Remaining Risks &amp; Mitigations</strong>: <br/>• <strong>Prefix vocab scan cost</strong> — mitigate by <code>prefixScanLimit</code> and <code>prefixCandidateLimit</code>; tune downward if staging shows CPU spike. <br/>• <strong>Phrase scan CPU</strong> — mitigate by <code>phraseBound</code> (max candidates to phrase-scan); enable only if phraseBound affordable. <br/>• <strong>Cache masking index updates</strong> — always invalidate cache on index rebuild; use short TTL (default 5 minutes) and provide manual hooks. <br/>• <strong>Scoring reorder</strong> — scoring weights are tunable; default weights set to preserve legacy ordering; run A/B if needed.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Monitoring &amp; Debugging</strong>: Optional <code>DEBUG</code>/<code>METRICS</code> mode (disabled by default) exposes: per-query latency, candidate counts, cache hit/miss, intersection strategy used, DL invocation count, phraseScanCount, complexity guard triggers. Emit only when <code>DEBUG===true</code>. Provide lightweight counters and <code>window.__ptt_stats()</code> dump for ad-hoc inspection.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Cross-check Validation (explicit)</strong>: Confirmed in plan: (a) Tokenization deterministic and shared between index &amp; query. (b) Postings remain plain arrays (Array.isArray true). (c) Cache returns deep copies and is invalidated on rebuild. (d) Worker message schema unchanged and fallback covers worker failure. (e) <code>ptt:groupLoaded</code> event detail unchanged. (f) Public function names &amp; signatures unchanged (<code>createFileSearchEngine</code> returns same API). (g) Deterministic sorting applied before scoring.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Verification Environment</strong>: Modern browsers (Chrome/Firefox/Edge/Safari) ES6+, worker enabled/disabled, OS: Windows/macOS/Linux. Test corpora: small (1k), medium (5k), upper recommended (≤20k). Re-profile for &gt;30k item lists; tune thresholds accordingly.</div></div></td></tr><tr><td data-label="Enhancement"><div class="tv-left-col"><div class="left-col-heading"><strong>Final Assessment &amp; Next Action</strong>: Plan and verification checklist ready. Execute the checklist in staging prior to production enablement. If you want, I will now implement the single-file patch for <code>assets/script.list.js</code> with the feature flags, metrics hooks, and the above test hooks included as comments and dev functions.</div></div></td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>