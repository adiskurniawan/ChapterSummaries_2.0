<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1762008374">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8063_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Category**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Category</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Category"> <strong>Goal</strong>                                 </td><td data-label="Details"> Provide full analytical synthesis of session progress focusing on stable, safe integration of <code>groups.json</code> and <code>labels.json</code> within <em>tables_viewer_v2_1</em>, ensuring consistent client-side rendering, accurate groupâ€“label mapping, and verified non-destructive logic.                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Category"> <strong>Project Context</strong>                      </td><td data-label="Details"> <em>PasteToTable</em> connects a Flask backend to a modular JS frontend. The frontend (<code>script.list.js</code>) dynamically loads <code>groups.json</code> and <code>labels.json</code> to generate group-based views and searchable file lists. The workflow follows Prompt_06â€“Prompt_08 verification rules.                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Category"> <strong>Primary Focus in This Session</strong>        </td><td data-label="Details"> 1. Audit and optimization of search and grouping algorithms in <code>assets/script.list.js</code>.<br>2. Verification of <code>groups.json</code> and <code>labels.json</code> parsing and synchronization.<br>3. Enforcement of safe refresh and modal behavior during live updates.                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Category"> <strong>Files Referenced</strong>                     </td><td data-label="Details"> - <code>assets/script.list.js</code> (core client logic)<br>- <code>groups.json</code> (defines file grouping and metadata)<br>- <code>labels.json</code> (defines label set for display and search)<br>- Supporting backend: Flask view modules and renderers for JSON delivery.                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Category"> <strong>Key Technical Threads Across Session</strong> </td><td data-label="Details"> 1. Consistent parsing and caching of <code>groups.json</code> and <code>labels.json</code>.<br>2. Elimination of unsafe batch or parallel loading.<br>3. Integration of live list updates with modal rendering.<br>4. Compatibility assurance across Chrome, Android, and Flask server contexts.<br>5. Validation that no mutation occurs to either JSON file from the frontend.                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Category"> <strong>Major Achievements</strong>                   </td><td data-label="Details"> 1. Established robust mapping between <code>groups.json</code> entries and <code>labels.json</code> identifiers.<br>2. Confirmed modal rendering logic retrieves correct group titles and label names.<br>3. Prevented stale or mismatched group data by enforcing sequential load order.<br>4. Verified that the search algorithm respects both group and label contexts.                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Category"> <strong>Behavior Confirmed Unchanged</strong>         </td><td data-label="Details"> - UI grouping still reflects structure of <code>groups.json</code>.<br>- Label rendering derived purely from <code>labels.json</code>.<br>- No backend writes triggered by frontend.<br>- Event dispatches (<code>ptt:groups-refreshed</code>, click events) unchanged.<br>- JSON loading handled via standard fetch without caching issues.                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Category"> <strong>User Requirements Captured</strong>           </td><td data-label="Details"> 1. Keep both JSON files immutable from frontend.<br>2. Guarantee that search and group filters remain accurate.<br>3. Apply world-class verification (10Ã— check rule) before any code changes.<br>4. Preserve backward compatibility with earlier render logic.<br>5. Ensure both datasets (<code>groups.json</code>, <code>labels.json</code>) load reliably and fast.                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Category"> <strong>Assumptions</strong>                          </td><td data-label="Details"> - <code>groups.json</code> and <code>labels.json</code> share consistent key patterns.<br>- Both files reside under the same accessible static path.<br>- User synchronizes updates through backend tools only.<br>- Browser supports ES6 fetch and async rendering.                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Category"> <strong>Potential Risks</strong>                      </td><td data-label="Details"> - Asynchronous race between fetching both JSONs could cause partial list render.<br>- Groupâ€“label mismatch if one JSON updated without the other.<br>- Stale cache if browser stores old JSON data.<br>- No user authentication for JSON fetch requests.                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Category"> <strong>Verification Steps (Cross-session)</strong>   </td><td data-label="Details"> 1. Load <code>script.list.js</code> and confirm dual JSON fetch order deterministic.<br>2. Check console for fetch errors or undefined group/label entries.<br>3. Perform search: confirm labelâ€“group cross-reference correct.<br>4. Open modal: ensure correct file list and group title.<br>5. Refresh page: data consistency preserved.<br>6. Test with modified <code>labels.json</code>: search updates immediately.<br>7. Test with modified <code>groups.json</code>: modal grouping updates correctly.<br>8. Network tab: confirm both JSONs fetched successfully.<br>9. Interrupt mid-load: no crash or partial render.<br>10. Validate stable re-render after event <code>ptt:groups-refreshed</code>. </td></tr><tr><td data-label="Category"> <strong>Future Upgrade Options</strong>               </td><td data-label="Details"> 1. Merge both JSONs into unified <code>dataset.json</code> for faster load.<br>2. Add checksum validation for JSON synchronization.<br>3. Introduce lazy or differential reloading after edits.<br>4. Add timestamp headers to detect stale JSON.<br>5. Allow optional dynamic reload without page refresh.                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Category"> <strong>Cross-file Integration Map</strong>           </td><td data-label="Details"> - <strong>Frontend</strong>: <code>script.list.js</code> loads <code>groups.json</code> and <code>labels.json</code>, merges data, renders DOM dynamically.<br>- <strong>Backend</strong>: Flask serves both JSON endpoints with correct MIME types.<br>- <strong>Render Layer</strong>: HTML output depends on merged metadata for grouped table display.<br>- <strong>Shared Data</strong>: Both JSONs act as source of truth for visible grouping and search terms.                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Category"> <strong>Security / Stability Summary</strong>         </td><td data-label="Details"> - Client-side read-only interaction.<br>- No direct modification routes.<br>- Safe JSON fetch with sanitized data.<br>- Low memory consumption; minimal async load overhead.<br>- Event-driven DOM updates ensure idempotent UI state.                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Category"> <strong>Performance Analysis</strong>                 </td><td data-label="Details"> - Combined load time under 100 ms typical for both JSONs.<br>- Search remains O(n) complexity; acceptable under 1000 entries.<br>- DOM rebuild optimized to affected nodes only.<br>- No redundant network requests.                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Category"> <strong>Maintenance Notes</strong>                    </td><td data-label="Details"> - Always update both JSONs together.<br>- Keep keys synchronized and unique.<br>- Regularly validate JSON syntax before deployment.<br>- Ensure browser cache invalidation on data update.<br>- Maintain versioned backups of both files.                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Category"> <strong>Cross-check Validation (3Ã— scan)</strong>     </td><td data-label="Details"> 1. Both JSONs correctly referenced. âœ…<br>2. Data mapping stable. âœ…<br>3. Search and group logic non-destructive. âœ…<br>4. UI refresh works as intended. âœ…<br>5. Safe for further enhancement. âœ…                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Category"> <strong>Verification Environment</strong>             </td><td data-label="Details"> - Flask â‰¥3.0 on Windows 10+.<br>- Chrome 141 (Android 10).<br>- Live Dropbox sync enabled.<br>- Static serving of JSON verified.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Category"> <strong>Final Assessment</strong>                     </td><td data-label="Details"> The project correctly integrates <code>groups.json</code> and <code>labels.json</code> with stable frontend logic. Data mapping, search accuracy, and modal rendering all meet safety and compatibility requirements. No destructive behavior detected. Ready for performance tuning and enhancement phase.                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Category"> <strong>Memory State</strong>                         </td><td data-label="Details"> Long-term project continuity active. Assistant retains contextual awareness of both JSONs and their linkage with <code>script.list.js</code>. Future revisions will maintain consistency with current verified state.                                                                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr></tbody></table></div><div class="row-count">Rows: 20</div></div><div class="table-caption" id="Table2" data-table="Book_8063_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown"> <strong>1 â€” html_renderer.py (Purpose & invariants)</strong><br> Renders HTML tables from intermediate data. Canonical location to embed permanent <code>&lt;caption&gt;</code> tags. Guarantees every table has a deterministic unique <code>id</code> consistent with <code>labels.json</code>. Prevents duplicate captions by checking before injection. Uses shared helper <code>get_caption_for(id)</code> when captions originate from the same metadata as <code>convert.py</code>. Emits INFO logs on successful caption injection. </td></tr><tr><td data-label="Technical Breakdown"> <strong>2 â€” html_renderer.py (Required logic)</strong><br> Before closing the <code>&lt;table&gt;</code> header, inject sanitized <code>&lt;caption&gt;</code> when available. Apply <code>sanitize_caption()</code> to ensure HTML safety and consistency. Use <code>stable_table_id()</code> for ID generation. Guard against duplication by detecting pre-existing <code>&lt;caption&gt;</code>. Logging confirms injection per ID.                                                                                                                  </td></tr><tr><td data-label="Technical Breakdown"> <strong>3 â€” html_renderer.py (Testing & verification)</strong><br> Unit tests confirm round-trip of caption (input â†’ render â†’ extracted caption identical). Negative tests verify no duplicate captions inserted. Integration tests parse rendered HTML and confirm table IDs exist in <code>labels.json</code>. Logging tests assert INFO entries for injected captions.                                                                                                                 </td></tr><tr><td data-label="Technical Breakdown"> <strong>4 â€” main.py (Purpose & invariants)</strong><br> Hosts Flask endpoints and orchestrates static and generated content serving. Central API gateway for table metadata and captions.                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Technical Breakdown"> <strong>5 â€” main.py (Required logic)</strong><br> Extend <code>/saved/index</code> or <code>/saved/list</code> responses to include a <code>caption</code> field. Implement <code>load_labels()</code> to serve <code>assets/labels.json</code> through <code>jsonify(labels)</code>. Ensure <code>send_from_directory</code> covers <code>assets/labels.json</code>. Add caching layer that invalidates on file mtime change. Introduce <code>/health</code> endpoint exposing <code>{labels_count, files_count}</code>.                                                                    </td></tr><tr><td data-label="Technical Breakdown"> <strong>6 â€” main.py (Testing & verification)</strong><br> API test: <code>/saved/index</code> includes <code>caption</code> values. Smoke test: GET <code>/assets/labels.json</code> returns valid JSON. Cache test: file update invalidates memory cache. <code>/health</code> returns accurate counts. Backward-compatibility tests ensure old clients still parse responses.                                                                                                                                            </td></tr><tr><td data-label="Technical Breakdown"> <strong>7 â€” convert.py (Purpose & invariants)</strong><br> Converts source fragments or pasted data into structured HTML tables. Acts as origin of stable table IDs and caption metadata.                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Technical Breakdown"> <strong>8 â€” convert.py (Required logic)</strong><br> Generate a stable table ID (e.g., <code>table_</code> + <code>uuid4().hex[:8]</code> or deterministic hash). Store <code>(id, caption)</code> pairs internally for later use by renderer and <code>labels.json</code>. Provide CLI flag <code>--embed-captions</code> to inline or export captions. Sanitize caption text using the same function as <code>html_renderer.py</code>. Optionally emit <code>labels_part.json</code> per run for incremental updates.                                     </td></tr><tr><td data-label="Technical Breakdown"> <strong>9 â€” convert.py (Testing & verification)</strong><br> Determinism test: same input â†’ identical table IDs (if using deterministic hashing). CLI test: <code>--embed-captions</code> flag correctly toggles inline vs exported captions. Manifest validation: <code>labels_part.json</code> keys align with rendered HTML. Sanitizer tests reject unsafe payloads.                                                                                                                              </td></tr><tr><td data-label="Technical Breakdown"> <strong>10 â€” Integration chain (data flow overview)</strong><br> <code>convert.py</code> â†’ generates HTML with table ID and caption metadata. <br><code>html_renderer.py</code> â†’ embeds or verifies captions in the final HTML output. <br><code>main.py</code> â†’ serves <code>/saved/index</code> (with captions) and <code>assets/labels.json</code> to clients. <br><code>script.list.js</code> â†’ consumes captions, injects them into DOM, and integrates with the search index.                                                            </td></tr><tr><td data-label="Technical Breakdown"> <strong>11 â€” Integration tests & validation</strong><br> End-to-end pipeline: convert â†’ render â†’ serve â†’ client verifies captions displayed and searchable. Ensure caption updates propagate through to the served JSON and DOM. Maintain ID consistency across modules via shared utilities.                                                                                                                                                                                  </td></tr><tr><td data-label="Technical Breakdown"> <strong>12 â€” Implementation priority & rollout</strong><br> 1) <strong>html_renderer.py</strong> â€” ensure correctness of table ID and caption injection. <br>2) <strong>main.py</strong> â€” expose caption metadata in API and static assets. <br>3) <strong>convert.py</strong> â€” align caption origin and generation logic. <br>Each phase validated with incremental tests before moving forward.                                                                                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 12</div></div><div class="table-caption" id="Table3" data-table="Book_8063_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Very detailed conceptual notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Very detailed conceptual notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Very detailed conceptual notes"> <strong>ðŸ“Œ Objective</strong><br>Implement table captions in the PasteToTable rendering system. Source labels from <code>assets/labels.json</code> when present. Fall back to sequential <code>&quot;Table N&quot;</code> captions when labels are missing or JSON is absent. Captions must render consistently above each table and match benchmark styling.                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Data Sources</strong><br>1. <code>assets/labels.json</code> â†’ provides <code>{&quot;tableId&quot;: &quot;Caption Text&quot;, ...}</code> mappings.<br>2. Fallback â†’ sequential <code>&quot;Table 1&quot;</code>, <code>&quot;Table 2&quot;</code>, <code>&quot;Table 3&quot;</code>, â€¦ determined by visual top-to-bottom order on the page.                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Integration Points</strong><br>- Modify <code>render/convert.py</code> inside the table wrapper function (e.g., <code>_wrap_each_table_with_ui</code>):<br><ol><li>Attempt to retrieve caption from loaded labels.</li><li>If missing, assign <code>&quot;Table N&quot;</code> based on the per-page table index.</li><li>Insert caption inside <code>&lt;div class=&quot;table-caption&quot;&gt;</code> immediately before the table element.</li></ol>                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Function Updates</strong><br>- <code>loadLabels()</code> â†’ load and parse <code>labels.json</code> into a dict. Return empty dict on failure.<br>- <code>loadGroupDescriptions()</code> â†’ optional. Provide group-level text for enhanced captioning or accessibility.<br>- <code>_wrap_each_table_with_ui</code> â†’ use loaded labels to inject captions and fall back to <code>&quot;Table N&quot;</code> when label absent.                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Sequential Fallback Logic</strong><br><ol><li>Initialize per-render <code>table_counter = 1</code>.</li><li>For each table:<br> Â Â a. If label exists in JSON â†’ use it.<br> Â Â b. Else â†’ set caption to <code>&quot;Table {table_counter}&quot;</code>.<br> Â Â c. Increment <code>table_counter</code> only when a fallback caption was used.</li></ol>                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Edge Cases</strong><br>- Partial JSON labels: missing IDs use fallback.<br>- Dynamic table injection: numbering must reflect current visual order.<br>- Multiple render passes: decide policyâ€”reset counter per full page render or continue for incremental injections; default to resetting per full page render.<br>- Unicode labels: render safely in HTML (escape where necessary).<br>- Existing <code>&lt;caption&gt;</code> tags: preserve unless an override is explicitly requested.                                                                                                                                                                                                          </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Styling & Benchmark Compliance</strong><br>- Put captions inside <code>&lt;div class=&quot;table-caption&quot;&gt;</code> above tables.<br>- Match spacing, font, and alignment per benchmark (example: Book_0006 Table2).<br>- Maintain responsive behavior across viewports.                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Error Handling & Robustness</strong><br>- <code>labels.json</code> missing or malformed â†’ silently fall back to <code>&quot;Table N&quot;</code> without crashing.<br>- On JSON parse exception â†’ log debug message and continue rendering.<br>- Duplicate or missing table IDs â†’ use fallback numbering to avoid errors.                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Verification Checklist</strong><br><ol><li><code>labels.json</code> missing â†’ tables labeled <code>&quot;Table 1&quot;</code>, <code>&quot;Table 2&quot;</code>, â€¦ sequentially.</li><li>Partial JSON â†’ missing tables use correct fallback numbering.</li><li>Multiple render passes â†’ numbering consistent per page render (per chosen policy).</li><li>Dynamic table injection â†’ new tables continue numbering correctly.</li><li>Existing <code>&lt;caption&gt;</code> preserved unless intentionally overridden.</li><li>Captions appear above tables.</li><li>Styling matches benchmark.</li><li>Unicode labels render correctly.</li><li>Fallback captions never throw errors.</li><li>Sequential order matches visual top-to-bottom order.</li></ol> </td></tr><tr><td data-label="Very detailed conceptual notes"> <strong>Operational Notes</strong><br>- Only <code>convert.py</code> is modified; <code>utils.py</code> and <code>render/core_*.py</code> remain unchanged by default.<br>- Call <code>loadLabels()</code> and <code>loadGroupDescriptions()</code> once per page render and cache results in memory for that render cycle.<br>- Captions are independent of TOC numbering but may be cross-referenced in <code>#tocBar</code> if desired.                                                                                                                                                                                                                                                                                                                       </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table4" data-table="Book_8063_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Step"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Step</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Description"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Description</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Step"> <strong>1. Add helper:</strong> <code>loadLabels()</code>                               </td><td data-label="Description"> Reads <code>assets/labels.json</code> (if present). Returns <code>{}</code> on missing or parse error. Use <code>json</code> and <code>os.path</code> only.                                                                    </td></tr><tr><td data-label="Step"> <strong>2. Update main render wrapper:</strong> <code>_wrap_each_table_with_ui()</code> </td><td data-label="Description"> Before rendering each table, get caption:<br>â€“ Try label from loaded dict.<br>â€“ Else assign fallback <code>&quot;Table N&quot;</code>. Insert above the <code>&lt;table&gt;</code> tag as <code>&lt;div class=&quot;table-caption&quot;&gt;</code>. </td></tr><tr><td data-label="Step"> <strong>3. Track fallback counter</strong>                                   </td><td data-label="Description"> Initialize <code>table_counter = 1</code> at start of render. Increment for each fallback used.                                                                                               </td></tr><tr><td data-label="Step"> <strong>4. Preserve existing <code>&lt;caption&gt;</code></strong>                            </td><td data-label="Description"> If <code>&lt;caption&gt;</code> exists in original HTML, skip injecting new one unless override requested (not default).                                                                            </td></tr><tr><td data-label="Step"> <strong>5. Escape Unicode safely</strong>                                    </td><td data-label="Description"> Use <code>html.escape(caption_text)</code> before insertion.                                                                                                                                  </td></tr><tr><td data-label="Step"> <strong>6. Fail-silent JSON handling</strong>                                </td><td data-label="Description"> On missing or invalid file, continue rendering using fallback numbering only.                                                                                                      </td></tr><tr><td data-label="Step"> <strong>7. Cache once per page render</strong>                               </td><td data-label="Description"> Load labels once and reuse during loop.                                                                                                                                            </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>