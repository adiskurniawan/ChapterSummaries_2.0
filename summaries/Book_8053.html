<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761647759">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8053_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Project Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Project Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Project Structure"> PasteToTable<br>├─ main.py<br>├─ server.py<br>├─ html_renderer.py<br>├─ utils.py<br>├─ render<br>│  ├─ <strong>init</strong>.py<br>│  ├─ core_compat.py<br>│  ├─ core_table.py — table-level helpers, render_table wrapper<br>│  ├─ core_assets.py — asset discovery, embedding, copy logic<br>│  ├─ core_io.py — atomic write, tmp dirs, path checks<br>│  ├─ core_utils.py — misc helpers (sanitize, streaming, sri_attr)<br>│  ├─ core_renderer.py<br>│  ├─ core_fragments.py<br>│  ├─ convert.py<br>│  ├─ markdown.py<br>│  ├─ sanitize.py<br>│  ├─ io_utils.py<br>│  ├─ assets.py<br>│  ├─ cli.py<br>│  └─ types.py<br>├─ assets<br>│  ├─ script.core.js<br>│  ├─ script.table.js<br>│  ├─ script.toc.js<br>│  ├─ overrides.css<br>│  ├─ style.css<br>│  ├─ extra.js<br>│  └─ worker.js — optional: future client-side features<br>├─ templates<br>│  └─ index.html<br>└─ saved_tables<br><br>Project structure for PasteToTable:<br><code>render/</code> — core rendering modules for tables, HTML assembly, sanitization, and conversion.<br><code>assets/</code> — CSS, JS, and worker scripts for styling and interactivity.<br><code>templates/</code> — contains the main HTML template for rendering outputs.<br><code>saved_tables/</code> — stores generated tables.<br>Root scripts (<code>main.py</code>, <code>server.py</code>, <code>html_renderer.py</code>, <code>utils.py</code>) coordinate the conversion workflow and backend operations. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table2" data-table="Book_8053_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Plan / Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Plan / Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Plan / Notes"> You want to save Markdown (.md) files from the UI. Current state: server.py already has /convert and /save (HTML), enforcing MAX_PASTE_SIZE with helpers _safe_filename, storage path, and atomic flush. index.html has a visible Save button dispatching ptt:save-request. utils.py, render/core_io.py, main.py, extra.js, and batch logic exist and are suitable.                                                                       </td></tr><tr><td data-label="Plan / Notes"> Approach: edit one file at a time in this order and test after each change. Files to revise (single-file rule): server.py, assets/script.save.js, index.html (minor include), optional utils.py (likely unchanged).                                                                                                                                                                                                                       </td></tr><tr><td data-label="Plan / Notes"> <strong>server.py</strong>: Add POST /save-md endpoint. Accept JSON {markdown, filename} or form data. Enforce MAX_PASTE_SIZE, check len(markdown). Coerce filename with _safe_filename, append .md. Save atomically under STORAGE_PATH. Return JSON {ok, status, path, id} with 200/201. Reuse existing logging and error handling. Keep /save (HTML) unchanged.                                                                                      </td></tr><tr><td data-label="Plan / Notes"> <strong>assets/script.save.js</strong>: Client-side script. On load, register listener for ptt:save-request and #saveBtn click. Read markdown from #paste, fallback to page-area if empty. Prompt for filename if missing, append .md. Optional client-side size check against MAX_PASTE_SIZE. Send POST /save-md via fetch(JSON). Handle response, update #status, optionally download/open saved file. Dispatch ptt:save-response for other scripts. </td></tr><tr><td data-label="Plan / Notes"> <strong>index.html</strong>: Include <script src="assets/script.save.js" defer></script> if not already included. Existing inline save dispatcher works with new script.                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Plan / Notes"> <strong>Implementation details (server)</strong>: Only POST allowed. Enforce content-length and markdown size. Sanitize filename to avoid path traversal. Atomic write. Return proper JSON on success or error (400/413/500). Security headers preserved. Optionally sanitize content but store raw markdown.                                                                                                                                          </td></tr><tr><td data-label="Plan / Notes"> <strong>Implementation details (client)</strong>: Register listener, read markdown, prompt filename, size check, fetch POST JSON, handle server response, update UI, trigger download/open, dispatch event. Graceful fallback and accessibility. Works on Chrome/Firefox/Edge and mobile.                                                                                                                                                              </td></tr><tr><td data-label="Plan / Notes"> <strong>Tests / Verification (Server, 13)</strong>: POST /save-md accepts JSON; >MAX_PASTE_SIZE returns 413; empty markdown 400; filename sanitized and appended with .md; path inside STORAGE_PATH; atomic write; file readable; STORAGE_PATH created if missing; concurrent saves handled; response JSON contains ok, path, id; logging contains actions and errors; GET /saved/<id> works for HTML only; security headers present.                  </td></tr><tr><td data-label="Plan / Notes"> <strong>Tests / Verification (Client, 12)</strong>: Save triggers ptt:save-request; filename prompt appears; prevents >MAX_PASTE_SIZE; #status shows messages; errors displayed; saved path opens/downloads; fallback works; works on all browsers and mobile; accessible; cancelable events honored; no JS console exceptions; works with existing site save scripts.                                                                                 </td></tr><tr><td data-label="Plan / Notes"> <strong>Quick cURL tests</strong>: JSON POST: <code>curl -v -X POST http://127.0.0.1:5000/save-md -H &quot;Content-Type: application/json&quot; -d &#x27;{&quot;markdown&quot;:&quot;# Hello\nThis is a note.&quot;,&quot;filename&quot;:&quot;my-note.md&quot;}&#x27;</code>. Form POST: <code>curl -v -X POST http://127.0.0.1:5000/save-md -F &quot;markdown=@./notes.txt;type=text/plain&quot; -F &quot;filename=my-note.md&quot;</code>.                                                                                                                </td></tr><tr><td data-label="Plan / Notes"> <strong>Acceptance criteria</strong>: Server and client code implemented; Save button triggers new script; saved .md files appear in STORAGE_PATH and retrievable; security and size checks pass; all 25 verification checks succeed.                                                                                                                                                                                                                  </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table3" data-table="Book_8053_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Topic"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Topic</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Enhancement / Behavior"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Enhancement / Behavior</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Acceptance criteria &amp; tests"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Acceptance criteria & tests</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"> Feature summary                </td><td data-label="Enhancement / Behavior"> Add <code>POST /save-md</code> and <code>assets/script.save.js</code>. Minor include in <code>index.html</code>.                                                                                                                                                                                              </td><td data-label="Acceptance criteria &amp; tests"> Endpoint exists; client triggers it; <code>.md</code> files appear in <code>STORAGE_PATH</code>. Unit + integration tests pass.                  </td></tr><tr><td data-label="Topic"> Route                          </td><td data-label="Enhancement / Behavior"> <code>POST /save-md</code> only.                                                                                                                                                                                                                                                        </td><td data-label="Acceptance criteria &amp; tests"> 201 on success; 400/413/415/500 on respective errors. Test HTTP status codes.                                              </td></tr><tr><td data-label="Topic"> Accepted content-types         </td><td data-label="Enhancement / Behavior"> Accept <code>application/json</code>, <code>multipart/form-data</code>, <code>application/x-www-form-urlencoded</code>.                                                                                                                                                                                       </td><td data-label="Acceptance criteria &amp; tests"> 415 on other types. Tests: JSON POST and multipart form POST succeed.                                                      </td></tr><tr><td data-label="Topic"> Required fields                </td><td data-label="Enhancement / Behavior"> <code>markdown</code> required; <code>filename</code> optional.                                                                                                                                                                                                                                    </td><td data-label="Acceptance criteria &amp; tests"> Missing or empty <code>markdown</code> → 400. Test missing and empty cases.                                                           </td></tr><tr><td data-label="Topic"> Size enforcement               </td><td data-label="Enhancement / Behavior"> Enforce <code>MAX_PASTE_SIZE</code> measured as UTF-8 bytes. Check <code>Content-Length</code> if present.                                                                                                                                                                                         </td><td data-label="Acceptance criteria &amp; tests"> <code>Content-Length</code> > limit → 413; actual bytes > limit → 413. Test both header and payload.                                  </td></tr><tr><td data-label="Topic"> Filename sanitization          </td><td data-label="Enhancement / Behavior"> Use <code>_safe_filename()</code>. Append <code>.md</code> if missing. Truncate to max length.                                                                                                                                                                                                     </td><td data-label="Acceptance criteria &amp; tests"> Unsafe names cleaned; <code>.md</code> suffix present. Test <code>../../etc/passwd</code>, special chars, long names.                            </td></tr><tr><td data-label="Topic"> Path traversal defense         </td><td data-label="Enhancement / Behavior"> Resolve final path and verify it starts with <code>os.path.abspath(STORAGE_PATH)</code>.                                                                                                                                                                                                </td><td data-label="Acceptance criteria &amp; tests"> Invalid resolved path → 400 <code>invalid_filename</code>. Test traversal attempt.                                                    </td></tr><tr><td data-label="Topic"> Uniqueness / collisions        </td><td data-label="Enhancement / Behavior"> If target exists append <code>-&lt;uuid&gt;</code> to base name to avoid overwrite.                                                                                                                                                                                                           </td><td data-label="Acceptance criteria &amp; tests"> No file overwritten. Test duplicate save concurrently.                                                                     </td></tr><tr><td data-label="Topic"> Atomic write                   </td><td data-label="Enhancement / Behavior"> Use existing atomic helper or fallback: tempfile in same dir, <code>os.fsync</code>, <code>os.replace</code>.                                                                                                                                                                                      </td><td data-label="Acceptance criteria &amp; tests"> No partial file. Simulate interrupt; verify file is either old or fully written.                                           </td></tr><tr><td data-label="Topic"> Storage location               </td><td data-label="Enhancement / Behavior"> Save under <code>STORAGE_PATH</code>. Create directory if missing.                                                                                                                                                                                                                      </td><td data-label="Acceptance criteria &amp; tests"> <code>STORAGE_PATH</code> auto-created. Test creation and permissions.                                                                </td></tr><tr><td data-label="Topic"> Response schema                </td><td data-label="Enhancement / Behavior"> Success JSON: <code>{ok:true,status:&quot;saved&quot;,id,filename,rel_path,size}</code>. No absolute FS paths.                                                                                                                                                                                    </td><td data-label="Acceptance criteria &amp; tests"> Response keys present and correct types. Tests validate schema.                                                            </td></tr><tr><td data-label="Topic"> Error schema                   </td><td data-label="Enhancement / Behavior"> Error JSON: <code>{ok:false,error:&quot;code&quot;,details?: &quot;...&quot;}.</code>                                                                                                                                                                                                                       </td><td data-label="Acceptance criteria &amp; tests"> Consistent error shapes. Tests for all error cases.                                                                        </td></tr><tr><td data-label="Topic"> Logging                        </td><td data-label="Enhancement / Behavior"> Info on success <code>save-md saved id=... filename=... size=... client=...</code>. Warn on client errors. Error stacktrace on exceptions.                                                                                                                                              </td><td data-label="Acceptance criteria &amp; tests"> Logs contain entries for save attempts. Inspect logs during tests.                                                         </td></tr><tr><td data-label="Topic"> Security (content)             </td><td data-label="Enhancement / Behavior"> Store raw markdown. Do not render server-side. Rendering pipeline must sanitize later.                                                                                                                                                                                       </td><td data-label="Acceptance criteria &amp; tests"> Raw saved; rendering uses <code>render/sanitize.py</code> when converting to HTML. Security audit recommended.                        </td></tr><tr><td data-label="Topic"> Security (surface)             </td><td data-label="Enhancement / Behavior"> Prevent path traversal and dangerous filename chars; do not expose absolute paths.                                                                                                                                                                                           </td><td data-label="Acceptance criteria &amp; tests"> Validate resolved path prefix. Test for path leakage in responses.                                                         </td></tr><tr><td data-label="Topic"> Concurrency                    </td><td data-label="Enhancement / Behavior"> Atomic write + unique suffix.                                                                                                                                                                                                                                                </td><td data-label="Acceptance criteria &amp; tests"> Concurrent saves succeed and create distinct files. Test with parallel clients.                                            </td></tr><tr><td data-label="Topic"> Client script                  </td><td data-label="Enhancement / Behavior"> <code>assets/script.save.js</code> registers events, reads <code>#paste</code> fallback <code>page-area</code>, prompts filename, optional client-side size check, POST JSON, updates <code>#status</code>, dispatch <code>ptt:save-response</code>.                                                                                </td><td data-label="Acceptance criteria &amp; tests"> Save button triggers script; UI updated; events dispatched. Browser tests across Chrome/Firefox/Edge and mobile emulation. </td></tr><tr><td data-label="Topic"> index.html change              </td><td data-label="Enhancement / Behavior"> Add <code>&lt;script src=&quot;assets/script.save.js&quot; defer&gt;&lt;/script&gt;</code> if missing.                                                                                                                                                                                                        </td><td data-label="Acceptance criteria &amp; tests"> Page loads; old save unchanged; new save flow works. Test page load and save interaction.                                  </td></tr><tr><td data-label="Topic"> Response exposure              </td><td data-label="Enhancement / Behavior"> Return <code>rel_path</code> or <code>url</code> only if safe public route exists.                                                                                                                                                                                                                 </td><td data-label="Acceptance criteria &amp; tests"> No absolute FS paths. Tests verify returned values are safe.                                                               </td></tr><tr><td data-label="Topic"> Rate-limit / auth              </td><td data-label="Enhancement / Behavior"> Not implemented here; document need for throttling/auth at project level.                                                                                                                                                                                                    </td><td data-label="Acceptance criteria &amp; tests"> Documented. Security review recommended.                                                                                   </td></tr><tr><td data-label="Topic"> Error handling details         </td><td data-label="Enhancement / Behavior"> 400 bad data, 413 too large, 415 unsupported media, 500 server error.                                                                                                                                                                                                        </td><td data-label="Acceptance criteria &amp; tests"> Tests trigger each and validate JSON and status.                                                                           </td></tr><tr><td data-label="Topic"> cURL examples                  </td><td data-label="Enhancement / Behavior"> Provide JSON and multipart examples for QA.                                                                                                                                                                                                                                  </td><td data-label="Acceptance criteria &amp; tests"> Examples function against a running server. Test via CI or manual QA.                                                      </td></tr><tr><td data-label="Topic"> Rollout strategy               </td><td data-label="Enhancement / Behavior"> One-file edits. Start with <code>server.py</code>. Test. Then <code>assets/script.save.js</code>. Then <code>index.html</code>.                                                                                                                                                                               </td><td data-label="Acceptance criteria &amp; tests"> Each file change passes its tests before moving to next. CI run after each commit.                                         </td></tr><tr><td data-label="Topic"> Backout plan                   </td><td data-label="Enhancement / Behavior"> Remove route and script include to rollback. <code>/save</code> remains unchanged.                                                                                                                                                                                                      </td><td data-label="Acceptance criteria &amp; tests"> Rollback validated by running existing test-suite.                                                                         </td></tr><tr><td data-label="Topic"> Observability                  </td><td data-label="Enhancement / Behavior"> Structured logs; include request id if available; client IP.                                                                                                                                                                                                                 </td><td data-label="Acceptance criteria &amp; tests"> Logs readable and searchable. Tests confirm log lines on save.                                                             </td></tr><tr><td data-label="Topic"> Docs                           </td><td data-label="Enhancement / Behavior"> Add short README section describing endpoint, fields, size limits, cURL examples.                                                                                                                                                                                            </td><td data-label="Acceptance criteria &amp; tests"> README updated and matches implementation. Test docs for accuracy.                                                         </td></tr><tr><td data-label="Topic"> Edge-case rules                </td><td data-label="Enhancement / Behavior"> If filename missing → <code>untitled-&lt;id&gt;.md</code>. If exists → append <code>-&lt;id&gt;</code>. Size measured as bytes. Accept shorter <code>Content-Length</code>.                                                                                                                                               </td><td data-label="Acceptance criteria &amp; tests"> Tests for each explicit edge case.                                                                                         </td></tr><tr><td data-label="Topic"> Tests (server list)            </td><td data-label="Enhancement / Behavior"> 13 server tests: JSON success, multipart success, >limit 413, empty 400, sanitize filename, path inside STORAGE_PATH, atomic write, file readable, STORAGE_PATH created, concurrent saves, response JSON, logs, <code>/save</code> unaffected.                                          </td><td data-label="Acceptance criteria &amp; tests"> All server tests pass in CI.                                                                                               </td></tr><tr><td data-label="Topic"> Tests (client list)            </td><td data-label="Enhancement / Behavior"> 12 client tests: event emitted, prompt works, client-side size prevention, status messages, errors displayed, saved path opens if url provided, fallback works, cross-browser, accessible, cancelable events honored, no console exceptions, coexists with existing scripts. </td><td data-label="Acceptance criteria &amp; tests"> Client automated/browser tests and manual smoke tests pass.                                                                </td></tr><tr><td data-label="Topic"> Implementation errors to avoid </td><td data-label="Enhancement / Behavior"> Returning absolute paths; changing <code>/save</code> behavior; partial writes; allowing traversal.                                                                                                                                                                                     </td><td data-label="Acceptance criteria &amp; tests"> Tests and code review to prevent regressions.                                                                              </td></tr><tr><td data-label="Topic"> Security reminders             </td><td data-label="Enhancement / Behavior"> Storing user text is fine. Sanitize at render time. Consider auth/rate-limit for public deployment.                                                                                                                                                                          </td><td data-label="Acceptance criteria &amp; tests"> Security checklist included; recommend audit before public exposure.                                                       </td></tr></tbody></table></div><div class="row-count">Rows: 31</div></div><div class="table-caption" id="Table4" data-table="Book_8053_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria.</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"> <strong>Feature summary</strong>                 </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Add <code>POST /save-md</code> to save raw Markdown files and a small client script <code>assets/script.save.js</code>. Keep existing <code>/save</code> unchanged. Purpose: reliable, auditable Markdown export from UI. Acceptance: endpoint reachable, client calls succeed, <code>.md</code> files stored under <code>STORAGE_PATH</code>, tests pass.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Topic"> <strong>Route & method</strong>                  </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> <strong>Route:</strong> <code>POST /save-md</code> only.  <strong>Behavior:</strong> accept only POST.  <strong>Errors:</strong> respond with <code>405 Method Not Allowed</code> for other methods.  <strong>Status codes:</strong> <code>201 Created</code> on success; <code>400</code>, <code>413</code>, <code>415</code>, <code>500</code> as appropriate.  <strong>Tests:</strong> method rejection; 201 on valid requests; correct error codes for invalid requests.                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Topic"> <strong>Accepted content-types</strong>          </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Accept these formats:  <br><br>  1. <code>application/json</code> (preferred) — body: <code>{&quot;markdown&quot;:&quot;...&quot;, &quot;filename&quot;:&quot;...&quot;}</code>. <br><br>  2. <code>multipart/form-data</code> — fields: <code>markdown</code> (text or file upload) and optional <code>filename</code>. <br><br>  3. <code>application/x-www-form-urlencoded</code> — fields <code>markdown</code> and <code>filename</code>. <br><br>  Reject other types with <code>415 Unsupported Media Type</code>.  <strong>Tests:</strong> JSON POST passes; multipart POST passes; unsupported type yields 415.                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Topic"> <strong>Parsing & validation</strong>            </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> <strong>Required field:</strong> <code>markdown</code> (non-empty after trim).  <strong>Optional:</strong> <code>filename</code>.  <strong>Parsing rules:</strong> read as UTF-8, use <code>errors=&#x27;replace&#x27;</code>.  <strong>Empty/missing:</strong> return <code>400</code> with consistent JSON error.  <strong>Tests:</strong> missing/empty markdown → 400; correct multi-format parsing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Topic"> <strong>Size enforcement</strong>                </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Enforce <code>MAX_PASTE_SIZE</code> measured in UTF-8 bytes. Procedure:  <br><br>  1. If <code>Content-Length</code> header present and <code>Content-Length &gt; MAX_PASTE_SIZE + 1024</code>, return <code>413</code> immediately. <br><br>  2. After reading payload, compute <code>payload_bytes = len(markdown.encode(&#x27;utf-8&#x27;))</code>. If <code>payload_bytes &gt; MAX_PASTE_SIZE</code>, return <code>413</code>. <br><br>  <strong>Tests:</strong> Content-Length overflow; actual payload overflow even if Content-Length smaller.                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Topic"> <strong>Filename rules</strong>                  </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> <strong>Sanitize:</strong> call <code>_safe_filename(filename)</code>. If result empty set base to <code>untitled</code>.  <strong>Extension:</strong> append <code>.md</code> if missing.  <strong>Length:</strong> truncate basename to safe filesystem length (e.g., 255).  <strong>Collision:</strong> if final path exists, append <code>-&lt;uuid&gt;</code> before <code>.md</code>.  <strong>Tests:</strong> special chars removed; extension appended; long names truncated; duplicates handled.                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Topic"> <strong>Path traversal defense</strong>          </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Compute <code>dest_abspath = os.path.abspath(os.path.join(STORAGE_PATH, safe_name))</code>. Verify <code>dest_abspath.startswith(os.path.abspath(STORAGE_PATH) + os.sep)</code>. If not, return <code>400 invalid_filename</code>. <strong>Tests:</strong> attempt <code>../../etc/passwd</code> style names are rejected.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Topic"> <strong>Storage & permissions</strong>           </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Ensure <code>STORAGE_PATH</code> exists: <code>os.makedirs(STORAGE_PATH, exist_ok=True)</code>. Set directory and file permissions sensibly (<code>0o755</code> for dirs, <code>0o644</code> for files) if policy requires. <strong>Tests:</strong> directory creation; file permissions check.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Topic"> <strong>Atomic write & concurrency</strong>      </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Use atomic write: prefer existing <code>render/core_io</code> helper. Fallback pattern:  <br><br>  1. Create temp file in same dir: <code>tempfile.NamedTemporaryFile(dir=STORAGE_PATH, delete=False)</code>. <br><br>  2. Write payload bytes, <code>f.flush()</code>, <code>os.fsync(f.fileno())</code>, close. <br><br>  3. <code>os.replace(temp_path, dest_path)</code> for atomic move. <br><br>  4. If dest exists, use unique name strategy described above. <br><br>  <strong>Tests:</strong> simulate interrupt; concurrent saves produce unique files; no partial files on disk.                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Topic"> <strong>Response schema</strong>                 </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> <strong>Success (201):</strong> JSON:  <br><br>  <code>{ &quot;ok&quot;: true, &quot;status&quot;: &quot;saved&quot;, &quot;id&quot;: &quot;&lt;uuid&gt;&quot;, &quot;filename&quot;: &quot;&lt;final_filename.md&gt;&quot;, &quot;rel_path&quot;: &quot;&lt;path/relative/to/STORAGE_PATH&gt;&quot;, &quot;size&quot;: &lt;bytes&gt; }</code>  <br><br>  <strong>Note:</strong> Do <strong>not</strong> return absolute server filesystem paths. Include <code>url</code> only if secure public route exists.  <strong>Errors:</strong> <code>{ &quot;ok&quot;: false, &quot;error&quot;: &quot;&lt;code&gt;&quot;, &quot;details&quot;: &quot;&lt;message&gt;&quot; }</code>.  <strong>Tests:</strong> validate keys, types and absence of absolute paths.                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Topic"> <strong>Logging & observability</strong>         </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> On success: log INFO <code>save-md saved id=&lt;id&gt; filename=&lt;filename&gt; size=&lt;bytes&gt; client=&lt;remote_addr&gt;</code>.  On client errors: log WARNING with reason. On exceptions: log ERROR with stacktrace. Include request id if available. <strong>Tests:</strong> logs contain entries for success and failure cases.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Topic"> <strong>Security of stored content</strong>      </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Store raw markdown only. Do not render at save time. Any future serving or HTML conversion must run through <code>render/sanitize.py</code> or equivalent whitelist sanitizer. Document this requirement. <strong>Tests:</strong> saved content equals input; security audit note added to README.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Topic"> <strong>Rate-limiting & auth</strong>            </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Not implemented in this patch. Recommend project-level controls for production: authentication, per-user quotas, IP rate limits. Document requirement and flag for ops. <strong>Tests:</strong> document only; security team review recommended.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Topic"> <strong>Client script behavior</strong>          </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Implement <code>assets/script.save.js</code> to:  <br><br>  1. Register <code>ptt:save-request</code> listener and hook <code>#saveBtn</code> click. <br><br>  2. Read markdown from <code>#paste</code> or fallback <code>page-area</code>. <br><br>  3. If <code>filename</code> missing prompt user; default to <code>untitled.md</code>. <br><br>  4. Optional client-side size check against <code>MAX_PASTE_SIZE</code>. <br><br>  5. POST JSON to <code>/save-md</code>, handle JSON response. <br><br>  6. Update <code>#status</code> with outcome. Dispatch <code>ptt:save-response</code> with server response.  <br><br>  <strong>Tests:</strong> UI triggers event; status messages display; no console errors; cross-browser checks.                                                                                                                                                                           </td></tr><tr><td data-label="Topic"> <strong>index.html change</strong>               </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Minimal: add <code>&lt;script src=&quot;assets/script.save.js&quot; defer&gt;&lt;/script&gt;</code> if missing. Do not alter existing save behaviors. Ensure new script cooperates via events. <strong>Tests:</strong> page loads; both old and new save flows function.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Topic"> <strong>Collision policy</strong>                </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Do not silently overwrite. Prefer user-friendly auto-rename: append <code>-&lt;uuid&gt;</code> when filename exists. Document returned <code>filename</code> in response. <strong>Tests:</strong> save same filename twice yields two files with distinct names.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Topic"> <strong>Error handling details</strong>          </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Use machine-friendly <code>error</code> codes plus human <code>details</code>. Example codes: <code>missing_markdown</code>, <code>payload_too_large</code>, <code>invalid_filename</code>, <code>unsupported_media_type</code>, <code>server_error</code>. <strong>Tests:</strong> each error path returns expected code and JSON.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Topic"> <strong>cURL examples</strong>                   </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> JSON POST example: <br><br> <code>curl -v -X POST http://127.0.0.1:5000/save-md \</code><br><code>  -H &quot;Content-Type: application/json&quot; \</code><br><code>  -d &#x27;{&quot;markdown&quot;:&quot;# Hello\\nNote&quot;,&quot;filename&quot;:&quot;my-note.md&quot;}&#x27;</code> <br><br> Multipart/form example: <br><br> <code>curl -v -X POST http://127.0.0.1:5000/save-md \</code><br><code>  -F &quot;markdown=@./notes.txt;type=text/plain&quot; \</code><br><code>  -F &quot;filename=my-note.md&quot;</code>                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Topic"> <strong>Server tests (summary)</strong>          </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Required server tests (13):  <br><br>  1. JSON POST success: returns 201, file exists, size correct.  <br><br>  2. Multipart POST success.  <br><br>  3. Missing <code>markdown</code> → 400.  <br><br>  4. Empty <code>markdown</code> → 400.  <br><br>  5. Payload > <code>MAX_PASTE_SIZE</code> → 413.  <br><br>  6. Content-Length > limit → 413.  <br><br>  7. Filename sanitized and <code>.md</code> appended.  <br><br>  8. Path traversal attempts rejected.  <br><br>  9. <code>STORAGE_PATH</code> auto-created.  <br><br> 10. Atomic write yields no partial files after simulated interrupt.  <br><br> 11. Duplicate filename saved as unique file.  <br><br> 12. Response JSON schema validated.  <br><br> 13. Existing <code>/save</code> route unaffected.                                                                               </td></tr><tr><td data-label="Topic"> <strong>Client tests (summary)</strong>          </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Required client/browser tests (12):  <br><br>  1. Save triggers <code>ptt:save-request</code>.  <br><br>  2. Filename prompt appears when needed.  <br><br>  3. Client-side size prevention works (optional).  <br><br>  4. <code>#status</code> updates for success and error.  <br><br>  5. Errors shown and accessible.  <br><br>  6. If server returns <code>url</code>, saved file opens/downloads.  <br><br>  7. Fallback works when <code>#paste</code> missing.  <br><br>  8. No JS console exceptions.  <br><br>  9. Script coexists with other save scripts.  <br><br> 10. Works on Chrome/Firefox/Edge.  <br><br> 11. Works in mobile emulation.  <br><br> 12. Event dispatch is cancelable and honored.                                                                                                                </td></tr><tr><td data-label="Topic"> <strong>Acceptance checklist</strong>            </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> All items below must be true before merge:  <br><br>  1. <code>POST /save-md</code> implemented and reachable.  <br><br>  2. Endpoint accepts JSON and multipart.  <br><br>  3. Enforces <code>MAX_PASTE_SIZE</code> in UTF-8 bytes.  <br><br>  4. Filenames sanitized, <code>.md</code> appended.  <br><br>  5. Prevents path traversal.  <br><br>  6. Uses atomic write and ensures no partial files.  <br><br>  7. Collision handling produces unique filenames.  <br><br>  8. Returns 201 with correct JSON and no absolute paths.  <br><br>  9. Logs save attempts and errors.  <br><br> 10. Existing <code>/save</code> unchanged.  <br><br> 11. Client script triggers endpoint and updates UI.  <br><br> 12. README updated with examples and security notes.  <br><br> 13. All server and client tests listed above pass. </td></tr><tr><td data-label="Topic"> <strong>Implementation hazards to avoid</strong> </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> Do not return absolute filesystem paths. Do not overwrite existing files silently. Do not assume <code>Content-Length</code> is accurate. Always validate resolved destination path. Use <code>os.replace</code> for atomicity and <code>fsync</code> before replace. Ensure temp files are created on same filesystem as <code>STORAGE_PATH</code>. These checks prevent common security and integrity issues.                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Topic"> <strong>Next step deliverable</strong>           </td><td data-label="Detailed specification, implementation notes, numbered steps, tests, and acceptance criteria."> I will produce a single-file patch for <code>server.py</code> that implements the full spec above: imports, route handler, parsing, validation, atomic write (using existing helper or fallback), logging, and test stubs. After <code>server.py</code> is verified we will add <code>assets/script.save.js</code> and the <code>index.html</code> include. Confirm and I will generate the <code>server.py</code> patch now.                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr></tbody></table></div><div class="row-count">Rows: 23</div></div><div class="table-caption" id="Table5" data-table="Book_8053_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Aspect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Aspect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Enhancement"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Enhancement</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"> Web UI              </td><td data-label="Enhancement"> Add a <strong>Save Table</strong> button to allow users to save one or multiple tables directly from the web interface.                                                                                                 </td></tr><tr><td data-label="Aspect"> Batch mode          </td><td data-label="Enhancement"> Already parses Markdown/CSV files into tables, sanitizes Dropbox paths, and optionally generates HTML via renderer or fallback.                                                                            </td></tr><tr><td data-label="Aspect"> Table rendering     </td><td data-label="Enhancement"> Preserve inline <code>code</code>, avoid auto <code>&lt;br&gt;</code>, sanitize sensitive paths.                                                                                                                                       </td></tr><tr><td data-label="Aspect"> Config              </td><td data-label="Enhancement"> Uses <code>load_env()</code> for paths, batch flags, port, host, storage.                                                                                                                                             </td></tr><tr><td data-label="Aspect"> JS/HTML integration </td><td data-label="Enhancement"> Current <code>index.html</code> is minimal; it lacks interactive buttons. Enhancement requires adding buttons (e.g., Save), linking them to client-side JS (likely <code>script.table.js</code> or <code>extra.js</code>) for table export. </td></tr><tr><td data-label="Aspect"> Goal                </td><td data-label="Enhancement"> Provide a <strong>user-friendly way to load saved tables, save them under new names, and integrate seamlessly with the existing PTT workflow</strong>, without breaking batch or web mode.                              </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table6" data-table="Book_8053_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by File"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">File</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Purpose of Revision"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Purpose of Revision</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Notes / Verification Points"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Notes / Verification Points</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"> <code>server.py</code>                                        </td><td data-label="Purpose of Revision"> Add endpoints to list saved tables (<code>GET /api/saved_tables</code>) and load one (<code>GET /api/saved_tables/&lt;name&gt;</code>). </td><td data-label="Notes / Verification Points"> Check import correctness, path safety, JSON formatting, atomic reads, error handling.                                    </td></tr><tr><td data-label="File"> <code>templates/index.html</code>                             </td><td data-label="Purpose of Revision"> Add toolbar button for “Load saved table(s)” and modal container for list UI.                               </td><td data-label="Notes / Verification Points"> Ensure IDs unique, inline styles minimal, DOM placement correct.                                                         </td></tr><tr><td data-label="File"> <code>assets/extra.js</code> (or append to <code>script.table.js</code>) </td><td data-label="Purpose of Revision"> Client-side logic to fetch saved table list, load content into paste input, and handle modal show/hide.     </td><td data-label="Notes / Verification Points"> Validate fetch URLs, JSON parsing, error handling, interaction with existing paste input function (<code>handlePastedInput</code>). </td></tr><tr><td data-label="File"> <code>render/core_io.py</code> (optional / check-if-needed)   </td><td data-label="Purpose of Revision"> Confirm atomic write function exists and could be reused for future POST/save endpoint.                     </td><td data-label="Notes / Verification Points"> Verify signature, safe fallback if missing, avoid overwriting existing saved tables.                                     </td></tr><tr><td data-label="File"> <code>utils.py</code> (optional)                              </td><td data-label="Purpose of Revision"> If needed, minor helpers for safe path normalization or modal utility.                                      </td><td data-label="Notes / Verification Points"> Keep lightweight, do not interfere with existing helpers.                                                                </td></tr><tr><td data-label="File"> <code>main.py</code>                                          </td><td data-label="Purpose of Revision"> Confirm Flask app or server startup recognizes new endpoints.                                               </td><td data-label="Notes / Verification Points"> Check blueprint registration or direct app inclusion.                                                                    </td></tr><tr><td data-label="File"> <code>assets/style.css</code>                                 </td><td data-label="Purpose of Revision"> Optional minor CSS for modal display, basic responsiveness.                                                 </td><td data-label="Notes / Verification Points"> Keep minimal, ensure no clash with overrides.css.                                                                        </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><div class="table-caption" id="Table7" data-table="Book_8053_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Change Area"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change Area</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Details"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Details</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Change Area"> <strong>Content-Length Enforcement</strong>            </td><td data-label="Details"> Added <code>_enforce_content_length</code> in <code>before_request</code> to limit body-bearing requests (POST/PUT/PATCH) to <code>MAX_PASTE_SIZE</code>. Returns <code>413</code> if exceeded.                                                      </td></tr><tr><td data-label="Change Area"> <strong>Security Headers</strong>                      </td><td data-label="Details"> Added <code>_set_minimal_security_headers</code> in <code>after_request</code> with <code>X-Content-Type-Options</code>, <code>X-Frame-Options</code>, <code>Referrer-Policy</code>, <code>Permissions-Policy</code>. Non-invasive; uses <code>setdefault</code>.                     </td></tr><tr><td data-label="Change Area"> <strong>Template Cache Flush / Cache Busting</strong>  </td><td data-label="Details"> Added <code>_clear_jinja_template_cache</code> helper. <code>/convert</code> endpoint respects <code>v</code> query param or <code>FLUSH_TEMPLATES_ON_RENDER</code> config to flush Jinja cache.                                                     </td></tr><tr><td data-label="Change Area"> <strong>Reference-Style Footnote Stripping</strong>    </td><td data-label="Details"> <code>_strip_ref_footnotes</code> now removes <code>([ref][n])</code>, <code>[ref][n]</code>, <code>[n]</code> early in preprocessing to prevent them reaching renderers.                                                                            </td></tr><tr><td data-label="Change Area"> <strong>Escape Leading List Markers in Tables</strong> </td><td data-label="Details"> <code>_escape_leading_list_markers_in_table_cells</code> escapes numeric or <code>-/*/+</code> at start of pipe-table cells, preventing Markdown from interpreting them as lists.                                              </td></tr><tr><td data-label="Change Area"> <strong>Renderer Fallback Logic</strong>               </td><td data-label="Details"> <code>_render_text_with_fallbacks</code> consolidated multiple fallbacks: <code>render_from_text</code> preferred, candidate modules/functions tried, finally <code>&lt;pre&gt;</code> escape. Adds <code>meta[&quot;converted&quot;]=False</code> if fallback used. </td></tr><tr><td data-label="Change Area"> <strong>Convert Endpoint</strong>                      </td><td data-label="Details"> <code>/convert</code> now: strips footnotes, escapes leading list markers, enforces max size, optionally flushes cache, adds post-render guard if <code>&lt;table&gt;</code> missing.                                                </td></tr><tr><td data-label="Change Area"> <strong>Save Endpoint</strong>                         </td><td data-label="Details"> <code>/save</code> uses <code>_safe_filename</code>, tries <code>save_html_atomic</code>, falls back to atomic tempfile write. Returns consistent JSON with <code>path</code> and <code>id</code>.                                                              </td></tr><tr><td data-label="Change Area"> <strong>Get Saved Endpoint</strong>                    </td><td data-label="Details"> <code>/saved/&lt;file_id&gt;</code> uses <code>read_saved</code> helper or falls back to storage path. Validates <code>commonpath</code> to prevent directory traversal.                                                                        </td></tr><tr><td data-label="Change Area"> <strong>Compatibility API Routes</strong>              </td><td data-label="Details"> Added <code>/api/convert</code>, <code>/api/render</code>, <code>/api/health</code> as aliases.                                                                                                                                           </td></tr><tr><td data-label="Change Area"> <strong>Logging Improvements</strong>                  </td><td data-label="Details"> More info logs: feature flags, cache-bust flush, CORS enabled. Debug logs on manifest 404, preprocessing failure, save/read failures.                                                                    </td></tr><tr><td data-label="Change Area"> <strong>Minor Fixes</strong>                           </td><td data-label="Details"> Coerces integers safely (<code>_coerce_int</code>), safe filenames, robust exception handling everywhere.                                                                                                           </td></tr></tbody></table></div><div class="row-count">Rows: 12</div></div><div class="table-caption" id="Table8" data-table="Book_8053_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Aspect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Aspect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Status / Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Status / Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"> <strong>Form / Convert endpoint</strong>  </td><td data-label="Status / Notes"> <code>#render-form</code> posts to <code>/api/render</code>. Matches updated <code>/convert</code> route. ✅                                                                                                                                                                                                                      </td></tr><tr><td data-label="Aspect"> <strong>Paste textarea</strong>           </td><td data-label="Status / Notes"> Fixed width 8 cm, non-resizable. Compatible with <code>_escape_leading_list_markers_in_table_cells</code>. ✅                                                                                                                                                                                               </td></tr><tr><td data-label="Aspect"> <strong>Cache-busting</strong>            </td><td data-label="Status / Notes"> <code>&lt;link&gt;</code> tags include <code>v=%%ASSET_HASH%%</code>. Good for CSS/JS; consider adding <code>v</code> support for <code>/convert</code> fetch if client-side uses query param. ✅                                                                                                                                                  </td></tr><tr><td data-label="Aspect"> <strong>Saved tables</strong>             </td><td data-label="Status / Notes"> <code>&lt;section id=&quot;saved&quot;&gt;</code> present but hidden. Server now stores in configurable path. JS to fetch list not included. ⚠️ Need client-side fetch to populate saved tables.                                                                                                                           </td></tr><tr><td data-label="Aspect"> <strong>TOC / Header</strong>             </td><td data-label="Status / Notes"> <code>#toc</code> and <code>#tocBar</code> exist. JS <code>PTToc.init</code> handles TOC population. Compatible. ✅                                                                                                                                                                                                               </td></tr><tr><td data-label="Aspect"> <strong>Tables placeholder</strong>       </td><td data-label="Status / Notes"> <code>#tables-placeholder</code> ready for dynamic injection. ✅                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Aspect"> <strong>Route HTML to areas</strong>      </td><td data-label="Status / Notes"> <code>PasteToTable.routeHtmlToAreas</code> correctly handles full-page vs fragment responses. ✅                                                                                                                                                                                                            </td></tr><tr><td data-label="Aspect"> <strong>MutationObserver</strong>         </td><td data-label="Status / Notes"> Watches <code>#tables-viewer</code> to reveal <code>.table-wrapper</code>. Compatible with dynamically injected tables. ✅                                                                                                                                                                                             </td></tr><tr><td data-label="Aspect"> <strong>Modal / Copy</strong>             </td><td data-label="Status / Notes"> <code>#tv-copy-modal-template</code> exists. Matches <code>script.table.js</code> expectations. ✅                                                                                                                                                                                                                     </td></tr><tr><td data-label="Aspect"> <strong>Legacy alias</strong>             </td><td data-label="Status / Notes"> <code>copyAllMdBtn</code> delegated to <code>copyAllTablesBtn</code>. ✅                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Aspect"> <strong>JS load order</strong>            </td><td data-label="Status / Notes"> XLSX → TOC → Core → Table → Tweaks → Worker. Correct. ✅                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Aspect"> <strong>Accessibility / ARIA</strong>     </td><td data-label="Status / Notes"> Roles, labels, <code>aria-live</code> present. ✅                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Aspect"> <strong>Security / headers</strong>       </td><td data-label="Status / Notes"> No inline JS/CSP violations; compatible with minimal headers from server. ✅                                                                                                                                                                                                                     </td></tr><tr><td data-label="Aspect"> <strong>Outstanding improvements</strong> </td><td data-label="Status / Notes"> 1. Add client-side fetch logic to populate <code>#saved</code> section from <code>/saved/&lt;file_id&gt;</code> or list endpoint.<br>2. Ensure <code>/convert</code> fetch uses cache-busting query <code>v</code>. <br>3. Optional: enhance table copy/export buttons to respect new save path (<code>tables</code>). </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>