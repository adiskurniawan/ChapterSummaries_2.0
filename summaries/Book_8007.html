<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759508453">
<link rel="stylesheet" href="assets/overrides.css?v=1759582184">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header"><div><h1>Tables Viewer v2.1</h1></div><div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" type="search" placeholder="Search" aria-label="Search tables" style="min-width:420px; width:44ch;"/>
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllMdBtn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy all tables as markdown">Copy All Tables (Markdown)</button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset all tables">Reset All Tables</button>
</div></div>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#table-1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#table-2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#table-3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#table-4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#table-5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#table-6">Table 6</a></li></ul></div></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"><h3 id="table-1" class="table-heading">Table 1</h3></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Explanation**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Explanation</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><strong>File Purpose and Role</strong> </td><td data-label="Explanation"><code>core_renderer.py</code> functions as the orchestration layer for the entire rendering process. It does not just render HTML; it manages inputs, dispatches concurrent fragment rendering, prepares assets, and performs the final atomic write to disk. This file is the glue that binds together I/O, asset management, fragment handling, and final HTML assembly. Because of this central role, its correctness directly influences output stability, performance, and security. </td></tr><tr><td data-label="Topic"><strong>Input Handling</strong> </td><td data-label="Explanation">Inputs may be structured objects (fragments, table models, metadata) and configuration options. The renderer must normalize all inputs into a predictable format. Errors at this stage often cause cascading failures downstream. Recommendations: enforce strict schema validation, provide defaults for missing options, and explicitly reject unsupported fields. This ensures predictability and reduces hidden bugs. </td></tr><tr><td data-label="Topic"><strong>Fragment Rendering</strong> </td><td data-label="Explanation">Delegates to <code>render_fragments_concurrently</code> from <code>core_fragments.py</code>. This step parallelizes rendering of fragments, often representing tables or subsections of HTML. Important considerations: deterministic ordering of output, consistent fragment metadata (IDs, hashes, timing). Enhancements include: configurable concurrency, explicit timeout policies, structured error capture, and retry logic. The orchestrator should not embed concurrency details but should define clear contracts and behaviors. </td></tr><tr><td data-label="Topic"><strong>Asset Preparation</strong> </td><td data-label="Explanation">Assets such as CSS, JS, and overrides must be copied into the output bundle. This file uses <code>prepare_assets</code> and <code>write_overrides_css</code>. Asset preparation is a critical UX factor: if an asset is missing or corrupted, rendered pages fail to load correctly. Enhancements: implement Subresource Integrity (SRI), atomic copying into a temp asset folder, and safe rollback on failure. From a UX perspective, user-specific overrides should be clearly logged and visible in metadata so users understand what was applied. </td></tr><tr><td data-label="Topic"><strong>HTML Assembly</strong> </td><td data-label="Explanation">After fragments and assets are prepared, the renderer assembles the final HTML template. This involves stitching fragments together in a fixed order, inserting <code>&lt;script&gt;</code> and <code>&lt;link&gt;</code> tags, and embedding metadata. Key requirements: escaping dynamic data, avoiding injection vectors, and ensuring stable template placeholders. Performance-wise, large outputs should be streamed to file rather than built entirely in memory. From a UX angle, HTML should contain embedded metadata (comments or <code>&lt;meta&gt;</code> tags) to assist in debugging and version traceability. </td></tr><tr><td data-label="Topic"><strong>Atomic Write Behavior</strong> </td><td data-label="Explanation">Final HTML and asset files are written using <code>_default_write_atomic</code>, ensuring files are never left in a partially written state. This is crucial for durability and preventing corrupted outputs. Enhancements: enforce UTF-8 encoding consistently, fsync file descriptors before rename, and test cross-platform behavior (Windows file locks, POSIX rename guarantees). Strong recommendation: wrap atomic write operations in test harnesses that simulate crashes during write to verify integrity guarantees. </td></tr><tr><td data-label="Topic"><strong>Temporary Directory Management</strong> </td><td data-label="Explanation">Uses <code>tmp_frag_dir_for</code> to generate temporary directories for intermediate fragments. Robust cleanup is essential: leftover temp dirs can accumulate and fill disks. The orchestrator should enforce cleanup on both success and failure via try/finally or context managers. Enhancement: add logging of temp dir lifecycle, implement disk quota checks, and allow configurable temp dir location for constrained environments (e.g., containers with limited <code>/tmp</code>). </td></tr><tr><td data-label="Topic"><strong>Error Handling Strategy</strong> </td><td data-label="Explanation">Errors can occur at multiple stages: input validation, fragment rendering, asset copying, HTML assembly, or final write. The orchestrator should capture all errors in structured metadata. Fail-fast vs best-effort recovery should be configurable. Example: if a single fragment fails, should the system insert a placeholder and continue, or abort entirely? Enhancement: provide an option to include error details inside the final HTML (for debugging) without crashing the pipeline. </td></tr><tr><td data-label="Topic"><strong>Security Considerations</strong> </td><td data-label="Explanation">1. Escape untrusted values using <code>html.escape</code>. 2. Sanitize fragment HTML when untrusted sources exist. 3. Apply SRI to all scripts and stylesheets. 4. Avoid inline scripts where possible. 5. Enforce strict Content-Security-Policy (CSP) headers if this renderer outputs standalone web apps. 6. Strip or normalize potentially malicious attributes from fragments (e.g., <code>onerror</code>, <code>onclick</code>). </td></tr><tr><td data-label="Topic"><strong>Performance and Scalability</strong> </td><td data-label="Explanation">The orchestrator must scale to millions of rows or hundreds of fragments. Recommended: implement streaming HTML assembly, control concurrency to match CPU cores, impose fragment size limits, and avoid large intermediate memory buffers. Performance metrics (timings, fragment counts, sizes) should be logged and exported in machine-readable formats (JSON). Future enhancement: support incremental rendering where only modified fragments are regenerated. </td></tr><tr><td data-label="Topic"><strong>Portability</strong> </td><td data-label="Explanation">Must work across OSes (Linux, macOS, Windows). Issues to test: path length limits, file locking semantics, case sensitivity, newline normalization. Recommendations: use <code>pathlib</code> consistently, test with long paths on Windows, and ensure atomic rename functions properly in all environments. UX improvement: detect unsupported environments early and provide actionable error messages. </td></tr><tr><td data-label="Topic"><strong>User Experience (UX) Notes</strong> </td><td data-label="Explanation">UX hinges on predictable, fast, and transparent rendering. Users should receive clear logs (e.g., “Rendering 42 fragments, concurrency=8, estimated time=3s”). Metadata outputs (JSON summaries) improve integration with CI/CD pipelines. Failures should be explained clearly, with actionable next steps. Enhancements: progress bars, detailed error pages (HTML placeholders), and optional debug dumps of fragment metadata. </td></tr><tr><td data-label="Topic"><strong>Logging and Observability</strong> </td><td data-label="Explanation">Current logging likely covers major steps. Enhancements: structured logs in JSON format for machine parsing, debug vs production modes, per-fragment timing, and error-level granularity. Logs should integrate with external monitoring (e.g., Prometheus, ELK stack). This improves traceability and reduces mean-time-to-recovery when issues occur. </td></tr><tr><td data-label="Topic"><strong>Testing and Verification</strong> </td><td data-label="Explanation">Must be tested under unit, integration, and system levels. Unit: atomic write, asset prep, error handling. Integration: full pipeline with multiple fragments. System: stress tests with very large inputs. Verification should include simulated crashes during write, network filesystem behavior, and multi-process contention. Cross-platform test matrix is mandatory. </td></tr><tr><td data-label="Topic"><strong>Edge Case Coverage</strong> </td><td data-label="Explanation">Empty inputs, single fragment, extremely large tables, corrupted assets, permission errors, disk full conditions, concurrent invocations writing to same directory. The orchestrator must handle or clearly fail in each case. Failing silently or leaving partial outputs is unacceptable. </td></tr><tr><td data-label="Topic"><strong>Recommended Enhancements</strong> </td><td data-label="Explanation">1. Configurable <code>timeout</code> and <code>failure_mode</code>. 2. Strict context-managed temp dirs. 3. Streaming HTML assembly. 4. Structured logging + JSON metadata. 5. Asset preparation with tmp dir and atomic switch. 6. Metrics hooks for observability. 7. Optional debug HTML embedding of error info. </td></tr><tr><td data-label="Topic"><strong>Actionable Security Improvements</strong> </td><td data-label="Explanation">- Add SRI hashing for all assets. - Strip unsafe HTML attributes. - Enforce CSP headers. - Avoid inline JavaScript unless absolutely necessary. - Provide sanitization mode toggle for untrusted sources. </td></tr><tr><td data-label="Topic"><strong>Actionable Performance Improvements</strong> </td><td data-label="Explanation">- Streaming write for large HTML. - Incremental rendering for changed fragments only. - Memory backpressure control. - Concurrency auto-tuning based on CPU. - Metadata collection for profiling. </td></tr><tr><td data-label="Topic"><strong>Actionable UX Improvements</strong> </td><td data-label="Explanation">- JSON metadata alongside HTML output. - CLI flags for verbosity and debug modes. - Human-readable logs with timings. - Placeholder fragments with visible error messages. - Documented asset overrides for transparency. </td></tr><tr><td data-label="Topic"><strong>Verification Checklist (10 passes)</strong> </td><td data-label="Explanation">1. Input normalization correct. 2. Fragment concurrency deterministic. 3. Asset prep atomic. 4. HTML escape coverage. 5. Atomic write durability. 6. Temp dir cleanup robust. 7. Structured error metadata. 8. Cross-platform portability. 9. Performance scalability with large inputs. 10. Security enforcement (escape, SRI, sanitization). </td></tr><tr><td data-label="Topic"><strong>Overall Assessment</strong> </td><td data-label="Explanation"><code>core_renderer.py</code> is the single most leverageable point for enhancement. Hardening it improves reliability, performance, and security of the entire system. Enhancements here yield disproportionate benefits across the rendering pipeline. Immediate priorities: streaming assembly, atomic asset handling, structured logging, and cross-platform durability testing. </td></tr></tbody></table></div><div class="row-count">Rows: 21</div></div><div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"><h3 id="table-2" class="table-heading">Table 2</h3></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Explanation**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Explanation</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><strong>Overall Purpose</strong>                     </td><td data-label="Explanation">Central helper that ingests heterogeneous table-like inputs (DataFrames, lists, dicts, Markdown, HTML, files, bytes), normalizes them, extracts tables, and renders them into HTML fragments concurrently. Provides metadata (timings, assets, IDs, warnings) and ensures atomic writes. Acts as the "universal adapter" for all table sources before the final assembly.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Topic"><strong>Input Normalization & Preprocessing</strong> </td><td data-label="Explanation">- Accepts broad shapes: <code>pandas.DataFrame</code>, <code>list-of-dicts</code>, <code>list-of-lists</code>, <code>dict</code>, <code>str</code> (Markdown or HTML), <code>Path</code>/file, <code>bytes</code>. <br>- Bytes auto-decoded (UTF-8 → Latin-1 fallback). <br>- Paths read with tolerant encodings. <br>- Strings normalized with <code>_normalize_table_text</code>: NFKC Unicode normalization, BOM & zero-width stripping, dash harmonization, <code>&lt;br&gt;</code> → newline. <br>- Detects list-of-dicts/lists by structure; dict auto-wrapped. <br>- For strings: tries parser (<code>convert.parse_markdown_tables</code>) → internal Markdown pipe-table extractor → fallback render-to-HTML + extract <code>&lt;table&gt;</code>.                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Topic"><strong>Markdown & HTML Parsing</strong>             </td><td data-label="Explanation">- Markdown tables parsed with escape & inline code awareness (<code>_split_row_keep_code</code>). <br>- Divider line detection robust (<code>_is_divider_line</code>). <br>- HTML parsing: prefers BeautifulSoup; falls back to regex-based <code>&lt;table&gt;</code> extractor. <br>- Rows then converted to DataFrame if possible, else list-of-dicts or list-of-lists. <br>- This layered fallback ensures resilience across malformed Markdown/HTML.                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Topic"><strong>Rendering Strategy</strong>                  </td><td data-label="Explanation">- Primary renderer is <code>core_table.render_table</code> if available. Falls back to <code>_simple_render_table</code>. <br>- <code>_simple_render_table</code> creates <code>&lt;table&gt;</code> HTML manually if DataFrame/list-of-dicts/list-of-lists. <br>- Renderer can be callable or object with <code>.render</code>. If string input → tries <code>renderer.render</code>. <br>- Returns flexible shapes: plain string, <code>(html, assets)</code>, or <code>{&quot;html&quot;:..., &quot;assets&quot;:...}</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Topic"><strong>Concurrency Model</strong>                   </td><td data-label="Explanation">- Default: thread-based concurrency with <code>ThreadPoolExecutor</code>. <br>- Optional: <code>ProcessPoolExecutor</code>, but only if renderer is picklable and safe (checked via <code>pickle.dumps</code>). Process mode restricted to <code>_process_simple_render_job</code> + <code>_simple_render_table</code>. <br>- Each job measures <code>render_time_ms</code> and <code>write_time_ms</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Topic"><strong>Output Structure</strong>                    </td><td data-label="Explanation">- Returns <code>(fragments_map, frag_row_counts, total_rows, warnings)</code>. <br>- <code>fragments_map[idx]</code> includes: file path, HTML content, title_id, title_text, sections, assets, timings, detected_type, source, original_preview. <br>- <code>frag_row_counts[idx]</code> gives row count; <code>total_rows</code> aggregates. <br>- <code>warnings</code> capture errors, fallbacks, write failures.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Topic"><strong>Asset Detection</strong>                     </td><td data-label="Explanation">- Explicit detection from renderer return (tuple or dict). <br>- Heuristics applied on HTML: finds references to <code>xlsx.full.min.js</code>, PrismJS syntax highlighting, virtualization markers, <code>data-requires-*</code>. <br>- Produces <code>assets_required</code> list per fragment.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Topic"><strong>Unique Title Enforcement</strong>            </td><td data-label="Explanation">- Ensures <code>id</code> uniqueness across fragments (<code>Table</code>, <code>Table_2</code>, etc.). Prevents duplicate anchor collisions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Topic"><strong>Error Handling</strong>                      </td><td data-label="Explanation">- Extensive try/except wrapping. <br>- Failures logged but degraded gracefully: fragment still written with <code>&lt;p&gt;(fragment render failed)&lt;/p&gt;</code>. <br>- Warnings bubbled up for caller decision. <br>- Atomic writes with either <code>_atomic_stream_write</code> (preferred) or fallback <code>_atomic_write_text</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Topic"><strong>Performance Notes</strong>                   </td><td data-label="Explanation">- Threading avoids GIL bottlenecks since heavy tasks are mostly I/O-bound (Markdown/HTML parsing, file writes). <br>- Process mode safe only in simple cases; misconfigured picklability falls back with warning. <br>- Per-fragment timings allow profiling & tuning. <br>- Asset detection regex could be optimized, but acceptable cost.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Topic"><strong>Portability</strong>                         </td><td data-label="Explanation">- Unicode normalization ensures cross-platform reproducibility. <br>- Encoding fallbacks (UTF-8, Latin-1) improve robustness across OS locales. <br>- Avoids OS-specific syscalls (pure Python + <code>os.replace</code>). <br>- Uses <code>pathlib.Path</code> consistently.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Topic"><strong>Security Considerations</strong>             </td><td data-label="Explanation">- Unescapes HTML from user sources cautiously, but some regex parsing may mis-handle maliciously crafted HTML (e.g. <code>&lt;script&gt;</code> in table cells). <br>- Asset detection heuristics do not sanitize; relies on later rendering layers. <br>- File writes are confined to provided <code>tmp_frag_dir</code>. <br>- Logging exceptions could leak sensitive content unless log sanitization is applied.                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Topic"><strong>UX/Integration</strong>                      </td><td data-label="Explanation">- Guarantees stable output shape regardless of input weirdness. <br>- Rich metadata (<code>detected_type</code>, <code>original_preview</code>) aids debugging & UI feedback. <br>- Warnings surface user-readable context (e.g. “renderer not picklable”). <br>- Fragment granularity fits well with progressive rendering UIs (streaming tables one by one).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Topic"><strong>Actionable Recommendations</strong>          </td><td data-label="Explanation">1. <strong>Sanitize HTML</strong>: strip dangerous tags (<code>&lt;script&gt;</code>, <code>&lt;iframe&gt;</code>) before embedding. <br>2. <strong>Improve Asset Detection</strong>: maintain a whitelist/registry instead of regex scanning. <br>3. <strong>Structured Logging</strong>: emit JSON logs with table ID, type, row count for traceability. <br>4. <strong>Graceful Renderer API Contract</strong>: enforce standard <code>(html, assets)</code> output from renderer instead of permissive multiple shapes. <br>5. <strong>Parallel Scaling</strong>: allow adaptive worker count based on CPU cores + I/O load. <br>6. <strong>Unit Testing</strong>: add fuzz tests for malformed Markdown/HTML and concurrency stress tests. <br>7. <strong>Security Hardening</strong>: integrate HTML sanitizer (e.g. Bleach) before writing fragments. <br>8. <strong>Metadata Expansion</strong>: include detected column names, column types, and sample values in <code>fragments_map</code> to improve downstream use. </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"><h3 id="table-3" class="table-heading">Table 3</h3></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Explanation**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Explanation</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><strong>Overall Role of <code>core_assets.py</code></strong>            </td><td data-label="Explanation">This module is the <strong>asset lifecycle manager</strong> for the rendering subsystem. Its responsibilities: locate source assets (<code>style.css</code>, <code>script.js</code>, <code>worker.js</code>), copy them safely into the output folder, generate optional manifest and integrity metadata, and provide helper functions to embed or reference these assets in final HTML. It is the “bridge” between raw asset files and the rendered product. Conceptually, it ensures resilience (no missing assets), safety (atomic writes), and optional advanced features (fingerprinting, SRI).                                                                                                                </td></tr><tr><td data-label="Topic"><strong>Atomic Safety (Writes & Copies)</strong>             </td><td data-label="Explanation">The file heavily invests in <strong>atomic write strategies</strong> to avoid corruption when writing to disk. It uses <code>NamedTemporaryFile</code> and <code>os.replace</code> semantics to ensure either the old file or the new file is valid, never half-written. It prefers <code>core_io</code> helpers when available, falling back to its own implementations otherwise. This is crucial in multi-threaded or crash-prone environments. Enhancement: add logging when falling back, and metrics on how often fallback path is used.                                                                                                                                                                      </td></tr><tr><td data-label="Topic"><strong>Non-Destructive Copying</strong>                     </td><td data-label="Explanation">Copying policies are conservative. Non-empty existing assets are preserved unless <code>force_copy</code> is explicitly enabled. This avoids overwriting user-customized or previously cached assets. However, it still allows forced replacement for scenarios where updates are required. This policy balances safety (don’t overwrite without consent) with flexibility (override when necessary). Enhancement: track skipped files in manifest for diagnostic transparency.                                                                                                                                                                                                  </td></tr><tr><td data-label="Topic"><strong>Fallback Placeholders</strong>                       </td><td data-label="Explanation">For core assets (<code>style.css</code>, <code>script.js</code>, <code>worker.js</code>, <code>overrides.css</code>), the system guarantees non-empty files. If originals are missing, placeholders are written (≥10 bytes). This avoids runtime errors from missing files and ensures the HTML renderer always has something to reference. Placeholders are minimal but syntactically correct. Enhancement: support environment-variable–based placeholders (e.g., organization-provided standard fallback).                                                                                                                                                                                                     </td></tr><tr><td data-label="Topic"><strong>Hashing & SRI (Subresource Integrity)</strong>       </td><td data-label="Explanation">Provides <code>compute_sri</code> which generates cryptographic hashes (sha384 by default, base64-encoded) for HTML integrity attributes. This bolsters <strong>security</strong> by letting browsers verify assets weren’t tampered with. This feature is optional but aligns with modern best practices. Enhancement: allow multiple algorithms (sha256+sha384+sha512 simultaneously) for maximum browser compatibility. Also add verification mode that cross-checks downloaded assets.                                                                                                                                                                                                    </td></tr><tr><td data-label="Topic"><strong>Fingerprinting Assets</strong>                       </td><td data-label="Explanation">Optional fingerprinting renames assets by embedding a short hash (default length 12) before extension, e.g., <code>script.abcdef123456.js</code>. This is a <strong>cache-busting mechanism</strong>: when the file changes, filename changes, so stale browser caches are avoided. The feature is opt-in, controlled by cfg flags. Enhancement: make fingerprint strategy pluggable (support hash+mtime hybrid, or content hash prefix).                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Topic"><strong>Candidate Asset Discovery</strong>                   </td><td data-label="Explanation"><code>_discover_candidate_asset_dirs</code> checks several standard locations: repo root <code>assets/</code>, cwd <code>assets/</code>, sibling package directories. This allows flexibility in how projects are structured. Enhancement: support environment variables (<code>ASSETS_PATH</code>) and explicit search paths from configuration, increasing portability across unusual project layouts.                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Topic"><strong>Copy Policy: Whitelist, Blacklist, Max Size</strong> </td><td data-label="Explanation">The system ensures large files are not copied unless explicitly whitelisted. Blacklist/whitelist patterns (fnmatch) allow fine-grained control over inclusion. This prevents bloat (e.g., <code>.map</code> files) and provides predictable packaging. Enhancement: provide warnings (not just logs) if critical expected assets are skipped due to blacklist/size rules, to reduce silent misconfiguration.                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Topic"><strong>Manifest Generation</strong>                         </td><td data-label="Explanation"><code>write_assets_manifest</code> creates a JSON manifest recording filenames, size, mtime, and SRI values. If fingerprinting is enabled, it also includes a mapping from logical names → physical names. This is critical for <strong>traceability, reproducibility, and cache control</strong>. Enhancement: manifest could include build metadata (tool version, git commit hash, environment info) for stronger reproducibility guarantees.                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Topic"><strong>Asset Info Diagnostics</strong>                      </td><td data-label="Explanation">Separate lightweight <code>assets-info.json</code> is always written, capturing list of files, sizes, mtimes, and whether assets were written in this run. This diagnostic log aids debugging without breaking the workflow. Enhancement: unify info + manifest into a richer single artifact, while keeping lightweight mode available.                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Topic"><strong>Logical Asset Resolution</strong>                    </td><td data-label="Explanation"><code>resolve_asset_name</code> maps a logical asset (<code>script.js</code>) to actual physical filename (with hash if fingerprinted). It first checks manifest, then falls back to direct presence, then heuristic prefix-suffix matching. This flexibility prevents runtime errors. Enhancement: support regex-based fallback matching for more robust detection.                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Topic"><strong>Overrides CSS</strong>                               </td><td data-label="Explanation">Provides <code>write_overrides_css</code>, generating an <code>overrides.css</code> that adjusts layout (left/right column widths, sticky headers, dark mode). This ensures consistent UX even without project-provided CSS. Enhancements: support theming tokens from cfg (colors, spacing, fonts). Could auto-detect dark mode preference and inject alternative CSS blocks.                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Topic"><strong>Inline Fallback Helpers</strong>                     </td><td data-label="Explanation">Functions like <code>inline_style_fallback</code> and <code>inline_script_fallback</code> allow embedding fallback CSS/JS directly into HTML. This improves resilience (HTML still works even if assets not loaded). Enhancement: automatically minify inline text before embedding to reduce payload.                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Topic"><strong>Security Considerations</strong>                     </td><td data-label="Explanation">Strengths: integrity hashes, non-empty file guarantee, conservative copy policies. Weaknesses: reliance on <code>os.replace</code> (atomic but platform-specific edge cases), no explicit sandboxing of asset content (a malicious local asset could be copied unmodified). Enhancement: validate content types (e.g., refuse to inline binary data in script tag). Add optional signature verification (signed manifests).                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Topic"><strong>Performance Considerations</strong>                  </td><td data-label="Explanation">Strengths: avoids redundant copying (skips existing files), uses streaming for large copies, computes hashes incrementally. Weaknesses: computing SRI and fingerprint hashes for very large assets may be expensive. Enhancement: add caching of computed hashes between runs (based on mtime+size). Parallelize copy operations across multiple files if thread-safety ensured.                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Topic"><strong>Portability Considerations</strong>                  </td><td data-label="Explanation">Module already attempts cross-platform safety by using Python stdlib primitives (<code>os.replace</code>, <code>tempfile</code>, <code>shutil</code>). Enhancement: add Windows-specific long-path handling (<code>\\\\?\\</code> prefix) for >260 char paths. Add macOS extended attribute cleanup when copying files (strip <code>com.apple.quarantine</code> flags).                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Topic"><strong>UX Considerations</strong>                           </td><td data-label="Explanation">The system is defensive: users always end up with assets present, even if placeholders. Logs are info-level and explanatory. Enhancements: provide human-readable HTML error page if required assets are missing (instead of just placeholder CSS/JS). Allow end-users to customize placeholder banners (e.g., watermark if assets missing).                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Topic"><strong>CLI/Test Harness</strong>                            </td><td data-label="Explanation"><code>_demo_run</code> provides a minimal CLI demo that shows asset preparation in a temp dir, with manifest printing. This is useful for debugging. Enhancement: expand CLI to include options like <code>--generate-manifest</code>, <code>--fingerprint</code>, <code>--diagnose</code>, making it usable outside developer workflows.                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Topic"><strong>Failure Mode Analysis</strong>                       </td><td data-label="Explanation">- If asset discovery fails → placeholders ensure continuity. <br>- If atomic copy fails → logs debug, continues, placeholders step in. <br>- If manifest generation fails → silently skipped, non-critical. <br>- If permissions prevent writes → logs debug, continues, may leave missing asset. <br><strong>Enhancement</strong>: escalate failures to warnings or exceptions when in “strict” mode, controlled by cfg flag.                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Topic"><strong>Design Strengths</strong>                            </td><td data-label="Explanation">- Clear layering: low-level atomic ops → higher-level safe write → manifest/fallback logic → public API. <br>- Opt-in advanced features, preserving backward compatibility. <br>- Resilient against missing files or misconfiguration.                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Topic"><strong>Design Weaknesses</strong>                           </td><td data-label="Explanation">- Silent failures: logs only at debug/info, no surfacing to higher layers. <br>- Limited configuration extensibility (no environment variable search paths, no plugin hooks). <br>- Fallbacks are minimalistic, not user-informative.                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Topic"><strong>Actionable Recommendations (Summary)</strong>        </td><td data-label="Explanation">1. <strong>Expose strict mode</strong> (fail on missing assets instead of silently continuing). <br>2. <strong>Hash caching</strong> to accelerate repeated builds. <br>3. <strong>Extended manifest</strong> including build metadata. <br>4. <strong>Pluggable fingerprint strategies</strong>. <br>5. <strong>Configurable placeholder theming</strong> (colors, fonts, warnings). <br>6. <strong>Parallel copy optimization</strong> for large asset sets. <br>7. <strong>Better logging surface</strong> (warn on skipped large/blacklisted assets). <br>8. <strong>Environment variable–based asset paths</strong> for portability. <br>9. <strong>Signature-based verification</strong> for high-trust scenarios. <br>10. <strong>CLI expansion</strong> to serve as standalone asset prep tool. </td></tr></tbody></table></div><div class="row-count">Rows: 22</div></div><div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"><h3 id="table-4" class="table-heading">Table 4</h3></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Detailed Explanation**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Detailed Explanation</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><strong>File Purpose</strong> </td><td data-label="Detailed Explanation"><code>core_table.py</code> transforms messy, heterogeneous Python table inputs into safe, interactive HTML table fragments.<br>- Normalizes input shapes (DataFrame, to_pandas, list-of-dicts, list-of-lists, iterables).<br>- Preserves code fences and inline code. <br>- Emits metadata and optional features (lazy load, exports, sticky headers). </td></tr><tr><td data-label="Topic"><strong>Primary responsibilities</strong> </td><td data-label="Detailed Explanation">- Coerce inputs to <code>(rows, header)</code>. <br>- Render header controls, table markup, and metadata scripts. <br>- Provide export helpers for CSV, JSON, XLSX. <br>- Preserve backward-compatibility with <code>pandas.DataFrame.to_html</code> when appropriate. </td></tr><tr><td data-label="Topic"><strong>Accepted inputs & integration points</strong> </td><td data-label="Detailed Explanation">- Pandas DataFrame (if present). <br>- Objects implementing <code>to_pandas()</code>. <br>- <code>list[dict]</code>, <code>list[list]</code>, and generic iterables. <br>- Optional <code>markdown_to_html</code> callable or object with <code>.render()</code>. <br>- Per-table <code>_tv_options</code> metadata is respected and emitted as <code>data-tv-*</code> attributes. </td></tr><tr><td data-label="Topic"><strong>Normalization strategy</strong> </td><td data-label="Detailed Explanation">- <code>to_pandas()</code> attempt first when present. <br>- If pandas DataFrame, convert to rows + header. <br>- list-of-dicts preserves first dict key order as header. <br>- list-of-lists uses first row as header only when first row consists entirely of strings and >1 row. <br>- Final fallback coerces iterable items to lists. </td></tr><tr><td data-label="Topic"><strong>Code fence & inline-code preservation</strong> </td><td data-label="Detailed Explanation">- Stashes fenced code blocks and inline code into stable placeholders prior to markdown processing. <br>- Restores placeholders after rendering so code content remains intact and unescaped. <br>- Prevents accidental table splitting when code contains pipe characters. </td></tr><tr><td data-label="Topic"><strong>Protection of underscores and pipes</strong> </td><td data-label="Detailed Explanation">- Converts underscores and pipe characters outside placeholders into HTML entities before markdown rendering to avoid accidental interpretation. <br>- Restores protection entities after rendering. <br>- Ensures that textual underscores and pipes are not treated as markdown syntax. </td></tr><tr><td data-label="Topic"><strong>Markdown callable handling</strong> </td><td data-label="Detailed Explanation">- <code>_get_md_callable</code> returns a safe callable: uses provided <code>markdown_to_html</code> or <code>.render()</code> when available; defaults to <code>html.escape</code>. <br>- Any failure in markdown rendering falls back to escaping, preventing injection. </td></tr><tr><td data-label="Topic"><strong>Cell rendering pipeline</strong> </td><td data-label="Detailed Explanation">Steps per cell: stash code → protect underscores/pipes → call markdown renderer → restore protection entities → restore code placeholders → sanitize (if available) → cap overly large cell HTML.<br>- Large content is truncated with a suffix. <br>- Sanitization invoked if <code>sanitize_html</code> present, with <code>allow_tables</code> attempted where supported. </td></tr><tr><td data-label="Topic"><strong>Sanitization semantics</strong> </td><td data-label="Detailed Explanation">- If <code>sanitize_html</code> exists, used to clean rendered HTML.<br>- The module inspects the sanitizer signature to call <code>allow_tables=True</code> if supported. <br>- If sanitizer fails, falls back to escaping to preserve safety. </td></tr><tr><td data-label="Topic"><strong>Diagram & RTL detection</strong> </td><td data-label="Detailed Explanation">- <code>_is_diagram_text</code> heuristic detects ASCII/box-drawing diagrams to apply <code>cell-diagram</code> class. <br>- <code>_detect_rtl_chars</code> detects RTL scripts and sets <code>dir=&quot;rtl&quot;</code> on cells for correct rendering. </td></tr><tr><td data-label="Topic"><strong>Column alignment detection</strong> </td><td data-label="Detailed Explanation">- <code>_get_table_alignments</code> reads <code>_table_alignments</code> or <code>alignments</code> attributes from upstream objects when present. <br>- Alignments are emitted as <code>data-align</code> and inline <code>style=&quot;text-align:...&quot;</code> for robust fallback across CSS/JS conditions. </td></tr><tr><td data-label="Topic"><strong>Column type detection (optional)</strong> </td><td data-label="Detailed Explanation">- <code>_detect_column_types</code> samples rows (bounded by <code>_COLUMN_TYPE_SAMPLE</code>) and uses heuristics (<code>_guess_value_type</code>) to classify: numeric, datetime, code, diagram, boolean, text, html, json. <br>- Types normalized so integer/float become <code>numeric</code>. <br>- Emitted as <code>data-col-type</code> and cell classes to enable client behaviors (sorting, formatting). </td></tr><tr><td data-label="Topic"><strong>Uniform-row enforcement</strong> </td><td data-label="Detailed Explanation">- <code>_ensure_uniform_rows</code> pads shorter rows with empty strings and trims rows exceeding max columns. <br>- Prevents jagged tables that break CSS/JS assumptions. <br>- Trimming occurs with warnings when safety caps reached. </td></tr><tr><td data-label="Topic"><strong>Row and column safety caps</strong> </td><td data-label="Detailed Explanation">- <code>_MAX_ROWS_SAFE_RENDER</code>, <code>_MAX_COLS_SAFE</code>, and <code>_MAX_CELL_HTML</code> guard against pathological inputs. <br>- Warnings logged when caps are approached or exceeded. <br>- Design chooses graceful degradation over hard failures. </td></tr><tr><td data-label="Topic"><strong>Wrapper and heading structure</strong> </td><td data-label="Detailed Explanation">- Renders a wrapper <code>&lt;div class=&quot;table-wrapper&quot;&gt;</code> containing: hidden anchor for navigation, visible heading bar, header controls, table container, optional lazy chunk script, footer row count, and table metadata script. <br>- Table has <code>role=&quot;table&quot;</code> and <code>aria-labelledby</code> referencing the visible heading for screen reader support. </td></tr><tr><td data-label="Topic"><strong>Hidden anchors & heading bar</strong> </td><td data-label="Detailed Explanation">- Hidden <code>&lt;a&gt;</code> anchors are emitted per table for navigation. <br>- <code>_heading_init_script</code> builds a top navigation bar of table links client-side in an idempotent manner. <br>- Script avoids duplication when DOM already assembled. </td></tr><tr><td data-label="Topic"><strong>One-time asset emission & client JS/CSS</strong> </td><td data-label="Detailed Explanation">- <code>_one_time_assets</code> returns CSS and JS idempotently emitted once per page (guarded by <code>_ASSETS_EMITTED</code> and <code>emit_assets_once</code> option). <br>- JS implements binding logic: exports, copy, lazy-load, collapse/expand. <br>- Designed to be non-opinionated and defensive (errors logged to console). </td></tr><tr><td data-label="Topic"><strong>Header controls & interactivity</strong> </td><td data-label="Detailed Explanation">- Buttons included: Copy Plain, Copy Markdown, Export CSV, Export JSON, Export XLSX, Collapse Table. <br>- Buttons are annotated with <code>data-action</code> attributes which the client JS binds to. <br>- Export XLSX requires SheetJS on the page; otherwise falls back to CSV. </td></tr><tr><td data-label="Topic"><strong>Accessibility features</strong> </td><td data-label="Detailed Explanation">- <code>aria-label</code> on heading bar and <code>aria-labelledby</code> on table. <br>- Heading links generated with focusable anchors. <br>- Buttons include <code>title</code>/<code>aria-label</code> where appropriate. <br>- Room for improvement: add <code>th scope=&quot;row&quot;</code> for row headers, expose live-region feedback for copy/export success, and provide keyboard-only affordances for all controls. </td></tr><tr><td data-label="Topic"><strong>Body rendering details</strong> </td><td data-label="Detailed Explanation">- Table head built from <code>header_htmls</code> generated by <code>_render_cell_text</code>. <br>- Each header cell includes a sort button with accessible label. <br>- <code>td</code> cells include <code>data-label</code> for responsive layouts, optional classes for type/diagram, <code>dir</code> attribute for directionality, and inline alignment. </td></tr><tr><td data-label="Topic"><strong>Lazy-loading strategy</strong> </td><td data-label="Detailed Explanation">- If <code>lazy_load_threshold</code> is set and rows exceed it, renderer outputs <code>initial_rows</code> and serializes remaining rows into a JSON chunk embedded as <code>&lt;script type=&quot;application/json&quot; class=&quot;table-row-chunk&quot;&gt;</code>. <br>- Client JS appends those rows when user triggers Load More. <br>- <code>_safe_json_for_script</code> escapes <code>&lt;/</code> sequences to avoid closing the script tag prematurely. </td></tr><tr><td data-label="Topic"><strong>Lazy chunk tradeoffs</strong> </td><td data-label="Detailed Explanation">- Pros: reduces initial DOM size, improves first paint. <br>- Cons: embeds possibly large JSON into HTML which increases page weight and memory usage. <br>- Recommendation: for very large datasets replace inline chunk with a deferred fetch endpoint returning JSON. </td></tr><tr><td data-label="Topic"><strong>Export helpers (server-side)</strong> </td><td data-label="Detailed Explanation">- <code>_rows_to_csv_bytes</code> creates CSV bytes with quoted cells and CRLF line endings. <br>- <code>_rows_to_json_bytes</code> serializes rows as list-of-objects when header present else list-of-lists. <br>- <code>_rows_to_xlsx_bytes</code> uses <code>xlsxwriter</code> or falls back to <code>openpyxl</code>. <br>- Functions return bytes ready for HTTP response. </td></tr><tr><td data-label="Topic"><strong>Simple render fallback</strong> </td><td data-label="Detailed Explanation">- <code>simple_render_table</code> returns a minimal <code>&lt;table&gt;</code> or <code>df.to_html</code> fallback. <br>- Useful for process-based simple rendering or when full features not available. </td></tr><tr><td data-label="Topic"><strong>Fragment rendering wrapper</strong> </td><td data-label="Detailed Explanation">- <code>render_fragment</code> sets <code>fragment=True</code> and disables asset injection by default. <br>- Ensures fragments are compact and do not re-emit one-time assets. </td></tr><tr><td data-label="Topic"><strong>Error handling & graceful degradation</strong> </td><td data-label="Detailed Explanation">- Extensive try/except around parsing, rendering, sanitization, and serialization. <br>- Failures produce escaped fallback content and logged debug messages, not crashes. <br>- Metadata embed still attempted even on partial failures to aid debugging. </td></tr><tr><td data-label="Topic"><strong>Security posture</strong> </td><td data-label="Detailed Explanation">- Defaults: escape everything, sanitize when available, safe JSON embedding. <br>- Risks: relies on external sanitizer and markdown callable; improper sanitizer or unsafe markdown renderers can expose XSS. <br>- Mitigations: enforce sanitizer usage in strict mode, cap cell sizes, and always escape as final fallback. </td></tr><tr><td data-label="Topic"><strong>Performance considerations</strong> </td><td data-label="Detailed Explanation">- Uses list append + <code>&#x27;&#x27;.join</code> for efficient string assembly. <br>- Captures rendering time when <code>debug</code> option set. <br>- Heavy operations: markdown rendering, sanitization, XLSX generation, and large JSON embedding. <br>- Recommendations: enable streaming for extremely large tables; offload XLSX generation to background worker for large exports. </td></tr><tr><td data-label="Topic"><strong>Portability & dependencies</strong> </td><td data-label="Detailed Explanation">- Pure-Python core with optional third-party libs: <code>pandas</code>, <code>xlsxwriter</code>, <code>openpyxl</code>. <br>- Works across Linux, macOS, Windows. <br>- Export bytes default to UTF-8 to ensure cross-platform interoperability. </td></tr><tr><td data-label="Topic"><strong>Observability & logging</strong> </td><td data-label="Detailed Explanation">- Logs debug-level details for recoverable errors and warnings for safety cap triggers. <br>- When <code>debug</code> enabled, render time is included in embedded metadata. <br>- Recommendation: emit structured JSON logs (table_id, rows, cols, warnings) to integrate with monitoring. </td></tr><tr><td data-label="Topic"><strong>Testing & verification matrix</strong> </td><td data-label="Detailed Explanation">- Unit tests: <code>_rows_from_iterable</code> (all shapes), <code>_render_cell_text</code> (stash/restore), sanitize present/absent behavior, alignment detection. <br>- Integration tests: render_table with lazy chunks, export generation, fragment mode, header-bar assembly. <br>- Security tests: XSS payloads in headers/cells and chunk blobs. <br>- Performance tests: very wide and deep tables against caps. </td></tr><tr><td data-label="Topic"><strong>Accessibility testing</strong> </td><td data-label="Detailed Explanation">- Automated checks (axe-core) for heading bar, ARIA attributes, tab order. <br>- Manual keyboard-only navigation tests for copy/export/collapse. <br>- Screen reader pass to confirm table heading and row-count announcements. </td></tr><tr><td data-label="Topic"><strong>Extensibility & customization points</strong> </td><td data-label="Detailed Explanation">- Pluggable markdown callable and sanitizer. <br>- <code>tv_options</code> allows per-table metadata and data-* attributes. <br>- Options dict toggles features. <br>- Suggested hooks: per-column formatter functions, custom export backends, deferred chunk URL generator. </td></tr><tr><td data-label="Topic"><strong>UX recommendations</strong> </td><td data-label="Detailed Explanation">- Show inline success/failure toast for copy/export. <br>- Localize button labels and tooltips. <br>- Make collapse state persistent via <code>data-tv-*</code> or localStorage. <br>- Add client-side search/filter inputs in the header bar. </td></tr><tr><td data-label="Topic"><strong>Security hardening recommendations</strong> </td><td data-label="Detailed Explanation">- Offer a strict mode that enforces sanitizer presence and rejects unsafe markdown renderers. <br>- Harden <code>_safe_json_for_script</code> and test with edge-case payloads. <br>- Consider stripping <code>on*</code> attributes post-render as extra safety layer. </td></tr><tr><td data-label="Topic"><strong>Performance hardening recommendations</strong> </td><td data-label="Detailed Explanation">- Replace embedded large JSON with an async fetch endpoint for huge datasets. <br>- Cache column type detection results when inputs are stable. <br>- Offload XLSX generation to async background job for very large exports. </td></tr><tr><td data-label="Topic"><strong>Accessibility hardening recommendations</strong> </td><td data-label="Detailed Explanation">- Add <code>scope=&quot;row&quot;</code> on row header cells when row headers exist. <br>- Add <code>aria-live</code> for dynamic row counts and export completion messages. <br>- Add keyboard shortcuts for export and copy. </td></tr><tr><td data-label="Topic"><strong>Deployment and rollout plan</strong> </td><td data-label="Detailed Explanation">1) Add unit and integration tests covering core behavior and edge cases.<br>2) Introduce runtime-configurable caps (rows, cols, cell size) to allow safe tuning per deployment.<br>3) Release a minor version with new features behind flags so default behavior is unchanged.<br>4) Monitor logs and error telemetry for unexpected warnings or sanitizer failures.<br>5) Implement streaming/deferred chunk patterns in a subsequent release and document migration. </td></tr><tr><td data-label="Topic"><strong>Verification checklist (10 focused passes)</strong> </td><td data-label="Detailed Explanation">1) Validate <code>_rows_from_iterable</code> with all input shapes. <br>2) Confirm code fence stash/restore roundtrip preserves content. <br>3) Verify sanitizer present/absent behavior yields safe output. <br>4) Test lazy chunk JSON embedding and client append. <br>5) Generate CSV/JSON/XLSX outputs and open them in common tools. <br>6) Confirm column type detection on numeric/datetime/text/code samples. <br>7) Run RTL/diagram detection on representative inputs. <br>8) Ensure safety caps log warnings and prevent OOM. <br>9) Run accessibility checks (axe) on rendered markup. <br>10) Stress test with near-capacity datasets for memory/cpu behavior. </td></tr><tr><td data-label="Topic"><strong>Acceptance criteria</strong> </td><td data-label="Detailed Explanation">- Rendered HTML is well-formed and safe for embedding. <br>- No unescaped user-supplied HTML leaks when sanitizer not present. <br>- Lazy chunk JSON is syntactically safe and client-side loader appends rows correctly. <br>- Export helpers produce valid files. <br>- Backward compatibility preserved for existing consumers. </td></tr><tr><td data-label="Topic"><strong>Risks & mitigation</strong> </td><td data-label="Detailed Explanation">- Risk: unsafe markdown/sanitizer combo → mitigate via strict mode. <br>- Risk: embedded large JSON bloat → mitigate with deferred fetch. <br>- Risk: XLSX libs unavailable → fallback to CSV and log. <br>- Risk: exotic iterable shapes not handled → add long-tail test cases and fuzzing. </td></tr><tr><td data-label="Topic"><strong>Actionable next steps</strong> </td><td data-label="Detailed Explanation">1) Expose caps as runtime options. <br>2) Add strict sanitizer mode and validate integration. <br>3) Implement deferred-chunk fetch pattern for very large datasets. <br>4) Add structured logging and telemetry hooks. <br>5) Expand accessibility features and automated tests. </td></tr></tbody></table></div><div class="row-count">Rows: 42</div></div><div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"><h3 id="table-5" class="table-heading">Table 5</h3></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Detailed explanation**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Detailed explanation</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><strong>File purpose & role</strong> </td><td data-label="Detailed explanation">Acts as the top-level orchestrator for producing the final HTML output. <br>- Coordinates asset preparation, fragment rendering, HTML assembly, and atomic output. <br>- Bridges input normalization (markdown/html/iterables) and final page materialization. <br>- Central point of failure and highest leverage for reliability, security, and UX. </td></tr><tr><td data-label="Topic"><strong>Public API & expectations</strong> </td><td data-label="Detailed explanation"><code>render_html(all_tables, output_html, markdown_to_html, ..., config, return_html, materialize)</code> is the main function. <br>- Inputs: heterogeneous table-like items and a markdown renderer. <br>- Outputs: writes an HTML file and returns a metadata dict with <code>warnings</code>, <code>tables</code>, <code>rows</code>, <code>runtime_ms</code>, and <code>output</code>. <br>- <code>return_html</code> optionally reads back the written file. <br>- <code>materialize</code> is present but unused; expectation mismatch. </td></tr><tr><td data-label="Topic"><strong>High-level control flow</strong> </td><td data-label="Detailed explanation">1) sanitize and prepare output path and directories. <br>2) prepare assets and optional overrides. <br>3) normalize inputs and extract inline tables. <br>4) deduplicate parsed tables. <br>5) produce a temporary fragment directory. <br>6) call <code>render_fragments_concurrently</code> to produce fragment files. <br>7) evaluate fragment content and decide fallback inline rendering. <br>8) assemble head, TOC, body (fragments or inline parts), and tail. <br>9) write the full HTML atomically. <br>10) return metadata. </td></tr><tr><td data-label="Topic"><strong>Dependencies & imports</strong> </td><td data-label="Detailed explanation">Relies on <code>core_assets.prepare_assets</code>, <code>core_fragments.render_fragments_concurrently</code>, <code>core_table.render_table</code>, and <code>core_io</code> atomic helpers. <br>- Uses <code>core_utils</code> helpers <code>_sanitize_output_path</code>, <code>_sri_attr</code>, and <code>_frag_contains_rows</code>. <br>- Optional libs: BeautifulSoup (<code>bs4</code>), pandas for conversions inside helpers. </td></tr><tr><td data-label="Topic"><strong>MarkdownRenderer abstraction</strong> </td><td data-label="Detailed explanation">Wraps the provided markdown callable into <code>MarkdownRenderer</code>. <br>- Constructor accepts <code>func</code>, <code>cache_size</code>, and <code>timeout_s</code> but only sets <code>render = func</code>. <br>- <code>cache_size</code> and <code>timeout_s</code> are unused; placeholder for future caching/timeout features. <br>- Recommendation: implement actual caching and controlled timeouts for untrusted markdown renderers. </td></tr><tr><td data-label="Topic"><strong>Asset preparation & inclusion</strong> </td><td data-label="Detailed explanation">Calls <code>prepare_assets(cfg, out_dir)</code> and <code>write_overrides_css</code>. <br>- Supports two modes: <code>embed_assets=True</code> in cfg embeds CSS/JS into HTML. <br>- Default external mode emits <code>&lt;link&gt;</code> and <code>&lt;script&gt;</code> with <code>?v=</code> cache-busting from <code>stat().st_mtime</code>. <br>- Integrates <code>_sri_attr</code> for CDN integrity. <br>- Writes <code>overrides.css</code> via <code>write_overrides_css</code> to ensure layout variables. </td></tr><tr><td data-label="Topic"><strong>Asset path / href_prefix handling</strong> </td><td data-label="Detailed explanation">Computes <code>href_prefix = relpath(assets_dir, out_dir)</code> then <code>Path(...).as_posix()</code> for URL-safe paths. <br>- Falls back to <code>&quot;assets&quot;</code> on error (e.g., different Windows drives). <br>- Note: <code>os.path.relpath</code> can raise on different mount points; the fallback is appropriate but should be logged as a warning. </td></tr><tr><td data-label="Topic"><strong>Input normalization & extraction</strong> </td><td data-label="Detailed explanation">Iterates <code>all_tables</code> and: <br>- Accepts DataFrames and lists-of-rows directly. <br>- For strings: attempts pipe-table extraction, then renders markdown to HTML and extracts <code>&lt;table&gt;</code> blocks. <br>- Sanitizes HTML extraction step with <code>sanitize_html(..., allow_tables=True)</code>. <br>- Preserves non-table markdown HTML into <code>inline_html_sources</code>. </td></tr><tr><td data-label="Topic"><strong>Deduplication logic</strong> </td><td data-label="Detailed explanation">Uses <code>hashlib.sha256(repr(tbl).encode(...))</code> as a dedupe key. <br>- <code>repr(tbl)</code> can be non-deterministic across runs or types and may miss logical duplicates or produce false negatives. <br>- Recommendation: canonicalize table content (serialize rows+header deterministically) before hashing. </td></tr><tr><td data-label="Topic"><strong>Temporary fragment directory</strong> </td><td data-label="Detailed explanation">Uses <code>tmp_frag_dir_for(out_dir)</code> to get fragments directory. <br>- Delegates fragment file creation to <code>render_fragments_concurrently</code>. <br>- Missing explicit cleanup in this function: relies on <code>tmp_frag_dir_for</code> contract. <br>- Recommendation: use context manager or explicit cleanup to avoid orphaned temp directories. </td></tr><tr><td data-label="Topic"><strong>Fragment rendering integration</strong> </td><td data-label="Detailed explanation">Calls <code>render_fragments_concurrently(parsed_tables, cfg, renderer, tmp_frag_dir, max_workers)</code>. <br>- Handles exceptions and collects warnings. <br>- Determines fallback inline rendering when fragments_map is empty or contains no rows via <code>_frag_contains_rows</code>. <br>- Assumes fragment files are sanitized; writes them raw into final assembly. </td></tr><tr><td data-label="Topic"><strong>Fallback inline rendering</strong> </td><td data-label="Detailed explanation">When fragments are absent or empty, iterates <code>parsed_tables</code> and calls <code>render_table</code> to produce inline HTML pieces. <br>- Sanitizes each <code>piece</code> with <code>sanitize_html(piece, allow_tables=True)</code> before inclusion. <br>- Builds a TOC from <code>&lt;hN&gt;</code> tags or synthetic titles for inline blocks. </td></tr><tr><td data-label="Topic"><strong>TOC and inline sources</strong> </td><td data-label="Detailed explanation">Builds <code>toc_items</code> from fragment metadata or extracted headings from <code>inline_html_sources</code>. <br>- Sanitizes and normalizes title text into safe <code>id</code> values. <br>- Renders a side or top TOC container used for navigation. </td></tr><tr><td data-label="Topic"><strong>Head & tail assembly</strong> </td><td data-label="Detailed explanation"><code>head_parts</code> contain DOCTYPE, <code>&lt;head&gt;</code>, critical inline CSS to prevent FOUC, asset <code>&lt;link&gt;</code> tags (or embedded <code>&lt;style&gt;</code>), and page chrome (search box, control buttons). <br>- <code>tail_parts</code> contain script tags, optional embedded worker and xlsx script, and runtime JS that wires export actions. <br>- Finally joins <code>head</code> and <code>tail</code> strings into full page skeleton. </td></tr><tr><td data-label="Topic"><strong>Writer & atomic output</strong> </td><td data-label="Detailed explanation">Defines <code>writer(f)</code> that writes <code>head</code>, <code>toc</code>, optional <code>banner_html</code>, then either fragment contents (read from files) or <code>inline_parts</code>, then <code>tail</code>. <br>- Uses <code>_default_write_atomic(out_path, writer)</code> when available, otherwise falls back to tmp file + <code>os.replace</code>. <br>- Final fallback: plain <code>open(out_path, &quot;w&quot;)</code>. <br>- Recommendation: ensure <code>_default_write_atomic</code> is robust across platforms and that fallback temporary files are created on same filesystem to guarantee atomic <code>os.replace</code>. </td></tr><tr><td data-label="Topic"><strong>Fragment content assumptions</strong> </td><td data-label="Detailed explanation">Fragments are written raw into final HTML without re-sanitization. <br>- This assumes <code>render_fragments_concurrently</code> sanitized the content or that the content is trusted. <br>- Risk: unsanitized fragment HTML could introduce XSS into final page. <br>- Recommendation: either re-sanitize fragments at assembly time or enforce strict sanitizer step before fragment writes. </td></tr><tr><td data-label="Topic"><strong>Search & header controls</strong> </td><td data-label="Detailed explanation">Adds a search box and global controls (theme toggle, collapse all, copy all, reset). <br>- Buttons reference client-side functions (e.g., <code>toggleMode()</code>, <code>toggleAllTables()</code>), which must be provided by included <code>script.js</code>. <br>- If <code>script.js</code> missing, inline shim attempts to provide minimal behavior; code paths for that shim are complex and include fragile string replacement (see risk below). </td></tr><tr><td data-label="Topic"><strong>Client-side JS generation</strong> </td><td data-label="Detailed explanation">Appends a runtime <code>&lt;script&gt;</code> that wires an <code>exportBtn</code> click to a Worker-based export flow. <br>- Builds <code>template</code>, <code>userVal</code>, and <code>hrefPrefix</code> JS variables via <code>json.dumps</code> to avoid injection. <br>- Adds a <code>window.load</code> listener to reveal <code>.table-wrapper</code> items (prevent FOUC). </td></tr><tr><td data-label="Topic"><strong>Known fragile/buggy areas</strong> </td><td data-label="Detailed explanation">- <strong>Worker shim replacement bug</strong>: the inline <code>raw_shim</code> replacement searches for a literal <code>&#x27;{href_prefix}/worker.js&#x27;</code> which does not exist in <code>raw_shim</code>. This makes the shim replacement ineffective. <br>- <strong>Unused <code>materialize</code> flag</strong>: parameter exists but not used; confusing API. <br>- <strong>MarkdownRenderer timeout/cache</strong>: config parameters provided but not implemented. <br>- <strong>runtime_ms is always 0</strong>: elapsed time is not measured for whole <code>render_html</code>. <br>- <strong>tmp_frag_dir cleanup</strong>: not explicit here. <br>- <strong>relpath fallback silent</strong>: when <code>relpath</code> fails (Windows), no informative warning is emitted. </td></tr><tr><td data-label="Topic"><strong>Security posture</strong> </td><td data-label="Detailed explanation">- Uses <code>sanitize_html</code> if present and falls back to <code>html.escape</code> in absence. <br>- During table extraction the code calls <code>sanitize_html(..., allow_tables=True)</code> to enable table extraction. <br>- Uses <code>json.dumps</code> for JS variable encoding. <br>- Risks remain: untrusted fragment HTML written raw; external markdown renderer may return unsafe HTML; embedded JSON chunks and inline scripts must be sanitized. <br>- Recommendations: enforce strict sanitizer mode for untrusted inputs and re-sanitize fragments before assembly. </td></tr><tr><td data-label="Topic"><strong>SRI & CDN integrity</strong> </td><td data-label="Detailed explanation">Calls <code>_sri_attr(href, cdn_integrity)</code> when emitting <code>&lt;link&gt;</code> and <code>&lt;script&gt;</code>. <br>- This allows optional integrity attributes if <code>cdn_integrity</code> is provided. <br>- Ensure <code>_sri_attr</code> maps logical asset names to provided integrity values; document expected keys for <code>cdn_integrity</code>. </td></tr><tr><td data-label="Topic"><strong>Cross-platform & portability concerns</strong> </td><td data-label="Detailed explanation">- <code>os.path.relpath</code> can raise <code>ValueError</code> on Windows when drives differ; fallback to <code>&quot;assets&quot;</code> occurs but should be surfaced. <br>- Temporary file operations must occur on the same mount as the final path to allow atomic <code>os.replace</code>. <br>- Path to href conversion uses <code>.as_posix()</code> to produce web-friendly URLs; good practice. </td></tr><tr><td data-label="Topic"><strong>Error handling & warnings</strong> </td><td data-label="Detailed explanation">- Collects <code>warnings</code> list with dict items for downstream inspection. <br>- On fragment render failure it appends an error warning and proceeds to fallback. <br>- Suggest exposing structured warnings with severity codes and optional trace info in debug mode. </td></tr><tr><td data-label="Topic"><strong>Observability & metrics</strong> </td><td data-label="Detailed explanation">- Per-fragment timings exist in fragment metadata but <code>render_html</code> does not aggregate or include runtime metrics except <code>runtime_ms = 0</code>. <br>- Suggest aggregating fragment render times, write times, asset copy times, and total render time into returned metadata. </td></tr><tr><td data-label="Topic"><strong>Determinism & ordering</strong> </td><td data-label="Detailed explanation">- Fragments are iterated in <code>sorted(fragments_map.keys())</code> for stable order. <br>- Deduplication via hashing may change order if hashing differs; canonicalization recommended. </td></tr><tr><td data-label="Topic"><strong>Performance & scalability</strong> </td><td data-label="Detailed explanation">- For many or very large fragments, reading each fragment file into memory then writing may be heavy. <br>- Embedding large assets or very large inline JSON (lazy chunks) will bloat the HTML. <br>- For very large datasets prefer streaming output, paged endpoints, or deferred chunk fetches rather than embedding everything into a single HTML. </td></tr><tr><td data-label="Topic"><strong>UX & accessibility notes</strong> </td><td data-label="Detailed explanation">- Adds a visible search box and control buttons for global operations. <br>- Provides <code>role=&quot;region&quot;</code> and <code>aria-label</code> on main container and <code>aria-labelledby</code> on tables. <br>- Recommendations: add <code>aria-live</code> notifications for copy/export, ensure <code>tabindex</code> ordering for controls, and provide alternative text for non-JS fallback. </td></tr><tr><td data-label="Topic"><strong>Testing guidance</strong> </td><td data-label="Detailed explanation">Add unit + integration tests for: <br>- asset inclusion (embed vs external); <br>- relpath edge cases on Windows; <br>- fragment fallback path; <br>- dedupe determinism; <br>- atomic write fallbacks; <br>- worker shim correctness; <br>- <code>return_html=True</code> reading; <br>- sanitization correctness for extracted HTML. </td></tr><tr><td data-label="Topic"><strong>Security tests</strong> </td><td data-label="Detailed explanation">- XSS fuzzing for headers, inline HTML, and fragments. <br>- Ensure <code>json.dumps</code>-encoded JS variables cannot be injected. <br>- Validate that fragments produced by <code>render_fragments_concurrently</code> are safe or re-sanitized. </td></tr><tr><td data-label="Topic"><strong>Operational considerations</strong> </td><td data-label="Detailed explanation">- Ensure disk space for <code>tmp_frag_dir</code> and <code>assets_dir</code>. <br>- CI should run cross-platform tests (Linux/Windows/macOS). <br>- Logging configuration should be controllable to avoid leaking PII into logs. </td></tr><tr><td data-label="Topic"><strong>Actionable improvements (short list)</strong> </td><td data-label="Detailed explanation">1) Implement and honor <code>MarkdownRenderer</code> timeout and cache. <br>2) Re-sanitize fragments at assembly time or require fragments to be marked trusted. <br>3) Fix worker shim placeholder replacement bug. <br>4) Measure and populate <code>runtime_ms</code>. <br>5) Ensure <code>tmp_frag_dir</code> cleanup via context manager. <br>6) Improve dedupe hashing by canonical serialization. <br>7) Expose <code>materialize</code> semantics or remove param. <br>8) Emit structured logs and include aggregated metrics in return JSON. </td></tr><tr><td data-label="Topic"><strong>Actionable improvements (longer list)</strong> </td><td data-label="Detailed explanation">- Add <code>strict_assets</code> mode to fail fast if assets missing. <br>- Support streaming writer to avoid huge in-memory strings for very large pages. <br>- Add opt-in strict sanitizer mode requiring <code>sanitize_html</code>. <br>- Add progress callbacks or hooks for long render jobs. <br>- Surface warnings as structured machine-readable codes for upstream automation. </td></tr><tr><td data-label="Topic"><strong>Verification: 10 focused passes</strong> </td><td data-label="Detailed explanation">1) Path sanitization: <code>_sanitize_output_path</code> applied and output dir ensured. <br>2) Asset discovery: <code>prepare_assets</code> called; both embed and external modes exercised. <br>3) Markdown extraction: pipe-table and HTML extraction tested for varied inputs. <br>4) Dedup: duplicate tables produce single fragment after canonicalization test. <br>5) Fragment rendering: <code>render_fragments_concurrently</code> path succeeds and returns metadata. <br>6) Fallback path: when fragments empty, inline rendering path produces sanitized HTML. <br>7) Atomic write: <code>_default_write_atomic</code> and fallback <code>os.replace</code> tested for same-fs atomicity. <br>8) Worker shim: verify shim insertion and correct worker URL resolution. <br>9) href_prefix: relpath failure on different drives falls back and is logged. <br>10) Return payload: <code>result</code> contains warnings, counts, correct <code>output</code> path, and optionally <code>html</code> when <code>return_html=True</code>. </td></tr><tr><td data-label="Topic"><strong>Acceptance criteria</strong> </td><td data-label="Detailed explanation">- Final HTML file is written atomically in target location. <br>- All fragments are included in stable order or fall back to sanitized inline HTML. <br>- Asset references either embedded or linked correctly with <code>?v=</code> cache-busting and optional SRI. <br>- Warnings clearly report recoverable issues. <br>- <code>runtime_ms</code> and aggregated metrics are added before release. </td></tr><tr><td data-label="Topic"><strong>Risk summary</strong> </td><td data-label="Detailed explanation">- Moderate: unsanitized fragment content or external markdown renderers can introduce XSS. <br>- Low: atomic write fallback should be reliable but must run on same filesystem. <br>- Operational: long-running renders may exceed memory/time without streaming or chunked approaches. </td></tr><tr><td data-label="Topic"><strong>Rollout plan</strong> </td><td data-label="Detailed explanation">1) Add tests for critical paths and edge cases. <br>2) Implement top-priority fixes (sanitize fragments, fix shim bug, populate runtime_ms). <br>3) Release minor version with opt-in strict modes behind config flags. <br>4) Monitor logs and user reports. <br>5) Iterate with streaming/deferred-chunk features in follow-up. </td></tr></tbody></table></div><div class="row-count">Rows: 36</div></div><div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"><h3 id="table-6" class="table-heading">Table 6</h3></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Detailed explanation**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Detailed explanation</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><strong>File purpose & scope</strong> </td><td data-label="Detailed explanation">Utility helpers for the rendering pipeline. <br> Provides small, safe wrappers for common tasks used across <code>core_renderer</code>, <code>core_table</code>, <code>core_fragments</code>, and assets logic. <br> Focuses on sanitizing identifiers and output paths, a light HTML passthrough, building SRI attributes, quick fragment row detection, and a safe "take-and-stream" for iterables. <br> Intentionally minimal. Functions are stateless and designed to be low-risk, low-dependency building blocks. </td></tr><tr><td data-label="Topic"><strong>Design intent</strong> </td><td data-label="Detailed explanation">Keep utilities simple, predictable, and defensive. <br> Avoid heavy dependencies or complex logic in this module. <br> Make callers responsible for heavier security or normalization (e.g., full HTML sanitization lives in <code>sanitize.py</code>). <br> Provide fail-safe fallbacks so higher-level renderers can continue operating rather than crash. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sanitize_id</code> — purpose</strong> </td><td data-label="Detailed explanation">Turn arbitrary strings into valid, safe HTML <code>id</code> attributes. <br> Protects DOM selectors, CSS, and JavaScript that assume limited character sets. <br> Avoids injection via IDs and reduces chances of invalid markup that could break page behavior. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sanitize_id</code> — behavior</strong> </td><td data-label="Detailed explanation">Replaces every char not in <code>[A-Za-z0-9_-]</code> with <code>-</code>. <br> Collapses repeated dashes into one. <br> Strips leading/trailing dashes. <br> If result is empty uses fallback <code>id-{idx}</code>. <br> On exception returns fallback and logs debug. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sanitize_id</code> — edge cases</strong> </td><td data-label="Detailed explanation">Handles <code>None</code> and empty strings gracefully. <br> Preserves ASCII letters/digits, underscores, and hyphens. <br> Non-ASCII letters are replaced by <code>-</code> because regex only matches ASCII ranges; this intentionally avoids unusual unicode in IDs. <br> Collapsing avoids extremely long sequences of dashes from massively noisy input. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sanitize_output_path</code> — purpose</strong> </td><td data-label="Detailed explanation">Ensure the output target path is representable as a string. <br> Prevents crashes when callers pass non-string path-like objects that don't stringify cleanly. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sanitize_output_path</code> — behavior</strong> </td><td data-label="Detailed explanation">Returns <code>str(x)</code> on success. <br> If conversion fails logs debug and returns <code>&quot;output.html&quot;</code>. <br> Lightweight fail-safe suitable for most CI and scripted environments. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sanitize_output_path</code> — limitations & recommendations</strong> </td><td data-label="Detailed explanation">Does not enforce path safety (no directory traversal check, no absolute vs relative rules, no symlink resolution). <br> Suggestion: add optional normalization for platform-specific security. <br> Example: check for <code>..</code> segments, normalize unicode, and enforce same-filesystem temp writes when atomic replace is used. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sanitize_html_whitelist</code> — purpose</strong> </td><td data-label="Detailed explanation">Minimal pass-through for HTML-like content. <br> Acts as a placeholder when project-level sanitizer is not available. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sanitize_html_whitelist</code> — behavior</strong> </td><td data-label="Detailed explanation">Returns <code>str(s or &quot;&quot;)</code>. <br> Logs errors and returns empty string on exceptions. <br> Explicitly labeled as minimal; not a security control. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sanitize_html_whitelist</code> — security note</strong> </td><td data-label="Detailed explanation">This is <strong>not</strong> a sanitizer. It should never be relied upon to prevent XSS. <br> Higher-level modules must call <code>sanitize.py</code> or another robust sanitizer before including user-supplied HTML. <br> Action: mark usages in the codebase for audit and replace with strict sanitizer enforcement in a "strict mode". </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sri_attr</code> — purpose</strong> </td><td data-label="Detailed explanation">Helper to insert Subresource Integrity attributes into HTML tags when a mapping of URL→hash is provided. <br> Simplifies adding <code>integrity=&quot;&quot; crossorigin=&quot;anonymous&quot;</code> pairs at link/script emission time. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sri_attr</code> — behavior</strong> </td><td data-label="Detailed explanation">If <code>cdn_integrity</code> mapping provided and <code>url</code> exists in mapping returns <code> integrity=&quot;...&quot; crossorigin=&quot;anonymous&quot;</code>. <br> On error returns empty string and logs debug. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_sri_attr</code> — considerations</strong> </td><td data-label="Detailed explanation">Relies on exact URL key-match in <code>cdn_integrity</code>. <br> Caller must ensure that keys match emitted hrefs (including <code>?v=</code> query string handling). <br> Recommendation: canonicalize keys (strip query string) or allow pattern matching; document expected mapping format. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_frag_contains_rows</code> — purpose</strong> </td><td data-label="Detailed explanation">Quick heuristic to detect if an HTML fragment contains table rows. <br> Used to determine if fragment rendering produced actual table content or only structural shells. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_frag_contains_rows</code> — behavior</strong> </td><td data-label="Detailed explanation">Returns True if regex finds <code>&lt;tbody&gt;\s*&lt;tr</code> (case-insensitive). <br> Defensive try/except returns False on error and logs debug. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_frag_contains_rows</code> — limitations</strong> </td><td data-label="Detailed explanation">Only detects a specific pattern. <br> Will miss fragments that use <code>&lt;table&gt;&lt;tr&gt;</code> without <code>&lt;tbody&gt;</code>, or where <code>&lt;tbody&gt;</code> has attributes split across lines, or where whitespace/line breaks differ unusually. <br> Recommendation: broaden regex to allow optional attributes inside <code>&lt;tbody&gt;</code> and accept <code>&lt;table.*?&gt;&lt;tr</code> fallback. Add optional BeautifulSoup-based check if bs4 available for higher reliability. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_take_and_stream</code> — purpose</strong> </td><td data-label="Detailed explanation">Safely take <code>n</code> items from an iterable and return the first <code>n</code> as a list along with an iterator for the remainder. <br> Enables previewing or eager-processing of a small portion of a possibly large or streaming dataset without materializing the whole sequence. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_take_and_stream</code> — behavior</strong> </td><td data-label="Detailed explanation">Attempts to build an iterator from <code>rows_iterable</code>. <br> Iteratively pulls up to <code>n</code> items appending to <code>buf</code>. <br> Returns <code>(buf, remainder_iterator)</code>. <br> If initial iteration fails it tries a fallback: convert whole iterable to list and slice. <br> On catastrophic failure returns empty list and empty iterator. <br> Logs debug traces on fallback. </td></tr><tr><td data-label="Topic"><strong>Function: <code>_take_and_stream</code> — trade-offs</strong> </td><td data-label="Detailed explanation">Primary path preserves streaming laziness by returning remainder iterator that continues from same iterator. <br> Fallback path converts to list; can be memory-heavy if <code>rows_iterable</code> is huge. <br> This is a defensive compromise to handle broken iterables. <br> Recommendation: prefer callers to pass iterators when streaming behavior is required and handle fallback cases explicitly. </td></tr><tr><td data-label="Topic"><strong>Error handling philosophy</strong> </td><td data-label="Detailed explanation">Utilities favor continuity: log a debug-level message and return a safe default rather than raising. <br> This reduces fatal crashes in rendering pipelines but can mask upstream errors. <br> Recommendation: add an optional <code>strict</code> flag to make some utilities raise on invalid input for debug/test runs. </td></tr><tr><td data-label="Topic"><strong>Portability & cross-platform notes</strong> </td><td data-label="Detailed explanation">All code uses only Python stdlib; no platform-specific APIs. <br> Regexes and string operations behave consistently across platforms. <br> Path handling is left to callers (<code>core_renderer</code> uses Path/relpath). <br> This module's simplicity aids portability. </td></tr><tr><td data-label="Topic"><strong>Performance characteristics</strong> </td><td data-label="Detailed explanation">Functions are O(n) in input string length where regex is used. <br> <code>_take_and_stream</code> has near-constant overhead for small <code>n</code> and is efficient for streaming inputs. <br> Fallback list conversion is expensive and only occurs on error. <br> No heavy CPU or I/O operations. Suitable for high-frequency calls. </td></tr><tr><td data-label="Topic"><strong>Security posture</strong> </td><td data-label="Detailed explanation">The module intentionally avoids heavy security logic. <br> It provides helpful guards but not a full security stack. <br> The key security gap is <code>_sanitize_html_whitelist</code> which does not sanitize. <br> Consumers must ensure full sanitization via <code>sanitize.py</code> or other trusted libraries before rendering untrusted HTML. </td></tr><tr><td data-label="Topic"><strong>Usability & UX</strong> </td><td data-label="Detailed explanation">Functions produce consistent, human-readable fallbacks (e.g., <code>id-1</code>). <br> Default behaviors avoid crashing the app and provide reasonable outputs for UI components. <br> Logging is at debug level to avoid noisy logs in normal runs while still being available during development. </td></tr><tr><td data-label="Topic"><strong>Instrumentation & observability</strong> </td><td data-label="Detailed explanation">Current logging is debug-only which is appropriate for low-level utilities. <br> Suggestion: for production observability, add optional context-aware logging (table id, request id) passed from callers to help trace which input triggered a fallback. </td></tr><tr><td data-label="Topic"><strong>Test coverage recommendations</strong> </td><td data-label="Detailed explanation">Unit tests should cover: <br> - <code>_sanitize_id</code> with ASCII, unicode, emojis, long strings, empty/None; <br> - <code>_sanitize_output_path</code> with unusual objects and exceptions in <code>__str__</code>; <br> - <code>_sanitize_html_whitelist</code> with HTML-like payloads; <br> - <code>_sri_attr</code> with mapping present, missing, and with query-string mismatch; <br> - <code>_frag_contains_rows</code> with typical fragments, missing tbody, attributes on tbody, uppercase tags; <br> - <code>_take_and_stream</code> with real iterators, lists, generators that raise mid-iteration, and non-iterables. <br> Add property/fuzz tests for id normalization (roundtrip of various inputs). </td></tr><tr><td data-label="Topic"><strong>Actionable improvements (short list)</strong> </td><td data-label="Detailed explanation">1) Replace <code>_sanitize_html_whitelist</code> usages by a strict sanitizer in production paths, or add a <code>require_sanitizer</code> flag to surface errors. <br>2) Strengthen <code>_frag_contains_rows</code> regex to detect more table shapes and optionally use bs4 when present. <br>3) Add <code>strict</code> mode for functions to raise instead of silently returning defaults for safer CI testing. <br>4) Add optional context parameter for logging to link failures to higher-level render jobs. <br>5) Document expected behavior and limitations for integrators. </td></tr><tr><td data-label="Topic"><strong>Actionable improvements (longer list)</strong> </td><td data-label="Detailed explanation">- Provide normalized id canonicalization for Unicode (NFC/NFKC) before regex replacement. <br>- Offer path normalization with <code>os.path.normpath</code> and directory traversal checks in <code>_sanitize_output_path</code>. <br>- Allow <code>_sri_attr</code> to accept patterns or strip query strings when matching against mapping. <br>- Add an alternative <code>_frag_contains_rows_bs4</code> that uses BeautifulSoup when available for robust detection. <br>- Make <code>_take_and_stream</code> optionally limit the total memory used for fallback list conversion. </td></tr><tr><td data-label="Topic"><strong>Backward compatibility & migration notes</strong> </td><td data-label="Detailed explanation">Any tightening of <code>_sanitize_html_whitelist</code> must be coordinated with usage sites to avoid breaking pages that rely on lenient passthrough. <br> Introduce <code>strict</code> mode behind config flags and migrate callers incrementally. <br> Keep return shapes identical to avoid breaking callers. </td></tr><tr><td data-label="Topic"><strong>Deployment & rollout plan</strong> </td><td data-label="Detailed explanation">1) Add unit tests and static analysis for these utilities. <br>2) Introduce <code>strict</code> and <code>context</code> optional parameters. <br>3) Replace <code>_sanitize_html_whitelist</code> in high-risk callsites with enforced sanitizer in a minor release. <br>4) Monitor logs for debug-level fallback messages, promote recurring issues to warnings. <br>5) Document the utilities clearly for integrators. </td></tr><tr><td data-label="Topic"><strong>Verification checklist (10 passes)</strong> </td><td data-label="Detailed explanation">1) Validate <code>_sanitize_id</code> on diverse unicode sets and confirm expected dash substitution. <br>2) Check <code>_sanitize_output_path</code> for objects with throwing <code>__str__</code> to verify fallback. <br>3) Confirm <code>_sanitize_html_whitelist</code> simply stringifies and does not modify content. <br>4) Test <code>_sri_attr</code> with mapping keys and with missing keys. <br>5) Run <code>_frag_contains_rows</code> with fragments having <code>&lt;tbody&gt;</code> variants (attributes, whitespace, uppercase). <br>6) Run <code>_frag_contains_rows</code> on <code>&lt;table&gt;&lt;tr&gt;</code> without tbody to document false-negatives. <br>7) Test <code>_take_and_stream</code> with normal generator and confirm remainder continues yielding. <br>8) Test <code>_take_and_stream</code> with broken generator that raises mid-iteration and confirm fallback list path exercised. <br>9) Run performance microbenchmarks for <code>_take_and_stream</code> on large generator to confirm low overhead for small <code>n</code>. <br>10) Run static analysis and ensure no unsafe imports or side effects. </td></tr><tr><td data-label="Topic"><strong>Acceptance criteria</strong> </td><td data-label="Detailed explanation">- Utilities return expected default values on bad input. <br>- No unhandled exceptions propagate to render pipeline from these helpers. <br>- Unit tests cover edge cases and document limitations. <br>- Production callsites use robust sanitizer instead of <code>_sanitize_html_whitelist</code>. </td></tr><tr><td data-label="Topic"><strong>Final summary</strong> </td><td data-label="Detailed explanation"><code>core_utils.py</code> is a small, well-focused set of defensive helpers. <br> Strengths: simplicity, portability, non-fatal defaults. <br> Weaknesses: minimal HTML handling that is intentionally not a sanitizer, and a few narrow pattern-based checks that may miss edge cases. <br> Priorities: tighten sanitization usage, widen fragment detection, add <code>strict</code> mode for CI, and document the module clearly for integrators. </td></tr></tbody></table></div><div class="row-count">Rows: 34</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759557027" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>