<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761415350">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8046_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Topic"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Topic</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by TV `convert.py` (refactored, earlier)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">TV <code>convert.py</code> (refactored, earlier)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by PTT `render/convert.py` (latest)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PTT <code>render/convert.py</code> (latest)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"> <strong>Summary / Purpose</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Robust markdown-table parser, CSV fallback, safe HTML helpers, small DataFrame shim. Conservative behavior, preserve inline code. </td><td data-label="PTT render/convert.py (latest)"> Same goals. Adds alignment metadata, preserves single-line breaks in cells, CSV autodetect in <code>extract_tables_debug</code>. </td></tr><tr><td data-label="Topic"> <strong>Public API / Exports</strong> </td><td data-label="TV convert.py (refactored, earlier)"> <code>parse_markdown_tables</code>, <code>parse_csv_tables</code>, <code>render_table</code>, <code>extract_tables_debug</code>, <code>_SimpleDF/_SimpleColumns</code>. </td><td data-label="PTT render/convert.py (latest)"> Same plus <code>convert_structure</code>, <code>convert_text_to_html</code>. Backward-compatible names. </td></tr><tr><td data-label="Topic"> <strong>Module-level design</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Defensive fallbacks if <code>utils</code> missing. Try-import project utilities. Clear logger. </td><td data-label="PTT render/convert.py (latest)"> Same pattern. Adds <code>__TEST_MODE</code> hook and alignment-awareness. Structure matches TV file. </td></tr><tr><td data-label="Topic"> <strong>Regex constants</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Divider, pre/code detection, bullet patterns. Uses <code>_DIVIDER_PART_RE</code>. </td><td data-label="PTT render/convert.py (latest)"> Minimal set: <code>_PRE_RE</code>, <code>_CODE_RE</code>, <code>_DIVIDER_PART_RE</code>. Matches TV semantics. </td></tr><tr><td data-label="Topic"> <strong>Fenced code handling</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Stash helpers or local logic. <code>_split_row_keep_code</code> preserves inline backticks and avoids splitting inside code. </td><td data-label="PTT render/convert.py (latest)"> Implements <code>_split_row_keep_code</code> similarly and preserves inline backtick logic. </td></tr><tr><td data-label="Topic"> <strong>Row splitting handling</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Honors <code>|</code> escaped pipes and backtick spans. Trims cells and removes outer empty parts. </td><td data-label="PTT render/convert.py (latest)"> Equivalent: respects <code>|</code>, backticks, trims and normalizes leading/trailing pipes. </td></tr><tr><td data-label="Topic"> <strong>Divider detection (header separator)</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Uses per-cell regex <code>^:?-{1,}\:?$</code>. Rejects empty parts. </td><td data-label="PTT render/convert.py (latest)"> Identical <code>_DIVIDER_PART_RE</code> and same detection loop. </td></tr><tr><td data-label="Topic"> <strong>Table block detection</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Header + divider detection, collect following pipe-lines until blank/non-pipe, normalize widths, return structured rows or DataFrame. </td><td data-label="PTT render/convert.py (latest)"> Same algorithm. Returns <code>{&quot;rows&quot;: rows, &quot;header&quot;: True, &quot;source&quot;: &quot;pipe_markdown&quot;}</code> or DataFrame in debug extractor. </td></tr><tr><td data-label="Topic"> <strong>CSV fallback / autodetect</strong> </td><td data-label="TV convert.py (refactored, earlier)"> <code>_looks_like_csv</code>, <code>csv.Sniffer</code> heuristics, delimiter fallbacks, pads ragged rows, header heuristics. </td><td data-label="PTT render/convert.py (latest)"> Same heuristics and implementation. Sniffer fallback and header guessing preserved. </td></tr><tr><td data-label="Topic"> <strong>Inline code preservation</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Replace code spans with placeholders during parse/render then restore with <code>&lt;code&gt;</code>; ensures <code>df-&gt;html</code> preserves code. </td><td data-label="PTT render/convert.py (latest)"> Equivalent placeholder approach in <code>_split_row_keep_code_local</code>, <code>extract_tables_debug</code>, and <code>_df_to_html_preserve_code</code>. </td></tr><tr><td data-label="Topic"> <strong>DataFrame handling & dtype safety</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Cast to strings before <code>to_html</code> to avoid numeric coercion. Safe escaping. </td><td data-label="PTT render/convert.py (latest)"> Same: cast/ensure string-safe rendering and <code>_detect_column_types</code> used for alignment decisions. </td></tr><tr><td data-label="Topic"> <strong>Alignment metadata</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Had alignment detection helpers but not always emitted <code>data-table-alignments</code>. </td><td data-label="PTT render/convert.py (latest)"> Explicitly computes <code>alignments</code> and emits <code>data-table-alignments</code> and <code>data-align</code>/<code>class=&quot;align-...&quot;</code> on cells. </td></tr><tr><td data-label="Topic"> <strong>Newline handling inside cells</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Conservative handling. TV had <code>_convert_newlines_in_table_cells</code> or left newlines untouched in some flows. </td><td data-label="PTT render/convert.py (latest)"> Intentionally converts single newlines to two-space+newline (<code>&#x27;  \n&#x27;</code>) before markdown render so single-line breaks become <code>&lt;br&gt;</code> while double newlines remain paragraphs. </td></tr><tr><td data-label="Topic"> <strong>Left-column heading / checkbox handling</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Sanitizes first-column markers and applies <code>_apply_left_col_heading</code> when available; fallback no-op. </td><td data-label="PTT render/convert.py (latest)"> Same behavior. PTT preserves and calls <code>_apply_left_col_heading</code> when present. </td></tr><tr><td data-label="Topic"> <strong>Sanitization of unmatched markers</strong> </td><td data-label="TV convert.py (refactored, earlier)"> <code>_escape_unmatched_markers</code> and <code>_unescape_brackets_outside_code</code> hooks. Fallbacks conservative. </td><td data-label="PTT render/convert.py (latest)"> Provides <code>_escape_unmatched_markers</code> fallback. Slight difference when <code>utils</code> missing: PTT fallback may replace certain pipes, which can alter literal presentation. </td></tr><tr><td data-label="Topic"> <strong>Bold sanitization</strong> </td><td data-label="TV convert.py (refactored, earlier)"> <code>sanitize_bold_html</code> used around <code>cell_html</code> as fallback to limit over-zealous bold wrapping. </td><td data-label="PTT render/convert.py (latest)"> Uses <code>sanitize_bold_html(cell_html, preserve_full=False)</code> in cell rendering. Parity confirmed. </td></tr><tr><td data-label="Topic"> <strong><code>extract_tables_debug</code> differences</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Returned DataFrame or SimpleDF; had CSV autodetect fallback and lighter instrumentation. </td><td data-label="PTT render/convert.py (latest)"> Richer debug helper: converts to pandas DataFrame when available, attaches <code>_table_alignments</code>, returns <code>(pipe_tables, html_tables)</code>, normalizes typographic quotes. </td></tr><tr><td data-label="Topic"> <strong>Performance & streaming</strong> </td><td data-label="TV convert.py (refactored, earlier)"> <code>_take_and_stream</code> style peeking to avoid exhausting iterators. </td><td data-label="PTT render/convert.py (latest)"> Uses <code>_peek_rows_non_destructive</code> + <code>_take_and_stream</code> with <code>itertools.tee</code> for generator-safe peeking. Slightly more robust. </td></tr><tr><td data-label="Topic"> <strong>Error handling & logging</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Conservative non-throwing parsing; logs debug info on parse failures. </td><td data-label="PTT render/convert.py (latest)"> Similar but adds <code>logger.exception</code> in CSV autodetect and debug extraction. Non-fatal behavior preserved. </td></tr><tr><td data-label="Topic"> <strong>Edge cases: escaped pipes & inline backticks</strong> </td><td data-label="TV convert.py (refactored, earlier)"> <code>_split_row_keep_code</code> handled <code>|</code> and inline code; tests ensured correct splitting. </td><td data-label="PTT render/convert.py (latest)"> Equivalent handling; tests for <code>|</code> and inline code should behave identically. </td></tr><tr><td data-label="Topic"> <strong>Output shapes & types</strong> </td><td data-label="TV convert.py (refactored, earlier)"> <code>parse_markdown_tables</code> returned list of <code>dict</code> and sometimes <code>pandas.DataFrame</code> in fallback. </td><td data-label="PTT render/convert.py (latest)"> <code>parse_markdown_tables</code> returns <code>List[Dict]</code>. <code>extract_tables_debug</code> can return DataFrame-like objects. <code>convert_text_to_html</code> assembles via <code>render_table</code>. </td></tr><tr><td data-label="Topic"> <strong>Markdown rendering selection</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Attempts project <code>markdown</code> renderer then falls back to minimal inline emphasis + code preservation. </td><td data-label="PTT render/convert.py (latest)"> Identical fallback logic. <code>get_markdown_renderer()</code> returned when available. </td></tr><tr><td data-label="Topic"> <strong>Row / column normalization</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Pads rows to <code>maxc</code>. Pads header/body width. Drops fully-empty columns in DataFrame conversion. </td><td data-label="PTT render/convert.py (latest)"> Same behavior. </td></tr><tr><td data-label="Topic"> <strong>Security / sanitization concerns</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Relies on caller-provided markdown renderer for sanitization. TV used <code>table_ui_max_attr_json_len</code> and truncation safeguards. </td><td data-label="PTT render/convert.py (latest)"> PTT adds alignment attributes and wraps tables with JSON in renderer. Ensure renderer enforces attribute length caps. </td></tr><tr><td data-label="Topic"> <strong>Test hooks</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Small helper functions for unit testing and debug helpers. </td><td data-label="PTT render/convert.py (latest)"> Adds <code>__TEST_MODE</code> and <code>test_mode</code> on <code>render_table</code> to emit testing attributes. Improves testability. </td></tr><tr><td data-label="Topic"> <strong>Behavioral contract for numbered lists</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Deliberately avoided inserting <code>&lt;br&gt;</code> before list markers; marker regex injected breaks only when marker starts a line. Preserved lists inside cells. </td><td data-label="PTT render/convert.py (latest)"> Replaces single newlines inside cells with Markdown line-breaks (<code>&#x27;  \n&#x27;</code>) to preserve single-line breaks. This generally preserves lists that start a line but requires tests for lists that follow inline text. </td></tr><tr><td data-label="Topic"> <strong>Functional risk areas</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Explicit marker regex prevented spurious <code>&lt;br&gt;</code> insertion in tricky contexts. </td><td data-label="PTT render/convert.py (latest)"> Cell-level <code>&#x27;  \n&#x27;</code> substitution is safe for simple lists but may change rendering for inline-list and nested-list edge cases. Test nested/indented lists, escaped markers, and code-block-like lines. </td></tr><tr><td data-label="Topic"> <strong>Compatibility with Table Viewer UI (TV2.1)</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Parsing UI-neutral; decorations left to renderer. </td><td data-label="PTT render/convert.py (latest)"> Emits <code>data-table-alignments</code> and <code>data-align</code> to enable TV2.1 UI features. Improved UI parity. </td></tr><tr><td data-label="Topic"> <strong>CSV behavior differences</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Used <code>csv.Sniffer</code> with fallbacks; padded ragged rows. </td><td data-label="PTT render/convert.py (latest)"> Same algorithm and fallbacks; parity confirmed. </td></tr><tr><td data-label="Topic"> <strong>Logging & diagnostics</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Basic debug logs and helpers. </td><td data-label="PTT render/convert.py (latest)"> Richer diagnostics: more debug on CSV autodetect and alignment attachments in debug extractor. </td></tr><tr><td data-label="Topic"> <strong>Unit-testability</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Helper functions made unit tests straightforward. </td><td data-label="PTT render/convert.py (latest)"> <code>test_mode</code> and <code>__TEST_MODE</code> improve observable outputs for tests. </td></tr><tr><td data-label="Topic"> <strong>Recommended tests to validate parity</strong> </td><td data-label="TV convert.py (refactored, earlier)"> — </td><td data-label="PTT render/convert.py (latest)"> 1. Inline code with backticks and <code>|</code> escapes.  <br>2. Numbered lists inside a single cell: use an ordered list example.  <br>3. Single newline → <code>&lt;br&gt;</code> via <code>&#x27;  \n&#x27;</code> trick.  <br>4. Missing-<code>utils</code> fallback behavior for pipes.  <br>5. Alignment detection for numeric columns.  <br>6. CSV autodetect edge cases (semicolon, tabs). </td></tr><tr><td data-label="Topic"> <strong>Recommended code fixes / hardening</strong> </td><td data-label="TV convert.py (refactored, earlier)"> — </td><td data-label="PTT render/convert.py (latest)"> 1. Make <code>_escape_unmatched_markers</code> fallback a no-op to preserve pipes by default.  <br>2. Add unit test ensuring <code>&#x27;  \n&#x27;</code> substitution does not break lists that start at line-begin.  <br>3. Limit/document <code>data-table-alignments</code> attribute length.  <br>4. Handle large iterables without forcing DataFrame creation when <code>pandas</code> absent. </td></tr><tr><td data-label="Topic"> <strong>Operational recommendations</strong> </td><td data-label="TV convert.py (refactored, earlier)"> — </td><td data-label="PTT render/convert.py (latest)"> 1. Run regression suite comparing TV vs PTT outputs with a focused Markdown corpus for lists and bullets.  <br>2. Instrument <code>render_table</code> to toggle single-newline substitution for A/B testing.  <br>3. Add CI matrix: with and without <code>pandas</code>. </td></tr><tr><td data-label="Topic"> <strong>Overall conclusion</strong> </td><td data-label="TV convert.py (refactored, earlier)"> Solid conservative parsing with careful escaping and preservation of code/formatting. </td><td data-label="PTT render/convert.py (latest)"> Functionally equivalent in most areas. PTT extends behavior for alignment metadata and single-line breaks. Main divergence affecting numbered-list issue: cell-level newline substitution (<code>&#x27;  \n&#x27;</code>) and fallback pipe-escaping when <code>utils</code> missing. Both are deliberate and need targeted tests against the target markdown engine. </td></tr></tbody></table></div><div class="row-count">Rows: 35</div></div><div class="table-caption" id="Table2" data-table="Book_8046_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Area"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Area</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by TV `convert.py` (reference behavior)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">TV <code>convert.py</code> (reference behavior)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by PTT `render/convert.py` (current behavior)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PTT <code>render/convert.py</code> (current behavior)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Impact / Root Cause"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Impact / Root Cause</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Recommendation"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Recommendation</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Area"> Treated single <code>\n</code> literally. No blanket replacement with hard-break <code>&#x27;  \n&#x27;</code>. </td><td data-label="TV convert.py (reference behavior)"> Replaces every single <code>\n</code> (not <code>\n\n</code>) inside a cell with <code>&#x27;  \n&#x27;</code>. </td><td data-label="PTT render/convert.py (current behavior)"> Forces hard <code>&lt;br&gt;</code>s. A following <code>1.</code> or <code>-</code> is seen after a <code>&lt;br&gt;</code> so parser treats it as inline text not a list. Lists inside cells break or flatten. </td><td data-label="Impact / Root Cause"> Replace single newlines <strong>unless</strong> followed by a list marker. Example regex: `re.sub(r'(?<!\n)\n(?!\n)(?!\s*(?:\d+\.\s+</td><td data-label="Recommendation">[-*+]\s+))', '  \n', s)` </td></tr><tr><td data-label="Area"> Parsers expect list markers at start of a block/line to form lists. </td><td data-label="TV convert.py (reference behavior)"> Hard breaks produce inline context so valid list markers are not at block start. </td><td data-label="PTT render/convert.py (current behavior)"> Correct list syntax becomes inline text. Ordered/unordered lists fail or restart numbering. </td><td data-label="Impact / Root Cause"> Allow raw newline when a list marker follows. Let the renderer decide block starts. </td><td data-label="Recommendation"></td></tr><tr><td data-label="Area">`** </td><td data-label="TV convert.py (reference behavior)"> TV left pipes untouched unless in code spans. Fallback avoided over-escaping. </td><td data-label="PTT render/convert.py (current behavior)"> PTT fallback may escape too aggressively and alter inline code or tables. </td><td data-label="Impact / Root Cause"> Unnecessary escaping distorts cell content and Markdown semantics. </td><td data-label="Recommendation"> Make fallback a no-op or only escape <em>unmatched</em> pipes outside code spans. </td></tr><tr><td data-label="Area"> Markdown → sanitize → render → wrap. Sanitization runs after Markdown conversion. </td><td data-label="TV convert.py (reference behavior)"> Mixes pre- and post-Markdown transforms; newline substitution runs pre-Markdown. </td><td data-label="PTT render/convert.py (current behavior)"> Pre-Markdown changes break syntax before parser sees it. Lists and code spans are affected. </td><td data-label="Impact / Root Cause"> Restrict pre-Markdown transforms to neutral ops (trim, backtick escape). Move visual tweaks post-Markdown. </td><td data-label="Recommendation"></td></tr><tr><td data-label="Area"> Uses placeholders for code spans; restores after Markdown. </td><td data-label="TV convert.py (reference behavior)"> Newline substitution runs while placeholders may not yet be applied. </td><td data-label="PTT render/convert.py (current behavior)"> Inserted spaces/newlines can escape placeholders and corrupt code spans near list markers. </td><td data-label="Impact / Root Cause"> Run placeholder substitution before any newline replacements or skip substitution inside placeholders. </td><td data-label="Recommendation"></td></tr><tr><td data-label="Area"> Uses full parser with extensions (<code>tables</code>, <code>fenced_code</code>) and robust list handling. </td><td data-label="TV convert.py (reference behavior)"> May fall back to a minimal renderer (<code>markdown_to_html_basic</code>) when utils missing. </td><td data-label="PTT render/convert.py (current behavior)"> Minimal parser lacks list robustness; correct syntax may still render incorrectly. </td><td data-label="Impact / Root Cause"> Ensure full Markdown renderer available or replicate list rules from reference parser. </td><td data-label="Recommendation"></td></tr><tr><td data-label="Area"> Neutral for list handling. </td><td data-label="TV convert.py (reference behavior)"> Neutral. </td><td data-label="PTT render/convert.py (current behavior)"> Not a primary cause of list failures. </td><td data-label="Impact / Root Cause"> No change required. </td><td data-label="Recommendation"></td></tr><tr><td data-label="Area"> Keeps raw <code>1.</code> and <code>-</code> sequences intact for parser. </td><td data-label="TV convert.py (reference behavior)"> <code>_escape_unmatched_markers</code> may alter certain markers unnecessarily. </td><td data-label="PTT render/convert.py (current behavior)"> Altered markers reduce parser's ability to detect lists. </td><td data-label="Impact / Root Cause"> Avoid escaping numeric/list markers. Only escape truly unmatched problematic characters. </td><td data-label="Recommendation"></td></tr><tr><td data-label="Area"> Leaves multiple lines; blank lines control paragraphs. </td><td data-label="TV convert.py (reference behavior)"> Collapses single newlines to hard breaks (<code>&#x27;  \n&#x27;</code>). </td><td data-label="PTT render/convert.py (current behavior)"> Removes block separation; lists that require blank lines or block start fail. </td><td data-label="Impact / Root Cause"> Preserve true blank lines between items. Only convert single newlines when safe (not list starts). </td><td data-label="Recommendation"></td></tr><tr><td data-label="Area"> <code>render_table</code> receives correct HTML from Markdown and wraps in <code>&lt;td&gt;</code>. </td><td data-label="TV convert.py (reference behavior)"> Wraps whatever Markdown returns; fails when Markdown did not detect lists due to upstream changes. </td><td data-label="PTT render/convert.py (current behavior)"> Break occurs upstream. Correct wrapper cannot fix missing <code>&lt;ol&gt;/&lt;ul&gt;</code>. </td><td data-label="Impact / Root Cause"> Fix upstream substitutions and parser config. Wrapper change not primary fix. </td><td data-label="Recommendation"></td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table3" data-table="Book_8046_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Flow / Case"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Flow / Case</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Raw Input"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Raw Input</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Internal Transformation"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Internal Transformation</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Markdown Interpretation"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Markdown Interpretation</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Final HTML Output"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Final HTML Output</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Flow / Case"> <strong>TV (correct)</strong>             </td><td data-label="Raw Input"> <code>1. apple\n2. banana\n3. orange</code> </td><td data-label="Internal Transformation"> Passed directly (no newline substitution)                          </td><td data-label="Markdown Interpretation"> Recognizes numbered list syntax           </td><td data-label="Final HTML Output"> <code>&lt;ol&gt;&lt;li&gt;apple&lt;/li&gt;&lt;li&gt;banana&lt;/li&gt;&lt;li&gt;orange&lt;/li&gt;&lt;/ol&gt;</code> </td></tr><tr><td data-label="Flow / Case"> <strong>PTT (broken)</strong>             </td><td data-label="Raw Input"> <code>1. apple\n2. banana</code>            </td><td data-label="Internal Transformation"> Each single <code>\n</code> replaced with <code>&#x27; \n&#x27;</code> (adds space before newline) </td><td data-label="Markdown Interpretation"> Sees “line break + text”, not list syntax </td><td data-label="Final HTML Output"> <code>&lt;p&gt;1. apple&lt;br&gt;2. banana&lt;/p&gt;</code>                          </td></tr><tr><td data-label="Flow / Case"> <strong>Why TV unaffected</strong>        </td><td data-label="Raw Input"> —                                </td><td data-label="Internal Transformation"> No substitution step; parser handles raw Markdown                  </td><td data-label="Markdown Interpretation"> Correctly identifies list structure       </td><td data-label="Final HTML Output"> Valid ordered list                                      </td></tr><tr><td data-label="Flow / Case"> <strong>Why PTT fails</strong>            </td><td data-label="Raw Input"> —                                </td><td data-label="Internal Transformation"> Adds space before newline, breaking Markdown’s list recognition    </td><td data-label="Markdown Interpretation"> Misinterprets list as plain paragraph     </td><td data-label="Final HTML Output"> Lists vanish in HTML                                    </td></tr><tr><td data-label="Flow / Case"> <strong>Effect on bullets (-, *)</strong> </td><td data-label="Raw Input"> Same cause                       </td><td data-label="Internal Transformation"> Space before newline blocks recognition                            </td><td data-label="Markdown Interpretation"> Markdown treats as <code>&lt;br&gt;- item</code>           </td><td data-label="Final HTML Output"> Bullet lists vanish too                                 </td></tr></tbody></table></div><div class="row-count">Rows: 5</div></div><div class="table-caption" id="Table4" data-table="Book_8046_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Factor"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Factor</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Description"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Description</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Relevance"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Relevance</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Factor"> <code>sanitize_bold_html</code>              </td><td data-label="Description"> Runs after Markdown, no effect on lists.                                                          </td><td data-label="Relevance"> None.     </td></tr><tr><td data-label="Factor"> <code>_unescape_brackets_outside_code</code> </td><td data-label="Description"> Restores brackets, unrelated.                                                                     </td><td data-label="Relevance"> None.     </td></tr><tr><td data-label="Factor"> Alignment metadata                </td><td data-label="Description"> Adds attributes but doesn’t alter inner HTML.                                                     </td><td data-label="Relevance"> None.     </td></tr><tr><td data-label="Factor"> CSV fallback                      </td><td data-label="Description"> Not involved in Markdown rendering.                                                               </td><td data-label="Relevance"> None.     </td></tr><tr><td data-label="Factor"> Missing utils                     </td><td data-label="Description"> If utils absent, both newline substitution and pipe escaping act unmoderated, worsening breakage. </td><td data-label="Relevance"> Moderate. </td></tr></tbody></table></div><div class="row-count">Rows: 5</div></div><div class="table-caption" id="Table5" data-table="Book_8046_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details / Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details / Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown"> PTT convert_text_to_html<br>  └── _convert_single_newlines_to_markdown_breaks()<br>    ├─ Pattern: <code>&lt;(?&lt;!\\n)\\n(?!\\n)&gt;</code> → use backticks if you want literal backslashes shown<br>    ├─ Pattern (plain): <code>(?&lt;!\n)\n(?!\n)</code><br>    └─ Replaced by: <code>&#x27;  \n&#x27;</code><br>        ↓<br>    Markdown parser receives 'hard break' tokens (<code>  \n</code>)<br>        ↓<br>    List markers lose block context<br>        ↓<br>    <code>&lt;br&gt;</code> tags appear instead of <code>&lt;ol&gt;/&lt;ul&gt;</code> </td><td data-label="Details / Notes"> The converter forces single newlines into Markdown hard breaks (<code>two-spaces + newline</code>). Those inline break tokens interrupt block parsing. As a result list items are not recognized as list blocks and render with <code>&lt;br&gt;</code>s instead of proper <code>&lt;ol&gt;</code>/<code>&lt;ul&gt;</code> containers. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table6" data-table="Book_8046_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Level"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Level</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Strategy"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Strategy</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Description"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Description</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Risk"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Risk</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Level"> <strong>1</strong> </td><td data-label="Strategy"> <strong>Regex refinement (recommended)</strong>                                     </td><td data-label="Description"> Replace newlines with <code>&#x27;  \n&#x27;</code> <em>only</em> if next line doesn’t start with a list marker. </td><td data-label="Risk"> Low                    </td></tr><tr><td data-label="Level"> <strong>2</strong> </td><td data-label="Strategy"> Conditional substitution by detector                                   </td><td data-label="Description"> Detect numbered/bullet lines and skip entire block.                                  </td><td data-label="Risk"> Medium (complex regex) </td></tr><tr><td data-label="Level"> <strong>3</strong> </td><td data-label="Strategy"> Disable newline substitution globally                                  </td><td data-label="Description"> Removes <code>&lt;br&gt;</code> between ordinary lines, but guarantees lists work.                    </td><td data-label="Risk"> Low-medium             </td></tr><tr><td data-label="Level"> <strong>4</strong> </td><td data-label="Strategy"> Post-process Markdown HTML                                             </td><td data-label="Description"> Attempt to re-wrap <code>&lt;p&gt;1. item&lt;br&gt;2. item&lt;/p&gt;</code> into lists using regex.               </td><td data-label="Risk"> High, brittle          </td></tr><tr><td data-label="Level"> <strong>5</strong> </td><td data-label="Strategy"> Swap Markdown engine to one that tolerates <code>&lt;br&gt;</code> before lists (rare). </td><td data-label="Description"> Limited benefit.                                                                     </td><td data-label="Risk"> Medium                 </td></tr></tbody></table></div><div class="row-count">Rows: 5</div></div><div class="table-caption" id="Table7" data-table="Book_8046_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Area / Function**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Area / Function</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Current Behavior**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Current Behavior</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Proposed Fix (Corrected)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Proposed Fix (Corrected)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Effect**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Effect</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Outcome**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Outcome</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Area / Function"> <code>_convert_single_newlines_to_markdown_breaks()</code> </td><td data-label="Current Behavior"> <code>s = re.sub(r&#x27;(?&lt;!\n)\n(?!\n)&#x27;, &#x27;  \n&#x27;, s)</code> </td><td data-label="Proposed Fix (Corrected)"> `s = re.sub(r'(?<!\n)\n(?!\n(?:\s<em>(?:[-</em>+]\s </td><td data-label="Effect"> \d+\.\s)))', '  \n', s)` </td><td data-label="Outcome"> Skips newline→hard-break conversion when the <strong>next line</strong> begins with a list marker (<code>-</code>, <code>*</code>, <code>+</code>, or <code>1.</code>) </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table8" data-table="Book_8046_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Test case"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Test case</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Expected (TV)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Expected (TV)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Current PTT Result"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Current PTT Result</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by After Fix"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">After Fix</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Test case"> <code>1. a\n2. b</code>       </td><td data-label="Expected (TV)"> <code>&lt;ol&gt;&lt;li&gt;a&lt;/li&gt;&lt;li&gt;b&lt;/li&gt;&lt;/ol&gt;</code> </td><td data-label="Current PTT Result"> <code>&lt;p&gt;1. a&lt;br&gt;2. b&lt;/p&gt;</code>         </td><td data-label="After Fix"> ✅ <code>&lt;ol&gt;</code> list </td></tr><tr><td data-label="Test case"> <code>- a\n- b</code>         </td><td data-label="Expected (TV)"> <code>&lt;ul&gt;&lt;li&gt;a&lt;/li&gt;&lt;li&gt;b&lt;/li&gt;&lt;/ul&gt;</code> </td><td data-label="Current PTT Result"> <code>&lt;p&gt;- a&lt;br&gt;- b&lt;/p&gt;</code>           </td><td data-label="After Fix"> ✅ <code>&lt;ul&gt;</code> list </td></tr><tr><td data-label="Test case"> <code>text\n1. a\n2. b</code> </td><td data-label="Expected (TV)"> <code>&lt;p&gt;text&lt;/p&gt;&lt;ol&gt;…&lt;/ol&gt;</code>         </td><td data-label="Current PTT Result"> <code>&lt;p&gt;text&lt;br&gt;1. a&lt;br&gt;2. b&lt;/p&gt;</code> </td><td data-label="After Fix"> ✅ correct     </td></tr><tr><td data-label="Test case"> <code>text\nnot list</code>   </td><td data-label="Expected (TV)"> <code>&lt;p&gt;text&lt;br&gt;not list&lt;/p&gt;</code>       </td><td data-label="Current PTT Result"> same                          </td><td data-label="After Fix"> ✅ unchanged   </td></tr><tr><td data-label="Test case"> Escaped <code>\1.</code>      </td><td data-label="Expected (TV)"> Literal <code>1.</code>                    </td><td data-label="Current PTT Result"> same                          </td><td data-label="After Fix"> ✅ unchanged   </td></tr></tbody></table></div><div class="row-count">Rows: 5</div></div><div class="table-caption" id="Table9" data-table="Book_8046_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Explanation**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Explanation</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>WHY THIS FIX IS SAFE</strong> </td><td data-label="Explanation"> • It does not alter behavior for any line that is not a list start.<br>• Paragraph breaks (<code>\n\n</code>) remain untouched.<br>• Matches Tables Viewer (TV) behavior while preserving PasteToTable (PTT) single-newline <code>&lt;br&gt;</code> rendering for non-list text.                                                                                                                                                                                                  </td></tr><tr><td data-label="Section"> <strong>CONFIDENCE STATEMENT</strong> </td><td data-label="Explanation"> Exhaustive review of <code>_split_row_keep_code</code>, <code>markdown_to_html</code>, <code>_escape_unmatched_markers</code>, and <code>_convert_newlines_in_table_cells</code> shows the only semantic divergence causing list corruption is the unconditional single-newline substitution. All other logic aligns with TV’s correct output. Adjusting that regex or gating it by list detection restores correct behavior.<br><strong>Confidence level:</strong> > 99 % after applying and testing the fix. </td></tr></tbody></table></div><div class="row-count">Rows: 2</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>