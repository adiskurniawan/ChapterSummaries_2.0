<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1769960840">
<link rel="stylesheet" href="assets/overrides.css?v=1771304621">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li>
<li class="toc-item"><a class="toc-link" href="#Table10">Table 10</a></li>
<li class="toc-item"><a class="toc-link" href="#Table11">Table 11</a></li>
<li class="toc-item"><a class="toc-link" href="#Table12">Table 12</a></li>
<li class="toc-item"><a class="toc-link" href="#Table13">Table 13</a></li>
<li class="toc-item"><a class="toc-link" href="#Table14">Table 14</a></li>
<li class="toc-item"><a class="toc-link" href="#Table15">Table 15</a></li>
<li class="toc-item"><a class="toc-link" href="#Table16">Table 16</a></li>
<li class="toc-item"><a class="toc-link" href="#Table17">Table 17</a></li>
<li class="toc-item"><a class="toc-link" href="#Table18">Table 18</a></li>
<li class="toc-item"><a class="toc-link" href="#Table19">Table 19</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0103_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1 • html_renderer.py</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Content**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Content</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>File Name</strong>                        </td><td data-label="Content"> <code>html_renderer.py</code>                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Mode</strong>                             </td><td data-label="Content"> <code>Analysis</code>                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>Imports and Initialization</strong>       </td><td data-label="Content"> Uses standard libraries (<code>os</code>, <code>pathlib</code>, <code>re</code>, <code>json</code>, <code>html</code>, <code>logging</code>, <code>urllib.parse</code>) plus internal fallbacks for rendering. Establishes <code>_project_root</code> and ensures it’s in <code>sys.path</code>.                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Renderer Placeholders</strong>            </td><td data-label="Content"> Declares <code>render_html</code>, <code>render_table</code>, <code>render_page</code> as optional callables. Sets up optional helpers (<code>convert_bullets_to_ul</code>, <code>_normalize_list_markers</code>, <code>_unescape_brackets_outside_code</code>, <code>prepare_assets</code>, <code>write_overrides_css</code>).                                                                                                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Configuration System</strong>             </td><td data-label="Content"> <code>_DEFAULTS</code> defines runtime behavior flags such as <code>ensure_title</code>, <code>minify_html</code>, and asset paths. Values are read from environment variables and converted via <code>_bool_from_env()</code>. Mutable config stored in <code>_renderer_config</code>. Functions <code>set_renderer_config()</code> and <code>get_renderer_config()</code> manage it safely.                                                                                                         </td></tr><tr><td data-label="Section"> <strong>Diagnostics & Logging</strong>            </td><td data-label="Content"> <code>_record()</code> appends messages to <code>_try_msgs</code> (a ring buffer). <code>get_import_diagnostics()</code> returns a full import summary (presence of renderers and helpers). <code>_logger</code> configured as <code>NullHandler</code> by default.                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Regex Patterns</strong>                   </td><td data-label="Content"> Multiple precompiled regex patterns manage HTML sections (<code>&lt;head&gt;</code>, <code>&lt;body&gt;</code>, <code>&lt;table&gt;</code>, <code>&lt;h1&gt;</code>, etc.). Used for manipulation and injection of assets or attributes.                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section"> <strong>H1 Attribute Normalization</strong>       </td><td data-label="Content"> <code>_ensure_title_in_h1_fragment()</code> and <code>_ensure_title_attrs_in_str()</code> ensure every <code>&lt;h1&gt;</code> has consistent <code>id</code> and <code>class</code> attributes (configurable). Handles malformed HTML gracefully.                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>HTML Minification</strong>                </td><td data-label="Content"> <code>_minify_html_str()</code> collapses whitespace outside protected tags (<code>&lt;script&gt;</code>, <code>&lt;pre&gt;</code>, etc.). Split and reconstruct via <code>_MINIFY_TOKEN_RE</code>.                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Byte Processing</strong>                  </td><td data-label="Content"> <code>_process_bytes()</code> decodes HTML byte output, applies title/minify post-processing, and re-encodes safely. Ensures UTF-8 fallback.                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>UI Asset Injection</strong>               </td><td data-label="Content"> <code>_inject_ui_assets()</code> ensures configured CSS/JS assets are linked exactly once. Uses basename normalization to avoid duplicates. Injects <code>&lt;link&gt;</code> or <code>&lt;script&gt;</code> tags near <code>&lt;/head&gt;</code> or <code>&lt;/body&gt;</code>.                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>Table Enhancement Pipeline</strong>       </td><td data-label="Content"> <code>_convert_newlines_in_table_cells()</code> replaces raw newlines with <code>&lt;br&gt;</code> unless inside <code>&lt;pre&gt;</code>/<code>&lt;code&gt;</code> blocks. <code>_wrap_each_table_with_ui()</code> wraps each <code>&lt;table&gt;</code> in a <code>.table-wrapper</code> container, adds headings, assigns unique IDs, and embeds JSON metadata (<code>data-ptt-json</code> or <code>&lt;script type=&quot;application/json&quot;&gt;</code>). Prevents double-wrapping via context detection.                                                    </td></tr><tr><td data-label="Section"> <strong>Unified Callable Wrapper</strong>         </td><td data-label="Content"> <code>_wrap_callable()</code> decorates functions (like <code>render_html</code>) so their output automatically passes through title enforcement, minification, asset injection, and table wrapping. Maintains metadata (<code>__wrapped__</code>, <code>__tv_wrapped__</code>).                                                                                                                                                                                     </td></tr><tr><td data-label="Section"> <strong>Import Fallback Chain</strong>            </td><td data-label="Content"> Progressive attempts: 1️⃣ <code>render.core_compat</code> → 2️⃣ <code>render.core_renderer</code> → 3️⃣ fallback pure-Python implementations. All results logged to <code>_try_msgs</code>.                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>Fallback Implementations</strong>         </td><td data-label="Content"> Defines <code>_fallback_render_html()</code>, <code>_fallback_render_table()</code>, <code>_fallback_render_page()</code> to provide minimal HTML rendering with DataFrame-safe conversions via <code>_df_to_str_safe()</code> and <code>_df_to_html_preserve_code()</code>.                                                                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>HTML Post-Processing Integration</strong> </td><td data-label="Content"> Fallback renderers are wrapped with <code>_wrap_callable()</code> to apply the same transformations and maintain consistent output.                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Section"> <strong>Diagnostics Report</strong>               </td><td data-label="Content"> <code>generate_diagnostic_report()</code> gathers runtime info and processes sample HTML for validation. Used for debugging renderer consistency.                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Flask App Factory</strong>                </td><td data-label="Content"> <code>create_app()</code> provides a minimal Flask API backend (<code>/</code>, <code>/api/convert</code>, <code>/api/render</code>, <code>/api/health</code>) when external renderers are absent. Supports JSON input, size limits, and security headers.                                                                                                                                                                                                                      </td></tr><tr><td data-label="Section"> <strong>Exports</strong>                          </td><td data-label="Content"> <code>__all__</code> explicitly lists all public API symbols for controlled external import.                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>Conceptual Summary</strong>               </td><td data-label="Content"> <code>html_renderer.py</code> is a modular post-processing and fallback orchestration layer that standardizes how HTML output is rendered, cleaned, and augmented. It acts as the glue between rendering engines (core, compat, or fallback) and runtime presentation standards (titles, minification, UI assets, table wrappers). It’s both a library (callable renderers) and a minimal HTTP API backend when deployed via Flask. </td></tr></tbody></table></div><div class="row-count">Rows: 20</div></div><div class="table-caption" id="Table2" data-table="Docu_0103_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2 • main.py</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Content**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Content</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>File Name</strong>                  </td><td data-label="Content"> <code>main.py</code>                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Mode</strong>                       </td><td data-label="Content"> <code>Analysis</code>                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Section"> <strong>Purpose and Role</strong>           </td><td data-label="Content"> Serves as the primary entry point for the <em>PasteToTable</em> system. Controls environment initialization, runtime mode selection (batch vs web), and coordination between parsing, rendering, and exporting operations.                                                                                                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Imports and Setup</strong>          </td><td data-label="Content"> Imports <code>os</code>, <code>sys</code>, <code>pathlib</code>, <code>logging</code>, and project-local modules (<code>html_renderer</code>, <code>convert</code>, <code>io_utils</code>, etc.). Ensures <code>_project_root</code> is added to <code>sys.path</code>. Configures default logging with safety for missing handlers.                                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Environment Initialization</strong> </td><td data-label="Content"> Calls <code>load_env()</code> or similar setup function from utilities to read <code>.env</code> or system environment variables. Defines working directories for input, output, and temporary files. Ensures idempotent directory creation.                                                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>Mode Selection</strong>             </td><td data-label="Content"> Uses command-line arguments, environment flags, or <code>if __name__ == &quot;__main__&quot;:</code> block to determine execution mode. Two main modes:<br>1️⃣ <strong>Batch Mode</strong> — Parse Markdown or CSV tables from file input.<br>2️⃣ <strong>Web Mode</strong> — Launch Flask app from <code>html_renderer.create_app()</code>.                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Batch Mode Logic</strong>           </td><td data-label="Content"> Loads Markdown, CSV, or mixed textual inputs. Detects tables using <code>convert.detect_tables()</code> or similar logic. Converts tables to structured objects (DataFrames, list-of-lists). Applies normalization, escaping, and output path routing. Writes CSV + JSON + HTML fragments to output directory. Logs metadata for auditing.                                                                      </td></tr><tr><td data-label="Section"> <strong>Web Mode Logic</strong>             </td><td data-label="Content"> Invokes <code>html_renderer.create_app()</code> to start minimal Flask API (<code>/</code>, <code>/api/render</code>, <code>/api/convert</code>). Enables runtime HTML rendering for pasted or uploaded data. Handles graceful fallback if Flask unavailable.                                                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Renderer Integration</strong>       </td><td data-label="Content"> Dynamically attempts to import <code>render_html</code> from <code>html_renderer</code> or use fallback inline renderer. Maintains consistent transformation chain: raw Markdown → parsed DataFrame → HTML fragment → sanitized final output.                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Error Handling</strong>             </td><td data-label="Content"> Wraps runtime in <code>try/except</code> to catch initialization errors, renderer import failures, or malformed input. Logs structured error reports and exits cleanly.                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Section"> <strong>Logging and Diagnostics</strong>    </td><td data-label="Content"> Maintains runtime logs under <code>/logs</code> or environment-defined path. Provides summary on completion (files processed, tables extracted, errors, and skipped entries).                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Output Management</strong>          </td><td data-label="Content"> Organizes converted assets into <code>/output</code> or timestamped directories. Ensures atomic write operations. Supports overwrite safety and optional minified HTML output.                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Extensibility</strong>              </td><td data-label="Content"> Designed to integrate with auxiliary modules (<code>io_utils</code>, <code>sanitize</code>, <code>convert</code>). Maintains modular architecture allowing new renderers or parsers to be registered.                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Section"> <strong>Conceptual Summary</strong>         </td><td data-label="Content"> <code>main.py</code> is the orchestration hub of the <em>PasteToTable</em> project. It initializes the runtime environment, selects execution mode, and coordinates all subsystems for input ingestion, table conversion, and HTML rendering. It functions as both a <strong>batch command processor</strong> and <strong>web application entrypoint</strong>, ensuring consistent normalization, logging, and error handling across both modes. </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><div class="table-caption" id="Table3" data-table="Docu_0103_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3 • server.py</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Aspect**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Aspect</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"> <strong>Filename</strong>                </td><td data-label="Conceptual Summary"> <code>server.py</code>                                                                                                                                                                                                                        </td></tr><tr><td data-label="Aspect"> <strong>Core Role</strong>               </td><td data-label="Conceptual Summary"> Acts as the main HTTP interface and orchestration layer between client, renderers, and storage. Provides a Flask-based microservice for converting markdown, saving files, serving assets, and listing stored results.             </td></tr><tr><td data-label="Aspect"> <strong>Architecture</strong>            </td><td data-label="Conceptual Summary"> Modular Flask app factory (<code>create_app</code>) with optional middlewares (CORS, Limiter). Independent helper layer for safe file IO, markdown preprocessing, and fallback rendering.                                                     </td></tr><tr><td data-label="Aspect"> <strong>Rendering Logic</strong>         </td><td data-label="Conceptual Summary"> Delegates markdown → HTML transformation to <code>html_renderer.render_from_text</code> or dynamically discovered fallback converters. Wraps result in metadata envelope (<code>html</code>, <code>meta</code>, <code>ok</code>, etc.).                                        </td></tr><tr><td data-label="Aspect"> <strong>Preprocessing Utilities</strong> </td><td data-label="Conceptual Summary"> <code>_strip_ref_footnotes</code> removes reference-style footnotes. <code>_escape_leading_list_markers_in_table_cells</code> escapes list markers in pipe tables to prevent mis-parsing.                                                                </td></tr><tr><td data-label="Aspect"> <strong>Storage Model</strong>           </td><td data-label="Conceptual Summary"> Uses <code>STORAGE_PATH</code> for persistence. Implements atomic writes via <code>_atomic_write_bytes_to_path</code>. Supports HTML (<code>/save</code>) and Markdown (<code>/save-md</code>) paths.                                                                          </td></tr><tr><td data-label="Aspect"> <strong>Grouping System</strong>         </td><td data-label="Conceptual Summary"> <code>/groups/index</code> and <code>/groups_index.json</code> endpoints expose logical collections of saved Markdown files. Grouping based on filename prefixes stripped of numeric suffixes.                                                           </td></tr><tr><td data-label="Aspect"> <strong>Endpoints</strong>               </td><td data-label="Conceptual Summary"> <code>/convert</code>: Render markdown → HTML. <code>/save</code>: Store rendered HTML. <code>/save-md</code>: Split and store markdown tables. <code>/saved/index</code>: List saved files. <code>/groups/index</code>: Provide grouped file metadata. <code>/health</code>: Basic readiness check. </td></tr><tr><td data-label="Aspect"> <strong>Error Handling</strong>          </td><td data-label="Conceptual Summary"> Robust exception wrapping with structured JSON responses and detailed logging. Graceful degradation when optional dependencies (<code>flask_cors</code>, <code>flask_limiter</code>, <code>html_renderer</code>) are missing.                                       </td></tr><tr><td data-label="Aspect"> <strong>Performance & Safety</strong>    </td><td data-label="Conceptual Summary"> Enforces max upload size, optional rate limiting, atomic writes, and cache busting. Supports no-cache headers for list renders.                                                                                                    </td></tr><tr><td data-label="Aspect"> <strong>Integration Points</strong>      </td><td data-label="Conceptual Summary"> Imports optional <code>utils.make_logger</code> and <code>utils.write_groups_index</code>. Interacts with optional <code>render.io_utils</code> and <code>html_renderer</code> modules.                                                                                        </td></tr><tr><td data-label="Aspect"> <strong>Meta Summary</strong>            </td><td data-label="Conceptual Summary"> A self-contained Flask microservice providing rendering, persistence, and lightweight index management for markdown → HTML workflows.                                                                                              </td></tr></tbody></table></div><div class="row-count">Rows: 12</div></div><div class="table-caption" id="Table4" data-table="Docu_0103_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4 • utils.py</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Section"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Section</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Summary"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Summary</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Purpose</strong>                       </td><td data-label="Conceptual Summary"> <code>utils.py</code> provides shared utility functions for PasteToTable and Table Viewer subsystems. It consolidates environment management, logging, atomic file I/O, markdown parsing, directory scanning, and JSON label/group indexing. It standardizes core operations with safety, caching, and validation layers.          </td></tr><tr><td data-label="Section"> <strong>Environment Helpers</strong>           </td><td data-label="Conceptual Summary"> <code>load_env</code> reads <code>.env</code> files into dictionaries, respecting overrides and ignoring malformed lines. Used for environment bootstrapping without modifying <code>os.environ</code>.                                                                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Logging Helpers</strong>               </td><td data-label="Conceptual Summary"> <code>init_logger</code> and <code>make_logger</code> configure consistent console-based logging with custom formatters and propagation control. Ensure idempotent creation and uniform output.                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>Filesystem / IO Helpers</strong>       </td><td data-label="Conceptual Summary"> Functions like <code>ensure_dir</code>, <code>safe_join</code>, <code>safe_remove</code>, and <code>atomic_write</code> handle directory creation, traversal prevention, atomic writes via tempfiles, and secure deletion. Designed to avoid race conditions or path traversal exploits.                                                                            </td></tr><tr><td data-label="Section"> <strong>Checksum / Conversion</strong>         </td><td data-label="Conceptual Summary"> <code>checksum_file</code> computes hash digests safely. <code>try_int</code> provides tolerant int conversion.                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>Markdown / Table Parsing</strong>      </td><td data-label="Conceptual Summary"> Utilities (<code>split_table_row</code>, <code>is_table_separator</code>, <code>parse_table</code>) safely parse markdown tables, respecting escapes and inline code. Helpers for whitespace normalization, slug creation, and comment stripping maintain clean text.                                                                                    </td></tr><tr><td data-label="Section"> <strong>Group Indexing</strong>                </td><td data-label="Conceptual Summary"> <code>scan_table_groups</code> recursively groups saved tables by filename or folder, extracting short descriptions from files. Combined functions (<code>generate_groups_index</code>, <code>validate_groups_index</code>, <code>write_groups_index</code>, <code>read_groups_index</code>) manage JSON index generation with validation, atomic writes, and backup rotation. </td></tr><tr><td data-label="Section"> <strong>Backup Rotation</strong>               </td><td data-label="Conceptual Summary"> <code>_rotate_backups</code> cycles JSON backup files safely, preserving prior states up to <code>_BACKUP_KEEP</code> generations.                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Labels Management</strong>             </td><td data-label="Conceptual Summary"> Locates, validates, and caches <code>labels.json</code> metadata for caption lookup. Supports environment override, multiple search paths, LRU caching, and atomic writes. Validation ensures sane string lengths and disallows control characters.                                                                                </td></tr><tr><td data-label="Section"> <strong>Data Merging / Caption Lookup</strong> </td><td data-label="Conceptual Summary"> <code>merged_labels</code> merges two dicts case-insensitively with conflict resolution. <code>get_caption_for</code> retrieves human-readable captions from labels by filename stem.                                                                                                                                                         </td></tr><tr><td data-label="Section"> <strong>Export Layer</strong>                  </td><td data-label="Conceptual Summary"> <code>__all__</code> defines stable API surface with backward alias <code>load_labels_json_cached</code>.                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section"> <strong>Overall Concept</strong>               </td><td data-label="Conceptual Summary"> The file is a self-contained foundational toolkit providing reliability, safety, and compatibility primitives for upper-layer HTML/table rendering and JSON management systems.                                                                                                                                         </td></tr></tbody></table></div><div class="row-count">Rows: 12</div></div><div class="table-caption" id="Table5" data-table="Docu_0103_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5 • __init__.py</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Content**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Content</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>File Name</strong>                 </td><td data-label="Content"> <code>__init__.py</code>                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Section"> <strong>Mode</strong>                      </td><td data-label="Content"> <code>Analysis</code>                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Section"> <strong>Imports</strong>                   </td><td data-label="Content"> Imports three key rendering functions — <code>render_html</code>, <code>render_table</code>, and <code>render_page</code> — directly from the local module <code>core_compat</code>.                                                                                                           </td></tr><tr><td data-label="Section"> <strong>Exports</strong>                   </td><td data-label="Content"> Defines <code>__all__</code> as <code>[&quot;render_html&quot;, &quot;render_table&quot;, &quot;render_page&quot;]</code>, explicitly exposing only these public APIs to consumers of the package.                                                                                                     </td></tr><tr><td data-label="Section"> <strong>Role in Package Structure</strong> </td><td data-label="Content"> Serves as the entry point for the rendering package, ensuring consistent top-level imports (<code>from package import render_html</code>). Abstracts internal module structure from users.                                                                    </td></tr><tr><td data-label="Section"> <strong>Dependency Path</strong>           </td><td data-label="Content"> Hard dependency on <code>core_compat</code> — if that module fails to import or define these functions, package-level imports will raise an ImportError. No fallback or try/except protection.                                                                </td></tr><tr><td data-label="Section"> <strong>Conceptual Summary</strong>        </td><td data-label="Content"> <code>__init__.py</code> acts as a minimal façade for exposing rendering functions from <code>core_compat</code>. It simplifies public API access and enforces a consistent import surface, but depends entirely on the internal <code>core_compat</code> module for functionality. </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><div class="table-caption" id="Table6" data-table="Docu_0103_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6 • assets.py</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Content**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Content</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>File Name</strong>                                                            </td><td data-label="Content"> <code>assets.py</code>                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Mode</strong>                                                                 </td><td data-label="Content"> <code>Analysis</code>                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>Imports and Constants</strong>                                                </td><td data-label="Content"> Imports <code>os</code> and <code>shutil</code>. Defines two embedded fallback assets as strings: <code>_EMBED_STYLE</code> (minimal CSS theme) and <code>_EMBED_SCRIPT</code> (no-op JS). These serve as last-resort content if asset files are missing.                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Function: <code>copy_assets(output_dir)</code></strong>                                  </td><td data-label="Content"> Creates <code>output_dir/assets</code>. Attempts to copy <code>style.css</code> and <code>script.js</code> from the project’s <code>assets/</code> directory (assumed one level above current module).                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>Normal Operation</strong>                                                     </td><td data-label="Content"> If the source asset directory exists, it loops through the expected files, copying each to the output.                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Missing or Error Handling</strong>                                            </td><td data-label="Content"> If a file is missing or copy fails, it writes fallback content from <code>_EMBED_STYLE</code> or <code>_EMBED_SCRIPT</code> directly into destination files. Ensures that minimal usable assets always exist.                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Complete Fallback Path</strong>                                               </td><td data-label="Content"> If the project’s <code>assets/</code> directory doesn’t exist at all, it writes both fallback files into the destination.                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Section"> <strong>Function: <code>write_overrides_css(output_dir, left_width, right_width)</code></strong> </td><td data-label="Content"> Creates or ensures existence of <code>output_dir/assets</code>. Builds a CSS string defining layout, theme, and table rules with dynamic width values based on <code>left_width</code> and <code>right_width</code>.                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Section"> <strong>Generated CSS Features</strong>                                               </td><td data-label="Content"> 1️⃣ Theme variables for light/dark mode (<code>--header-bg</code>, <code>--text</code>, etc.)<br>2️⃣ Sticky first column behavior and zebra striping.<br>3️⃣ Dark-mode header highlight contrast.<br>4️⃣ Table header alignment and proportional width settings.<br>5️⃣ List marker normalization within table cells (custom bullets and counters).                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Write Behavior</strong>                                                       </td><td data-label="Content"> Writes the constructed CSS to <code>overrides.css</code> in <code>output_dir/assets</code>. If writing fails, the function ignores the error silently but still returns the generated CSS string.                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Design Intent</strong>                                                        </td><td data-label="Content"> Guarantees that all rendering outputs have consistent baseline assets, even if primary assets are missing or inaccessible. Supports predictable layout and theme uniformity across dark/light modes and tables with nested lists.                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>Error Strategy</strong>                                                       </td><td data-label="Content"> Best-effort, silent-failure policy ensures no runtime crash from missing files or permissions.                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Section"> <strong>Conceptual Summary</strong>                                                   </td><td data-label="Content"> <code>assets.py</code> provides resilient asset management for rendering output. It ensures CSS and JS assets are always present by copying real project files when available and writing embedded fallbacks otherwise. It also dynamically generates <code>overrides.css</code> with consistent light/dark theme variables and proportional table widths, enforcing visual uniformity and graceful degradation in offline or deployment-limited environments. </td></tr></tbody></table></div><div class="row-count">Rows: 13</div></div><div class="table-caption" id="Table7" data-table="Docu_0103_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7 • cli.py</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Content**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Content</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>File Name</strong>                                           </td><td data-label="Content"> <code>cli.py</code>                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Section"> <strong>Mode</strong>                                                </td><td data-label="Content"> <code>Analysis</code>                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>Purpose</strong>                                             </td><td data-label="Content"> Provides a minimal and robust command-line interface (CLI) to invoke HTML table rendering via <code>render_html</code>, supporting optional asset embedding and output directory control.                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Imports</strong>                                             </td><td data-label="Content"> Uses <code>argparse</code>, <code>sys</code>, and <code>pathlib.Path</code> for command-line parsing and file path management. Attempts internal imports of <code>render_html</code> and <code>RenderConfig</code> from <code>render.core_compat</code>, <code>render.types</code>, and fallback <code>render</code>.                                                                     </td></tr><tr><td data-label="Section"> <strong>Import Fallbacks</strong>                                    </td><td data-label="Content"> Progressive fallback logic ensures availability of <code>render_html</code> and <code>RenderConfig</code>. The import chain tolerates missing submodules or differing package structures (<code>render.core_compat</code>, <code>render</code>, <code>render.types</code>).                                                                              </td></tr><tr><td data-label="Section"> <strong>Function: <code>parse_args(argv)</code></strong>                        </td><td data-label="Content"> Defines CLI arguments:<br>• <code>source</code>: input file or directory path.<br>• <code>--output / -o</code>: output directory (default <code>output_combined</code>).<br>• <code>--embed-assets</code>: boolean flag for inlining assets.<br>Returns parsed arguments namespace.                                                           </td></tr><tr><td data-label="Section"> <strong>Function: <code>_make_config(output_path, embed_assets)</code></strong> </td><td data-label="Content"> Safely constructs a <code>RenderConfig</code> instance using multiple potential constructor signatures (<code>output_dir</code>, <code>output_path</code>, <code>output</code>, or empty). Returns <code>None</code> if all attempts fail. Ensures resilience to API drift across versions.                                                              </td></tr><tr><td data-label="Section"> <strong>Function: <code>main(argv=None)</code></strong>                         </td><td data-label="Content"> Entry point of the CLI.<br>1️⃣ Parses arguments.<br>2️⃣ Builds <code>RenderConfig</code> (if available).<br>3️⃣ Invokes <code>render_html</code> using most compatible signature, preferring <code>config=</code> keyword.<br>4️⃣ Falls back to simpler signatures (<code>render_html(src, out)</code> or <code>render_html(src)</code>) when necessary. </td></tr><tr><td data-label="Section"> <strong>Error Handling</strong>                                      </td><td data-label="Content"> Wraps multiple <code>try/except</code> layers to gracefully handle signature mismatches, missing constructors, or absent optional modules. Returns from whichever render attempt succeeds first.                                                                                                             </td></tr><tr><td data-label="Section"> <strong>CLI Invocation</strong>                                      </td><td data-label="Content"> Guarded by <code>if __name__ == &quot;__main__&quot;:</code> → executes <code>main()</code> through <code>SystemExit</code> for standard CLI termination semantics.                                                                                                                                                                          </td></tr><tr><td data-label="Section"> <strong>Design Philosophy</strong>                                   </td><td data-label="Content"> Focuses on runtime adaptability and cross-version stability. Never assumes consistent constructor or import layout. Avoids hard crashes by cascading through known-safe fallbacks.                                                                                                                </td></tr><tr><td data-label="Section"> <strong>Edge Cases Handled</strong>                                  </td><td data-label="Content"> • Missing <code>RenderConfig</code> class.<br>• Incompatible constructor arguments.<br>• Absent or incompatible <code>render_html</code> modules.<br>• CLI called without output argument.<br>• Nonexistent file paths (delegated to <code>render_html</code>).                                                                    </td></tr><tr><td data-label="Section"> <strong>Output Behavior</strong>                                     </td><td data-label="Content"> Returns HTML render result or triggers writing via <code>render_html</code>. No local file I/O beyond argument handling—delegates all rendering logic downstream.                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Conceptual Summary</strong>                                  </td><td data-label="Content"> <code>cli.py</code> functions as a defensive, minimal entry point to the rendering pipeline. It abstracts version differences, import ambiguities, and configuration inconsistencies, ensuring that the <code>render_html</code> function can be executed from the command line in any supported environment.           </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><div class="table-caption" id="Table8" data-table="Docu_0103_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8 • convert.py</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Module Overview</strong> </td><td data-label="Conceptual Summary"> <code>convert.py</code> is a conversion and table-rendering engine. It bridges Markdown, CSV, and HTML table structures into a unified HTML rendering layer with Markdown-to-HTML conversion, delimiter detection, column-type inference, and inline formatting preservation. Designed for robustness, autodetection, and fallback rendering. </td></tr><tr><td data-label="Section"> <strong>Purpose</strong> </td><td data-label="Conceptual Summary"> Parse, clean, normalize, and render tabular or Markdown-like input into safe, styled HTML tables. Integrates Markdown rendering, sanitization, CSV sniffing, and code-block preservation. </td></tr><tr><td data-label="Section"> <strong>Input Types</strong> </td><td data-label="Conceptual Summary"> Raw Markdown text, plain CSV text, or HTML snippets containing table-like structures. </td></tr><tr><td data-label="Section"> <strong>Output</strong> </td><td data-label="Conceptual Summary"> Safe HTML representation of tables with metadata, formatting preservation, and accessibility attributes (captions, aria-labels). </td></tr><tr><td data-label="Section"> <strong>Key Functional Areas</strong> </td><td data-label="Conceptual Summary"> 1. Table detection/extraction (<code>extract_tables_debug</code>, <code>parse_markdown_tables</code>, <code>parse_csv_tables</code>).<br>2. Code/marker preservation (<code>_stash_code_spans</code>, <code>_restore_code_spans</code>).<br>3. Delimiter & column heuristics (<code>_detect_column_types</code>, <code>_looks_like_csv</code>).<br>4. Rendering/layout (<code>render_table</code>).<br>5. Fallback utilities for missing libs. </td></tr><tr><td data-label="Section"> <strong>Dependencies</strong> </td><td data-label="Conceptual Summary"> Core libs: <code>re</code>, <code>csv</code>, <code>io</code>, <code>html</code>, <code>itertools</code>, <code>logging</code>, <code>collections.Counter</code>. Optional: <code>pandas</code>, <code>markdown</code>. </td></tr><tr><td data-label="Section"> <strong>Key Classes</strong> </td><td data-label="Conceptual Summary"> <code>_SimpleColumns</code> and <code>_SimpleDF</code> provide DataFrame-like structures for environments without <code>pandas</code>. </td></tr><tr><td data-label="Section"> <strong>Major Functions</strong> </td><td data-label="Conceptual Summary"> <code>_unescape_brackets_outside_code</code>, <code>_peek_rows_non_destructive</code>, <code>_detect_column_types</code>, <code>_split_row_keep_code</code>, <code>_looks_like_csv</code>, <code>parse_csv_tables</code>, <code>parse_markdown_tables</code>, <code>extract_tables_debug</code>, <code>_get_default_markdown_renderer</code>, <code>render_table</code>. </td></tr><tr><td data-label="Section"> <strong>Data Flow</strong> </td><td data-label="Conceptual Summary"> Text input → sanitization → structure detection → table extraction → alignment inference → HTML rendering. Each step degrades gracefully on error. </td></tr><tr><td data-label="Section"> <strong>Markdown Handling</strong> </td><td data-label="Conceptual Summary"> Inline code stashed/restored; emphasis markers converted; unknown markdown safely escaped when richer renderer not available. </td></tr><tr><td data-label="Section"> <strong>CSV Logic</strong> </td><td data-label="Conceptual Summary"> Prefer <code>csv.Sniffer</code> for delimiter detection; fallback to manual delimiter counts (<code>,</code>, <code>;</code>, <code>\t</code>). Header inference uses heuristics when <code>Sniffer</code> fails. </td></tr><tr><td data-label="Section"> <strong>Alignment Strategy</strong> </td><td data-label="Conceptual Summary"> Numeric-like columns aligned right; text columns left. Stored in <code>_table_alignments</code> or inferred dynamically. </td></tr><tr><td data-label="Section"> <strong>Rendering Strategy</strong> </td><td data-label="Conceptual Summary"> Each HTML table includes a caption, wrapper <code>&lt;div&gt;</code> with metadata, toolbar buttons (copy/export), sort controls with ARIA, and diagnostic block for empty/invalid tables. </td></tr><tr><td data-label="Section"> <strong>Fallback Modes</strong> </td><td data-label="Conceptual Summary"> Use <code>_SimpleDF</code> if <code>pandas</code> unavailable. Use internal <code>_simple_md</code> if Markdown lib missing. Provide local replacements for missing utilities. </td></tr><tr><td data-label="Section"> <strong>Logging and Debugging</strong> </td><td data-label="Conceptual Summary"> Uses <code>logging</code> with <code>NullHandler</code> by default. Debug traces written on fallback paths for Markdown and CSV failures. </td></tr><tr><td data-label="Section"> <strong>Performance Notes</strong> </td><td data-label="Conceptual Summary"> Lazy iteration via <code>_take_and_stream</code>. Previews limited to 5 rows for sampling. Precompiled regexes. Avoids full in-memory DataFrame when inputs are large. </td></tr><tr><td data-label="Section"> <strong>Safety / Sanitization</strong> </td><td data-label="Conceptual Summary"> Escapes HTML entities and strips tags from untrusted sources. All dynamic content escaped with <code>html.escape</code>. </td></tr><tr><td data-label="Section"> <strong>Edge Case Handling</strong> </td><td data-label="Conceptual Summary"> Handles BOMs, zero-width chars, uneven Markdown rows, escaped pipes (<code>\|</code>), multi-line cells, and backtick-enclosed code spans. </td></tr><tr><td data-label="Section"> <strong>Testing & Debug</strong> </td><td data-label="Conceptual Summary"> <code>extract_tables_debug</code> is the diagnostic entrypoint. Returns parsed pipe tables and HTML tables for inspection. </td></tr><tr><td data-label="Section"> <strong>Extensibility Points</strong> </td><td data-label="Conceptual Summary"> <code>markdown_to_html_func</code> param allows richer renderers. Could add direct HTML <code>&lt;table&gt;</code> parsing or structured object outputs for UIs. </td></tr><tr><td data-label="Section"> <strong>Internal Design Principle</strong> </td><td data-label="Conceptual Summary"> Self-healing parsing: prefer fallback output over raising. Emphasizes idempotence and resilience. </td></tr><tr><td data-label="Section"> <strong>Integration Targets</strong> </td><td data-label="Conceptual Summary"> Intended for use by <code>html_renderer.py</code> or similar preprocessing modules. Feeds visualizers or documentation tools. </td></tr><tr><td data-label="Section"> <strong>Output Semantics</strong> </td><td data-label="Conceptual Summary"> Deterministic HTML layout with fixed button set. Alignment and caption metadata embedded for client-side interactivity. </td></tr><tr><td data-label="Section"> <strong>Limitations</strong> </td><td data-label="Conceptual Summary"> No full CommonMark support. Heuristic alignment only. Large files may use significant memory. <code>pandas</code> optional. No async streaming. </td></tr><tr><td data-label="Section"> <strong>Overall Architecture Role</strong> </td><td data-label="Conceptual Summary"> Core normalizer within a documentation/HTML rendering subsystem. Converts semi-structured text into structured, styled, interactive HTML with consistent fallbacks. </td></tr></tbody></table></div><div class="row-count">Rows: 25</div></div><div class="table-caption" id="Table9" data-table="Docu_0103_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9 • core_assets.py</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module Purpose</strong>                      </td><td data-label="Conceptual Summary"> <code>core_assets.py</code> provides robust, fault-tolerant asset preparation, copying, hashing, and manifest generation utilities. It forms the backbone of the rendering asset pipeline, ensuring reproducible, safe asset management even under partial environment failure.                                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Core Design</strong>                         </td><td data-label="Conceptual Summary"> The file builds a multi-layer fallback structure: prefer <code>core_io</code> helpers if present; fallback to local atomic implementations otherwise. Each public API is safe, idempotent, and default-preserving. Every action logs but does not crash on failure.                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Atomic File Operations</strong>              </td><td data-label="Conceptual Summary"> Implements <code>_fallback_atomic_write</code> and <code>_fallback_atomic_copy</code> to prevent partial writes and race conditions. Each uses temporary files in the same directory and atomic <code>os.replace</code>. Optional integration with <code>core_io</code>’s atomic utilities if available.                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Directory Safety</strong>                    </td><td data-label="Conceptual Summary"> <code>_ensure_dir_dispatch</code> abstracts directory creation with multiple fallback paths. Ensures that asset paths are always writeable before use.                                                                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Placeholder and Text Writers</strong>        </td><td data-label="Conceptual Summary"> <code>_safe_write_text</code> and <code>_ensure_non_empty_file</code> guarantee that output files are never zero bytes. Used throughout to ensure minimal valid content even when asset sources are missing.                                                                                                                         </td></tr><tr><td data-label="Logic / Structure"> <strong>Hashing and Integrity</strong>               </td><td data-label="Conceptual Summary"> <code>compute_sri</code> produces W3C-compliant Subresource Integrity strings. <code>_compute_hash_hex</code> enables fingerprint-based versioning and reproducibility. <code>_insert_hash_before_ext</code> safely modifies filenames to include fingerprints.                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Asset Discovery</strong>                     </td><td data-label="Conceptual Summary"> <code>_discover_candidate_asset_dirs</code> inspects multiple hierarchical levels: repository root, current working directory, and sibling packages. Returns prioritized candidates for copy attempts.                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Copying Policy</strong>                      </td><td data-label="Conceptual Summary"> <code>_copy_from_source_assets</code> enforces copy policies with whitelist, blacklist, max size, and fingerprinting rules. It performs selective copying with atomic semantics and logs skipped assets.                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Manifests and Diagnostics</strong>           </td><td data-label="Conceptual Summary"> <code>write_assets_manifest</code> serializes metadata (timestamp, file size, mtime, SRI) and optional logical–physical mappings. <code>write_assets_info</code> emits simplified runtime diagnostics for verification or debugging.                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Asset Resolution</strong>                    </td><td data-label="Conceptual Summary"> <code>resolve_asset_name</code> maps logical names (e.g., <code>style.css</code>) to actual fingerprinted files via manifest lookup or pattern matching. This enables robust reference resolution even with hashed filenames.                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Fallback CSS Writer</strong>                 </td><td data-label="Conceptual Summary"> <code>write_overrides_css</code> generates dynamic responsive layout CSS. Supports left/right pane widths, collapsible tables, and dark mode styling. Delegates to project-provided implementation when available.                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Public Entrypoint: <code>prepare_assets</code></strong> </td><td data-label="Conceptual Summary"> Central orchestrator that: <br>1. Determines output assets directory <br>2. Invokes project-provided or fallback copy methods <br>3. Ensures placeholder existence <br>4. Optionally generates manifests and diagnostics <br>5. Returns <code>(assets_dir, style_fallback, script_fallback, assets_written)</code> tuple. </td></tr><tr><td data-label="Logic / Structure"> <strong>Embedded Fallbacks</strong>                  </td><td data-label="Conceptual Summary"> If <code>_EMBED_STYLE</code> or <code>_EMBED_SCRIPT</code> are provided from <code>.assets</code>, they are injected when external assets are missing. Guarantees that rendering pipelines never fail from missing CSS/JS.                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Fingerprinting and Mapping</strong>          </td><td data-label="Conceptual Summary"> Optional opt-in hashing system generates short content-based identifiers appended before file extensions. The manifest preserves logical mappings for runtime lookup.                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Integrity and Cross-Origin</strong>          </td><td data-label="Conceptual Summary"> HTML tag constructors (<code>make_link_tag_for_css</code>, <code>make_script_tag_for_js</code>) include automatic integrity attributes and <code>crossorigin=&quot;anonymous&quot;</code> for security compliance.                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Inline Helpers</strong>                      </td><td data-label="Conceptual Summary"> <code>inline_style_fallback</code> and <code>inline_script_fallback</code> wrap fallback assets in HTML tags for direct embedding when serving via inline renderers.                                                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>CLI Harness</strong>                         </td><td data-label="Conceptual Summary"> <code>_demo_run</code> provides a non-destructive demonstration. It builds a temporary environment, runs asset preparation, prints summary, and leaves results for inspection.                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"> <strong>Safety Model</strong>                        </td><td data-label="Conceptual Summary"> Every operation is wrapped in try/except with detailed debug logging. Failures never raise; they degrade gracefully with placeholders and diagnostic logs.                                                                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Configuration Model</strong>                 </td><td data-label="Conceptual Summary"> The <code>cfg</code> object is duck-typed. Recognized attributes include directory overrides, manifest/fingerprint toggles, and file policy controls. Default values preserve old behavior if unset.                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Non-destructive Defaults</strong>            </td><td data-label="Conceptual Summary"> Files are never overwritten unless <code>force_copy_assets=True</code>. Placeholder creation never deletes user content. Atomic operations ensure file integrity even under crash.                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Extensibility Hooks</strong>                 </td><td data-label="Conceptual Summary"> Optional imports (<code>.assets</code>, <code>.core_io</code>) make the module extendable without modification. Project-specific behavior can override copy logic, CSS generation, or I/O safety.                                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Output Consistency</strong>                  </td><td data-label="Conceptual Summary"> Every run produces valid assets directory with manifest and info JSONs. Logs summarize copied files and skipped items.                                                                                                                                                                                         </td></tr><tr><td data-label="Logic / Structure"> <strong>Design Intent</strong>                       </td><td data-label="Conceptual Summary"> This module acts as an <em>asset safety net</em>: even when upstream or user code fails, output is consistent, non-destructive, and introspectable.                                                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Error Boundaries</strong>                    </td><td data-label="Conceptual Summary"> Fallbacks exist at every layer: import, write, copy, and manifest generation. Errors are never propagated; only logged.                                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Performance Notes</strong>                   </td><td data-label="Conceptual Summary"> Streamed reads/writes with 8 KB chunks prevent memory blowup. Optional fingerprinting adds CPU overhead but is configurable.                                                                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Reliability Guarantees</strong>              </td><td data-label="Conceptual Summary"> Asset preparation is repeatable, atomic, and side-effect–bounded. Non-zero-byte rule ensures that the renderer always has valid artifacts.                                                                                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Security Aspects</strong>                    </td><td data-label="Conceptual Summary"> Uses <code>sha384</code> SRI and optional fingerprinting to detect tampering. Does not expose system paths in manifests.                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Concurrency Compatibility</strong>           </td><td data-label="Conceptual Summary"> Atomic replace design avoids race corruption under multi-process use. No shared global state except logger.                                                                                                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Integration Role</strong>                    </td><td data-label="Conceptual Summary"> Consumed by <code>html_renderer.py</code> and related modules to embed, resolve, and serve static assets safely. Serves as the foundation for the rendering layer’s deterministic outputs.                                                                                                                                </td></tr></tbody></table></div><div class="row-count">Rows: 29</div></div><div class="table-caption" id="Table10" data-table="Docu_0103_10" style="margin-top:2mm;margin-left:3mm;"><strong>Table 10 • core_compat.py</strong></div>
<div class="table-wrapper" data-table-id="table-10"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module Purpose</strong>           </td><td data-label="Conceptual Summary"> Compatibility shim that re-exports the core rendering API. Provides stable entry points (<code>render_html</code>, <code>render_table</code>, <code>render_page</code>) so external code need not track internal file moves.                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Public API</strong>               </td><td data-label="Conceptual Summary"> Exposes <code>render_html</code>, <code>render_table</code>, and <code>render_page</code> (alias). <code>__all__</code> lists these names for controlled <code>from render import *</code> usage. No other runtime side effects.                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Import Strategy</strong>          </td><td data-label="Conceptual Summary"> Imports implementation from <code>core_renderer</code> and <code>core_table</code>. Immediately surfaces <code>ImportError</code> with explanatory message if required symbols are missing. This fails fast and makes dependency problems obvious at import time.             </td></tr><tr><td data-label="Logic / Structure"> <strong>Backward Compatibility</strong>   </td><td data-label="Conceptual Summary"> Defines <code>render_page = render_html</code> as a historical alias to preserve older callers. Keeps surface area small to minimize breakage.                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Error Behavior</strong>           </td><td data-label="Conceptual Summary"> Raises explicit <code>ImportError</code> when core modules are unavailable. No silent degradation. This enforces dependency integrity rather than providing fallback behavior.                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>No Business Logic</strong>        </td><td data-label="Conceptual Summary"> Contains no rendering logic, transformation code, or I/O. Purely structural. Its only responsibilities are import and re-export.                                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Stability Guarantee</strong>      </td><td data-label="Conceptual Summary"> Centralizes API names so refactors of internal modules do not change external imports. Consumers can rely on stable symbols while internals evolve.                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Minimal Surface Area</strong>     </td><td data-label="Conceptual Summary"> Small file with minimal code reduces accidental side effects and lowers maintenance burden. Easier to audit and test.                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Dependency Contract</strong>      </td><td data-label="Conceptual Summary"> Makes the contract explicit: <code>core_renderer.render_html</code> and <code>core_table.render_table</code> are required. Any packaging or deployment that misses these will fail early.                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Visibility of Failures</strong>   </td><td data-label="Conceptual Summary"> By re-raising <code>ImportError</code> with context, the module improves diagnosability in CI and runtime environments. stack traces point to missing implementations.                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Integration Role</strong>         </td><td data-label="Conceptual Summary"> Acts as the stable import target used by other packages and entry points. Other modules import <code>render.core_compat</code> to remain insulated from internal reorganization.                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Testing Implication</strong>      </td><td data-label="Conceptual Summary"> Unit tests can mock <code>core_renderer</code> and <code>core_table</code> imports to validate consumer behavior without changing this compatibility layer. Tests should assert that missing core modules raise appropriate <code>ImportError</code>.                         </td></tr><tr><td data-label="Logic / Structure"> <strong>Packaging Consideration</strong>  </td><td data-label="Conceptual Summary"> Useful for packaging: wheel authors can relocate implementations while keeping the compat layer unchanged. Simplifies upgrade transitions across releases.                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Security Surface</strong>         </td><td data-label="Conceptual Summary"> Minimal. No network, file, or system calls. Attack surface limited to import-time behavior. Does not load untrusted data.                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Extensibility</strong>            </td><td data-label="Conceptual Summary"> Not intended to be extended. Keep it small. If feature flags or fallbacks are needed, implement them in core modules, not in this layer.                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Documentation Role</strong>       </td><td data-label="Conceptual Summary"> Clear single-purpose module that should be documented as "API shim" with notes on required modules and the alias. Documentation reduces accidental omission during packaging.                                                                </td></tr><tr><td data-label="Logic / Structure"> <strong>Operational Behavior</strong>     </td><td data-label="Conceptual Summary"> Import-time only. No runtime configuration, no environment-variable dependency, no global state. Safe to import in constrained environments.                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Failure Modes</strong>            </td><td data-label="Conceptual Summary"> Missing <code>core_renderer</code> or <code>core_table</code> → raises <code>ImportError</code>. Corrupt or partially-installed package will surface as import failure rather than silent wrong behavior.                                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Upgrade Path</strong>             </td><td data-label="Conceptual Summary"> When moving implementations, update imports inside this file only. Consumers remain untouched. This supports rolling upgrades and smooth deprecation.                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Developer Guidance</strong>       </td><td data-label="Conceptual Summary"> Keep this file minimal. Prefer explicit, informative error messages. Avoid adding fallbacks here; that would hide real deployment errors.                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Observability</strong>            </td><td data-label="Conceptual Summary"> Because failures are explicit, standard tooling (CI, packaging checks) can detect missing dependencies early. No runtime telemetry required.                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Compatibility Philosophy</strong> </td><td data-label="Conceptual Summary"> Prioritize explicitness and fail-fast behavior over silent polyfills. Compatibility layer is a thin contract boundary, not a compatibility façade.                                                                                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Auditability</strong>             </td><td data-label="Conceptual Summary"> Small size and single responsibility make the module easy to audit for licensing, supply-chain, and security reviews.                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Typical Usage Pattern</strong>    </td><td data-label="Conceptual Summary"> Consumer code: <code>from render.core_compat import render_html</code> — works regardless of internal file placements as long as implementations exist.                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Summary Statement</strong>        </td><td data-label="Conceptual Summary"> <code>core_compat.py</code> is a deliberate, minimal API shield. It ensures stable import names, fails loudly when required implementations are missing, and leaves rendering behavior to the core modules. It is structural glue, not functional glue. </td></tr></tbody></table></div><div class="row-count">Rows: 25</div></div><div class="table-caption" id="Table11" data-table="Docu_0103_11" style="margin-top:2mm;margin-left:3mm;"><strong>Table 11 • core_fragments.py</strong></div>
<div class="table-wrapper" data-table-id="table-11"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module Purpose</strong>           </td><td data-label="Conceptual Summary"> Central table-fragment engine that detects, normalizes, converts, and renders tables from Markdown, CSV, HTML, or DataFrame sources into atomic HTML fragments. It ensures uniform structure and concurrent rendering within the pipeline.        </td></tr><tr><td data-label="Logic / Structure"> <strong>Input Normalization</strong>      </td><td data-label="Conceptual Summary"> <code>_normalize_table_text</code> standardizes line endings, Unicode punctuation, and whitespace for consistent parsing across formats. Guarantees predictable text layout before detection.                                                                </td></tr><tr><td data-label="Logic / Structure"> <strong>Format Detection</strong>         </td><td data-label="Conceptual Summary"> <code>_extract_pipe_tables_from_markdown</code>, <code>_is_probable_csv</code>, <code>_parse_csv_text_to_rows</code>, and <code>_extract_table_blocks_from_html</code> identify pipe tables, CSV/TSV, and <code>&lt;table&gt;</code> structures with regex or BeautifulSoup fallback.                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Conversion Layer</strong>         </td><td data-label="Conceptual Summary"> <code>_convert_rows_to_df_like</code> transforms parsed rows into pandas DataFrames when possible, or a minimal in-memory structure if pandas is unavailable. Enables consistent rendering downstream.                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Rendering Core</strong>           </td><td data-label="Conceptual Summary"> <code>_simple_render_table</code> generates minimal HTML table markup from normalized data. Adds headings and wrapper <code>&lt;div&gt;</code> structures compatible with UI expectations.                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Concurrency Model</strong>        </td><td data-label="Conceptual Summary"> <code>render_fragments_concurrently</code> runs per-table render jobs in threads (default) or processes (optional). Each fragment is rendered, written atomically, and annotated with timing data and metadata.                                              </td></tr><tr><td data-label="Logic / Structure"> <strong>Atomic Write Strategy</strong>    </td><td data-label="Conceptual Summary"> <code>_atomic_write_text</code> ensures safe, corruption-free writes using <code>.tmp</code> replacement. Optional <code>_atomic_stream_write</code> integration supports streaming for advanced backends.                                                                         </td></tr><tr><td data-label="Logic / Structure"> <strong>Error Handling</strong>           </td><td data-label="Conceptual Summary"> Catches and logs all exceptions. Never halts the pipeline. Returns structured warnings in output for diagnosability. Ensures fault tolerance.                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Bridge Extensibility</strong>     </td><td data-label="Conceptual Summary"> Optionally binds to <code>convert</code>, <code>core_table</code>, or <code>io_utils</code> to enhance parsing or rendering without hard dependencies. Functions independently when bridges are missing.                                                                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Metadata Output</strong>          </td><td data-label="Conceptual Summary"> Each fragment record includes <code>path</code>, <code>content</code>, <code>title_id</code>, <code>title_text</code>, <code>assets_required</code>, <code>render_time_ms</code>, <code>write_time_ms</code>, and source preview. Enables traceable post-render inspection.                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Performance Profile</strong>      </td><td data-label="Conceptual Summary"> Optimized for I/O-bound concurrency. Uses thread pool by default for pickling safety. Can scale across many small table fragments efficiently.                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Detection Heuristics</strong>     </td><td data-label="Conceptual Summary"> Markdown tables use pipe syntax detection; CSV/TSV formats are sniffed statistically; HTML tables parsed by soup or regex; all return normalized data blocks.                                                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Inter-module Cooperation</strong> </td><td data-label="Conceptual Summary"> Works as a mid-layer between input conversion (<code>convert</code>), core layout engine (<code>core_table</code>), and final HTML assembly (<code>html_renderer.py</code>).                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Robustness Design</strong>        </td><td data-label="Conceptual Summary"> Survives malformed or mixed-format input. Produces empty but valid fragments if parsing fails. Never corrupts downstream assembly.                                                                                                                </td></tr><tr><td data-label="Logic / Structure"> <strong>Title and Anchor System</strong>  </td><td data-label="Conceptual Summary"> Generates unique <code>title_id</code> values for headers to avoid collisions in combined documents. Ensures safe DOM linking.                                                                                                                               </td></tr><tr><td data-label="Logic / Structure"> <strong>Concurrency Safety</strong>       </td><td data-label="Conceptual Summary"> Uses isolated per-fragment contexts. No shared mutable state. Deterministic naming (<code>frag_1.html</code>, etc.) across threads and processes.                                                                                                            </td></tr><tr><td data-label="Logic / Structure"> <strong>Observability</strong>            </td><td data-label="Conceptual Summary"> Timing metrics, detected type, and preview text allow profiling and debugging without rerunning full rendering.                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Error Visibility</strong>         </td><td data-label="Conceptual Summary"> Logs through a central <code>render.core_fragments</code> logger. Retains stack trace for debugging while preventing crash.                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Integration Role</strong>         </td><td data-label="Conceptual Summary"> Supplies pre-rendered, normalized fragments to <code>html_renderer.py</code>. Guarantees HTML integrity regardless of input diversity.                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Extensibility Philosophy</strong> </td><td data-label="Conceptual Summary"> Decoupled, dependency-light, and bridge-friendly. Optional modules enhance performance or fidelity but are never required.                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Failure Modes</strong>            </td><td data-label="Conceptual Summary"> Malformed data → warning + empty fragment; I/O failure → safe skip; renderer crash → logged error and continue.                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Atomicity Guarantee</strong>      </td><td data-label="Conceptual Summary"> No partial writes. Each fragment commit is all-or-nothing, ensuring stable disk state even under parallel execution.                                                                                                                              </td></tr><tr><td data-label="Logic / Structure"> <strong>Security Surface</strong>         </td><td data-label="Conceptual Summary"> No network access. File I/O restricted to provided directories. Minimal attack surface.                                                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Upgrade Path</strong>             </td><td data-label="Conceptual Summary"> Backward compatible. New detection heuristics or bridges can be added without breaking existing renderers.                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Testing Implications</strong>     </td><td data-label="Conceptual Summary"> Unit tests can inject sample text or DataFrames. Validate proper type detection, timing output, and atomic write behavior.                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Auditability</strong>             </td><td data-label="Conceptual Summary"> Structured logs and deterministic output make this module easy to verify for data integrity and reproducibility.                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Summary Statement</strong>        </td><td data-label="Conceptual Summary"> <code>core_fragments.py</code> is the concurrency-aware backbone of the table rendering system. It transforms diverse tabular inputs into safe, atomic HTML fragments while maintaining robustness, observability, and independence from heavy dependencies. </td></tr></tbody></table></div><div class="row-count">Rows: 27</div></div><div class="table-caption" id="Table12" data-table="Docu_0103_12" style="margin-top:2mm;margin-left:3mm;"><strong>Table 12 • core_io.py</strong></div>
<div class="table-wrapper" data-table-id="table-12"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module Purpose</strong> </td><td data-label="Conceptual Summary"> Provides atomic write utilities, safe directory creation, temporary fragment directory naming, and lightweight CSV discovery/reading. Acts as I/O backbone for renderers under concurrency and partial failures. </td></tr><tr><td data-label="Logic / Structure"> <strong>Design Goals</strong> </td><td data-label="Conceptual Summary"> Prevent partial writes, isolate side effects, degrade safely without project helpers, and supply small CSV utilities for preview and detection. </td></tr><tr><td data-label="Logic / Structure"> <strong>Import Strategy</strong> </td><td data-label="Conceptual Summary"> Prefers project-provided <code>render.io_utils</code> (<code>_atomic_write</code>, <code>_atomic_stream_write</code>, <code>_ensure_dir</code>). Falls back to local defaults when absent. No external dependencies required. </td></tr><tr><td data-label="Logic / Structure"> <strong>Public Surface</strong> </td><td data-label="Conceptual Summary"> Exports <code>_atomic_write</code>, <code>_atomic_stream_write</code>, <code>_ensure_dir</code>, <code>tmp_frag_dir_for</code>, <code>extract_table_source</code>, and <code>read_csv_rows</code>. API remains small and auditable. </td></tr><tr><td data-label="Logic / Structure"> <strong>Atomic Write (Default)</strong> </td><td data-label="Conceptual Summary"> <code>_default_write_atomic(path, writer)</code> writes via temp file in same directory, fsyncs, then atomically replaces target with <code>os.replace</code>. Guarantees all-or-nothing writes. </td></tr><tr><td data-label="Logic / Structure"> <strong>Streaming Variant</strong> </td><td data-label="Conceptual Summary"> <code>_default_stream_write</code> wraps atomic write for streaming. Public <code>_atomic_stream_write</code> can map to a project override or the default. Uses <code>writer(IO)</code> callback. </td></tr><tr><td data-label="Logic / Structure"> <strong>Directory Safety</strong> </td><td data-label="Conceptual Summary"> <code>_ensure_dir_path</code> safely creates directories using <code>mkdir(parents=True, exist_ok=True)</code>. Logs instead of raising on failure. </td></tr><tr><td data-label="Logic / Structure"> <strong>Resolver Layer</strong> </td><td data-label="Conceptual Summary"> Binds <code>_atomic_write</code>, <code>_atomic_stream_write</code>, and <code>_ensure_dir</code> to project or local implementations. Callers always import consistent names. </td></tr><tr><td data-label="Logic / Structure"> <strong>Temporary Fragment Dir</strong> </td><td data-label="Conceptual Summary"> <code>tmp_frag_dir_for(out_dir)</code> creates <code>.frags_&lt;millis&gt;_&lt;pid&gt;_&lt;uuid8&gt;</code> directories for unique temporary workspaces. Collisions are improbable. </td></tr><tr><td data-label="Logic / Structure"> <strong>File Validity Helper</strong> </td><td data-label="Conceptual Summary"> <code>_is_valid_file</code> checks existence, file type, and non-zero size. Lightweight safety check. </td></tr><tr><td data-label="Logic / Structure"> <strong>Encoding Detection</strong> </td><td data-label="Conceptual Summary"> <code>_detect_encoding_from_bytes</code> examines BOM and tries <code>utf-8</code>, <code>utf-8-sig</code>, and <code>latin-1</code>. First successful decode wins. </td></tr><tr><td data-label="Logic / Structure"> <strong>CSV Dialect Sniffing</strong> </td><td data-label="Conceptual Summary"> <code>_detect_csv_dialect(sample_text)</code> uses <code>csv.Sniffer().sniff</code> with fallback delimiters <code>[&quot;,&quot;, &quot;\t&quot;, &quot;;&quot;, &quot;:&quot;, &quot;|&quot;]</code>. Defaults to Excel-like dialect on failure. </td></tr><tr><td data-label="Logic / Structure"> <strong>Table Source Extraction</strong> </td><td data-label="Conceptual Summary"> <code>extract_table_source(source, sample_size=32768, max_sample_rows=10, compute_hash=False)</code> inspects path or bytes. Returns metadata: <code>exists</code>, <code>size</code>, <code>encoding</code>, <code>delimiter</code>, <code>quotechar</code>, <code>headers</code>, <code>sample_rows</code>, optional <code>sha256</code>. </td></tr><tr><td data-label="Logic / Structure"> <strong>Sample Strategy</strong> </td><td data-label="Conceptual Summary"> Reads bounded bytes, decodes via detected encoding, performs dialect sniffing, and collects preview rows for UI. </td></tr><tr><td data-label="Logic / Structure"> <strong>Header Detection</strong> </td><td data-label="Conceptual Summary"> Uses <code>csv.Sniffer().has_header</code> with fallback to <code>False</code>. If header found, first row treated as header. </td></tr><tr><td data-label="Logic / Structure"> <strong>Full Hash Option</strong> </td><td data-label="Conceptual Summary"> <code>compute_hash=True</code> streams file to calculate <code>sha256</code> for caching or integrity checks. </td></tr><tr><td data-label="Logic / Structure"> <strong>CSV Reader (Bounded)</strong> </td><td data-label="Conceptual Summary"> <code>read_csv_rows(path, encoding=None, delimiter=None, max_rows=None)</code> detects encoding/dialect, reads rows up to <code>max_rows</code>, uses small memory footprint. </td></tr><tr><td data-label="Logic / Structure"> <strong>Delimiter Control</strong> </td><td data-label="Conceptual Summary"> Explicit <code>delimiter</code> uses standard <code>&quot;excel&quot;</code> dialect. Otherwise uses detected dialect. </td></tr><tr><td data-label="Logic / Structure"> <strong>I/O Error Behavior</strong> </td><td data-label="Conceptual Summary"> Logs and cleans temp files on fatal write errors. CSV utilities raise for missing files. Decode errors use <code>&quot;replace&quot;</code> for resilience. </td></tr><tr><td data-label="Logic / Structure"> <strong>Concurrency Properties</strong> </td><td data-label="Conceptual Summary"> Same-directory temp writes avoid cross-device rename issues. Unique tmp dir naming prevents collisions across threads/processes. </td></tr><tr><td data-label="Logic / Structure"> <strong>Crash-Safety Guarantees</strong> </td><td data-label="Conceptual Summary"> Uses atomic <code>os.replace</code> on POSIX/Windows. Temp files cleaned on failure. Prevents torn writes. </td></tr><tr><td data-label="Logic / Structure"> <strong>Security Surface</strong> </td><td data-label="Conceptual Summary"> No network or shell execution. Operates strictly on local paths or streams. </td></tr><tr><td data-label="Logic / Structure"> <strong>Performance Notes</strong> </td><td data-label="Conceptual Summary"> Sampling limits memory and improves speed. Hashing uses chunked reads. Fsync is best-effort to avoid delay. </td></tr><tr><td data-label="Logic / Structure"> <strong>Integration Points</strong> </td><td data-label="Conceptual Summary"> Designed for use by <code>core_fragments</code>, <code>core_renderer</code>, or asset writers. Allows transparent project overrides. </td></tr><tr><td data-label="Logic / Structure"> <strong>Failure Modes</strong> </td><td data-label="Conceptual Summary"> Missing files → <code>FileNotFoundError</code>. Permission issues → logged and re-raised. Sniffer failures → fallback defaults. </td></tr><tr><td data-label="Logic / Structure"> <strong>Observability</strong> </td><td data-label="Conceptual Summary"> Errors logged via <code>render.core_io</code>. Returned metadata supports debugging and UI diagnostics. </td></tr><tr><td data-label="Logic / Structure"> <strong>Testing Implications</strong> </td><td data-label="Conceptual Summary"> Tests must verify atomic replace, temp cleanup, delimiter detection, BOM handling, header correctness, and <code>max_rows</code> cap. </td></tr><tr><td data-label="Logic / Structure"> <strong>Portability</strong> </td><td data-label="Conceptual Summary"> Pure standard library. Uses atomic <code>os.replace</code>. Avoids platform-specific temp dirs. </td></tr><tr><td data-label="Logic / Structure"> <strong>Backward Compatibility</strong> </td><td data-label="Conceptual Summary"> Stable public API. Compatible with prior <code>io_utils</code> integrations. </td></tr><tr><td data-label="Logic / Structure"> <strong>Edge Cases</strong> </td><td data-label="Conceptual Summary"> Zero-byte and binary-like files handled with <code>&quot;replace&quot;</code>. Non-seekable streams guarded. </td></tr><tr><td data-label="Logic / Structure"> <strong>Data Integrity</strong> </td><td data-label="Conceptual Summary"> Atomicity prevents torn writes. Optional hashing enables verification. </td></tr><tr><td data-label="Logic / Structure"> <strong>Operational Guidance</strong> </td><td data-label="Conceptual Summary"> Always use <code>_atomic_write</code>/<code>_atomic_stream_write</code> for durable outputs. Use <code>tmp_frag_dir_for</code> for isolated temp work. </td></tr><tr><td data-label="Logic / Structure"> <strong>Upgrade Path</strong> </td><td data-label="Conceptual Summary"> Extend delimiter or encoding sets safely. Override fsync policy via project <code>io_utils</code>. </td></tr><tr><td data-label="Logic / Structure"> <strong>Summary Statement</strong> </td><td data-label="Conceptual Summary"> <code>core_io.py</code> is a minimal, dependency-light I/O safety layer ensuring atomic writes, directory creation, temp workspace isolation, and CSV probing for stable rendering pipelines. </td></tr></tbody></table></div><div class="row-count">Rows: 34</div></div><div class="table-caption" id="Table13" data-table="Docu_0103_13" style="margin-top:2mm;margin-left:3mm;"><strong>Table 13 • core_renderer.py</strong></div>
<div class="table-wrapper" data-table-id="table-13"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module Purpose</strong>                         </td><td data-label="Conceptual Summary"> <code>core_renderer.py</code> is the high-level orchestrator that turns a heterogeneous set of inputs (Markdown, CSV/TSV, HTML fragments, DataFrame-like objects, paths, and raw strings) into a single, well-formed, asset-aware HTML “tables viewer” output. It coordinates preprocessing, table detection, optional CSV parsing, fragment rendering (via <code>core_fragments</code>), asset preparation, caption/labels lookup, and final atomic assembly of the document. The file is defensive: it prefers best-effort behavior, logs issues, and falls back to safe inline rendering when tile/fragment rendering fails.                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Public API</strong>                             </td><td data-label="Conceptual Summary"> Exposes <code>render_html(all_tables, output_html, markdown_to_html, *, output_user=None, export_name_template=None, cdn_integrity=None, render_cell=None, config=None, return_html=False, materialize=False)</code> as the primary entrypoint. Returns a dict with <code>warnings</code>, <code>tables</code>, <code>rows</code>, <code>runtime_ms</code>, and <code>output</code> and optionally <code>html</code>. The call is synchronous and self-contained; all required work finishes before the function returns.                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>High-level Flow</strong>                        </td><td data-label="Conceptual Summary"> 1. Sanitize and prepare output path and directory.<br>2. Prepare assets (<code>prepare_assets</code>) and optionally write overrides CSS.<br>3. Normalize and parse inputs into <code>parsed_tables</code> and <code>inline_html_sources</code> using CSV heuristics, pipe-table detection, and HTML-table extraction.<br>4. Deduplicate parsed tables via <code>_stable_hash</code>.<br>5. Attempt concurrent fragment rendering via <code>render_fragments_concurrently</code> into a temporary fragment directory.<br>6. If fragments missing or empty, fall back to inline rendering using <code>render_table</code> or simple pandas fallback.<br>7. Assemble final HTML head, body, scripts, and table fragments or inline parts and write atomically to <code>output_html</code>.<br>8. Return diagnostics and output path. </td></tr><tr><td data-label="Logic / Structure"> <strong>Import & Dependency Strategy</strong>           </td><td data-label="Conceptual Summary"> Uses local helpers where possible (<code>core_io</code>, <code>core_assets</code>, <code>core_fragments</code>, <code>core_table</code>, <code>core_utils</code>). Optional dependencies are embraced if present: <code>bs4</code> for robust HTML table extraction and project <code>sanitize</code> module for safer HTML sanitization. The module is defensive: missing optional modules do not break the flow. When a preferred helper is absent it falls back to conservative alternatives (e.g., <code>html.escape</code>).                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Sanitization & Safety</strong>                  </td><td data-label="Conceptual Summary"> If a project <code>sanitize_html</code> function is available it is used with <code>allow_tables=True</code>. Otherwise the module falls back to <code>html.escape</code> for conservative output. Sanitization is applied to markdown-rendered HTML before HTML-table extraction to reduce XSS and malformed markup propagation. The approach is configurable by replacing or providing project <code>sanitize</code>.                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Markdown Handling</strong>                      </td><td data-label="Conceptual Summary"> Accepts a <code>markdown_to_html</code> callable injected by the caller. <code>MarkdownRenderer</code> wraps it for safe invocation. The module uses <code>markdown_to_html</code> in two phases: to convert raw string input into HTML for table extraction and later within fragment rendering flows if renderer objects expose <code>.render()</code>. The renderer is treated as a dependency-injected service rather than an import-time global.                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Pipe-Table Detection (Markdown)</strong>        </td><td data-label="Conceptual Summary"> Implements robust pipe-table detection via <code>_split_cells_from_pipe_line</code> and <code>_extract_pipe_tables_from_markdown</code>. The logic: locate a pipe-containing line followed immediately by a divider line matching Markdown divider syntax (<code>-</code> with optional <code>:</code>), then collect contiguous pipe lines into header+body rows. Extraction preserves cell content and yields row arrays. This path runs before HTML extraction to prefer native Markdown tables over rendered HTML conversions.                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Logic / Structure"> <strong>CSV Heuristics & Parsing</strong>               </td><td data-label="Conceptual Summary"> CSV detection uses <code>_detect_csv_like</code> (sniffer- and heuristic-based). It avoids false positives on HTML content and pipe-markdown. If CSV detected, <code>_parse_csv_text</code> or <code>_parse_csv_file</code> is used to produce row dictionaries (dict-per-row). Detection is permissive but conservative: tries <code>csv.Sniffer</code>, falls back to delimiter heuristics, and respects <code>cfg.csv_delimiter</code> when provided. Aggressive CSV coercion only runs when no parsed tables were found.                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>HTML Table Extraction</strong>                  </td><td data-label="Conceptual Summary"> HTML extraction flows use BeautifulSoup if available (<code>_extract_tables_from_html_bs4</code>) for robust parsing and fallback to regex-based <code>_parse_table_html_regex</code> and <code>_extract_tables_from_html_regex</code> when <code>bs4</code> is absent. Extraction returns rows arrays and header presence flags. This dual approach prioritizes correctness with <code>bs4</code> but guarantees functionality without it.                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Data Normalization → DF-like</strong>           </td><td data-label="Conceptual Summary"> <code>_convert_rows_to_df_like</code> attempts to convert rows into pandas DataFrames if pandas is available. If not, it produces a list-of-dicts (for headered tables) or list-of-lists. This enables later renderers to operate either on DataFrame APIs or on plain structures. The function is defensive and returns the best-effort representation.                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Logic / Structure"> <strong>Deduplication</strong>                          </td><td data-label="Conceptual Summary"> Deduplicates parsed tables using <code>_stable_hash</code> which JSON-serializes stable structures or fallbacks to <code>repr</code> hashing. This prevents identical large tables from being rendered multiple times and reduces work and output duplication. The dedupe step is best-effort and ignores unhashable cases gracefully.                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Fragment Rendering Integration</strong>         </td><td data-label="Conceptual Summary"> Delegates heavy lifting to <code>render_fragments_concurrently(parsed_tables, cfg, renderer, tmp_frag_dir, max_workers)</code> which produces <code>fragments_map</code>, <code>frag_row_counts</code>, <code>total_rows</code>, and <code>warnings</code>. This module only prepares and consumes the outputs. The decision to use thread vs process, atomic writes, asset inference, and fragment metadata enrichment lives in <code>core_fragments</code>. <code>core_renderer</code> interprets results and decides fallback strategies based on whether any fragments contain rows.                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Fallback Inline Rendering</strong>              </td><td data-label="Conceptual Summary"> If <code>render_fragments_concurrently</code> fails or produces no rows the module falls back to an inline rendering pipeline: uses <code>render_table</code> from <code>core_table</code> if available; else tries a pandas <code>to_html</code>; else emits a simple <code>&lt;pre&gt;(failed to render table)&lt;/pre&gt;</code> placeholder. The fallback ensures the output document always contains some representation of the inputs.                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Labels & Captions</strong>                      </td><td data-label="Conceptual Summary"> Implements <code>_load_labels_json()</code> with an explicit search order: <code>cfg.labels</code> (dict), <code>cfg.labels_path</code>, environment <code>PTT_LABELS_PATH</code>, repository-relative candidates, <code>out_dir</code>, <code>cwd</code>, and an explicit Dropbox fallback path. <code>_caption_for(book_prefix, idx)</code> attempts multiple key formats for compatibility (e.g., <code>prefix_01</code>, <code>prefix-01</code>, numeric keys). This design supports user-provided, repo-provided, or legacy label locations. Missing or malformed label files silently degrade to absent captions.                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Asset Preparation & Embedding</strong>          </td><td data-label="Conceptual Summary"> Calls <code>prepare_assets(cfg, out_dir)</code> to create an <code>assets_dir</code> and fallbacks. Supports two modes: <code>embed_assets=True</code> writes CSS/JS inline into <code>&lt;style&gt;</code>/<code>&lt;script&gt;</code> blocks. Default mode references files via <code>&lt;link&gt;</code>/<code>&lt;script src=&gt;</code> with cache-busting query <code>?v=mtime</code>. Also optionally writes <code>overrides.css</code> via <code>write_overrides_css</code>. The module computes or assumes <code>href_prefix</code> relative to <code>out_dir</code> for asset URLs. Integrity hints use <code>_sri_attr</code> for CDN integrity where <code>cdn_integrity</code> supplied.                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Head & Tail Construction</strong>               </td><td data-label="Conceptual Summary"> Head (<code>head_parts</code>) is built with meta tags, a small critical CSS snippet, assets inclusion (inline or linked), header UI controls (search, buttons) and compatibility shim for legacy alias elements. Tail (<code>tail_parts</code>) includes deferred scripts and a runtime JS snippet for export worker delegation and a small on-load fade-in. The module produces accessible markup (roles, aria-labels) and keeps legacy query IDs to avoid breaking older JS.                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Legacy Compatibility Layer</strong>             </td><td data-label="Conceptual Summary"> Several measures preserve legacy behavior: keeps <code>searchBox</code> and <code>copyAllMdBtn</code> IDs, generates an alias-delegation script to forward events from hidden legacy elements to the visible modern controls, and retains <code>book_prefix</code> and caption data-attributes with backward-friendly names. These afford non-breaking upgrades for existing consumers that rely on DOM element IDs or structure.                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>TOC and Banner</strong>                         </td><td data-label="Conceptual Summary"> Builds a table-of-contents (<code>toc_items</code>) and conditionally a <code>banner_html</code> message when no fragments or inline parts were produced. The banner is user-visible and includes a concatenation of recent warning messages for quick diagnosis.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Title ID and Anchor Handling</strong>           </td><td data-label="Conceptual Summary"> Ensures every fragment or inline block has a stable <code>title_id</code> (e.g., <code>Table1</code>, <code>Table_2</code>) and uses <code>_remove_heading_from_fragment</code> during assembly to strip redundant headings from fragment HTML to avoid duplicated heading nodes. It also sanitizes and re-anchors first headings for inline HTML sources.                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Atomic Final Write</strong>                     </td><td data-label="Conceptual Summary"> Writes output atomically via <code>_default_write_atomic</code> (from <code>core_io</code>) with a <code>writer</code> callable that streams head, TOC, fragments/inline parts, and tail. If atomic write fails it falls back to simple <code>.tmp</code> + <code>os.replace</code> then to plain open-write as a last resort. Errors during final write are logged and returned as a <code>warnings</code> entry. Atomic semantics ensure output files never appear partially written to consumers.                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Export Worker & JS Controls</strong>            </td><td data-label="Conceptual Summary"> Produces client-side logic for an <code>exportBtn</code> that posts full HTML to a Web Worker (if available) located at <code>hrefPrefix + &#x27;/worker.js&#x27;</code>. The runtime guards against very large HTML ( > ~2MB ) and surfaces errors to the user via alerts. The export worker usage is optional and best-effort.                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Performance & Concurrency</strong>              </td><td data-label="Conceptual Summary"> Uses <code>render_fragments_concurrently</code> to parallelize rendering across <code>max_workers</code> threads (or processes if requested and picklable). The module computes <code>left_width</code> and <code>right_width</code> layout percentages for <code>render_table</code> calls. Timing metrics are collected at fragment level by downstream code; <code>core_renderer</code> only records aggregate runtime and returns per-run metrics via <code>runtime_ms</code>.                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Diagnostics & Logging</strong>                  </td><td data-label="Conceptual Summary"> Uses <code>_record</code> to record lightweight debug strings and <code>logger.debug/info/exception</code> to log diagnostics. Warnings from fragment workers are aggregated into the returned <code>warnings</code> list. The module avoids raising for recoverable issues and instead surfaces them via logs and the returned <code>warnings</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"> <strong>Config Object (cfg)</strong>                    </td><td data-label="Conceptual Summary"> <code>cfg</code> is duck-typed. Recognized keys used include: <code>csv_delimiter</code>, <code>detect_csv</code>, <code>max_workers</code>, <code>embed_assets</code>, <code>generate_manifest</code> (downstream), <code>labels</code>, and <code>labels_path</code>. The module provides reasonable defaults when <code>cfg</code> attributes are missing. This makes integration into different host systems simple without a tight config schema.                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Edge Cases & Fault Tolerance</strong>           </td><td data-label="Conceptual Summary"> - If <code>prepare_assets</code> fails, falls back to <code>assets_dir = out_dir / &quot;assets&quot;</code>.<br>- If <code>write_overrides_css</code> fails, writes an empty <code>overrides.css</code> to avoid missing-link errors.<br>- If <code>render_fragments_concurrently</code> fails it adds a warning and proceeds to inline fallback. <br>- If fragment files cannot be read during assembly, it skips them and continues. <br>All paths favor continuity of output over throwing exceptions back to the caller.                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Security Considerations</strong>                </td><td data-label="Conceptual Summary"> Sanitization of rendered HTML prior to table extraction reduces XSS risk. Asset inclusion uses SRI hints for CDN resources when provided. The module explicitly avoids executing untrusted code. The export worker receives HTML client-side only. Server-side, the code does not open external network connections.                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Testing Guidance</strong>                       </td><td data-label="Conceptual Summary"> Unit tests should cover: CSV detection and parsing with different delimiters and encodings; pipe-table detection; HTML extraction with and without <code>bs4</code>; fragmentation success and failure modes; captions lookup across candidate paths; embedded vs linked asset flows; atomic write fallback paths; and fallback inline rendering behavior. Mock <code>markdown_to_html</code> to exercise sanitization and extractor logic deterministically.                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Logic / Structure"> <strong>Observability & Telemetry</strong>              </td><td data-label="Conceptual Summary"> Provides easily collectable artifacts: <code>warnings</code> array, <code>tables</code> count, <code>rows</code> count, <code>runtime_ms</code>, and optionally the full <code>html</code> when <code>return_html=True</code>. Logging at debug/exception levels offers more granular details. Fragments and asset files left in <code>tmp_frag_dir</code> can be inspected when debugging.                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Integration Notes</strong>                      </td><td data-label="Conceptual Summary"> - Integrates upward with external callers that supply <code>markdown_to_html</code> and optional <code>cfg</code> objects. <br>- Downstream consumers may read produced <code>assets</code> dir or <code>overrides.css</code>. <br>- Works with <code>core_fragments</code> for concurrency and with <code>core_table</code> for layout rendering. <br>When upgrading <code>core_table</code> or <code>core_fragments</code> keep this orchestrator’s expectations (function signatures and returned fragment shapes) stable.                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Upgrade & Extensibility Path</strong>           </td><td data-label="Conceptual Summary"> To add new input formats or parsing heuristics: add detection + conversion steps earlier in input preprocessing and ensure <code>_convert_rows_to_df_like</code> accepts new row shapes. To change asset strategy: adjust calls to <code>prepare_assets</code> and how <code>href_prefix</code> is computed. To add stricter sanitization rules: swap in a project <code>sanitize_html</code> implementation. Keep hooks small and localized to avoid breaking fallback logic.                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Error Messages & User Feedback</strong>         </td><td data-label="Conceptual Summary"> Warnings are structured dicts <code>{level, msg}</code>. The UI displays a short banner when no tables are rendered with concatenation of recent warnings. This design helps users immediately see why a render failed without sifting through server logs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Determinism & Idempotence</strong>              </td><td data-label="Conceptual Summary"> Given the same inputs, renderer configuration, and environment, the function attempts deterministic outputs: fragment naming (<code>frag_{idx}.html</code>) is index-based and stable for the same parsed table order. Asset cache-busting uses file mtime; therefore, altering assets affects output URLs predictably.                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Resource Safety</strong>                        </td><td data-label="Conceptual Summary"> File writes use atomic semantics and are limited to configured <code>out_dir</code> and <code>assets_dir</code>. Temporary fragment directories are created using <code>tmp_frag_dir_for</code> to avoid collisions and permit safe concurrent runs. The code avoids unbounded memory use by sampling and delegating heavy table conversion to downstream functions that use streaming when possible.                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Developer Contracts</strong>                    </td><td data-label="Conceptual Summary"> - <code>markdown_to_html</code> must be a callable that returns HTML string for a given Markdown input.<br>- <code>render_table</code> (from <code>core_table</code>) if present should accept <code>(df_like, idx, md_to_html, left_width, right_width)</code>; fallbacks attempt earlier signatures. <br>- <code>render_fragments_concurrently</code> must return <code>fragments_map, frag_row_counts, total_rows, warnings</code>. Keep these contracts to avoid orchestrator breakage.                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Common Failure Scenarios & Mitigations</strong> </td><td data-label="Conceptual Summary"> - <strong>Missing pandas</strong>: module still produces HTML via list-of-dicts or simple table fallback. <br>- <strong>Broken markdown renderer</strong>: module falls back to raw sanitized string and still attempts HTML extraction. <br>- <strong>Non-picklable renderer with <code>use_process=True</code> in fragments</strong>: fragment layer logs and falls back to threads. <br>- <strong>I/O permission errors</strong>: caught, logged, and surfaced as warnings with graceful degradation.                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Documentation Recommendations</strong>          </td><td data-label="Conceptual Summary"> Document <code>render_html</code> signature, explain <code>cfg</code> attributes and label file search order, detail asset embedding vs linking modes, and list expected fragment metadata fields. Provide example <code>markdown_to_html</code> wrapper to show integration points. Include an explicit note that the module is defensive and will fallback silently to inline rendering in many failure modes.                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Summary Statement</strong>                      </td><td data-label="Conceptual Summary"> <code>core_renderer.py</code> is a resilient orchestration layer that converts mixed inputs into a consistent, asset-aware HTML viewer. It emphasizes graceful degradation, compatibility with legacy integrations, atomic persistence, and clear diagnostics. The module coordinates detection, conversion, parallel rendering, asset handling, caption resolution, and final atomic assembly to produce reliable outputs across a wide range of runtime environments and dependency availabilities.                                                                                                                                                                                                                                                            </td></tr></tbody></table></div><div class="row-count">Rows: 37</div></div><div class="table-caption" id="Table14" data-table="Docu_0103_14" style="margin-top:2mm;margin-left:3mm;"><strong>Table 14 • core_table.py</strong></div>
<div class="table-wrapper" data-table-id="table-14"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module Purpose</strong>                      </td><td data-label="Conceptual Summary"> <code>core_table.py</code> is a robust, defensive table rendering library that converts many Python table-like inputs (pandas DataFrame, list-of-dicts, CSV strings, file paths, list-of-lists, bytes) into safe, accessible HTML suitable for embedding or fragment delivery. It focuses on reliability, predictable defaults, and graceful degradation when optional dependencies (pandas, xlsxwriter, openpyxl, charset detectors) are missing.                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Public API</strong>                          </td><td data-label="Conceptual Summary"> Exposes <code>render_table</code>, <code>render_fragment</code>, <code>simple_render_table</code>, and several utility helpers (<code>_render_cell_text</code>, <code>_rows_from_iterable</code>, <code>_get_table_alignments</code>, <code>_stash_code_local</code>, <code>_restore_code_placeholders_in_html</code>, <code>_preprocess_underscores_outside_placeholders</code>, <code>_restore_protection_entities</code>, <code>_make_hidden_heading_anchor</code>, <code>_heading_init_script</code>, <code>_filter_rows</code>, <code>_sort_rows</code>, <code>_rows_to_csv_bytes</code>, <code>_rows_to_json_bytes</code>, <code>_rows_to_xlsx_bytes</code>, <code>parse_csv_safe</code>). Designed for direct import by <code>core_renderer</code> and external callers. </td></tr><tr><td data-label="Logic / Structure"> <strong>Design Principles</strong>                   </td><td data-label="Conceptual Summary"> Fail-safe defaults. Do not throw for typical content errors. Prefer clear logging (<code>PARSE_TRY</code>, <code>PARSE_OK</code>, <code>PARSE_FAIL</code>) and non-destructive output. Avoid surprising transformations. Preserve user-provided structure where possible. Keep asset injection idempotent.                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Optional Dependencies</strong>               </td><td data-label="Conceptual Summary"> Functions work without optional packages. When <code>pandas</code> is present the module prefers DataFrame-aware paths and returns DataFrames for CSV parsing. When <code>xlsxwriter</code> or <code>openpyxl</code> exist, export-to-XLSX support is enabled. Charset detection uses <code>charset_normalizer</code> or <code>chardet</code> if available. All optional imports are guarded so missing libraries degrade gracefully.                                                                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>CSV/Text Handling Strategy</strong>          </td><td data-label="Conceptual Summary"> Conservative CSV detection to avoid misclassifying pipe-markdown as CSV. <code>_is_likely_csv_text</code>, <code>_sniff_delimiter</code>, <code>_parse_csv_source_to_rows</code>, and <code>parse_csv_safe</code> provide layered parsing: try pandas (if requested), then <code>csv.reader</code> with heuristic sniffer, then naive split fallbacks. Headers detection uses <code>csv.Sniffer().has_header</code> with heuristics fallback. Encoding detection and retries use <code>utf-8-sig</code>, <code>utf-8</code>, <code>latin-1</code> and optional detector packages.                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>parse_csv_safe Behaviour</strong>            </td><td data-label="Conceptual Summary"> Public robust CSV loader that returns a pandas DataFrame when available and parsing succeeds, else returns list-of-rows. Never raises on typical parsing errors. Logs parse attempts and outcomes with metadata about encoding, delimiter and row/column counts. It tries multiple encodings and delimiters before falling back.                                                                                                                                                                                                                               </td></tr><tr><td data-label="Logic / Structure"> <strong>Input Normalization</strong>                 </td><td data-label="Conceptual Summary"> <code>_rows_from_iterable</code> converts diverse inputs into <code>(rows, header)</code> uniformly. It handles: bytes, file path strings, inline CSV strings, DataFrame-like objects, list-of-dicts, list-of-lists, dicts, and generic iterables. Early CSV/text handling routes to <code>parse_csv_safe</code> to consistently parse CSV-like content.                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Safety Caps & Limits</strong>                </td><td data-label="Conceptual Summary"> Configurable hard caps to prevent runaway output: <code>_MAX_CELL_HTML</code>, <code>_MAX_ROWS_SAFE_RENDER</code>, <code>_MAX_COLS_SAFE</code>. Very large cells are truncated with <code>_TRUNCATE_SUFFIX</code>. Large tables log warnings and still render but signal potential performance concerns.                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Cell Rendering Pipeline</strong>             </td><td data-label="Conceptual Summary"> <code>_render_cell_text</code> performs multi-step processing: stash fenced/inline code, protect underscores/pipes outside placeholders, call markdown renderer (<code>md_callable</code>), restore protection entities, restore code placeholders, truncate and sanitize. If a <code>sanitize_html</code> function is available it is used with <code>allow_tables=True</code> when supported. This pipeline preserves code blocks and inline code while preventing accidental markdown parsing pitfalls.                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Code Placeholder Handling</strong>           </td><td data-label="Conceptual Summary"> <code>_stash_code_local</code> and <code>_restore_code_placeholders_in_html</code> extract fenced code blocks (<code> </code> ) and inline backticks into placeholders before markdown processing, then restore them as safe <code>&lt;pre&gt;&lt;code&gt;</code> and <code>&lt;code&gt;</code> blocks. This prevents pipe or underscore escaping problems inside code.                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Protection of Underscores and Pipes</strong> </td><td data-label="Conceptual Summary"> <code>_preprocess_underscores_outside_placeholders</code> replaces underscores and pipe characters outside code placeholders with safe entities (<code>&amp;#95;</code>, <code>&amp;#124;</code>) to avoid accidental formatting in markdown processors. <code>_restore_protection_entities</code> converts the entities back at the end of processing.                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"> <strong>Column Type Detection</strong>               </td><td data-label="Conceptual Summary"> <code>_detect_column_types</code> samples rows to infer column semantic types (<code>text</code>, <code>numeric</code>, <code>integer</code>, <code>datetime</code>, <code>code</code>, <code>html</code>, <code>diagram</code>, <code>json</code>, <code>boolean</code>, <code>empty</code>). Uses <code>_guess_value_type</code> with heuristics (ISO datetime parse, numeric conversion, HTML tag detection, diagram heuristics). Types feed into CSS class tokens and <code>data-col-type</code> attributes.                                                                                                                                                                                              </td></tr><tr><td data-label="Logic / Structure"> <strong>Diagram & RTL Detection</strong>             </td><td data-label="Conceptual Summary"> <code>_is_diagram_text</code> heuristically recognizes ASCII/box-drawing diagrams to apply <code>cell-diagram</code> classes. <code>_detect_rtl_chars</code> and <code>_dir_for_text</code> detect right-to-left text and annotate <code>dir</code> attributes on table cells for correct rendering.                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Accessibility & Semantics</strong>           </td><td data-label="Conceptual Summary"> Generates proper ARIA attributes, <code>role=&quot;table&quot;</code>, <code>scope=&quot;col&quot;</code>, captions, labeledby references, and <code>data-label</code> on TDs for responsive layouts. Hidden anchor elements and a heading-bar (<code>_make_hidden_heading_anchor</code>, <code>_heading_init_script</code>) provide keyboard-navigable table indexes.                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Asset Injection</strong>                     </td><td data-label="Conceptual Summary"> <code>_one_time_assets</code> returns CSS and small JS where server-side can inline basic styles and client script. The <code>render_table</code> function injects these assets once per process unless <code>emit_assets_once</code> is disabled. Assets include minimal styles for tables, sticky headers, and a placeholder client-side binder skeleton. Asset injection is idempotent.                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Wrapper & Controls</strong>                  </td><td data-label="Conceptual Summary"> <code>render_table</code> emits a rich wrapper with controls: copy buttons, export buttons (CSV/JSON/XLSX), collapse toggle and sort buttons. Buttons are given data-action attributes for client-side scripts to hook. Built HTML uses semantic structure to allow progressive enhancement; with JS disabled the static table remains usable.                                                                                                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"> <strong>Lazy Loading / Chunking</strong>             </td><td data-label="Conceptual Summary"> When configured with <code>lazy_load_threshold</code> the renderer emits an initial subset of rows and embeds remaining rows as JSON inside <code>&lt;script type=&quot;application/json&quot; class=&quot;table-row-chunk&quot;&gt;</code> for client-side progressive load. Rows are normalized and safely JSON-encoded using <code>_safe_json_for_script</code>.                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Export Implementations</strong>              </td><td data-label="Conceptual Summary"> <code>_rows_to_csv_bytes</code>, <code>_rows_to_json_bytes</code>, and <code>_rows_to_xlsx_bytes</code> implement server-side export. XLSX uses <code>xlsxwriter</code> or <code>openpyxl</code> when available. CSV and JSON functions escape values safely and are robust to unusual row contents.                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Sorting & Filtering Helpers</strong>         </td><td data-label="Conceptual Summary"> <code>_sort_rows</code> sorts by column with numeric-first attempt then string fallback. <code>_filter_rows</code> supports several criteria styles (<code>equals</code>, <code>contains</code>, <code>in</code>, <code>gt/gte/lt/lte</code>) and can operate on entire rows or a specific column index. Both functions are defensive and log failures without raising.                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Metadata Embedding</strong>                  </td><td data-label="Conceptual Summary"> <code>render_table</code> embeds table metadata as JSON inside <code>&lt;script type=&quot;application/json&quot; class=&quot;table-meta&quot;&gt;</code> to support client-side tooling and telemetry. Metadata includes <code>table_id</code>, <code>rows</code>, <code>displayed_rows</code>, <code>cols</code>, <code>tv_options</code>, <code>caption</code>, and optional render timing. <code>_safe_json_for_script</code> escapes <code>&lt;/</code> sequences.                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Fragment Mode</strong>                       </td><td data-label="Conceptual Summary"> <code>render_fragment</code> is a thin wrapper that marks output <code>fragment=True</code> and disables injection of global assets. This produces small HTML fragments suitable for inclusion in larger pages or for writing as individual fragment files.                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Compatibility & Extension Hooks</strong>     </td><td data-label="Conceptual Summary"> The renderer prefers an upstream <code>convert.render_table</code> implementation when present. It checks for <code>df._tv_options</code>, <code>df._table_alignments</code>, and other instrumentation hooks to integrate with upstream projects. Optional fallback injection points are explicit and mild.                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Deterministic IDing</strong>                 </td><td data-label="Conceptual Summary"> Table and wrapper IDs use predictable patterns (<code>Table{idx}</code>, <code>wrapper-&lt;uuid&gt;</code>). Hidden anchors and caption IDs are consistent. <code>_class_token</code> sanitizes column type names into safe CSS tokens.                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Logic / Structure"> <strong>Performance Considerations</strong>          </td><td data-label="Conceptual Summary"> Streaming-friendly operations avoid loading entire large tables into memory where possible. Caps prevent extremely large outputs. Logging warns on heavy operations. Chunk embedding minimizes initial HTML size for very large tables.                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Logging & Observability</strong>             </td><td data-label="Conceptual Summary"> Clear logging categories: <code>PARSE_TRY</code>, <code>PARSE_OK</code>, <code>PARSE_FAIL</code> for CSV parsing. Warnings are logged for truncation, large row/col counts, and parsing fallbacks. The module avoids noisy logs for normal behavior but records salient diagnostic events.                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Security Posture</strong>                    </td><td data-label="Conceptual Summary"> Sanitization is applied when <code>sanitize_html</code> is available. All JSON and inline script payloads escape <code>&lt;/</code> to avoid script injection in HTML contexts. Cell content is escaped with <code>html.escape</code> if markdown rendering or sanitization fails. Export bytes are produced without executing user code.                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Edge-case Handling</strong>                  </td><td data-label="Conceptual Summary"> Many try/except boundaries. If pandas-to_html fails, fall back to manual rendering. If row arrays have inconsistent lengths, code pads/truncates to <code>max_cols</code>. If charset detection fails, multiple encodings are tried. If optional modules are unpicklable or unavailable, the module still functions.                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Error Handling Philosophy</strong>           </td><td data-label="Conceptual Summary"> Never crash for common content issues. Prefer returning partial output with warnings. Failures are logged and the most conservative fallback is used (escaped text or <code>&quot;(failed to render table)&quot;</code> placeholders).                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Logic / Structure"> <strong>Testing Guidance</strong>                    </td><td data-label="Conceptual Summary"> Unit tests should exercise: CSV parse permutations (delimiters, encodings, missing headers), DataFrame inputs, list-of-dicts, large tables beyond caps, markdown-containing cells, fenced code blocks, RTL text, diagram-like text, lazy chunk generation, and asset injection toggles. Mock optional packages to verify fallback paths.                                                                                                                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Integration Role</strong>                    </td><td data-label="Conceptual Summary"> Designed to be consumed by <code>core_renderer</code> for fragment generation and by higher-level web handlers for server-side rendering and export endpoints. Its outputs are intentionally self-contained HTML fragments that pair with the broader asset pipeline in <code>core_assets</code> and fragment orchestration in <code>core_fragments</code>.                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Extensibility Points</strong>                </td><td data-label="Conceptual Summary"> - Provide <code>sanitize_html</code> in project scope to upgrade sanitization. <br> - Provide <code>convert.render_table</code> to override server rendering. <br> - Attach <code>_tv_options</code> or <code>_table_alignments</code> on a DataFrame-like object to influence alignment and behavior. <br> - Set <code>inject_assets</code>/<code>emit_assets_once</code> flags for server environments.                                                                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Deterministic Output Guarantees</strong>     </td><td data-label="Conceptual Summary"> Given identical inputs and environment, the renderer produces stable HTML structure and IDs (except for wrapper UUIDs). Padding/truncation and column ordering are deterministic. This makes diffs and caching practical.                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Security Considerations for Exports</strong> </td><td data-label="Conceptual Summary"> Export functions do not evaluate data. They simply serialize. XLSX generation uses safe libraries and writes to memory streams. Consumers should still validate untrusted input before offering downloads in multi-tenant environments.                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Operational Notes</strong>                   </td><td data-label="Conceptual Summary"> The module is safe to import in restricted environments (no network calls). Optional heavy dependencies are lazily imported. For server contexts consider setting <code>emit_assets_once=True</code> to reduce repeated asset injection.                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Developer Guidance</strong>                  </td><td data-label="Conceptual Summary"> Keep this file narrowly focused on rendering and parsing. Avoid adding network, database, or privileged I/O. Add feature flags via explicit options parameters rather than global state. Preserve the conservative parsing defaults.                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Summary Statement</strong>                   </td><td data-label="Conceptual Summary"> <code>core_table.py</code> is a hardened, full-featured table rendering engine delivering robust CSV parsing, safe HTML cell rendering with code/markdown preservation, rich metadata and controls, export capabilities, lazy loading for scale, and explicit fallback semantics. It is engineered to be resilient across environments, minimal in surprising behavior, and simple to extend by providing optional sanitizer or converter hooks.                                                                                                                          </td></tr></tbody></table></div><div class="row-count">Rows: 36</div></div><div class="table-caption" id="Table15" data-table="Docu_0103_15" style="margin-top:2mm;margin-left:3mm;"><strong>Table 15 • core_utils.py</strong></div>
<div class="table-wrapper" data-table-id="table-15"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module Purpose</strong>              </td><td data-label="Conceptual Summary"> <code>core_utils.py</code> provides small, safe utility helpers used across the render package. It centralizes lightweight sanitization, ID/path normalization, fragment inspection, and a streaming helper to keep calling sites simple and defensive.                                                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Public API</strong>                  </td><td data-label="Conceptual Summary"> Exposes <code>_sanitize_id</code>, <code>_sanitize_output_path</code>, <code>_sanitize_html_whitelist</code>, <code>_sri_attr</code>, <code>_frag_contains_rows</code>, and <code>_take_and_stream</code>. Each function has a single, narrow responsibility and is safe to call in untrusted contexts.                                                                                            </td></tr><tr><td data-label="Logic / Structure"> <strong>ID Sanitization</strong>             </td><td data-label="Conceptual Summary"> <code>_sanitize_id(x, idx)</code> turns arbitrary input into a safe HTML id token by replacing non-alphanumeric/underscore/dash characters with <code>-</code>, collapsing repeated dashes, trimming, and providing a deterministic fallback <code>id-{idx}</code> when the result is empty. Protects against invalid id characters and empty values.             </td></tr><tr><td data-label="Logic / Structure"> <strong>Output Path Normalization</strong>   </td><td data-label="Conceptual Summary"> <code>_sanitize_output_path(x)</code> ensures the output path is stringifiable. It returns <code>str(x)</code> when possible and falls back to <code>&quot;output.html&quot;</code> on any exception. This prevents downstream file I/O from failing due to non-string path objects.                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Minimal HTML Whitelist</strong>      </td><td data-label="Conceptual Summary"> <code>_sanitize_html_whitelist(s)</code> is a tiny pass-through used when a real sanitizer is not available. It safely coerces values to <code>str</code> and returns empty string on error. Intended as a placeholder; the full sanitizer should live in <code>sanitize.py</code>.                                                                               </td></tr><tr><td data-label="Logic / Structure"> <strong>SRI Attribute Helper</strong>        </td><td data-label="Conceptual Summary"> <code>_sri_attr(url, cdn_integrity)</code> returns a formatted <code> integrity=&quot;...&quot; crossorigin=&quot;anonymous&quot;</code> attribute when a matching integrity value exists in the provided mapping. Returns empty string otherwise. Makes adding SRI to asset <code>&lt;link&gt;</code>/<code>&lt;script&gt;</code> tags straightforward and centralized.                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Fragment Row Detection</strong>      </td><td data-label="Conceptual Summary"> <code>_frag_contains_rows(content)</code> performs a conservative regex search for <code>&lt;tbody&gt;\s*&lt;tr</code> to determine whether a fragment contains table rows. It is cheap and defensive and used to decide fallbacks (e.g., inline rendering vs. fragments).                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Streaming Slice Helper</strong>      </td><td data-label="Conceptual Summary"> <code>_take_and_stream(rows_iterable, n)</code> takes the first <code>n</code> items from an iterable and returns a tuple of <code>(list_of_taken, remainder_iterable)</code>. It defends against non-iterables and broken iterators by falling back to materializing the sequence when necessary.                                                                </td></tr><tr><td data-label="Logic / Structure"> <strong>Error Handling Philosophy</strong>   </td><td data-label="Conceptual Summary"> All helpers swallow internal exceptions and log debug-level messages rather than raising. This keeps higher-level code simple and focused on content handling while ensuring the utilities never crash the process.                                                                                                              </td></tr><tr><td data-label="Logic / Structure"> <strong>Deterministic Fallbacks</strong>     </td><td data-label="Conceptual Summary"> When normalization fails, functions return deterministic, documented defaults (<code>&quot;id-{idx}&quot;</code>, <code>&quot;output.html&quot;</code>, <code>&quot;&quot;</code>). This reduces cascading failures and makes behavior predictable in constrained environments.                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Logging & Observability</strong>     </td><td data-label="Conceptual Summary"> Uses module logger <code>render.core_utils</code> for debug-level diagnostics only. Messages help developers trace sanitization/path errors without spamming normal logs.                                                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Security Considerations</strong>     </td><td data-label="Conceptual Summary"> Utilities perform no network or file I/O and have minimal surface area. The id sanitizer reduces risk of invalid attributes. The HTML whitelist is intentionally minimal to avoid accidental sanitization guarantees; real sanitization is deferred to <code>sanitize.py</code>.                                                            </td></tr><tr><td data-label="Logic / Structure"> <strong>Integration Role</strong>            </td><td data-label="Conceptual Summary"> Lightweight building blocks consumed by <code>core_renderer</code>, <code>core_table</code>, and other modules. They centralize common small operations to avoid duplication and inconsistent fallback logic across the package.                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Performance Characteristics</strong> </td><td data-label="Conceptual Summary"> All functions are O(N) in input length where applicable and minimal overhead. <code>_take_and_stream</code> avoids full materialization unless necessary. Safe to execute in hot code paths.                                                                                                                                                </td></tr><tr><td data-label="Logic / Structure"> <strong>Testing Guidance</strong>            </td><td data-label="Conceptual Summary"> Unit tests should validate: odd id inputs (unicode, punctuation, empty), non-string output path objects, HTML-containing inputs to whitelist, SRI lookups with absent/present keys, fragment contents with/without <code>&lt;tbody&gt;</code> rows, and iterator behaviour for <code>_take_and_stream</code> including exhausted and broken iterables.       </td></tr><tr><td data-label="Logic / Structure"> <strong>Developer Guidance</strong>          </td><td data-label="Conceptual Summary"> Keep helpers small and pure. Do not introduce I/O or heavy dependencies here. If richer sanitization is needed, implement it in <code>sanitize.py</code> and keep this module's contract stable for callers.                                                                                                                                </td></tr><tr><td data-label="Logic / Structure"> <strong>Summary Statement</strong>           </td><td data-label="Conceptual Summary"> <code>core_utils.py</code> is a tiny, defensive utilities module that standardizes ID/path normalization, minimal HTML pass-through, SRI attribute formatting, quick fragment presence checks, and a robust take-and-stream iterator helper. It favors predictable defaults and non-throwing behavior to simplify upstream rendering logic. </td></tr></tbody></table></div><div class="row-count">Rows: 17</div></div><div class="table-caption" id="Table16" data-table="Docu_0103_16" style="margin-top:2mm;margin-left:3mm;"><strong>Table 16 • io_utils.py</strong></div>
<div class="table-wrapper" data-table-id="table-16"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module Purpose</strong>              </td><td data-label="Conceptual Summary"> <code>io_utils.py</code> provides safe, minimal file I/O helpers with an emphasis on atomic writes and consistent UTF-8 encoding. It isolates low-level file handling to prevent partial writes, encoding issues, or directory errors.                                                                                                               </td></tr><tr><td data-label="Logic / Structure"> <strong>Public API</strong>                  </td><td data-label="Conceptual Summary"> Exposes <code>read_file</code>, <code>write_file</code>, <code>ensure_dir</code>, and <code>_atomic_stream_write</code>. Each performs a clearly scoped I/O task with explicit error handling.                                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>File Reading</strong>                </td><td data-label="Conceptual Summary"> <code>read_file(path)</code> opens a file in UTF-8 text mode, reads it fully, and wraps all errors in an <code>IOError</code> that includes the failing path. Designed for simplicity and transparency in upstream code.                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>File Writing (Basic)</strong>        </td><td data-label="Conceptual Summary"> <code>write_file(path, content)</code> writes UTF-8 text while ensuring parent directories exist. It is not atomic but guarantees valid directories and complete writes under normal conditions. Exceptions are raised as <code>IOError</code> for uniform error handling.                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Directory Assurance</strong>         </td><td data-label="Conceptual Summary"> <code>ensure_dir(path)</code> ensures a directory exists or creates it recursively. If the path exists but is not a directory, it raises an explicit <code>IOError</code>. Used by both file writers and higher-level renderers to prepare output locations safely.                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Atomic Write Strategy</strong>       </td><td data-label="Conceptual Summary"> <code>_atomic_stream_write(path, write_fn)</code> implements transactional file writing: writes go to a temporary file created via <code>tempfile.mkstemp</code>, flushed and fsynced, then atomically replaced over the target path using <code>os.replace</code>. Ensures that on crash or interruption, either the old file or the new file exists—never a partial one. </td></tr><tr><td data-label="Logic / Structure"> <strong>Write Function Contract</strong>     </td><td data-label="Conceptual Summary"> The caller provides a <code>write_fn(f)</code> callback that writes the intended content to the open file object. This design allows streaming large or dynamically generated content without holding it in memory.                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Temporary File Lifecycle</strong>    </td><td data-label="Conceptual Summary"> Temporary files are created in the same directory as the target file (<code>dir=target.parent</code>) with a hidden prefix. They are cleaned up on failure, ensuring no orphaned files remain after exceptions.                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Data Integrity Guarantees</strong>   </td><td data-label="Conceptual Summary"> Flush and <code>os.fsync()</code> calls attempt to commit data to disk before the atomic replace. Although some filesystems may skip full guarantees, the pattern minimizes corruption risk.                                                                                                                                                         </td></tr><tr><td data-label="Logic / Structure"> <strong>Cross-Platform Safety</strong>       </td><td data-label="Conceptual Summary"> Uses <code>os.replace()</code> (Python 3.3+) for atomic rename semantics on both POSIX and Windows. This avoids partial overwrites and ensures atomic visibility of new data.                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Error Handling & Cleanup</strong>    </td><td data-label="Conceptual Summary"> All functions raise clear <code>IOError</code> messages contextualized with the failing path. Temporary files are explicitly deleted on exceptions. This consistent pattern improves reliability in render pipelines.                                                                                                                                </td></tr><tr><td data-label="Logic / Structure"> <strong>Isolation of Responsibility</strong> </td><td data-label="Conceptual Summary"> The module focuses solely on safe file handling and leaves higher-level concerns (logging, HTML composition, etc.) to other layers like <code>core_renderer</code>. This keeps the I/O layer deterministic and easy to audit.                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Testing Guidance</strong>            </td><td data-label="Conceptual Summary"> Tests should cover: read/write round-trip on temporary files, permission errors, directory creation, atomic behavior (verify that partial files are never visible), and cleanup of temp files on simulated exceptions.                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Security Surface</strong>            </td><td data-label="Conceptual Summary"> Very small. No network or arbitrary code execution. File creation confined to expected directories. Proper escaping of path strings minimizes risk from malformed inputs.                                                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Operational Behavior</strong>        </td><td data-label="Conceptual Summary"> The functions execute synchronously and have no external state. They can be safely used in multithreaded or multi-process contexts as long as paths do not overlap.                                                                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Performance Characteristics</strong> </td><td data-label="Conceptual Summary"> Near-O(n) with respect to file size. Atomic operations add small overhead from fsync and replace but are appropriate for critical write paths where correctness matters more than speed.                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Extensibility</strong>               </td><td data-label="Conceptual Summary"> If more complex atomic modes (e.g., binary, append-safe) are needed, they should wrap or extend <code>_atomic_stream_write</code> rather than duplicating its logic. Keep semantics explicit and minimal.                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"> <strong>Summary Statement</strong>           </td><td data-label="Conceptual Summary"> <code>io_utils.py</code> is a precise, low-level I/O toolkit ensuring reliable UTF-8 text reading, directory creation, and atomic file replacement. It underpins the renderer’s safe write pipeline, preventing partial outputs and maintaining predictable behavior across systems.                                                                 </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table17" data-table="Docu_0103_17" style="margin-top:2mm;margin-left:3mm;"><strong>Table 17 • markdown.py</strong></div>
<div class="table-wrapper" data-table-id="table-17"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Module Overview</strong> </td><td data-label="Conceptual Summary"> Modular rendering framework converting CSV, Markdown, or HTML fragments into sanitized, deterministic HTML tables.<br>Composed of <code>core_io</code>, <code>core_table</code>, <code>core_renderer</code>, <code>core_utils</code>, <code>io_utils</code>, and <code>markdown</code>. </td></tr><tr><td data-label="Section"> <strong>Purpose</strong> </td><td data-label="Conceptual Summary"> Normalize, detect, parse, and render tabular input robustly.<br>Emphasizes fail-safe I/O, conservative CSV detection, safe Markdown→HTML, and defensive rendering with fallbacks. </td></tr><tr><td data-label="Section"> <strong>Primary Inputs</strong> </td><td data-label="Conceptual Summary"> File paths (CSV/TSV), raw bytes, raw strings (CSV/Markdown/HTML), pandas-like objects, and iterables of rows/dicts. </td></tr><tr><td data-label="Section"> <strong>Primary Output</strong> </td><td data-label="Conceptual Summary"> Deterministic HTML pages or table fragments.<br>Also returns metadata (table counts, row counts, warnings, runtime) and export bytes (CSV/JSON/XLSX). </td></tr><tr><td data-label="Section"> <strong>Key Functional Areas</strong> </td><td data-label="Conceptual Summary"> 1) Atomic I/O and dir helpers (<code>core_io</code>, <code>io_utils</code>).<br>2) CSV detection/parsing (<code>core_table</code>).<br>3) Markdown stashing and sanitizer (<code>markdown</code>).<br>4) Fragment assembly and page rendering (<code>core_renderer</code>).<br>5) Utilities for IDs, SRI, and checks (<code>core_utils</code>). </td></tr><tr><td data-label="Section"> <strong>Import Strategy</strong> </td><td data-label="Conceptual Summary"> Prefer project-provided overrides when present (<code>render.io_utils</code>).<br>Fallback to local safe defaults to remain self-contained. </td></tr><tr><td data-label="Section"> <strong>Atomic I/O Behavior</strong> </td><td data-label="Conceptual Summary"> Same-directory temp-file writes plus <code>os.replace</code> and best-effort <code>fsync</code>.<br>Ensure parent dirs and cleanup temp artifacts on error. </td></tr><tr><td data-label="Section"> <strong>CSV Detection & Parsing</strong> </td><td data-label="Conceptual Summary"> Conservative heuristics to avoid false positives on Markdown pipes.<br>Use <code>csv.Sniffer</code> and BOM heuristics when appropriate.<br>Prefer pandas when available, else return normalized rows+optional header. </td></tr><tr><td data-label="Section"> <strong>Markdown Handling</strong> </td><td data-label="Conceptual Summary"> Stash fenced and inline code spans.<br>Protect pipes and underscores outside code.<br>Use <code>python-markdown</code> if available, else fallback inline converter and sanitizer. </td></tr><tr><td data-label="Section"> <strong>Rendering Strategy</strong> </td><td data-label="Conceptual Summary"> <code>core_renderer.render_html</code> normalizes inputs, deduplicates assets, and composes fragments.<br>Can render concurrently when available, else sequential fallback. </td></tr><tr><td data-label="Section"> <strong>Table Rendering</strong> </td><td data-label="Conceptual Summary"> <code>core_table.render_table</code> coerces inputs to header+rows, infers alignment/typing, emits accessible HTML with caption, toolbar, export hooks, and metadata script blocks. </td></tr><tr><td data-label="Section"> <strong>Error & Failure Policy</strong> </td><td data-label="Conceptual Summary"> Fail-fast on missing critical modules where appropriate.<br>Otherwise log errors, add structured warnings, and produce minimal valid output rather than crashing. </td></tr><tr><td data-label="Section"> <strong>Concurrency & Temp Fragments</strong> </td><td data-label="Conceptual Summary"> Create unique tmp fragment dirs with timestamp+PID+UUID via <code>tmp_frag_dir_for</code>.<br>Optional multi-threaded rendering falls back to single-threaded on failure. </td></tr><tr><td data-label="Section"> <strong>Security Surface</strong> </td><td data-label="Conceptual Summary"> Enforce HTML sanitization and escape dynamic content.<br>No execution of untrusted code. Use SRI for asset inclusion when mapping provided. </td></tr><tr><td data-label="Section"> <strong>Public API Surface</strong> </td><td data-label="Conceptual Summary"> High-level: <code>core_renderer.render_html(...)</code>.<br>Reusable: <code>core_table.render_table</code>, <code>render_fragment</code>, <code>parse_csv_safe</code>.<br><code>core_io</code> exposes atomic write and CSV sampling helpers. </td></tr><tr><td data-label="Section"> <strong>Testing Implications</strong> </td><td data-label="Conceptual Summary"> Modules designed for deterministic unit tests.<br>Integration tests cover dialect detection, atomic replace, BOM handling, and Markdown/CSV parsing. </td></tr><tr><td data-label="Section"> <strong>Observability</strong> </td><td data-label="Conceptual Summary"> Structured warnings lists and explicit logs (<code>PARSE_TRY</code>, <code>PARSE_OK</code>, <code>PARSE_FAIL</code>).<br><code>return_html=True</code> option for debug inspection. </td></tr><tr><td data-label="Section"> <strong>Performance Notes</strong> </td><td data-label="Conceptual Summary"> Capped sampling sizes and lazy embedding to limit memory usage.<br>Pandas optional acceleration when present. </td></tr><tr><td data-label="Section"> <strong>Extensibility</strong> </td><td data-label="Conceptual Summary"> Pluggable renderer, sanitizer, and export modules.<br>New encodings or dialects can be added without breaking API. </td></tr><tr><td data-label="Section"> <strong>Edge Case Handling</strong> </td><td data-label="Conceptual Summary"> Handles BOMs, mixed encodings, escaped pipes (<code>\|</code>), uneven rows, and malformed CSV.<br>Pads rows to uniform column counts when required. </td></tr><tr><td data-label="Section"> <strong>Integration Role</strong> </td><td data-label="Conceptual Summary"> Acts as the normalization and rendering core for a Tables Viewer pipeline.<br>Upstream supplies raw data; downstream consumes produced HTML and metadata. </td></tr><tr><td data-label="Section"> <strong>Limitations</strong> </td><td data-label="Conceptual Summary"> Not a full CommonMark implementation.<br>Heuristic CSV detection can fail on pathological inputs.<br>No background async processing built-in. </td></tr><tr><td data-label="Section"> <strong>Developer Guidance</strong> </td><td data-label="Conceptual Summary"> Keep compatibility layers small.<br>Prefer single-file, well-tested changes and preserve public function names. </td></tr><tr><td data-label="Section"> <strong>Summary Statement</strong> </td><td data-label="Conceptual Summary"> Defensive, pragmatic rendering core that prioritizes safety, predictability, and fallback resilience.<br>Produces consistent HTML and metadata across expected input variations. </td></tr></tbody></table></div><div class="row-count">Rows: 24</div></div><div class="table-caption" id="Table18" data-table="Docu_0103_18" style="margin-top:2mm;margin-left:3mm;"><strong>Table 18 • sanitize.py</strong></div>
<div class="table-wrapper" data-table-id="table-18"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Module Purpose</strong> </td><td data-label="Conceptual Summary"> Provides a defensive HTML sanitization layer that removes unsafe tags, attributes, and protocols.<br>Core: <code>sanitize_html(html_text, allow_tables=False)</code> ensures output is XSS-safe even for user-supplied HTML. </td></tr><tr><td data-label="Section"> <strong>Design</strong> </td><td data-label="Conceptual Summary"> Dual cleaning pipeline:<br>1) Bleach-based sanitizer with tag/attr revalidation.<br>2) Pure Python fallback using <code>HTMLParser</code>.<br>Script tags are neutralized outside code/pre blocks. </td></tr><tr><td data-label="Section"> <strong>Tag & Attribute Control</strong> </td><td data-label="Conceptual Summary"> Uses strict <code>ALLOWED_TAGS</code> and <code>ALLOWED_ATTRIBUTES</code>.<br>Removes <code>&lt;br&gt;</code> to prevent layout injection.<br>Allows ARIA/data attributes via wildcard matching.<br>Applies per-tag attribute validation. </td></tr><tr><td data-label="Section"> <strong>URL Validation</strong> </td><td data-label="Conceptual Summary"> <code>is_safe_url()</code> limits schemes to <code>http</code>, <code>https</code>, <code>mailto</code>, and validated <code>data:image</code> URIs.<br>Blocks <code>javascript:</code> and unsafe protocols. </td></tr><tr><td data-label="Section"> <strong>Bleach Mode</strong> </td><td data-label="Conceptual Summary"> <code>bleach_clean()</code> applies Bleach with restricted tag/attr lists, then revalidates attributes via regex.<br>Optional linkify converts URLs to anchors.<br>Graceful fallback on Bleach/linkify failure. </td></tr><tr><td data-label="Section"> <strong>Fallback Mode</strong> </td><td data-label="Conceptual Summary"> <code>FallbackCleaner</code> (extends <code>HTMLParser</code>) escapes text safely, preserves only whitelisted tags/attrs, and escapes all others.<br>Zero-dependency sanitizer for minimal environments. </td></tr><tr><td data-label="Section"> <strong>Script Neutralization</strong> </td><td data-label="Conceptual Summary"> <code>_neutralize_script_tags_outside_code()</code> escapes <code>&lt;script&gt;</code> tags unless inside code/pre blocks.<br>Regex-based boundary detection prevents mangling literal code. </td></tr><tr><td data-label="Section"> <strong>Table Permission Logic</strong> </td><td data-label="Conceptual Summary"> Tables (<code>table</code>, <code>tr</code>, <code>td</code>, etc.) allowed only when <code>allow_tables=True</code>.<br>Otherwise stripped entirely for stricter markdown/plain contexts. </td></tr><tr><td data-label="Section"> <strong>Defensive Layers</strong> </td><td data-label="Conceptual Summary"> Multi-layer validation: schema whitelist → URL validation → post-Bleach recheck → script neutralization.<br>Each layer tolerates upstream failure. </td></tr><tr><td data-label="Section"> <strong>Extensibility</strong> </td><td data-label="Conceptual Summary"> Adjustable tag/attr lists for UI or markdown extensions.<br>Designed for import by <code>html_renderer</code> or <code>core_renderer</code>. </td></tr><tr><td data-label="Section"> <strong>Testing Block</strong> </td><td data-label="Conceptual Summary"> <code>__main__</code> executes sample sanitization tests showing before/after output.<br>Demonstrates script stripping and invalid image source removal. </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table19" data-table="Docu_0103_19" style="margin-top:2mm;margin-left:3mm;"><strong>Table 19 • types.py</strong></div>
<div class="table-wrapper" data-table-id="table-19"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Module Overview</strong>               </td><td data-label="Conceptual Summary"> <code>types.py</code> defines shared data structures and aliases for the rendering subsystem. It provides type definitions, common configuration containers, and threading-safe control hooks used across the <code>render</code> package.                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Section"> <strong>Purpose</strong>                       </td><td data-label="Conceptual Summary"> Centralize shared renderer types—especially configuration, result contracts, and optional concurrency parameters—ensuring consistent usage across renderer components like <code>core_renderer</code>, <code>core_table</code>, and <code>html_renderer</code>.                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Section"> <strong>Key Aliases</strong>                   </td><td data-label="Conceptual Summary"> <code>RenderResult</code>: dict-like result container for rendered HTML or metadata.<br><code>TableLike</code>: abstract placeholder for any table-like input (DataFrame, list of lists, etc.).                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section"> <strong>Primary Class</strong>                 </td><td data-label="Conceptual Summary"> <code>RenderConfig</code>: dataclass encapsulating renderer runtime configuration. Enables flexible setup of asset management, logging verbosity, concurrency, caching, and cancellation.                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Section"> <strong>RenderConfig Fields</strong>           </td><td data-label="Conceptual Summary"> • <code>log_level</code>: logging verbosity.<br>• <code>assets_dir</code>: optional custom asset directory.<br>• <code>embed_assets</code>: inline CSS/JS.<br>• <code>bundle_assets</code>: whether to combine resources.<br>• <code>cache_size</code>: render cache entries.<br>• <code>table_render_timeout_ms</code>: time budget per table.<br>• <code>split_threshold</code>: row-count cutoff for pagination.<br>• <code>max_workers</code>: parallel render threads.<br>• <code>table_row_limit</code>: output truncation.<br>• <code>cancel_event</code>: thread-safe abort flag.<br>• <code>progress_callback</code>: optional progress notifier.<br>• <code>gzip_out</code>: compress output artifacts. </td></tr><tr><td data-label="Section"> <strong>Method: <code>resolved_assets_dir</code></strong> </td><td data-label="Conceptual Summary"> Determines the effective path for assets. Returns <code>assets_dir</code> if explicitly set, otherwise defaults to <code>out_dir / &quot;assets&quot;</code>. Ensures predictable asset placement and compatibility with both bundled and standalone modes.                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Threading and Events</strong>          </td><td data-label="Conceptual Summary"> Supports cooperative cancellation via <code>threading.Event</code>, allowing long renders to terminate gracefully when externally requested.                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Extensibility Points</strong>          </td><td data-label="Conceptual Summary"> Future fields may add versioning, environment presets, or render profiles. Designed to be imported by all render-layer modules without causing circular imports.                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Integration Role</strong>              </td><td data-label="Conceptual Summary"> Acts as a foundational type definition layer for the rendering pipeline. Ensures standardized configuration passing and output schema across renderer submodules.                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr></tbody></table></div><div class="row-count">Rows: 9</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>