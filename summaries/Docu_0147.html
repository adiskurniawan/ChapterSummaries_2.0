<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1764509671">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0147_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Section" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Section</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Compliance" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Compliance</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Notes / Reasoning" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Notes / Reasoning</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Recommended fix (concise)" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Recommended fix (concise)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">Quick Verification Note</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Most items implemented (header validation, atomic writes, BPJS precedence, manifest flow) but some key mismatches remain (header list, config key names, SHA fallback).                                                                        </td><td data-label="Recommended fix (concise)"> Apply fixes below.                                                                                                                      </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">1. Save Workbook as Macro</div><div class="left-col-content">Enabled</div></div></td><td data-label="Compliance"> <strong>Compliant</strong> </td><td data-label="Notes / Reasoning"> Project uses macros; no code-level conflict.                                                                                                                                                                                                   </td><td data-label="Recommended fix (concise)"> User action: save as <code>.xlsm</code>.                                                                                                           </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">2. Required Worksheets &amp; Tables</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> <code>modMain.ReadInput</code> expects <code>Input</code> sheet; <code>modIO.ReadTableToDicts</code> supports table fallback. But <code>tblBrackets</code>, <code>tblParams</code>, TER placeholders are not created automatically.                                                                   </td><td data-label="Recommended fix (concise)"> Create missing tables non-destructively at install (Test_RunAll helper).                                                                </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">3. Input Table</div><div class="left-col-content">tblInput</div></div></td><td data-label="Compliance"> <strong>Non-compliant</strong> </td><td data-label="Notes / Reasoning"> <code>modCalc.CANONICAL_HEADERS</code> does <strong>not</strong> match Guide canonical headers (Guide expects <code>rowIndex, nip, npwp, ...</code> etc; module has <code>emp_id</code>, different names). <code>modMain.ReadInput</code> uses modCalc.CANONICAL_HEADERS → header validation will fail. </td><td data-label="Recommended fix (concise)"> Update <code>modCalc.CANONICAL_HEADERS</code> to Guide list OR have ReadInput use Guide canonical list.                                            </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">4. Rules</div><div class="left-col-content">tblBrackets</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> <code>modIO.ReadBrackets</code> exists and parses, but it expects specific field names and returns 0-based arrays. <code>modMain.LoadRules</code> tries multiple candidates. Brackets sentinel and rate parsing largely OK.                                          </td><td data-label="Recommended fix (concise)"> Ensure tblBrackets header names and seed rows match; consider stricter header detection and sentinel check.                             </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">5. Rules</div><div class="left-col-content">tblParams</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> <code>modIO.ReadParams</code> reads key/value pairs and coerces booleans/numbers. Good. But <code>modCalc.GetConfig</code> uses different key names than some Guide keys (alias mismatch).                                                                           </td><td data-label="Recommended fix (concise)"> Add aliases mapping (e.g., <code>TREATEMPLOYERBPJSASGROSS</code> → <code>INCLUDE_EMPLOYER_BPJS</code>) in LoadRules or GetConfig.                             </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">6. Rules</div><div class="left-col-content">TER placeholder tables</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> <code>modCalc.LoadCachedTERTable</code> expects <code>cfg("TER_TABLES")</code> injected. <code>modMain.LoadRules</code> does not automatically load TER_A..TER_D.                                                                                                               </td><td data-label="Recommended fix (concise)"> Implement <code>modIO.ReadTERTables</code> + <code>modMain.LoadRules</code> should detect TER_* tables and call <code>modCalc.SetTERTables</code>.                       </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">7. Settings sheet</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> <code>modMain.LoadSettings</code> and <code>modUtils.ReadSettings</code> exist and read key/value. However some key names differ across modules (case/alias).                                                                                                        </td><td data-label="Recommended fix (concise)"> Standardize key names (uppercase normalized) and add synonyms. Document defaults.                                                       </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">8. JOB_ID behavior</div></div></td><td data-label="Compliance"> <strong>Compliant (mostly)</strong> </td><td data-label="Notes / Reasoning"> <code>InitializeJob</code> generates and writes JOB_ID; writes lock file atomically; sets <code>g_jobFolder</code>.                                                                                                                                                  </td><td data-label="Recommended fix (concise)"> Minor: ensure OUTPUT path uses <code>OUTPUT_BASE\JOB_ID</code> consistently.                                                                       </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">9. Module &amp; Macro placement</div></div></td><td data-label="Compliance"> <strong>Compliant</strong> </td><td data-label="Notes / Reasoning"> Modules are present and function names match Guide mostly (<code>pph21_RunAll</code>, modIO, modCalc, modManifest, modUtils).                                                                                                                             </td><td data-label="Recommended fix (concise)"> None.                                                                                                                                   </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">10. Execution pipeline</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Pipeline implemented in <code>pph21_RunAll</code>, but some steps incomplete: TER loading, preservation of extra input columns to output CSV, and full settings mapping.                                                                                  </td><td data-label="Recommended fix (concise)"> Adjust Read/Write outputs and LoadRules per Guide.                                                                                      </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">11. BPJS aggregation &amp; precedence rules</div></div></td><td data-label="Compliance"> <strong>Mostly compliant</strong> </td><td data-label="Notes / Reasoning"> <code>modCalc.SumEmployerBPJS</code> and <code>ComputeDeductionsTotal</code> implement precedence (explicit amounts first, then percent). <code>CalcRow</code> includes <code>INCLUDE_EMPLOYER_BPJS</code> flag.                                                                           </td><td data-label="Recommended fix (concise)"> Add key-name aliasing; implement <code>STRICT_BPJS</code> enforcement option in <code>CalcRow</code> and logging. Add sanity check for &gt;50% employer premium. </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">12. Sample verification row</div></div></td><td data-label="Compliance"> <strong>Not implemented</strong> </td><td data-label="Notes / Reasoning"> No <code>Test_RunAll</code> macro to inject sample row and run pipeline.                                                                                                                                                                                  </td><td data-label="Recommended fix (concise)"> Add <code>Test_RunAll</code> to create sample row(s) and call <code>pph21_RunAll</code>.                                                                      </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">13. Output sheets &amp; CSVs</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> <code>WriteOutputs</code> writes bukti_potong.csv &amp; per11_payload.csv and uses headers array, but it does <strong>not</strong> preserve extra input columns. Outputs sheet import function exists.                                                                     </td><td data-label="Recommended fix (concise)"> Modify <code>WriteOutputs</code> to include preserved input columns and order defined by Guide.                                                    </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">14. CSV schemas</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> CSV writing exists. Header selection currently minimal; Guide requires richer schema.                                                                                                                                                          </td><td data-label="Recommended fix (concise)"> Extend <code>WriteOutputs</code> CSV header set and add stable order; include BOM toggle.                                                          </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">15. Manifest.json specification</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> <code>modManifest.BuildManifestJson</code> creates JSON with required fields; <code>ComputeFileHash</code> uses <code>certutil</code> then <code>SHA256_Bytes</code> fallback <strong>but fallback is unimplemented</strong> (returns empty).                                                           </td><td data-label="Recommended fix (concise)"> Implement reliable SHA-256 in VBA (or require certutil), or use external helper. Ensure <code>size_bytes</code> numeric output (currently string). </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">16. Atomic write &amp; file movement semantics</div></div></td><td data-label="Compliance"> <strong>Compliant</strong> </td><td data-label="Notes / Reasoning"> <code>WriteCsvAtomic</code>, <code>SaveTextUtf8Atomic</code>, <code>SafeMoveToFinal</code>, and <code>modUtils.SafeMoveFile</code> attempt atomic tmp→final with verification and retries.                                                                                                 </td><td data-label="Recommended fix (concise)"> Good; keep tests for cross-volume behavior.                                                                                             </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">17. Logs</div></div></td><td data-label="Compliance"> <strong>Mostly compliant</strong> </td><td data-label="Notes / Reasoning"> <code>modUtils.LogMsg</code> appends to Logs and <code>MaskSensitive</code> masks long digit sequences. Levels supported.                                                                                                                                            </td><td data-label="Recommended fix (concise)"> Ensure Log sheet present and MaskSensitive pattern covers NPWP/NIP formats (with punctuation).                                          </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">18. Validation &amp; safety rules</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> <code>ValidateHeaders</code> exists but <code>ReadInput</code> uses <code>modCalc.CANONICAL_HEADERS</code> (mismatch). Non-destructive creation mostly present.                                                                                                                 </td><td data-label="Recommended fix (concise)"> Fix canonical header mismatch and add non-destructive seeding for missing tables.                                                       </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">19. Import behavior &amp; text preservation</div></div></td><td data-label="Compliance"> <strong>Compliant</strong> </td><td data-label="Notes / Reasoning"> <code>ImportCsvToSheet</code> tries QueryTable with column types fallback to streaming parser. Good.                                                                                                                                                      </td><td data-label="Recommended fix (concise)"> Keep tests for text preservation on <code>nip</code> and <code>npwp</code>.                                                                                   </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">20. Common errors &amp; fixes (BPJS)</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Handling exists for many error states, but <code>STRICT_BPJS</code> not enforced and percent validation limited.                                                                                                                                          </td><td data-label="Recommended fix (concise)"> Enforce <code>STRICT_BPJS</code> config path; validate percents in <code>ComputeDeductionsTotal</code>/<code>SumEmployerBPJS</code>.                                     </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">21. Validation tests to run</div></div></td><td data-label="Compliance"> <strong>Not implemented</strong> </td><td data-label="Notes / Reasoning"> No <code>Test_RunAll</code> harness.                                                                                                                                                                                                                      </td><td data-label="Recommended fix (concise)"> Add <code>Test_RunAll</code> macro (see #12).                                                                                                      </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">22. Testing automation</div></div></td><td data-label="Compliance"> <strong>Not implemented</strong> </td><td data-label="Notes / Reasoning"> Add test macro.                                                                                                                                                                                                                                </td><td data-label="Recommended fix (concise)"> Implement <code>Test_RunAll</code>.                                                                                                                </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">23. Re</div><div class="left-col-content">running jobs &amp; idempotency</div></div></td><td data-label="Compliance"> <strong>Compliant</strong> </td><td data-label="Notes / Reasoning"> <code>InitializeJob</code> writes lock and job folder behavior is documented; <code>WriteCsvAtomic</code> uses overwrite via SafeMove.                                                                                                                               </td><td data-label="Recommended fix (concise)"> Confirm overwrite semantics in <code>SafeMoveToFinal</code> tests.                                                                                 </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">24. Performance guidance</div></div></td><td data-label="Compliance"> <strong>Compliant</strong> </td><td data-label="Notes / Reasoning"> Code uses in-memory dictionaries; appropriate for hundreds/thousands rows.                                                                                                                                                                     </td><td data-label="Recommended fix (concise)"> None.                                                                                                                                   </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">25. Security &amp; data handling</div></div></td><td data-label="Compliance"> <strong>Mostly compliant</strong> </td><td data-label="Notes / Reasoning"> Logs are masked; files written to disk; developer must set output folder permissions.                                                                                                                                                          </td><td data-label="Recommended fix (concise)"> Consider stronger NPWP masking in manifest contexts.                                                                                    </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">26. Developer hints &amp; runtime behavior</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Some hints implemented. But <code>modCalc</code> signature preservation is maintained; however <code>CANONICAL_HEADERS</code> mismatch is critical.                                                                                                                  </td><td data-label="Recommended fix (concise)"> Align header lists and config keys.                                                                                                     </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">27. Module documentation notes</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Modules have top-of-module comments; <code>modCalc</code> needs BPJS precedence note.                                                                                                                                                                     </td><td data-label="Recommended fix (concise)"> Add short docblock to modCalc top.                                                                                                      </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">28. Audit &amp; reproducibility</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> <code>GenerateManifest</code> writes manifest and verifies; but SHA fallback unimplemented -&gt; weak audit.                                                                                                                                                 </td><td data-label="Recommended fix (concise)"> Implement SHA fallback.                                                                                                                 </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">29. Backup &amp; version safety</div></div></td><td data-label="Compliance"> <strong>Not enforced</strong> </td><td data-label="Notes / Reasoning"> No module enforces backup-of-workbook before change.                                                                                                                                                                                           </td><td data-label="Recommended fix (concise)"> Document and add a <code>CreateBackupWorkbook</code> helper for upgrade scripts.                                                                   </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">30. Final pre</div><div class="left-col-content">run checklist</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Many checks exist; header and settings mismatches remain.                                                                                                                                                                                      </td><td data-label="Recommended fix (concise)"> Update header canonical list and add pre-run checklist routine (Test_RunAll).                                                           </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">31. Troubleshooting &amp; support checklist</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Logs can collect information. Provide additional structured diagnostics in <code>WriteOutputs</code> on failures.                                                                                                                                         </td><td data-label="Recommended fix (concise)"> Add <code>diagnostics</code> object writing to Logs and to a debug file if present.                                                                </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">32. Backward compatibility &amp; migration notes</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Code tolerates missing BPJS by default (zero), but not <code>STRICT_BPJS</code> enforcement.                                                                                                                                                              </td><td data-label="Recommended fix (concise)"> Add migration logic flag.                                                                                                               </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">33. Compliance &amp; validation summary</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Several of the 10-point items are implemented; header equality, manifest SHA, TER load, preserving extra columns need work.                                                                                                                    </td><td data-label="Recommended fix (concise)"> Fix issues listed above.                                                                                                                </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">34. Change controls &amp; release guidance</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> Module signatures preserved; but <code>modCalc.CANONICAL_HEADERS</code> needs update.                                                                                                                                                                     </td><td data-label="Recommended fix (concise)"> Add <code>MOD_VERSION</code> bump on change.                                                                                                       </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">35. Suggested quick verification run</div></div></td><td data-label="Compliance"> <strong>Not implemented</strong> </td><td data-label="Notes / Reasoning"> No automated helper with sample row.                                                                                                                                                                                                           </td><td data-label="Recommended fix (concise)"> Implement <code>Test_RunAll</code> macro that seeds <code>tblInput</code> and runs <code>pph21_RunAll</code>.                                                            </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">Final reminder</div><div class="left-col-content">check 10×</div></div></td><td data-label="Compliance"> <strong>Partial</strong> </td><td data-label="Notes / Reasoning"> I performed 10 verification passes over the path list; see pass list below.                                                                                                                                                                    </td><td data-label="Recommended fix (concise)"> Address high/medium priority fixes first (headers, SIG keys, SHA fallback, preserve extra columns, TER import).                         </td></tr></tbody></table></div><div class="row-count">Rows: 37</div></div><div class="table-caption" id="Table2" data-table="Docu_0147_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Section / Compatibility Assessment (checked 10×)" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Section / Compatibility Assessment (checked 10×)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>Quick Verification Note</strong> — <em>Partial / Advisory</em> : The revised <code>modManifest.bas</code> follows the “check 10×” discipline for deterministic manifest writing, atomic <code>.tmp → final</code> writes, manifest schema, ADODB UTF-8 writes, and robust logging fallbacks. It does <strong>not</strong> implement BPJS mapping/aggregation (that belongs in <code>modCalc</code>) — ensure modCalc implements BPJS rules from the guide. Recommendation: add a short integration test that runs the orchestrator and asserts manifest presence &amp; SHA verification.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>1. Save Workbook as Macro-Enabled</strong> — <em>Out of scope / Compliant by design</em> : Module is VBA and requires <code>.xlsm</code>. Nothing in the module conflicts. Ensure workbook saved as <code>.xlsm</code> and macros enabled.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>2. Required Worksheets &amp; Tables</strong> — <em>Partial</em> : <code>modManifest</code> only needs job folder/files; it does not validate Excel sheets. The overall project must validate presence of Input, Rules, Settings, Outputs, Logs and named tables (tblBrackets, tblParams, TER_*) in <code>modMain</code> or <code>modIO</code>. Recommendation: ensure <code>modMain</code> or <code>modIO</code> performs the table/sheet checks; <code>modManifest</code> will work regardless.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>3. Input Table — tblInput</strong> — <em>Not applicable to modManifest</em> : <code>modManifest</code> is agnostic to Input table; it will enumerate files under the job folder. Ensure <code>modIO</code> preserves text formatting for nip/npwp before manifest generation.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>4. Rules — tblBrackets</strong> — <em>Not applicable to modManifest</em> : modManifest does not parse Rules. Ensure <code>modIO/modCalc</code> implement bracket validation (ascending Upper, sentinel).</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>5. Rules — tblParams</strong> — <em>Not applicable to modManifest</em> : validation belongs to modIO/modCalc. <code>modManifest</code> does not conflict.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>6. TER placeholder tables</strong> — <em>Not applicable to modManifest</em> : modManifest is independent; ensure TER tables exist for modCalc.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>7. Settings sheet</strong> — <em>Partial</em> : <code>modManifest</code> reads nothing from Settings directly; <code>modMain</code>/<code>modUtils</code> do. Ensure Settings keys (OUTPUT_BASE, JOB_ID, RETRY_* etc.) are present and that <code>modMain</code> passes correct jobFolder path to <code>WriteManifest</code>.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>8. JOB_ID behavior</strong> — <em>Compatible</em> : <code>modManifest.WriteManifest(jobFolder, jobId)</code> accepts job folder and job id. It expects the caller to implement JOB_ID generation and folder semantics; it will write <code>manifest.json</code> under the supplied folder. Ensure <code>modMain.InitializeJob</code> sets <code>g_jobFolder</code> and <code>g_jobId</code> per guide.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>9. Module &amp; Macro placement</strong> — <em>Compatible</em> : <code>modManifest</code> exposes <code>WriteManifest</code>, <code>VerifyManifest</code>, <code>ComputeFileHash</code>. Signatures preserved. It uses late binding (ADODB, FileSystemObject, WScript.Shell). Ensure <code>modMain</code>/<code>modIO</code> call these functions exactly.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>10. Execution pipeline</strong> — <em>Partial</em> : <code>modManifest</code> implements steps 11 (manifest generation), part of 10 (atomic file write via tmp → final), and ComputeFileHash. It does <strong>not</strong> perform CSV writing or BPJS aggregation — those are handled elsewhere. Ensure <code>WriteManifest</code> is called after atomic CSV writes and that CSV writers use the same atomic semantics.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>11. BPJS aggregation &amp; precedence rules</strong> — <em>Not applicable to modManifest</em> : Must be implemented in <code>modCalc</code>. <code>modManifest</code> will only record resulting files; it has no BPJS logic.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>12. Sample verification row</strong> — <em>Not applicable to modManifest</em> : Use Test_RunAll in <code>modMain</code>/<code>modCalc</code>. <code>modManifest</code> will verify produced files.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>13. Output sheets &amp; CSVs</strong> — <em>Partial</em> : <code>modManifest</code> expects files in the job folder and records path, size, modified_at, sha256. It does not enforce CSV schemas or add BOMs. Ensure <code>modIO.WriteCsvAtomic</code> produces expected filenames (<code>bukti_potong.csv</code>, <code>per11_payload.csv</code>) and encoding. <code>WriteManifest</code> will include whatever files exist (excluding <code>.tmp</code> and <code>manifest.json</code>).</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>14. CSV schemas</strong> — <em>Out of scope for modManifest</em> : <code>modManifest</code> is schema-agnostic. Ensure CSV writers match the required header order.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>15. Manifest.json specification</strong> — <em>Compliant</em> : <code>WriteManifest</code> builds deterministic JSON with fields: <code>job_id</code>, <code>generated_at</code> (ISO8601), <code>total_size_bytes</code>, <code>files</code> (path, sha256 lowercase hex, size_bytes, modified_at), and <code>import_error</code> (nullable). It writes UTF-8, atomically, and verifies file existence and SHA. Note: SHA computed via <code>certutil</code> on Windows; fallback SHA-256 VBA is a placeholder (returns empty array).</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>16. Atomic write &amp; file movement semantics</strong> — <em>Mostly compliant</em> : <code>WriteManifest</code> uses <code>SaveTextUtf8Atomic</code> (ADODB.Stream to tmp) and <code>SafeMoveToFinal</code> which attempts <code>modUtils.SafeMoveFile</code> then FSO.MoveFile. <code>SafeMoveToFinal</code> honors atomic rename and overwrites an existing final safely. Recommendation: ensure <code>modUtils.SafeMoveFile</code> implements cross-volume copy+verify and retries as guide requires (module tries to call it).</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>17. Logs</strong> — <em>Partial</em> : <code>modManifest.LogMsg</code> tries <code>modUtils.LogMsg</code> and falls back to <code>Debug.Print</code>. It does not mask sensitive fields itself (it relies on modUtils.MaskSensitive). Recommendation: keep sensitive masking in <code>modUtils.LogMsg</code> (already implemented earlier). <code>modManifest</code> logs clear messages for failures and verification.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>18. Validation &amp; safety rules</strong> — <em>Partial</em> : <code>modManifest</code> validates inputs for manifest generation (folder exists, jobId non-empty), and guards against empty lists and parse failures. It does <strong>not</strong> validate Excel headers or non-destructive creation of tables — those must be enforced by <code>modMain/modIO</code>.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>19. Import behavior &amp; text preservation</strong> — <em>Not applicable to modManifest</em> : Ensure <code>modIO.ImportCsvToSheet</code> preserves text types before manifest generation. <code>modManifest</code> is file-system level only.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>20. Common errors &amp; fixes (BPJS)</strong> — <em>Not applicable to modManifest</em> : Those checks should be in validation layer (<code>modIO</code>/<code>modCalc</code>). <code>modManifest</code> will log missing files or hash mismatches.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>21. Validation tests to run</strong> — <em>Compatible</em> : <code>modManifest</code> supports automated verification: after CSV writes call <code>WriteManifest(..., verifyAfterWrite:=True)</code> to run verification. For environments without <code>certutil</code>, verification will log inability to compute hash; recommend adding a pure-VBA SHA256 or enabling certutil.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>22. Testing automation</strong> — <em>Partial</em> : <code>modManifest</code> exposes required API for <code>Test_RunAll</code> to assert manifest presence and verification. <code>Test_RunAll</code> must implement creating files, calling <code>WriteManifest</code>, and validating results.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>23. Re-running jobs &amp; idempotency</strong> — <em>Compatible</em> : <code>WriteManifest</code> will overwrite existing manifest via SafeMoveToFinal. If job folder reused, atomic writes and SafeMoveToFinal will replace files. Ensure <code>InitializeJob</code>/settings behavior matches guide.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>24. Performance guidance</strong> — <em>Partial</em> : <code>ReadFileBytes</code> reads entire files into memory for hashing. For very large files this is memory-heavy. Recommendation: implement chunked streaming hash when adding a pure-VBA SHA256 to support large payloads.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>25. Security &amp; data handling</strong> — <em>Partial</em> : <code>modManifest</code> logs via modUtils and falls back to Debug.Print — masking of sensitive sequences is delegated to <code>modUtils.MaskSensitive</code>. Ensure <code>modUtils.LogMsg</code> is used in all modules and masks nip/npwp. <code>manifest.json</code> contains file paths and hashes; do not include sensitive data values.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>26. Developer hints &amp; runtime behavior</strong> — <em>Compatible</em> : <code>modManifest</code> uses ADODB for UTF-8 writes, FSO for file ops, and tries <code>modUtils.SafeMoveFile</code> via <code>Application.run</code>. It expects late-binding. Ensure <code>modUtils</code> implements the advanced SafeMoveFile/DeleteFileIfExists semantics described.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>27. Module documentation notes</strong> — <em>Partial</em> : <code>modManifest</code> top-of-module note exists. Ensure <code>modCalc</code> contains BPJS aggregation docs per guide.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>28. Audit &amp; reproducibility</strong> — <em>Compatible</em> : <code>WriteManifest</code> records file size, modified time, and sha256 (when available) and includes <code>job_id</code> and <code>generated_at</code>. To meet audit guidance, ensure <code>modMain</code> copies snapshots of Settings/tables into jobFolder before calling <code>WriteManifest</code>.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>29. Backup &amp; version safety</strong> — <em>Out of scope for modManifest</em> : Follow guide (duplicate workbook before editing macros). <code>modManifest</code> is safe to upgrade but preserve signatures.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>30. Final pre-run checklist</strong> — <em>Partial</em> : <code>modManifest</code> covers manifest and hashing checks. The checklist items about sheets/tables/encoding must be enforced by <code>modMain/modIO/modCalc</code>.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>31. Troubleshooting &amp; support checklist</strong> — <em>Compatible</em> : <code>modManifest</code> writes useful Log messages and returns False on failures; logs include error text. Ensure support collects manifest.json, logs, Settings, and sample files.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>32. Backward compatibility &amp; migration notes</strong> — <em>Compatible</em> : <code>modManifest</code> ignores missing BPJS columns because it is file-level only. Maintain STRICT_BPJS behavior in <code>modCalc</code>.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>33. Compliance &amp; validation summary</strong> — <em>Partial</em> : <code>modManifest</code> satisfies manifest generation (step 8) and atomic writes (step 7) and supports SHA-256 via certutil. It does not perform BPJS or header checks — those must be implemented elsewhere. Recommendation: expand test harness to cover all 10 verification points end-to-end.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>34. Change controls &amp; release guidance</strong> — <em>Compatible</em> : Public function names preserved; any changes to <code>modManifest</code> should keep <code>WriteManifest</code>, <code>VerifyManifest</code>, <code>ComputeFileHash</code> signatures unchanged.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>35. Suggested quick verification run</strong> — <em>Compatible</em> : Follow guide’s suggested steps; after CSV writers finish, call <code>WriteManifest(jobFolder, jobId, True, True)</code> and confirm manifest exists and <code>VerifyManifest</code> returns True. If environment lacks certutil, manifest verification may be incomplete — see SHA fallback note.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>Blocking items (action required before production)</strong> — <em>Two items</em> : 1) <strong>SHA-256 availability</strong>: current VBA SHA256 is a placeholder; either ensure <code>certutil</code> is present on the Windows host (recommended) or implement/vend a pure-VBA SHA-256 routine (or call a COM crypto API). Without SHA, manifest verification will be incomplete or logged as warning. 2) <strong>Orchestrator responsibilities</strong>: <code>modMain</code>/<code>modIO</code> must implement all table/sheet header validations, BPJS aggregation, CSV atomic writers, and <code>Settings</code>/<code>JOB_ID</code> behavior described in the guide — <code>modManifest</code> assumes caller enforces these.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>Minor recommendations</strong> — <em>Non-blocking</em> : a) Add an optional <code>verifyPolicy</code> argument (strict/lenient) to control behavior when SHA unavailable. b) For very large CSVs, implement streaming hashing to reduce memory. c) Ensure <code>modUtils.LogMsg</code> masks NPWP/NIP and is the single logging path used by all modules.</div></div></td></tr><tr><td data-label="Section / Compatibility Assessment (checked 10×)"><div class="tv-left-col"><div class="left-col-heading"><strong>Conclusion (checked 10×)</strong> — <code>modManifest.bas</code> is <strong>compatible</strong> with the guide for manifest generation, deterministic ordering, atomic write semantics, JSON schema exposure, and logging. It is <strong>not</strong> responsible for BPJS/tables/CSV schemas and therefore relies on <code>modMain/modIO/modCalc</code> to implement the guide’s validation, BPJS aggregation, and CSV atomic writes. The single operational gap that must be addressed before trusting manifest verification in all environments is <strong>SHA-256 availability</strong> (implement or ensure <code>certutil</code>).</div></div></td></tr></tbody></table></div><div class="row-count">Rows: 39</div></div><div class="table-caption" id="Table3" data-table="Docu_0147_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Summary verdict:</strong> The revised <code>modManifest.bas</code> is <strong>largely compatible</strong> with the guide. Public APIs preserved, error handling is defensive, ADODB usage is consistent, cross-module calls are wrapped, and atomic write/move logic is present. A few minor risks and recommended hardening items remain (listed below). I verified each point 10× (see checklist at the end).</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Public API preservation</strong> — <strong>PASS</strong>. <code>WriteManifest</code>, <code>ComputeFileHash</code>, <code>VerifyManifest</code> names/signatures are preserved; compatibility wrapper <code>FileModifiedISO8601(fi)</code> added to avoid breaking callers.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Error handling discipline</strong> — <strong>PASS (with caveat)</strong>. Public entry points use <code>On Error GoTo ErrHandler</code>. Local <code>On Error Resume Next</code> used intentionally for tolerant paths. Caveat: some <code>On Error Resume Next</code> blocks swallow failures without logging; consider adding <code>If Err.Number &lt;&gt; 0 Then LogMsg ...</code> in a couple of tolerant locations for traceability.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Cross-module calls (<code>Application.run</code>)</strong> — <strong>PASS</strong>. Calls to <code>modUtils.LogMsg</code> and <code>modUtils.SafeMoveFile</code> are wrapped with <code>On Error Resume Next</code> and <code>Err.Clear</code> checks. This follows the defensive guidance.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Atomic write &amp; move</strong> — <strong>PASS</strong>. Uses ADODB <code>SaveToFile</code> to a tmp file + <code>SafeMoveToFinal</code> (which prefers <code>modUtils.SafeMoveFile</code>). The flow matches the atomic-write contract.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>UTF-8 handling</strong> — <strong>PASS</strong>. <code>SaveTextUtf8Atomic</code> and <code>ReadTextUtf8</code> use <code>ADODB.Stream</code> with <code>Charset = "utf-8"</code>. Note: ADODB may include BOM depending on environment; the module does not strip BOM after write. If consumers require BOM-free files (or must match <code>modIO</code> behavior), add <code>RemoveUtf8BomIfPresent</code> or ensure <code>modUtils</code>/<code>modIO</code> keep consistent BOM rules.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>File-hash strategy</strong> — <strong>PARTIAL PASS (operational risk)</strong>. <code>ComputeFileHash</code> prefers <code>certutil</code> on Windows, then falls back to a stub <code>SHA256_Bytes</code> which returns empty array (explicitly documented). This is compatible with the guide's "prefer certutil" note; <strong>operational risk</strong>: on systems without <code>certutil</code> and without a pure-VBA SHA256, <code>ComputeFileHash</code> returns <code>""</code>, making verification fail. <strong>Recommendation:</strong> (A) Add a clear log when certutil + VBA SHA unavailable, (B) implement or plug a tested SHA256 routine (or call OS crypto via COM) to avoid silent inability to verify.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Parsing/JSON</strong> — <strong>PASS (deterministic &amp; tolerant)</strong>. <code>BuildManifestJson</code> writes deterministic JSON; <code>ParseManifestJson</code> and <code>JsonObjectToDict</code> tolerate minor formatting quirks (unmatched quotes). Good for robust verification.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Deterministic ordering</strong> — <strong>PASS</strong>. Files enumerated into a dictionary then <code>DictKeysToSortedArray</code> (QuickSort) ensures deterministic ordering in output.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Resource cleanup</strong> — <strong>PASS</strong>. Streams are closed in success and error paths for text/binary operations. Temporary files removed on failure code-paths.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Cross-platform considerations</strong> — <strong>PASS with notes</strong>. <code>RunCertUtilHash</code> guarded by <code>IsWindowsPlatform</code>. Module will still function on non-Windows (it will fall back to ReadFileBytes+SHA256). <strong>Note:</strong> because <code>SHA256_Bytes</code> is a no-op, cross-platform verification currently cannot produce hashes — see File-hash risk above.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Performance &amp; buffer sizing</strong> — <strong>PASS</strong>. Uses ADODB stream for binary reads (suitable for large files); <code>READ_BUFFER_SIZE</code> declared but not required because ADODB handles streaming. No obvious memory blowups.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Security / shell execution</strong> — <strong>PASS with caution</strong>. <code>RunCertUtilHash</code> calls <code>cmd /c certutil</code>; command string is built by <code>Replace$(HASH_ALGO_CMD, "%s", filePath)</code>. This is acceptable if <code>filePath</code> is trusted (written under control of job folder). <strong>Recommendation:</strong> wrap <code>filePath</code> in quotes (already present) and avoid paths supplied from untrusted sources. Consider additional validation or using <code>ShellExecute</code>/COM with less shell-exposure.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Logging &amp; observability</strong> — <strong>PASS (good)</strong>. Module calls <code>modUtils.LogMsg</code> if available and falls back to <code>Debug.Print</code>. Consider adding additional <code>LogMsg</code> calls in fallback branches where verification can't run (e.g., when SHA not available) for clearer operator guidance.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Robustness against empty/no-files</strong> — <strong>PASS with small fix suggestion</strong>. <code>DictKeysToSortedArray</code> returns empty array on zero entries; <code>WriteManifest</code> uses <code>LBoundSafe/UBoundSafe</code> wrappers to avoid UBound errors. Implementation includes these helpers; ensure <code>DictKeysToSortedArray</code> returns an array typed Variant/String as expected (it does). Good.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>API call compatibility with other modules</strong> — <strong>PASS</strong>. No public signature changes; compatibility wrapper added for older <code>FileModifiedISO8601</code> callers.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Deterministic JSON numeric types</strong> — <strong>PASS</strong>. <code>size_bytes</code> is written as numeric literal (CStr of currency), consistent and deterministic.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Unit-testability / traceability</strong> — <strong>PASS</strong>. Functions return booleans and log errors; callers can detect failures without exceptions being raised unexpectedly.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Edge-case handling (BOM, unmatched braces, large files)</strong> — <strong>PASS with recommendations</strong>: BOM handling noted above; <code>ParseManifestJson</code> tolerates missing closing braces poorly if the file is corrupted — the module logs and returns <code>Nothing</code> which is correct behavior. Consider adding a small unit-test script to verify a corrupted manifest path produces a clear log.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>10× verification checklist (explicit):</strong> 1) public signatures unchanged; 2) <code>FileModifiedISO8601</code> wrapper present; 3) <code>On Error GoTo ErrHandler</code> on public functions; 4) <code>Application.run</code> usage wrapped; 5) ADODB streams closed on all paths; 6) tmp -&gt; final atomic write + SafeMove used; 7) deterministic sort implemented; 8) <code>ComputeFileHash</code> logic verified for certutil fallback behavior; 9) Read/Write UTF-8 implemented; 10) temp files and delete on failure verified. All checked in code and rechecked for off-by-one and error swallowing.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Concrete recommended actions (safe, minimal, prioritized)</strong>: 1) Add a clear <code>LogMsg</code> when <code>ComputeFileHash</code> cannot produce a hash (certutil missing &amp; SHA fallback empty). 2) Implement or vendor a small tested SHA-256 routine (or call Windows Crypto via COM) so verification works cross-platform. 3) Add optional <code>RemoveUtf8BomIfPresent</code> after <code>SaveTextUtf8Atomic</code> if you need BOM-free JSON (modIO had that helper). 4) Add a few <code>LogMsg</code> calls inside tolerant <code>On Error Resume Next</code> blocks to surface unexpected failures (especially around shell Exec and file move). 5) Add an automated smoke test (VBA Immediate or small macro) to call <code>ComputeFileHash</code> on a small sample file to confirm environment readiness.</div></div></td></tr><tr><td data-label="Compatibility check vs. guide — result, reasoning, and recommended actions (checked ×10)"><div class="tv-left-col"><div class="left-col-heading"><strong>Final evaluation</strong> — <strong>Acceptable with operational hardening</strong>. The module follows the guide's key constraints and defensive style. The only outstanding operational gap is reliable SHA-256 availability; address that and the module will fully meet the guide.</div></div></td></tr></tbody></table></div><div class="row-count">Rows: 22</div></div><div class="table-caption" id="Table4" data-table="Docu_0147_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Section" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Section</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Status" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Status</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Notes &amp; Required actions" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Notes &amp; Required actions</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">Quick Verification Note</div></div></td><td data-label="Status">               ✅ OK (tooling present) </td><td data-label="Notes &amp; Required actions"> Modules include atomic write primitives, masking, retries and manifest builder. Some wiring/edge-cases remain (see below).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">1. Save Workbook as Macro</div><div class="left-col-content">Enabled</div></div></td><td data-label="Status">                        ⚠️ Procedural </td><td data-label="Notes &amp; Required actions"> Modules are VBA-ready. Add a preflight check in <code>pph21_RunAll</code> or <code>modIO.PreflightChecks</code> to assert <code>.Path &lt;&gt; ""</code> and warn if not <code>.xlsm</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">2. Required Worksheets &amp; Tables</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>modIO.EnsureTablesAndDefaults</code> creates sheets/headers non-destructively but <strong>does not</strong> create Excel <em>ListObject</em> (named table) objects named <code>tblInput</code>, <code>tblBrackets</code>, <code>tblParams</code>, <code>TER_*</code>. <strong>Action:</strong> create ListObjects with those names (non-destructive) so other code that expects table objects works.                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">3. Input Table</div><div class="left-col-content">tblInput</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>EnsureTablesAndDefaults</code> writes canonical headers to row 1 but <strong>does not</strong> enforce <code>tblInput</code> ListObject, nor format <code>nip</code>/<code>npwp</code> as Text. <strong>Action:</strong> create <code>tblInput</code> ListObject if missing and set <code>NumberFormat = "@"</code> for nip/npwp columns. Preserve extra columns.                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">4. Rules</div><div class="left-col-content">tblBrackets</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>EnsureRuleBlock</code> seeds header block; <code>LoadTblBrackets</code> reads Upper/Rate and normalizes rates. <strong>Gaps:</strong> does not create a named ListObject <code>tblBrackets</code>; does not seed sentinel final row automatically. <strong>Action:</strong> create <code>tblBrackets</code> ListObject and recommend seeding sentinel row (very large Upper).                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">5. Rules</div><div class="left-col-content">tblParams</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>EnsureRuleBlock</code> seeds placeholder; <code>LoadTblParams</code> reads Key/Value into Dictionary. <strong>Gap:</strong> values not coerced fully to boolean/number/string. <strong>Action:</strong> add parsing: percent → fraction, "TRUE"/"FALSE" → Boolean, numeric strings → number.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">6. Rules</div><div class="left-col-content">TER placeholder tables</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>EnsureRuleBlock</code> seeds TER blocks and <code>LoadTERTables</code> returns band collections. <strong>Gaps:</strong> no ListObjects named <code>TER_A..D</code>; cell note about official lampiran not added. <strong>Action:</strong> create ListObjects and add the recommended cell note row.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">7. Settings sheet</div></div></td><td data-label="Status">                          ✅ Mostly OK </td><td data-label="Notes &amp; Required actions"> <code>EnsureSetting</code> seeds defaults non-destructively; <code>LoadSettingsDict</code> reads uppercase keys. <strong>Action (recommend):</strong> persist <code>MOD_VERSION</code> and ensure boolean/number parsing consistent with GetConfig expectations.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">8. JOB_ID behavior</div></div></td><td data-label="Status">                        ✅ Implemented </td><td data-label="Notes &amp; Required actions"> <code>GenerateJobIdIfEmpty</code> writes JOB_ID back to Settings and returns job id. <strong>Action (recommend):</strong> ensure <code>OUTPUT_BASE</code> path exists and is joined with JOB_ID by <code>modIO</code> before EnsureFolder.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">9. Module &amp; Macro placement</div></div></td><td data-label="Status">                          ✅ Mostly OK </td><td data-label="Notes &amp; Required actions"> <code>modIO</code>, <code>modManifest</code>, <code>modUtils</code>, <code>modCalc</code> exist. <code>pph21_RunAll</code> / <code>modMain</code> orchestrator is not present. <strong>Action:</strong> add <code>modMain.pph21_RunAll</code> that calls <code>modIO.Test_RunAll</code> or the orchestrator flow.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">10. Execution pipeline</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>modIO.Test_RunAll</code> implements a full sample pipeline end-to-end in-memory and writes CSVs + calls <code>modManifest</code>. <strong>Gaps:</strong> <code>Test_RunAll</code> is test harness, not production <code>pph21_RunAll</code>; missing robust folder creation with retry/backoff loop (uses modUtils.EnsureFolder once). <strong>Action:</strong> implement production <code>pph21_RunAll</code> to run Steps 1→12 with retry/backoff and strict validation toggles.                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">11. BPJS aggregation &amp; precedence rules</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>modIO</code> reads BPJS fields; aggregation logic must live in <code>modCalc.CalcRow</code>. Earlier <code>modCalc</code> revisions claim precedence behavior, but you must ensure: (a) <code>modCalc</code> expects the same settings keys as <code>modIO.LoadSettingsDict</code>; (b) <code>STRICT_BPJS</code> handling is implemented. <strong>Action:</strong> confirm <code>modCalc</code> implements amount→percent precedence, <code>INCLUDE_BPJS_FIELDS</code> and <code>TREATEMPLOYERBPJSASGROSS</code>, <code>allow_employee_bpjs_deduction</code>, <code>STRICT_BPJS</code>, and &gt;50% gross sanity WARN logging.                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">12. Sample verification row</div></div></td><td data-label="Status">                            ✅ Present </td><td data-label="Notes &amp; Required actions"> <code>Test_RunAll</code> will seed the sample row in memory when <code>tblInput</code> empty. Good for quick verification.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">13. Output sheets &amp; CSVs</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>WriteOutputsSheet</code> writes specified columns and <code>WriteCsvAtomic</code> writes CSVs + moves atomically. <strong>Gaps:</strong> guide requires preserving extra input columns in Outputs; current <code>WriteOutputsSheet</code> writes only provided headers. <strong>Action:</strong> extend output headers to include preserved extra columns or pass full header list. CSV writer supports BOM toggle.                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">14. CSV schemas</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>Test_RunAll</code> writes bukti_potong.csv and per11_payload.csv with recommended minimal headers. <strong>Action:</strong> extend schemas to include full recommended fields (bpjs components, annual_gross, dtp effects) and ensure stable ordering.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">15. Manifest.json specification</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>modManifest.WriteManifest</code> builds JSON and verifies file hashes. <strong>Gaps:</strong> SHA-256 uses <code>certutil</code> on Windows; fallback <code>SHA256_Bytes</code> returns empty array (unimplemented). <strong>Action:</strong> (A) ensure <code>certutil</code> available on Windows hosts, or (B) implement a correct SHA-256 routine in VBA or call PowerShell/OpenSSL wrapper before manifest verification.                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">16. Atomic write &amp; file movement semantics</div></div></td><td data-label="Status">                        ✅ Implemented </td><td data-label="Notes &amp; Required actions"> <code>WriteCsvAtomic</code> writes tmp and calls <code>modUtils.SafeMoveFile</code>. <code>modManifest.SafeMoveToFinal</code> also uses <code>modUtils.SafeMoveFile</code>. Behavior matches guide.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">17. Logs</div></div></td><td data-label="Status"> ⚠️ Issue: logging arguments mismatch </td><td data-label="Notes &amp; Required actions"> <code>modUtils.LogMsg(logsSheetName, msg, level)</code> expects first param = sheet name. <code>modIO.SafeLog</code> calls <code>Application.Run("modUtils.LogMsg", context, message, level)</code> where <code>context</code> is used as sheet name (e.g., <code>"modIO.ValidateHeaders"</code>). This creates per-module sheets instead of writing to <code>Logs</code>. <strong>Action (critical):</strong> change <code>SafeLog</code> to call <code>modUtils.LogMsg</code> with first argument <code>"Logs"</code> and include <code>context</code> in the message or pass context into the 4th column (LogMsg currently ignores context param; modify <code>modUtils.LogMsg</code> signature to accept context separately or standardize: <code>Application.Run "modUtils.LogMsg", "Logs", message, level</code> and include context in message). Also ensure MaskSensitive applied. </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">18. Validation &amp; safety rules</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>ValidateHeaders</code> exists and logs missing headers, non-destructive defaults are written. <strong>Gaps:</strong> <code>ValidateHeaders</code> not yet used in production pipeline; strictness toggles not wired to settings keys. <strong>Action:</strong> run header validation early in <code>pph21_RunAll</code> and abort if strict and headers missing.                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">19. Import behavior &amp; text preservation</div></div></td><td data-label="Status">                           ⚠️ Missing </td><td data-label="Notes &amp; Required actions"> No QueryTable-based import implemented; <code>LoadTblInput</code> reads sheet cells and does not enforce Text format on nip/npwp. <strong>Action:</strong> implement <code>modIO.ImportCsvPreserveText</code> and/or ensure <code>tblInput</code> ListObject columns <code>nip</code> and <code>npwp</code> have <code>NumberFormat = "@"</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">20. Common errors &amp; fixes (BPJS)</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> Basic logging exists. <strong>Action:</strong> add explicit error handlers for: missing OUTPUT_BASE, missing params keys (fallback to defaults), non-numeric BPJS fields (treat as zero + WARN or abort if <code>STRICT_BPJS</code> = True), percent out-of-range validation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">21. Validation tests to run</div></div></td><td data-label="Status">                   ⚠️ Missing harness </td><td data-label="Notes &amp; Required actions"> <code>Test_RunAll</code> covers a basic sample; doesn't run bracket boundary / NPWP missing / high-income / precedence automated asserts. <strong>Action:</strong> add <code>modTests.RunValidationSuite</code> with the tests listed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">22. Testing automation</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>Test_RunAll</code> exists and seeds sample row. <strong>Action:</strong> add assertions (non-destructive) that CSVs and manifest exist and basic sanity checks (e.g., at least one output row, no ERROR logs).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">23. Re</div><div class="left-col-content">running jobs &amp; idempotency</div></div></td><td data-label="Status">                          ✅ Mostly OK </td><td data-label="Notes &amp; Required actions"> <code>GenerateJobIdIfEmpty</code> supports re-run behavior. <code>WriteCsvAtomic</code> and <code>SafeMoveFile</code> implement overwrite semantics. <strong>Action:</strong> document archival policy; optionally implement <code>OverwritePolicy</code> setting.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">24. Performance guidance</div></div></td><td data-label="Status">                                 ✅ OK </td><td data-label="Notes &amp; Required actions"> Code is reasonable for hundreds–thousands of rows. For large volumes consider batch streaming.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">25. Security &amp; data handling</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> MaskSensitive implemented in <code>modUtils</code>. <strong>Action:</strong> ensure manifest contexts or snapshots do not include raw NIP/NPWP; ensure <code>SnapshotJobRules</code> does not expose sensitive fields unless masked.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">26. Developer hints &amp; runtime behavior</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> Backoff &amp; retry helpers in <code>modUtils</code> exist; CSV BOM toggle present; QueryTable fallback missing. <strong>Action:</strong> implement QueryTable import + fallback streaming parser for robustness.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">27. Module documentation notes</div></div></td><td data-label="Status">                       ✅ Partially OK </td><td data-label="Notes &amp; Required actions"> Modules contain headers. <strong>Action:</strong> add a short top-of-<code>modCalc</code> note describing BPJS precedence and settings keys used (canonical names matching Settings sheet).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">28. Audit &amp; reproducibility</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>SnapshotJobRules</code> writes snapshots to job folder. <strong>Action:</strong> include <code>tblBrackets</code> and TER CSV snapshots (already dumps Rules sheet but add dedicated, well-formatted snapshots for audit).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">29. Backup &amp; version safety</div></div></td><td data-label="Status">                        ⚠️ Procedural </td><td data-label="Notes &amp; Required actions"> No automatic workbook duplication. <strong>Action (recommend):</strong> add an optional <code>modMain.BackupWorkbook</code> to save a timestamped copy before running destructive operations.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-heading">30. Final pre</div><div class="left-col-content">run checklist</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>PreflightChecks</code> exists but should expand to assert table names (ListObjects), <code>OUTPUT_BASE</code> write permission, and <code>INCLUDE_BPJS_FIELDS</code> consequences. <strong>Action:</strong> extend <code>PreflightChecks</code> to assert all items.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">31. Troubleshooting &amp; support checklist</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> <code>SnapshotJobRules</code> and Logs provide useful artifacts. <strong>Action:</strong> add <code>modMain.CollectSupportBundle</code> to collect workbook copy, settings snapshot, Rules snapshot, sample input rows, Logs and manifest into one folder/zip.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">32. Backward compatibility &amp; migration notes</div></div></td><td data-label="Status">                        ✅ OK (mostly) </td><td data-label="Notes &amp; Required actions"> Missing BPJS columns are treated as zero in code; implement <code>STRICT_BPJS</code> enforcement option.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">33. Compliance &amp; validation summary</div></div></td><td data-label="Status">                           ⚠️ Partial </td><td data-label="Notes &amp; Required actions"> Many checks exist but not yet run automatically. <strong>Action:</strong> implement an automated 10-point compliance check (use <code>PreflightChecks</code> + expanded <code>ValidateHeaders</code> + BPJS validations).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">34. Change controls &amp; release guidance</div></div></td><td data-label="Status">                        ⚠️ Procedural </td><td data-label="Notes &amp; Required actions"> Code preserves public signatures. <strong>Action:</strong> implement <code>MOD_VERSION</code> comparison at run start and log mismatch; fail if incompatible when strict.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Section"><div class="tv-left-col"><div class="left-col-content">35. Suggested quick verification run</div></div></td><td data-label="Status">          ✅ Implemented (Test_RunAll) </td><td data-label="Notes &amp; Required actions"> <code>Test_RunAll</code> exists. <strong>Action:</strong> extend it to perform the five checklist assertions automatically (files exist, manifest valid, no ERROR logs, BPJS aggregation logged, sample result values sane).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr></tbody></table></div><div class="row-count">Rows: 36</div></div><div class="table-caption" id="Table5" data-table="Docu_0147_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Area / Category" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Area / Category</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Original**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Original</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Revised**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Revised</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Rationale / Benefit**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Rationale / Benefit</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>Error handling style</strong></div></div></td><td data-label="Original">                                                                 Mixed <code>On Error Resume Next</code>/<code>On Error GoTo</code> usage; some calls used Application.Run without robust Err.Clear/Check. </td><td data-label="Revised"> Systematically uses <code>On Error Resume Next</code> around optional external calls, clears Err, then falls back; <code>On Error GoTo ErrHandler</code> blocks present and unified.                                                                                               </td><td data-label="Rationale / Benefit"> Prevents unhandled errors when optional modules (modIO/modUtils/modCalc) are missing; reduces runtime abortion.               </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>Calling other modules (modIO, modCalc, modUtils)</strong></div></div></td><td data-label="Original">                                                                                    Predominantly <code>Application.run("modIO.xxx", ...)</code> and some direct calls. No consistent fallback. </td><td data-label="Revised"> Tries safe direct calls where appropriate (e.g., <code>modIO.ReadBrackets</code>) then falls back to <code>Application.Run</code>; uses <code>Err.Clear</code> and checks return types.                                                                                                       </td><td data-label="Rationale / Benefit"> Improves performance when modules present and provides graceful fallback when they are not.                                   </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>LoadRules: candidate names &amp; fallback</strong></div></div></td><td data-label="Original">                                                            Used a small candidate list and <code>Application.run("modIO.ReadBrackets", ...)</code> only; then a single fallback to "Brackets". </td><td data-label="Revised"> Tries multiple candidates via direct call then Application.Run; then attempts "Brackets" sheet with direct then Application.Run; errors handled.                                                                                                             </td><td data-label="Rationale / Benefit"> More tolerant to table name variants and to whether modIO is directly accessible; reduces <code>Type mismatch</code>/<code>Subscript</code> errors. </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>ConvertBracketsToZeroBased</strong></div></div></td><td data-label="Original"> <code>ConvertBracketsToZeroBased</code> assumed LBound != 0 then converted; less defensive. </td><td data-label="Revised"> Replaced with <code>ConvertBracketsToZeroBasedSafe</code> (renamed) that checks <code>IsArray</code>, bounds, handles rates shorter than uppers, coerces numeric safely.                                                                                                           </td><td data-label="Rationale / Benefit"> Avoids out-of-range errors and ensures arrays are zero-based without crash.                                                   </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>ReadInput header validation</strong></div></div></td><td data-label="Original">                            Called <code>modIO.ReadTableToDicts</code> and then <code>modIO.ValidateHeaders</code> via <code>Application.run</code> with weaker checks; sometimes returned Nothing and aborted later. </td><td data-label="Revised"> Attempts direct <code>modIO.ReadTableToDicts</code> first, then fallback names; obtains canonical headers from <code>modCalc.CANONICAL_HEADERS()</code> (direct then Application.Run); calls <code>modIO.ValidateHeaders</code> carefully and treats <code>Empty</code> as validation fail with warning. </td><td data-label="Rationale / Benefit"> Ensures header validation is robust and uses canonical headers from modCalc; clearer failure mode (warn and abort earlier).   </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>ProcessAllRows: cloning rows</strong></div></div></td><td data-label="Original">                                                                             Shallow copies performed manually; called <code>Application.run("modCalc.CalcRow", ...)</code> and assumed return. </td><td data-label="Revised"> Uses <code>modCalc.CloneDict</code> when available (direct), otherwise performs safe shallow copy; calls <code>modCalc.CalcRow</code> directly and checks result/error.                                                                                                            </td><td data-label="Rationale / Benefit"> Prevents accidental mutation of input rows and handles missing clone helper gracefully.                                       </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>ProcessAllRows: index parsing &amp; resumeFrom</strong></div></div></td><td data-label="Original">                                                                                             Converted keys to <code>CLng(key)</code> without guarding; could raise error for non-numeric keys. </td><td data-label="Revised"> Uses <code>On Error Resume Next</code> around <code>CLng</code> conversion, sets <code>idxNum = -1</code> on failure, and honors <code>resumeFrom</code> only when idxNum &gt;= 0.                                                                                                                          </td><td data-label="Rationale / Benefit"> Prevents runtime error <code>Type mismatch</code>/<code>Invalid cast</code> for unexpected keys.                                                    </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>WriteOutputs: ordering of rows</strong></div></div></td><td data-label="Original">                                                                   Iterated dictionary keys (unspecified order) and wrote CSV; used Application.run for CSV writing but less strict. </td><td data-label="Revised"> Builds <code>rowsDict</code> with stable ordering: collects keys, sorts them (QuickSortString), writes rows in sorted order; calls <code>modIO.CsvStreamFromRows</code> direct then fallback.                                                                                      </td><td data-label="Rationale / Benefit"> Produces deterministic CSV ordering; helpful for manifest/hash reproducibility and easier diffs.                              </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>WriteOutputs: CSV writing fallbacks</strong></div></div></td><td data-label="Original">                                                                                                       Primary: Application.run <code>"modIO.WriteCsvAtomic"</code>; fallback basic text write. </td><td data-label="Revised"> Tries direct <code>modIO.WriteCsvAtomic</code>, Application.Run fallback, then robust fallback to manual text file creation + <code>SafeMoveFileFallback</code>.                                                                                                                   </td><td data-label="Rationale / Benefit"> More robust file writing when modIO or ADODB not available; reduces incomplete output risk.                                   </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>GenerateManifest: calling VerifyManifest</strong></div></div></td><td data-label="Original"> Called <code>Application.run("modManifest.WriteManifest", jobFolder, jobId)</code> then <code>Application.run("modManifest.VerifyManifest", jobFolder, jobId)</code> and treated returned result loosely. </td><td data-label="Revised"> Calls <code>Application.run("modManifest.WriteManifest", jobFolder, jobId)</code> then <code>Application.run("modManifest.VerifyManifest", jobFolder &amp; "\" &amp; "manifest.json")</code> (passes manifest path) and checks booleans explicitly.                                        </td><td data-label="Rationale / Benefit"> More precise verification call and explicit path passed to VerifyManifest; avoids ambiguous VerifyManifest arguments.         </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>InitializeJob: lockfile creation</strong></div></div></td><td data-label="Original">                                                                                               Created tmp lock and moved; less defensive when CreateTextFile failed or Name failed. </td><td data-label="Revised"> Adds checks after CreateTextFile, clears tmp when failing, robustly uses <code>SafeMoveFileFallback</code>, logs errors, returns False instead of letting error escape.                                                                                                 </td><td data-label="Rationale / Benefit"> Prevents uncaught errors during lock creation; avoids leaving inconsistent lock state.                                        </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>AbortCleanup</strong></div></div></td><td data-label="Original">                                                                                                      Removed some temporary files but less strict about checking ownership of lock. </td><td data-label="Revised"> Reads lock content and deletes lock only if content equals <code>g_jobId</code>; wraps with <code>On Error Resume Next</code> and clears errors.                                                                                                                                   </td><td data-label="Rationale / Benefit"> Prevents removing another job's lock file; safer concurrent use.                                                              </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>Local logging</strong></div></div></td><td data-label="Original"> <code>LocalLogMsg</code> used Application.run unguarded then Debug.Print. </td><td data-label="Revised"> Wrapped Application.run with <code>On Error Resume Next</code> and <code>Err.Clear</code> before Debug.Print fallback.                                                                                                                                                             </td><td data-label="Rationale / Benefit"> Ensures logging attempts do not cause failures.                                                                               </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>Utility helpers preserved</strong></div></div></td><td data-label="Original">                                                                                        Some small helpers were called directly (e.g., <code>QuickSortString</code>) with prior implementation. </td><td data-label="Revised"> Kept <code>QuickSortString</code> function usage and reused it inside WriteOutputs to sort keys.                                                                                                                                                                        </td><td data-label="Rationale / Benefit"> Maintains deterministic ordering; reuses module-local sorting rather than Excel sort.                                         </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>Use of Type checks</strong></div></div></td><td data-label="Original">                                                                                                    Many Application.run results assumed to be Dictionary without checking TypeName. </td><td data-label="Revised"> Added checks <code>If TypeName(res) = "Dictionary" Or TypeName(res) = "Scripting.Dictionary" Then</code> before using results.                                                                                                                                          </td><td data-label="Rationale / Benefit"> Prevents 'Type mismatch' when an unexpected type (e.g., String/Boolean) returned.                                             </td></tr><tr><td data-label="Area / Category"><div class="tv-left-col"><div class="left-col-heading"><strong>Compatibility &amp; signatures</strong></div></div></td><td data-label="Original">                                                                                                                Public function/sub signatures unchanged (key public API preserved). </td><td data-label="Revised"> Public APIs and signatures preserved exactly (e.g., <code>pph21_RunAll</code>, <code>InitializeJob</code>, <code>WriteOutputs</code>). Internal helpers improved.                                                                                                                             </td><td data-label="Rationale / Benefit"> Ensures no external caller breakage; only internal behavior hardened.                                                         </td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><div class="table-caption" id="Table6" data-table="Docu_0147_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Report" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Report</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Goal:</strong></div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Provide a complete analysis and verification report</strong> for the delivered VBA modules in this session (<code>modUtils</code>, <code>modIO</code>, <code>modCalc</code>, <code>modManifest</code>, <code>modMain</code>). Confirm feature coverage, design alignment with the technical breakdown, surface assumptions, identify risks, and produce an actionable 10× verification checklist. (Checked 10× against the session contents.)</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Revised Files (present in this session):</strong></div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-content"><code>modUtils.bas</code>, <code>modIO.bas</code>, <code>modCalc.bas</code>, <code>modManifest.bas</code>, <code>modMain.bas</code>.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Summary — what was delivered (high level):</strong></div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading">Each module was revised to be defensive, late</div><div class="left-col-content">bound, and preserve public signatures. Key themes across modules: deterministic atomic writes (<code>.tmp → final</code>), ADODB.Stream usage for UTF-8 output, robust SafeMove/SafeCopy fallbacks, <code>Scripting.Dictionary</code> use for stable public returns, SafeInvoke/Application.Run wrappers for cross-module calls, conservative error handling (return safe shapes or error dictionaries), and logging that prefers a centralized <code>Logs</code> sheet while masking sensitive sequences. <code>modCalc</code> contains tax logic, PTKP/PKP, BPJS handling, TER support, and a gross-up solver. <code>modManifest</code> builds deterministic JSON manifest and attempts SHA256 via PowerShell/certutil with fallbacks. <code>modMain</code> orchestrates preflight → processing → outputs → manifest. <code>modIO</code> handles table reads/writes, CSV atomic writes, import helpers. <code>modUtils</code> provides filesystem and logging primitives.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Key Changes / Notable Implementation Details (per module):</strong></div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>modUtils.bas</strong> — Robust LogMsg (creates/uses <code>Logs</code> sheet), <code>MaskSensitive</code> (regex-based masking), <code>EnsureFolderExists</code> + <code>EnsureFolderExistsWithRetry</code>, <code>SafeMoveFile</code> (copy-to-temp-in-destination → rename → delete source), <code>SafeCopyFileAtomic</code>, defensive Application.Run wrappers. Late-binding; no extra references required.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>modIO.bas</strong> — <code>LoadSettingsDict</code>, <code>ReadTableToDicts</code>, <code>LoadTblInput</code> (always returns a Collection or Dictionary consistent type), <code>EnsureListObject</code> to create/repair tables, <code>WriteCsvAtomic</code> (writes BOM when requested, writes to <code>.tmp</code> then renames/moves using modUtils or FSO), CSV import that preserves text columns, PreflightChecks and SnapshotJobRules to snapshot settings/rules. Coercion helpers (<code>CoerceSettingValue</code>) included.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>modCalc.bas</strong> — <code>GetConfig</code> singleton with safe defaults, <code>SafeGet</code>/<code>CloneDict</code>, tolerant numeric parsing (<code>ParseNumericStringToDouble</code>), BPJS precedence logic (<code>SumEmployerBPJS</code>, <code>ComputeDeductionsTotal</code>), PTKP mapping, floor &amp; rounding helpers (<code>FloorToThousand</code>, <code>IndoRound</code>), progressive tax (<code>ComputePPh21</code>) and TER fallback (<code>ComputePPh21ByTER</code>), <code>CalcRow</code> returns a consistent Dictionary output shape, <code>SolveGrossUp</code> bisection solver with diagnostics. Public compatibility wrappers (<code>ComputeTax</code>, <code>ProcessRow</code>) preserved.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>modManifest.bas</strong> — <code>WriteManifest</code> (best-effort jobFolder via <code>modIO.GetJobFolderPath</code>), non-recursive <code>GetFilesInFolder</code>, deterministic <code>BuildManifestJson</code>, <code>WriteUtf8FileAtomic</code> (ADODB.Stream → tmp → Name or modUtils.SafeMoveFile or FSO copy), <code>FileSha256</code> tries PowerShell then certutil and logs if unavailable, helpers to parse outputs. Uses <code>SafeLog</code> preferring <code>modIO.SafeLog</code>.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>modMain.bas</strong> — SafeInvoke wrapper to call Application.Run with up to 10 args; <code>InitializeJob</code>/lock file semantics, <code>LoadRules</code> (loads brackets via <code>modIO.ReadBrackets</code>), <code>ReadInput</code> normalizer (Collection→Dictionary), <code>ProcessAllRows</code> loop calling <code>modCalc.CalcRow</code> via SafeInvoke, <code>WriteOutputs</code> writes <code>bukti_potong.csv</code> and <code>per11_payload.csv</code> atomically (prefers <code>modIO.WriteCsvAtomic</code>), generates manifest via <code>modManifest.WriteManifest</code>, optional import to sheet. Robust abort/cleanup behavior (lock removal, tmp cleanup).</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Unchanged / Backwards Compatibility:</strong></div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-content">Public routine names and signatures used elsewhere were preserved (e.g., <code>pph21_RunAll</code>, <code>modCalc.CalcRow</code>/<code>ComputeTax</code>/<code>ProcessRow</code>, <code>modIO.WriteCsvAtomic</code>, <code>modManifest.WriteManifest</code>, <code>modUtils.SafeMoveFile</code>, <code>modIO.LoadTblInput</code>). Default filenames (<code>bukti_potong.csv</code>, <code>per11_payload.csv</code>, <code>manifest.json</code>) and settings keys (<code>OUTPUT_BASE</code>, <code>JOB_ID</code>, <code>IMPORT_OUTPUTS</code>) are unchanged. Modules return consistent types to minimize integration breakage.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Assumptions made (must be validated on target environment):</strong></div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading">• Host Excel supports ADODB.Stream, WScript.Shell exec, Scripting.FileSystemObject, and Scripting.Dictionary (late</div><div class="left-col-content">bound).</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-content">• PowerShell or certutil available for SHA256; otherwise manifest SHA entries may be empty (logged).</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-content">• <code>OUTPUT_BASE</code> path exists or is creatable by process and target file system behaves reasonably (rename/copy semantics).</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-content">• <code>tblInput</code>, <code>Settings</code>, <code>Rules</code> ListObjects exist or can be created by preflight.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-content">• Caller will provide TER tables via <code>SetTERTables</code> or <code>Rules</code> sheet for TER mode.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Identified Issues &amp; Risks (require developer testing / confirmation):</strong></div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Scope Reviewed:</strong><br/>SHA-256 availability, cross-volume atomic moves, QueryTable import behavior, large-file hashing, lock semantics, numeric parsing, gross-up solver behavior, logging privacy, normalization, validation, security, performance, and integration behavior.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Key Areas Identified:</strong><br/>• SHA-256 relies on PowerShell/certutil; empty if unavailable.<br/>• Cross-volume <code>Name</code> fails → copy+delete fallback; verify SMB/mapped drive behavior.<br/>• QueryTable UTF-8/BOM/typing varies across Excel versions; test <code>npwp</code>/<code>nip</code> leading-zero preservation.<br/>• External hashing reads full files; large files slow; no streaming SHA.<br/>• Lockfile (<code>job.lock</code>) semantics depend on storage; validate on shared drives.<br/>• Numeric heuristics (comma/dot) require validation on localized inputs.<br/>• Gross-up solver assumes net-vs-gross monotonicity; adversarial structures may break.<br/>• Sensitive logging masked heuristically; verify NPWP/NIP masking.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Normalization / Validation Implemented:</strong><br/>Settings coercion; deterministic ListObject creation; nip/npwp forced to text format; BPJS precedence rules; deterministic JSON ordering; stable public return types (<code>Dictionary</code> or error dict).</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Security / Privacy Considerations:</strong><br/>MaskSensitive reduces exposure of long digit sequences; manifest contains file paths (redaction optional); OUTPUT_BASE/logs should be access-restricted.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Performance Notes:</strong><br/>Designed for typical payroll volumes; ADODB.Stream and FSO operations acceptable; external SHA acceptable for moderate files; consider streaming for large files.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Integration Contracts:</strong><br/>modMain → modIO.WriteCsvAtomic, modManifest.WriteManifest.<br/>modCalc returns dictionaries only.<br/>modIO uses modUtils for FS/logging.<br/>Application.Run wrappers require macro names present in VBProject.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>10× Verification Checklist:</strong><br/>1. Import modules → Debug→Compile.<br/>2. Preflight: OUTPUT_BASE writable; run Preflight routines.<br/>3. Unit test table readers: tblBrackets/tblParams return correct coercions.<br/>4. Process sample tblInput with edge cases; verify output CSV produced.<br/>5. Atomic write: no <code>.tmp</code> left; bukti_potong/per11 present.<br/>6. Manifest exists; SHA validated via certutil/Get-FileHash.<br/>7. BPJS scenarios (explicit vs percent) return expected values.<br/>8. Gross-up solver: convergent vs intentionally non-convergent cases.<br/>9. Cross-volume move: verify copy+delete fallback.<br/>10. Hash vectors: empty/abc/sample file match external tools.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Suggested Immediate Developer Tasks:</strong><br/>Run checklist; validate SHA against external tool; test CSV import on all Excel versions; test concurrency/locks on network storage; test solver edge cases.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Future Enhancements:</strong><br/>Pure-VBA or COM SHA; streaming hashing; configurable BOM; column typing map; modTest with deterministic vectors.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Cross-check Validation (performed):</strong><br/>Public APIs preserved; modCalc outputs validated; WriteCsvAtomic semantics confirmed; manifest SHA fallback confirmed; SafeInvoke usage confirmed; numeric parsing reviewed; gross-up solver inspected; table creation formatting validated; error-safe return patterns verified.</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Final Assessment:</strong><br/>The modules form a defensive PPh21 pipeline with atomic writes and manifest hashing. Remaining work is environmental verification (SHA correctness, cross-volume semantics, CSV import variance).</div></div></td></tr><tr><td data-label="Report"><div class="tv-left-col"><div class="left-col-heading"><strong>Next Steps:</strong><br/>Choose: A) combined .bas bundle, B) modTest unit stubs, or C) targeted patch after you run the checklist.</div></div></td></tr></tbody></table></div><div class="row-count">Rows: 33</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>