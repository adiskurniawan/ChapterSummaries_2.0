<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761273443">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8042_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown"> <strong>Summary / Purpose</strong><br><br><code>html_renderer.py</code> provides the top-level rendering orchestration for the PasteToTable (PTT) system. It takes processed table data (2-column ChatGPT-style tables) and produces complete standalone HTML pages ready to be viewed in browsers or embedded within other pages. The module harmonizes HTML generation, asset linking, inline fallback logic, and safe file output, while delegating low-level operations (I/O, sanitization, asset preparation) to <code>render.core_*</code> submodules.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Technical Breakdown"> <strong>High-level guarantees</strong><br><br>• Deterministic, single-pass HTML generation.<br>• Never writes invalid or partial HTML.<br>• Produces portable pages referencing correct assets or self-contained inline fallbacks.<br>• Always succeeds with graceful degradation (inline fallback mode) when external assets missing.<br>• Atomic write of generated HTML to prevent corruption.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Technical Breakdown"> <strong>Top-level flow overview</strong><br><br>1. Receive input text or structured 2-column data.<br>2. Convert raw text to structured HTML fragments.<br>3. Sanitize and normalize markup.<br>4. Wrap fragments in a standard HTML document scaffold.<br>5. Resolve CSS/JS references (inline or external).<br>6. Write final <code>.html</code> file atomically.<br>7. Return metadata (output path, size, inline/external mode).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown"> <strong>Primary entrypoint: <code>render_html_table(input_text, cfg, out_path=None)</code></strong><br><br><strong>Purpose:</strong> Convert arbitrary pasted text into a fully formatted 2-column HTML table and wrap it in the standard PTT HTML layout.<br><strong>Key steps:</strong><br>• Use <code>render.core_table.render_table</code> to convert parsed input into <code>&lt;table&gt;</code> markup.<br>• Use <code>render.core_renderer.compose_html_document</code> to build a full HTML document with metadata, linked or inline CSS/JS, and proper escaping.<br>• Call <code>prepare_assets</code> from <code>core_assets</code> to ensure asset directories exist and determine how links should be written.<br>• Choose between inline or linked asset strategy depending on <code>cfg.embed_assets_inline</code>.<br>• Write final HTML atomically using <code>core_io._atomic_write</code>.<br><strong>Return:</strong> <code>(html_output_path, render_summary_dict)</code>.                                                                                                                                                             </td></tr><tr><td data-label="Technical Breakdown"> <strong>Integration points</strong><br><br>• <code>render.core_table</code> — transforms parsed Markdown/text to table HTML.<br>• <code>render.core_renderer</code> — wraps fragments into final HTML document (head, body, meta, inline fallbacks).<br>• <code>render.core_assets</code> — handles asset copying, linking, fingerprinting, and SRI integrity.<br>• <code>render.core_io</code> — atomic write logic and directory preparation.<br>• <code>render.sanitize</code> — cleans HTML fragments for safety and correct typography.<br><strong>Guarantee:</strong> All integration points are soft-imported; fallback safe stubs used when missing (ensuring the renderer never crashes).                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Technical Breakdown"> <strong>Atomic writing strategy</strong><br><br>All final HTML output uses <code>_atomic_write</code> (from <code>core_io</code> when present, else fallback local implementation). Steps:<br>1. Write to same-directory temporary file.<br>2. Flush and fsync.<br>3. Replace target atomically.<br>Ensures that no partial HTML file ever appears on disk. On error, fallback cleanup deletes temp file.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Technical Breakdown"> <strong>Inline fallback handling</strong><br><br>If <code>assets/</code> folder or CSS/JS files are missing, <code>html_renderer</code> automatically embeds internal fallback strings <code>_EMBED_STYLE</code> and <code>_EMBED_SCRIPT</code> from <code>core_assets</code> or minimal built-in style/script. This ensures every generated HTML file remains functional and visually coherent even without networked or local assets.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Technical Breakdown"> <strong>HTML structure generation</strong><br><br><code>compose_html_document(title, body_html, css_ref, js_ref, inline_fallbacks)</code> produces a W3C-valid minimal document structure:<br>• <code>&lt;head&gt;</code> includes charset, meta viewport, title, favicon (if found), and CSS <code>&lt;link&gt;</code> or inline <code>&lt;style&gt;</code>.<br>• <code>&lt;body&gt;</code> wraps rendered table with a top navigation header (optional) and injected <code>&lt;script&gt;</code> tag or inline fallback.<br>• When <code>cfg.include_footer</code> is true, appends a footer block with generation timestamp or project signature.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown"> <strong>Safety and sanitization</strong><br><br>Before composing the document, table HTML is passed through <code>render.sanitize.clean_html_fragment</code> to remove unsafe tags, normalize whitespace, and ensure semantic <code>&lt;tr&gt;&lt;td&gt;</code> integrity. This prevents injection and layout corruption.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Technical Breakdown"> <strong>Configurable behaviors (<code>cfg</code> knobs)</strong><br><br>• <code>cfg.embed_assets_inline</code>: Boolean; if true, CSS/JS is embedded inline.<br>• <code>cfg.out_dir</code>: Directory to save rendered HTML and <code>assets/</code>.<br>• <code>cfg.table_style</code>: Can be <code>&#x27;chatgpt&#x27;</code>, <code>&#x27;minimal&#x27;</code>, or <code>&#x27;classic&#x27;</code> (applied as a body class).<br>• <code>cfg.page_title</code>: Custom document title.<br>• <code>cfg.force_assets_refresh</code>: Forces regeneration of assets.<br>• <code>cfg.auto_open</code>: If true, opens result in browser after writing.<br>• <code>cfg.timestamp_footer</code>: Whether to include generated timestamp footer.                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Technical Breakdown"> <strong>Layout conventions</strong><br><br>• Uses consistent <code>div.table-container</code> wrapping for predictable CSS grid behavior.<br>• Each table cell uses class names (<code>.col-left</code>, <code>.col-right</code>) for uniform styling.<br>• Mobile responsiveness achieved via CSS grid/flex layout (from <code>style.css</code> or inline fallback).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown"> <strong>Renderer utilities</strong><br><br>• <code>_resolve_asset_refs(cfg, out_dir)</code> — determines actual URLs or inline payloads for <code>style.css</code> and <code>script.js</code>.<br>• <code>_safe_inline_asset(name, embed_content)</code> — injects embedded fallback safely within <code>&lt;style&gt;</code>/<code>&lt;script&gt;</code> tags.<br>• <code>_safe_link_tag(name, assets_dir)</code> — constructs <code>&lt;link&gt;</code>/<code>&lt;script&gt;</code> tags referencing hashed files (uses <code>resolve_asset_name</code>).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Error handling & recovery</strong><br><br>• Missing assets → inline fallback injection.<br>• Atomic write failure → logged; temp file cleaned.<br>• Bad HTML fragments → auto-sanitized instead of raising.<br>• Unavailable project integrations → silent fallback to safe defaults.<br>• If everything fails, a minimal standalone HTML (inline-only mode) is still produced to prevent total failure.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Technical Breakdown"> <strong>Logging and diagnostics</strong><br><br>• Each render call logs summary: input size, HTML size, elapsed time, mode (inline/external).<br>• On debug level: includes resolved asset paths, chosen renderer backend, and sanitization warnings.<br>• Optionally writes a <code>.json</code> summary next to HTML output (<code>table-info.json</code>) when <code>cfg.debug_output</code> is enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Technical Breakdown"> <strong>Performance considerations</strong><br><br>• Rendering is I/O-bound — most CPU spent on sanitization and SRI hashing.<br>• Inline mode skips file lookups and is faster for small tables.<br>• External asset mode is preferred for batch exports to reduce duplication.<br>• Uses streaming write to avoid large memory spikes when handling long tables.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Technical Breakdown"> <strong>Security & safety notes</strong><br><br>• Inline scripts/styles are trusted internal payloads only — user input never injected unsanitized.<br>• Disables <code>&lt;script&gt;</code> execution from user-pasted text.<br>• Prevents accidental overwrite of existing HTML files unless <code>force_overwrite</code> set.<br>• Paths resolved via <code>core_io.safe_join</code> when available to avoid directory traversal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Technical Breakdown"> <strong>Return values and structure</strong><br><br><code>render_html_table</code> returns a tuple <code>(output_path: str, result: dict)</code> where <code>result</code> includes:<br>• <code>&quot;mode&quot;</code> — <code>&quot;inline&quot;</code> or <code>&quot;external&quot;</code><br>• <code>&quot;size&quot;</code> — final HTML file size<br>• <code>&quot;assets_ok&quot;</code> — whether asset preparation succeeded<br>• <code>&quot;timestamp&quot;</code> — UTC ISO string<br>• <code>&quot;output_dir&quot;</code> — resolved output directory path                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Developer API functions</strong><br><br>• <code>render_html_from_file(in_file, cfg)</code> — loads a text file, delegates to <code>render_html_table</code>, writes to sibling <code>.html</code>.<br>• <code>render_html_from_clipboard(cfg)</code> — clipboard integration stub, uses same rendering logic.<br>• <code>get_inline_fallbacks()</code> — returns embedded CSS/JS fallback strings for embedding by external systems.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Optional interactive helpers</strong><br><br>• <code>_preview_in_browser(path)</code> — uses <code>webbrowser.open</code> (only if safe to call).<br>• <code>_demo_run()</code> — self-contained test harness; creates temp directory, generates one table, prints diagnostics, and optionally previews it. Safe for CI usage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Behavioral guarantees</strong><br><br>• Always produces readable HTML regardless of input validity.<br>• Never leaves zero-byte or half-written HTML files.<br>• Sanitizes and closes all open tags.<br>• All asset references (inline or external) are resolvable.<br>• Safe concurrent invocation — temp file names unique per PID + timestamp.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown"> <strong>Failure modes & resilience</strong><br><br>• Asset discovery fails → inline mode fallback.<br>• Atomic write fails → logs warning, returns <code>None</code>.<br>• Missing config attributes → defaults from internal constants.<br>• Bad encoding → writes UTF-8 replacement characters.<br>• Exception anywhere in render pipeline → returns minimal error HTML instead of raising.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Technical Breakdown"> <strong>Minimal test cases</strong><br><br>1. Empty input → still produces valid minimal HTML.<br>2. Input with long text columns → correct wrapping + no overflow.<br>3. Inline vs external mode produce equivalent visual results.<br>4. Missing assets folder → inline fallback used.<br>5. Force refresh → regenerates assets correctly.<br>6. HTML validates under W3C validator (no open tags).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Reviewer checklist (pre-merge)</strong><br><br>1. Confirm atomic write path correctness.<br>2. Ensure inline fallback content matches <code>assets/style.css</code> and <code>script.js</code> structure.<br>3. Validate sanitization doesn’t strip intended markup.<br>4. Confirm <code>cfg</code> knobs documented and have defaults.<br>5. Run <code>_demo_run()</code> locally to verify real output in browser.<br>6. Check all imports are lazy and fallback-safe (no crashes when missing).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Technical Breakdown"> <strong>Short summary / decision points</strong><br><br><code>html_renderer.py</code> is the top orchestration layer connecting table rendering, asset preparation, and safe HTML output. It’s production-grade, non-destructive, fully deterministic, and resilient against missing dependencies. It ensures PasteToTable always generates complete, styled, secure HTML pages regardless of environment or asset availability — ready for both local and automated use cases.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Technical Breakdown"> <strong>Related files to review if renderer fails</strong><br><br>If <code>html_renderer.py</code> encounters structural, runtime, or asset resolution errors, the following project files are most relevant for debugging or coordinated revision:<br>• <code>render/core_renderer.py</code> — HTML document composition backend.<br>• <code>render/core_table.py</code> — table generation engine; source of <code>&lt;table&gt;</code> markup.<br>• <code>render/core_assets.py</code> — asset preparation, fallback, and SRI logic.<br>• <code>render/core_io.py</code> — atomic write, directory creation, and safe I/O.<br>• <code>render/sanitize.py</code> — fragment cleaning and input normalization.<br>• <code>utils.py</code> — configuration defaults, global logging setup, and CLI argument parsing.<br>• <code>main.py</code> — high-level entrypoint invoking <code>html_renderer.render_html_table</code>.<br>• <code>templates/index.html</code> — template consistency baseline.<br>• <code>assets/style.css</code> & <code>assets/script.js</code> — canonical layout/style content used for comparison during inline fallback validation. </td></tr></tbody></table></div><div class="row-count">Rows: 25</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>