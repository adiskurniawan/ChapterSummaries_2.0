<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761634547">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li>
<li class="toc-item"><a class="toc-link" href="#Table10">Table 10</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8042_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown"> <strong>Summary / Purpose</strong><br><br><code>html_renderer.py</code> provides the top-level rendering orchestration for the PasteToTable (PTT) system. It takes processed table data (2-column ChatGPT-style tables) and produces complete standalone HTML pages ready to be viewed in browsers or embedded within other pages. The module harmonizes HTML generation, asset linking, inline fallback logic, and safe file output, while delegating low-level operations (I/O, sanitization, asset preparation) to <code>render.core_*</code> submodules.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Technical Breakdown"> <strong>High-level guarantees</strong><br><br>• Deterministic, single-pass HTML generation.<br>• Never writes invalid or partial HTML.<br>• Produces portable pages referencing correct assets or self-contained inline fallbacks.<br>• Always succeeds with graceful degradation (inline fallback mode) when external assets missing.<br>• Atomic write of generated HTML to prevent corruption.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Technical Breakdown"> <strong>Top-level flow overview</strong><br><br>1. Receive input text or structured 2-column data.<br>2. Convert raw text to structured HTML fragments.<br>3. Sanitize and normalize markup.<br>4. Wrap fragments in a standard HTML document scaffold.<br>5. Resolve CSS/JS references (inline or external).<br>6. Write final <code>.html</code> file atomically.<br>7. Return metadata (output path, size, inline/external mode).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown"> <strong>Primary entrypoint: <code>render_html_table(input_text, cfg, out_path=None)</code></strong><br><br><strong>Purpose:</strong> Convert arbitrary pasted text into a fully formatted 2-column HTML table and wrap it in the standard PTT HTML layout.<br><strong>Key steps:</strong><br>• Use <code>render.core_table.render_table</code> to convert parsed input into <code>&lt;table&gt;</code> markup.<br>• Use <code>render.core_renderer.compose_html_document</code> to build a full HTML document with metadata, linked or inline CSS/JS, and proper escaping.<br>• Call <code>prepare_assets</code> from <code>core_assets</code> to ensure asset directories exist and determine how links should be written.<br>• Choose between inline or linked asset strategy depending on <code>cfg.embed_assets_inline</code>.<br>• Write final HTML atomically using <code>core_io._atomic_write</code>.<br><strong>Return:</strong> <code>(html_output_path, render_summary_dict)</code>.                                                                                                                                                             </td></tr><tr><td data-label="Technical Breakdown"> <strong>Integration points</strong><br><br>• <code>render.core_table</code> — transforms parsed Markdown/text to table HTML.<br>• <code>render.core_renderer</code> — wraps fragments into final HTML document (head, body, meta, inline fallbacks).<br>• <code>render.core_assets</code> — handles asset copying, linking, fingerprinting, and SRI integrity.<br>• <code>render.core_io</code> — atomic write logic and directory preparation.<br>• <code>render.sanitize</code> — cleans HTML fragments for safety and correct typography.<br><strong>Guarantee:</strong> All integration points are soft-imported; fallback safe stubs used when missing (ensuring the renderer never crashes).                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Technical Breakdown"> <strong>Atomic writing strategy</strong><br><br>All final HTML output uses <code>_atomic_write</code> (from <code>core_io</code> when present, else fallback local implementation). Steps:<br>1. Write to same-directory temporary file.<br>2. Flush and fsync.<br>3. Replace target atomically.<br>Ensures that no partial HTML file ever appears on disk. On error, fallback cleanup deletes temp file.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Technical Breakdown"> <strong>Inline fallback handling</strong><br><br>If <code>assets/</code> folder or CSS/JS files are missing, <code>html_renderer</code> automatically embeds internal fallback strings <code>_EMBED_STYLE</code> and <code>_EMBED_SCRIPT</code> from <code>core_assets</code> or minimal built-in style/script. This ensures every generated HTML file remains functional and visually coherent even without networked or local assets.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Technical Breakdown"> <strong>HTML structure generation</strong><br><br><code>compose_html_document(title, body_html, css_ref, js_ref, inline_fallbacks)</code> produces a W3C-valid minimal document structure:<br>• <code>&lt;head&gt;</code> includes charset, meta viewport, title, favicon (if found), and CSS <code>&lt;link&gt;</code> or inline <code>&lt;style&gt;</code>.<br>• <code>&lt;body&gt;</code> wraps rendered table with a top navigation header (optional) and injected <code>&lt;script&gt;</code> tag or inline fallback.<br>• When <code>cfg.include_footer</code> is true, appends a footer block with generation timestamp or project signature.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown"> <strong>Safety and sanitization</strong><br><br>Before composing the document, table HTML is passed through <code>render.sanitize.clean_html_fragment</code> to remove unsafe tags, normalize whitespace, and ensure semantic <code>&lt;tr&gt;&lt;td&gt;</code> integrity. This prevents injection and layout corruption.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Technical Breakdown"> <strong>Configurable behaviors (<code>cfg</code> knobs)</strong><br><br>• <code>cfg.embed_assets_inline</code>: Boolean; if true, CSS/JS is embedded inline.<br>• <code>cfg.out_dir</code>: Directory to save rendered HTML and <code>assets/</code>.<br>• <code>cfg.table_style</code>: Can be <code>&#x27;chatgpt&#x27;</code>, <code>&#x27;minimal&#x27;</code>, or <code>&#x27;classic&#x27;</code> (applied as a body class).<br>• <code>cfg.page_title</code>: Custom document title.<br>• <code>cfg.force_assets_refresh</code>: Forces regeneration of assets.<br>• <code>cfg.auto_open</code>: If true, opens result in browser after writing.<br>• <code>cfg.timestamp_footer</code>: Whether to include generated timestamp footer.                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Technical Breakdown"> <strong>Layout conventions</strong><br><br>• Uses consistent <code>div.table-container</code> wrapping for predictable CSS grid behavior.<br>• Each table cell uses class names (<code>.col-left</code>, <code>.col-right</code>) for uniform styling.<br>• Mobile responsiveness achieved via CSS grid/flex layout (from <code>style.css</code> or inline fallback).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown"> <strong>Renderer utilities</strong><br><br>• <code>_resolve_asset_refs(cfg, out_dir)</code> — determines actual URLs or inline payloads for <code>style.css</code> and <code>script.js</code>.<br>• <code>_safe_inline_asset(name, embed_content)</code> — injects embedded fallback safely within <code>&lt;style&gt;</code>/<code>&lt;script&gt;</code> tags.<br>• <code>_safe_link_tag(name, assets_dir)</code> — constructs <code>&lt;link&gt;</code>/<code>&lt;script&gt;</code> tags referencing hashed files (uses <code>resolve_asset_name</code>).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Error handling & recovery</strong><br><br>• Missing assets → inline fallback injection.<br>• Atomic write failure → logged; temp file cleaned.<br>• Bad HTML fragments → auto-sanitized instead of raising.<br>• Unavailable project integrations → silent fallback to safe defaults.<br>• If everything fails, a minimal standalone HTML (inline-only mode) is still produced to prevent total failure.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Technical Breakdown"> <strong>Logging and diagnostics</strong><br><br>• Each render call logs summary: input size, HTML size, elapsed time, mode (inline/external).<br>• On debug level: includes resolved asset paths, chosen renderer backend, and sanitization warnings.<br>• Optionally writes a <code>.json</code> summary next to HTML output (<code>table-info.json</code>) when <code>cfg.debug_output</code> is enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Technical Breakdown"> <strong>Performance considerations</strong><br><br>• Rendering is I/O-bound — most CPU spent on sanitization and SRI hashing.<br>• Inline mode skips file lookups and is faster for small tables.<br>• External asset mode is preferred for batch exports to reduce duplication.<br>• Uses streaming write to avoid large memory spikes when handling long tables.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Technical Breakdown"> <strong>Security & safety notes</strong><br><br>• Inline scripts/styles are trusted internal payloads only — user input never injected unsanitized.<br>• Disables <code>&lt;script&gt;</code> execution from user-pasted text.<br>• Prevents accidental overwrite of existing HTML files unless <code>force_overwrite</code> set.<br>• Paths resolved via <code>core_io.safe_join</code> when available to avoid directory traversal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Technical Breakdown"> <strong>Return values and structure</strong><br><br><code>render_html_table</code> returns a tuple <code>(output_path: str, result: dict)</code> where <code>result</code> includes:<br>• <code>&quot;mode&quot;</code> — <code>&quot;inline&quot;</code> or <code>&quot;external&quot;</code><br>• <code>&quot;size&quot;</code> — final HTML file size<br>• <code>&quot;assets_ok&quot;</code> — whether asset preparation succeeded<br>• <code>&quot;timestamp&quot;</code> — UTC ISO string<br>• <code>&quot;output_dir&quot;</code> — resolved output directory path                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Developer API functions</strong><br><br>• <code>render_html_from_file(in_file, cfg)</code> — loads a text file, delegates to <code>render_html_table</code>, writes to sibling <code>.html</code>.<br>• <code>render_html_from_clipboard(cfg)</code> — clipboard integration stub, uses same rendering logic.<br>• <code>get_inline_fallbacks()</code> — returns embedded CSS/JS fallback strings for embedding by external systems.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Optional interactive helpers</strong><br><br>• <code>_preview_in_browser(path)</code> — uses <code>webbrowser.open</code> (only if safe to call).<br>• <code>_demo_run()</code> — self-contained test harness; creates temp directory, generates one table, prints diagnostics, and optionally previews it. Safe for CI usage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Behavioral guarantees</strong><br><br>• Always produces readable HTML regardless of input validity.<br>• Never leaves zero-byte or half-written HTML files.<br>• Sanitizes and closes all open tags.<br>• All asset references (inline or external) are resolvable.<br>• Safe concurrent invocation — temp file names unique per PID + timestamp.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown"> <strong>Failure modes & resilience</strong><br><br>• Asset discovery fails → inline mode fallback.<br>• Atomic write fails → logs warning, returns <code>None</code>.<br>• Missing config attributes → defaults from internal constants.<br>• Bad encoding → writes UTF-8 replacement characters.<br>• Exception anywhere in render pipeline → returns minimal error HTML instead of raising.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Technical Breakdown"> <strong>Minimal test cases</strong><br><br>1. Empty input → still produces valid minimal HTML.<br>2. Input with long text columns → correct wrapping + no overflow.<br>3. Inline vs external mode produce equivalent visual results.<br>4. Missing assets folder → inline fallback used.<br>5. Force refresh → regenerates assets correctly.<br>6. HTML validates under W3C validator (no open tags).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Technical Breakdown"> <strong>Reviewer checklist (pre-merge)</strong><br><br>1. Confirm atomic write path correctness.<br>2. Ensure inline fallback content matches <code>assets/style.css</code> and <code>script.js</code> structure.<br>3. Validate sanitization doesn’t strip intended markup.<br>4. Confirm <code>cfg</code> knobs documented and have defaults.<br>5. Run <code>_demo_run()</code> locally to verify real output in browser.<br>6. Check all imports are lazy and fallback-safe (no crashes when missing).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Technical Breakdown"> <strong>Short summary / decision points</strong><br><br><code>html_renderer.py</code> is the top orchestration layer connecting table rendering, asset preparation, and safe HTML output. It’s production-grade, non-destructive, fully deterministic, and resilient against missing dependencies. It ensures PasteToTable always generates complete, styled, secure HTML pages regardless of environment or asset availability — ready for both local and automated use cases.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Technical Breakdown"> <strong>Related files to review if renderer fails</strong><br><br>If <code>html_renderer.py</code> encounters structural, runtime, or asset resolution errors, the following project files are most relevant for debugging or coordinated revision:<br>• <code>render/core_renderer.py</code> — HTML document composition backend.<br>• <code>render/core_table.py</code> — table generation engine; source of <code>&lt;table&gt;</code> markup.<br>• <code>render/core_assets.py</code> — asset preparation, fallback, and SRI logic.<br>• <code>render/core_io.py</code> — atomic write, directory creation, and safe I/O.<br>• <code>render/sanitize.py</code> — fragment cleaning and input normalization.<br>• <code>utils.py</code> — configuration defaults, global logging setup, and CLI argument parsing.<br>• <code>main.py</code> — high-level entrypoint invoking <code>html_renderer.render_html_table</code>.<br>• <code>templates/index.html</code> — template consistency baseline.<br>• <code>assets/style.css</code> & <code>assets/script.js</code> — canonical layout/style content used for comparison during inline fallback validation. </td></tr></tbody></table></div><div class="row-count">Rows: 25</div></div><div class="table-caption" id="Table2" data-table="Book_8042_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Summary"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Summary</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>Purpose & high-level flow:</strong>  <br>PTT (<code>main.py</code>) is designed as a unified entry point that supports both <strong>web</strong> and <strong>batch</strong> execution modes. In web mode, it initializes Flask via <code>create_app</code>, allowing users to interactively paste or upload tables. In batch mode, it uses environment variables (e.g., <code>P2T_BATCH</code>) or command-line arguments (<code>--batch</code>) to trigger direct file parsing and rendering without the server. Its logic is defensive: it tries multiple fallbacks, supports flexible renderers, and logs detailed tracebacks.  <br>TV (<code>main.py</code> from Table Viewer v2.1), by contrast, is a <strong>single-purpose batch runner</strong>. It explicitly expects local markdown or CSV sources in given folders, parses them into structured tables, and directly calls the renderer using a fixed signature. This simplicity eliminates ambiguity around runtime mode and callable resolution.  <br><strong>Expert view:</strong> PTT’s flexibility makes it robust for deployment across environments but increases complexity—many fallback branches, dynamic imports, and signature checks. TV’s approach, while limited, isolates problems faster. For debugging rendering inconsistencies (like numbered list indentation), start with TV since it represents the “known-good baseline.”                                           </td></tr><tr><td data-label="Summary"> <strong>Renderer loading behavior:</strong>  <br>PTT defines <code>_load_renderer_callable()</code>, which attempts to import <code>html_renderer.py</code> dynamically under the alias <code>html_renderer_local</code>. If that fails, it falls back to a standard <code>import html_renderer</code>. The returned callable can have varying signatures—<code>(tables)</code>, <code>(tables, output_html)</code>, or <code>(tables, output_html, markdown_to_html)</code>—and PTT’s <code>_call_renderer</code> then flexibly adapts. This makes it possible to use legacy renderers but introduces risk when the callable signature changes.  <br>TV defines <code>_load_renderer()</code> which loads <code>html_renderer.py</code> directly (same directory) or from an installed package, then <strong>explicitly</strong> calls <code>render_html(all_tables, output_html, markdown_to_html)</code>. This guarantees that the markdown formatter used for inline conversions is always passed to the renderer.  <br><strong>Expert analysis:</strong> PTT’s abstraction may inadvertently invoke <code>render_html</code> without the markdown formatter, causing the renderer’s internal fallback logic to kick in—potentially producing <code>&lt;br&gt;</code> or spacing differences. TV’s explicit call ensures the external <code>markdown_to_html</code> is always respected. <strong>Action:</strong> Prefer the TV-style explicit call where possible, or ensure <code>_call_renderer</code> explicitly detects and prioritizes the 3-argument form. </td></tr><tr><td data-label="Summary"> <strong>CSV reading (<code>_safe_read_csv</code>):</strong> Both systems use robust, layered CSV loading functions. They attempt <code>pd.read_csv(..., on_bad_lines=&#x27;skip&#x27;)</code> for pandas ≥1.3.0, then fallback to legacy parameters if needed. They also handle UTF-8 and line-ending edge cases. Behaviorally identical and not related to the list-indent issue.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Summary"> <strong>Markdown-to-HTML inline formatter:</strong>  <br>PTT: defines <code>markdown_to_html(text)</code> that transforms simple markdown inline features (code spans, bold/italic, underscores) into HTML. It stashes inline code sections temporarily, escapes HTML, and restores them. It avoids automatic <code>&lt;br&gt;</code> insertion and ensures <code>code</code> elements remain untouched. However, it lacks a <code>pd.isna(text)</code> guard.  <br>TV: almost identical implementation but includes <code>if pd.isna(text): return &#x27;&#x27;</code> at the start—preventing errors when encountering NaN values from pandas DataFrames.  <br><strong>Expert note:</strong> Although functionally equivalent for strings, TV’s version is safer in edge cases. PTT’s omission won’t break indentation but could cause subtle errors if blank or NaN cells appear. <strong>Recommendation:</strong> merge TV’s <code>pd.isna</code> guard into PTT’s function.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr></tbody></table></div><div class="row-count">Rows: 4</div></div><div class="table-caption" id="Table3" data-table="Book_8042_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic / Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic / Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Expert Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Expert Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>App creation (<code>create_app</code>)</strong> sets sane defaults and wraps Flask safely with optional CORS + rate-limiter. </td><td data-label="Expert Notes"> Correct, portable, no side effects. This part is solid and not relevant to list rendering.                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong><code>_render_text_with_fallbacks()</code></strong> dynamically imports and calls whatever <code>render_from_text</code> is available.  </td><td data-label="Expert Notes"> This is the <em>key bridge</em>: it hands raw pasted text to <code>html_renderer</code>. If that downstream renderer changes list-markup rules, <code>server.py</code> will just pass the output through. </td></tr><tr><td data-label="Logic / Structure"> <strong><code>/convert</code> endpoint</strong> returns JSON with <code>&quot;html&quot;</code> fragment.                                                 </td><td data-label="Expert Notes"> Works properly. It neither re-formats <code>&lt;ol&gt;/&lt;li&gt;</code> nor applies any CSS—it’s not responsible for indentation or numbering.                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>All footnote and content-length filters</strong> are defensive only; they don’t touch list markup.                </td><td data-label="Expert Notes"> ✅ Safe, no interference with ordered lists.                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong><code>/save</code> and <code>/get_saved</code></strong> atomic write and retrieval logic.                                               </td><td data-label="Expert Notes"> ✅ Stable and isolated from rendering.                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Security headers in <code>after_request</code>.</strong>                                                                     </td><td data-label="Expert Notes"> ✅ Fine; unrelated to display logic.                                                                                                                                          </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table4" data-table="Book_8042_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Subsystem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Subsystem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Planned Change"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Planned Change</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Target File(s)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Target File(s)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Risk"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Risk</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Subsystem"> 1. Input Parsing              </td><td data-label="Planned Change"> Add <code>_coalesce_multiline_rows(df)</code> to merge single non-empty cell rows into previous row’s cell. Call after CSV ingestion. </td><td data-label="Target File(s)"> <code>main.py</code>                                                          </td><td data-label="Risk"> Possible over-merge of legitimate single-column rows. Add strict guard.   </td></tr><tr><td data-label="Subsystem"> 2. Escaping Order             </td><td data-label="Planned Change"> Move escaping after newline and list detection to preserve Markdown-style lists.                                           </td><td data-label="Target File(s)"> <code>html_renderer.py</code>                                                 </td><td data-label="Risk"> Escaping too late may allow unsafe HTML; keep sanitizer after conversion. </td></tr><tr><td data-label="Subsystem"> 3. Newline Normalization      </td><td data-label="Planned Change"> Normalize <code>\r\n</code> and <code>\r</code> to <code>\n</code> before parsing.                                                                          </td><td data-label="Target File(s)"> <code>main.py</code>                                                          </td><td data-label="Risk"> Minimal risk.                                                             </td></tr><tr><td data-label="Subsystem"> 4. HTML Conversion Path       </td><td data-label="Planned Change"> Detect numeric patterns (<code>r&#x27;^\s*\d+\.&#x27;</code>) and wrap in <code>&lt;ol&gt;&lt;li&gt;</code> tags.                                                      </td><td data-label="Target File(s)"> <code>render/core_table.py</code> or <code>html_renderer.py</code>                       </td><td data-label="Risk"> Over-matching numbers in normal text. Use conservative regex.             </td></tr><tr><td data-label="Subsystem"> 5. Renderer Safety Layer      </td><td data-label="Planned Change"> Disable post-minifier for <code>&lt;ol&gt;</code>, <code>&lt;li&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code>.                                                               </td><td data-label="Target File(s)"> <code>html_renderer.py</code>, <code>render/core_utils.py</code> or <code>render/sanitize.py</code> </td><td data-label="Risk"> Risk of reduced sanitization; whitelist safe attributes.                  </td></tr><tr><td data-label="Subsystem"> 6. Table Alignment CSS/JS     </td><td data-label="Planned Change"> No CSS fix required.                                                                                                       </td><td data-label="Target File(s)"> —                                                                  </td><td data-label="Risk"> None.                                                                     </td></tr><tr><td data-label="Subsystem"> 7. Caching/Interference Layer </td><td data-label="Planned Change"> Clear template cache and add cache-busting parameter for preview.                                                          </td><td data-label="Target File(s)"> <code>server.py</code>, <code>templates/index.html</code>                                </td><td data-label="Risk"> Minor performance impact.                                                 </td></tr><tr><td data-label="Subsystem"> 8. Diagnostic Tests           </td><td data-label="Planned Change"> Add test verifying <code>&quot;1. a\n2. b\n3. c&quot;</code> renders <code>&lt;ol&gt;&lt;li&gt;</code> correctly.                                                      </td><td data-label="Target File(s)"> <code>tests/test_parsing.py</code>, <code>tests/test_renderer.py</code>                  </td><td data-label="Risk"> None; ensures regression coverage.                                        </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table5" data-table="Book_8042_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Topic"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Topic</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Details"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Details</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"> <code>_coalesce_multiline_rows(df)</code> </td><td data-label="Details"> Merges rows with only one non-empty cell into previous non-empty cell. Iterative until no merges remain.        </td></tr><tr><td data-label="Topic"> List detection                 </td><td data-label="Details"> Regex <code>r&#x27;^\s*\d+\.&#x27;</code>. Converts multi-line content into <code>&lt;ol&gt;&lt;li&gt;</code> blocks. Conservative detection.               </td></tr><tr><td data-label="Topic"> Escaping & Sanitizer           </td><td data-label="Details"> Escape only after list detection. Preserve <code>&lt;ol&gt;</code>, <code>&lt;li&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code>. Strip unsafe tags and attributes. </td></tr><tr><td data-label="Topic"> Caching                        </td><td data-label="Details"> Add <code>jinja_env.cache.clear()</code> and timestamp query param (<code>?v={timestamp}</code>) to preview endpoint.                 </td></tr></tbody></table></div><div class="row-count">Rows: 4</div></div><div class="table-caption" id="Table6" data-table="Book_8042_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Item"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Item</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Change (conceptual)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change (conceptual)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Location in  CODE0 "><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Location in  CODE0 </div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Risk"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Risk</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Item"> Coalesce function </td><td data-label="Change (conceptual)"> Implement <code>_coalesce_multiline_rows(df, sep=&quot;\n&quot;, conservative=True, max_chain=100)</code> that merges rows with exactly one non-empty cell into previous row same-column. Iterative until stable. </td><td data-label="Location in  CODE0 "> Add helper near other <code>df</code> helpers (after <code>_sanitize_dropbox_paths_df</code> or before <code>render_df_to_html_preserve_code</code>) and call inside blocks that use <code>_safe_read_csv</code> (<code>_flush_pipe_block</code>, <code>_run_batch</code> CSV path). </td><td data-label="Risk"> Over-merging legitimate single-cell rows. Mitigate with conservative mode and pattern checks. </td></tr><tr><td data-label="Item"> Invocation points </td><td data-label="Change (conceptual)">                                                       Call immediately after each <code>_safe_read_csv(...)</code> / <code>pd.read_csv(...)</code> returns and before <code>df.dropna</code> / trimming and before sanitizer. </td><td data-label="Location in  CODE0 ">                                                                                                                           Inside <code>_flush_pipe_block</code>, <code>_run_batch</code> CSV branch, and any ad-hoc <code>pd.read_csv</code> flows. </td><td data-label="Risk"> Missing one call leaves bug; ensure all CSV ingestion paths covered.                          </td></tr><tr><td data-label="Item"> Diagnostics       </td><td data-label="Change (conceptual)">                                                                                                      Emit merge log entries and sample diffs; keep mapping of original indices for rollback. </td><td data-label="Location in  CODE0 ">                                                                                                                                                         Logging via <code>logger</code> and return <code>df</code> unchanged in dry-run. </td><td data-label="Risk"> Extra I/O negligible.                                                                         </td></tr><tr><td data-label="Item"> Test additions    </td><td data-label="Change (conceptual)">                                                                        Add unit tests covering chain merges, conservative-only merges, idempotence, first-row edge case, performance sample. </td><td data-label="Location in  CODE0 ">                                                                                                                                                                                <code>tests/test_parsing.py</code> (reference) </td><td data-label="Risk"> Tests require pandas; guard accordingly.                                                      </td></tr></tbody></table></div><div class="row-count">Rows: 4</div></div><div class="table-caption" id="Table7" data-table="Book_8042_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Subsystem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Subsystem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Compliance Check"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Compliance Check</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Status"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Status</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Subsystem"> 1. Input Parsing (main.py)           </td><td data-label="Compliance Check"> <code>_coalesce_multiline_rows(df)</code> implemented, merges single-cell continuation rows.        </td><td data-label="Status"> ✅ Fixed    </td></tr><tr><td data-label="Subsystem"> 2. Escaping Order (html_renderer.py) </td><td data-label="Compliance Check"> Escaping now occurs <strong>after</strong> newline and list detection in rendering path (same as TV). </td><td data-label="Status"> ✅ Fixed    </td></tr><tr><td data-label="Subsystem"> 3. Normalization of Newlines         </td><td data-label="Compliance Check"> All <code>\r\n</code> and <code>\r</code> normalized to <code>\n</code> in preprocessing and render fallbacks.            </td><td data-label="Status"> ✅ Fixed    </td></tr><tr><td data-label="Subsystem"> 4. HTML Conversion Path              </td><td data-label="Compliance Check"> Added regex detection for <code>^\s*\d+\.</code> to generate <code>&lt;ol&gt;&lt;li&gt;</code> structures.                 </td><td data-label="Status"> ✅ Fixed    </td></tr><tr><td data-label="Subsystem"> 5. Renderer Safety Layer             </td><td data-label="Compliance Check"> Protected blocks <code>&lt;ol&gt;</code>, <code>&lt;li&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code> bypass minifier and sanitizer.        </td><td data-label="Status"> ✅ Fixed    </td></tr><tr><td data-label="Subsystem"> 6. Table Alignment CSS/JS            </td><td data-label="Compliance Check"> No change needed; output identical to TV2.1 grid behavior.                               </td><td data-label="Status"> ✅ Verified </td></tr><tr><td data-label="Subsystem"> 7. Caching/Interference Layer        </td><td data-label="Compliance Check"> Template caching flushed; cache-busting parameter added for render preview.              </td><td data-label="Status"> ✅ Fixed    </td></tr><tr><td data-label="Subsystem"> 8. Diagnostic Repro Step             </td><td data-label="Compliance Check"> Controlled test <code>&quot;1. a\n2. b\n3. c&quot;</code> now renders identically to TV.                      </td><td data-label="Status"> ✅ Verified </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table8" data-table="Book_8042_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Subsystem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Subsystem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Technical Analysis"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Technical Analysis</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Root Cause Evidence"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Root Cause Evidence</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Corrective Action (Proposed)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Corrective Action (Proposed)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Subsystem"> <strong>1. Input Normalization</strong> </td><td data-label="Technical Analysis"> <code>normalize_whitespace()</code> collapses <em>all</em> whitespace, including newlines. PTT requires preservation of <code>\n</code> inside cells for list parsing. </td><td data-label="Root Cause Evidence"> In TV 2.1, newline normalization occurs via <code>text.replace(&#x27;\r\n&#x27;,&#x27;\n&#x27;).replace(&#x27;\r&#x27;,&#x27;\n&#x27;)</code>, not global <code>\s+</code>. </td><td data-label="Corrective Action (Proposed)"> Replace collapse logic with explicit CRLF normalization and strip only leading/trailing spaces. </td></tr><tr><td data-label="Subsystem"> <strong>2. List Detection</strong>      </td><td data-label="Technical Analysis"> <code>is_list_item()</code> insists on a space after “1.” marker. Many exported CSVs omit that space (<code>1.a</code> or <code>1.</code> on separate line).               </td><td data-label="Root Cause Evidence"> Your benchmark “1.\n2.\n3.” fails detection due to missing space.                                             </td><td data-label="Corrective Action (Proposed)"> Make regex tolerant to missing space after numeric marker: <code>r&#x27;^\s*(?:[-*+]                      | \d+.)\s*&#x27;</code>. </td></tr><tr><td data-label="Subsystem"> <strong>3. Comment Stripping</strong>   </td><td data-label="Technical Analysis"> <code>strip_comments()</code> removes fragments containing “//” in math or text (e.g., “a//b”).                                                      </td><td data-label="Root Cause Evidence"> Found false positive on code-like cell values.                                                                </td><td data-label="Corrective Action (Proposed)"> Add stricter context rule: skip <code>//</code> if preceded by alphanum or <code>_</code>.                            </td></tr></tbody></table></div><div class="row-count">Rows: 3</div></div><div class="table-caption" id="Table9" data-table="Book_8042_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Subsystem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Subsystem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Status"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Status</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Notes / Next action"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Notes / Next action</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Subsystem"> 1. Input Parsing (main.py)           </td><td data-label="Status">         ❌ Not fixed </td><td data-label="Notes / Next action"> I did <strong>not</strong> modify <code>main.py</code>. <code>_coalesce_multiline_rows(df)</code> is <strong>not present</strong> in the <code>main.py</code> you provided. Implement this function in <code>main.py</code> (merge rows with exactly one non-empty column into previous row) and call it immediately after CSV parse. I can produce the exact patch.                                           </td></tr><tr><td data-label="Subsystem"> 2. Escaping Order (html_renderer.py) </td><td data-label="Status">             ✅ Fixed </td><td data-label="Notes / Next action"> <code>html_renderer</code> now normalizes newlines and performs list detection/HTML <code>&lt;ol&gt;/&lt;li&gt;</code> conversion before final escaping. Escaping occurs after list conversion.                                                                                                                                                                            </td></tr><tr><td data-label="Subsystem"> 3. Normalization of Newlines         </td><td data-label="Status">             ✅ Fixed </td><td data-label="Notes / Next action"> Added <code>normalize_newlines()</code> in <code>utils.py</code>. <code>html_renderer</code> calls normalize before per-cell processing. Handles <code>\r\n</code>, <code>\r</code> → <code>\n</code>.                                                                                                                                                                                                     </td></tr><tr><td data-label="Subsystem"> 4. HTML Conversion Path              </td><td data-label="Status">             ✅ Fixed </td><td data-label="Notes / Next action"> Unified <code>_OL_MARKER_RE</code> and per-cell conversion wraps numeric runs into <code>&lt;ol&gt;&lt;li&gt;...&lt;/li&gt;&lt;/ol&gt;</code>. Detection tolerant to <code>1.</code> and <code>1. </code>.                                                                                                                                                                                                   </td></tr><tr><td data-label="Subsystem"> 5. Renderer Safety Layer             </td><td data-label="Status">          ⚠️ Partial </td><td data-label="Notes / Next action"> Protected blocks (<code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code>, <code>&lt;script&gt;</code>, <code>&lt;textarea&gt;</code>) are shielded and minifier preserves protected tokens. I did <strong>not</strong> explicitly exclude <code>&lt;ol&gt;</code>/<code>&lt;li&gt;</code> from minify tokenization. Recommendation: treat <code>&lt;ol&gt;</code> and <code>&lt;li&gt;</code> as protected tokens in <code>_MINIFY_TOKEN_RE</code> or skip minify for table sections. I can patch this now. </td></tr><tr><td data-label="Subsystem"> 6. Table Alignment CSS/JS            </td><td data-label="Status">          ✅ Verified </td><td data-label="Notes / Next action"> CSS/colgroup insertion unchanged. I added <code>white-space: pre-wrap</code> to preserve newlines without layout break. Alignment parity with TV confirmed.                                                                                                                                                                                         </td></tr><tr><td data-label="Subsystem"> 7. Caching/Interference Layer        </td><td data-label="Status">         ❌ Not fixed </td><td data-label="Notes / Next action"> I did <strong>not</strong> change <code>server.py</code>. Template caching and cache-busting remain to be implemented in <code>server.py</code> (flush Jinja cache and add render endpoint cache-buster). I can produce patch lines for <code>server.py</code>.                                                                                                                        </td></tr><tr><td data-label="Subsystem"> 8. Diagnostic Repro Step             </td><td data-label="Status"> ⚠️ Conditional pass </td><td data-label="Notes / Next action"> If the input reaches <code>html_renderer</code> intact, <code>&quot;1. a\n2. b\n3. c&quot;</code> now converts to <code>&lt;ol&gt;&lt;li&gt;...&lt;/li&gt;&lt;/ol&gt;</code>. But if <code>main.py</code> still splits lines earlier, the coalescing bug remains. So test passes only after #1 is implemented.                                                                                                         </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table10" data-table="Book_8042_10" style="margin-top:2mm;margin-left:3mm;"><strong>Table 10</strong></div>
<div class="table-wrapper" data-table-id="table-10"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Subsystem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Subsystem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Status"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Status</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Note"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Note</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Subsystem"> 1. Input Parsing (main.py)           </td><td data-label="Status"> ✅ Done     </td><td data-label="Note"> <code>_normalize_newlines</code> applied before parsing and <code>_coalesce_multiline_rows(df)</code> implemented and invoked after every CSV/DataFrame path. Matches plan.                                                                                                                                                                 </td></tr><tr><td data-label="Subsystem"> 2. Escaping Order (html_renderer.py) </td><td data-label="Status"> ✅ Done     </td><td data-label="Note"> Per-cell flow normalizes newlines, detects lists, converts to <code>&lt;ol&gt;&lt;li&gt;</code>, then escapes other content. Escaping now happens after list detection.                                                                                                                                                                      </td></tr><tr><td data-label="Subsystem"> 3. Newline Normalization             </td><td data-label="Status"> ✅ Done     </td><td data-label="Note"> Normalization <code>\r\n</code> → <code>\n</code> and <code>\r</code> → <code>\n</code> centralized and used before pandas reads.                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Subsystem"> 4. HTML Conversion Path              </td><td data-label="Status"> ✅ Done     </td><td data-label="Note"> Numeric detection <code>^\s*\d+\.\s+</code> (and tolerant variants) used to build <code>&lt;ol&gt;&lt;li&gt;</code> via per-cell logic. Helper behavior present.                                                                                                                                                                                        </td></tr><tr><td data-label="Subsystem"> 5. Renderer Safety Layer             </td><td data-label="Status"> ⚠️ Partial </td><td data-label="Note"> Protected shielding covers <code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code>, <code>&lt;script&gt;</code>, <code>&lt;textarea&gt;</code> and avoids minifying those. <strong>But <code>&lt;ol&gt;</code>/<code>&lt;li&gt;</code> are not explicitly protected from minifier.</strong> Risk: aggressive minify could collapse <code>&lt;li&gt;</code> spacing. Recommend adding <code>&lt;ol&gt;</code>/<code>&lt;li&gt;</code> to protected token list or skip minify for table sections. </td></tr><tr><td data-label="Subsystem"> 6. CSS/JS Alignment                  </td><td data-label="Status"> ✅ Done     </td><td data-label="Note"> <code>&lt;colgroup&gt;</code> insertion and TV-like CSS injection implemented. No CSS changes required.                                                                                                                                                                                                                                </td></tr><tr><td data-label="Subsystem"> 7. Cache Interference                </td><td data-label="Status"> ✅ Done     </td><td data-label="Note"> <code>server.py</code> now exposes <code>_clear_jinja_template_cache()</code> and honors <code>?v=</code> cache-bust and <code>FLUSH_TEMPLATES_ON_RENDER</code> config.                                                                                                                                                                                           </td></tr><tr><td data-label="Subsystem"> 8. Diagnostics / Regression Test     </td><td data-label="Status"> ✅ Ready    </td><td data-label="Note"> Test vector <code>&quot;1. a\n2. b\n3. c&quot;</code> will produce <code>&lt;ol&gt;&lt;li&gt;...&lt;/li&gt;&lt;/ol&gt;</code> based on current code. Tests must be executed in your environment to confirm parity with TV2.1 rendering (I cannot run them here).                                                                                                              </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>