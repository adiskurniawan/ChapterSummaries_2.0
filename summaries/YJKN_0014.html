<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1769960840">
<link rel="stylesheet" href="assets/overrides.css?v=1772213429">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="YJKN_0014_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **VBA Macro — Update_PPh_21_Dec**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>VBA Macro — Update_PPh_21_Dec</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>Features</strong><br>- Automates staff iteration and calculator logic (optional Gross-Up GoalSeek).<br>- Safe, reversible changes: restores Calculator cells and preserves application state.<br>- Robust name matching using CleanName normalization to avoid NBSP/case/spacing issues.<br>- Writes results to <code>Tax_Calculation</code> (cols M & P) and <code>Detail_Budget</code> (col S); reports unmatched names and GoalSeek failures.</td></tr><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>Benefits</strong><br>- Significant time savings for payroll/HR batch updates.<br>- Improved accuracy and auditability with <code>dictMissing</code> / <code>dictGSFail</code> logs.<br>- Scales to large lists (recommended tests up to 2,000 rows).</td></tr><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>Validation</strong><br>- Outputs have been validated to match the Ortax yearly calculator results (see <a href="https://kalkulator.ortax.org/yearly" target="_blank">Kalkulator PPh 21 Masa Pajak Terakhir</a>).<br>- Technical user guide and implementation checklist available.</td></tr><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>How to obtain</strong><br>- Licensed module + install instructions, or sample workbook for trial runs.<br>- Includes pre-run checklist, backup guidance, and recommended audit pack.</td></tr><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>Call to action</strong><br>- Request a demo run on your <code>staff_list</code> sample to verify results and audit trail.</td></tr></tbody></table></div><div class="row-count">Rows: 5</div></div><div class="table-caption" id="Table2" data-table="YJKN_0014_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>Link: </strong><a href="https://kalkulator.ortax.org/yearly" target="_blank">Kalkulator PPh 21 Masa Pajak Terakhir</a> </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>1) Input utama (apa yang diminta user / payroll)</strong><br>- Status pegawai (pegawai tetap / bukan pegawai).<br>- Status NPWP (ada / tidak) — berpengaruh pada pengenaan tarif lebih tinggi jika tidak ada.<br>- Status kawin & jumlah tanggungan (untuk PTKP).<br>- Masa penghasilan (bulan kerja dalam tahun berjalan).<br>- Komponen penghasilan: <code>gaji/pensiun</code>, <code>tunjangan pPh (tax allowance / gross-up)</code>, <code>tunjangan lain/uang lembur</code>, <code>honorarium</code>, <code>premi asuransi yg dibayar pemberi kerja</code>, <code>natura/kenikmatan</code>, <code>tantiem/bonus/THR</code>. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>2) Penjumlahan bruto</strong><br>- Kalkulator menjumlahkan semua komponen di atas → menghasilkan <strong>Penghasilan Bruto Masa</strong> (per masa / bulan atau kumulatif sesuai input). </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>3) Pengurangan yang diizinkan (Deductions)</strong><br>- <code>Biaya jabatan</code> = <code>5% × Penghasilan Bruto</code> tetapi dibatasi maksimum <code>Rp500.000/bulan</code> (atau <code>Rp6.000.000/tahun</code>).<br>- <code>Iuran pensiun / iuran THT/JHT</code> (sesuai kontribusi aktual).<br>- <code>Zakat</code> yang dibayarkan melalui pemberi kerja (jika ada).<br>- Hasil pengurangan ini = <strong>Jumlah Pengurang</strong> → <code>Penghasilan Neto</code> = <code>Penghasilan Bruto − Jumlah Pengurang</code>. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>4) Menggabungkan penghasilan masa sebelumnya (jika ada)</strong><br>- Jika pegawai sudah menerima penghasilan di beberapa masa dalam tahun berjalan, kalkulator mengakumulasi <strong>Penghasilan Neto Masa Sebelumnya</strong> dan menggabungkan dengan masa ini untuk mendapatkan posisi kumulatif. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>5) Konversi ke basis setahun (annualisasi) — ketika “disetahunkan” dipakai</strong><br>- Untuk kasus disetahunkan: <code>Penghasilan Neto Setahun = Penghasilan Neto Bulanan × 12</code> (atau jika menggunakan kumulatif: <code>Penghasilan Neto Kumulatif / jumlah bulan kerja × 12</code>).<br>- Tujuan: mendapatkan basis tahunan untuk menerapkan tarif progresif Pasal 17 dan PTKP tahunan. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>6) Hitung PTKP (Penghasilan Tidak Kena Pajak)</strong><br>- Ambil PTKP sesuai status (mis. TK/0 = <code>Rp54.000.000</code> per tahun; tambahan <code>Rp4.500.000</code> untuk tiap tanggungan sampai max 3; tambahan untuk status kawin/istri digabung sesuai ketentuan). </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>7) Tentukan PKP (Penghasilan Kena Pajak) setahun</strong><br>- <code>PKP Setahun = Penghasilan Neto Setahun − PTKP</code> (jika negatif → PKP = 0). </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>8) Hitung PPh terutang setahun (tarif Pasal 17, progresif)</strong><br>- Terapkan lapisan tarif progresif ke PKP setahun: contoh lapisan umum saat ini: <code>sampai Rp60 jt → 5%</code>, <code>&gt;Rp60 jt s.d. Rp250 jt → 15%</code>, <code>&gt;Rp250 jt s.d. Rp500 jt → 25%</code>, <code>&gt;Rp500 jt s.d. Rp5 miliar → 30%</code>, <code>&gt;Rp5 miliar → 35%</code>.<br>- Hasilnya = <strong>PPh Pasal 21 Terutang Setahun</strong>. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>9) Proporsionalkan dan rekonsiliasi ke masa pajak terakhir</strong><br>- <code>PPh disetahunkan untuk masa</code> = <code>PPh Terutang Setahun × (masa kerja dalam bulan / 12)</code>.<br>- Kemudian kurangi <code>PPh yang sudah dipotong</code> pada masa sebelumnya → hasilnya adalah <code>PPh Terutang bulan ini</code> (dapat menghasilkan kekurangan bayar atau kelebihan bayar/refund).<br>- Jika pilihan <em>gross-up</em> atau <em>tunjangan pajak</em> diaktifkan, kalkulator menyesuaikan agar beban pajak ditanggung pemberi kerja (menghitung gross-up algebraically sehingga penerima menerima netto yang diinginkan). </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>10) Faktor tambahan yang mempengaruhi hasil akhir</strong><br>- <strong>NPWP tidak ada / NIK belum teraktivasi</strong> → pemotongan dapat dilakukan dengan tarif 20% lebih tinggi (yakni pemotongan = <code>120%</code> dari jumlah PPh yang seharusnya).<br>- Pembulatan, plafon dan ketentuan PMK/Perdirjen (mis. perlakuan untuk bukan pegawai, tarif TER, dan perhitungan DPP untuk bukan pegawai) ikut memengaruhi langkah-langkah di atas. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>11) Output yang ditampilkan oleh kalkulator</strong><br>- Rincian: <code>Penghasilan Bruto</code>, <code>Jumlah Pengurang</code>, <code>Penghasilan Neto (masa &amp; setahun)</code>, <code>PTKP</code>, <code>PKP</code>, <code>PPh Pasal 21 atas PKP</code>, <code>PPh Pasal 21 dipotong masa sebelumnya</code>, <code>PPh Terutang bulan ini</code>, <code>PPh yg sudah disetor</code> dan indikasi kelebihan/kurang bayar. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>12) Catatan implementasi & verifikasi</strong><br>- Pastikan input sesuai bukti payroll (komponen bruto, kontribusi pensiun, zakat, status NPWP/NIK, masa kerja).<br>- Untuk kasus nyata gunakan angka riil; kalkulator hanya menerapkan aturan logika (annualisasi → tarif progresif → prorata → rekonsiliasi). </td></tr></tbody></table></div><div class="row-count">Rows: 13</div></div><div class="table-caption" id="Table3" data-table="YJKN_0014_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Explanation of Final Tax Period PPh 21 Calculator**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Explanation of Final Tax Period PPh 21 Calculator</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>Link: </strong><a href="https://kalkulator.ortax.org/yearly" target="_blank">Kalkulator PPh 21 Masa Pajak Terakhir</a> </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>1) Main inputs (what the user / payroll is asked for)</strong><br>- Employee status (permanent employee / non-employee).<br>- NPWP status (present / not present) — affects application of higher withholding if absent.<br>- Marital status & number of dependents (for PTKP).<br>- Income period (months worked within the current year).<br>- Income components: <code>salary/pension</code>, <code>tax allowance (tax allowance / gross-up)</code>, <code>other allowances/overtime pay</code>, <code>honorarium</code>, <code>insurance premiums paid by employer</code>, <code>natura/benefits in kind</code>, <code>tantiem/bonus/THR</code>. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>2) Gross summation</strong><br>- The calculator sums all components above → produces <strong>Period Gross Income</strong> (per period / month or cumulative according to input). </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>3) Allowed reductions (Deductions)</strong><br>- <code>Position expense (biaya jabatan)</code> = <code>5% × Gross Income</code> but capped at <code>Rp500.000/month</code> (or <code>Rp6.000.000/year</code>).<br>- <code>Pension contributions / THT/JHT contributions</code> (per actual contributions).<br>- <code>Zakat</code> paid through employer (if any).<br>- Result of these reductions = <strong>Total Deductions</strong> → <code>Net Income</code> = <code>Gross Income − Total Deductions</code>. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>4) Combining previous period incomes (if any)</strong><br>- If the employee received income in multiple periods during the year, the calculator accumulates <strong>Previous Period Net Income</strong> and combines it with this period to obtain the cumulative position. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>5) Convert to annual basis (annualization) — when “annualized” is used</strong><br>- For annualized cases: <code>Annual Net Income = Monthly Net Income × 12</code> (or if using cumulative: <code>Cumulative Net Income / number of months worked × 12</code>).<br>- Purpose: obtain an annual basis to apply progressive Article 17 rates and annual PTKP. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>6) Calculate PTKP (Non-Taxable Income)</strong><br>- Take PTKP according to status (e.g., single with 0 dependents (TK/0) = <code>Rp54.000.000</code> per year; additional <code>Rp4.500.000</code> for each dependent up to max 3; additional amounts for married/spouse combined per regulations). </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>7) Determine annual Taxable Income (PKP)</strong><br>- <code>Annual PKP = Annual Net Income − PTKP</code> (if negative → PKP = 0). </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>8) Calculate annual PPh payable (progressive Article 17 rates)</strong><br>- Apply progressive tax brackets to annual PKP: example current brackets: <code>up to Rp60 mln → 5%</code>, <code>&gt;Rp60 mln to Rp250 mln → 15%</code>, <code>&gt;Rp250 mln to Rp500 mln → 25%</code>, <code>&gt;Rp500 mln to Rp5 billion → 30%</code>, <code>&gt;Rp5 billion → 35%</code>.<br>- Result = <strong>Annual PPh Pasal 21 Payable</strong>. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>9) Proportion and reconcile to the final tax period</strong><br>- <code>Annualized PPh for the period</code> = <code>Annual PPh × (months worked / 12)</code>.<br>- Then subtract <code>PPh already withheld</code> in previous periods → result is <code>PPh Payable this month</code> (may produce underpayment or overpayment/refund).<br>- If <em>gross-up</em> or tax allowance is enabled, the calculator adjusts so employer bears the tax (computes gross-up algebraically so the recipient receives the desired net). </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>10) Additional factors affecting the final result</strong><br>- <strong>No NPWP / NIK not activated</strong> → withholding may be applied at 20% higher rate (withholding = <code>120%</code> of the PPh that should apply).<br>- Rounding, ceilings and PMK/Directorate General regulations (e.g., treatment for non-employees, TER rates, and tax base calculation for non-employees) also affect the above steps. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>11) Outputs displayed by the calculator</strong><br>- Details: <code>Gross Income</code>, <code>Total Deductions</code>, <code>Net Income (period &amp; annualized)</code>, <code>PTKP</code>, <code>PKP</code>, <code>PPh Pasal 21 on PKP</code>, <code>PPh Pasal 21 withheld in previous periods</code>, <code>PPh Payable this month</code>, <code>PPh already deposited</code> and indication of overpayment/underpayment. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>12) Implementation & verification notes</strong><br>- Ensure inputs match payroll evidence (gross components, pension contributions, zakat, NPWP/NIK status, months worked).<br>- For real cases use actual figures; the calculator only applies the rules/logic (annualization → progressive rates → prorate → reconciliation). </td></tr></tbody></table></div><div class="row-count">Rows: 13</div></div><div class="table-caption" id="Table4" data-table="YJKN_0014_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical User Guide: Update_PPh_21_Dec (VBA macro)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical User Guide: Update_PPh_21_Dec (VBA macro)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Purpose & objective</strong><br>Automates PPh21 updates for employees listed in the workbook-level named range <code>staff_list</code>. For each staff name the macro: writes the name into <code>Calculator!F5</code>, recalculates the Calculator sheet, optionally runs a Gross-Up GoalSeek (if <code>Calculator!G2 = &quot;Gross Up&quot;</code>), captures result cells from the Calculator, writes results back to <code>Tax_Calculation</code> (columns <strong>M</strong>, <strong>P</strong>, <strong>S</strong>), and collects any unmatched names or GoalSeek failures for a concise user summary. The macro preserves application state, restores key Calculator cells (including <code>F5</code> and <code>F29</code>) on normal completion or error, and limits the user summary to the first 25 items per failure category. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Scope</strong><br>Applies to the <code>Update_PPh_21_Dec</code> macro in this workbook (refactored variant). Covers environment preconditions, inputs/outputs, step-by-step run instructions, expected behaviour, failure modes, remediation steps, testing guidance, deployment and change-control recommendations. Excludes unrelated macros and external payroll systems. <code>Detail_Budget</code> write-back is present in the code but currently commented out; instructions reference this as optional functionality. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>High-level summary of what the macro does</strong><br>1) Save and disable UI updates/events and set <code>Application.Calculation = xlCalculationManual</code> to speed processing.<br>2) Read <code>staff_list</code> (workbook named range).<br>3) For each non-empty staff name: normalise the name, write it to <code>Calculator!F5</code>, calculate the <code>Calculator</code> sheet, optionally run GoalSeek on <code>F2</code> changing <code>F29</code> (with a retry after <code>Application.Calculate</code>), find the matching row in <code>Tax_Calculation</code> column A and write <code>F47 → M</code>, <code>F50 → P</code>, <code>F2 → S</code>. (Optional) find matching row in <code>Detail_Budget</code> column B and write <code>G36 → S</code> if that block is enabled.<br>4) Track missing names and GoalSeek failures in <code>Scripting.Dictionary</code> objects to avoid duplicates.<br>5) Restore <code>Calculator</code> state (clear <code>F29</code>, restore <code>F5</code>, re-create <code>F29</code> VLOOKUP formula and—per current behaviour—convert it to a value), recalc <code>shCalc</code>, restore application state, and show a summary <code>MsgBox</code> if there were any issues.<br>6) On runtime error, run a best-effort restore then show an error message. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Key worksheets & cells</strong><br>• <code>Calculator</code> (sheet name must match exactly): key cells used by the macro — <code>F5</code> (input staff name; original value stored in <code>originalF5</code> and restored at end), <code>G2</code> (Gross Up flag), <code>F2</code> (GoalSeek target — also written back to <code>Tax_Calculation</code> column S), <code>F29</code> (GoalSeek changing cell; macro clears it during processing and re-creates the VLOOKUP formula at cleanup), <code>F47</code> (value written → <code>Tax_Calculation</code> M), <code>F50</code> (value written → <code>Tax_Calculation</code> P), <code>G36</code> (value written → <code>Detail_Budget</code> S when uncommented).<br>• <code>Tax_Calculation</code>: macro searches column <strong>A</strong> for an exact match (see matching rules) and writes to columns <strong>M</strong>, <strong>P</strong>, <strong>S</strong> for the matched row.<br>• <code>Detail_Budget</code>: optional write-back (commented). If re-enabled, the macro finds exact matches in column <strong>B</strong> and writes <code>G36</code> to column <strong>S</strong>. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Preconditions / required environment</strong><br>1. Excel desktop with macros enabled (trusted workbook recommended).<br>2. Workbook contains worksheets named exactly: <code>Calculator</code>, <code>Tax_Calculation</code>, <code>Detail_Budget</code> (Detail_Budget may be present even if write-block is commented).<br>3. Workbook-level named range <code>staff_list</code> exists and refers to a single-column range of staff names (no header expected; if header exists remove or adjust before run).<br>4. Calculator sheet contains the expected formulas and values for <code>F2</code>, <code>F5</code>, <code>F29</code>, <code>F47</code>, <code>F50</code>, <code>G2</code>, <code>G36</code>.<br>5. <code>Scripting.Dictionary</code> is available via late-binding (<code>CreateObject(&quot;Scripting.Dictionary&quot;)</code>) — no VBA reference required. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Normalization & matching rules (exact behaviour used by code)</strong><br>• The macro constructs a <code>cleanName</code> from the <code>staff_list</code> entry by replacing <code>Chr(160)</code> (non-breaking space) with a normal space and then applying <code>Application.WorksheetFunction.Trim</code> to collapse extra spaces. The code currently does not explicitly force lower-case but uses <code>MatchCase:=False</code> in <code>Find</code>, so matches are case-insensitive. <br>• Matching uses <code>Range.Find</code> on <code>Tax_Calculation</code> column <strong>A</strong> with <code>LookAt:=xlWhole</code>, <code>MatchCase:=False</code>. If you enable <code>Detail_Budget</code> writes, matching there uses column <strong>B</strong> with the same criteria. <br>• If names contain other invisible characters, diacritics, or alternate Unicode normalization forms, those will need additional handling outside of the default <code>cleanName</code> step. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>GoalSeek behaviour (exact logic)</strong><br>• The macro checks <code>shCalc.Range(&quot;G2&quot;).Value</code> for the literal string <code>&quot;Gross Up&quot;</code>. If equal, it attempts <code>shCalc.Range(&quot;F2&quot;).GoalSeek(Goal:=0, ChangingCell:=shCalc.Range(&quot;F29&quot;))</code>. <br>• If the first GoalSeek attempt returns False, the macro executes <code>Application.Calculate</code> (full workbook calc), then retries GoalSeek once more. <br>• If the second attempt still fails, the staff name is recorded in <code>dictGSFail</code> (Scripting.Dictionary) to prevent duplicate entries and report later. <br>• If <code>G2</code> is not <code>&quot;Gross Up&quot;</code>, the macro clears <code>F29</code> for that iteration to ensure no residual changing value remains. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>In-memory tracking & reporting</strong><br>• Two late-bound dictionaries are used: <code>dictMissing</code> (names not found in target sheets) and <code>dictGSFail</code> (GoalSeek failures). They are created with <code>CreateObject(&quot;Scripting.Dictionary&quot;)</code> to avoid duplicate keys and enable quick existence checks. <br>• On completion, if either dictionary has entries the macro builds a <code>msg</code> string listing up to the first 25 keys in each dictionary and indicates <code>(more omitted)</code> when more than 25 entries exist. That <code>msg</code> is shown in a <code>MsgBox</code> titled <code>Update_PPh_21_Dec</code>. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Application-state preservation & restoration</strong><br>• The macro saves <code>Application.ScreenUpdating</code>, <code>Application.EnableEvents</code>, and <code>Application.Calculation</code> into local variables (<code>prevScreen</code>, <code>prevEvents</code>, <code>prevCalc</code>) before modifying them. <br>• Sets <code>Application.ScreenUpdating = False</code>, <code>Application.EnableEvents = False</code>, and <code>Application.Calculation = xlCalculationManual</code> at start to improve performance and avoid event side-effects. <br>• On both normal completion and in the <code>CleanFail</code> error handler the macro attempts to restore Calculator cells (<code>F29</code> cleared, <code>F5</code> restored to <code>originalF5</code>, <code>F29</code> re-created as the VLOOKUP formula and then converted to its value), recalculates the Calculator sheet, and finally restores the saved <code>Application</code> settings. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Cleanup behaviour (explicit code actions)</strong><br>1. <code>shCalc.Range(&quot;F29&quot;).ClearContents</code> — ensure no temporary changing value remains.<br>2. <code>shCalc.Range(&quot;F5&quot;).Value = originalF5</code> — restore prior F5 value.<br>3. Recreate <code>F29</code> formula via R1C1: <code>=VLOOKUP(R5C6,Tax_Calculation!C[-5]:C[10],16,0)</code> and then set that cell's <code>.Value = .Value</code> (current design converts the formula to its computed value).<br>4. <code>shCalc.Calculate</code> — recalc to ensure consistency.<br>5. Restore <code>Application.ScreenUpdating</code>, <code>Application.EnableEvents</code>, and <code>Application.Calculation</code> to the prior values. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Error handling & best-effort recovery</strong><br>• <code>On Error GoTo CleanFail</code> at the top funnels unexpected runtime errors to <code>CleanFail</code>. <br>• <code>CleanFail</code> uses <code>On Error Resume Next</code> and attempts the same cleanup steps (clear <code>F29</code>, restore <code>F5</code>, re-create <code>F29</code> formula then convert to value, recalc) and restores the application state. <br>• After recovery attempts it shows a <code>MsgBox &quot;Error &quot; &amp; Err.Number &amp; &quot;: &quot; &amp; Err.Description</code> (vbExclamation) to notify the user. Always review the workbook state after an error and restore from backup if recovery was insufficient. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>User-facing messages & behavior</strong><br>• If <code>staff_list</code> is not found: immediate <code>MsgBox &quot;Named range &#x27;staff_list&#x27; not found.&quot;</code> and the macro exits cleanup. <br>• If there are any missing names or GoalSeek failures: MsgBox titled <code>Update_PPh_21_Dec</code> summarising <code>Names not found in Tax_Calculation or Detail_Budget:</code> and <code>GoalSeek failed for:</code> with up to 25 names each and <code>(more omitted)</code> if larger. <br>• On fatal runtime error: <code>MsgBox &quot;Error &lt;number&gt;: &lt;description&gt;&quot;</code> and a best-effort restore is attempted. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Operational run steps — pre-run, run, post-run (detailed)</strong><br><strong>Pre-run:</strong><br>1. Confirm the named range <code>staff_list</code> exists and points to the intended single-column list (remove header rows or ensure <code>staff_list</code> excludes headers).<br>2. Save a timestamped copy of the workbook (recommended backup).<br>3. Verify <code>Calculator</code> key cells (<code>F2</code>, <code>F5</code>, <code>F29</code>, <code>F47</code>, <code>F50</code>, <code>G2</code>, <code>G36</code>) contain expected formulas/labels and that the VLOOKUP pattern used in <code>F29</code> aligns with <code>Tax_Calculation</code> layout. <br>4. If running a large batch (>500 rows), notify reviewers and consider running against a copy to measure runtime. <br><strong>Run:</strong><br>1. Open workbook in Excel desktop, enable macros for the workbook, and ensure no other macros are running. <br>2. Run <code>Update_PPh_21_Dec</code> (Developer → Macros or assigned button). <br>3. Macro iterates names, performs per-row calculation and GoalSeek logic as required, updates <code>Tax_Calculation</code> and collects problems in dictionaries. <br><strong>Post-run:</strong><br>1. Review MsgBox summary and address <code>dictMissing</code>/<code>dictGSFail</code> items. <br>2. Spot-check 5–10 rows in <code>Tax_Calculation</code> to confirm <code>M</code>, <code>P</code>, <code>S</code> values match expectations (compare against <code>Calculator!F47</code>, <code>F50</code>, <code>F2</code> recorded during run). <br>3. If changes are accepted, save and archive workbook backup; if not, restore pre-run backup and investigate. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Testing, validation & recommended test cases</strong><br>• <strong>Unit test:</strong> small <code>staff_list</code> (3–10 rows) with known expected outputs for <code>F47</code>, <code>F50</code>, <code>F2</code>. Confirm target writes match expected values exactly.<br>• <strong>Edge cases:</strong> empty names; names with NBSP (<code>Chr(160)</code>); multiple contiguous spaces; duplicates in <code>staff_list</code>; names with accents/diacritics; names present only in one of the target sheets. Confirm <code>dictMissing</code> and <code>dictGSFail</code> capture these appropriately.<br>• <strong>Error recovery test:</strong> intentionally raise an error inside the loop (e.g., temporarily remove <code>Tax_Calculation</code> sheet) and confirm <code>F5</code>, <code>F29</code>, and application state are restored by <code>CleanFail</code> and that an informative error MsgBox is shown.<br>• <strong>Performance test:</strong> run on a copy with 500–2,000 rows to measure total runtime and memory behaviour; consider reducing per-row recalc if performance is unsatisfactory. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Audit & logging recommendations (practical improvements)</strong><br>• Current behaviour shows a transient MsgBox summary but does not persist logs. Recommended: add an optional <code>Audit_Log</code> worksheet where <code>dictMissing</code> and <code>dictGSFail</code> are written with timestamp, user, workbook name, and sample values to preserve an auditable trail. <br>• Retain pre-run and post-run workbook copies in a versioned archive (SharePoint/git/similar) with naming convention <code>Payroll_PR&lt;YYYYMM&gt;_Workbook_UpdateHR_&lt;rundate&gt;.xlsm</code> for auditors. <br>• Optionally extend the macro to capture per-row <code>F47</code>, <code>F50</code>, <code>F2</code> snapshots into the audit sheet for reconciliation sampling. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Common failure modes & remediation</strong><br>• <strong>Named range missing:</strong> macro aborts with MsgBox. Remediation: create <code>staff_list</code> via Formulas → Name Manager or adjust macro to reference correct range. <br>• <strong>Name mismatches (dictMissing):</strong> usually caused by non-breaking spaces, extra spaces, hidden characters, or exact-match requirements. Remediation: run a pre-match diagnostic using <code>Application.Trim</code>/NBSP replacement on both lists or enable fuzzy/partial matching (change <code>LookAt</code> to <code>xlPart</code> or implement string similarity). <br>• <strong>GoalSeek failures (dictGSFail):</strong> caused by unstable formulas, invalid <code>F29</code> starting values, or circular references. Remediation: run <code>Application.Calculate</code> manually, inspect <code>Calculator</code> formula chains, run manual GoalSeek to debug, and adjust Excel iteration options if appropriate. <br>• <strong>Calculator state not restored:</strong> if <code>CleanFail</code> fails, manually reset <code>Application.Calculation = xlCalculationAutomatic</code> and restore <code>F5</code>/<code>F29</code> from backup if necessary. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Configuration / small-code change suggestions (only where necessary)</strong><br>These are optional and should be applied only if you want behaviour different from the current code: <br>• <strong>Preserve live <code>F29</code> formula instead of converting to value:</strong> remove the line <code>shCalc.Range(&quot;F29&quot;).Value = shCalc.Range(&quot;F29&quot;).Value</code> in cleanup to keep the VLOOKUP formula live. <br>• <strong>Safer trimming:</strong> replace <code>Application.WorksheetFunction.Trim(cleanName)</code> with <code>Application.Trim(cleanName)</code> to avoid runtime error for empty/illegal inputs. <br>• <strong>Persist audit log:</strong> add code to dump <code>dictMissing</code>/<code>dictGSFail</code> into an <code>Audit_Log</code> sheet rather than relying only on MsgBox. <br>• <strong>Store original <code>F29</code> formula:</strong> capture <code>originalF29Formula = shCalc.Range(&quot;F29&quot;).FormulaR1C1</code> at start and reassign on cleanup instead of hardcoding the VLOOKUP. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Governance, responsibilities & RACI (concise)</strong><br>• <strong>Payroll/HR Lead (R):</strong> prepare <code>staff_list</code>, confirm name format, validate initial results. <br>• <strong>Finance Analyst (A):</strong> validate <code>Tax_Calculation</code> outputs (cols M/P/S) and reconcile to GL samples. <br>• <strong>Workbook Owner / IT (C):</strong> maintain code, backups, macro signing/trust centre settings, and secure repository access. <br>• <strong>Reviewer/Test Owner (R):</strong> run tests on a copy and sign off prior to production runs. <br>• <strong>End user (I):</strong> run macro and act on the summary message (resolve missing names and GoalSeek failures). </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Operational governance, security & versioning</strong><br>• Store workbook in a controlled, versioned repository (SharePoint or secure file store). <br>• Use code signing and macros only enabled for trusted files. <br>• Maintain automated backups or manual snapshot before each production run. <br>• Limit the set of users allowed to run or modify the macro and capture approvals in <code>Macro_ChangeLog</code>. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Deployment & change management checklist</strong><br>Before enabling this macro in production: <br>☐ Place workbook in versioned repository and apply code signing where possible. <br>☐ Add <code>Macro_ChangeLog</code> sheet with version, author, date, and test notes. <br>☐ Validate <code>staff_list</code> and <code>Calculator</code> cell mappings in a staged copy. <br>☐ Add or enable <code>Audit_Log</code> persistence if auditability is required. <br>☐ Agree escalation thresholds and run acceptance criteria with finance/IT. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Operational escalation thresholds</strong><br>• Minor: single or a few missing names — correct master data and re-run.<br>• Moderate: >5% missing names or GoalSeek failures affecting non-material staff — investigate data quality and rerun on a copy.<br>• High: GoalSeek failures affecting high-value staff, or unexpected value variance beyond tolerance — stop production runs, restore backup, escalate to workbook owner/finance lead for RCA. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Suggested immediate actions before first production run</strong><br>1) Create a timestamped backup of the workbook.<br>2) Run macro on a small controlled sample and validate outputs vs manual calculations.<br>3) Enable <code>Audit_Log</code> persistence (recommended) or plan to capture <code>dictMissing</code>/<code>dictGSFail</code> programmatically.<br>4) Define escalation path for GoalSeek failures and missing master data. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Sample outputs & expected prompts</strong><br>• <strong>No issues:</strong> silent completion (no MsgBox shown). <br>• <strong>Partial issues:</strong> MsgBox summarising <code>Names not found in Tax_Calculation or Detail_Budget:</code> and/or <code>GoalSeek failed for:</code> listing up to 25 names and <code>(more omitted)</code> indicator. <br>• <strong>Fatal error:</strong> MsgBox <code>Error &lt;number&gt;: &lt;description&gt;</code>; macro attempts best-effort restore. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Testing checklist (pre-production)</strong><br>☐ Unit tests for representative sample inputs passed.<br>☐ Edge cases (empty, NBSP, duplicates) handled correctly.<br>☐ Error-injection recovery validated (application state and Calculator cells restored).<br>☐ Performance testing on representative dataset size completed. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Maintenance plan & periodic checks</strong><br>• Keep the macro code under version control and require peer review for any change. <br>• Quarterly health-check: validate existence and structure of named ranges and key Calculator cells; run a small smoke-test and confirm <code>F29</code> and <code>F5</code> restoration behaviour. <br>• Add regression tests to <code>Macro_ChangeLog</code> entries indicating which tests must be re-run after changes. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>FAQ (short)</strong><br>Q: Why are many names listed as missing? — A: Check for NBSP, extra spaces, hidden chars and confirm <code>Tax_Calculation</code> col A / <code>Detail_Budget</code> col B contain expected keys. Consider running a side-by-side diff or enabling fuzzy matching.<br>Q: GoalSeek failed for high-value staff — next steps? — A: Inspect Calculator dependencies, initial <code>F29</code> value, run manual GoalSeek, check Excel iteration options, and escalate if material.<br>Q: How to preserve original <code>F29</code> formula? — A: Capture the original formula at macro start and restore it on cleanup, or remove the <code>.Value = .Value</code> conversion if you want it to remain a formula. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Final compliance note</strong><br>Before adopting into regular production, align sign-off, backup retention policy, test acceptance criteria and escalation procedures with central finance/IT policies. Record approvals and deviations in <code>Macro_ChangeLog</code> and include run artifacts in the payroll audit pack. </td></tr></tbody></table></div><div class="row-count">Rows: 27</div></div><div class="table-caption" id="Table5" data-table="YJKN_0014_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Complete Guide — BPA1 XML Import Format &amp; Excel Converter"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Complete Guide — BPA1 XML Import Format & Excel Converter</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Complete Guide — BPA1 XML Import Format & Excel Converter (single-column restart, single <code>&lt;br&gt;</code> line breaks)</strong><br><strong>Executive Overview (Purpose, Regulatory Context, Scope, Risk Framing, Intended Audience)</strong><br>This document is the authoritative operational, technical, governance, and audit reference for preparing, validating, converting, and uploading <strong>BPA1 (Bukti Pemotongan A1)</strong> data from XLSX/Converter format into XML compliant with e-Bupot 21 requirements. It is designed for enterprise-grade implementation across Payroll, HR Operations, Tax, Finance, Internal Audit, IT/Integration, and Compliance teams. The guide covers end-to-end processing gates (Export → Validate → Normalize → Calculate → Map → XML → Bundle → Staging → Production); validation framework architecture (schema + business rules + cross-record controls); deterministic calculation engine specification (including gross-up solver); numeric golden-file regression strategy; mapping governance & template change detection; full audit artefact lifecycle management; signoff sequencing & segregation of duties; API/ETL integration contracts; SLA/KPI monitoring and escalation mechanics; audit pack assembly requirements; and edge case regulatory handling. All numeric examples are expressed in IDR and structured to serve as regression test inputs. Primary risks addressed include portal upload blocking errors, inconsistent tax calculations, inadequate audit traceability, mapping drift, unauthorized manual overrides, incomplete previous-employer reconciliation, and rounding inconsistencies causing GL drift. Expected outcomes after implementation: reduction of blocking validation errors before production, deterministic calc_log reproducibility, fully documented signoff chain with SSO evidence, regression protection on mapping updates, production parse failure rate <5% per batch, and critical issue resolution SLA ≤ 3 business days. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Gate A — Controlled Export & Freeze (Deep Control Layer)</strong><br>Objective: establish immutable raw baseline and origin integrity.<br>Steps:<br>1) Export raw from payroll/HCM/Converter portal and save to workspace <code>{staging_root}/{YYYY}/{KPP}/{period}/{operator_ts}/raw/</code> with filename pattern <code>raw_export_{kpp}_{period}_{YYYYMMDD_HHMMSS}.xlsx</code>.<br>2) Compute SHA256 (<code>sha256_raw</code>) and verify after copy.<br>3) Create <code>export_metadata.json</code> including <code>operator_id, system_version, export_ts, source_system, hostname, template_sha256, period, kpp, sha256_raw, reason</code>.<br>4) Freeze controls: set file read-only, deny overwrite, log SSO export event id.<br>Gate A artefacts: <code>raw_export.xlsx</code>, <code>export_metadata.json</code>, <code>export_registry_entry.csv</code>.<br>Blocking condition: hash mismatch or unauthorized operator role.<br>Additional operational details: preserve original file timestamps, capture export query parameters, store a human-readable export summary in <code>export_readme.md</code>, and require operator attestation recorded as <code>attestation_{operator_id}.txt</code> with SSO event id.<br>For large exports (>100k rows) use chunked export with incrementing <code>part</code> suffixes and a manifest linking parts. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Gate B — Validator Engine (Schema + Cross-Field + Cross-Record)</strong><br>Validator layers: schema validation (columns, data types, length), business rules (NPWP length 15 after normalization; months sum ≤ 12; GrossUpFlag requires calc_log; WNA requires passport), cross-record rules (duplicate NPWP, components sum to gross, negative income exceptions).<br>Outputs: <code>validation_report.csv</code>, <code>validation_summary.json</code>, <code>error_heatmap.html</code>.<br>Severity mapping: CRITICAL (block), ERROR (must fix), WARNING (triage), INFO (log).<br>Escalation automation: notify Payroll Lead if > threshold criticals; auto-create tickets for CRITICALS with workspace links.<br>Implementation notes: validator accepts both CSV or XLSX; validator version logged in <code>validation_summary.json</code>.<br>Include optional strict-mode (blocks on any warning) and permissive-mode (warnings allowed with signoff).<br>Provide a CLI and UI wrapper so operator can run validation interactively and export a filtered view per responsible team. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Gate C — Normalization & Remediation Controls</strong><br>Auto-fix rules (logged): strip non-digits (numeric IDs), normalize dates to ISO, trim strings, canonicalize enums, normalize PTKP codes, standardize currency separators.<br>All auto-fixes appended to <code>change_ledger.csv</code> with fields <code>row_id, field, old_value, new_value, change_type, operator, ts, reason, approval_id(optional), ticket_id(optional)</code>.<br>Manual corrections require ticket, evidence (payslip, ID scan), and SSO <code>approval_id</code>.<br>For large anomalies run bulk normalization in dry-run producing <code>normalizer_preview.csv</code>.<br>Integrity controls: append-only ledger, daily digest with HSM signing, quarterly checksum audit.<br>High-risk edits (>3 fields changed) trigger secondary review.<br>Gate C outputs: <code>change_ledger.csv</code>, <code>normalizer_log.csv</code>, <code>remediation_plan_{ticket_id}.md</code>.<br>Operational guidance: provide a reconciliation UI that shows before/after diffs, supports bulk accept/reject of auto-fixes, allows delegation of manual corrections to HR agents with enforced SLA and automatic reassignment on SLA breach. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Gate D — Deterministic Calculation Engine (Full Tax Logic)</strong><br>Core calc steps per-record: aggregate gross income; compute pension deduction; compute prorated job expense (biaya jabatan) with proration and plafon; pesangon (severance) treatment with PMK exemptions; gross-up solver when flagged; FX conversion recording (conversion_rate & source); compute taxable income (PKP) after PTKP; apply progressive Article 17 rates; calculate annual tax; compare with cumulative withheld; compute balance and suggested payroll actions (refund or additional withholding).<br>Save one <code>calc_log</code> JSON per record in <code>calc_logs/</code> with canonicalized schema including <code>record_id, employee_id, inputs, steps[], outputs, calc_version, rounding_rule_id, timestamp, operator_id, sha256</code>.<br>Gross-up solver: deterministic binary search (parameters: tolerance 1 IDR, max_iter e.g., 100) with iteration trace logged (<code>iteration_no, guess_gross, tax_guess, net_after_tax, diff</code>).<br>Numeric stability: maintain internal precision; round only at defined aggregation points; use <code>SafeRound(value, rounding_rule_id)</code> and record <code>rounding_rule_id</code> in calc_log.<br>Run QC sampling: 1% random + top 1% by value; output <code>calc_qc_report.csv</code>.<br>Gate D outputs: <code>calc_logs/{record_id}.json</code>, <code>calc_qc_report.csv</code>, <code>calc_summary.json</code>.<br>Implementation requirements: calc_engine must be deterministic (seeded RNG if needed only for sampling), publish <code>calc_engine_manifest.json</code> with version, commit hash, and unit test coverage report.<br>Provide a dry-run mode that emits <code>calc_diff_report.csv</code> comparing previous calc_version outputs. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Gate E — Mapping & XML Construction (Strict Governance)</strong><br>Mapping format: CSV <code>source_column,xml_node,required,type,transform,notes</code>.<br>Transform pipeline supports normalized functions (e.g., <code>normalize_digits | pad_left(15)</code>), concatenation, conditional mapping.<br>Generate both <code>xml_pretty/{employee_id}.xml</code> and <code>xml_canonical/{employee_id}.xml</code> (canonicalized for sha256).<br>Validate against portal XSD; capture XSD issues to <code>xsd_errors.log</code>.<br>Template change detection: compare <code>template_sha256</code> with portal-provided template; on change produce <code>mapping_diff.csv</code> and block mapping until mapping regression passes.<br>Gate E outputs: <code>xml_canonical/</code>, <code>xsd_errors.log</code>, <code>mapping_applied.csv</code>.<br>Additional controls: enforce mapping review workflow with dual-approval for mapping changes, store prior mapping versions in <code>mapping_archive/</code>, require golden-file regression pass before mapping version promoted to <code>production</code>.<br>Include a mapping simulator UI to preview XML for selected rows and allow samples to be exported for portal test uploads. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Gate F — Acceptance Bundle Assembly & Signoff Governance</strong><br>Bundle composition: XML(s), <code>validation_report.csv</code>, <code>calc_logs.zip</code> or calc_logs folder, <code>change_ledger.csv</code>, <code>manifest.txt</code>/<code>manifest.json</code> (file list with sha256 checksums, descriptions), <code>export_metadata.json</code>, signoff evidence (SSO event ids, PDFs).<br>Compute <code>bundle_sha256</code>; append to <code>upload_log.csv</code> with operator reference.<br>Require signoffs in sequence per RACI (HR_signoff_id → Payroll_signoff_id → Tax_signoff_id) and store signoff metadata in manifest.<br>Bundle must be immutable once signed.<br>Gate F outputs: <code>acceptance_bundle_{kpp}_{period}.zip</code>, <code>bundle_sha256</code>, <code>signoff_receipts/</code>.<br>Enforcement details: apply digital signature to bundle (HSM-signed manifest) and lock bundle folder; maintain <code>bundle_registry.csv</code> with statuses (draft, pending_signoff, signed, uploaded, archived).<br>Include explicit rollback procedure if a signoff must be revoked: create <code>unsigned_amend_{bundle_id}</code> workflow with clear audit trail and new bundle sha256. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Gate G — Staging Upload & Smoke Validation</strong><br>Upload bundle to staging API; poll <code>parse_summary</code>.<br>Validate counts, critical/warning counts, and sample node mapping against manifest.<br>Run smoke tests: parse success, sample record match, calc_log values match expected.<br>Capture portal responses and screenshots.<br>If smoke fails generate <code>staging_failure_report.json</code> and follow remediation workflow.<br>Gate G outputs: <code>staging_parse_summary.json</code>, <code>smoke_test_report.pdf</code>.<br>Operational best-practice: include automated screenshot & HTML capture of portal parse result, persist portal-provided parse id for tracing, and require a minimum sample size for smoke (e.g., 10 records across low/median/high values).<br>If staging returns non-deterministic results, escalate to IT and portal support with attached artefacts. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Gate H — Production Release & Amendment Protocol</strong><br>After signoffs and staging pass, upload to production endpoint using idempotency tokens; store <code>upload_response.json</code> and portal snapshot.<br>Run reconciliation jobs for SSP posting and GL entries and record results.<br>If production returns blocking errors, create <code>amend_bundle</code> with <code>amend_flag=true</code>, explanation, approvals, and track in <code>upload_log.csv</code> with <code>amendment_origin</code> in manifest.<br>Gate H outputs: <code>upload_response.json</code>, <code>production_snapshot_{timestamp}.json</code>.<br>Production controls: employ exponential backoff retries for transient network failures, ensure idempotency by <code>bundle_sha256</code>, maintain <code>production_deployment_log.csv</code> with operator and SSO ids, and require post-production audit checklist including sampling to verify portal calculation vs local calc_logs. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Storage, Security & Data Governance Framework (Detailed Policies)</strong><br>Mandatory artefacts (to store securely): <code>raw_export.xlsx</code>, <code>export_metadata.json</code>, <code>validation_report.csv</code>, <code>change_ledger.csv</code> (append-only WORM), <code>calc_logs/</code> (per-row JSON), <code>mapping_table_v{date}.csv</code>, <code>manifest.txt/manifest.json</code>, <code>acceptance_bundle.zip</code>, <code>upload_log.csv</code>, <code>upload_response.json</code>, <code>signoff_evidence/</code>.<br>Data classification: <code>sensitive</code> (PII: NPWP, NIK, passport scans), <code>confidential</code> (calc_logs, change_ledger), <code>internal</code> (mapping, scripts), <code>public</code> (SOP summaries).<br>Retention & archival: minimum retention 5 years (recommended 10 years for regulated sectors).<br>Move closed bundles older than 2 years to cold storage; keep an indexed manifest for retrieval.<br>Encryption & transport: AES-256 at rest; TLS 1.2+ for transport; use client certificates for server-to-server and HSM for signing manifests.<br>Access control: RBAC model — payroll_team (edit limited fields), hr_leads (edit verification flags), auditors (read-only on repo archives), dev/IT (read/edit mapping & tooling only); approvals must use SSO + MFA and record SSO event id in signoff evidence.<br>Audit & evidence: every manual change requires <code>approval_id</code> (SSO event id), ticket_id, and reason. <code>change_ledger</code> must be immutable and store operator identity; run quarterly ledger integrity checks (recompute checksums).<br>Backup & restore testing: daily incremental backups, monthly immutable snapshot to cold storage, perform a restore test every 6 months and log results in <code>backup_tests/</code>.<br>Maintain DR runbook with RTO/RPO targets (example: RTO 24h, RPO 24h for critical artefacts).<br>Additional governance: maintain data access reviews quarterly, enforce least-privilege, and require secure shredding of unnecessary PII per retention schedule. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Field-by-Field Canonical Spec (Complete with Validation & Excel Helpers)</strong><br>Store canonical field definitions in <code>field_spec.csv</code> (used by validator). Each field record includes validation, normalization rules, example values, owner, and paste-ready Excel helpers.<br>Key field profiles (paste-ready helpers):<br>1) NPWP_Pemotong — type: digits-only string, canonical length 15 after normalization. Normalization: remove dots/hyphens/spaces. Excel helper: <code>=TEXTJOIN(&quot;&quot;,TRUE,IFERROR(MID(A2,ROW(INDIRECT(&quot;1:&quot;&amp;LEN(A2))),1)*1,&quot;&quot;))</code>.<br>2) Validation example: <code>=IF(LEN(npwp_norm)&lt;&gt;15,&quot;ERR001 Invalid NPWP&quot;,&quot;OK&quot;)</code>.<br>3) StatusBukti — Enum: Yes/No.<br>4) PeriodeStart/PeriodeEnd — allowed formats month number (1..12) or ISO date <code>YYYY-MM-DD</code>.<br>5) TahunPajak — 4-digit integer validate range (current or previous year).<br>6) KodeWNIWNA / NoPassport — <code>WNI</code>/<code>Foreign</code> (If <code>Foreign</code>, <code>NoPassport</code> mandatory and passport scan attached).<br>7) NPWP_Penerima / NIK_Penerima — if NPWP missing record portal placeholder code and count placeholders in manifest.<br>8) StatusPTKP — Enum synced with <code>config_ptkp.csv</code>.<br>9) NamaJabatan — max length 50 characters <code>=LEFT(cell,50)</code> and full title stored in attachments if trimmed; flag trims in change_ledger.<br>10) KodeObjekPajak — validate via lookup against <code>tax_object_codes.csv</code>.<br>11) BulanBekerja — integer 1..12 and total months per employee across rows ≤ 12.<br>12) PenghasilanBruto / Component_map — digits-only integer; if monthly source <code>=monthly_gross*months_in_period</code>.<br>13) Component_map must sum to PenghasilanBruto within rounding tolerance: <code>=IF(ABS(PenghasilanBruto - SUM(components))&gt;rounding_tolerance,&quot;ERR_COMP_MISMATCH&quot;,&quot;OK&quot;)</code> with acceptable rounding tolerance 2 IDR.<br>14) GrossUpFlag — Enum Yes/No; if Yes calc_log must include solver trace (iterations, convergence tolerance).<br>15) IuranPensiun — <code>=monthly_pension*months</code> and verify against pension register.<br>16) PreviousNoBukti / PreviousTax / PreviousNetIncome — when non-zero validator requires evidence linkage (scan 1721 A1/A2) and StatusBukti=Yes.<br>17) JumlahTelahDipotong — reconcile to GL/SSP allowing small tolerance for rounding/FX.<br>18) ID_TKU — format NITKU 22 digits, pad branch index if missing.<br>19) TanggalTerbit — ISO <code>YYYY-MM-DD</code> and must not be earlier than last pay date for the period.<br>Field spec maintenance: update <code>field_spec.csv</code> when regulations change; require dual approval for updates and version as <code>field_spec_v{n}.csv</code>.<br>Provide both human-readable field spec export and machine-readable JSON used by validator. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Detailed Validation Rules — Severity, Sample Expressions & Routing</strong><br>Validator outputs rows: <code>{row_id, employee_id, severity, code, field, message, suggested_fix, responsible_team, ticket_link_optional}</code>.<br>Severity mapping: CRITICAL (block conversion), ERROR (must fix pre-bundle), WARNING (triage), INFO (note).<br>Critical checks include missing required fields (npwp_pemotong, employee_id, penghasilanbruto when months>0), NPWP invalid (non-digit or incorrect length) unless placeholder allowed, NIK missing when required, sum of months across employee rows > 12, GrossUpFlag=Yes but no calc_log or solver did not converge, XML XSD validation errors.<br>Warning checks include component value > 3× role median (possible miscoding), job title length > 50 (auto-trim suggested), duplicate NPWP across employee_ids (possible data duplication).<br>Excel sample check: <code>=IF(SUMIFS(months_range,employee_id_range,this_employee_id)&gt;12,&quot;ERR003 MonthsSum&gt;12&quot;,&quot;OK&quot;)</code>.<br>Routing: map each error to responsible_team (HR, Payroll Ops, Finance, IT); validator can auto-open tickets for CRITICALs and attach error rows and workspace links.<br>Escalation automation: auto-escalate criticals older than SLA to managers and send daily digest to owners.<br>Include support for custom rule injection by IT under controlled mapping and require unit tests for each new rule. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Conversion Workflow — Operator Runbook (Expanded Step-by-Step with Artefact Names)</strong><br>Workspace creation: <code>{staging_root}/{YYYY}/{KPP}/{period}/{operator_ts}/</code> with subfolders <code>/raw/</code>, <code>/validation/</code>, <code>/calc_logs/</code>, <code>/bundles/</code>, <code>/archive/</code>.<br>Pre-run checklist (operator must tick):<br>1) copy raw_export to <code>/raw/</code> and set RO; record <code>sha256_raw</code> in <code>export_metadata.json</code>.<br>2) Run validator; save <code>validation_report.csv</code> to <code>/validation/</code>.<br>3) Append auto-fix summary to <code>change_ledger.csv</code> and open tickets for manual items.<br>4) Save <code>normalizer_log.csv</code>.<br>5) Run <code>calc_engine_v{calc_version}</code> and save calc_logs to <code>/calc_logs/</code>.<br>6) Apply mapping; save <code>mapping_applied.csv</code> and <code>xml_generated/</code>.<br>7) Run XSD validation and append results to <code>validation_report.csv</code>.<br>8) Assemble <code>acceptance_bundle_{kpp}_{period}.zip</code> in <code>/bundles/</code> and compute <code>bundle_sha256</code>.<br>9) Obtain signoffs and store SSO ids into <code>signoff_evidence/</code>.<br>10) Upload to staging; run smoke tests and save <code>staging_parse_summary.json</code>.<br>11) After signoffs & staging pass upload production and save <code>upload_response.json</code> in <code>/upload_log/</code>.<br>Operator notes: always run dry-run for header changes; maintain <code>last_successful_export.txt</code> pointer for idempotency checks; capture portal response screenshots and store in signoff evidence.<br>Include a troubleshooting quick reference for common errors and the CLI command examples (in operator doc) for reproducibility. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>calc_logs Structure & Extended Example (Fields, Trace, and Integrity)</strong><br>Store each calc_log as an individual canonical JSON file <code>{record_id}.json</code> inside <code>calc_logs/</code>.<br>Minimal schema: <code>record_id, employee_id, inputs, steps[], outputs, calc_version, rounding_rule_id, timestamp, operator_id, sha256</code>.<br>Design notes: <code>inputs</code> must include raw source values and normalized equivalents (e.g., monthly_gross_raw, monthly_gross_norm). <code>steps</code> is an ordered array with <code>name, formula_description, input_refs, output_value</code>.<br><code>outputs</code> contain canonical values used in XML (pph_annual, total_withheld, balance, component_allocations). <code>sha256</code> is computed over canonicalized JSON (consistent key ordering) to detect tampering.<br>Extended sample (single-line JSON example): <code>{&quot;record_id&quot;:&quot;r200&quot;,&quot;employee_id&quot;:&quot;E2002&quot;,&quot;inputs&quot;:{&quot;gross_A&quot;:90000000,&quot;gross_B&quot;:112000000,&quot;pension_total&quot;:1500000,&quot;prev_tax&quot;:0,&quot;ptkp_status&quot;:&quot;TK/0&quot;,&quot;conversion_rate&quot;:1},&quot;steps&quot;:[{&quot;step&quot;:&quot;cost_of_work_A&quot;,&quot;formula&quot;:&quot;MIN(5%*gross_A,prorata_plafon_A)&quot;,&quot;value&quot;:4500000},{&quot;step&quot;:&quot;cost_of_work_B&quot;,&quot;formula&quot;:&quot;MIN(5%*gross_B,prorata_plafon_B)&quot;,&quot;value&quot;:5600000},{&quot;step&quot;:&quot;total_biaya&quot;,&quot;value&quot;:10100000},{&quot;step&quot;:&quot;net_taxable&quot;,&quot;value&quot;:190400000},{&quot;step&quot;:&quot;apply_progressive&quot;,&quot;value&quot;:[{&quot;tier&quot;:&quot;0-60m&quot;,&quot;tax&quot;:3000000},{&quot;tier&quot;:&quot;60-136.4m&quot;,&quot;tax&quot;:11460000}]}],&quot;outputs&quot;:{&quot;pph_annual&quot;:14460000,&quot;total_withheld&quot;:12620000,&quot;balance&quot;:1840000},&quot;calc_version&quot;:&quot;v2.1&quot;,&quot;rounding_rule&quot;:&quot;rounding_rule_02&quot;,&quot;timestamp&quot;:&quot;2025-06-30T09:12:00&quot;,&quot;operator_id&quot;:&quot;payroll_op_01&quot;,&quot;sha256&quot;:&quot;calcsha256:abcd...&quot;}</code>.<br>Include step-level trace so auditors can reconstruct which formula and inputs produced each intermediate value.<br>Link calc_log entries to change_ledger items for any edited inputs.<br>Best practices: redact PII for public debugging and provide <code>calc_log_index.csv</code> for quick lookup (<code>record_id, employee_id, path, sha256</code>).<br>Provide tooling to re-run a single record with exact inputs and calc_version to reproduce sha256. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Change Ledger Policy and Examples (Auditable Edit Trail)</strong><br>Policy summary: <code>change_ledger</code> must be append-only, WORM-backed, and store <code>row_id, field, old_value, new_value, operator, ts, reason, approval_id, ticket_id(optional)</code>.<br>Automated normalizer entries use operator <code>normalizer_v{v}</code>.<br>Human edits require SSO <code>approval_id</code>.<br>High-risk edits (>3 fields changed) must trigger mandatory review ticket.<br>Example rows: <code>r102,NPWP_Penerima,01.234.567.8-901.234,012345678901234,normalizer_v1,2025-06-30T09:10:00,normalize_npwp,hr_approve_789,ticket_234</code> and <code>r203,NamaJabatan,&quot;Senior Vice President of Sales and Strategy&quot;,&quot;Senior Vice President of Sales and Strategy&quot;,manual,payroll02,2025-06-30T09:11:00,trim_to_50,payroll_mgr_22,ticket_235</code>.<br>Integrity measures: daily digest for <code>change_ledger</code> stored and signed with HSM; auditors verify digest chain.<br>Provide automated ledger exports in CSV and signed compressed archives for auditor ingestion. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Rounding Rules & Numeric Stability Policy (Examples & Implementation)</strong><br>Central policy: use <code>SafeRound(value, rounding_rule_id)</code> with explicit rounding rules in <code>rounding_rules.csv</code>.<br>Keep rounding rules consistent across calc_engine and payroll posting.<br>Example rules: <code>rounding_rule_01</code> — 0 decimals half-up (final tax numbers); <code>rounding_rule_02</code> — 0 decimals bankers rounding (deterministic); <code>rounding_rule_03</code> — 2 decimals half-up (FX conversion intermediate).<br>Guidelines: apply rounding only at defined aggregation points; prefer full internal precision and round only outputs written to XML or posted to GL.<br>Record <code>rounding_rule_id</code> in calc_log.<br>Unit-test edge midpoint cases (e.g., .5).<br>Ensure calc_engine and payroll posting use identical rounding routines to avoid reconciliation drift.<br>Maintain a test suite that covers rounding-rule permutations and report rounding deltas per golden-file run. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Spreadsheet Formulas & Helper Snippets (Paste-ready)</strong><br>Provide a <code>helpers</code> sheet in the template with paste-ready Excel formulas: Normalize NPWP: <code>=TEXTJOIN(&quot;&quot;,TRUE,IFERROR(MID(B2,ROW(INDIRECT(&quot;1:&quot;&amp;LEN(B2))),1)*1,&quot;&quot;))</code>.<br>Prorata cap: <code>=(plafon_tahunan/12)*months_in_period</code>.<br>Cost of work: <code>=MIN(0.05*total_gross, prorata_plafon)</code>.<br>Total gross (from monthly): <code>=monthly_gross*months_in_period + bonus + other_income</code>.<br>Consolidation check: <code>=IF(consol_total_gross=SUMIFS(employer_input[total_gross],employer_input[employee_id],this_employee_id),&quot;ok&quot;,&quot;mismatch&quot;)</code>.<br>NPWP length check: <code>=IF(LEN(npwp_norm)=15,&quot;ok&quot;,&quot;check_npwp&quot;)</code>.<br>Validation dashboard: pivot tables for error_counts per code per operator linked to <code>validation_report.csv</code>.<br>For Google Sheets include ARRAYFORMULA equivalents and an Apps Script export button to produce CSV for the validator.<br>Provide downloadable sample helper workbook and instruct operators to copy helpers into working file before running validator. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Extensive Worked Examples & Golden-File Scenarios (Full Numeric Walkthroughs)</strong><br>Maintain <code>golden_file_regression.xlsx</code> with annotated test cases.<br>Example 1 — Single employer full year: inputs monthly_gross=15,000,000; months=12; monthly_pension=100,000; PTKP TK/0=54,000,000; biaya_jabatan cap example 6,000,000 annual.<br>Steps: total_gross = 180,000,000; total_pension = 1,200,000; biaya_jabatan = MIN(0.05*180,000,000, cap) = 9,000,000; net = 169,800,000; PKP = 115,800,000; Tax layers 0–60m @5% = 3,000,000; remainder 55,800,000 @15% = 8,370,000; PPh annual = 11,370,000.<br>Example 2 — Mid-year mover with previous credits: Company A Jan–Jun monthly 15,000,000 → 90,000,000; Company B Jul–Dec monthly 17,000,000 + Nov bonus 10,000,000 → 112,000,000; total_gross_all = 202,000,000; total_pension = 1,500,000; total_biaya = 10,100,000 → net_taxable = 190,400,000 → PKP = 136,400,000 → PPh annual = 14,460,000.<br>Withholdings example: A withheld 4,500,000; B withheld 6,120,000 + 1,000,000 bonus withholding → total_withheld 11,620,000 → shortage = 2,840,000.<br>Ensure calc_log per record captures previous credits and withheld amounts.<br>Example 3 — Gross-up solver algorithm: find G where G - tax(G) = net_target using binary search with logs.<br>Example 4 — Pesangon partial exemption: pesangon 50,000,000; exemption 15,000,000 → taxable_pesangon 35,000,000; add to gross; recompute prorata biaya_jabatan; record exempt portion in calc_log.<br>Example 5 — Concurrent dual employment: collate incomes from multiple employers and compute annual PKP; final employer aggregates PKP and applies PTKP rules accordingly.<br>For each example attach expected <code>calc_log</code> sha256 and expected XML node values for automated comparison. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Golden-file Set (20+ Regression Scenarios)</strong><br>Maintain canonical scenarios with inputs and expected calc_log sha256 for regression:<br>1) single employer full-year.<br>2) mid-year mover (previous credits).<br>3) multiple moves (>2).<br>4) gross-up net target.<br>5) pesangon with exemptions.<br>6) pesangon installments.<br>7) WNA with treaty.<br>8) foreign currency income with FX variance.<br>9) missing NPWP placeholder.<br>10) long job titles trimmed.<br>11) duplicate NPWP across two employee IDs.<br>12) pesangon legal exemption.<br>13) high bonus causing tax bracket jump.<br>14) zero income with allowances.<br>15) split payments across months.<br>16) corrections after staging parse.<br>17) header template change detection.<br>18) branch NPWP vs headquarter NPWP differences.<br>19) negative corrections (retro refund).<br>20) deceased employee final settlement.<br>21) employer bankruptcy with missing prev-1721.<br>Store golden-file inputs, expected calc_log outputs, and expected XML node snippets for automated comparison.<br>Automate nightly regression runs and publish <code>regression_dashboard.html</code> with pass/fail per scenario. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Extended Validation Report Catalog — Error Codes, Severity & Remediation</strong><br>Provide <code>errors_catalog.csv</code> mapping codes to severity, remediation steps, and owner team.<br>Sample lines:<br><code>ERR001,Invalid NPWP,CRITICAL,normalize_non_digits; if length !=15 open HR ticket,HR Data Team</code>.<br><code>ERR002,Missing NIK,CRITICAL,request KTP upload,HR Admin</code>.<br><code>ERR003,MonthsSum&gt;12,CRITICAL,correct months_in_period &amp; investigate overlaps,Payroll Lead</code>.<br><code>ERR004,GrossUpMissingCalcLog,CRITICAL,rerun gross-up engine &amp; attach calc_log,Payroll Ops</code>.<br><code>ERR005,XSD MissingNode,CRITICAL,update mapping or fill mandatory node,IT/Mapping Owner</code>.<br><code>WARN001,JobTitleTooLong,WARNING,trim to 50 &amp; attach full title,Payroll Ops</code>.<br><code>WARN002,ComponentHighVariance,WARNING,manual review for miscoding,Payroll Manager</code>.<br>Maintenance: update <code>errors_catalog.csv</code> when validator rules change and require owner assignment for each code.<br>Include remediation playbook links per error code and automated ticket templates for each remediation. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>UAT & Regression Plan (Test Matrix & Acceptance Criteria)</strong><br>Test artefacts: <code>test_cases.xlsx</code>, <code>test_results.csv</code>, <code>defect_log.tsv</code>.<br>Representative tests:<br>1) TC001 Single Employer Full Year (run validator → calc_engine → XML → compare calc_log sha256 with golden).<br>2) TC002 Mid-year mover with PreviousNoBukti.<br>3) TC003 Gross-up solver (net target matched within tolerance).<br>4) TC004 WNA passport required.<br>5) TC005 Pesangon exemption annotated in calc_log.<br>6) TC006 Header change detection triggers mapping_diff.<br>7) TC007 Duplicate NPWP detection.<br>8) TC008 FX conversion records conversion_rate.<br>Acceptance criteria: all test cases pass in staging; golden-file calc_log sha256 matches; failures logged as defects with repro steps; priority fixes validated before production.<br>Test automation: integrate with CI/CD to run regression on mapping changes; require signoff before mapping promotion.<br>Maintain <code>uat_runbook.md</code> with step-by-step UAT execution instructions. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Troubleshooting Playbook (Operator Action Lists for Common Incidents)</strong><br>Mass invalid NPWP: run normalizer → re-run validator → export <code>npwp_issue_list.csv</code> for HR batch request (columns: row_id, employee_id, problem_value, required_doc) → open HR ticket SLA 5 business days → log actions in change_ledger.<br>Gross-up mismatch vs payslip: compare calc_version and rounding_rule_id between calc_logs and payroll system; if mismatch re-run calc_engine with matching calc_version and rounding; log delta and reissue bundle if required.<br>Portal ERR_LAYOUT/template mismatch: fetch <code>template_sha256</code> from portal, diff headers with local mapping (<code>mapping_diff.csv</code>), update mapping_version and run regression.<br>GL vs export discrepancy beyond material threshold: reconcile SSP batches, check posting dates, unposted SSP, missing prev employer credits; escalate to Finance Controller with <code>reconciliation_issue_report.csv</code>.<br>Production parse failure after staging pass: collect <code>upload_response.json</code>, <code>staging_parse_summary</code>, sample failing rows; open incident with portal support and prepare <code>amend_bundle</code> including explanation & approvals.<br>Provide a decision tree PDF for operator escalation paths and contact list for portal support. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>API & ETL Integration Recommendations (Contract-Level Details)</strong><br>Recommended endpoints and behavior:<br>1) <code>POST /api/employee/{id}/prev-employer-entry</code> — accepts multipart (file + metadata) → returns <code>{entry_id, checksum, status}</code>.<br>2) <code>POST /api/exports</code> — upload bundle → returns <code>{export_id, parse_summary}</code> and support polling <code>GET /api/exports/{export_id}/status</code>.<br>Idempotency: accept <code>bundle_checksum</code> header and return 409 for duplicates.<br>Security: mutual TLS + API key + JWT for operator_id; log operator_id, calc_version, validator_version in requests.<br>Responses must include parse counts <code>{records_processed, criticals, warnings, parse_errors[]}</code> and sample paths to failing rows.<br>ETL notes: use incremental export jobs with <code>export_metadata.json</code> and <code>bundle_sha256</code> to detect duplicates and enable safe retries.<br>Provide webhooks for parse-complete events to trigger downstream reconciliation.<br>Include example contract clauses for SLA, error handling, and data retention in the API SLA annex. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>RACI, Escalation & Communication Templates (Copy-Ready)</strong><br>RACI examples:<br>1) Request 1721 issuance — Responsible: HR; Accountable: HR Lead; Consulted: Payroll; Informed: Employee.<br>2) Acceptance bundle — Responsible: Payroll; Accountable: Payroll Manager; Consulted: IT/Mapping Owner, Tax; Informed: Finance Controller.<br>Escalation timeline for missing 1721: Day 3 automated reminder; Day 7 escalate to HR Manager; Day 14 escalate to Finance Controller; Day 21 advise employee to claim via SPT and log attempts as evidence.<br>Email templates (copy-ready):<br>Subject: <code>Request for Issuance of PPh 21 Withholding Form (1721-A1) — [Employee Name]</code>.<br>Body: <code>Dear Payroll [Previous Company], I, the undersigned: Name: [Employee Name] NPWP: [NPWP if available] Termination Date: [DD/MM/YYYY] Request issuance and delivery of Form 1721-A1 for the employment period up to termination. Please send softcopy to [new employer payroll email] or upload to internal HR portal. Thank you. Sincerely, [Employee Name]</code>.<br>Employee reconciliation notice (short):<br>Subject: <code>PPh21 Reconciliation Result Year [YYYY] — [Name]</code>.<br>Body: <code>Summary: PKP [PKP], Annual Tax [PPhAnnual], Total Withheld [TotalWithheld], Shortage/(Overpaid) [Balance]. Please confirm within 7 business days.</code>.<br>Provide editable templates in DOCX and plain-text formats in <code>signoff_templates/</code>. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>SLAs, KPIs & Monitoring (Targets & Dashboard Items)</strong><br>Targets: previous employer issuance of 1721 ≤ 7 business days; verification & upload by new employer ≤ 3 business days; critical validation resolution ≤ 3 business days; acceptance bundle signoff cycle ≤ 2 business days.<br>KPI monitoring: % new joiners with 1721 by day-1 (target ≥95%); % XLSX auto-parse success (target ≥90%); UAT pass rate ≥95%; average critical fix time ≤3 days.<br>Dashboard panels include: <code>exports_this_month</code>, <code>criticals_this_month</code>, <code>avg_fix_time_criticals</code>, <code>acceptance_bundles_pending_signoff</code>, <code>staging_parse_failure_rate</code>, <code>golden_file_regression_pass_rate</code>, <code>npwp_unresolved_count</code>, <code>top_10_error_types</code>.<br>Alerts: if critical_count > 0 create incident for payroll_team; if staging_parse_failure_rate > 5% escalate to IT.<br>Provide sample Grafana/PowerBI dashboard specs and SQL queries for each KPI. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Audit Checklist (Per-Employee Audit Package Requirements)</strong><br>For each employee who moved during the year auditors require:<br>1) 1721-A1/A2 + checksum + verifier initials.<br>2) monthly payslip links.<br>3) SSP/transfer proofs.<br>4) cumulative calculation memo + approval signature.<br>5) calc_logs per row + sha256.<br>6) change_ledger extract covering manual edits.<br>7) acceptance bundle + bundle_sha256 + upload_response.<br>Provide per-employee audit package as downloadable ZIP with <code>manifest.txt</code> listing files and checksums.<br>Batch-level audit packs must include the acceptance bundle and upload logs, plus signoff evidence.<br>Provide automated audit-pack generator that produces per-employee and batch packages with encryption and access controls for auditors. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Training, Rollout & 90-Day Implementation Roadmap (Owners & Deliverables)</strong><br>Day 0–30 (Governance & Quick Wins): update onboarding checklist to require 1721 field; create <code>template_reconciliation.xlsx</code> and publish <code>field_spec</code>.<br>Day 31–60 (System & Testing): IT implements mapping fields & upload API; QA prepares golden-file regression and test suite.<br>Day 61–90 (UAT & Rollout): run UAT with 50 scenarios; remediate and finalize SOP; deliver training sessions and publish SOP + quick cards.<br>Deliverables: <code>validators.json</code>, <code>mapping_v1</code>, <code>calc_version registry</code>, golden-file test results, SOP, training slides.<br>Owners: HR Lead, Payroll Lead, IT Lead, QA Lead.<br>Include a training plan (materials, instructors, hands-on labs) and a signoff checklist for go-live readiness. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Advanced Edge Cases & Legal Notes (Operational Guidance)</strong><br>Previous employer bankrupt/closed: record attempt history (emails, phone logs); advise employee to claim via SPT; log escalation in manifest.<br>Non-resident & treaty claims: require residency documents; consult tax counsel; annotate manifest with treaty article and counsel reference.<br>Late NPWP issuance by employee: support retro credit via re-reconciliation; if refund already paid compute reclaim per internal policy; obtain employee written consent.<br>Amended uploads: include <code>amend_flag</code> in XML, explanation, and approvals; coordinate amendments with tax authority guidance.<br>All exceptions must be documented in manifest notes and signed off by Tax Lead.<br>Maintain an exceptions register and require quarterly review by Compliance. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Mapping CSV Sample & Mapping Diff Handling</strong><br>Example mapping CSV rows:<br><code>npwp_pemotong,NPWP_Pemotong,yes,string,normalize_digits,remove punctuation</code>.<br><code>employee_id,EmployeeID,yes,string,none,primary key</code>.<br><code>monthly_gross,PenghasilanBulanan,conditional,number,none,if monthly provided</code>.<br><code>previous_tax,PreviousTax,no,number,none,credit from previous employer</code>.<br>When portal template changes are detected (via <code>template_sha256</code>) generate <code>mapping_diff.csv</code> with <code>column_name,status,action_required</code> and store new mapping in <code>mapping_archive/</code> with versioning.<br>Run full regression against golden-files after mapping change and require signoff before production.<br>Maintain <code>mapping_change_log.csv</code> with author, rationale, and regression results. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Errors Catalog (Detailed) & Owner Contact List</strong><br><code>ERR001 Invalid NPWP</code> — CRITICAL — remediation: normalize → HR request if mismatch remains — owner: HR Data Team.<br><code>ERR002 Missing NIK</code> — CRITICAL — remediation: request KTP — owner: HR Admin.<br><code>ERR003 MonthsSum&gt;12</code> — CRITICAL — remediation: correct months_in_period & investigate overlaps — owner: Payroll Lead.<br><code>ERR004 GrossUpMismatch</code> — CRITICAL — remediation: re-run calc engine with matching calc_version — owner: Payroll.<br><code>WARN001 JobTitleTooLong</code> — WARNING — remediation: trim & attach full title — owner: Payroll Ops.<br><code>WARN002 UnusualComponentHigh</code> — WARNING — remediation: manual review — owner: Payroll Manager.<br>Maintain <code>owners.yml</code> contact directory with names and functional emails for auto-assignment.<br>Include escalation phone numbers and response SLAs in <code>owners.yml</code>. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Practical Operator Checklists (Compact, Printable)</strong><br>Pre-conversion checklist (copy-paste):<br>1) raw_export saved + sha256.<br>2) Run validator → criticals = 0.<br>3) Normalization logged.<br>4) Run calc engine → calc_logs saved.<br>5) Mapping validated.<br>6) XML generated & XSD validated.<br>7) Bundle assembled + bundle_sha256.<br>8) HR/Payroll/Tax signoffs collected.<br>9) Staging upload & parse success.<br>10) Production upload scheduled.<br>Use this checklist as gate control UI so operators must tick boxes and append SSO event ids before next gate opens.<br>Provide printable one-page quick checks and a laminated operator cheat-sheet for shift desks. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Signoff Evidence & Manifest Requirements (What to Capture)</strong><br>Signoff evidence must include SSO audit event id, approver_id, timestamp, rationale, and attached screenshot/digital signature where possible.<br>Example evidence entry: <code>{approval_id: &quot;payroll_456&quot;, approver_name: &quot;Payroll Lead&quot;, ts: &quot;2025-06-30T09:20:00&quot;, evidence: &quot;sso_event_20250630_789&quot;}</code>.<br>Include these IDs in manifest approvals field.<br>Signoff metadata must be part of bundle and indexed in <code>upload_log.csv</code>.<br>Ensure signoff evidence files are tamper-evident and linkable to SSO logs; prefer HSM-signed attestations for high-risk bundles. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Appendices & Artefacts List (Repo File Inventory)</strong><br>Repo files to include and maintain with owners: <code>template_reconciliation.xlsx</code> (Payroll Lead), <code>golden_file_regression.xlsx</code> (QA), <code>validators.json</code> (IT/QA), <code>mapping_v{date}.csv</code> (IT/Mapping Owner), <code>calc_engine_v{version}.md</code> (Payroll Ops), <code>errors_catalog.csv</code> (Payroll Ops), <code>signoff_templates.docx</code> (HR), <code>manifest_template.txt</code> (IT), <code>change_ledger_policy.md</code> (Compliance), <code>calc_log_schema.json</code> (IT), <code>owners.yml</code> (Admin).<br>Keep README with usage, owners, and contact points.<br>Add a <code>release_notes/</code> folder with mapping/calc/validator change records and maintain semantic versioning for calc_engine and validator. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Final Quick-Start Checklist (Operator Copy-Paste)</strong><br>1) Export raw → compute sha256 → store raw copy.<br>2) Run validator → resolve CRITICALs.<br>3) Normalize → log in change_ledger.<br>4) Run calc engine → save calc_logs.<br>5) Map to XML → run XSD check.<br>6) Assemble acceptance bundle → compute bundle_sha256.<br>7) Obtain signoffs: HR, Payroll, Tax (SSO evidence).<br>8) Upload staging → run smoke tests.<br>9) If pass → upload production.<br>10) Archive bundle & update upload_log.<br>Keep one cold-start example in repo for auditors.<br>Provide a minimal runnable checklist file <code>operator_checklist.csv</code> that operators can mark and attach SSO ids. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Offer of Artefacts Delivery (On-Request Deliverables)</strong><br>Available deliverables on request:<br>1) printable pre-upload checklist (PDF);<br>2) anonymized sample XLSX (5–20 rows) with validation flags & corrected output; <br>3) Power Query (M) skeleton for normalization & mapping; <br>4) Python (pandas) validation & export skeleton (normalize → validate → map → export) including unit tests for golden-file scenarios; <br>5) <code>errors_catalog.csv</code> (codes, severity, remediation).<br>Provide <code>KPP</code> code + <code>calc_version</code> to receive tailored artefacts.<br>Include packaged deliverables with README and minimal usage examples. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Contact & Escalation Quick List (Copy-Ready)</strong><br><code>Role | Name | Email | Escalation order</code> — <code>Payroll Lead | [name] | payroll@company.internal | 1</code> — <code>HR Lead | [name] | hr@company.internal | 2</code> — <code>Finance Controller | [name] | finance@company.internal | 3</code>.<br>Keep <code>owners.yml</code> updated and referenced by the validator for auto-assignment.<br>Include a backup on-call rotation calendar and a Slack channel webhook for incident notifications. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Closing Operational Note (Must-Do Before First Production Run)</strong><br>Before the first production upload ensure <code>calc_version</code> & <code>validator_version</code> are registered in the repo, golden-file regression passed, and audit package creation script tested end-to-end (bundle assembly, sha256, upload_log entry).<br>Record one full sample cycle as a cold-start example for auditors including raw_export, validation_report, change_ledger, calc_logs, manifest, signoff evidence and upload_response.<br>Confirm retention & access controls are provisioned, perform a restore test for archive retrieval, and obtain final executive signoff recorded with SSO evidence. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>ADDITIONAL EXAMPLES — Expanded Worked Examples & Samples (NEW)</strong><br>Purpose: provide more concrete, copy-paste ready examples for operators, testers, and auditors. These are additive and do not replace existing examples. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>A. Additional Worked Example — Gross-up Detailed Trace (Full Calc_Log Example)</strong><br>Context: Employee requests net payout IDR 10,000,000 grossed-up. Solver should find gross G such that <code>G - tax(G) = net_target</code>.<br>Inputs (example): <code>net_target: 10000000, months: 1, PTKP: TK/0, conversion_rate:1, calc_version:v3.0, rounding_rule:rounding_rule_01</code>.<br>Iteration trace (example calc_log.steps):<br>1) <code>iteration_no:1, guess_gross:11500000, tax_guess:850000, net_after_tax:10650000, diff:650000</code>.<br>2) <code>iteration_no:2, guess_gross:11250000, tax_guess:800000, net_after_tax:10450000, diff:450000</code>.<br>3) <code>iteration_no:3, guess_gross:11000000, tax_guess:760000, net_after_tax:10240000, diff:240000</code>.<br>4) <code>iteration_no:4, guess_gross:10800000, tax_guess:720000, net_after_tax:10080000, diff:80000</code>.<br>5) <code>iteration_no:5, guess_gross:10720000, tax_guess:704000, net_after_tax:10016000, diff:16000</code>.<br>6) <code>iteration_no:6, guess_gross:10704000, tax_guess:703040, net_after_tax:10000960, diff:960</code>.<br>7) <code>iteration_no:7, guess_gross:10703360, tax_guess:703027, net_after_tax:10000333, diff:333</code>.<br>8) convergence at tolerance 1 IDR → final <code>gross_g = 10,703,327</code> (example), record final <code>outputs</code> including <code>pph_annual</code>, <code>total_withheld</code>, <code>balance</code> and full <code>steps[]</code> with formulas and references.<br>Store calc_log: <code>calc_logs/grossup_r501.json</code> with canonical keys and sha256. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>B. Additional Worked Example — Multi-currency Income with FX Reconciliation</strong><br>Scenario: Employee receives salary in USD for 3 months and IDR for remaining months. Need FX conversion record, variance tolerance, and GL posting instructions.<br>Inputs example: <code>monthly_gross_usd=2,000 USD for 3 months</code>, <code>monthly_gross_idr=15,000,000 for 9 months</code>, <code>fx_rate_snapshot = [2025-01-31: 15000, 2025-02-28:14950, 2025-03-31:15100]</code>.<br>Processing:<br>1) Convert per-month using monthly <code>conversion_rate</code> and record <code>fx_source</code> and <code>fx_ts</code> in calc_log inputs.<br>2) For variance > 0.5% vs nightly treasury average, flag <code>WARN_FX_VARIANCE</code> with <code>suggested_fix: use averaged rate or attach treasury approval</code>.<br>3) Capture <code>fx_gain_loss</code> node in calc_log outputs for GL reconciliation. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>C. Additional Worked Example — Retroactive Correction (Negative Adjustment)</strong><br>Scenario: Employee had retro pay reduction of IDR 2,500,000 applied to previous period; validator must create correction row with <code>Negative</code> flag and maintain link to original row.<br>Processing:<br>1) Create <code>correction_row</code> with <code>original_row_id</code> and negative <code>PenghasilanBruto</code> value.<br>2) Validator classifies as <code>CRITICAL</code> if <code>months_total &gt; 12</code> after correction.<br>3) Calc_engine logs <code>reversal_reference</code> in calc_log and generates <code>reconciliation_instructions.md</code> for Finance. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>D. Sample XML Snippet (Canonical, Pretty and Canonical SHA)</strong><br>Pretty XML (human readable) example for employee <code>E1001</code>:<br><code>&lt;BuktiPemotongan&gt;</code><br>&nbsp;&nbsp;<code>&lt;NPWP_Pemotong&gt;012345678901234&lt;/NPWP_Pemotong&gt;</code><br>&nbsp;&nbsp;<code>&lt;Employee&gt;</code><br>&nbsp;&nbsp;&nbsp;&nbsp;<code>&lt;EmployeeID&gt;E1001&lt;/EmployeeID&gt;</code><br>&nbsp;&nbsp;&nbsp;&nbsp;<code>&lt;Nama&gt;Adi Santoso&lt;/Nama&gt;</code><br>&nbsp;&nbsp;&nbsp;&nbsp;<code>&lt;PenghasilanBruto&gt;15000000&lt;/PenghasilanBruto&gt;</code><br>&nbsp;&nbsp;&nbsp;&nbsp;<code>&lt;PPhTahunan&gt;11370000&lt;/PPhTahunan&gt;</code><br>&nbsp;&nbsp;<code>&lt;/Employee&gt;</code><br><code>&lt;/BuktiPemotongan&gt;</code><br>Canonical XML: remove whitespace and normalize attribute order, then compute <code>sha256</code> of canonical bytes and store in <code>xml_canonical/E1001.xml.sha256</code>. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>E. Sample calc_log Full JSON (Illustrative, redacted PII)</strong><br><code>{ &quot;record_id&quot;:&quot;r501&quot;, &quot;employee_id&quot;:&quot;E1001&quot;, &quot;inputs&quot;:{ &quot;monthly_gross&quot;:15000000, &quot;months&quot;:12, &quot;ptkp&quot;:&quot;TK/0&quot;, &quot;pension_total&quot;:1200000 }, &quot;steps&quot;:[ {&quot;step&quot;:&quot;agg_gross&quot;,&quot;formula&quot;:&quot;monthly_gross*months&quot;,&quot;value&quot;:180000000},{&quot;step&quot;:&quot;pension&quot;,&quot;formula&quot;:&quot;monthly_pension*months&quot;,&quot;value&quot;:1200000},{&quot;step&quot;:&quot;biaya_jabatan&quot;,&quot;formula&quot;:&quot;MIN(0.05*agg_gross, plafon)&quot;,&quot;value&quot;:9000000}, {&quot;step&quot;:&quot;net_taxable&quot;,&quot;formula&quot;:&quot;agg_gross - pension - biaya_jabatan - ptkp&quot;,&quot;value&quot;:115800000} ], &quot;outputs&quot;:{&quot;pph_annual&quot;:11370000,&quot;total_withheld&quot;:11000000,&quot;balance&quot;:370000}, &quot;calc_version&quot;:&quot;v2.1&quot;,&quot;rounding_rule_id&quot;:&quot;rounding_rule_01&quot;,&quot;timestamp&quot;:&quot;2025-06-30T09:12:00&quot;,&quot;operator_id&quot;:&quot;payroll_op_01&quot;,&quot;sha256&quot;:&quot;calcsha256:...&quot; }</code> </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>F. Additional Golden-file Scenarios (Extra 12 Cases to Add to Set)</strong><br>Add these to the canonical regression suite:<br>22) Employee with frequent FX salary adjustments (monthly variable FX) — expects <code>fx_variance</code> warnings.<br>23) Employee with split employment days in month (prorated months fractional handling) — tests month proration rules.<br>24) Employee with multiple small bonuses triggering bracket jump — tests progressive bracket boundary rounding.<br>25) Employee with tax treaty credit and treaty article annotation — tests non-resident flows.<br>26) Employee with late NPWP supplied after production and reclaim flow — tests amend_bundle processes.<br>27) Employee with employer-paid benefits (health) requiring tax treatment discrimination — tests component classification.<br>28) Employee with pesangon paid in installments across months — tests exposé of exemption across installments.<br>29) Employee with negative corrections exceeding threshold — triggers special audit workflow.<br>30) Employee with duplicate NIK across subsidiaries — tests dedup detection and owner routing.<br>31) High-risk manual edit simulation (>5 fields changed) — must produce secondary review flag.<br>32) Header template change mid-run with fallback mapping — tests mapping_diff handling and regression.<br>33) Massive file >1M rows chunked import with manifest parts — tests chunked export and recombination. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>G. Additional Mapping Transform Examples (Function Samples)</strong><br>Provide ready transforms to include in mapping CSV <code>transform</code> column:<br><code>normalize_digits</code> — remove non-digits.<br><code>pad_left(15,&#x27;0&#x27;)</code> — pad numeric string to fixed length.<br><code>concat(field1,&#x27; &#x27;,field2)</code> — concatenation.<br><code>if(empty(field), default(&#x27;UNKNOWN&#x27;), field)</code> — conditional default.<br><code>regex_replace(field,&quot;[^0-9A-Za-z ]&quot;,&quot;&quot;)</code> — safe string normalize.<br><code>currency_to_integer(field, decimals)</code> — parse "15.000.000,00" to integer cents.<br><code>fx_convert(field, rate_field)</code> — conversion using provided rate field and recording conversion metadata. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>H. Additional Spreadsheet Helpers & Excel Snippets</strong><br>Extra paste-ready formulas:<br>1) Extract digits and pad NPWP: <code>=TEXT(TEXTJOIN(&quot;&quot;,TRUE,IFERROR(MID(A2,ROW(INDIRECT(&quot;1:&quot;&amp;LEN(A2))),1)*1,&quot;&quot;)),REPT(&quot;0&quot;,15))</code>.<br>2) Months proration: <code>=ROUND((PERIOD_END - PERIOD_START + 1)/30 * 12, 2)</code> (adjust per business rule).<br>3) Component sum tolerance check: <code>=IF(ABS(PenghasilanBruto - SUM(component_range))&lt;=2,&quot;OK&quot;,&quot;ERR_COMP_MISMATCH&quot;)</code>.<br>4) FX weighted average rate: <code>=SUMPRODUCT(amount_range,rate_range)/SUM(amount_range)</code>.<br>5) Conditional header mapping detect: <code>=IF(COUNTIF(header_row,&quot;NPWP_Pemotong&quot;)=0,&quot;HEADER_MISMATCH&quot;,&quot;OK&quot;)</code>. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>I. Additional Error Codes & Remediation Templates (Expanded)</strong><br><code>ERR006,FXVarianceHigh,WARNING,review_fx_rates; attach treasury_approval,Finance Treasury</code>.<br><code>ERR007,DuplicateNIKAcrossBranches,ERROR,investigate_duplicate_nik &amp; reconcile IDs,HR Data Team</code>.<br><code>ERR008,NegativeCorrectionExceedsThreshold,CRITICAL,open audit ticket &amp; attach approval,Compliance</code>.<br><code>ERR009,TemplateHeaderMismatch,CRITICAL,block mapping &amp; request portal template,IT/Mapping Owner</code>.<br><code>ERR010,CalcEngineVersionMismatch,ERROR,rerun with matching calc_version or set calc_version header,Payroll Ops</code>.<br>Provide automated ticket templates for each (copy-ready) and add playbook links. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>J. Additional API Contract Examples (Full Request/Response Samples)</strong><br>Example <code>POST /api/exports</code> request (multipart):<br>Headers:<br><code>Authorization: Bearer {token}</code><br><code>Content-Type: multipart/form-data; boundary=...</code><br>Body parts:<br>1) <code>file</code> — acceptance_bundle_{kpp}_{period}.zip<br>2) <code>export_metadata</code> — JSON block with operator_id, calc_version, validator_version, bundle_sha256.<br>Response (200):<br><code>{ &quot;export_id&quot;:&quot;exp_20250630_001&quot;,&quot;parse_summary&quot;:{&quot;records_processed&quot;:1200,&quot;criticals&quot;:0,&quot;warnings&quot;:3},&quot;staging_url&quot;:&quot;https://portal.example/parse/exp_20250630_001&quot; }</code>.<br>Response (409 duplicate):<br><code>{ &quot;error&quot;:&quot;duplicate_bundle&quot;,&quot;bundle_sha256&quot;:&quot;...&quot;,&quot;existing_export_id&quot;:&quot;exp_20250531_045&quot; }</code>. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>K. Additional Troubleshooting Scenarios & Operator Action Lists</strong><br>1) Staging parse reports <code>XSD MissingNode</code> only for records with long job titles — Action: run mapping preprocessor to split long title into <code>NamaJabatan</code> + <code>NamaJabatanFullAttachment</code>, regenerate XML sample and re-run XSD.<br>2) Bulk NPWP normalization fails on special characters from a third-party payroll system — Action: run <code>regex_replace</code> transform and re-validate; open ticket to vendor asking for encoding export fix (include sample failing values).<br>3) Portal returns parse success but GL reconciliation mismatch — Action: sample 100 highest-value employees, compare calc_log outputs vs portal calculation nodes, escalate with <code>reconciliation_issue_report.csv</code>. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>L. Sample CLI Commands (Operator Examples)</strong><br>Validate file:<br><code>bpa-validator --input raw_export.xlsx --out /workspace/validation/ --strict</code>.<br>Run calc (dry-run):<br><code>calc-engine --input /workspace/validation/validated.csv --version v3.0 --dry-run --out /workspace/calc_logs/</code>.<br>Generate bundle:<br><code>bundle-maker --xml /workspace/xml_canonical/ --metadata export_metadata.json --out /workspace/bundles/acceptance_bundle_kpp_period.zip</code>.<br>Upload to staging (curl example):<br><code>curl -X POST -H &quot;Authorization: Bearer $TOKEN&quot; -F &quot;file=@acceptance_bundle.zip&quot; -F &quot;export_metadata=@export_metadata.json&quot; https://api.portal.example/api/exports</code>.<br>Compute sha256 in Linux:<br><code>sha256sum acceptance_bundle.zip &gt; acceptance_bundle.zip.sha256</code>. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>M. Additional Email Templates & Communication Snippets (Copy-Ready)</strong><br>1) Signoff request to Tax Lead:<br>Subject: <code>Signoff Request: Acceptance Bundle {kpp} {period}</code><br>Body: <code>Attached acceptance_bundle_{kpp}_{period}.zip (sha256: {bundle_sha256}). Please review calc_summary and validation_report; kindly provide SSO signoff by EOD {date}.</code>.<br>2) Staging failure notice to IT:<br>Subject: <code>URGENT: Staging Parse Failure {export_id}</code><br>Body: <code>Staging returned parse errors: {errors_count}. Attached staging_failure_report.json and sample failing rows. Please triage.</code>. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>N. Additional Audit Example — Per-Employee Package Manifest (Sample)</strong><br><code>manifest.txt</code> sample for employee E1001:<br><code>/calc_logs/r501.json sha256: abc...</code><br><code>/xml_canonical/E1001.xml sha256: def...</code><br><code>/signoff_evidence/payroll_signoff_E1001.pdf sha256: ghi...</code><br><code>/attachments/payslip_2025-01.pdf sha256: jkl...</code>.<br>Audit package produced as encrypted ZIP with manifest and per-file sha256. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>O. Extra Operational Checklists (Shift Handover Copy-Paste)</strong><br>Shift handover quick list:<br>1) Verify <code>last_successful_export.txt</code> timestamp.<br>2) Confirm <code>bundle_registry.csv</code> latest status.<br>3) Review <code>validation_summary.json</code> for new criticals.<br>4) Ensure <code>backup_tests/restore_test_result.txt</code> is green for last 6 months.<br>5) Handover notes: list pending AMEND bundles and owners. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>P. Additional Governance Examples — Signoff Matrix Sample</strong><br>Signoff matrix snippet:<br><code>Step: Assembly</code> — Responsible: Payroll Operator — Accountable: Payroll Manager — Required evidence: manifest + calc_summary.<br><code>Step: Tax Review</code> — Responsible: Tax Analyst — Accountable: Tax Lead — Required evidence: calc_qc_report + sample calc_logs.<br><code>Step: Upload</code> — Responsible: IT Ops — Accountable: IT Manager — Required evidence: staging_parse_summary + upload_response. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Q. Addenda — Tooling & Automation Snippets</strong><br>Suggested automation tasks to add to repo (copy-ready descriptions):<br>1) <code>golden_regression_runner</code> — nightly job that runs golden-file scenarios and emits <code>regression_dashboard.html</code>.<br>2) <code>bundle_auditor</code> — verifies bundle sha256, signs manifest with HSM, and moves to cold storage after retention period.<br>3) <code>validator_rule_tester</code> — small harness to run unit tests for newly added validator rules before merging. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>R. How to Add These New Examples to Repo</strong><br>Recommended file layout additions:<br>1) <code>/examples/grossup_traces/grossup_r501.json</code> — add solver traces.<br>2) <code>/examples/xml_samples/E1001_pretty.xml</code> and <code>/examples/xml_samples/E1001_canonical.xml</code>.<br>3) <code>/examples/cli_samples/README.md</code> — include the CLI commands shown above.<br>4) <code>/examples/golden_extra.xlsx</code> — append scenarios 22–33 with expected calc_log sha256. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>S. Final Notes on Expansion</strong><br>This expansion is additive: nothing in the existing single-column document has been removed or reduced. The new sections labeled A–R provide additional concrete examples, templates, and operational artefacts intended for immediate copy-paste use in test suites, operator runbooks, and audit packs.<br>If you want this written into separate files (examples workbook, JSON examples, or CLI scripts) I can generate them as downloadable artefacts in the current session — specify which artefacts you want first and I will produce them. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>World-Class Enhancements — Elevating the Complete Guide to a Global Standard (additive sections)</strong><br><strong>Executive TL;DR (1-page «what, why, outcomes, metrics»)</strong><br>What: a hardened, auditable, fully automated BPA1 → XML pipeline delivering deterministic tax calculations, full artefact lineage, and auditable signoff for regulatory upload.<br>Why: reduce portal rejects, eliminate manual rework, ensure deterministic reproducibility, and shorten time-to-compliance to SLA ≤ 3 business days for critical issues.<br>Outcomes (measurable): staging parse failure rate <1%, golden-file regression pass ≥99.5%, mean-time-to-fix (critical) ≤ 24 hours, bundle reproducibility (sha256) = 100% across environments. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Governance & Maturity Model (Level 0 → 4)</strong><br>Level 0 — ad hoc: manual exports, no versioning.<br>Level 1 — repeatable: scripted validator, manual signoff logs.<br>Level 2 — defined: standardized artefacts, mapping versioning, automated validation with tickets.<br>Level 3 — managed: automated calc engine, CI regression, RBAC + MFA + HSM signing, SLA monitoring.<br>Level 4 — optimized (world-class): full CI/CD with automated golden-file regression before any mapping/calc change, immutable signed bundles, automated reconciliation to GL, SRE-style runbooks and post-incident reviews, quarterly external audit. Recommend target: achieve Level 3 within 90 days, Level 4 within 6–12 months. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Target Operating Model (People, Process, Platform)</strong><br>People: define RACI per gate; create Roles: Export Operator, Validator Owner, Mapping Owner, Calc Owner, Release Manager, On-call SRE; maintain <code>owners.yml</code> and on-call rota.<br>Process: codify gates as automated pipelines with gate artifacts required to proceed; enforce signoffs via SSO + MFA; automated ticketing for CRITICALs.<br>Platform: containerized validator & calc (Docker), artifact repo (object storage), HSM for signing, CI pipeline (e.g., :contentReference[oaicite:0]{index=0} / :contentReference[oaicite:1]{index=1}), monitoring stack (e.g., :contentReference[oaicite:2]{index=2}, :contentReference[oaicite:3]{index=3}). </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Reference Architecture (Components & Data Flows)</strong><br>Layers: Ingest (SFTP/portal export) → Validation/Normalization → Calc Engine (deterministic) → Mapping/Transformer → XML Builder → Bundle Assembler → Staging/Production Upload. Add Observability bus (event logs) and Audit Store (immutable archive).<br>Key integrations: SSO (for signoffs), Ticketing (creates tickets automatically), Object Storage (versioned buckets), HSM for signing manifests, Portal API (staging & production). </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Security & Compliance Enhancements</strong><br>Controls: AES-256 at rest, TLS 1.2+ (prefer TLS 1.3), mutual TLS for API, client certs for server-to-server, HSM-signed manifests, strict RBAC and time-limited access tokens, centralized secrets (vault).<br>Standards mapping: implement controls aligned to :contentReference[oaicite:4]{index=4} controls (access control, cryptographic controls, change management) and produce an audit trace for each control. Perform annual external penetration test and quarterly vulnerability scans. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Observability, Logging & Integrity Monitoring</strong><br>Implement structured logging (JSON) for all pipeline steps with correlation_id (export_id). Capture Calc Engine events, validation errors, mapping diffs, signoff events (SSO id) and portal responses. Ship logs to central ELK/Opensearch; create indexed <code>calc_log_index</code> for fast audit lookup. Maintain automated integrity monitors: checksum drift alerts, daily ledger digest signed by HSM, alerting on missing artefacts. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Automation & CI/CD (Quality Gates)</strong><br>All mapping, validator rules, calc_engine updates live in Git with PRs and mandatory pipeline checks: unit tests, linting, golden-file regression. PR merge triggers: run full golden-file suite for changed mapping/calc code; block merge on regression. Provide example CI job (YAML) that runs validator, calc engine, mapping, and computes sha256 diffs. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Testing Strategy — Unit, Integration, Golden Regression</strong><br>Unit tests for all transforms and calc modules; integration tests that run sample workspaces end-to-end; nightly golden-file regression covering core + edge cases (including scenarios 1–33). Define acceptance criteria: sha256 calc_log matches expected; XSD validation success; critical_count=0. Record test coverage and require 90%+ coverage for calc logic. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Data Lineage, Provenance & Reproducibility</strong><br>For each artifact store: origin (raw_export sha256), transformation steps (change_ledger entries), calc_version and commit hash, mapping_version, XML canonical sha256. Provide a <code>lineage/{bundle_id}.json</code> that links raw → validation → calc_logs → xml → bundle sha256. Ensure ability to reproduce any calc_log by re-running calc_engine with inputs + calc_version + seed. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>SRE-style Runbooks & Incident Response</strong><br>Provide step-by-step runbooks: Incident Triage (critical parsing failure), Rollback (how to revoke bundle, create amend_bundle), Hotfix (how to promote mapping patch with immediate golden-file run). Record post-incident review template with root cause, corrective action, owner, and timeline. Automate alerting into PagerDuty/Slack (e.g., :contentReference[oaicite:5]{index=5} and :contentReference[oaicite:6]{index=6}) with on-call. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>KPIs, Dashboards & Sample SQL</strong><br>Key metrics: <code>staging_parse_failure_rate</code>, <code>golden_regression_pass_rate</code>, <code>mean_time_to_fix_critical</code>, <code>bundle_repro_success_rate</code>.<br>Sample SQL (Postgres) — daily critical count:<br><code>SELECT date(processed_at) AS day, count(*) FILTER (WHERE severity=&#x27;CRITICAL&#x27;) AS criticals FROM validation_report GROUP BY day ORDER BY day DESC;</code><br>Provide Grafana panels and alert rules (e.g., criticals > 0 → page on-call). </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Audit & Evidence Automation</strong><br>Automate per-employee audit ZIP generation: <code>calc_log</code>, <code>xml_canonical</code>, <code>signoff_evidence</code>, <code>payslip</code> (if allowed). Sign manifests with HSM and store signed manifest in archive. Expose audited manifests via read-only S3 presigned URLs to auditors for limited time. Provide verification script to validate sha256 chain. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Change Management & Template Drift Handling</strong><br>Implement a mapping-change policy: any mapping change must include mapping_diff, golden-file run, UAT signoff, and a planned promotion window. For portal template changes, automatically compare <code>template_sha256</code> and, if changed, create <code>mapping_change_ticket</code> and block production until mapping regression passes. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Operational Playbooks — Example Scenarios</strong><br>Include concise, stepwise playbooks for: mass NPWP remediation, gross-up failure, staging parse regressions, GL reconciliation discrepancies, portal template mismatch—each containing detection, containment, remediation, and post-mortem steps. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Training, Certification & Knowledge Transfer</strong><br>Design a 3-day operator certification: Day 1 — toolchain & validation; Day 2 — calc engine & mapping; Day 3 — incident handling, signoff evidence, compliance. Publish operator cheat-sheets and run quarterly drills. Maintain a public internal wiki and an onboarding checklist. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Implementation Roadmap (90 / 180 / 365 days, concrete milestones)</strong><br>0–30 days: CI/CD baseline, containerize validator & calc, create golden-file baseline, implement HSM PoC.<br>31–90 days: automated golden regression in CI, build monitoring dashboards, RBAC & SSO signoff enforcement, run 2 UAT cycles.<br>91–180 days: full production pipeline, SRE runbooks, incident automation, external audit prep.180–365 days: continuous improvement: reduce staging failures <1%, full Level 4 maturity, annual external audit. Assign owners to each milestone. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Risk Register & Mitigation (Top 10 risks)</strong><br>Examples: portal template change → mapping drift (mitigate: template sha256 detection + regression block), calc_engine bug → systematic miscalc (mitigate: CI golden tests + canary releases), unauthorized edit (mitigate: RBAC + append-only ledger + HSM-signed digests). Provide risk owner, likelihood, impact, and mitigation per risk. </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Deliverables I Will Expand/Produce Now (pick any; I will produce inline)</strong><br>1) Architect diagram (textual ASCII + component list). 2) CI YAML example for golden regression. 3) Sample calc_log JSON canonical schema + validator JSON schema. 4) Sample <code>bundle_auditor</code> verification script (bash + sha256 checks). 5) Sample Postgres metric queries + Grafana panel spec. 6) Operator 1-page quick-start (printable).<br>Which of the above should I generate inline now? (If you prefer several, I will produce the top 3 immediately in this response.) </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Immediate Additions Included Below (generated now)</strong><br>— <strong>Calc_log canonical JSON schema (example)</strong>:<br><code>{ &quot;record_id&quot;:&quot;string&quot;, &quot;employee_id&quot;:&quot;string&quot;, &quot;inputs&quot;:{ &quot;...&quot;: &quot;...&quot; }, &quot;steps&quot;:[{&quot;step&quot;:&quot;string&quot;,&quot;formula&quot;:&quot;string&quot;,&quot;input_refs&quot;:[&quot;...&quot;],&quot;value&quot;:number}], &quot;outputs&quot;:{ &quot;pph_annual&quot;:number,&quot;total_withheld&quot;:number,&quot;balance&quot;:number }, &quot;calc_version&quot;:&quot;string&quot;, &quot;rounding_rule_id&quot;:&quot;string&quot;, &quot;timestamp&quot;:&quot;ISO8601&quot;, &quot;operator_id&quot;:&quot;string&quot;, &quot;sha256&quot;:&quot;hexstring&quot; }</code><br>— <strong>Sample CI job (GitHub Actions) — golden regression skeleton</strong>:<br><code>name: Golden Regression on: [pull_request] jobs: regression: runs-on: ubuntu-latest steps: - uses: actions/checkout@v4 - name: Setup Python uses: actions/setup-python@v4 with: { python-version: &#x27;3.11&#x27; } - name: Install deps run: pip install -r requirements.txt - name: Run validator run: ./scripts/run_validator.sh $INPUT_FILE --out /tmp/validated.csv - name: Run calc engine run: ./scripts/run_calc.sh /tmp/validated.csv --version $CALC_VERSION --out /tmp/calc_logs - name: Compare golden sha256 run: ./scripts/compare_golden.sh /tmp/calc_logs /goldens</code><br>— <strong>Sample bundle verification script (bash)</strong>:<br><code>#!/usr/bin/env bash set -euo pipefail bundle=$1 shafile=&quot;${bundle}.sha256&quot; echo &quot;Verifying $bundle&quot; sha256sum -c &quot;$shafile&quot; unzip -q &quot;$bundle&quot; -d /tmp/bundle_check jq -r &#x27;.files[]|.path + &quot; &quot; + .sha256&#x27; /tmp/bundle_check/manifest.json | while read path sha; do echo &quot;$sha  /tmp/bundle_check/$path&quot; | sha256sum -c -; done echo &quot;Bundle OK&quot;</code> </td></tr><tr><td data-label="Complete Guide — BPA1 XML Import Format &amp; Excel Converter"> <strong>Closing operational note (concise)</strong><br>The above additions focus on automation, reproducibility, elevated security, observability, and formal governance — the essential pillars of a world-class guide. I can now (immediately) expand any of the delivered artifacts into full files: architecture diagram, CI pipelines, full calc_log JSON schema with JSON Schema Draft, sample Power Query (M) skeleton, sample Python validator, or a printable operator quick-start PDF. Specify which 3 artifacts you want produced inline now and I will generate them in full. </td></tr></tbody></table></div><div class="row-count">Rows: 77</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>