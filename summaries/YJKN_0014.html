<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1769960840">
<link rel="stylesheet" href="assets/overrides.css?v=1772212690">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="YJKN_0014_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **VBA Macro — Update_PPh_21_Dec**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>VBA Macro — Update_PPh_21_Dec</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>Features</strong><br>- Automates staff iteration and calculator logic (optional Gross-Up GoalSeek).<br>- Safe, reversible changes: restores Calculator cells and preserves application state.<br>- Robust name matching using CleanName normalization to avoid NBSP/case/spacing issues.<br>- Writes results to <code>Tax_Calculation</code> (cols M & P) and <code>Detail_Budget</code> (col S); reports unmatched names and GoalSeek failures.</td></tr><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>Benefits</strong><br>- Significant time savings for payroll/HR batch updates.<br>- Improved accuracy and auditability with <code>dictMissing</code> / <code>dictGSFail</code> logs.<br>- Scales to large lists (recommended tests up to 2,000 rows).</td></tr><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>Validation</strong><br>- Outputs have been validated to match the Ortax yearly calculator results (see <a href="https://kalkulator.ortax.org/yearly" target="_blank">Kalkulator PPh 21 Masa Pajak Terakhir</a>).<br>- Technical user guide and implementation checklist available.</td></tr><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>How to obtain</strong><br>- Licensed module + install instructions, or sample workbook for trial runs.<br>- Includes pre-run checklist, backup guidance, and recommended audit pack.</td></tr><tr><td data-label="VBA Macro — Update_PPh_21_Dec"><strong>Call to action</strong><br>- Request a demo run on your <code>staff_list</code> sample to verify results and audit trail.</td></tr></tbody></table></div><div class="row-count">Rows: 5</div></div><div class="table-caption" id="Table2" data-table="YJKN_0014_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>Link: </strong><a href="https://kalkulator.ortax.org/yearly" target="_blank">Kalkulator PPh 21 Masa Pajak Terakhir</a> </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>1) Input utama (apa yang diminta user / payroll)</strong><br>- Status pegawai (pegawai tetap / bukan pegawai).<br>- Status NPWP (ada / tidak) — berpengaruh pada pengenaan tarif lebih tinggi jika tidak ada.<br>- Status kawin & jumlah tanggungan (untuk PTKP).<br>- Masa penghasilan (bulan kerja dalam tahun berjalan).<br>- Komponen penghasilan: <code>gaji/pensiun</code>, <code>tunjangan pPh (tax allowance / gross-up)</code>, <code>tunjangan lain/uang lembur</code>, <code>honorarium</code>, <code>premi asuransi yg dibayar pemberi kerja</code>, <code>natura/kenikmatan</code>, <code>tantiem/bonus/THR</code>. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>2) Penjumlahan bruto</strong><br>- Kalkulator menjumlahkan semua komponen di atas → menghasilkan <strong>Penghasilan Bruto Masa</strong> (per masa / bulan atau kumulatif sesuai input). </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>3) Pengurangan yang diizinkan (Deductions)</strong><br>- <code>Biaya jabatan</code> = <code>5% × Penghasilan Bruto</code> tetapi dibatasi maksimum <code>Rp500.000/bulan</code> (atau <code>Rp6.000.000/tahun</code>).<br>- <code>Iuran pensiun / iuran THT/JHT</code> (sesuai kontribusi aktual).<br>- <code>Zakat</code> yang dibayarkan melalui pemberi kerja (jika ada).<br>- Hasil pengurangan ini = <strong>Jumlah Pengurang</strong> → <code>Penghasilan Neto</code> = <code>Penghasilan Bruto − Jumlah Pengurang</code>. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>4) Menggabungkan penghasilan masa sebelumnya (jika ada)</strong><br>- Jika pegawai sudah menerima penghasilan di beberapa masa dalam tahun berjalan, kalkulator mengakumulasi <strong>Penghasilan Neto Masa Sebelumnya</strong> dan menggabungkan dengan masa ini untuk mendapatkan posisi kumulatif. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>5) Konversi ke basis setahun (annualisasi) — ketika “disetahunkan” dipakai</strong><br>- Untuk kasus disetahunkan: <code>Penghasilan Neto Setahun = Penghasilan Neto Bulanan × 12</code> (atau jika menggunakan kumulatif: <code>Penghasilan Neto Kumulatif / jumlah bulan kerja × 12</code>).<br>- Tujuan: mendapatkan basis tahunan untuk menerapkan tarif progresif Pasal 17 dan PTKP tahunan. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>6) Hitung PTKP (Penghasilan Tidak Kena Pajak)</strong><br>- Ambil PTKP sesuai status (mis. TK/0 = <code>Rp54.000.000</code> per tahun; tambahan <code>Rp4.500.000</code> untuk tiap tanggungan sampai max 3; tambahan untuk status kawin/istri digabung sesuai ketentuan). </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>7) Tentukan PKP (Penghasilan Kena Pajak) setahun</strong><br>- <code>PKP Setahun = Penghasilan Neto Setahun − PTKP</code> (jika negatif → PKP = 0). </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>8) Hitung PPh terutang setahun (tarif Pasal 17, progresif)</strong><br>- Terapkan lapisan tarif progresif ke PKP setahun: contoh lapisan umum saat ini: <code>sampai Rp60 jt → 5%</code>, <code>&gt;Rp60 jt s.d. Rp250 jt → 15%</code>, <code>&gt;Rp250 jt s.d. Rp500 jt → 25%</code>, <code>&gt;Rp500 jt s.d. Rp5 miliar → 30%</code>, <code>&gt;Rp5 miliar → 35%</code>.<br>- Hasilnya = <strong>PPh Pasal 21 Terutang Setahun</strong>. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>9) Proporsionalkan dan rekonsiliasi ke masa pajak terakhir</strong><br>- <code>PPh disetahunkan untuk masa</code> = <code>PPh Terutang Setahun × (masa kerja dalam bulan / 12)</code>.<br>- Kemudian kurangi <code>PPh yang sudah dipotong</code> pada masa sebelumnya → hasilnya adalah <code>PPh Terutang bulan ini</code> (dapat menghasilkan kekurangan bayar atau kelebihan bayar/refund).<br>- Jika pilihan <em>gross-up</em> atau <em>tunjangan pajak</em> diaktifkan, kalkulator menyesuaikan agar beban pajak ditanggung pemberi kerja (menghitung gross-up algebraically sehingga penerima menerima netto yang diinginkan). </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>10) Faktor tambahan yang mempengaruhi hasil akhir</strong><br>- <strong>NPWP tidak ada / NIK belum teraktivasi</strong> → pemotongan dapat dilakukan dengan tarif 20% lebih tinggi (yakni pemotongan = <code>120%</code> dari jumlah PPh yang seharusnya).<br>- Pembulatan, plafon dan ketentuan PMK/Perdirjen (mis. perlakuan untuk bukan pegawai, tarif TER, dan perhitungan DPP untuk bukan pegawai) ikut memengaruhi langkah-langkah di atas. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>11) Output yang ditampilkan oleh kalkulator</strong><br>- Rincian: <code>Penghasilan Bruto</code>, <code>Jumlah Pengurang</code>, <code>Penghasilan Neto (masa &amp; setahun)</code>, <code>PTKP</code>, <code>PKP</code>, <code>PPh Pasal 21 atas PKP</code>, <code>PPh Pasal 21 dipotong masa sebelumnya</code>, <code>PPh Terutang bulan ini</code>, <code>PPh yg sudah disetor</code> dan indikasi kelebihan/kurang bayar. </td></tr><tr><td data-label="Penjelasan Kalkulator PPh 21 Masa Pajak Terakhir"> <strong>12) Catatan implementasi & verifikasi</strong><br>- Pastikan input sesuai bukti payroll (komponen bruto, kontribusi pensiun, zakat, status NPWP/NIK, masa kerja).<br>- Untuk kasus nyata gunakan angka riil; kalkulator hanya menerapkan aturan logika (annualisasi → tarif progresif → prorata → rekonsiliasi). </td></tr></tbody></table></div><div class="row-count">Rows: 13</div></div><div class="table-caption" id="Table3" data-table="YJKN_0014_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Explanation of Final Tax Period PPh 21 Calculator**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Explanation of Final Tax Period PPh 21 Calculator</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>Link: </strong><a href="https://kalkulator.ortax.org/yearly" target="_blank">Kalkulator PPh 21 Masa Pajak Terakhir</a> </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>1) Main inputs (what the user / payroll is asked for)</strong><br>- Employee status (permanent employee / non-employee).<br>- NPWP status (present / not present) — affects application of higher withholding if absent.<br>- Marital status & number of dependents (for PTKP).<br>- Income period (months worked within the current year).<br>- Income components: <code>salary/pension</code>, <code>tax allowance (tax allowance / gross-up)</code>, <code>other allowances/overtime pay</code>, <code>honorarium</code>, <code>insurance premiums paid by employer</code>, <code>natura/benefits in kind</code>, <code>tantiem/bonus/THR</code>. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>2) Gross summation</strong><br>- The calculator sums all components above → produces <strong>Period Gross Income</strong> (per period / month or cumulative according to input). </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>3) Allowed reductions (Deductions)</strong><br>- <code>Position expense (biaya jabatan)</code> = <code>5% × Gross Income</code> but capped at <code>Rp500.000/month</code> (or <code>Rp6.000.000/year</code>).<br>- <code>Pension contributions / THT/JHT contributions</code> (per actual contributions).<br>- <code>Zakat</code> paid through employer (if any).<br>- Result of these reductions = <strong>Total Deductions</strong> → <code>Net Income</code> = <code>Gross Income − Total Deductions</code>. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>4) Combining previous period incomes (if any)</strong><br>- If the employee received income in multiple periods during the year, the calculator accumulates <strong>Previous Period Net Income</strong> and combines it with this period to obtain the cumulative position. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>5) Convert to annual basis (annualization) — when “annualized” is used</strong><br>- For annualized cases: <code>Annual Net Income = Monthly Net Income × 12</code> (or if using cumulative: <code>Cumulative Net Income / number of months worked × 12</code>).<br>- Purpose: obtain an annual basis to apply progressive Article 17 rates and annual PTKP. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>6) Calculate PTKP (Non-Taxable Income)</strong><br>- Take PTKP according to status (e.g., single with 0 dependents (TK/0) = <code>Rp54.000.000</code> per year; additional <code>Rp4.500.000</code> for each dependent up to max 3; additional amounts for married/spouse combined per regulations). </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>7) Determine annual Taxable Income (PKP)</strong><br>- <code>Annual PKP = Annual Net Income − PTKP</code> (if negative → PKP = 0). </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>8) Calculate annual PPh payable (progressive Article 17 rates)</strong><br>- Apply progressive tax brackets to annual PKP: example current brackets: <code>up to Rp60 mln → 5%</code>, <code>&gt;Rp60 mln to Rp250 mln → 15%</code>, <code>&gt;Rp250 mln to Rp500 mln → 25%</code>, <code>&gt;Rp500 mln to Rp5 billion → 30%</code>, <code>&gt;Rp5 billion → 35%</code>.<br>- Result = <strong>Annual PPh Pasal 21 Payable</strong>. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>9) Proportion and reconcile to the final tax period</strong><br>- <code>Annualized PPh for the period</code> = <code>Annual PPh × (months worked / 12)</code>.<br>- Then subtract <code>PPh already withheld</code> in previous periods → result is <code>PPh Payable this month</code> (may produce underpayment or overpayment/refund).<br>- If <em>gross-up</em> or tax allowance is enabled, the calculator adjusts so employer bears the tax (computes gross-up algebraically so the recipient receives the desired net). </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>10) Additional factors affecting the final result</strong><br>- <strong>No NPWP / NIK not activated</strong> → withholding may be applied at 20% higher rate (withholding = <code>120%</code> of the PPh that should apply).<br>- Rounding, ceilings and PMK/Directorate General regulations (e.g., treatment for non-employees, TER rates, and tax base calculation for non-employees) also affect the above steps. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>11) Outputs displayed by the calculator</strong><br>- Details: <code>Gross Income</code>, <code>Total Deductions</code>, <code>Net Income (period &amp; annualized)</code>, <code>PTKP</code>, <code>PKP</code>, <code>PPh Pasal 21 on PKP</code>, <code>PPh Pasal 21 withheld in previous periods</code>, <code>PPh Payable this month</code>, <code>PPh already deposited</code> and indication of overpayment/underpayment. </td></tr><tr><td data-label="Explanation of Final Tax Period PPh 21 Calculator"> <strong>12) Implementation & verification notes</strong><br>- Ensure inputs match payroll evidence (gross components, pension contributions, zakat, NPWP/NIK status, months worked).<br>- For real cases use actual figures; the calculator only applies the rules/logic (annualization → progressive rates → prorate → reconciliation). </td></tr></tbody></table></div><div class="row-count">Rows: 13</div></div><div class="table-caption" id="Table4" data-table="YJKN_0014_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical User Guide: Update_PPh_21_Dec (VBA macro)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical User Guide: Update_PPh_21_Dec (VBA macro)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Purpose & objective</strong><br>Automates PPh21 updates for employees listed in the workbook-level named range <code>staff_list</code>. For each staff name the macro: writes the name into <code>Calculator!F5</code>, recalculates the Calculator sheet, optionally runs a Gross-Up GoalSeek (if <code>Calculator!G2 = &quot;Gross Up&quot;</code>), captures result cells from the Calculator, writes results back to <code>Tax_Calculation</code> (columns <strong>M</strong>, <strong>P</strong>, <strong>S</strong>), and collects any unmatched names or GoalSeek failures for a concise user summary. The macro preserves application state, restores key Calculator cells (including <code>F5</code> and <code>F29</code>) on normal completion or error, and limits the user summary to the first 25 items per failure category. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Scope</strong><br>Applies to the <code>Update_PPh_21_Dec</code> macro in this workbook (refactored variant). Covers environment preconditions, inputs/outputs, step-by-step run instructions, expected behaviour, failure modes, remediation steps, testing guidance, deployment and change-control recommendations. Excludes unrelated macros and external payroll systems. <code>Detail_Budget</code> write-back is present in the code but currently commented out; instructions reference this as optional functionality. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>High-level summary of what the macro does</strong><br>1) Save and disable UI updates/events and set <code>Application.Calculation = xlCalculationManual</code> to speed processing.<br>2) Read <code>staff_list</code> (workbook named range).<br>3) For each non-empty staff name: normalise the name, write it to <code>Calculator!F5</code>, calculate the <code>Calculator</code> sheet, optionally run GoalSeek on <code>F2</code> changing <code>F29</code> (with a retry after <code>Application.Calculate</code>), find the matching row in <code>Tax_Calculation</code> column A and write <code>F47 → M</code>, <code>F50 → P</code>, <code>F2 → S</code>. (Optional) find matching row in <code>Detail_Budget</code> column B and write <code>G36 → S</code> if that block is enabled.<br>4) Track missing names and GoalSeek failures in <code>Scripting.Dictionary</code> objects to avoid duplicates.<br>5) Restore <code>Calculator</code> state (clear <code>F29</code>, restore <code>F5</code>, re-create <code>F29</code> VLOOKUP formula and—per current behaviour—convert it to a value), recalc <code>shCalc</code>, restore application state, and show a summary <code>MsgBox</code> if there were any issues.<br>6) On runtime error, run a best-effort restore then show an error message. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Key worksheets & cells</strong><br>• <code>Calculator</code> (sheet name must match exactly): key cells used by the macro — <code>F5</code> (input staff name; original value stored in <code>originalF5</code> and restored at end), <code>G2</code> (Gross Up flag), <code>F2</code> (GoalSeek target — also written back to <code>Tax_Calculation</code> column S), <code>F29</code> (GoalSeek changing cell; macro clears it during processing and re-creates the VLOOKUP formula at cleanup), <code>F47</code> (value written → <code>Tax_Calculation</code> M), <code>F50</code> (value written → <code>Tax_Calculation</code> P), <code>G36</code> (value written → <code>Detail_Budget</code> S when uncommented).<br>• <code>Tax_Calculation</code>: macro searches column <strong>A</strong> for an exact match (see matching rules) and writes to columns <strong>M</strong>, <strong>P</strong>, <strong>S</strong> for the matched row.<br>• <code>Detail_Budget</code>: optional write-back (commented). If re-enabled, the macro finds exact matches in column <strong>B</strong> and writes <code>G36</code> to column <strong>S</strong>. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Preconditions / required environment</strong><br>1. Excel desktop with macros enabled (trusted workbook recommended).<br>2. Workbook contains worksheets named exactly: <code>Calculator</code>, <code>Tax_Calculation</code>, <code>Detail_Budget</code> (Detail_Budget may be present even if write-block is commented).<br>3. Workbook-level named range <code>staff_list</code> exists and refers to a single-column range of staff names (no header expected; if header exists remove or adjust before run).<br>4. Calculator sheet contains the expected formulas and values for <code>F2</code>, <code>F5</code>, <code>F29</code>, <code>F47</code>, <code>F50</code>, <code>G2</code>, <code>G36</code>.<br>5. <code>Scripting.Dictionary</code> is available via late-binding (<code>CreateObject(&quot;Scripting.Dictionary&quot;)</code>) — no VBA reference required. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Normalization & matching rules (exact behaviour used by code)</strong><br>• The macro constructs a <code>cleanName</code> from the <code>staff_list</code> entry by replacing <code>Chr(160)</code> (non-breaking space) with a normal space and then applying <code>Application.WorksheetFunction.Trim</code> to collapse extra spaces. The code currently does not explicitly force lower-case but uses <code>MatchCase:=False</code> in <code>Find</code>, so matches are case-insensitive. <br>• Matching uses <code>Range.Find</code> on <code>Tax_Calculation</code> column <strong>A</strong> with <code>LookAt:=xlWhole</code>, <code>MatchCase:=False</code>. If you enable <code>Detail_Budget</code> writes, matching there uses column <strong>B</strong> with the same criteria. <br>• If names contain other invisible characters, diacritics, or alternate Unicode normalization forms, those will need additional handling outside of the default <code>cleanName</code> step. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>GoalSeek behaviour (exact logic)</strong><br>• The macro checks <code>shCalc.Range(&quot;G2&quot;).Value</code> for the literal string <code>&quot;Gross Up&quot;</code>. If equal, it attempts <code>shCalc.Range(&quot;F2&quot;).GoalSeek(Goal:=0, ChangingCell:=shCalc.Range(&quot;F29&quot;))</code>. <br>• If the first GoalSeek attempt returns False, the macro executes <code>Application.Calculate</code> (full workbook calc), then retries GoalSeek once more. <br>• If the second attempt still fails, the staff name is recorded in <code>dictGSFail</code> (Scripting.Dictionary) to prevent duplicate entries and report later. <br>• If <code>G2</code> is not <code>&quot;Gross Up&quot;</code>, the macro clears <code>F29</code> for that iteration to ensure no residual changing value remains. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>In-memory tracking & reporting</strong><br>• Two late-bound dictionaries are used: <code>dictMissing</code> (names not found in target sheets) and <code>dictGSFail</code> (GoalSeek failures). They are created with <code>CreateObject(&quot;Scripting.Dictionary&quot;)</code> to avoid duplicate keys and enable quick existence checks. <br>• On completion, if either dictionary has entries the macro builds a <code>msg</code> string listing up to the first 25 keys in each dictionary and indicates <code>(more omitted)</code> when more than 25 entries exist. That <code>msg</code> is shown in a <code>MsgBox</code> titled <code>Update_PPh_21_Dec</code>. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Application-state preservation & restoration</strong><br>• The macro saves <code>Application.ScreenUpdating</code>, <code>Application.EnableEvents</code>, and <code>Application.Calculation</code> into local variables (<code>prevScreen</code>, <code>prevEvents</code>, <code>prevCalc</code>) before modifying them. <br>• Sets <code>Application.ScreenUpdating = False</code>, <code>Application.EnableEvents = False</code>, and <code>Application.Calculation = xlCalculationManual</code> at start to improve performance and avoid event side-effects. <br>• On both normal completion and in the <code>CleanFail</code> error handler the macro attempts to restore Calculator cells (<code>F29</code> cleared, <code>F5</code> restored to <code>originalF5</code>, <code>F29</code> re-created as the VLOOKUP formula and then converted to its value), recalculates the Calculator sheet, and finally restores the saved <code>Application</code> settings. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Cleanup behaviour (explicit code actions)</strong><br>1. <code>shCalc.Range(&quot;F29&quot;).ClearContents</code> — ensure no temporary changing value remains.<br>2. <code>shCalc.Range(&quot;F5&quot;).Value = originalF5</code> — restore prior F5 value.<br>3. Recreate <code>F29</code> formula via R1C1: <code>=VLOOKUP(R5C6,Tax_Calculation!C[-5]:C[10],16,0)</code> and then set that cell's <code>.Value = .Value</code> (current design converts the formula to its computed value).<br>4. <code>shCalc.Calculate</code> — recalc to ensure consistency.<br>5. Restore <code>Application.ScreenUpdating</code>, <code>Application.EnableEvents</code>, and <code>Application.Calculation</code> to the prior values. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Error handling & best-effort recovery</strong><br>• <code>On Error GoTo CleanFail</code> at the top funnels unexpected runtime errors to <code>CleanFail</code>. <br>• <code>CleanFail</code> uses <code>On Error Resume Next</code> and attempts the same cleanup steps (clear <code>F29</code>, restore <code>F5</code>, re-create <code>F29</code> formula then convert to value, recalc) and restores the application state. <br>• After recovery attempts it shows a <code>MsgBox &quot;Error &quot; &amp; Err.Number &amp; &quot;: &quot; &amp; Err.Description</code> (vbExclamation) to notify the user. Always review the workbook state after an error and restore from backup if recovery was insufficient. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>User-facing messages & behavior</strong><br>• If <code>staff_list</code> is not found: immediate <code>MsgBox &quot;Named range &#x27;staff_list&#x27; not found.&quot;</code> and the macro exits cleanup. <br>• If there are any missing names or GoalSeek failures: MsgBox titled <code>Update_PPh_21_Dec</code> summarising <code>Names not found in Tax_Calculation or Detail_Budget:</code> and <code>GoalSeek failed for:</code> with up to 25 names each and <code>(more omitted)</code> if larger. <br>• On fatal runtime error: <code>MsgBox &quot;Error &lt;number&gt;: &lt;description&gt;&quot;</code> and a best-effort restore is attempted. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Operational run steps — pre-run, run, post-run (detailed)</strong><br><strong>Pre-run:</strong><br>1. Confirm the named range <code>staff_list</code> exists and points to the intended single-column list (remove header rows or ensure <code>staff_list</code> excludes headers).<br>2. Save a timestamped copy of the workbook (recommended backup).<br>3. Verify <code>Calculator</code> key cells (<code>F2</code>, <code>F5</code>, <code>F29</code>, <code>F47</code>, <code>F50</code>, <code>G2</code>, <code>G36</code>) contain expected formulas/labels and that the VLOOKUP pattern used in <code>F29</code> aligns with <code>Tax_Calculation</code> layout. <br>4. If running a large batch (>500 rows), notify reviewers and consider running against a copy to measure runtime. <br><strong>Run:</strong><br>1. Open workbook in Excel desktop, enable macros for the workbook, and ensure no other macros are running. <br>2. Run <code>Update_PPh_21_Dec</code> (Developer → Macros or assigned button). <br>3. Macro iterates names, performs per-row calculation and GoalSeek logic as required, updates <code>Tax_Calculation</code> and collects problems in dictionaries. <br><strong>Post-run:</strong><br>1. Review MsgBox summary and address <code>dictMissing</code>/<code>dictGSFail</code> items. <br>2. Spot-check 5–10 rows in <code>Tax_Calculation</code> to confirm <code>M</code>, <code>P</code>, <code>S</code> values match expectations (compare against <code>Calculator!F47</code>, <code>F50</code>, <code>F2</code> recorded during run). <br>3. If changes are accepted, save and archive workbook backup; if not, restore pre-run backup and investigate. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Testing, validation & recommended test cases</strong><br>• <strong>Unit test:</strong> small <code>staff_list</code> (3–10 rows) with known expected outputs for <code>F47</code>, <code>F50</code>, <code>F2</code>. Confirm target writes match expected values exactly.<br>• <strong>Edge cases:</strong> empty names; names with NBSP (<code>Chr(160)</code>); multiple contiguous spaces; duplicates in <code>staff_list</code>; names with accents/diacritics; names present only in one of the target sheets. Confirm <code>dictMissing</code> and <code>dictGSFail</code> capture these appropriately.<br>• <strong>Error recovery test:</strong> intentionally raise an error inside the loop (e.g., temporarily remove <code>Tax_Calculation</code> sheet) and confirm <code>F5</code>, <code>F29</code>, and application state are restored by <code>CleanFail</code> and that an informative error MsgBox is shown.<br>• <strong>Performance test:</strong> run on a copy with 500–2,000 rows to measure total runtime and memory behaviour; consider reducing per-row recalc if performance is unsatisfactory. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Audit & logging recommendations (practical improvements)</strong><br>• Current behaviour shows a transient MsgBox summary but does not persist logs. Recommended: add an optional <code>Audit_Log</code> worksheet where <code>dictMissing</code> and <code>dictGSFail</code> are written with timestamp, user, workbook name, and sample values to preserve an auditable trail. <br>• Retain pre-run and post-run workbook copies in a versioned archive (SharePoint/git/similar) with naming convention <code>Payroll_PR&lt;YYYYMM&gt;_Workbook_UpdateHR_&lt;rundate&gt;.xlsm</code> for auditors. <br>• Optionally extend the macro to capture per-row <code>F47</code>, <code>F50</code>, <code>F2</code> snapshots into the audit sheet for reconciliation sampling. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Common failure modes & remediation</strong><br>• <strong>Named range missing:</strong> macro aborts with MsgBox. Remediation: create <code>staff_list</code> via Formulas → Name Manager or adjust macro to reference correct range. <br>• <strong>Name mismatches (dictMissing):</strong> usually caused by non-breaking spaces, extra spaces, hidden characters, or exact-match requirements. Remediation: run a pre-match diagnostic using <code>Application.Trim</code>/NBSP replacement on both lists or enable fuzzy/partial matching (change <code>LookAt</code> to <code>xlPart</code> or implement string similarity). <br>• <strong>GoalSeek failures (dictGSFail):</strong> caused by unstable formulas, invalid <code>F29</code> starting values, or circular references. Remediation: run <code>Application.Calculate</code> manually, inspect <code>Calculator</code> formula chains, run manual GoalSeek to debug, and adjust Excel iteration options if appropriate. <br>• <strong>Calculator state not restored:</strong> if <code>CleanFail</code> fails, manually reset <code>Application.Calculation = xlCalculationAutomatic</code> and restore <code>F5</code>/<code>F29</code> from backup if necessary. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Configuration / small-code change suggestions (only where necessary)</strong><br>These are optional and should be applied only if you want behaviour different from the current code: <br>• <strong>Preserve live <code>F29</code> formula instead of converting to value:</strong> remove the line <code>shCalc.Range(&quot;F29&quot;).Value = shCalc.Range(&quot;F29&quot;).Value</code> in cleanup to keep the VLOOKUP formula live. <br>• <strong>Safer trimming:</strong> replace <code>Application.WorksheetFunction.Trim(cleanName)</code> with <code>Application.Trim(cleanName)</code> to avoid runtime error for empty/illegal inputs. <br>• <strong>Persist audit log:</strong> add code to dump <code>dictMissing</code>/<code>dictGSFail</code> into an <code>Audit_Log</code> sheet rather than relying only on MsgBox. <br>• <strong>Store original <code>F29</code> formula:</strong> capture <code>originalF29Formula = shCalc.Range(&quot;F29&quot;).FormulaR1C1</code> at start and reassign on cleanup instead of hardcoding the VLOOKUP. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Governance, responsibilities & RACI (concise)</strong><br>• <strong>Payroll/HR Lead (R):</strong> prepare <code>staff_list</code>, confirm name format, validate initial results. <br>• <strong>Finance Analyst (A):</strong> validate <code>Tax_Calculation</code> outputs (cols M/P/S) and reconcile to GL samples. <br>• <strong>Workbook Owner / IT (C):</strong> maintain code, backups, macro signing/trust centre settings, and secure repository access. <br>• <strong>Reviewer/Test Owner (R):</strong> run tests on a copy and sign off prior to production runs. <br>• <strong>End user (I):</strong> run macro and act on the summary message (resolve missing names and GoalSeek failures). </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Operational governance, security & versioning</strong><br>• Store workbook in a controlled, versioned repository (SharePoint or secure file store). <br>• Use code signing and macros only enabled for trusted files. <br>• Maintain automated backups or manual snapshot before each production run. <br>• Limit the set of users allowed to run or modify the macro and capture approvals in <code>Macro_ChangeLog</code>. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Deployment & change management checklist</strong><br>Before enabling this macro in production: <br>☐ Place workbook in versioned repository and apply code signing where possible. <br>☐ Add <code>Macro_ChangeLog</code> sheet with version, author, date, and test notes. <br>☐ Validate <code>staff_list</code> and <code>Calculator</code> cell mappings in a staged copy. <br>☐ Add or enable <code>Audit_Log</code> persistence if auditability is required. <br>☐ Agree escalation thresholds and run acceptance criteria with finance/IT. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Operational escalation thresholds</strong><br>• Minor: single or a few missing names — correct master data and re-run.<br>• Moderate: >5% missing names or GoalSeek failures affecting non-material staff — investigate data quality and rerun on a copy.<br>• High: GoalSeek failures affecting high-value staff, or unexpected value variance beyond tolerance — stop production runs, restore backup, escalate to workbook owner/finance lead for RCA. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Suggested immediate actions before first production run</strong><br>1) Create a timestamped backup of the workbook.<br>2) Run macro on a small controlled sample and validate outputs vs manual calculations.<br>3) Enable <code>Audit_Log</code> persistence (recommended) or plan to capture <code>dictMissing</code>/<code>dictGSFail</code> programmatically.<br>4) Define escalation path for GoalSeek failures and missing master data. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Sample outputs & expected prompts</strong><br>• <strong>No issues:</strong> silent completion (no MsgBox shown). <br>• <strong>Partial issues:</strong> MsgBox summarising <code>Names not found in Tax_Calculation or Detail_Budget:</code> and/or <code>GoalSeek failed for:</code> listing up to 25 names and <code>(more omitted)</code> indicator. <br>• <strong>Fatal error:</strong> MsgBox <code>Error &lt;number&gt;: &lt;description&gt;</code>; macro attempts best-effort restore. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Testing checklist (pre-production)</strong><br>☐ Unit tests for representative sample inputs passed.<br>☐ Edge cases (empty, NBSP, duplicates) handled correctly.<br>☐ Error-injection recovery validated (application state and Calculator cells restored).<br>☐ Performance testing on representative dataset size completed. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Maintenance plan & periodic checks</strong><br>• Keep the macro code under version control and require peer review for any change. <br>• Quarterly health-check: validate existence and structure of named ranges and key Calculator cells; run a small smoke-test and confirm <code>F29</code> and <code>F5</code> restoration behaviour. <br>• Add regression tests to <code>Macro_ChangeLog</code> entries indicating which tests must be re-run after changes. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>FAQ (short)</strong><br>Q: Why are many names listed as missing? — A: Check for NBSP, extra spaces, hidden chars and confirm <code>Tax_Calculation</code> col A / <code>Detail_Budget</code> col B contain expected keys. Consider running a side-by-side diff or enabling fuzzy matching.<br>Q: GoalSeek failed for high-value staff — next steps? — A: Inspect Calculator dependencies, initial <code>F29</code> value, run manual GoalSeek, check Excel iteration options, and escalate if material.<br>Q: How to preserve original <code>F29</code> formula? — A: Capture the original formula at macro start and restore it on cleanup, or remove the <code>.Value = .Value</code> conversion if you want it to remain a formula. </td></tr><tr><td data-label="Technical User Guide: Update_PPh_21_Dec (VBA macro)"> <strong>Final compliance note</strong><br>Before adopting into regular production, align sign-off, backup retention policy, test acceptance criteria and escalation procedures with central finance/IT policies. Record approvals and deviations in <code>Macro_ChangeLog</code> and include run artifacts in the payroll audit pack. </td></tr></tbody></table></div><div class="row-count">Rows: 27</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>