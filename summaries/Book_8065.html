<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1762008375">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li>
<li class="toc-item"><a class="toc-link" href="#Table10">Table 10</a></li>
<li class="toc-item"><a class="toc-link" href="#Table11">Table 11</a></li>
<li class="toc-item"><a class="toc-link" href="#Table12">Table 12</a></li>
<li class="toc-item"><a class="toc-link" href="#Table13">Table 13</a></li>
<li class="toc-item"><a class="toc-link" href="#Table14">Table 14</a></li>
<li class="toc-item"><a class="toc-link" href="#Table15">Table 15</a></li>
<li class="toc-item"><a class="toc-link" href="#Table16">Table 16</a></li>
<li class="toc-item"><a class="toc-link" href="#Table17">Table 17</a></li>
<li class="toc-item"><a class="toc-link" href="#Table18">Table 18</a></li>
<li class="toc-item"><a class="toc-link" href="#Table19">Table 19</a></li>
<li class="toc-item"><a class="toc-link" href="#Table20">Table 20</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8065_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic / Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic / Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> Module imports, optional extras detection, and logger fallback.     </td><td data-label="Conceptual Notes"> Tries to import CORS, rate limiter, project <code>utils.make_logger</code> and optional <code>write_groups_index</code>. Falls back to safe no-op implementations. Lightweight logger factory ensures consistent logging without external deps.                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"> <code>create_app(cfg)</code> entry point builds Flask app and config defaults. </td><td data-label="Conceptual Notes"> Central config keys: <code>MAX_PASTE_SIZE</code>, <code>STORAGE_PATH</code>, <code>ENABLE_CORS</code>, <code>RATE_LIMIT</code>, <code>FLUSH_TEMPLATES_ON_RENDER</code>. Normalizes <code>STORAGE_PATH</code> to absolute. Logs feature availability (renderer, save/read helpers).                                                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> Optional CORS and rate limiter initialization.                      </td><td data-label="Conceptual Notes"> Enables CORS only if requested and available. Uses <code>flask-limiter</code> when installed and <code>RATE_LIMIT</code> provided. Graceful warnings if configured but unavailable.                                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <code>@app.before_request</code> <code>_enforce_content_length</code>.                    </td><td data-label="Conceptual Notes"> Blocks oversized POST/PUT/PATCH requests based on <code>MAX_PASTE_SIZE</code>. Soft-fails with logging on internal errors.                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> Template cache flush helper <code>_clear_jinja_template_cache</code>.          </td><td data-label="Conceptual Notes"> Clears <code>app.jinja_env.cache</code> when requested via cache-bust or config flag.                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"> Atomic write helper <code>_atomic_write_bytes_to_path</code>.                  </td><td data-label="Conceptual Notes"> Writes bytes to temp file then <code>os.replace</code> to ensure atomicity. Sets permissive perms. Returns (ok, error). Robust cleanup on failure.                                                                                                                                                                                                              </td></tr><tr><td data-label="Logic / Structure"> Static routes: <code>/</code>, <code>/health</code>, <code>/manifest.json</code> (+ alias).          </td><td data-label="Conceptual Notes"> <code>index</code> renders template or falls back to static file. <code>manifest</code> serves from static assets or project root, returns 404 if missing.                                                                                                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <code>/assets/&lt;path:filename&gt;</code> static file serving.                      </td><td data-label="Conceptual Notes"> Uses <code>send_from_directory</code> on app static folder. 404 on missing.                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> <code>/saved/index</code> — listing of files in <code>STORAGE_PATH</code>.                </td><td data-label="Conceptual Notes"> Returns sorted basenames (no dotfiles). Respects <code>MAX_INDEX_ITEMS</code>. Read-only summary endpoint for clients.                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> Groups normalization and <code>/groups/index</code> endpoint.                  </td><td data-label="Conceptual Notes"> If <code>groups_index.json</code> exists in project root it is validated and returned. Otherwise scans <code>STORAGE_PATH</code>, groups files by normalized base name (<code>_NN</code> suffix removal) and emits minimal groups JSON. Does not write or mutate <code>groups_index.json</code>.                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> Reference footnote stripping and table-cell preprocessing.          </td><td data-label="Conceptual Notes"> <code>_strip_ref_footnotes</code> removes common footnote tokens. <code>_escape_leading_list_markers_in_table_cells</code> protects table cells that start with list markers or numbered lists by HTML-escaping those characters. Defensive for pipe-table parsing.                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> Rendering pipeline with fallbacks <code>_render_text_with_fallbacks</code>.    </td><td data-label="Conceptual Notes"> Prefer <code>html_renderer.render_from_text</code>. If unavailable, tries multiple candidate modules and function names. Converts return types (tuple/dict/string) to <code>(html, meta)</code>. Final fallback is HTML-escaped <code>&lt;pre&gt;</code>. Meta indicates conversion failure.                                                                                                </td></tr><tr><td data-label="Logic / Structure"> <code>/convert</code> endpoint (and <code>/api/convert</code>, <code>/api/render</code> aliases).    </td><td data-label="Conceptual Notes"> Accepts JSON or form. Enforces non-empty input and size limit. Optional cache-bust triggers Jinja cache clear. Runs render pipeline then a simple post-check for <code>&lt;table&gt;</code> presence and annotates <code>meta</code> with <code>render_warning</code> if missing. Returns <code>html</code> and <code>meta</code>.                                                                                </td></tr><tr><td data-label="Logic / Structure"> <code>/save</code> endpoint.                                                   </td><td data-label="Conceptual Notes"> Accepts <code>html</code> and <code>filename</code> JSON or form. Ensures storage dir. Attempts <code>save_html_atomic</code> helper then fallback atomic write via <code>mkstemp</code> + <code>os.replace</code>. Returns safe relative URL <code>/saved/&lt;id&gt;</code> and avoids leaking absolute paths. Does not regenerate groups index.                                                                            </td></tr><tr><td data-label="Logic / Structure"> Markdown table splitter and <code>/save-md</code> endpoint.                    </td><td data-label="Conceptual Notes"> <code>_split_markdown_tables</code> extracts table blocks while honoring fenced code blocks. <code>save-md</code> saves either the whole markdown into <code>&lt;base&gt;_01.md</code> when 0–1 tables or splits multiple found tables into numbered files. Uses atomic write helper. Ensures unique names, returns created filenames and 201 on success. No background group regeneration. </td></tr><tr><td data-label="Logic / Structure"> <code>/saved/&lt;file_id&gt;</code> download endpoint.                               </td><td data-label="Conceptual Notes"> Uses optional <code>read_saved</code> helper if available. Validates path containment with <code>os.path.commonpath</code> to prevent path traversal and cross-drive issues. Sends file as attachment. 404 on errors.                                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> Minimal security headers set in <code>@app.after_request</code>.               </td><td data-label="Conceptual Notes"> Sets <code>X-Content-Type-Options</code>, <code>X-Frame-Options</code>, <code>Referrer-Policy</code>, <code>Permissions-Policy</code>. Best-effort and non-fatal on failure.                                                                                                                                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> CLI bootstrap (<code>if __name__ == &quot;__main__&quot;</code>)                         </td><td data-label="Conceptual Notes"> Reads <code>FLASK_HOST</code>, <code>FLASK_PORT</code>, <code>FLASK_DEBUG</code>. Creates app and runs. Logs startup message.                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Logic / Structure"> Error handling and design philosophy                                </td><td data-label="Conceptual Notes"> Defensive coding throughout. Uses multiple optional extension points (<code>render_from_text</code>, <code>save_html_atomic</code>, <code>read_saved</code>) while preserving safe fallbacks. Read-only approach to groups_index. Avoids background tasks and external side effects.                                                                                                  </td></tr></tbody></table></div><div class="row-count">Rows: 19</div></div><div class="table-caption" id="Table2" data-table="Book_8065_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic / Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic / Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> Module imports and project utilities         </td><td data-label="Conceptual Notes"> Imports stdlib, optional libs, and project <code>utils.load_env</code>, <code>make_logger</code>, <code>ensure_dir</code>. Logger created for module.                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"> Renderer loader <code>_load_renderer_callable()</code>  </td><td data-label="Conceptual Notes"> Attempts local <code>html_renderer.py</code> first via <code>spec_from_file_location</code>. Falls back to <code>import html_renderer</code>. Sets global <code>render_html</code>. Logs availability.                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> Safe CSV reader <code>_safe_read_csv</code>             </td><td data-label="Conceptual Notes"> Robust wrapper around <code>pandas.read_csv</code>. Tries modern args (<code>on_bad_lines</code>) then older <code>error_bad_lines</code> fallback then minimal call. Raises <code>RuntimeError</code> if pandas missing.                                                                                    </td></tr><tr><td data-label="Logic / Structure"> Markdown parser <code>parse_markdown_tables</code>      </td><td data-label="Conceptual Notes"> Conservative extractor returning list of <code>pandas.DataFrame</code>. Handles pipe-tables and CSV blocks. Respects fenced code blocks. Multiple internal flush helpers for pipe and CSV blocks. Defensive about unnamed columns and separator rows.                       </td></tr><tr><td data-label="Logic / Structure"> Inline markdown formatter <code>markdown_to_html</code> </td><td data-label="Conceptual Notes"> Minimal, safe inline conversion. Preserves inline code, bold, emphasis. Removes reference-style footnotes. No <code>&lt;br&gt;</code> insertion. Intended as simple inline formatter for batch renderer.                                                                          </td></tr><tr><td data-label="Logic / Structure"> Dropbox-path sanitizer helpers               </td><td data-label="Conceptual Notes"> <code>_sanitize_cell_text_for_dropbox</code> and <code>_sanitize_dropbox_paths_df</code> detect Windows/POSIX Dropbox paths and redact them. Applies per-cell with pandas-safe iteration fallback.                                                                                     </td></tr><tr><td data-label="Logic / Structure"> DataFrame HTML renderers                     </td><td data-label="Conceptual Notes"> <code>render_df_to_html_preserve_code</code>: preserves inline backtick code by replacing with placeholders then restoring into <code>to_html</code>. <code>render_df_to_html</code> wraps output in container div. Used for fallback HTML generation.                                            </td></tr><tr><td data-label="Logic / Structure"> Fragment cleanup <code>_cleanup_fragments_safe</code>   </td><td data-label="Conceptual Notes"> Removes <code>.frags_*</code> and <code>.fragments</code> dirs under given targets. Silent on errors. Returns list of removed paths.                                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> Flexible renderer caller <code>_call_renderer</code>    </td><td data-label="Conceptual Notes"> Inspects signature and attempts common call shapes (<code>(tables, output_path, inline_formatter)</code>, <code>(tables, output_path)</code>, <code>(tables, inline_formatter)</code>, <code>(tables)</code>). Returns whatever renderer returns or raises last exception.                                   </td></tr><tr><td data-label="Logic / Structure"> Batch processor <code>_run_batch</code>                 </td><td data-label="Conceptual Notes"> Batch flow: ensure pandas, load renderer, scan <code>md_folder</code> for <code>.md</code>, group by filename prefixes, parse tables, sanitize, then generate HTML via <code>render_html</code> or fallback writer. Writes per-prefix HTML files to <code>output_folder</code>. Cleans fragments afterwards. </td></tr><tr><td data-label="Logic / Structure"> Table parsing fallbacks in batch             </td><td data-label="Conceptual Notes"> If <code>parse_markdown_tables</code> yields no tables, attempts simpler pipe-line parsing using heuristics and <code>_safe_read_csv</code>. Multiple defensive try/except layers to maximize salvage of table-like content.                                                           </td></tr><tr><td data-label="Logic / Structure"> File naming and selection logic (batch)      </td><td data-label="Conceptual Notes"> Builds <code>book_prefixes</code> from first 9 chars of filenames. Maps numeric suffixes into ordered <code>selection_map</code>. Ensures deterministic processing order.                                                                                                              </td></tr><tr><td data-label="Logic / Structure"> Entry point logic <code>main()</code>                   </td><td data-label="Conceptual Notes"> Loads <code>cfg = load_env()</code>. Ensures storage dir. Determines batch mode via <code>P2T_BATCH</code> or <code>--batch</code> CLI. In batch mode runs <code>_run_batch(md_folder, output_folder)</code>. In web mode calls <code>create_app(cfg)</code> and <code>app.run(host,port)</code>. Validates <code>create_app</code> presence. </td></tr><tr><td data-label="Logic / Structure"> Robustness and defensive design              </td><td data-label="Conceptual Notes"> Heavy use of local imports to avoid hard deps at module import time. Multiple fallbacks for parsing, rendering, and writing. Clear logging on missing deps. Avoids crashing on edge cases; prefers best-effort output.                                           </td></tr><tr><td data-label="Logic / Structure"> Failure modes & guarantees                   </td><td data-label="Conceptual Notes"> If <code>pandas</code> missing batch aborts early. If <code>render_html</code> missing, fallback static HTML is written. Web mode requires <code>html_renderer.create_app</code> otherwise startup aborts with error.                                                                             </td></tr></tbody></table></div><div class="row-count">Rows: 15</div></div><div class="table-caption" id="Table3" data-table="Book_8065_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic/Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic/Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> Initializes environment, imports, and prepares configuration defaults for rendering HTML with optional UI assets.                                        </td><td data-label="Conceptual Notes"> Defensive startup: extends <code>sys.path</code>, initializes logging, records import attempts, and loads defaults from environment.                   </td></tr><tr><td data-label="Logic/Structure"> Exposes core API: <code>render_html</code>, <code>render_table</code>, <code>render_page</code>, all wrapped post-import for consistent post-processing.                                  </td><td data-label="Conceptual Notes"> Unified wrapper <code>_wrap_callable</code> ensures title, optional minification, UI injection, and table wrapping apply to every output path.         </td></tr><tr><td data-label="Logic/Structure"> Configuration layer <code>_renderer_config</code> with setter/getter.                                                                                               </td><td data-label="Conceptual Notes"> Centralized config management; allows toggling features like minify, table UI injection, or output path postprocessing.                     </td></tr><tr><td data-label="Logic/Structure"> <code>_ensure_title_attrs_in_str</code> enforces class/id on first <code>&lt;h1&gt;</code>.                                                                                          </td><td data-label="Conceptual Notes"> Guarantees consistent title markup even on malformed or minimal HTML inputs.                                                                </td></tr><tr><td data-label="Logic/Structure"> <code>_minify_html_str</code> compresses whitespace conservatively, excluding script/style/code/pre/textarea blocks.                                                </td><td data-label="Conceptual Notes"> Reduces size safely without corrupting embedded or inline code.                                                                             </td></tr><tr><td data-label="Logic/Structure"> <code>_inject_ui_assets</code> injects CSS/JS assets if not already present.                                                                                        </td><td data-label="Conceptual Notes"> Ensures front-end dependencies (PTT toolbar and scripts) appear once and only once.                                                         </td></tr><tr><td data-label="Logic/Structure"> <code>_wrap_each_table_with_ui</code> encapsulates all <code>&lt;table&gt;</code> elements with toolbar controls and metadata.                                                       </td><td data-label="Conceptual Notes"> Adds accessibility-friendly toolbar, generates unique IDs, handles captions and preceding headings, supports JSON embedding for table data. </td></tr><tr><td data-label="Logic/Structure"> <code>_convert_newlines_in_table_cells</code> replaces single newlines with <code>&lt;br&gt;</code> except inside <code>&lt;code&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;script&gt;</code>, <code>&lt;textarea&gt;</code>.                       </td><td data-label="Conceptual Notes"> Preserves cell formatting for multiline data without corrupting code or script blocks.                                                      </td></tr><tr><td data-label="Logic/Structure"> <code>_process_bytes</code> converts HTML bytes safely, applying title and minifier rules.                                                                          </td><td data-label="Conceptual Notes"> Enables byte-level processing for compatibility with binary outputs.                                                                        </td></tr><tr><td data-label="Logic/Structure"> Import chain: tries <code>render.core_compat</code>, then <code>render.core_renderer</code>, then defines fallbacks.                                                           </td><td data-label="Conceptual Notes"> Graceful degradation ensures basic rendering works even if main renderer unavailable.                                                       </td></tr><tr><td data-label="Logic/Structure"> Optional helper imports: <code>convert_bullets_to_ul</code>, <code>_normalize_list_markers</code>, <code>_unescape_brackets_outside_code</code>, <code>prepare_assets</code>, <code>write_overrides_css</code>. </td><td data-label="Conceptual Notes"> Expands rendering support for markdown conversion and static asset management when modules present.                                         </td></tr><tr><td data-label="Logic/Structure"> Fallback implementations of <code>render_html</code>, <code>render_table</code>, <code>render_page</code> use pandas for DataFrame rendering.                                             </td><td data-label="Conceptual Notes"> Fallback uses <code>dtype=str</code> conversion (<code>_df_to_str_safe</code>) to prevent numeric coercion and preserve textual fidelity.                         </td></tr><tr><td data-label="Logic/Structure"> <code>_df_to_html_preserve_code</code> preserves inline code spans marked with backticks.                                                                           </td><td data-label="Conceptual Notes"> Converts backticks to <code>&lt;code&gt;</code> safely while escaping other HTML characters.                                                                 </td></tr><tr><td data-label="Logic/Structure"> <code>_fallback_render_html</code> constructs complete HTML pages with consistent styling and calls post-processors.                                                </td><td data-label="Conceptual Notes"> Produces a full standalone HTML document even in degraded mode.                                                                             </td></tr><tr><td data-label="Logic/Structure"> <code>generate_diagnostic_report</code> summarizes import success, wrapping state, and sample transformations.                                                      </td><td data-label="Conceptual Notes"> Facilitates runtime debugging and verification of the rendering pipeline.                                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 15</div></div><div class="table-caption" id="Table4" data-table="Book_8065_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic / Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic / Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> Module header, imports, logger                                               </td><td data-label="Conceptual Notes"> Initializes <code>utils</code> logger and formats. Defensive imports only.                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <code>load_env</code>                                                                   </td><td data-label="Conceptual Notes"> Reads <code>.env</code>-style file into a dict without mutating <code>os.environ</code>. Comments ignored. <code>override</code> controls precedence.                                                                             </td></tr><tr><td data-label="Logic / Structure"> Logging helpers <code>init_logger</code> / <code>make_logger</code>                                </td><td data-label="Conceptual Notes"> Idempotent root and named logger setup. Adds console handler if missing. Consistent formatting.                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> Filesystem helpers <code>ensure_dir</code>, <code>safe_join</code>                                 </td><td data-label="Conceptual Notes"> <code>ensure_dir</code> creates and chmods directories. <code>safe_join</code> resolves and prevents path traversal. Raises <code>ValueError</code> on attempts.                                                                  </td></tr><tr><td data-label="Logic / Structure"> Removal and atomic write <code>safe_remove</code>, <code>atomic_write</code>, <code>atomic_write_bytes</code> </td><td data-label="Conceptual Notes"> Safe file delete. Atomic write via <code>NamedTemporaryFile</code> + <code>os.replace</code>. Binary and text modes supported. Cleans temp on failure.                                                                 </td></tr><tr><td data-label="Logic / Structure"> Utility conversions <code>try_int</code>, <code>checksum_file</code>                               </td><td data-label="Conceptual Notes"> Robust int conversion. File checksum with chunked read and chosen algorithm. Returns <code>None</code> on failure.                                                                                          </td></tr><tr><td data-label="Logic / Structure"> Env validation <code>validate_env_keys</code>                                           </td><td data-label="Conceptual Notes"> Checks required keys. Logs missing keys. Optionally raises <code>ValueError</code>.                                                                                                                         </td></tr><tr><td data-label="Logic / Structure"> Markdown / table parsing helpers                                             </td><td data-label="Conceptual Notes"> <code>normalize_whitespace</code>, <code>split_table_row</code>, <code>is_table_separator</code>, <code>parse_table</code>.<br><code>split_table_row</code> honors escaped pipes and backtick code spans. Parser preserves underscores and inline text. </td></tr><tr><td data-label="Logic / Structure"> List and slug helpers                                                        </td><td data-label="Conceptual Notes"> <code>is_list_item</code>, <code>extract_list</code>, <code>safe_slug</code> for safe IDs. <code>safe_slug</code> preserves underscores.                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> Line utilities <code>chunk_lines</code>, <code>strip_comments</code>                               </td><td data-label="Conceptual Notes"> <code>chunk_lines</code> splits by marker. <code>strip_comments</code> removes <code>#</code>/<code>//</code> but avoids stripping inside URL schemes.                                                                                       </td></tr><tr><td data-label="Logic / Structure"> Group index scanning <code>scan_table_groups</code>                                     </td><td data-label="Conceptual Notes"> Scans storage for allowed extensions, groups by subfolder or filename heuristic, collects files and first-line descriptions.                                                                     </td></tr><tr><td data-label="Logic / Structure"> Group key heuristic <code>_group_key_from_filename</code>                               </td><td data-label="Conceptual Notes"> Drops trailing numeric index for filenames with 3+ underscore parts. Keeps two-part names intact.                                                                                                </td></tr><tr><td data-label="Logic / Structure"> Groups payload helpers                                                       </td><td data-label="Conceptual Notes"> <code>generate_groups_index</code> builds payload with timestamp. <code>validate_groups_index</code> enforces schema constraints.                                                                                      </td></tr><tr><td data-label="Logic / Structure"> Atomic write + backup rotation <code>write_groups_index</code>, <code>_rotate_backups</code>       </td><td data-label="Conceptual Notes"> Validates payload, rotates backups best-effort, writes atomically, sets permissive file mode, returns written <code>Path</code>.                                                                            </td></tr><tr><td data-label="Logic / Structure"> Read helper <code>read_groups_index</code>                                              </td><td data-label="Conceptual Notes"> Safely reads and validates groups_index.json. Returns <code>None</code> on failure.                                                                                                                         </td></tr><tr><td data-label="Logic / Structure"> Exports <code>__all__</code>                                                            </td><td data-label="Conceptual Notes"> Backwards-compatible public API list for env, logging, FS, parsing, and group index functions.                                                                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><div class="table-caption" id="Table5" data-table="Book_8065_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic/Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic/Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> Imports <code>render_html</code>, <code>render_table</code>, and <code>render_page</code> from local module <code>core_compat</code>. </td><td data-label="Conceptual Notes"> Establishes import shortcuts so other modules can access these functions directly from the package root.                </td></tr><tr><td data-label="Logic/Structure"> Defines <code>__all__</code> to explicitly expose only these three names.                            </td><td data-label="Conceptual Notes"> Controls the package’s public API, preventing leakage of internal functions and clarifying intended external interface. </td></tr></tbody></table></div><div class="row-count">Rows: 2</div></div><div class="table-caption" id="Table6" data-table="Book_8065_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic/Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic/Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> <code>_EMBED_STYLE</code> and <code>_EMBED_SCRIPT</code> constants hold minimal fallback CSS and JS.       </td><td data-label="Conceptual Notes"> Provide safe minimal assets when project assets are missing. Kept tiny to avoid runtime dependency on external files.                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic/Structure"> <code>copy_assets(output_dir: str)</code>                                                       </td><td data-label="Conceptual Notes"> Creates <code>output_dir/assets</code>. Locates project assets at <code>os.path.join(dirname(__file__), &quot;..&quot;, &quot;assets&quot;)</code> and normalizes path. For each of <code>style.css</code> and <code>script.js</code> it attempts to copy the source file to the output. If source missing or any exception occurs it writes the corresponding fallback constant. Uses <code>shutil.copy2</code> to preserve metadata. All errors are swallowed and replaced with fallback files. </td></tr><tr><td data-label="Logic/Structure"> <code>write_overrides_css(output_dir: str, left_width: float, right_width: float) -&gt; str</code> </td><td data-label="Conceptual Notes"> Ensures <code>output_dir/assets</code> exists. Builds a large <code>overrides_css</code> string containing theme variables, dark-mode overrides, sticky-first-column rules, zebra rows, list marker normalization, and width assignments that embed <code>{left_width:.2f}%</code> and <code>{right_width:.2f}%</code>. Attempts to write <code>overrides.css</code> and ignores write errors. Returns the generated CSS string for immediate use.                            </td></tr><tr><td data-label="Logic/Structure"> Error and side-effect behavior                                                       </td><td data-label="Conceptual Notes"> Both functions perform file-system writes as side effects. They follow a best-effort model: create dirs, write or copy files, and suppress exceptions rather than propagating them. This favors robustness but can hide underlying failures.                                                                                                                                                                           </td></tr><tr><td data-label="Logic/Structure"> Compatibility and risks                                                              </td><td data-label="Conceptual Notes"> Relative path to project assets uses <code>__file__</code> + <code>..</code>; this works for typical filesystem installs but may break in zipped/packaged distributions. Broad <code>except Exception</code> blocks may mask permission or path errors. <code>left_width</code> and <code>right_width</code> are formatted as floats into CSS; if values are not validated they could produce invalid or unintended widths.                                                   </td></tr><tr><td data-label="Logic/Structure"> Idempotence and usage                                                                </td><td data-label="Conceptual Notes"> Functions are idempotent for same inputs. Intended for static site output or export tasks. Caller must provide a safe <code>output_dir</code>. <code>write_overrides_css</code> returns the CSS so caller can embed it without reading the file.                                                                                                                                                                                             </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table7" data-table="Book_8065_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic/Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic/Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> Entry-point CLI script. Uses <code>argparse</code> to accept <code>source</code>, <code>-o/--output</code>, and <code>--embed-assets</code>.                                                                                                                                                                                      </td><td data-label="Conceptual Notes"> Minimal UX for rendering a source file/dir to HTML. Defaults output to <code>output_combined</code>.                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Logic/Structure"> Imports <code>render_html</code> from <code>render.core_compat</code> with fallback to <code>from render import render_html</code>.                                                                                                                                                                                    </td><td data-label="Conceptual Notes"> Handles package layout differences so script works both as installed package and as local module.                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Logic/Structure"> Attempts to locate <code>RenderConfig</code> from <code>render.types</code> then <code>render</code> then falls back to <code>None</code>.                                                                                                                                                                                        </td><td data-label="Conceptual Notes"> Flexible discovery for different package versions. Makes script resilient when type moved or omitted.                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Logic/Structure"> <code>_make_config(output_path: Path, embed_assets: bool)</code> tries multiple constructor signatures (<code>output_dir</code>, <code>output_path</code>, <code>output</code>) and finally tries empty constructor; returns <code>None</code> if none succeed.                                                                              </td><td data-label="Conceptual Notes"> Best-effort construction to accommodate API drift. Uses nested <code>try/except TypeError</code> to detect incompatible signatures. Suppresses other constructor exceptions and returns <code>None</code>.                                                                                                                                                                                     </td></tr><tr><td data-label="Logic/Structure"> <code>main()</code> composes <code>src</code>, <code>out</code>, and <code>cfg</code>. If <code>cfg</code> present it calls <code>render_html(str(src), config=cfg)</code> and if that raises <code>TypeError</code> tries <code>render_html(str(src), str(out), config=cfg)</code>. If <code>cfg</code> is <code>None</code> tries <code>render_html(str(src), str(out))</code> then <code>render_html(str(src))</code>. </td><td data-label="Conceptual Notes"> Attempts multiple common <code>render_html</code> signatures. Swallows <code>TypeError</code> to probe alternate signatures. Ensures script works against several API variants.                                                                                                                                                                                                                </td></tr><tr><td data-label="Logic/Structure"> Returns value of <code>render_html</code> and exits via <code>SystemExit(main())</code> when executed as <code>__main__</code>.                                                                                                                                                                                        </td><td data-label="Conceptual Notes"> Exit code depends on <code>render_html</code> return value and Python's <code>SystemExit</code> handling.                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic/Structure"> Error handling and side effects                                                                                                                                                                                                                                                       </td><td data-label="Conceptual Notes"> Many broad <code>except Exception</code> and <code>except TypeError</code> blocks. These increase robustness across versions but can mask real errors (permissions, import-path mistakes, runtime exceptions from <code>RenderConfig</code> constructor). No logging or user-visible diagnostics.                                                                                                         </td></tr><tr><td data-label="Logic/Structure"> Risks and edge cases                                                                                                                                                                                                                                                                  </td><td data-label="Conceptual Notes"> If <code>render_html</code> raises exceptions other than <code>TypeError</code> those propagate to user. Silent fallbacks can hide why a command failed. Path handling uses <code>Path</code> and string conversion; works normally but may behave differently on non-filesystem or packaged runtimes. If <code>RenderConfig</code> constructor has required args not tried here script will proceed without config. </td></tr><tr><td data-label="Logic/Structure"> Suggestions (low-friction)                                                                                                                                                                                                                                                            </td><td data-label="Conceptual Notes"> Add minimal logging on import/constructor fallbacks. Narrow excepts where possible. Return consistent exit codes (0 on success, nonzero on failure) and surface underlying exceptions to help debugging.                                                                                                                                                                 </td></tr><tr><td data-label="Logic/Structure"> Idempotence and intended usage                                                                                                                                                                                                                                                        </td><td data-label="Conceptual Notes"> Idempotent for same inputs. Intended as a portable CLI wrapper for rendering tasks across multiple releases of the <code>render</code> package.                                                                                                                                                                                                                                     </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table8" data-table="Book_8065_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic/Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic/Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> Module purpose                            </td><td data-label="Conceptual Notes"> PasteToTable converter. Parses Markdown pipe-tables and CSV. Provides HTML render pipeline. Public API exports at bottom.                                                                                                                                                                         </td></tr><tr><td data-label="Logic/Structure"> Top-level imports & logger                </td><td data-label="Conceptual Notes"> Uses stdlib plus optional <code>utils</code> and <code>pandas</code>. Logger uses NullHandler for silent default.                                                                                                                                                                                                       </td></tr><tr><td data-label="Logic/Structure"> Regex & stash constants                   </td><td data-label="Conceptual Notes"> <code>_PRE_RE</code>, <code>_CODE_RE</code>, <code>_DIVIDER_PART_RE</code>, <code>_INLINE_CODE_STASH_RE</code> detect pre/code/divider and stash inline backtick runs. Enables multi-backtick-safe splitting.                                                                                                                                 </td></tr><tr><td data-label="Logic/Structure"> Optional <code>utils</code> fallback implementations </td><td data-label="Conceptual Notes"> Provides safe fallbacks if project <code>utils</code> missing: <code>_strip_tags</code>, <code>sanitize_bold_html</code>, <code>convert_markdown_lists</code>, <code>_escape_unmatched_markers</code>, <code>_apply_left_col_heading</code>. Fallbacks are defensive.                                                                                               </td></tr><tr><td data-label="Logic/Structure"> Code-span stash/restore helpers           </td><td data-label="Conceptual Notes"> <code>_stash_code_spans</code>, <code>_restore_code_spans</code>, <code>_split_row_keep_code</code> handle stash/restore and split on unescaped. Crucial for parsing code spans containing pipes.                                                                                                                                  </td></tr><tr><td data-label="Logic/Structure"> CSV detection and parsing                 </td><td data-label="Conceptual Notes"> <code>_looks_like_csv</code> heuristic; <code>parse_csv_tables</code> uses <code>csv.Sniffer</code> with deterministic fallback to most-common delimiter. Normalizes <code>rows</code> and <code>header</code>. Handles BOM, NBSP, zero-width chars, and HTML entities.                                                                                  </td></tr><tr><td data-label="Logic/Structure"> Markdown pipe-table parser                </td><td data-label="Conceptual Notes"> <code>parse_markdown_tables</code> scans for header+divider using <code>_DIVIDER_PART_RE</code> and <code>_split_row_keep_code</code>. Outputs list of <code>{&quot;rows&quot;: ..., &quot;header&quot;: True, &quot;source&quot;: &quot;pipe_markdown&quot;}</code>.                                                                                                                 </td></tr><tr><td data-label="Logic/Structure"> Simple DataFrame shim                     </td><td data-label="Conceptual Notes"> <code>_SimpleDF</code> and <code>_SimpleColumns</code> act as minimal DataFrame replacements when <code>pandas</code> absent. Used by <code>extract_tables_debug</code>, <code>convert_structure</code>, and render pipeline.                                                                                                                            </td></tr><tr><td data-label="Logic/Structure"> extract_tables_debug                      </td><td data-label="Conceptual Notes"> Finds candidate pipe-table blocks. Returns pipe-tables as DataFrames (if <code>pandas</code> available) or <code>_SimpleDF</code>. Falls back to CSV autodetect when no pipe-tables found. Normalizes quotes and dashes. Returns <code>(pipe_tables, html_tables)</code> (html_tables unused).                                     </td></tr><tr><td data-label="Logic/Structure"> Markdown renderer selection               </td><td data-label="Conceptual Notes"> <code>_get_default_markdown_renderer</code> tries project shim <code>markdown.get_markdown_renderer</code>, else uses fallback supporting inline/blockquote syntax. Returns callable <code>markdown_to_html</code>.                                                                                                                </td></tr><tr><td data-label="Logic/Structure"> render_table                              </td><td data-label="Conceptual Notes"> Core HTML renderer. Accepts <code>df</code> or iterable. Detects columns, samples rows, infers alignments via <code>_detect_column_types</code>. Uses markdown renderer for cells, applies sanitizers and marker-escaping, builds HTML table with sticky-first-column and control buttons. Returns HTML string.         </td></tr><tr><td data-label="Logic/Structure"> convert_structure & convert_text_to_html  </td><td data-label="Conceptual Notes"> High-level helpers: <code>convert_structure</code> converts first markdown table to HTML; <code>convert_text_to_html</code> converts all tables to concatenated HTML or falls back to rendering the whole text if none detected.                                                                                        </td></tr><tr><td data-label="Logic/Structure"> Error-handling model                      </td><td data-label="Conceptual Notes"> Extensive <code>try/except Exception</code> and fallback layers. Prioritizes resilience and API drift tolerance. May mask IO, encoding, or logic errors.                                                                                                                                                     </td></tr><tr><td data-label="Logic/Structure"> Side-effects                              </td><td data-label="Conceptual Notes"> No file IO or global state. Functions pure except for logging. <code>_get_default_markdown_renderer</code> and <code>render_table</code> may call optional external code.                                                                                                                                               </td></tr><tr><td data-label="Logic/Structure"> Edge-cases & risks                        </td><td data-label="Conceptual Notes"> CSV <code>Sniffer</code> can mis-detect on small samples. <code>_looks_like_csv</code> may misclassify pipe-tables with sparse pipes. Broad excepts can hide Unicode or dialect errors. Inline stash uses <code>\x00</code> markers, risk of collision with rare input. <code>render_table</code> truncates rows longer than header silently. </td></tr><tr><td data-label="Logic/Structure"> Small correctness notes                   </td><td data-label="Conceptual Notes"> <code>_split_row_keep_code</code> restores escaped <code>\|</code>. <code>_detect_column_types</code> strips commas/percent/parens for numeric detection but may misclassify localized formats. Header detection heuristic may be noisy.                                                                                           </td></tr><tr><td data-label="Logic/Structure"> Suggestions (low-friction)                </td><td data-label="Conceptual Notes"> 1) Narrow exception scopes. 2) Add unit tests for nested code spans, escaped pipes, mixed delimiters, small-sample sniffing. 3) Expose deterministic delimiter for <code>parse_csv_tables</code>. 4) Replace <code>\x00CODE{}</code> with UUID placeholders. 5) Add debug flag for fallback reporting.                  </td></tr><tr><td data-label="Logic/Structure"> Public API                                </td><td data-label="Conceptual Notes"> Exports: <code>parse_markdown_tables</code>, <code>parse_csv_tables</code>, <code>render_table</code>, <code>extract_tables_debug</code>, <code>_SimpleDF</code>, <code>_SimpleColumns</code>, <code>convert_structure</code>, <code>convert_text_to_html</code>. Stable signatures expected; internal drift tolerated.                                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table9" data-table="Book_8065_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic/Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic/Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> Module purpose & public API           </td><td data-label="Conceptual Notes"> Robust asset discovery, safe copying, optional fingerprinting and manifest generation, SRI computation, and helpers to inline fallbacks. Public APIs: <code>prepare_assets(cfg, out_dir) -&gt; (assets_dir, style_fallback, script_fallback, assets_written)</code>, <code>write_overrides_css(out_dir, left_width, right_width)</code>, <code>compute_sri(path, algo=&quot;sha384&quot;)</code>, <code>write_assets_manifest(...)</code>, <code>write_assets_info(...)</code>, <code>resolve_asset_name(logical_name, assets_dir)</code>, plus <code>make_link_tag_for_css</code> and <code>make_script_tag_for_js</code>.                                                                 </td></tr><tr><td data-label="Logic/Structure"> Preference for project/core helpers   </td><td data-label="Conceptual Notes"> Attempts to import project-provided <code>.assets</code> helpers (<code>_copy_assets_impl</code>, <code>_write_overrides_impl</code>, <code>_EMBED_STYLE</code>, <code>_EMBED_SCRIPT</code>). Prefers <code>core_io</code> atomic helpers (<code>_atomic_write</code>, <code>_atomic_stream_write</code>, <code>_ensure_dir</code>) when available. Fallbacks provided when optional modules missing.                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Logic/Structure"> Atomic write & copy strategy          </td><td data-label="Conceptual Notes"> Implements <code>_fallback_atomic_write</code> and <code>_fallback_atomic_copy</code> using same-directory NamedTemporaryFile then <code>os.replace</code> for atomicity. <code>_atomic_*_dispatch</code> chooses core_io implementations when present, otherwise fallback. <code>copystat</code> attempted to preserve perms/times.                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic/Structure"> Directory creation & ensuring files   </td><td data-label="Conceptual Notes"> <code>_ensure_dir_dispatch</code> uses core_io if available, else <code>mkdir/os.makedirs</code>. <code>_ensure_non_empty_file(path, fallback_text)</code> ensures required files exist and are at least 10 bytes. <code>_safe_write_text</code> wraps atomic write and returns success boolean.                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Logic/Structure"> Asset discovery & copy policy         </td><td data-label="Conceptual Notes"> <code>_discover_candidate_asset_dirs()</code> returns prioritized candidates (repo-root, cwd/assets, package sibling, package assets). <code>_copy_from_source_assets</code> copies files with controls: <code>cfg.max_asset_copy_size</code>, <code>cfg.asset_copy_whitelist</code>, <code>cfg.asset_copy_blacklist</code>, <code>cfg.fingerprint_assets</code>, <code>cfg.fingerprint_len</code>, <code>cfg.force_copy_assets</code>. Skips overwriting non-empty files unless forced. Fingerprinting inserts short sha256 fragment into filename via <code>_insert_hash_before_ext</code>. Returns whether anything was copied and optionally fills <code>logical_map</code> when fingerprinting. </td></tr><tr><td data-label="Logic/Structure"> Manifest and diagnostic writers       </td><td data-label="Conceptual Notes"> <code>write_assets_manifest</code> builds JSON with generated timestamp and per-file <code>{size, mtime, sri}</code> and optional <code>mapping</code>. <code>write_assets_info</code> writes a lightweight diagnostic file. Both use <code>_safe_write_text</code>.                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic/Structure"> SRI and hashing helpers               </td><td data-label="Conceptual Notes"> <code>compute_sri(path, algo)</code> returns <code>algo-&lt;base64digest&gt;</code> or empty string on failure. <code>_compute_hash_hex</code> returns hex digest. These are used for integrity attributes in generated tags.                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Logic/Structure"> Asset resolution & tag helpers        </td><td data-label="Conceptual Notes"> <code>resolve_asset_name</code> reads <code>assets-manifest.json</code> mapping first, then checks direct presence, then best-effort pattern match for fingerprinted names. <code>make_link_tag_for_css</code> and <code>make_script_tag_for_js</code> build <code>&lt;link&gt;</code>/<code>&lt;script&gt;</code> tags including <code>integrity</code> and <code>crossorigin=&quot;anonymous&quot;</code> when SRI available.                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Logic/Structure"> <code>write_overrides_css</code> behavior        </td><td data-label="Conceptual Notes"> Prefers project-provided <code>_write_overrides_impl</code>. Fallback normalizes input percents, clamps values, generates a conservative responsive CSS file at <code>out_dir/assets/overrides.css</code>. Uses <code>_ensure_dir_dispatch</code> and <code>_safe_write_text</code>.                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Logic/Structure"> <code>prepare_assets</code> flow                 </td><td data-label="Conceptual Notes"> 1) Determine <code>assets_dir</code> from <code>cfg.assets_dir</code> or <code>out_dir/assets</code>.  <br>2) Try project <code>_copy_assets_impl</code> if callable.  <br>3) Else run <code>_copy_from_source_assets</code>.  <br>4) Ensure placeholders for <code>style.css</code>, <code>script.js</code>, <code>worker.js</code>, <code>overrides.css</code> using embedded fallbacks if present.  <br>5) Optionally generate manifest when <code>cfg.generate_manifest</code> true.  <br>6) Write <code>assets-info.json</code>.  <br>7) Log summary and return <code>(assets_dir, style_fallback, script_fallback, assets_written)</code>.                                                                           </td></tr><tr><td data-label="Logic/Structure"> Side-effects and idempotence          </td><td data-label="Conceptual Notes"> Side-effects are file-system writes and copies. Behavior is mostly idempotent: existing non-empty files are preserved unless <code>force_copy_assets</code> is set. Atomic operations reduce partial-write races but do not prevent cross-process race conditions entirely.                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Logic/Structure"> Error handling & logging              </td><td data-label="Conceptual Notes"> Extensive <code>try/except</code> blocks swallow many errors and log at debug level. This maximizes robustness but can hide root causes. Logger uses <code>NullHandler()</code> so messages are quiet unless user configures logging.                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Logic/Structure"> Performance & security considerations </td><td data-label="Conceptual Notes"> SRI and fingerprinting require reading full file contents; manifest generation can be CPU/IO heavy on large asset sets. <code>compute_sri</code> and <code>_compute_hash_hex</code> support algorithm selection but fallback behavior returns empty SRI on failure. <code>make_*_tag</code> uses <code>crossorigin=&quot;anonymous&quot;</code> which is correct for SRI.                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Logic/Structure"> Edge cases & risks                    </td><td data-label="Conceptual Notes"> - <code>_discover_candidate_asset_dirs</code> uses <code>__file__</code> parent traversal; packaged/zip imports or unusual layouts may break detection. - Pattern match in <code>resolve_asset_name</code> may return first match and can be ambiguous. - <code>_ensure_non_empty_file</code> threshold (10 bytes) may treat tiny valid assets as missing. - Broad excepts can hide permission, disk-full, or filesystem errors. - Fingerprint insertion preserves multi-dot filenames but may still collide.                                                                                                                      </td></tr><tr><td data-label="Logic/Structure"> Low-friction suggestions </td><td data-label="Conceptual Notes"> 1) Surface one-line warnings when fallbacks are used (INFO or WARNING) so users see why project helpers didn't run.<br>2) Narrow some broad <code>except Exception</code> where you expect specific failures.<br>3) Allow configurable tmp directory for atomic writes.<br>4) Expose option to force manifest SRI algorithm and to skip SRI compute for very large files.<br>5) Add unit tests for discovery in packaged installs and for concurrent runs. </td></tr></tbody></table></div><div class="row-count">Rows: 15</div></div><div class="table-caption" id="Table10" data-table="Book_8065_10" style="margin-top:2mm;margin-left:3mm;"><strong>Table 10</strong></div>
<div class="table-wrapper" data-table-id="table-10"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic/Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic/Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> Compatibility wrapper      </td><td data-label="Conceptual Notes"> Re-exports key public API functions from internal modules to provide stable import paths externally.                             </td></tr><tr><td data-label="Logic/Structure"> Imports with error checks  </td><td data-label="Conceptual Notes"> Attempts to import <code>render_html</code> from <code>core_renderer</code> and <code>render_table</code> from <code>core_table</code>. Raises clear ImportError if missing. </td></tr><tr><td data-label="Logic/Structure"> Alias for backwards compat </td><td data-label="Conceptual Notes"> Defines <code>render_page</code> as alias for <code>render_html</code> to preserve legacy code compatibility.                                          </td></tr><tr><td data-label="Logic/Structure"> Exported API               </td><td data-label="Conceptual Notes"> Sets <code>__all__</code> to explicitly declare public API: <code>render_html</code>, <code>render_table</code>, <code>render_page</code>.                                   </td></tr></tbody></table></div><div class="row-count">Rows: 4</div></div><div class="table-caption" id="Table11" data-table="Book_8065_11" style="margin-top:2mm;margin-left:3mm;"><strong>Table 11</strong></div>
<div class="table-wrapper" data-table-id="table-11"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic/Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic/Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> Module: <code>render/core_fragments.py</code>     </td><td data-label="Conceptual Notes"> Central engine for concurrent table fragment rendering. Supports Markdown, CSV, TSV, and HTML table extraction with optional external parsing bridges.                                                                                    </td></tr><tr><td data-label="Logic/Structure"> Imports and setup                      </td><td data-label="Conceptual Notes"> Uses <code>concurrent.futures</code>, <code>re</code>, <code>csv</code>, <code>html</code>, and optional dependencies (<code>BeautifulSoup</code>, <code>pandas</code>). Logging is namespaced. Optional helpers (<code>_atomic_stream_write</code>, <code>_render_table_helper</code>, <code>_convert_*</code>) are conditionally imported. </td></tr><tr><td data-label="Logic/Structure"> <code>_atomic_write_text()</code>                 </td><td data-label="Conceptual Notes"> Ensures atomic disk writes via temp file rename to prevent partial writes.                                                                                                                                                                </td></tr><tr><td data-label="Logic/Structure"> <code>_normalize_table_text()</code>              </td><td data-label="Conceptual Notes"> Normalizes Unicode, removes zero-width chars, standardizes line breaks, replaces special dashes, and trims trailing spaces for robust text parsing.                                                                                       </td></tr><tr><td data-label="Logic/Structure"> <code>_split_row_keep_code()</code>               </td><td data-label="Conceptual Notes"> Splits Markdown pipe-table rows while respecting escaped and inline-code pipes. Prevents breaking table cells inside code spans.                                                                                                          </td></tr><tr><td data-label="Logic/Structure"> <code>_split_pipe_cells()</code>                  </td><td data-label="Conceptual Notes"> Wrapper with fallback naive split when <code>_split_row_keep_code</code> fails.                                                                                                                                                                      </td></tr><tr><td data-label="Logic/Structure"> <code>_is_divider_line()</code>                   </td><td data-label="Conceptual Notes"> Detects Markdown table divider rows using regex.                                                                                                                                                                                          </td></tr><tr><td data-label="Logic/Structure"> <code>_extract_pipe_tables_from_markdown()</code> </td><td data-label="Conceptual Notes"> Extracts Markdown pipe-style tables, returning lists of (rows, header_flag).                                                                                                                                                              </td></tr><tr><td data-label="Logic/Structure"> <code>_parse_table_html_regex()</code>            </td><td data-label="Conceptual Notes"> Lightweight fallback HTML <code>&lt;table&gt;</code> parser using regex when <code>bs4</code> is unavailable. Extracts <code>&lt;td&gt;</code> and <code>&lt;th&gt;</code> text.                                                                                                                        </td></tr><tr><td data-label="Logic/Structure"> <code>_extract_table_blocks_from_html()</code>    </td><td data-label="Conceptual Notes"> Extracts HTML tables via BeautifulSoup if available, else regex fallback. Returns structured rows with header flag.                                                                                                                       </td></tr><tr><td data-label="Logic/Structure"> <code>_convert_rows_to_df_like()</code>           </td><td data-label="Conceptual Notes"> Converts parsed rows into pandas <code>DataFrame</code> if available; otherwise returns list-of-dicts (header) or list-of-lists.                                                                                                                     </td></tr><tr><td data-label="Logic/Structure"> <code>_simple_render_table()</code>               </td><td data-label="Conceptual Notes"> Fallback HTML generator for table-like objects. Handles DataFrames, list-of-dicts, and list-of-lists. Produces basic <code>&lt;table&gt;</code> HTML.                                                                                                      </td></tr><tr><td data-label="Logic/Structure"> <code>_process_simple_render_job()</code>         </td><td data-label="Conceptual Notes"> Picklable worker for multiprocessing. Renders a single table fragment and measures render time.                                                                                                                                           </td></tr><tr><td data-label="Logic/Structure"> <code>_is_probable_csv()</code>                   </td><td data-label="Conceptual Notes"> Heuristic detector for CSV/TSV-like text using delimiter frequency analysis. Suggests likely delimiter.                                                                                                                                   </td></tr><tr><td data-label="Logic/Structure"> <code>_parse_csv_text_to_rows()</code>            </td><td data-label="Conceptual Notes"> Parses CSV/TSV text into rows using <code>csv.Sniffer</code>. Infers header row when possible.                                                                                                                                                       </td></tr><tr><td data-label="Logic/Structure"> <code>render_fragments_concurrently()</code>      </td><td data-label="Conceptual Notes"> Main orchestration: detects table types, normalizes input, converts to DataFrame-like, and concurrently renders to HTML fragments.                                                                                                        </td></tr><tr><td data-label="Logic/Structure"> Input normalization block              </td><td data-label="Conceptual Notes"> Accepts various input forms (string, path, bytes, list, dict, DataFrame). Reads files, decodes bytes, identifies source type, and prepares metadata.                                                                                      </td></tr><tr><td data-label="Logic/Structure"> Table detection sequence               </td><td data-label="Conceptual Notes"> Priority: external Markdown parser → local pipe-table → fenced CSV → raw CSV/TSV → rendered HTML table extraction. Each step upgrades detection fidelity.                                                                                 </td></tr><tr><td data-label="Logic/Structure"> Concurrency setup                      </td><td data-label="Conceptual Notes"> Uses <code>ThreadPoolExecutor</code> or <code>ProcessPoolExecutor</code> depending on <code>use_process</code>. Controls per-fragment rendering and atomic write.                                                                                                          </td></tr><tr><td data-label="Logic/Structure"> <code>_detect_assets_from_html()</code>           </td><td data-label="Conceptual Notes"> Scans HTML for script dependencies (xlsx, prismjs, virtualize, etc.) to produce dynamic asset list.                                                                                                                                       </td></tr><tr><td data-label="Logic/Structure"> Metadata tracking                      </td><td data-label="Conceptual Notes"> Maintains <code>fragments_map</code>, <code>frag_row_counts</code>, and <code>warnings</code>. Tracks unique table IDs for deduplicated fragment titles.                                                                                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 21</div></div><div class="table-caption" id="Table12" data-table="Book_8065_12" style="margin-top:2mm;margin-left:3mm;"><strong>Table 12</strong></div>
<div class="table-wrapper" data-table-id="table-12"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic/Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic/Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> Module: <code>render/core_io.py</code>         </td><td data-label="Conceptual Notes"> Provides atomic file operations, safe directory creation, and CSV extraction utilities. Designed for reliability, filesystem safety, and integration with higher-level render components. </td></tr><tr><td data-label="Logic/Structure"> <strong>Imports and setup</strong>               </td><td data-label="Conceptual Notes"> Uses <code>pathlib</code>, <code>os</code>, <code>tempfile</code>, <code>uuid</code>, <code>csv</code>, and <code>hashlib</code>. Implements optional override via project-provided <code>render.io_utils</code>. Logging namespace: <code>render.core_io</code>.                 </td></tr><tr><td data-label="Logic/Structure"> Dynamic import of <code>render.io_utils</code> </td><td data-label="Conceptual Notes"> Tries to import project-local I/O helpers (<code>atomic_write</code>, <code>atomic_stream_write</code>, <code>ensure_dir</code>) and assigns to internal fallbacks if not available. Promotes modular substitution.        </td></tr><tr><td data-label="Logic/Structure"> <code>_ensure_dir_path()</code>                </td><td data-label="Conceptual Notes"> Ensures directory existence safely under race conditions. Uses both <code>mkdir</code> and <code>os.makedirs</code> fallback for compatibility.                                                                 </td></tr><tr><td data-label="Logic/Structure"> <code>_default_write_atomic()</code>           </td><td data-label="Conceptual Notes"> Performs robust atomic writes using temp file + <code>os.replace</code>. Flushes and <code>fsync</code>s data to ensure disk consistency. Sets file mode before replacement.                                    </td></tr><tr><td data-label="Logic/Structure"> <code>_default_stream_write()</code>           </td><td data-label="Conceptual Notes"> Wrapper for stream-based atomic writes. Shares atomic guarantees with <code>_default_write_atomic()</code>.                                                                                          </td></tr><tr><td data-label="Logic/Structure"> <code>_is_valid_file()</code>                  </td><td data-label="Conceptual Notes"> Quick existence and nonzero-size check with safe fallback on exceptions.                                                                                                                  </td></tr><tr><td data-label="Logic/Structure"> <code>tmp_frag_dir_for()</code>                </td><td data-label="Conceptual Notes"> Creates unique temporary subdirectory under an output directory for fragment storage. Names include timestamp, process ID, and random suffix for collision safety.                        </td></tr><tr><td data-label="Logic/Structure"> Re-export section                   </td><td data-label="Conceptual Notes"> Selects between project-provided or default implementations for <code>_atomic_write</code>, <code>_atomic_stream_write</code>, and <code>_ensure_dir</code>.                                                               </td></tr><tr><td data-label="Logic/Structure"> <code>atomic_write_text()</code>               </td><td data-label="Conceptual Notes"> Public API for atomic text writes. Uses UTF-8 encoding and safe writer callback pattern.                                                                                                  </td></tr><tr><td data-label="Logic/Structure"> <code>atomic_write_bytes()</code>              </td><td data-label="Conceptual Notes"> Handles binary writes atomically. Adapts text-mode temp files for byte writes through <code>buffer</code> access or Latin-1 fallback.                                                                </td></tr><tr><td data-label="Logic/Structure"> <code>atomic_stream_write()</code>             </td><td data-label="Conceptual Notes"> Public wrapper for atomic streaming writes using a provided writer callback.                                                                                                              </td></tr><tr><td data-label="Logic/Structure"> <code>ensure_dir()</code>                      </td><td data-label="Conceptual Notes"> Public directory creation wrapper exposing safe <code>_ensure_dir_path</code>.                                                                                                                       </td></tr><tr><td data-label="Logic/Structure"> <code>_detect_encoding_from_bytes()</code>     </td><td data-label="Conceptual Notes"> Determines likely encoding from sample bytes. Detects BOM and falls back among <code>utf-8</code>, <code>utf-8-sig</code>, and <code>latin-1</code>.                                                                       </td></tr><tr><td data-label="Logic/Structure"> <code>_detect_csv_dialect()</code>             </td><td data-label="Conceptual Notes"> Uses <code>csv.Sniffer</code> to infer delimiter and quoting style from sample text, with fallback dialect class for robustness.                                                                     </td></tr><tr><td data-label="Logic/Structure"> <code>extract_table_source()</code>            </td><td data-label="Conceptual Notes"> Reads limited sample from a CSV-like source, detecting encoding, delimiter, quotechar, headers, sample rows, and optional SHA-256 hash. Accepts file path, bytes, or stream.              </td></tr><tr><td data-label="Logic/Structure"> <code>read_csv_rows()</code>                   </td><td data-label="Conceptual Notes"> Reads up to <code>max_rows</code> lines from a CSV file safely. Detects encoding and dialect automatically unless overridden.                                                                        </td></tr><tr><td data-label="Logic/Structure"> <strong>Export list (<code>__all__</code>)</strong>         </td><td data-label="Conceptual Notes"> Exposes only stable public functions for atomic write, directory management, and CSV reading. Protects internal helper functions.                                                         </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table13" data-table="Book_8065_13" style="margin-top:2mm;margin-left:3mm;"><strong>Table 13</strong></div>
<div class="table-wrapper" data-table-id="table-13"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module Purpose</strong>                   </td><td data-label="Conceptual Notes"> Main rendering orchestrator that builds complete HTML outputs from parsed table fragments. Handles asset injection, TOC assembly, export JS, and safe atomic writes. Core integration point joining I/O, parsing, and rendering subsystems.                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Imports</strong>                          </td><td data-label="Conceptual Notes"> Pulls internal helpers from <code>core_io</code> (<code>_default_write_atomic</code>, <code>_ensure_dir_path</code>, etc.) and parsing/rendering utilities from <code>core_fragments</code>, <code>core_table</code>, and <code>core_assets</code>. Optional external imports (<code>pandas</code>, <code>BeautifulSoup</code>, <code>markdown</code>). Logging and concurrency libraries included. </td></tr><tr><td data-label="Logic / Structure"> <strong>Global Constants</strong>                 </td><td data-label="Conceptual Notes"> Defines <code>_JS_MAX_LEN</code>, <code>_CSS_MAX_LEN</code>, and safety-related thresholds. Used to avoid embedding oversized inline resources.                                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Entry Point — <code>render_to_html()</code></strong> </td><td data-label="Conceptual Notes"> Top-level callable that coordinates all stages: read fragments, build HTML head/body/tail, manage assets, and write the output file. Returns a structured result with timing and table stats.                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Input Normalization Block</strong>        </td><td data-label="Conceptual Notes"> Accepts multiple forms (dicts, lists, strings, paths). Validates and converts to a consistent internal representation. Ensures encoding is UTF-8 and fallback-safe.                                                                                                                              </td></tr><tr><td data-label="Logic / Structure"> <strong>Fragment Loading</strong>                 </td><td data-label="Conceptual Notes"> Loads fragment files via metadata (<code>frag_paths_ordered</code>). Uses <code>_ensure_dir_path</code> and <code>_default_write_atomic</code> to manage temporary directories. Each fragment may be an individual HTML snippet or inline data.                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Asset Management</strong>                 </td><td data-label="Conceptual Notes"> Uses <code>core_assets</code> utilities to gather CSS/JS fragments. Compresses or skips overly large inline assets. Maintains <code>head_parts</code> and <code>tail_parts</code> lists.                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Table Metadata & Captions</strong>        </td><td data-label="Conceptual Notes"> Generates per-fragment captions with unique IDs. Ensures deterministic naming (<code>Table_01</code>, etc.). Removes duplicate or nested headings within fragments using <code>_remove_heading_from_fragment()</code>.                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Table of Contents (TOC)</strong>          </td><td data-label="Conceptual Notes"> Builds a hierarchical HTML TOC (<code>toc_html</code>) based on titles and anchors from fragments. Inserts it before rendered tables.                                                                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>JavaScript Export Block</strong>          </td><td data-label="Conceptual Notes"> Injects an inline <code>&lt;script&gt;</code> that handles export button click events. Uses Web Workers when available. Encapsulated via self-invoking function to avoid global scope leaks.                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Atomic Write Handling</strong>            </td><td data-label="Conceptual Notes"> Writes to temporary file then renames. If <code>_default_write_atomic</code> is missing, falls back to manual atomic write using <code>.tmp</code> extension and <code>os.replace</code>. Ensures output consistency even on crash/interruption.                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Error and Fallback Strategy</strong>      </td><td data-label="Conceptual Notes"> Wraps nearly every write and parse in <code>try/except</code>. Logs warnings instead of halting. Produces structured warning list in final result.                                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"> <strong>Return Object Structure</strong>          </td><td data-label="Conceptual Notes"> Returns dict: <code>{warnings, tables, rows, runtime_ms, output, html(optional)}</code>. The <code>html</code> key is populated only if <code>return_html=True</code>. Enables caller-side embedding or testing.                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Concurrency Context</strong>              </td><td data-label="Conceptual Notes"> While not directly spawning threads here, delegates concurrent table rendering to <code>core_fragments.render_fragments_concurrently()</code>. Maintains compatibility with its thread/process execution model.                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Performance Safeguards</strong>           </td><td data-label="Conceptual Notes"> Limits inlined JS/HTML size, logs total runtime in milliseconds, and uses minimal string concatenation for large HTML parts. Prevents excessive memory overhead.                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <strong>Cross-Module Dependencies</strong>        </td><td data-label="Conceptual Notes"> - <code>core_io</code>: file writing, directory handling.<br> - <code>core_fragments</code>: concurrent fragment rendering and normalization.<br> - <code>core_assets</code>: asset detection and embedding.<br> - <code>core_table</code>: parsing or formatting utilities.<br> - Shared logger for debug output.                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Failure Scenarios</strong>                </td><td data-label="Conceptual Notes"> If any fragment or output write fails, function degrades gracefully with logged exception and <code>warnings[level=&quot;error&quot;]</code>. No uncaught propagation expected.                                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Overall Design Pattern</strong>           </td><td data-label="Conceptual Notes"> Procedural pipeline wrapped in a single coordinating function. Emphasizes safety, compatibility, and recoverability over class abstraction. Focus on predictable deterministic outputs.                                                                                                          </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table14" data-table="Book_8065_14" style="margin-top:2mm;margin-left:3mm;"><strong>Table 14</strong></div>
<div class="table-wrapper" data-table-id="table-14"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic / Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic / Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> Module configuration defines rendering limits, column sampling, truncation markers, and safety caps.            </td><td data-label="Conceptual Notes"> Prevents memory exhaustion or oversized HTML cells. Enables consistent rendering under heavy data loads.                </td></tr><tr><td data-label="Logic / Structure"> Optional imports for <code>pandas</code>, Excel backends, and charset detection libraries.                                 </td><td data-label="Conceptual Notes"> Allows flexible parsing of CSV and spreadsheet files without hard dependencies. Degrades gracefully when unavailable.   </td></tr><tr><td data-label="Logic / Structure"> <code>_get_md_callable</code> builds a Markdown-to-HTML function with fallbacks.                                           </td><td data-label="Conceptual Notes"> Abstracts Markdown rendering. Prevents crashes if no Markdown engine exists.                                            </td></tr><tr><td data-label="Logic / Structure"> Regex-based diagram and RTL (right-to-left) detectors.                                                          </td><td data-label="Conceptual Notes"> Identifies diagrammatic or RTL text for proper layout direction.                                                        </td></tr><tr><td data-label="Logic / Structure"> <code>_stash_code_local</code> and <code>_restore_code_placeholders_in_html</code> temporarily replace code blocks and inline code.   </td><td data-label="Conceptual Notes"> Prevents Markdown or HTML interference while rendering source text that includes code.                                  </td></tr><tr><td data-label="Logic / Structure"> <code>_preprocess_underscores_outside_placeholders</code> and <code>_restore_protection_entities</code>.                              </td><td data-label="Conceptual Notes"> Escapes or restores underscores and pipes so Markdown tables render correctly without data corruption.                  </td></tr><tr><td data-label="Logic / Structure"> <code>_render_cell_text</code> executes full rendering pipeline: stash, escape, Markdown conversion, sanitize, truncation. </td><td data-label="Conceptual Notes"> Core safe rendering path for each cell. Handles all Markdown/HTML interplay and sanitization.                           </td></tr><tr><td data-label="Logic / Structure"> <code>_is_likely_csv_text</code>, <code>_read_text_source</code>, <code>_sniff_delimiter</code> provide CSV heuristics.                          </td><td data-label="Conceptual Notes"> Automatically identifies delimiter, encoding, and format without explicit user input.                                   </td></tr><tr><td data-label="Logic / Structure"> <code>_try_pandas_read_csv</code> and <code>_parse_csv_source_to_rows</code> implement layered CSV parsing logic.                     </td><td data-label="Conceptual Notes"> Prioritize pandas for accuracy, fallback to built-in CSV module for resilience. Maintains consistent row/column output. </td></tr><tr><td data-label="Logic / Structure"> <code>parse_csv_safe</code> wraps all CSV parsing logic with logging and multi-encoding fallbacks.                         </td><td data-label="Conceptual Notes"> Centralized robust CSV loader. Guarantees non-throwing behavior and standard output type.                               </td></tr><tr><td data-label="Logic / Structure"> <code>_rows_from_iterable</code> normalizes many input formats (CSV, bytes, DataFrame, dicts, lists).                      </td><td data-label="Conceptual Notes"> Unified conversion layer producing <code>(rows, header)</code> for downstream renderers. Simplifies data ingestion.                </td></tr><tr><td data-label="Logic / Structure"> Logging messages use <code>PARSE_TRY</code>, <code>PARSE_OK</code>, <code>PARSE_FAIL</code>.                                                     </td><td data-label="Conceptual Notes"> Enforces transparent traceability of parsing outcomes for debugging and audit.                                          </td></tr><tr><td data-label="Logic / Structure"> Module designed to handle text, binary, and file inputs.                                                        </td><td data-label="Conceptual Notes"> Increases usability across environments (web uploads, filesystem, or memory data).                                      </td></tr><tr><td data-label="Logic / Structure"> Safe sanitation via <code>sanitize_html</code> if available.                                                               </td><td data-label="Conceptual Notes"> Prevents XSS or HTML injection when rendering user-supplied text.                                                       </td></tr><tr><td data-label="Logic / Structure"> Defensive error catching in every stage.                                                                        </td><td data-label="Conceptual Notes"> Guarantees stable rendering even with malformed data or corrupted encoding.                                             </td></tr><tr><td data-label="Logic / Structure"> <code>_class_token</code> sanitizes text into lowercase alphanumeric-safe CSS tokens.                                                </td><td data-label="Conceptual Notes"> Converts arbitrary strings into class-safe identifiers for use in HTML attributes. Guards against invalid characters and ensures fallback safety.                                  </td></tr><tr><td data-label="Logic / Structure"> <code>_filter_rows</code> applies conservative server-side filtering by criteria.                                                    </td><td data-label="Conceptual Notes"> Evaluates equality, containment, and numeric comparisons. Includes robust type casting and fallback handling. Defensive design prevents crashes on bad criteria.                   </td></tr><tr><td data-label="Logic / Structure"> <code>_sort_rows</code> safely sorts rows by specified column index.                                                                 </td><td data-label="Conceptual Notes"> Type-flexible sort: numeric preferred, string fallback, stable under exceptions. Ensures predictable ordering without hard failures.                                               </td></tr><tr><td data-label="Logic / Structure"> <code>_rows_to_csv_bytes</code>, <code>_rows_to_json_bytes</code>, <code>_rows_to_xlsx_bytes</code> convert tabular data into serialized bytes for export. </td><td data-label="Conceptual Notes"> Multi-format export layer: CSV (safe quoting), JSON (typed objects or arrays), XLSX (supports both <code>xlsxwriter</code> and <code>openpyxl</code>). Returns bytes to serve as downloadable responses. </td></tr><tr><td data-label="Logic / Structure"> <code>_build_data_attrs</code> generates safe <code>data-tv-*</code> HTML attributes from key–value options.                                    </td><td data-label="Conceptual Notes"> Converts dicts into escaped HTML attributes; JSON-encodes complex values. Prevents HTML injection.                                                                                 </td></tr><tr><td data-label="Logic / Structure"> <code>render_table</code> constructs a complete HTML table structure from data or DataFrame.                                         </td><td data-label="Conceptual Notes"> Central rendering entry point. Integrates Markdown conversion, lazy loading, CSV fallback, accessibility attributes, and UI controls.                                              </td></tr><tr><td data-label="Logic / Structure"> <code>render_table</code>: tries external <code>convert.render_table</code> first for backward compatibility.                                   </td><td data-label="Conceptual Notes"> Enables upstream overrides to replace rendering pipeline without breaking imports.                                                                                                 </td></tr><tr><td data-label="Logic / Structure"> Handles DataFrame <code>.to_html()</code> for quick path, then generic iterable path.                                                </td><td data-label="Conceptual Notes"> Maintains compatibility with Pandas output while supporting any list-like data.                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> Integrates lazy loading (initial rows vs remaining chunk JSON).                                                           </td><td data-label="Conceptual Notes"> Supports large dataset handling by embedding deferred JSON chunks for client-side loading.                                                                                         </td></tr><tr><td data-label="Logic / Structure"> Supports collapsible wrappers, sticky headers, export buttons, and accessibility labeling.                                </td><td data-label="Conceptual Notes"> Aligns with modern UX and a11y standards; each element labeled, ARIA-compliant.                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> Uses <code>_render_cell_text</code>, <code>_is_diagram_text</code>, <code>_dir_for_text</code> for per-cell rendering and directionality.                  </td><td data-label="Conceptual Notes"> Enables safe multilingual and diagram-aware rendering; auto RTL/LTR alignment.                                                                                                     </td></tr><tr><td data-label="Logic / Structure"> Error-handled asset injection with <code>_one_time_assets</code> and <code>_ASSETS_EMITTED</code> global flag.                                  </td><td data-label="Conceptual Notes"> Ensures assets are inserted only once; prevents duplicate CSS/JS inclusion.                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> Embeds table metadata and lazy chunk data as <code>&lt;script type=&quot;application/json&quot;&gt;</code>.                                          </td><td data-label="Conceptual Notes"> Exposes table state for client scripts without inline JavaScript evaluation.                                                                                                       </td></tr><tr><td data-label="Logic / Structure"> <code>render_fragment</code> wrapper sets fragment mode (no surrounding div/assets).                                                 </td><td data-label="Conceptual Notes"> Optimized for partial embedding in pre-rendered HTML documents.                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <code>simple_render_table</code> fallback builds basic HTML for minimal environments.                                                </td><td data-label="Conceptual Notes"> Ensures resilience where advanced rendering or Pandas is unavailable.                                                                                                              </td></tr><tr><td data-label="Logic / Structure"> Public API list defines available exports and safe internal utilities.                                                    </td><td data-label="Conceptual Notes"> Provides controlled exposure; excludes unsafe or debugging-only functions.                                                                                                         </td></tr></tbody></table></div><div class="row-count">Rows: 31</div></div><div class="table-caption" id="Table15" data-table="Book_8065_15" style="margin-top:2mm;margin-left:3mm;"><strong>Table 15</strong></div>
<div class="table-wrapper" data-table-id="table-15"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic/Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic/Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> <strong>Imports and logger setup</strong>             </td><td data-label="Conceptual Notes"> Loads <code>re</code>, <code>html</code>, and <code>logging</code> for text manipulation and debugging. Defines a module-level logger for diagnostic tracing.                                                                                                                  </td></tr><tr><td data-label="Logic/Structure"> <strong><code>_sanitize_id(x, idx)</code></strong>               </td><td data-label="Conceptual Notes"> Converts arbitrary strings into safe HTML <code>id</code> values. Replaces non-alphanumeric characters with dashes, collapses duplicates, ensures non-empty output with fallback to <code>&quot;id-{idx}&quot;</code>. Guards against exceptions and logs failures.           </td></tr><tr><td data-label="Logic/Structure"> <strong><code>_sanitize_output_path(x)</code></strong>           </td><td data-label="Conceptual Notes"> Converts arbitrary input to a string path. Provides <code>&quot;output.html&quot;</code> fallback on error. Ensures predictable file path string generation for downstream writers.                                                                                </td></tr><tr><td data-label="Logic/Structure"> <strong><code>_sanitize_html_whitelist(s)</code></strong>        </td><td data-label="Conceptual Notes"> Minimal HTML string passthrough. Returns stringified form without sanitization; used as lightweight fallback before deeper sanitization elsewhere.                                                                                            </td></tr><tr><td data-label="Logic/Structure"> <strong><code>_sri_attr(url, cdn_integrity)</code></strong>      </td><td data-label="Conceptual Notes"> Generates Subresource Integrity (SRI) attributes for secure CDN asset loading. Returns <code>integrity</code> and <code>crossorigin</code> attributes if URL is in provided mapping; silent fallback otherwise.                                                     </td></tr><tr><td data-label="Logic/Structure"> <strong><code>_frag_contains_rows(content)</code></strong>       </td><td data-label="Conceptual Notes"> Detects presence of <code>&lt;tbody&gt;&lt;tr</code> in an HTML fragment using regex. Used to check whether an HTML snippet contains table rows before injecting or replacing content.                                                                            </td></tr><tr><td data-label="Logic/Structure"> <strong><code>_take_and_stream(rows_iterable, n)</code></strong> </td><td data-label="Conceptual Notes"> Takes first <code>n</code> elements from an iterable safely, returns <code>(list, remainder_iter)</code>. Provides resilience against non-iterable or partially broken sources. Includes fallback path converting to list when iteration fails.                     </td></tr><tr><td data-label="Logic/Structure"> <strong>General Design Notes</strong>                 </td><td data-label="Conceptual Notes"> Functions are all defensive, self-contained, and designed to never raise unhandled exceptions. Prioritize stability and silent degradation, especially in rendering or file output contexts. Logging captures all exceptions for diagnostics. </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table16" data-table="Book_8065_16" style="margin-top:2mm;margin-left:3mm;"><strong>Table 16</strong></div>
<div class="table-wrapper" data-table-id="table-16"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic/Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic/Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic/Structure"> <strong>Imports and typing setup</strong>               </td><td data-label="Conceptual Notes"> Uses <code>os</code>, <code>tempfile</code>, <code>shutil</code>, and <code>pathlib.Path</code> for filesystem operations. Typing annotations (<code>Callable</code>, <code>Union</code>, <code>IO</code>) clarify I/O contracts and improve static analysis.                                                                                                 </td></tr><tr><td data-label="Logic/Structure"> <strong><code>read_file(path)</code></strong>                      </td><td data-label="Conceptual Notes"> Opens and reads a UTF-8 text file safely. Wraps all errors as <code>IOError</code> for uniform exception handling. Prevents unhandled propagation of <code>OSError</code> or <code>UnicodeDecodeError</code>.                                                                                                     </td></tr><tr><td data-label="Logic/Structure"> <strong><code>write_file(path, content)</code></strong>            </td><td data-label="Conceptual Notes"> Writes UTF-8 text with auto-creation of parent directories. Raises standardized <code>IOError</code> on any failure. Clearly notes it is <em>not atomic</em>, steering critical paths toward the atomic variant.                                                                                   </td></tr><tr><td data-label="Logic/Structure"> <strong><code>ensure_dir(path)</code></strong>                     </td><td data-label="Conceptual Notes"> Guarantees directory existence. Detects path collisions (existing file vs directory). Fails predictably with informative error messages. Enables safe setup before file writes.                                                                                                  </td></tr><tr><td data-label="Logic/Structure"> <strong><code>_atomic_stream_write(path, write_fn)</code></strong> </td><td data-label="Conceptual Notes"> Implements atomic file writes via temporary file creation (<code>tempfile.mkstemp</code>), followed by <code>os.replace</code>. Ensures either old or new data persists—never partial. Includes <code>fsync</code> for durability. Handles cleanup of temp files on failure. Portable across OSes if same device. </td></tr><tr><td data-label="Logic/Structure"> <strong>General Design Notes</strong>                   </td><td data-label="Conceptual Notes"> Defensive and deterministic I/O layer. Consistent exception wrapping improves higher-level reliability. Avoids concurrency hazards by using atomic replace. Keeps dependencies standard-library only.                                                                            </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table17" data-table="Book_8065_17" style="margin-top:2mm;margin-left:3mm;"><strong>Table 17</strong></div>
<div class="table-wrapper" data-table-id="table-17"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>HTML sanitization utilities</strong> (<code>_is_safe_url</code>, <code>_sanitize_html</code>)                  </td><td data-label="Conceptual Notes"> Implements a conservative allowlist sanitizer removing scriptable or form-related tags, event attributes, and unsafe URLs. Allows only basic inline formatting, block, and table tags. Ensures URLs are safe and attributes limited to class/id/data-* plus safe href/title. </td></tr><tr><td data-label="Logic / Structure"> <strong>External link post-processor</strong> (<code>_enforce_link_rel</code>)                              </td><td data-label="Conceptual Notes"> Adds <code>rel=&quot;noopener noreferrer&quot;</code> to external <code>&lt;a&gt;</code> tags missing this attribute. Prevents tab-napping vulnerabilities. Conservative regex-based implementation.                                                                                                               </td></tr><tr><td data-label="Logic / Structure"> <strong>Code stashing and restoration</strong> (<code>_stash_code</code>, <code>_restore_code_placeholders</code>)     </td><td data-label="Conceptual Notes"> Temporarily replaces fenced and inline code blocks with placeholders to avoid misinterpretation during markdown parsing. Restores them after HTML rendering, properly escaped and wrapped in <code>&lt;pre&gt;&lt;code&gt;</code> or <code>&lt;code&gt;</code>.                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Underscore preprocessing</strong> (<code>_preprocess_underscores_outside_placeholders</code>)       </td><td data-label="Conceptual Notes"> Prevents underscores from triggering markdown emphasis inside normal words. Converts escaped or internal underscores to HTML entities and ensures placeholders remain untouched.                                                                                             </td></tr><tr><td data-label="Logic / Structure"> <strong>Inline cell renderer</strong> (<code>_render_cell_inline</code>)                                    </td><td data-label="Conceptual Notes"> Produces HTML-safe inline rendering for table cells. Handles code spans and emphasis safely, performs underscore and HTML sanitization, and returns fragments suitable for <code>&lt;td&gt;</code>/<code>&lt;th&gt;</code>.                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>Table helpers</strong> (<code>_split_unescaped_pipes</code>, <code>_is_header_separator_row</code>)            </td><td data-label="Conceptual Notes"> Splits markdown table lines on unescaped pipes and detects header separator rows. Handles inline code spans and escaped pipes robustly.                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>Table rendering</strong> (<code>_render_table_block</code>)                                         </td><td data-label="Conceptual Notes"> Converts markdown pipe-table blocks to sanitized HTML <code>&lt;table&gt;</code> structures with <code>&lt;thead&gt;</code> and <code>&lt;tbody&gt;</code>. Applies inline-only rendering to cell content.                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"> <strong>CSV rendering</strong> (<code>_render_csv_block</code>)                                             </td><td data-label="Conceptual Notes"> Converts contiguous CSV-formatted lines into HTML tables. Detects headers heuristically and applies inline rendering to each cell. Provides fallback parsing for malformed CSV.                                                                                              </td></tr><tr><td data-label="Logic / Structure"> <strong>Table stashing and restoration</strong> (<code>_stash_tables</code>, <code>_restore_table_placeholders</code>) </td><td data-label="Conceptual Notes"> Detects contiguous table-like or CSV-like text blocks outside fenced code and replaces them with placeholders for safe processing. Restores as wrapped <code>&lt;div class=&quot;table-container inline-mode&quot;&gt;</code> HTML after rendering.                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong>Fallback markdown rendering pipeline</strong> (<code>_fallback_markdown_to_html</code>)             </td><td data-label="Conceptual Notes"> End-to-end transformation combining code, emphasis, and table placeholder management with fallback HTML rendering when full markdown engine unavailable. Applies sanitization and link hardening at final step.                                                              </td></tr><tr><td data-label="Logic / Structure"> <strong>Main class: <code>MarkdownRenderer</code></strong>                                                  </td><td data-label="Conceptual Notes"> Encapsulates markdown conversion workflow. Manages extension configuration, newline behavior, and thread-safe conversion. Designed as a drop-in, safe, deterministic markdown→HTML converter with minimal external dependencies.                                             </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table18" data-table="Book_8065_18" style="margin-top:2mm;margin-left:3mm;"><strong>Table 18</strong></div>
<div class="table-wrapper" data-table-id="table-18"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module overview</strong>                                </td><td data-label="Conceptual Notes"> Central HTML sanitization layer for the rendering subsystem. Removes or neutralizes unsafe tags, attributes, and scripts. Supports both Bleach-based and pure-Python fallback implementations.                                                                                           </td></tr><tr><td data-label="Logic / Structure"> <strong>Global configuration</strong>                           </td><td data-label="Conceptual Notes"> Defines allowlists for tags (<code>ALLOWED_TAGS</code>), attributes (<code>ALLOWED_ATTRIBUTES</code>), and URL protocols (<code>ALLOWED_PROTOCOLS</code>). Excludes <code>&lt;br&gt;</code> to avoid layout abuse in tables. Restricts inline image data to safe base64 MIME patterns.                                                     </td></tr><tr><td data-label="Logic / Structure"> <strong><code>is_safe_url(url)</code></strong>                             </td><td data-label="Conceptual Notes"> Ensures URLs are safe: allows relative URLs, <code>http</code>, <code>https</code>, <code>mailto</code>, and limited <code>data:image/*</code> URIs. Rejects everything else.                                                                                                                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong><code>_attr_allowed_for_tag(attr_name, tag)</code></strong>        </td><td data-label="Conceptual Notes"> Determines if an attribute is permitted for a tag, honoring <code>*</code> and wildcard suffixes like <code>aria-*</code> or <code>data-*</code>. Case-insensitive and defensive.                                                                                                                                         </td></tr><tr><td data-label="Logic / Structure"> <strong><code>bleach_clean(html_text)</code></strong>                      </td><td data-label="Conceptual Notes"> Primary sanitizer using the Bleach library if installed. Cleans markup, strips disallowed tags, and re-escapes attributes. Performs post-processing to remove inline JS (<code>on*</code>, <code>style</code>) and validates <code>href</code>/<code>src</code> URLs. Falls back to returning unmodified text if Bleach unavailable. </td></tr><tr><td data-label="Logic / Structure"> <strong>Bleach post-processing logic</strong>                   </td><td data-label="Conceptual Notes"> Applies regex over start tags to re-parse and filter attributes after Bleach’s initial pass. Prevents unsafe links slipping through library bugs or relaxed settings.                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong><code>FallbackCleaner</code> (HTMLParser subclass)</strong>        </td><td data-label="Conceptual Notes"> Lightweight custom sanitizer using Python’s built-in <code>html.parser</code> when Bleach is missing. Reconstructs HTML only from allowlisted tags and attributes. Escapes all text data, entities, and char references. Strictly excludes scripts and event attributes.                            </td></tr><tr><td data-label="Logic / Structure"> <strong><code>fallback_clean(html_text)</code></strong>                    </td><td data-label="Conceptual Notes"> Wrapper around <code>FallbackCleaner</code> that safely parses and reassembles sanitized HTML. If parsing fails, returns fully escaped input. Guarantees no executable markup output.                                                                                                               </td></tr><tr><td data-label="Logic / Structure"> <strong><code>_neutralize_script_tags_outside_code(text)</code></strong>   </td><td data-label="Conceptual Notes"> Escapes <code>&lt;script&gt;</code> and <code>&lt;/script&gt;</code> tokens occurring outside <code>&lt;code&gt;</code> and <code>&lt;pre&gt;</code> blocks. Prevents script execution while keeping literal code examples intact.                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"> <strong><code>sanitize_html(html_text, allow_tables=False)</code></strong> </td><td data-label="Conceptual Notes"> Unified sanitizer entry point. Selects allowed tag set based on <code>allow_tables</code>, runs Bleach or fallback cleaning, then neutralizes scripts. Defensive exception handling ensures safe output even on sanitizer failure.                                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>Self-test section (<code>__main__</code>)</strong>                 </td><td data-label="Conceptual Notes"> Runs smoke test on representative malicious and safe HTML samples. Demonstrates effect of table-allowance flag and script neutralization.                                                                                                                                                </td></tr><tr><td data-label="Logic / Structure"> <strong>Overall design</strong>                                 </td><td data-label="Conceptual Notes"> Layered sanitization approach combining allowlists, URL validation, and multi-stage cleaning. Prioritizes safety and deterministic behavior. Bleach optional for environments without external dependencies.                                                                             </td></tr></tbody></table></div><div class="row-count">Rows: 12</div></div><div class="table-caption" id="Table19" data-table="Book_8065_19" style="margin-top:2mm;margin-left:3mm;"><strong>Table 19</strong></div>
<div class="table-wrapper" data-table-id="table-19"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> <strong>Module overview</strong>                                  </td><td data-label="Conceptual Notes"> Adds human-readable captions to tables and constructs or replaces a Table of Contents (<code>&lt;ul id=&quot;toc&quot;&gt;</code>) in rendered HTML documents using metadata from <code>labels.json</code>.                                         </td></tr><tr><td data-label="Logic / Structure"> <strong>Dependencies</strong>                                     </td><td data-label="Conceptual Notes"> Uses <code>BeautifulSoup</code> for HTML parsing and manipulation, <code>pathlib</code> for file access, and <code>json</code> for structured caption input.                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong><code>apply_toc_and_captions(html_path, labels_path)</code></strong> </td><td data-label="Conceptual Notes"> Core routine combining two operations: caption injection and TOC reconstruction. Operates in-place on the given HTML file.                                                                                    </td></tr><tr><td data-label="Logic / Structure"> <strong>File existence checks</strong>                            </td><td data-label="Conceptual Notes"> Verifies both HTML and labels files exist. Logs simple console messages if missing, preventing exceptions from propagating.                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>HTML + JSON loading</strong>                              </td><td data-label="Conceptual Notes"> Reads the HTML file into BeautifulSoup, loads the caption mapping (<code>{table_id: caption_text}</code>) from JSON. All text is handled as UTF-8.                                                                       </td></tr><tr><td data-label="Logic / Structure"> <strong>Caption injection loop</strong>                           </td><td data-label="Conceptual Notes"> Iterates over label entries. For each <code>table_id</code>, finds the corresponding element by ID, creates a <code>&lt;caption&gt;</code> node, and inserts it above the table. Avoids duplicates by checking existing sibling captions. </td></tr><tr><td data-label="Logic / Structure"> <strong>TOC construction</strong>                                 </td><td data-label="Conceptual Notes"> Builds a fresh unordered list (<code>&lt;ul id=&quot;toc&quot;&gt;</code>) of <code>&lt;li&gt;</code> entries with <code>&lt;a href=&quot;#table_id&quot;&gt;caption&lt;/a&gt;</code>. The structure provides navigable table references.                                                  </td></tr><tr><td data-label="Logic / Structure"> <strong>TOC replacement or insertion</strong>                     </td><td data-label="Conceptual Notes"> Replaces an existing TOC if present. Otherwise prepends the new one at the top of the <code>&lt;body&gt;</code>. Ensures deterministic position and avoids duplication.                                                        </td></tr><tr><td data-label="Logic / Structure"> <strong>Output writing</strong>                                   </td><td data-label="Conceptual Notes"> Writes the modified HTML back atomically (stringified soup). Encoded in UTF-8. Logs confirmation to stdout.                                                                                                   </td></tr><tr><td data-label="Logic / Structure"> <strong>Overall design</strong>                                   </td><td data-label="Conceptual Notes"> Deterministic DOM transformation based on metadata. Safe and idempotent. Externalizes captions and TOC logic from renderer core to a post-processing layer.                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table20" data-table="Book_8065_20" style="margin-top:2mm;margin-left:3mm;"><strong>Table 20</strong></div>
<div class="table-wrapper" data-table-id="table-20"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"> Imports <code>dataclass</code>, <code>Path</code>, typing primitives, and threading <code>Event</code>.                                                                                                                                               </td><td data-label="Conceptual Notes"> Establishes cross-module type stability and dependency minimalism. All imports are standard library—no third-party reliance.                                             </td></tr><tr><td data-label="Logic / Structure"> Defines <code>RenderResult</code> and <code>TableLike</code> aliases.                                                                                                                                                                      </td><td data-label="Conceptual Notes"> Simplifies shared return type signatures; improves type hints across rendering layers.                                                                                   </td></tr><tr><td data-label="Logic / Structure"> Declares <code>RenderConfig</code> as a dataclass with configurable parameters.                                                                                                                                                 </td><td data-label="Conceptual Notes"> Serves as the <strong>central configuration container</strong> for all rendering operations. Encourages immutability-like usage but allows runtime tuning.                            </td></tr><tr><td data-label="Logic / Structure"> Core parameters include rendering control (<code>max_workers</code>, <code>table_render_timeout_ms</code>), caching (<code>cache_size</code>), asset management (<code>assets_dir</code>, <code>bundle_assets</code>, <code>embed_assets</code>), and output compression (<code>gzip_out</code>). </td><td data-label="Conceptual Notes"> Enables precise control of rendering performance, I/O management, and concurrency.                                                                                       </td></tr><tr><td data-label="Logic / Structure"> Includes optional cancellation (<code>cancel_event</code>) and progress callback.                                                                                                                                               </td><td data-label="Conceptual Notes"> Supports cooperative cancellation and progress tracking across threads or async workers; critical for responsive long renders.                                           </td></tr><tr><td data-label="Logic / Structure"> <code>resolved_assets_dir(out_dir: Path)</code> computes the effective path for storing assets.                                                                                                                                 </td><td data-label="Conceptual Notes"> Provides deterministic asset directory resolution. Defers to <code>assets_dir</code> if set; otherwise uses default <code>&lt;out_dir&gt;/assets</code>. Guarantees consistent file system behavior. </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>