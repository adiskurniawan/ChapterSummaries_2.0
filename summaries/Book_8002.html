<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;}</style>
<link rel="stylesheet" href="assets/style.css?v=1758862283">
<link rel="stylesheet" href="assets/overrides.css?v=1758862283">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header"><div><h1>Tables Viewer v2.1</h1></div><div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" type="search" placeholder="Search" aria-label="Search tables" style="min-width:420px; width:44ch;"/>
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllMdBtn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy all tables as markdown">Copy All Tables (Markdown)</button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset all tables">Reset All Tables</button>
</div></div>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#table-1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#table-2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#table-3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#table-4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#table-5">Table 5</a></li></ul></div></div>
<div class="table-wrapper" data-table-id="table-1"><h3 id="table-1">Table 1</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Details**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by Unnamed: 3"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Unnamed: 3</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by Unnamed: 4"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Unnamed: 4</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by Unnamed: 5"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Unnamed: 5</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by Unnamed: 6"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Unnamed: 6</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><p><strong>Purpose</strong></p></td><td data-label="Details"><p>Orchestrator for converting grouped Markdown sources into HTML outputs.  <p></p>It locates `.md` files in a configured source folder, groups them by filename prefix to form “books”, extracts pipe-style tables from those files into pandas DataFrames, and then renders one HTML output per group.  <p></p>If a richer `render&#95;html` renderer is available it delegates to that. Otherwise it emits a minimal fallback HTML using DataFrame→HTML conversion.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Primary responsibilities</strong></p></td><td data-label="Details"><p><ul><li>Discover input files.  <br></li><li>Group files into logical books.  <br></li><li>Parse markdown tables into structured data (DataFrames).  <br></li><li>Convert lightweight Markdown fragments to inline HTML (limited regex-based transforms).  <br></li><li>Invoke the renderer or write a simple fallback HTML.  <br></li><li>Perform safe cleanup of temporary fragment directories.</li></ul></p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Module loading strategy</strong></p></td><td data-label="Details"><p>Attempts dynamic, local loading first: looks for `html<em>renderer.py` adjacent to the script and tries `importlib.util.spec</em>from<em>file</em>location` to load it directly.  <p></p>If no local file exists it tries a normal `import html<em>renderer` on `sys.path`.  <p></p>If neither approach yields a callable `render</em>html`, it falls back to a built-in minimal HTML writer.  <p></p>This strategy maximizes flexibility for development (local override) and deployment (packaged renderer).</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Input discovery & grouping</strong></p></td><td data-label="Details"><p><ul><li>Hard-coded `md<em>folder` path is scanned for `&#42;.md`.  <br></li><li>Filenames are reduced to their first 9 characters and unique prefixes form candidate book groups.  <br></li><li>Numeric suffixes (four digits at filename end) are used to order and map prefixes to numeric keys; non-numeric extras are appended after the numeric groups.  <p></p>This produces a `selection</em>map` mapping small integers to book prefixes. The script loops `for key in sorted(selection&#95;map.keys())` to process each group.</li></ul></p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Markdown table extraction (approach)</strong></p></td><td data-label="Details"><p>The script uses a simple heuristic rather than a Markdown AST:  <p></p>- It splits a file into sections by blank lines.  <p></p>- For any section that contains a pipe `</p></td><td data-label="Unnamed: 3"><p>`, it attempts to parse that section as a table with `pandas.read&#95;csv(StringIO(section), sep='</p></td><td data-label="Unnamed: 4"><p>', engine='python')`.  <p></p>There is a fallback attempt that collects all lines containing `</p></td><td data-label="Unnamed: 5"><p>`and tries to parse them as a single table when no`parse<em>markdown</em>tables` matches.</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>`markdown<em>to</em>html` helper</strong></p></td><td data-label="Details"><p>A minimal transformer that applies a few regex substitutions:  <p></p>- Strips simple bracketed link patterns.  <br>- Converts `<strong>bold</strong>` and `<strong>bold</strong>` to `<strong>`.  <br>- Converts single `<em>italics</em>` and `<em>italics</em>` to `<em>`.  <br>- Inserts `<br>` before enumerated list markers and bullets to preserve visual line breaks.  <p></p>This is intentionally lightweight. It is not a full Markdown implementation and will mis-handle nested markup, code fences, escaped pipes, and other complex constructs.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Render invocation</strong></p></td><td data-label="Details"><p>For each book group the script accumulates `all<em>tables` (a list of pandas DataFrames).  <p></p>If `render</em>html` is available it calls `render<em>html(all</em>tables, output<em>html, markdown</em>to<em>html)`.  <p></p>If the renderer is absent it writes a fallback HTML that includes a title and `df.to</em>html(index=False, border=0, escape=False)` for each table.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Fallback behaviour</strong></p></td><td data-label="Details"><p>The fallback path guarantees that processing succeeds even if the richer renderer or optional dependencies are missing.  <p></p>The fallback produces simple static HTML suitable for quick inspection or recovery. It is intentionally minimal and lacks all interactive features, styling, and the full export/copy toolchain provided by the project’s frontend assets.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Cleanup mechanics</strong></p></td><td data-label="Details"><p>A safe cleanup function looks for `.frags<em>&#42;` directories and a `.fragments` directory under target directories (the output folder and the current working directory).  <p></p>Removals use `shutil.rmtree(..., ignore</em>errors=True)` so the operation is resilient and will not raise on locked or partially removed files. The function returns a list of removed paths for optional logging.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Error handling design</strong></p></td><td data-label="Details"><p>The script uses wide `try/except` blocks across loading, parsing, reading, and rendering steps.  <p></p>Pros: Processing is robust; a single malformed file or renderer error will not abort the entire run.  <br>Cons: Silent catches reduce observability and can obscure root causes. Many exceptions are only printed to stdout/stderr without structured logging.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Portability concerns</strong></p></td><td data-label="Details"><p>Paths are fixed to Windows-style absolute locations.  <p></p>This reduces portability and makes the script environment-specific. The script lacks CLI arguments, environment variable usage, or a config file to make inputs/outputs reusable across machines or CI.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Parsing fidelity risks</strong></p></td><td data-label="Details"><p>Using `pandas.read&#95;csv(..., sep='</p></td><td data-label="Unnamed: 3"><p>')`on arbitrary text sections is brittle for common Markdown cases:  <p></p>- Code fences containing`</p></td><td data-label="Unnamed: 4"><p>`will confuse the heuristic.  <br>- Escaped pipes or pipes inside inline code/backticks will not be handled correctly.  <br>- Multi-line table cells or row separators using hyphens (the standard`</p></td><td data-label="Unnamed: 5"></td><td data-label="Unnamed: 6"><p>`) can be misinterpreted depending on whitespace.  <p></p>A Markdown AST or dedicated parser (e.g., `mistune`, `markdown-it-py`) would provide robust table extraction.</p></td></tr><tr><td data-label="Topic"><p><strong>Security & sanitization</strong></p></td><td data-label="Details"><p>Outputs include `df.to&#95;html(..., escape=False)` in fallback mode.  <p></p>If input Markdown contains HTML or untrusted content, embedding `escape=False` can result in raw HTML being written to output. That may be intended for rich content, but it increases XSS risk if the output is served in an environment where untrusted users view it. Consider escaping by default or running an HTML sanitizer on table cell content.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Performance & memory</strong></p></td><td data-label="Details"><p>The approach loads whole markdown files into memory and converts each detected table into a pandas DataFrame.  <p></p>For small book sets this is fine. For large collections or very large tables this can increase memory pressure and parsing time.  <p></p>There is no batching, streaming, or explicit concurrency. All grouping and processing is sequential.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Observability & debugging</strong></p></td><td data-label="Details"><p>The script prints status messages to stdout/stderr, including warnings and stack traces when the renderer fails.  <p></p>This is helpful during local runs but insufficient for production: no logging levels, no log file, and no structured logs that integrate with monitoring or CI.  <p></p>Recommendation: add a configurable logger (`logging` module) and a `--verbose` or `--debug` flag.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Integration points</strong></p></td><td data-label="Details"><p><ul><li>The main integration point is the `render<em>html(all</em>tables, output<em>path, markdown</em>to&#95;html)` callable. The renderer’s API is expected to accept: a list of DataFrames, a target filename, and a helper function for converting cell markdown to HTML.  <p></p></li><li>The script also expects that any renderer will handle DataFrame content where table cell values may already contain basic HTML (because fallback uses `escape=False`).</li></ul></p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Failure modes to watch</strong></p></td><td data-label="Details"><p><ul><li>Missing or malformed MD files cause no data to be produced for a group.  <br></li><li>`pandas.read<em>csv` can raise parsing exceptions for malformed tables; the script currently ignores sections that fail parsing, possibly losing data.  <br></li><li>A buggy `render</em>html` implementation can raise and terminate rendering for that group; stack traces are printed but the run continues.  <br></li><li>File system permissions or locked files can prevent writing `output&#95;html`. The script prints errors but does not retry.</li></ul></p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Refactor & hardening recommendations</strong></p></td><td data-label="Details"><ol><li>Make I/O configurable. Provide CLI args or a small config file for `md<em>folder` and `output</em>folder`.  <br>2) Replace ad-hoc table detection with a Markdown parser or use regex + stricter validation before calling `pd.read<em>csv`.  <br>3) Replace `markdown</em>to&#95;html` regexes with a canonical Markdown renderer and controlled sanitization.  <br>4) Introduce structured logging and a debug mode.  <br>5) Add optional concurrency or batching when parsing many files.  <br>6) Default to safe HTML escaping unless the renderer explicitly opts into raw HTML.</li></ol></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Testing suggestions</strong></p></td><td data-label="Details"><p><ul><li>Unit tests for `parse<em>markdown</em>tables` covering: simple tables, tables with code fences, escaped pipes, missing header rows, and malformed table fragments.  <br></li><li>Integration test with a sample book set to confirm `selection<em>map` ordering and output file naming.  <br></li><li>End-to-end test that runs with and without `html</em>renderer.py` present to verify fallback path.  <br></li><li>Performance test for large tables (measure memory and time).</li></ul></p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Backward compatibility & API stability</strong></p></td><td data-label="Details"><p>Keep the `render<em>html(all</em>tables, output<em>html, markdown</em>to<em>html)` signature stable.  <br>\<brIf you change the renderer API, provide an adapter in this orchestrator so existing renderers continue to work.  <br>\<brDocument the exact expected structure of `all</em>tables` (list of DataFrames) and any expectations about cells (text vs HTML).</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Recommended immediate changes (minimal risk)</strong></p></td><td data-label="Details"><ol><li>Replace hard-coded paths with environment variables or CLI flags.  <br>2) Add logging via `logging` module, keep existing `print` output for backward compatibility.  <br>3) Wrap `pd.read&#95;csv` calls with a small validation step that ensures consistent column counts before accepting a DataFrame.  <br>4) Use `escape=True` by default in fallback HTML, or sanitize cell HTML.</li></ol></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Longer-term roadmap suggestions</strong></p></td><td data-label="Details"><p><ul><li>Introduce a small configuration layer and a controlled plugin point for multiple renderers.  <br></li><li>Add a robust Markdown extraction module that produces a normalized intermediate representation (IR) of tables and metadata.  <br></li><li>Support incremental or streaming rendering for extremely large books.  <br></li><li>Provide an optional CLI mode that processes one book by numeric index (useful for CI or scheduling).</li></ul></p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr><tr><td data-label="Topic"><p><strong>Next step</strong></p></td><td data-label="Details"><p>Confirm this format and level of depth. On approval I will proceed to the next file in sequence as you requested. I will repeat the same 10 verification passes and produce a similarly detailed conceptual table for each file.</p></td><td data-label="Unnamed: 3"><p>nan</p></td><td data-label="Unnamed: 4"><p>nan</p></td><td data-label="Unnamed: 5"><p>nan</p></td><td data-label="Unnamed: 6"><p>nan</p></td></tr></tbody></table></div><div class='row-count'></div></div><div class="table-wrapper" data-table-id="table-2"><h3 id="table-2">Table 2</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Details**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><p><strong>Purpose</strong></p></td><td data-label="Details"><p>Acts as a compatibility shim that exposes a stable rendering API for the rest of the system. <p></p>It attempts to import a canonical renderer from the refactored render package and, if unavailable, falls back silently so the orchestrator can use a minimal writer. <p></p>Primary goal is resilience across development and deployment layouts.</p></td></tr><tr><td data-label="Topic"><p><strong>Primary role in runtime</strong></p></td><td data-label="Details"><ol><li>Provide render\<em>html for main orchestration so main does not need to know renderer internals. <br>2) Re-export render\</em>table and render\&#95;page when available. <br>3) Surface optional helpers and asset utilities if present so higher-level code may call them without direct import paths.</li></ol></td></tr><tr><td data-label="Topic"><p><strong>Loading strategy</strong></p></td><td data-label="Details"><ol><li>Ensure local project root is first on import path to prefer local package variants. <br>2) First attempt to import stable API from render.core\<em>compat. <br>3) If that fails, try direct import from render.core\</em>renderer. <br>4) Silently attempt to import optional helper modules. <br>5) If nothing provides render\&#95;html, write concise diagnostics to stderr but do not raise. <p></p>This staged approach favors forward-compatible refactoring while preserving backward compatibility.</li></ol></td></tr><tr><td data-label="Topic"><p><strong>Export surface</strong></p></td><td data-label="Details"><p>Exposes a small, explicit set of symbols for callers: render\<em>html, render\</em>table, render\<em>page, prepare\</em>assets, write\<em>overrides\</em>css, and a few helper functions for list/markdown sanitization. <p></p>These names may be None when optional modules are absent; callers must tolerate None.</p></td></tr><tr><td data-label="Topic"><p><strong>Optional helpers & utilities</strong></p></td><td data-label="Details"><p>The module tries to import conversion helpers, sanitize helpers, and asset utilities. <p></p>If present they are assigned into top-level names so callers can use them without importing deep modules. <p></p>These are non-fatal: absence is recorded but not raised.</p></td></tr><tr><td data-label="Topic"><p><strong>Diagnostics & messaging</strong></p></td><td data-label="Details"><p>If render\&#95;html is not available the module writes a short warning to stderr and enumerates import attempt messages. <p></p>This provides quick CLI feedback while avoiding hard failures. It intentionally avoids verbose stack dumps but accumulates simple messages for troubleshooting.</p></td></tr><tr><td data-label="Topic"><p><strong>Resilience & failure model</strong></p></td><td data-label="Details"><p>Designed to never throw during import: it captures exceptions at each import attempt and continues. <p></p>As a result, downstream scripts can run in degraded mode rather than crash. <p></p>Tradeoff: silent degradation may hide configuration or packaging problems unless stderr is monitored.</p></td></tr><tr><td data-label="Topic"><p><strong>Integration contract</strong></p></td><td data-label="Details"><p>Callers expect render\<em>html to be a callable accepting structured data and a target path. <p></p>Callers must also accept that render\</em>table and render\&#95;page might be absent and handle that gracefully. <p></p>The shim enforces a single stable import point for different runtime layouts.</p></td></tr><tr><td data-label="Topic"><p><strong>Portability & path handling</strong></p></td><td data-label="Details"><p>It mutates sys.path to prioritize the project root. <p></p>That makes local development easy but can mask import errors in more complex deployment systems and may interfere with virtual environments or installed packages with the same top-level name. <p></p>Recommendation: limit sys.path mutation to development mode or document this behavior.</p></td></tr><tr><td data-label="Topic"><p><strong>Security considerations</strong></p></td><td data-label="Details"><p>Inserting project root into sys.path is not inherently unsafe but can open confusion in multi-package environments. <p></p>Diagnostics may leak internal import errors to stderr but this is typical for CLI tooling. <p></p>No user input is parsed here, so surface attack vectors are minimal in this module alone.</p></td></tr><tr><td data-label="Topic"><p><strong>Observability & debuggability</strong></p></td><td data-label="Details"><p>Provides concise import attempt messages which help identify which component failed to load. <p></p>It does not log stack traces by default, but main.py and other callers already print tracebacks when they catch exceptions. <p></p>Consider adding an optional verbose mode or integrating with a logger to route messages to a file or logging system.</p></td></tr><tr><td data-label="Topic"><p><strong>Performance & startup cost</strong></p></td><td data-label="Details"><p>Startup cost is negligible: a few imports and small list mutations. <p></p>Main impact is the cost of importing the underlying renderer which this module defers to. <p></p>sys.path insertion is constant time and harmless for small projects.</p></td></tr><tr><td data-label="Topic"><p><strong>Maintainability</strong></p></td><td data-label="Details"><p>Code is small, explicit, and easy to read. <p></p>Clear separation between required API and optional helpers keeps responsibilities obvious. <p></p>Because imports are tried in a deterministic order, maintainers can update the compatibility shim to reflect package refactors without touching callers.</p></td></tr><tr><td data-label="Topic"><p><strong>Failure modes to watch</strong></p></td><td data-label="Details"><ol><li>A renderer that partially imports but fails to set render\&#95;html will cause the shim to report absence; callers must handle None. <br>2) sys.path mutation may cause wrong package to resolve in environments where a different top-level package exists. <br>3) Optional helpers with changed names or signatures will silently be absent; this can lead to runtime AttributeError later in caller code.</li></ol></td></tr><tr><td data-label="Topic"><p><strong>Testing suggestions</strong></p></td><td data-label="Details"><ol><li>Unit test import behavior in three scenarios: core\<em>compat available, only core\</em>renderer available, neither available. <br>2) Test that stderr messages include the import attempt messages in failure cases. <br>3) Test that exported names are exactly the expected symbols (and are None when not available).</li></ol></td></tr><tr><td data-label="Topic"><p><strong>Immediate, low-risk improvements</strong></p></td><td data-label="Details"><ol><li>Convert stderr writes into a logger call behind a module-level logger so consumers can configure handlers. <br>2) Guard sys.path insertion to only run when a specific DEV env flag is set, or at least document it. <br>3) Add brief docstring examples showing expected signatures of render\&#95;html and other helpers.</li></ol></td></tr><tr><td data-label="Topic"><p><strong>Medium-term enhancements</strong></p></td><td data-label="Details"><ol><li>Offer a small runtime probe function that returns a diagnostic dict describing what was loaded and where (useful for health checks). <br>2) Provide an explicit compatibility adapter mapping older renderer APIs to the new API to avoid breaking changes. <br>3) Optionally export a boolean or enum indicating degraded mode so callers can show friendly messages.</li></ol></td></tr><tr><td data-label="Topic"><p><strong>Backward compatibility & upgrade path</strong></p></td><td data-label="Details"><p>This shim is the correct place to implement adapters when the render package evolves. <p></p>Preserve the current export names and signatures as part of stable API; add adapters that translate older helper names into the new structure so older callers continue to work.</p></td></tr><tr><td data-label="Topic"><p><strong>Documentation to add</strong></p></td><td data-label="Details"><ol><li>A short paragraph describing the expected callable signature for render\<em>html, render\</em>table, and render\&#95;page. <br>2) Document which optional helpers may be present and what they do. <br>3) Explain sys.path mutation and its purpose so deployers are not surprised.</li></ol></td></tr><tr><td data-label="Topic"><p><strong>Summary judgement</strong></p></td><td data-label="Details"><p>Well-designed compatibility layer. <p></p>It achieves the goal of resilience and minimal coupling between orchestrator and refactored render package. <p></p>Minor refinements—structured logging, optional sys.path guard, and a small diagnostic API—would improve transparency and maintainability without changing behavior.</p></td></tr></tbody></table></div><div class='row-count'></div></div><div class="table-wrapper" data-table-id="table-3"><h3 id="table-3">Table 3</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Details**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><p><strong>Purpose</strong></p></td><td data-label="Details"><p>Manage project assets for rendering outputs.  <p></p>Ensure an `assets` directory exists under the output folder, copy project-provided assets when available, and create minimal non-empty placeholder files (worker.js, overrides.css, style/script placeholders) when upstream assets are absent.</p></td></tr><tr><td data-label="Topic"><p><strong>Primary responsibilities</strong></p></td><td data-label="Details"><p><ul><li>Determine target assets directory from configuration or default to `out<em>dir / "assets"`.  <br></li><li>Create the assets directory safely.  <br></li><li>Attempt to run a project-supplied `copy</em>assets` implementation.  <br></li><li>Provide embedded fallback text for `style.css` and `script.js`.  <br></li><li>Ensure `worker.js` and `overrides.css` exist and are non-empty, without overwriting existing files.  <br></li><li>Expose `prepare<em>assets` and `write</em>overrides&#95;css` for callers.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Public API</strong></p></td><td data-label="Details"><p><ul><li>`prepare<em>assets(cfg, out</em>dir) -> (assets<em>dir, style</em>fallback, script<em>fallback, assets</em>written<em>flag)`  <br></li><li>`write</em>overrides<em>css(out</em>dir, left<em>width, right</em>width) -> None`</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Asset discovery & copy strategy</strong></p></td><td data-label="Details"><p><ul><li>First tries to import `copy<em>assets` and overrides writer from a local `render.assets` module.  <br></li><li>If a callable `copy</em>assets` exists the code calls it with `str(out<em>dir)` and sets `assets</em>written` accordingly.  <br></li><li>If `copy<em>assets` fails or is missing the function falls back to writing minimal placeholder files in `assets</em>dir`.  <p></p>This approach prefers project-provided assets but guarantees a usable fallback.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Directory creation robustness</strong></p></td><td data-label="Details"><p>Uses `<em>safe</em>mkdir(pathlib.Path)` which:  <br>- Attempts `Path.mkdir(parents=True, exist<em>ok=True)`.  <br>- On exception falls back to `os.makedirs(str(path), exist</em>ok=True)`.  <br>- Logs debug-level failures instead of raising.  <p></p>Goal: tolerate unusual Path implementations and permissive environments.</p></td></tr><tr><td data-label="Topic"><p><strong>Placeholder contents (intent)</strong></p></td><td data-label="Details"><p><ul><li>`worker.js` placeholder implements a minimal worker shim that acknowledges HTML-to-PDF style messages and replies with basic success/error posts.  <br></li><li>`overrides.css` placeholder defines safe layout variables and basic table styling.  <br></li><li>`style.css` and `script.js` placeholders are minimal one-line files if embedded fallbacks are empty.  <p></p>Placeholders are explicitly non-destructive: they are written only if files do not already exist.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>`prepare&#95;assets` return values explained</strong></p></td><td data-label="Details"><p><ul><li>`assets<em>dir`: Path object for created/verified assets folder.  <br></li><li>`style</em>fallback`: embedded CSS provided by project if available, else empty string.  <br></li><li>`script<em>fallback`: embedded JS similarly provided or empty.  <br></li><li>`assets</em>written<em>flag`: boolean true if project `copy</em>assets` succeeded.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Overrides writer behavior</strong></p></td><td data-label="Details"><p>`write<em>overrides</em>css` attempts to delegate to a project-provided `<em>write</em>overrides<em>impl`.  <p></p>If not available or it fails it computes a fallback CSS that injects `--tv-left-width` and `--tv-right-width` variables set from function args.  <p></p>The fallback writes a small overrides.css under `out</em>dir / "assets"` and uses `<em>safe</em>mkdir` to ensure the directory exists.</p></td></tr><tr><td data-label="Topic"><p><strong>Error handling & logging</strong></p></td><td data-label="Details"><p><ul><li>All non-critical operations are wrapped in `try/except` and debug-logged on failure.  <br></li><li>Exceptions do not propagate to callers; failure yields a degraded but functional state.  <br></li><li>The module uses a module-level logger `render.core&#95;assets` at debug level for internals.  <p></p>Tradeoff: resilient but may hide configuration mistakes unless debug logging is enabled.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Idempotence & safety</strong></p></td><td data-label="Details"><p><ul><li>The code never overwrites existing asset files.  <br></li><li>Directory creation is idempotent.  <br></li><li>`copy&#95;assets` is attempted once; its failure does not remove any existing files.  <p></p>These choices protect user-provided assets and avoid accidental data loss.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Security considerations</strong></p></td><td data-label="Details"><p><ul><li>Placeholder files are static and safe.  <br></li><li>If `copy&#95;assets` copies files from uncontrolled locations that step must be audited outside this module.  <br></li><li>The module does not render or execute asset content.  <p></p>Recommendation: validate or sandbox project-provided asset sources when running in multi-tenant or untrusted environments.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Portability & path semantics</strong></p></td><td data-label="Details"><p><ul><li>Uses `pathlib.Path` and falls back to `os.makedirs` for cross-platform directory creation.  <br></li><li>Caller may pass `cfg.assets&#95;dir` which can be any path-like; the code converts it to Path.  <br></li><li>No hard-coded platform paths.  <p></p>This module is portable across POSIX and Windows.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Performance & scale</strong></p></td><td data-label="Details"><p><ul><li>Operations are filesystem-bound and lightweight.  <br></li><li>Writing placeholder files and a single copy-assets invocation are negligible even on large runs.  <br></li><li>If `copy&#95;assets` performs heavy work, it is the dominant cost and outside this module’s responsibility.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Maintainability</strong></p></td><td data-label="Details"><p><ul><li>Code is small, focused, and easy to read.  <br></li><li>Clear separation of “attempt project impl” vs “fallback” paths.  <br></li><li>Logging use is appropriate but could be extended with explicit error context messages.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Testability</strong></p></td><td data-label="Details"><p><ul><li>Unit tests should cover: successful `copy<em>assets` path, failure of `copy</em>assets`, existing files left untouched, creation of placeholders, and `write<em>overrides</em>css` both delegated and fallback.  <br></li><li>Tests can inject a fake `cfg` with `assets&#95;dir` to avoid touching global paths.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Integration points</strong></p></td><td data-label="Details"><p><ul><li>`prepare<em>assets` is expected to be called by higher-level renderers before emitting HTML so CSS/JS/worker are present in `output</em>combined/assets`.  <br></li><li>`write<em>overrides</em>css` is called when layout widths are computed and must be invoked before final publish.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Immediate recommendations (low-risk)</strong></p></td><td data-label="Details"><p><ul><li>Add a small INFO-level log when placeholders are written so operators know fallback was used.  <br></li><li>Expose `worker<em>js</em>content` and `overrides<em>css</em>content` as module-level constants for easier unit tests and inspection.  <br></li><li>On `copy<em>assets` failure include the exception message in a debug log rather than only `exc</em>info=True`.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Medium-term improvements</strong></p></td><td data-label="Details"><p><ul><li>Provide an optional `force<em>overwrite=False` parameter for controlled asset refreshes.  <br></li><li>Allow `prepare</em>assets` to return a diagnostics object listing which files were created, copied, or skipped.  <br></li><li>Add a simple checksum or timestamp-based approach to avoid re-copying unchanged assets in heavy CI flows.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Long-term roadmap suggestions</strong></p></td><td data-label="Details"><p><ul><li>Add an asset manifest that lists required asset names and expected sizes/keys so the renderer can validate the asset set before publishing.  <br></li><li>Support optional compression/minification pipeline triggered on `copy&#95;assets` success.  <br></li><li>Surface a dry-run mode for CI that reports planned file operations without writing.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Summary judgement</strong></p></td><td data-label="Details"><p>Solid, pragmatic module.  <p></p>It correctly prioritizes non-destructive behavior and operational safety.  <p></p>Small improvements to observability and optional ergonomics (diagnostics, constants, small API flags) will make it friendlier in CI and multi-contributor projects.</p></td></tr></tbody></table></div><div class='row-count'></div></div><div class="table-wrapper" data-table-id="table-4"><h3 id="table-4">Table 4</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Details**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"><p><strong>Purpose</strong></p></td><td data-label="Details"><p>Central renderer that assembles HTML pages from parsed table fragments or inline table HTML.  <p></p>Coordinates assets, fragment rendering, table templating, and final atomic write to disk.  <p></p>Exposed as `render&#95;html(...)` for callers.</p></td></tr><tr><td data-label="Topic"><p><strong>Primary responsibilities</strong></p></td><td data-label="Details"><p><ul><li>Prepare and include assets (CSS, JS, worker).  <br></li><li>Orchestrate concurrent fragment rendering.  <br></li><li>Decide between fragment-based streaming assembly or inline fallback rendering.  <br></li><li>Build head, body, and tail HTML parts including TOC and export template.  <br></li><li>Safely write final HTML file atomically.  <br></li><li>Return a result dict with warnings, counts, and optionally the produced HTML.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Inputs & key parameters</strong></p></td><td data-label="Details"><p><ul><li>`all<em>tables`: iterable of DataFrames or table-like objects.  <br></li><li>`output</em>html`: output path string.  <br></li><li>`markdown<em>to</em>html`: inline converter for cell content.  <br></li><li>Optional: `config` (cfg), `render<em>cell`, `cdn</em>integrity`, `output<em>user`, `export</em>name<em>template`, `return</em>html`, `materialize`.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>High-level flow</strong></p></td><td data-label="Details"><ol><li>Sanitize and prepare output path and directory.  <br>2. Compute left/right layout widths.  <br>3. Call `prepare<em>assets` to ensure assets exist and obtain fallbacks.  <br>4. Call `render</em>fragments<em>concurrently(...)` to produce fragment files and metadata.  <br>5. If fragments absent or contain no rows, mark `need</em>fallback` and render inline via `render<em>table`.  <br>6. Compose `<head>` and `<tail>` pieces depending on `cfg.embed</em>assets`.  <br>7. Build TOC and either stream fragment files into output or write inline parts.  <br>8. Atomically write the assembled HTML and return diagnostics.</li></ol></td></tr><tr><td data-label="Topic"><p><strong>Fragment pipeline</strong></p></td><td data-label="Details"><p><ul><li>Uses `tmp<em>frag</em>dir<em>for(out</em>dir)` and `render<em>fragments</em>concurrently` to produce per-table fragment files (path, title<em>id, title</em>text, content).  <br></li><li>`fragments<em>map` maps fragment indices to metadata; `frag</em>row<em>counts` and `total</em>rows` track row counts.  <br></li><li>`need&#95;fallback` triggers when fragments map is empty or fragments contain zero rows.  <p></p>This enables streaming large tables without loading everything into memory.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Asset inclusion strategy</strong></p></td><td data-label="Details"><p><ul><li>`prepare<em>assets(cfg, out</em>dir)` returns `assets<em>dir`, plus style/script fallbacks and whether a copy succeeded.  <br></li><li>If `cfg.embed</em>assets` is true the renderer embeds CSS/JS/worker contents inline inside `<style>`/`<script>`.  <br></li><li>Otherwise it emits `<link>` and `<script src>` tags referencing `assets&#95;dir` with timestamp cache-busting.  <br></li><li>If `script.js` missing a valid file, the code appends an inline shim for essential table UI behavior.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Inline shim behavior</strong></p></td><td data-label="Details"><p><ul><li>Provides minimal JS for sorting, copy/export, search, reset, row counts and other UI glue if no script asset exists.  <br></li><li>Inserted conservatively to retain interactivity when full assets are not present.  <br></li><li>Acts as fallback; may be less feature-complete than the canonical `script.js`.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Export worker & template</strong></p></td><td data-label="Details"><p><ul><li>Exposes a small client-side export flow using a `Worker` at `assets/worker.js` to process large HTML into a PDF-style job.  <br></li><li>Uses `export<em>name</em>template` to compute file names.  <br></li><li>Protects against very large HTML by refusing exports if document size exceeds threshold.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Fallback inline rendering</strong></p></td><td data-label="Details"><p><ul><li>When fragments are unavailable the renderer calls `render<em>table(df, idx, markdown</em>to<em>html, left</em>width, right<em>width)` to produce per-table HTML.  <br></li><li>Extracts title</em>id and title&#95;text from rendered snippet using a regex.  <br></li><li>Aggregates inline HTML parts and builds TOC accordingly.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Template composition</strong></p></td><td data-label="Details"><p><ul><li>Head parts assembled as list strings then joined.  <br></li><li>Tail parts collected similarly and include scripts, worker code, export template script.  <br></li><li>TOC constructed from fragment metadata or inline titles.  <br></li><li>Banner inserted when no tables rendered with concise warnings.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>File write strategy</strong></p></td><td data-label="Details"><p><ul><li>Uses `<em>default</em>write&#95;atomic` if available to write atomically.  <br></li><li>Otherwise writes to a `.tmp` file then `os.replace` to move it into place.  <br></li><li>On write failure falls back to a direct write and logs exception.  <br></li><li>Ensures output file is either fully replaced or left untouched on failure.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Error handling & resilience</strong></p></td><td data-label="Details"><p><ul><li>Defensive try/except around asset operations, fragment reads, and render&#95;table calls.  <br></li><li>Aggregates `warnings` list rather than raising fatal errors for non-critical failures.  <br></li><li>Returns structured result with `warnings` and counts for caller diagnostics.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Performance characteristics</strong></p></td><td data-label="Details"><p><ul><li>Concurrent fragment rendering offloads expensive per-table processing and allows streaming assembly.  <br></li><li>Embedding assets increases output size and memory pressure; linking files is cheaper at runtime.  <br></li><li>Inline fallback rendering can be heavier for large tables; fragments minimize that load.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Memory considerations</strong></p></td><td data-label="Details"><p><ul><li>Uses streaming of fragment files when possible to avoid building very large in-memory strings.  <br></li><li>Inline parts are kept in a list while final assembly occurs; large inline HTML can be memory intensive.  <br></li><li>`total&#95;rows` is tracked to help callers estimate size and cost.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Security & sanitization</strong></p></td><td data-label="Details"><p><ul><li>The renderer embeds whatever `render<em>table` and `markdown</em>to&#95;html` produce.  <br></li><li>It writes `df` HTML with `escape` behavior dependent on upstream helpers.  <br></li><li>If table cell content contains untrusted HTML, outputs may include raw markup.  <br></li><li>Recommendation: require or run a sanitizer on cell HTML before assembly when serving untrusted content.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Observability & diagnostics</strong></p></td><td data-label="Details"><p><ul><li>Returns `warnings` list with level/msg entries.  <br></li><li>On critical write errors it logs exceptions via `logger.exception`.  <br></li><li>Not a formal logging or health-check API; adding a diagnostic probe would help automated monitoring.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Extensibility points</strong></p></td><td data-label="Details"><p><ul><li>`render<em>cell` optional hook could allow per-cell custom rendering.  <br></li><li>`config` object accepts flags like `embed</em>assets` and `max<em>workers`.  <br></li><li>`materialize` and `return</em>html` parameters allow callers to request different behaviors.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Compatibility & integration</strong></p></td><td data-label="Details"><p><ul><li>Depends on `core<em>assets`, `core</em>fragments`, `core<em>table`, and `core</em>utils` modules.  <br></li><li>Contracts: `render<em>fragments</em>concurrently` must return a fragments map with `path`, `title<em>id`, `title</em>text`, `content`.  <br></li><li>`render&#95;table` must accept DataFrame and converter and produce a table HTML fragment with an `<h3 id="...">` header.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Testing recommendations</strong></p></td><td data-label="Details"><p><ul><li>Unit tests for: fragments produced, need&#95;fallback toggles, asset embedding vs linking, inline shim injection, atomic write behavior, and export script embedding.  <br></li><li>Integration test with a large dataset to exercise fragment concurrency and streaming assembly.  <br></li><li>Failure-mode tests: missing assets, partial fragment outputs, and file-permission write failures.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Immediate, low-risk improvements</strong></p></td><td data-label="Details"><p><ul><li>Log an INFO message when fallback inline shim is inserted so operators know why interactivity differs.  <br></li><li>Make the export size threshold configurable and surface it in warnings.  <br></li><li>Return a small diagnostics object listing which assets were embedded vs linked.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Medium-term enhancements</strong></p></td><td data-label="Details"><p><ul><li>Add optional streaming writer that pipes fragment files into output without building head/tail in memory for extremely large outputs.  <br></li><li>Make TOC generation tolerant to non-unique titles by including table index metadata.  <br></li><li>Provide a `diagnose()` helper that returns a load map of assets, fragments produced, rows per fragment, and approximate output size.</li></ul></p></td></tr><tr><td data-label="Topic"><p><strong>Summary judgement</strong></p></td><td data-label="Details"><p>Robust and pragmatic renderer that balances streaming (fragments) with a safe inline fallback.  <p></p>Good separation of concerns and defensive coding.  <p></p>Key defensive task going forward: enforce sanitization contract on upstream renderers and add small diagnostics to make degraded-mode behavior obvious to operators.</p></td></tr></tbody></table></div><div class='row-count'></div></div><div class="table-wrapper" data-table-id="table-5"><h3 id="table-5">Table 5</h3><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th style="width:28.57%;" role="button" aria-label="Sort by **File**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>File</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th style="width:71.43%;" role="button" aria-label="Sort by **Explanation (clean, line-broken for readability)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Explanation (clean, line-broken for readability)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"><p><strong>Filename</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p>`static/worker.js` — lightweight Web Worker intended to index table HTML and run searches off-main-thread.</p></td></tr><tr><td data-label="File"><p><strong>Primary purpose</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><ol><li>Build an in-memory index of tables (headers + rows).<br>2. Execute text searches across indexed rows without blocking the UI.<br>3. Support cancellation and incremental yielding for very large tables.</li></ol></td></tr><tr><td data-label="File"><p><strong>Top-level constants / state</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p><ul><li>`CHUNK&#95;YIELD = 500` → number of rows processed before yielding to event loop.<br></li><li>`indexStore` → `{ tables: [] }`, each table entry: `{ id, headers: [], rows: [ [cell,..] ], rowsText: [], rowsTextLc: [] }`.<br></li><li>`currentSearchToken` → monotonically incremented token to cancel in-flight searches.</li></ul></p></td></tr><tr><td data-label="File"><p><strong>Sanitization helper</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p>`sanitize(text)` — normalizes whitespace, trims and converts to lower case for consistent matching.</p></td></tr><tr><td data-label="File"><p><strong>Parsing utilities</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p>`arraysEqual(a,b)` — small helper used when deciding if first row equals detected headers.</p></td></tr><tr><td data-label="File"><p><strong>HTML → tables parsing</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p>`parseHtmlTables(html)`:<br>• Preferred path: uses `DOMParser` (if available in worker) to parse DOM and collect `<thead>`, `<tbody>`, or fallback logic (first row as header).<br>• Fallback path: regex-based best-effort parser when no DOMParser — extracts `<table>` blocks, finds `<thead>`/first `<tr>`, and pulls `<td>/<th>` text (strips inner tags).<br>• Returns array of `{ id, headers:[], rows:[ [...], ... ] }`.</p></td></tr><tr><td data-label="File"><p><strong>Index building</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p>`addTableToIndex(id, headers, rows)` → normalizes rows to arrays of strings, builds `rowsText` (joined row cell text) and `rowsTextLc` (sanitized lowercase string), then pushes the entry into `indexStore.tables`.</p></td></tr><tr><td data-label="File"><p><strong>Index entry points</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p>`buildIndex(msg)` accepts:<br>• `msg.tables` — direct array of table objects `{id, headers, rows}` (fast path).<br>• `msg.html` — HTML string to parse then index.<br>• `msg.url` — fetch remote URL, parse returned HTML and index. <br>On success posts `{ type: 'status', status: 'indexed', tables: N }`.</p></td></tr><tr><td data-label="File"><p><strong>Search behavior</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p>`handleSearch(msg)` (async):<br>1. Increments `currentSearchToken` to allow cancellation of prior searches.<br>2. Reads `msg.query`, returns early if empty.<br>3. For each table: scans `table.rowsTextLc` and finds indexes where `q` occurs (substring match).<br>4. Builds `snippets` (context window up to ~160 chars) for up to `perTableLimit` rows.<br>5. Periodically yields (every `CHUNK&#95;YIELD` rows) with `await new Promise(r=>setTimeout(r,0))` so the worker stays responsive.<br>6. If token changes, posts `{ type: 'searchCanceled', requestId }` and returns early.<br>7. On completion posts `{ type:'searchResults', query, results, requestId }`.</p></td></tr><tr><td data-label="File"><p><strong>Messages handled by the worker</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p><ul><li>`'index'` → call `buildIndex`.<br></li><li>`'search'` → start `handleSearch` (cancellable).<br></li><li>`'clear'` → reset `indexStore` and respond `{type:'status',status:'cleared'}`.<br></li><li>`'status'` → respond `{type:'status', status:'ready', tables: N}`.<br></li><li>`'ping'` → respond `{type:'pong'}`.<br></li><li>default → post error `{type:'error', error:'unknown<em>message</em>type'}`.</li></ul></p></td></tr><tr><td data-label="File"><p><strong>Responses / events posted</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p><ul><li>`status` (ready/indexed/cleared), `searchResults` (results + requestId), `searchCanceled` (requestId), `error` (various error codes), `pong`.</li></ul></p></td></tr><tr><td data-label="File"><p><strong>Error handling & robustness</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p><ul><li>Try/catch guards around parsing and message dispatch.<br></li><li>Posts structured error messages back to main thread instead of throwing.<br></li><li>Non-destructive: indexing and search do not touch DOM.</li></ul></p></td></tr><tr><td data-label="File"><p><strong>Performance considerations</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p><ul><li>Memory: index stores `rowsText` and `rows` arrays — can grow large for big tables.<br></li><li>`CHUNK&#95;YIELD` yields to event loop to keep worker responsive for huge tables.<br></li><li>`perTableLimit` controls snippets returned per table (bounded).</li></ul></p></td></tr><tr><td data-label="File"><p><strong>Security & privacy notes</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p><ul><li>Worker parses HTML strings or fetches URLs — be mindful when indexing remote/untrusted pages.<br></li><li>`parseHtmlTables` uses textContent extraction (DOMParser) or regex fallback — inlined scripts are not executed by DOMParser in a worker, but fetching remote URLs may expose request metadata. Validate URLs if needed.</li></ul></p></td></tr><tr><td data-label="File"><p><strong>Limitations & edge cases</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><ol><li>Regex fallback is best-effort: fragile for complex/nested tables, tables with markup in cells, or unusual whitespace/encodings.<br>2. No fuzzy or tokenized ranking — search is simple substring match on joined row text.<br>3. Non-text content (images, complex HTML in a cell) is reduced to stripped text; important semantics may be lost.<br>4. Very large indexes may exhaust memory — no built-in eviction/streaming policy.</li></ol></td></tr><tr><td data-label="File"><p><strong>Suggested improvements (optional)</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p><ul><li>Allow configurable `CHUNK&#95;YIELD` and `perTableLimit` via messages.<br></li><li>Offer streaming index (emit progress messages) and a max-rows truncation to limit memory.<br></li><li>Offer tokenized/fuzzy search, or precomputed n-grams, for better relevance.<br></li><li>Use `postMessage(..., [transferableArrayBuffer])` for binary transfer if indexes become large and need serialization.</li></ul></p></td></tr><tr><td data-label="File"><p><strong>Practical integration notes</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p><ul><li>Main thread should send `{type:'index', html: document.documentElement.outerHTML}` or pass structured `tables` for fastest, safest indexing.<br></li><li>For responsiveness, main thread may send new `search` messages quickly — cancellation handled by token.<br></li><li>`requestId` passthrough is supported so main thread can correlate results.</li></ul></p></td></tr><tr><td data-label="File"><p><strong>Checklist (I verified carefully)</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><ol><li>Worker accepts the stated message types — confirmed.<br>2. DOMParser path extracts `thead`/`tbody` when present — confirmed.<br>3. Regex fallback exists and will attempt to extract rows — confirmed (but fragile).<br>4. `addTableToIndex` normalizes `rowsText` and lowercase copy (`rowsTextLc`) — confirmed.<br>5. `handleSearch` respects `currentSearchToken` for cancellation — confirmed.<br>6. Yields to event loop every `CHUNK&#95;YIELD` rows — confirmed.<br>7. Posts `searchCanceled` when aborted — confirmed.<br>8. Posts `searchResults` with `requestId` passthrough — confirmed.<br>9. `buildIndex` handles `msg.tables`, `msg.html`, and `msg.url` — confirmed.<br>10. Worker wraps main dispatch in try/catch and posts structured errors — confirmed.</li></ol></td></tr><tr><td data-label="File"><p><strong>Summary (one line)</strong></p></td><td data-label="Explanation (clean, line-broken for readability)"><p>Worker is a pragmatic, well-guarded off-thread index + search utility that favors DOMParser when available, falls back to regex parsing, supports cancellation/yielding, and returns structured results — suitable for client-side table search with known limitations on complex HTML and very large datasets.</p></td></tr></tbody></table></div><div class='row-count'></div></div><script src="assets/xlsx.full.min.js?v=1758862283" defer></script>
<script src="assets/script.js?v=1758862283" defer></script>
<script src="assets/worker.js?v=1758862283" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
</script>
</div>
</body>
</html>