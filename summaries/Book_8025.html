<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761537668">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li>
<li class="toc-item"><a class="toc-link" href="#Table10">Table 10</a></li>
<li class="toc-item"><a class="toc-link" href="#Table11">Table 11</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8025_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Summary"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Summary</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>üìå Section: Initialization & Configuration</strong><br><br><strong>Purpose:</strong> This section sets up global state, event listeners, and compatibility shims required before any table-specific behavior works. It ensures all DOM nodes exist, old button IDs are aliased correctly, and feature detection is done once. <br><br> <strong>Key Responsibilities:</strong> <br>1. Detecting <code>DOMContentLoaded</code> or <code>window.load</code> to initialize behavior at the correct lifecycle.<br>2. Preparing global delegation for legacy buttons (<code>copyAllMdBtn</code>) to work with the newer interface.<br>3. Ensuring all <code>.table-wrapper</code> elements fade in after page load for smooth UX.                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Summary"> <strong>ensureDelegation</strong><br><br><strong>1. Purpose:</strong> This function ensures <strong>event aliasing</strong> between the legacy hidden button (<code>copyAllMdBtn</code>) and the visible main ‚ÄúCopy All Tables (Markdown)‚Äù button (<code>copyAllTablesBtn</code>). <br><br> <strong>2. DOM Elements:</strong> <br> - <code>vis</code> = visible button (new)<br> - <code>alias</code> = hidden button (legacy) <br><br> <strong>3. Event Delegation:</strong> It overrides <code>addEventListener</code> and <code>removeEventListener</code> on the alias element so any legacy scripts that attached listeners to it actually bind to the visible button. <br><br> <strong>4. Onclick Delegation:</strong> Uses <code>Object.defineProperty</code> to redirect <code>onclick</code> getter/setter to the visible button, ensuring assignment compatibility. <br><br> <strong>5. Focus / Blur:</strong> Rebinds <code>focus()</code> and <code>blur()</code> so accessibility and keyboard navigation works seamlessly. <br><br> <strong>6. Error Handling:</strong> Wrapped in <code>try/catch</code> to gracefully degrade if any element is missing, logging warnings rather than throwing. </td></tr><tr><td data-label="Summary"> <strong>DOMContentLoaded Hook</strong><br><br><strong>1. Condition:</strong> Checks <code>document.readyState</code>. If still <code>loading</code>, attaches <code>ensureDelegation</code> to <code>DOMContentLoaded</code>. Otherwise, calls immediately. <br><br> <strong>2. Reason:</strong> Guarantees delegation works even if the script is loaded late (e.g., deferred) or DOM is already parsed. <br><br> <strong>3. Behavior:</strong> Prevents race conditions between legacy code attaching listeners and this patch being applied.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>window.addEventListener('load', ...)</strong><br><br><strong>1. Purpose:</strong> After the entire page finishes loading, it loops through all <code>.table-wrapper</code> elements and sets their <code>opacity</code> to <code>1</code>. <br><br> <strong>2. Visual Effect:</strong> Initially, <code>.table-wrapper</code> has <code>opacity:0</code> for a clean loading look; this handler performs a batch reveal to avoid layout jumps during partial loads. <br><br> <strong>3. Error Handling:</strong> Wrapped in <code>try/catch</code> to silently fail if DOM query fails, ensuring no hard crash. <br><br> <strong>4. Scope:</strong> Affects every table on the page simultaneously ‚Äî part of the ‚Äúglobal initialization pass.‚Äù                                                                                                                                                                                                                                                                                                                                                            </td></tr></tbody></table></div><div class="row-count">Rows: 4</div></div><div class="table-caption" id="Table2" data-table="Book_8025_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>üìå Section: Search, Filtering & TOC Interaction</strong><br><br><strong>Purpose:</strong> coordinate user search input, row visibility, highlighting, and TOC anchor generation/scrolling. This subsystem must be robust to diacritics, composed characters, dynamic HTML injection, and sticky header offsets. It also must be idempotent because tables may be injected multiple times.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>normalizeForSearchLocal</strong><br><br><strong>Overview:</strong> produce a normalized string used for both needle and haystack comparison.  <br><br> <strong>Behavior (stepwise):</strong> <br> 1. <strong>Input sanitization:</strong> Accepts any value and coerces to string; uses <code>try/catch</code>. <br> 2. <strong>Unicode normalization:</strong> Applies <code>NFD</code> (decompose) to separate base characters and combining diacritics. <br> 3. <strong>Remove combining marks:</strong> Strips <code>\u0300-\u036f</code> range to remove diacritics. <br> 4. <strong>Remove punctuation:</strong> Prefer Unicode class filter (<code>\p{L}\p{N}</code>) when the engine supports it; fallback to <code>\w</code> for older engines. <br> 5. <strong>Collapse whitespace:</strong> Replace multiple whitespace with single space and <code>trim()</code>. <br> 6. <strong>Lowercase:</strong> Convert to lowercase for case-insensitive matching. <br><br> <strong>Edge cases & notes:</strong> <br> - Handles surrogate pairs and composed glyphs via codepoint-aware normalization when available. <br> - The fallback branch avoids throwing on environments without Unicode property escapes. <br> - Important for consistent behavior across languages and diacritics (e.g., ‚Äú√©‚Äù ‚Üí ‚Äúe‚Äù).                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Summary"> <strong>debounce</strong><br><br><strong>Overview:</strong> Throttle rapid input events (search box, resize) to avoid excessive reflow and heavy highlight work. <br><br> <strong>Behavior (stepwise):</strong> <br> 1. Returns a wrapper that clears previous timer and sets a new <code>setTimeout</code> for the provided wait interval. <br> 2. On timer fire, calls the original function inside try/catch. <br><br> <strong>Parameters & usage:</strong> <br> - Used with <code>searchTable</code> (controlled by <code>window.tvConfig.debounceMs</code>) and with <code>optimizeTableControls</code> (small debounce). <br><br> <strong>Edge cases:</strong> <br> - If <code>wait</code> is zero, becomes essentially immediate but still async. <br> - Ensures UI responsiveness on fast typing while avoiding highlight thrashing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Summary"> <strong>getSearchEl</strong><br><br><strong>Overview:</strong> Locate the search input element using common ids. <br><br> <strong>Behavior:</strong> <br> 1. Attempts <code>#searchBox</code>, then <code>#searchInput</code>, then <code>#search</code>. <br> 2. Returns the first found element or <code>null</code>. <br><br> <strong>Notes:</strong> <br> - Centralizes DOM queries so other functions don‚Äôt duplicate selector logic. <br> - If the page uses a different id, caller must provide or patch mapping (or <code>initRenderedContent</code> must be invoked after injection).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Summary"> <strong>searchTable</strong><br><br><strong>Overview:</strong> Main orchestration for filtering rows and highlighting text. Designed to be robust and to scroll the first match into view taking the sticky header into account. <br><br> <strong>High-level steps:</strong> <br> 1. <strong>Read input:</strong> get normalized filter string via <code>getSearchEl()</code> ‚Üí <code>value</code>. <br> 2. <strong>Normalize needle:</strong> use <code>normalizeForSearchLocal</code>. <br> 3. <strong>Iterate tables:</strong> for each <code>.table-container table</code>, get <code>tbody</code> via <code>safeGetTBody</code>. <br> 4. <strong>Per row:</strong> clear existing highlights (<code>clearHighlights</code>), then evaluate whether any cell includes the normalized needle by calling <code>normalizeForSearchLocal</code> on each cell‚Äôs text. <br> 5. <strong>Show/hide:</strong> set <code>row.style.display = &#x27;&#x27;</code> for matches or <code>row.style.display = &#x27;none&#x27;</code> when no match. <br> 6. <strong>Highlight:</strong> if matches and <code>window.tvConfig.highlight</code> truthy, call <code>highlightMatches</code> per cell. <br> 7. <strong>Virtualizer refresh:</strong> attempt <code>window.tableVirtualizer.refresh()</code> or <code>.update()</code> if present. <br> 8. <strong>Scroll-first:</strong> scroll the first matched row into view, computing offset to subtract <code>#stickyMainHeader</code> height to avoid clipping. <br> 9. <strong>Update UI counts:</strong> call <code>updateRowCounts()</code> to display "Showing X of Y" information. <br><br> <strong>Edge cases & robustness:</strong> <br> - Handles empty filter: restores display for all rows and clears highlights. <br> - Uses <code>try/catch</code> liberally to prevent search from breaking on malformed table HTML. <br> - Works with dynamic tables injected after initial load (if <code>initRenderedContent</code> calls it). </td></tr><tr><td data-label="Summary"> <strong>clearHighlights</strong><br><br><strong>Overview:</strong> Restore original cell markup to remove <code>&lt;mark&gt;</code> elements while preserving non-highlighted HTML content. <br><br> <strong>Behavior:</strong> <br> 1. If <code>cell.dataset.origHtml</code> exists, set <code>cell.innerHTML = cell.dataset.origHtml</code> and return (fast restore). <br> 2. Otherwise find <code>&lt;mark&gt;</code> nodes and replace each with a text node containing the mark‚Äôs text. <br> 3. Operates conservatively and never alters non-mark nodes. <br><br> <strong>Notes:</strong> <br> - <code>data-origHtml</code> is preferred since it preserves attributes, inline code tags, and original markup. <br> - Important to call before re-highlighting to avoid nested <code>&lt;mark&gt;</code> or double-wrapping.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Summary"> <strong>buildNormalizedMapForCell</strong><br><br><strong>Overview:</strong> Build a normalized text string for a cell and a mapping from positions in that normalized string back to underlying text nodes and offsets. This is critical for accurate highlight placement across multiple text nodes, composed characters, and surrogate pairs. <br><br> <strong>Steps & structure:</strong> <br> 1. <strong>Tree walker:</strong> walk all text nodes under the cell, skipping empty/whitespace-only nodes. <br> 2. <strong>For each text node:</strong> iterate code points, NFD-normalize each codepoint and strip combining marks. <br> 3. <strong>Filtered chars:</strong> push valid characters into <code>normStr</code> while appending map entries <code>{ nodeIndex, offsetInNode }</code>. <br> 4. <strong>Return:</strong> <code>{ normStr, map, nodes }</code>. <br><br> <strong>Why needed:</strong> <br> - Because DOM text can be segmented (e.g., markup inside cell: <code>&lt;strong&gt;foo&lt;/strong&gt;bar</code>), direct index-based substring replacement would misalign; the map preserves the ability to map normalized indices back to specific text node positions so highlights can be split and DOM replaced precisely.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>highlightMatches</strong><br><br><strong>Overview:</strong> Using the map from <code>buildNormalizedMapForCell</code>, locate normalized needle positions and wrap the corresponding DOM ranges in <code>&lt;mark&gt;</code>. <br><br> <strong>Algorithm (detailed):</strong> <br> 1. <strong>Rebuild cell base:</strong> If <code>data-origHtml</code> present, restore it first to ensure clean baseline. <br> 2. <strong>Build normalized map:</strong> call <code>buildNormalizedMapForCell(cell)</code>. <br> 3. <strong>Find matches:</strong> compute all <code>indexOf</code> occurrences of <code>needle</code> in <code>built.normStr</code>. <br> 4. <strong>For each match (process in reverse order):</strong> <br>     a. Map start and end normalized positions to <code>startMap</code>/<code>endMap</code>. <br>     b. Compute start/end node indices and offsets, adjust for surrogate pairs by inspecting codePoint length. <br>     c. If start and end are in the same text node, do <code>splitText</code> twice and replace the middle text node with <code>&lt;mark&gt;</code>. <br>     d. If range spans nodes, split start and end nodes and wrap intermediate nodes by moving them into <code>&lt;mark&gt;</code> inserted at the first node‚Äôs parent. <br> 5. <strong>Error resilience:</strong> wrapped in try/catch per match to continue if a particular splice fails. <br><br> <strong>Edge cases:</strong> <br> - Multi-node matches, composed characters, uncommon Unicode classes handled by codepoint-aware offsets. <br> - Reverse iteration prevents offset corruption as DOM is mutated.                                                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>buildSingleTableToc</strong><br><br><strong>Overview:</strong> When page contains exactly one <code>.table-wrapper</code> and <code>#tocBar</code> exists, build a small UL of per-row anchors (Topic 1, Topic 2, ‚Ä¶). This provides quick row-level navigation in single-table views. <br><br> <strong>Behavior:</strong> <br> 1. <strong>Guard conditions:</strong> Return early if wrappers count != 1 or <code>#tocBar</code> missing. <br> 2. <strong>Get table rows:</strong> Use <code>safeGetTBody</code> or fallback to <code>table</code> rows. <br> 3. <strong>Ensure row ids:</strong> For each row, if <code>row.id</code> missing assign <code>tv-row-N</code>, ensure uniqueness by appending suffix if <code>document.getElementById(id)</code> conflicts. Also set <code>data-tv-uid</code> if missing. <br> 4. <strong>Build UL:</strong> Create <code>&lt;ul class=&quot;single-toc-list&quot;&gt;</code> and append <code>&lt;li&gt;&lt;a href=&quot;#rowId&quot;&gt;Topic N&lt;/a&gt;&lt;/li&gt;</code> for each row. Set <code>aria-label</code> and title on anchors to row text for accessibility. <br> 5. <strong>Attach click handler:</strong> Intercept clicks to call smooth <code>scrollIntoView</code> and update history with <code>replaceState</code>, also focus the target element. <br> 6. <strong>Replace existing UL:</strong> If <code>#tocBar</code> had an existing <code>&lt;ul&gt;</code>, remove it and insert the new one. <br><br> <strong>Edge notes:</strong> <br> - Called both at initial DOM load and after dynamic injection (<code>initRenderedContent</code>) ‚Äî called again with small delay to cover async row generation. <br> - If a page contains multiple tables, this function intentionally avoids building per-row TOC to prevent overload and maintain predictable anchor mapping.                                                                                                                  </td></tr><tr><td data-label="Summary"> <strong>Delegated click handler ‚Äî TOC anchor scroll</strong><br><br><strong>Overview:</strong> Document-level delegated handler catches clicks on <code>#tocBar a[href^=&quot;#&quot;]</code>, prevents default, and performs smooth scrolling that accounts for the sticky header. <br><br> <strong>Behavior:</strong> <br> 1. Capture anchor and <code>href</code> id (without hash). <br> 2. Find target element by <code>document.getElementById(id)</code>. If found: <br>     a. Compute <code>rect = target.getBoundingClientRect()</code> and <code>top = window.pageYOffset + rect.top</code>. <br>     b. Compute <code>headerHeight = document.getElementById(&#x27;stickyMainHeader&#x27;)?.offsetHeight 0</code>. <br>     c. <code>window.scrollTo({ top: Math.max(0, top - headerHeight - 5), behavior: &#x27;smooth&#x27; })</code>. <br>     d. <code>history.replaceState(null,&#x27;&#x27;, &#x27;#&#x27;+id)</code>and focus target if available. <br> 3. If target not found but anchor is inside a<code>.table-wrapper</code>, scroll the wrapper top into view using same header offset. <br><br> <strong>Edge cases:</strong> <br> - If <code>#stickyMainHeader</code> height changes later (e.g., responsive), the computed offset reflects live height at click time. <br> - Prevents default anchor jump, avoids hash-only navigation that results in the header obscuring the target.                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Summary"> <strong>_ensureRowUidsAndSnapshot</strong><br><br><strong>Overview:</strong> Maintain original row ordering snapshot used by sorting and reset operations; also assign stable <code>data-tv-uid</code> for each row. <br><br> <strong>Behavior:</strong> <br> 1. Iterate <code>tbody.rows</code> and assign <code>data-tv-uid</code> like <code>tvuid-&lt;counter&gt;</code> when missing. <br> 2. Collect uid order into <code>originalRowOrders[tableIdx]</code>. <br> 3. Increment global <code>_tv_row_uid_counter</code> to keep UIDs unique across re-inits. <br><br> <strong>Interaction with search & TOC:</strong> <br> - The UIDs are independent of DOM <code>id</code> used for anchors, but snapshots prevent sort/reset causing lost order that could confuse TOC numbering. <br> - Called both on initial DOM load and inside <code>initRenderedContent</code> after dynamic injection.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Summary"> <strong>updateRowCounts</strong><br><br><strong>Overview:</strong> Keep <code>.row-count</code> text in sync with filtering/collapse state so users see ‚ÄúShowing X of Y‚Äù semantics. <br><br> <strong>Behavior:</strong> <br> 1. For each <code>.table-wrapper</code>, compute <code>total = tbody.rows.length</code>. <br> 2. Compute <code>visible = number of rows with style.display !== &#x27;none&#x27;</code>. <br> 3. Update <code>.row-count</code> text with: <br>      - <code>&quot;Showing 0 rows&quot;</code> if total == 0. <br>      - <code>&quot;Showing X rows&quot;</code> if visible == total. <br>      - <code>&quot;Showing V of T rows&quot;</code> otherwise. <br><br> <strong>Notes:</strong> <br> - Called by <code>searchTable</code>, <code>toggleTable</code>, <code>toggleAllTables</code>, <code>resetAllTables</code>, and <code>initRenderedContent</code>. <br> - Important for user feedback especially when search hides many rows.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Summary"> <strong>initRenderedContent (relevant parts)</strong><br><br><strong>Overview:</strong> After dynamic HTML injection (e.g., <code>/api/render</code>), this function re-runs the critical initialization steps that affect TOC and search. <br><br> <strong>Key steps relevant to this section:</strong> <br> 1. <strong>Wrap tables</strong>: ensure <code>.table-container</code> exists around each table so selector logic for <code>getTableFromButton()</code> and <code>buildSingleTableToc()</code> works. <br> 2. <strong>Call <code>buildSingleTableToc()</code></strong> (immediately and delayed) to create per-row anchors if single-table conditions hold. <br> 3. <strong>Snapshot rows</strong> using <code>_ensureRowUidsAndSnapshot()</code>, then set <code>sortStates</code> per table. <br> 4. <strong>Attach handlers</strong> to server-rendered toolbar buttons if missing (copy, export, toggle). <br> 5. <strong>Optimize controls</strong> and hide markdown/reset UI (calls <code>optimizeTableControls()</code>, <code>hideExportMarkdownOption()</code>). <br> 6. <strong>Call <code>updateRowCounts()</code></strong> and optionally <code>searchTable()</code> to ensure UI is in a consistent state. <br><br> <strong>Why this matters:</strong> <br> - If dynamic injection places HTML in an area outside <code>#tables-viewer</code> or if the <code>#tocBar</code> is not visible in the rendered DOM, <code>buildSingleTableToc()</code> will either not run or not find <code>#tocBar</code>. <code>initRenderedContent</code> is the rescue path to re-wire search and TOC after injection, but it must be invoked after the injected DOM is appended and visible.                                                                                                                                                                                               </td></tr><tr><td data-label="Summary"> <strong>Common reasons TOC anchors might not exist (summary)</strong><br><br><strong>1. Multiple tables on page:</strong> <code>buildSingleTableToc()</code> intentionally runs only when exactly one <code>.table-wrapper</code> is present. If your page contains >1 table, it will skip per-row TOC creation.  <br><br><strong>2. Missing <code>#tocBar</code>:</strong> If <code>#tocBar</code> does not exist or has a different id/class, the function returns early.  <br><br><strong>3. Function not called after dynamic injection:</strong> If injected content arrives via custom <code>routeHtmlToAreas</code> that hides or replaces <code>#tocBar</code>, <code>initRenderedContent</code> must be invoked by the injector.  <br><br><strong>4. Rows not present at call-time:</strong> If rows are asynchronously generated (e.g., virtualizer, later JS), <code>buildSingleTableToc()</code> ran too early ‚Äî the script attempts a delayed retry, but extremely delayed row generation can still fail.  <br><br><strong>5. Anchor <code>id</code> collisions:</strong> If row ids already exist and conflict with other elements, the function attempts to resolve by suffixing; if collisions are unresolved, anchor hrefs may point to unexpected nodes.  <br><br><strong>6. <code>#stickyMainHeader</code> height or CSS hides anchor target:</strong> If header overlaying hides scrolled-to row, it may seem like TOC didn't work; the code computes header offset but CSS can still cause visual overlap.                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Summary"> <strong>Operational recommendations (TOC/Search stability)</strong><br><br><strong>1. Ensure <code>#tocBar</code> exists</strong> in the DOM before calling <code>initRenderedContent</code> or allow the script to run at window <code>load</code>. <br> <strong>2. For multi-table pages</strong>: either accept no per-row TOC or create per-table TOC entries instead of single-table row anchors. <br> <strong>3. If using <code>routeHtmlToAreas</code></strong>, ensure that it returns <code>true</code> from <code>PasteToTable.routeHtmlToAreas(...)</code> only after the <code>#tocBar</code> and <code>#tables-viewer</code> areas are correctly placed and visible; otherwise call <code>window.PasteToTable.initRenderedContent()</code> after insertion. <br> <strong>4. If rows are populated after initial injection</strong>, call <code>buildSingleTableToc()</code> again (exposed globally) once rows exist.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr></tbody></table></div><div class="row-count">Rows: 15</div></div><div class="table-caption" id="Table3" data-table="Book_8025_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>üìå Section: Copy, Export & Clipboard (overview)</strong><br><br><strong>Purpose:</strong> Provide robust, cross-browser ways for users to copy table content (plain text or Markdown), export single-table artifacts (CSV, JSON, XLSX, PDF, Markdown), and export all tables in bulk.  <br><br> The subsystem must work even when advanced APIs (SheetJS, <code>navigator.clipboard</code>, Web Workers) are missing ‚Äî with graceful fallbacks and user feedback (toasts / modals).  <br><br> It must also preserve accessibility and avoid corrupt filenames.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>copyToClipboard</strong><br><br><strong>‚Ä¢ Overview:</strong> Primary high-level API to copy text to the clipboard; wraps the modern Clipboard API and falls back to legacy approach.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. If <code>navigator.clipboard</code> and <code>navigator.clipboard.writeText</code> are available, call that and return its promise.  <br> 2. If the modern API is unavailable or rejects, call <code>tryLegacyCopy</code>.  <br> 3. Promise resolves on success, rejects on failure.  <br><br> <strong>‚Ä¢ Edge handling & UX:</strong>  <br> - Provides a clean async contract so callers can show success toasts or open <code>showCopyModal</code> on error.  <br> - Uses try/catch and explicit fallback to avoid unhandled rejections in older browsers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Summary"> <strong>tryLegacyCopy</strong><br><br><strong>‚Ä¢ Overview:</strong> DOM-based fallback that uses a hidden <code>&lt;textarea&gt;</code>, selects its contents, and executes <code>document.execCommand(&#x27;copy&#x27;)</code>.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Create <code>&lt;textarea&gt;</code>, set value to the text to copy, mark it <code>readonly</code>, and position it offscreen.  <br> 2. Append to body and call <code>.select()</code>.  <br> 3. Execute <code>document.execCommand(&#x27;copy&#x27;)</code>.  <br> 4. Remove textarea and resolve/reject based on <code>execCommand</code> result.  <br><br> <strong>‚Ä¢ Edge cases & notes:</strong>  <br> - Some browsers require the element to be visible / focusable; the function uses <code>fixed</code> positioning offscreen to be safe.  <br> - If <code>execCommand</code> is disabled by user policies or browser, this rejects and higher-level code should open a copy modal.                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Summary"> <strong>showCopyModal</strong><br><br><strong>‚Ä¢ Overview:</strong> UI fallback shown when clipboard copy fails; provides a large editable textarea where the user can manually copy content, plus convenience buttons (Select All, Copy, Download).  <br><br> <strong>‚Ä¢ Behavior (features):</strong>  <br> 1. Creates an overlay dialog (<code>role=&quot;dialog&quot;</code>, <code>aria-modal=&quot;true&quot;</code>) with a textarea containing the text to copy.  <br> 2. Buttons: <strong>Select All</strong> (focus + select), <strong>Copy</strong> (calls <code>copyToClipboard</code> and shows toast on success/failure), <strong>Download</strong> (creates a text/plain blob and triggers <code>downloadBlob</code>).  <br> 3. Provides keyboard access and closes on Close button.  <br><br> <strong>‚Ä¢ Accessibility & UX:</strong>  <br> - The modal receives focus and attempts to restore previous focus after closing.  <br> - Useful for large payloads or restricted environments where programmatic clipboard is blocked.                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Summary"> <strong>sanitizeFileName</strong><br><br><strong>‚Ä¢ Overview:</strong> Ensure filenames used for downloads are filesystem-safe and reasonably sized.  <br><br> <strong>‚Ä¢ Behavior (rules):</strong>  <br> 1. Coerce to string and <code>trim()</code>.  <br> 2. Replace illegal path characters (<code>/:*?&quot;&lt;&gt; </code>) with underscore.  <br> 3. Collapse whitespace to underscores and truncate to a safe length (e.g., first 200 chars).  <br> 4. Return <code>&#x27;download&#x27;</code> when input is falsy after sanitization.  <br><br> <strong>‚Ä¢ Why important:</strong> Prevents errors when browsers attempt to save files with invalid characters; improves cross-platform portability.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Summary"> <strong>downloadBlob</strong><br><br><strong>‚Ä¢ Overview:</strong> Cross-browser method to cause a blob to be downloaded by the user.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Create <code>URL.createObjectURL(blob)</code>.  <br> 2. Create <code>&lt;a&gt;</code> anchor element, set <code>href</code> to object URL and <code>download</code> to sanitized filename.  <br> 3. Append anchor, <code>.click()</code> it programmatically, then remove it and <code>URL.revokeObjectURL</code>.  <br> 4. Return boolean or throw on error.  <br><br> <strong>‚Ä¢ Edge cases / fallbacks:</strong>  <br> - Some environments (e.g., strict sandboxed frames) may not allow programmatic clicks; the function logs and returns false.  <br> - Ensures the object URL is revoked to avoid leaks.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Summary"> <strong>formatCellForMarkdown</strong><br><br><strong>‚Ä¢ Overview:</strong> Prepare a single table cell‚Äôs text for inclusion in Markdown and for escaping pipe characters and newlines semantically.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Read <code>cell.textContent</code> and trim.  <br> 2. Escape <code>\|</code> to preserve Markdown table column boundaries.  <br> 3. If cell contains newline(s), convert <code>\r\n</code> or <code>\n</code> to <code>&lt;br&gt;</code> for inline representation or other expected behavior.  <br><br> <strong>‚Ä¢ Note:</strong> Used by <code>tableToMarkdownLines</code> to produce robust Markdown rows.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Summary"> <strong>tableToMarkdownLines</strong><br><br><strong>‚Ä¢ Overview:</strong> Produce an array of Markdown lines representing the table (header, separator, rows), optionally prefixing with the table title.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Read all table rows (prefer fully rendered <code>&lt;tr&gt;</code> list).  <br> 2. For header: take first row‚Äôs <code>textContent</code> cells ‚Üí escape pipes ‚Üí produce <code>\| a \| b \|</code>.  <br> 3. Add separator row: <code>\| --- \| --- \|</code>.  <br> 4. For each body row: map cells through <code>formatCellForMarkdown</code> and join with <code>\|</code>.  <br> 5. Return the Markdown lines array.  <br><br> <strong>‚Ä¢ Edge notes:</strong> Preserves heading when present; does not embed cell-level HTML unless sanitized first.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Summary"> <strong>copyTablePlain</strong><br><br><strong>‚Ä¢ Overview:</strong> Copy a single table‚Äôs textual content as plain tab-separated values to clipboard; fallback to <code>showCopyModal</code> on failure.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Determine table via <code>getTableFromButton(btn)</code>.  <br> 2. Build a plain-text string: optional title line + rows joined with <code>\t</code> between cells and <code>\n</code> between rows.  <br> 3. Call <code>copyToClipboard(text)</code>; on success show success toast; on failure open <code>showCopyModal(text, {title:&#x27;Copy table text&#x27;})</code>.  <br> 4. Handles empty table case by showing a warning toast.  <br><br> <strong>‚Ä¢ Notes:</strong> Preserves cell textual content only ‚Äî not HTML formatting.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>copyTableMarkdown</strong><br><br><strong>‚Ä¢ Overview:</strong> Copy a single table as Markdown using <code>tableToMarkdownLines</code>.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Find table, determine title (from closest wrapper <code>h3</code> or fallback).  <br> 2. Compute Markdown lines and <code>join(&#x27;\n&#x27;)</code>.  <br> 3. Call <code>copyToClipboard(md)</code>; on failure show copy modal.  <br><br> <strong>‚Ä¢ UX:</strong> Shows toast on success; warns when table empty.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>copyAllTablesPlain</strong><br><br><strong>‚Ä¢ Overview:</strong> Aggregate all <code>.table-wrapper</code> tables into a single plain text payload and copy it.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Iterate <code>.table-wrapper</code> in DOM; for each table, append title and tab-separated rows.  <br> 2. Join tables with double newline separators for readability.  <br> 3. Copy to clipboard or open modal.  <br><br> <strong>‚Ä¢ Notes:</strong> Useful for exporting quick multi-table plain text; can be large ‚Äî <code>showCopyModal</code> used if clipboard fails.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Summary"> <strong>copyAllTablesMarkdown</strong><br><br><strong>‚Ä¢ Overview:</strong> Aggregate all tables as Markdown into one payload and copy.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Iterate wrappers and call <code>tableToMarkdownLines</code> per table, injecting blank line between tables.  <br> 2. Copy via <code>copyToClipboard</code> or fallback modal.  <br><br> <strong>‚Ä¢ Notes:</strong> Respects per-table headers and ensures combined Markdown is tidy.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Summary"> <strong>exportTableCSV</strong><br><br><strong>‚Ä¢ Overview:</strong> Convert a table to CSV, quoting fields when necessary, include BOM for Excel, and download as <code>.csv</code>.  <br><br> <strong>‚Ä¢ Behavior (detailed):</strong>  <br> 1. Identify table via <code>getTableFromButton</code>.  <br> 2. Map each row to a CSV line: for each cell, if value contains <code>&quot;</code> or <code>,</code> or newline, wrap field in <code>&quot;</code> and escape internal <code>&quot;</code> as <code>&quot;&quot;</code>.  <br> 3. Join rows with <code>\r\n</code>.  <br> 4. Prepend UTF-8 BOM <code>\uFEFF</code> to help Excel detect UTF-8.  <br> 5. Create blob <code>type: &#x27;text/csv;charset=utf-8;&#x27;</code> and <code>downloadBlob</code> with <code>sanitizeFileName(title)+&#x27;.csv&#x27;</code>.  <br> 6. Show success toast on completion.  <br><br> <strong>‚Ä¢ Edge cases:</strong>  <br> - Large tables produce large blobs; browsers may struggle with memory.  <br> - If table empty: warn user instead of producing empty file.                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Summary"> <strong>exportTableMarkdown</strong><br><br><strong>‚Ä¢ Overview:</strong> Build Markdown (<code>.md</code>) file for the table and download.  <br><br> <strong>‚Ä¢ Behavior:</strong>  <br> 1. Use <code>tableToMarkdownLines</code> with optional title.  <br> 2. Join lines with <code>\n</code>, create blob <code>type: &#x27;text/markdown;charset=utf-8&#x27;</code>.  <br> 3. <code>downloadBlob</code> with sanitized filename.  <br> 4. Show toast upon success.  <br><br> <strong>‚Ä¢ Edge cases:</strong>  <br> - Hidden export-markdown UI elements: note that the script hides Markdown export UI early; this function is intentionally available but the UI may be hidden.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Summary"> <strong>exportAllTablesMarkdown</strong><br><br><strong>‚Ä¢ Overview:</strong> Aggregate all tables into one Markdown file and download.  <br><br> <strong>‚Ä¢ Behavior:</strong>  <br> 1. Iterate wrappers and build per-table Markdown lines, add blank line separators.  <br> 2. If no tables found, show warning toast.  <br> 3. Otherwise <code>downloadBlob</code> as <code>all_tables.md</code>.  <br><br> <strong>‚Ä¢ Use case:</strong> Fallback for XLSX when library unavailable ‚Äî human-friendly backup.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Summary"> <strong>exportTableJSON</strong><br><br><strong>‚Ä¢ Overview:</strong> Convert table body rows into JSON array of objects: keys from header row if present, else <code>Col1</code>, <code>Col2</code>, etc.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Determine headers: prefer <code>thead</code> first row; if none, use first row values as keys <code>Col#</code>.  <br> 2. Iterate <code>tbody</code> rows and map each <code>td</code> into corresponding key with <code>textContent.trim()</code>.  <br> 3. <code>JSON.stringify(rows, null, 2)</code> and <code>downloadBlob</code> as <code>.json</code>.  <br> 4. Show success toast.  <br><br> <strong>‚Ä¢ Edge notes:</strong>  <br> - Does not attempt to detect numeric types; everything is string trimmed.  <br> - If table uses semantic markup (nested elements), textContent captures user-visible text.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Summary"> <strong>exportTableXLSX</strong><br><br><strong>‚Ä¢ Overview:</strong> Preferred path uses SheetJS (<code>window.XLSX</code>) to create a true <code>.xlsx</code> file. Fallback to TSV-based blob if SheetJS missing.  <br><br> <strong>‚Ä¢ Behavior (detailed):</strong>  <br> 1. Build <code>aoa</code> (array-of-arrays) by iterating <code>tr</code> and reading <code>th,td</code> text.  <br> 2. If <code>window.XLSX</code> exists and <code>XLSX.utils</code> available:  <br>     a. Create workbook (<code>book_new</code> or object stub).  <br>     b. Convert <code>aoa</code> to sheet via <code>aoa_to_sheet</code>.  <br>     c. Append sheet to workbook and call <code>writeFile</code> or <code>write</code> to obtain binary and download.  <br> 3. If <code>SheetJS</code> fails or missing: prepare TSV rows (quote and join with <code>\t</code>) and create blob with <code>application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</code> mimetype for best compatibility, but warn user that this is a fallback.  <br><br> <strong>‚Ä¢ Edge & UX:</strong>  <br> - Worksheet name trimmed to 31 chars when appending.  <br> - Fallback warns user to install <code>assets/xlsx.full.min.js</code> for real <code>.xlsx</code> support (the SAMPLE_OUTPUT copies xlsx.full.min.js into assets).                                                                                                                            </td></tr><tr><td data-label="Summary"> <strong>exportTablePDF</strong><br><br><strong>‚Ä¢ Overview:</strong> Lightweight approach to export to PDF via opening a print window containing the table HTML, then calling <code>print()</code>; user uses print dialog to save as PDF.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Construct a minimal HTML document string containing a <code>&lt;title&gt;</code> and CSS to style table for printing.  <br> 2. <code>window.open(&#x27;&#x27;, &#x27;_blank&#x27;)</code> and write the HTML into the new window.  <br> 3. After a short delay, <code>focus()</code>, call <code>print()</code> and show a toast indicating print dialog opened.  <br> 4. If window failed to open (popup blocker), show warn toast.  <br><br> <strong>‚Ä¢ Limitations:</strong>  <br> - Relies on browser print subsystem; not a programmatic PDF generator.  <br> - Styling must be self-contained in the injected HTML to ensure print fidelity.                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Summary"> <strong>exportAllBtnHandler</strong><br><br><strong>‚Ä¢ Overview:</strong> UI handler for "Export All" header control; tries to produce a multi-sheet <code>.xlsx</code> using SheetJS, else falls back to combined Markdown (.md) or single combined artifact.  <br><br> <strong>‚Ä¢ Behavior (detailed):</strong>  <br> 1. Collect <code>.table-wrapper</code> elements. If none, warn user.  <br> 2. If <code>window.XLSX</code> available, build workbook and append each table as a worksheet named from wrapper <code>h3</code> or <code>TableN</code> fallback, then <code>writeFile</code> or <code>write</code> + <code>downloadBlob</code>.  <br> 3. If SheetJS path fails or not present, aggregate Markdown lines for all tables and download <code>all_tables.md</code>.  <br> 4. Provide success or fallback warnings via <code>showToast</code>.  <br><br> <strong>‚Ä¢ Edge notes:</strong>  <br> - Workbook sheet name collisions and max-length trimmed.  <br> - Memory/time outs possible on very large combined exports ‚Äî script logs errors and shows warnings rather than crashing.                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Summary"> <strong>saveHtmlHandler</strong><br><br><strong>‚Ä¢ Overview:</strong> Save the currently visible output as standalone HTML (<code>tables.html</code>). This is the Save HTML button behavior.  <br><br> <strong>‚Ä¢ Behavior (steps):</strong>  <br> 1. Prefer <code>#page-area</code> if present and marked <code>.visible</code> AND non-empty; otherwise use <code>#tables-viewer</code>.  <br> 2. If nothing to save, show "Nothing to save" toast and return.  <br> 3. Construct minimal HTML wrapper <code>&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;...</code> and embed the chosen area‚Äôs innerHTML in the <code>&lt;body&gt;</code>.  <br> 4. Create blob <code>type:&#x27;text/html;charset=utf-8&#x27;</code> and call <code>downloadBlob(blob, &#x27;tables.html&#x27;)</code>.  <br> 5. Show success toast.  <br><br> <strong>‚Ä¢ Why Save may not work:</strong>  <br> - The <code>#saveBtn</code> element might not be present or not wired to <code>saveHtmlHandler</code> via <code>attachHeaderHandlersOnce</code>.  <br> - If the injector uses <code>routeHtmlToAreas</code> and hides the resulting <code>#tables-viewer</code>, <code>saveHtmlHandler</code> may have nothing to save.  <br> - If code-based attachments fail (e.g., <code>attachHeaderHandlersOnce</code> did not run), clicking Save may do nothing.  <br><br> <strong>‚Ä¢ Operational note:</strong> <code>attachHeaderHandlersOnce</code> must run (or you must manually attach the click) for Save to function. </td></tr><tr><td data-label="Summary"> <strong>attachHeaderHandlersOnce (relation to export/save)</strong><br><br><strong>‚Ä¢ Overview:</strong> Idempotent function that wires header-level buttons to their handlers ‚Äî essential for Save/Convert/Clear/ExportAll to work.  <br><br> <strong>‚Ä¢ Why it matters here:</strong>  <br> 1. If <code>attachHeaderHandlersOnce</code> did not run (e.g., script loaded before DOM or script was replaced), header buttons may be present but unbound.  <br> 2. Save HTML will appear non-functional when the button exists but no <code>click</code> listener was attached.  <br><br> <strong>‚Ä¢ Check list to ensure Save works:</strong>  <br> - <code>#saveBtn</code> exists and has correct id.  <br> - <code>attachHeaderHandlersOnce</code> executed after the element was inserted.  <br> - No other script swallowed the click event (e.g., <code>stopPropagation()</code> on parent).                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr></tbody></table></div><div class="row-count">Rows: 21</div></div><div class="table-caption" id="Table4" data-table="Book_8025_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>üìå Section: Sorting & Row Identity (overview)</strong><br><br><strong>Purpose:</strong> Provide stable, in-place client-side sorting that preserves DOM identity (IDs, event listeners, anchors).  <br><br> Supports 3-state header toggles (none ‚Üí asc ‚Üí desc ‚Üí reset), and lets reset restore original order.  <br><br> Sorting must be safe for mixed content (numbers, text), preserve <code>data-tv-uid</code> stability, and cooperate with search/highlight and TOC anchors.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Summary"> <strong>originalRowOrders</strong><br><br><strong>‚Ä¢ Purpose:</strong> Global state array holding per-table ordered lists of <code>data-tv-uid</code> values that represent the original row order at snapshot time.  <br><br> <strong>‚Ä¢ Role:</strong> Used to restore original ordering on reset and to implement the ‚Äúreset‚Äù state of the three-state sort cycle.  <br><br> <strong>‚Ä¢ Lifetime:</strong> Updated by <code>_ensureRowUidsAndSnapshot</code> on initial load and whenever <code>initRenderedContent</code> is invoked after dynamic injection.  <br><br> <strong>‚Ä¢ Caution:</strong> If rows are added/removed after snapshot without re-snapshotting, reset will only reorder rows present in snapshot and append new rows at the end.                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>_tv_row_uid_counter</strong><br><br><strong>‚Ä¢ Purpose:</strong> Simple incrementing counter used to generate stable, unique <code>data-tv-uid</code> strings like <code>tvuid-1</code>, <code>tvuid-2</code>.  <br><br> <strong>‚Ä¢ Role:</strong> Ensures <code>data-tv-uid</code> values are unique across multiple tables and re-inits.  <br><br> <strong>‚Ä¢ Caution:</strong> Do not rely on numerical value semantics; it‚Äôs only an identity token. Persist across dynamic re-inits to avoid collisions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Summary"> <strong>sortStates</strong><br><br><strong>‚Ä¢ Purpose:</strong> Per-table array recording each header column‚Äôs current sort state: <code>0</code> = none, <code>1</code> = ascending, <code>2</code> = descending.  <br><br> <strong>‚Ä¢ Role:</strong> Drives <code>updateHeaderSortUI</code> visuals and ARIA attributes and is consulted by <code>sortTableByColumn</code> to compute next state.  <br><br> <strong>‚Ä¢ Initialization:</strong> Set to array of zeros sized to number of header columns during DOM init. Recomputed when <code>initRenderedContent</code> snapshots tables.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Summary"> <strong>safeGetTBody</strong><br><br><strong>‚Ä¢ Purpose:</strong> Defensive helper returning <code>table.tBodies[0]</code> or <code>null</code> safely (avoids exceptions if table shape unexpected).  <br><br> <strong>‚Ä¢ Role:</strong> Ensures functions that operate on table body (sorting, counting, snapshotting) gracefully handle tables missing <code>&lt;tbody&gt;</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Summary"> <strong>_ensureRowUidsAndSnapshot</strong><br><br><strong>Purpose:</strong> Ensure stable internal row identities and capture original order.  <br><br> <strong>Behavior:</strong>  <br> 1. Use <code>safeGetTBody(table)</code> to get <code>tbody</code>.  <br> 2. For each <code>tr</code> without <code>data-tv-uid</code>, assign <code>tvuid-&lt;counter&gt;</code> and increment <code>_tv_row_uid_counter</code>.  <br> 3. Push each row‚Äôs UID into an <code>order</code> array.  <br> 4. Store <code>originalRowOrders[tableIdx] = order</code>.  <br><br> <strong>Why:</strong> Maintains stable keys independent of DOM IDs.  <br><br> <strong>Edge cases:</strong> If table index mapping changes, snapshots may misalign; <code>initRenderedContent</code> re-snapshots on DOM changes.                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Summary"> <strong>updateHeaderSortUI</strong><br><br><strong>Purpose:</strong> Update header visuals and accessibility state based on <code>sortStates</code>.  <br><br> <strong>Behavior:</strong>  <br> 1. Locate table/header by <code>tableIdx</code>.  <br> 2. For each <code>th.sort-btn</code>, clear old sort-state classes and apply <code>sort-state-&lt;n&gt;</code> from <code>sortStates</code>.  <br> 3. Set <code>aria-sort</code> to <code>ascending</code> / <code>descending</code> / <code>none</code>.  <br> 4. Update <code>.sort-icon</code> innerHTML for the proper arrow.  <br><br> <strong>Accessibility:</strong> Proper <code>aria-sort</code> improves screen reader output.  <br><br> <strong>Idempotent:</strong> Safe to call multiple times.                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Summary"> <strong>sortTableByColumn</strong><br><br><strong>Purpose:</strong> Core three-state sort routine (none ‚Üí asc ‚Üí desc ‚Üí reset), reorders rows in place without cloning.  <br><br> <strong>Behavior:</strong>  <br> 1. Resolve table via <code>tableIdx</code>.  <br> 2. Get <code>tbody</code>.  <br> 3. Get current <code>state = sortStates[tableIdx][colIdx]</code>.  <br> 4. Collect rows.  <br> 5. If <code>state===0</code>: ascending sort (numeric if possible, else lexicographic), set state = 1.  <br> 6. If <code>state===1</code>: descending sort, set state = 2.  <br> 7. If <code>state===2</code>: reset using <code>originalRowOrders[tableIdx]</code>, rebuild order by UID, set state = 0.  <br> 8. Reset other column states to 0.  <br> 9. Append sorted rows to <code>tbody</code>.  <br> 10. Ensure each cell has <code>dataset.origHtml</code>.  <br> 11. Call <code>updateHeaderSortUI()</code> and <code>updateRowCounts()</code>.  <br><br> <strong>Design:</strong> In-place, numeric-first comparator, stable UID reset.  <br><br> <strong>Edge cases:</strong> Missing snapshot = no-op reset; mixed data = lexicographic; large tables may lag. </td></tr><tr><td data-label="Summary"> <strong>headerSortButtonClicked</strong><br><br><strong>Purpose:</strong> Wrapper for inline or delegated sort events.  <br><br> <strong>Behavior:</strong>  <br> ‚Ä¢ Calls <code>sortTableByColumn(tableIdx, colIdx)</code> and focuses the clicked button.  <br><br> <strong>Note:</strong> Exposed as <code>window.headerSortButtonClicked</code> for server-rendered <code>onclick</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Summary"> <strong>Interaction: Sorting ‚Üî Search/Highlight</strong><br><br><strong>Key interactions:</strong>  <br> 1. Sorting preserves <code>data-origHtml</code> so highlights restore correctly.  <br> 2. <code>searchTable</code> uses <code>row.style.display</code>; sorting doesn‚Äôt affect visibility.  <br> 3. <code>updateRowCounts()</code> runs post-sort.  <br><br> <strong>Recommendation:</strong> After heavy reorders, call <code>updateRowCounts()</code> and re-run <code>searchTable()</code> to reapply filters.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table5" data-table="Book_8025_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>üìå Section: Collapse / Expand & Reset (overview)</strong><br><br><strong>Purpose:</strong> Allow collapsing a single table (hide tbody), toggling all tables at once, and restoring original table data/layout state.  <br><br> These operations must be reversible and must preserve sort snapshots and <code>data-tv-uid</code> identity.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Summary"> <strong>toggleTable</strong><br><br><strong>Purpose:</strong> Collapse or expand the table body for a single wrapper (keeps header visible).  <br><br> <strong>Behavior:</strong>  <br> 1. Identify wrapper via <code>btn.closest(&#x27;.table-wrapper&#x27;)</code>.  <br> 2. Get table and <code>tbody</code> via <code>safeGetTBody</code>.  <br> 3. Compute <code>isCollapsed</code> by checking <code>tbody.style.display === &#x27;none&#x27;</code>.  <br> 4. If collapsed ‚Üí expand and update button/ARIA.  <br> 5. Else ‚Üí collapse and update button/ARIA.  <br> 6. Update global <code>#toggleAllBtn</code> text accordingly.  <br> 7. Call <code>updateRowCounts()</code>.  <br><br> <strong>Design notes:</strong> Collapsing only toggles <code>tbody</code> to preserve header; <code>aria-expanded</code> aids accessibility; button text reflects state.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Summary"> <strong>toggleAllTables</strong><br><br><strong>Purpose:</strong> Collapse or expand all <code>.table-wrapper</code> objects at once.  <br><br> <strong>Behavior:</strong>  <br> 1. Get all wrappers.  <br> 2. Check if any expanded.  <br> 3. If expanded ‚Üí collapse all and update texts.  <br> 4. Else ‚Üí expand all.  <br> 5. Call <code>updateRowCounts()</code>.  <br><br> <strong>Notes:</strong> Provides quick hide/show for many tables; uses inline styles.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Summary"> <strong>resetAllTables</strong><br><br><strong>Purpose:</strong> Restore tables to original state ‚Äî row order, per-cell <code>data-origHtml</code>, sorting state, collapse state, and search clearing.  <br><br> <strong>Behavior:</strong>  <br> 1. Iterate tables.  <br> 2. Reorder rows by <code>originalRowOrders[idx]</code>.  <br> 3. Refresh <code>dataset.origHtml</code>.  <br> 4. Reset sort states & UI.  <br> 5. Uncollapse all.  <br> 6. Clear search box, run <code>searchTable()</code>.  <br> 7. Update row counts and show toast.  <br><br> <strong>Subtleties:</strong> UID-based reset ensures reliable restoration. <code>data-origHtml</code> prevents highlight mismatches. Missing snapshot ‚Üí conservative behavior.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Summary"> <strong>hideResetAllTablesOption</strong><br><br><strong>Purpose:</strong> UI-only hide for ‚Äúreset all‚Äù affordances while preserving functionality.  <br><br> <strong>Behavior:</strong> Scans DOM for ‚Äúreset all‚Äù elements and hides them.  <br><br> <strong>Why:</strong> Allows templates to disable UI without breaking API.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>updateRowCounts (recap)</strong><br><br><strong>Purpose:</strong> Keep <code>.row-count</code> accurate.  <br><br> <strong>Behavior:</strong>  <br> ‚Ä¢ For each wrapper, compute total & visible rows.  <br> ‚Ä¢ Update display text accordingly.  <br><br> <strong>Note:</strong> Called frequently after sorts, toggles, search updates, and resets.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>buildNormalizedMapForCell</strong><br><br><strong>Purpose & Problem Addressed</strong>: produce a <em>normalized</em> string for a cell's visible text and a mapping that ties each character in that normalized string back to the original DOM text node and offset. This mapping is essential because table cell content is often split into multiple text nodes (due to <code>&lt;strong&gt;</code>, <code>&lt;code&gt;</code>, inline tags), and correct highlighting must operate on real DOM nodes without corrupting structure. <br><br> <strong>Detailed Steps & Behavior:</strong><br>1. <strong>Text-node collection</strong> ‚Äî Walk the cell with a <code>TreeWalker</code> for <code>NodeFilter.SHOW_TEXT</code>, collecting non-empty text nodes in document order. Skip nodes that are empty or whitespace-only. <br>2. <strong>Per-node iteration</strong> ‚Äî For each collected text node, iterate through its code points (use code-point-aware logic to handle surrogate pairs). <br>3. <strong>Normalization of each character</strong> ‚Äî For each code point: apply <code>NFD</code> decomposition, strip combining marks (diacritics), then filter characters with a Unicode-aware character class (prefer <code>\p{L}\p{N}</code>) or fallback to <code>\w</code>. <br>4. <strong>Map building</strong> ‚Äî For every accepted normalized character appended to <code>normStr</code>, push an entry into <code>map</code> that records <code>{ nodeIndex, offsetInNode }</code> ‚Äî the source text-node index and the original offset in that node where the char came from. <br>5. <strong>Return structure</strong> ‚Äî <code>{ normStr, map, nodes }</code> where <code>nodes</code> is the array of original text nodes. <br><br> <strong>Complexity & Costs:</strong> O(T) where T = total characters across text nodes in the cell (plus overhead for normalization per codepoint). Memory proportional to T for <code>normStr</code> and <code>map</code>. <br><br> <strong>Why this is robust</strong>: mapping allows split-and-wrap operations (via <code>splitText</code>) on exact text nodes and offsets rather than relying on brittle character indexing across DOM.                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Summary"> <strong>highlightMatches</strong><br><br><strong>Purpose</strong>: Using the <code>normStr</code> and <code>map</code> returned by <code>buildNormalizedMapForCell</code>, locate normalized matches and wrap them in <code>&lt;mark&gt;</code> elements in the <em>original DOM</em>, carefully splitting text nodes only where necessary. <br><br> <strong>Detailed Steps & Behavior:</strong><br>1. <strong>Restore baseline</strong> ‚Äî If <code>cell.dataset.origHtml</code> exists, restore it to ensure we start from a clean baseline (prevents nested marks). <br>2. <strong>Build normalized map</strong> ‚Äî call <code>buildNormalizedMapForCell(cell)</code> to obtain <code>normStr</code>, <code>map</code>, and <code>nodes</code>. <br>3. <strong>Find matches</strong> ‚Äî compute all <code>indexOf</code> occurrences of <code>needle</code> in <code>normStr</code> (can be multiple, possibly overlapping depending on sliding index logic ‚Äî search handles sequential non-overlapping by moving pos forward). <br>4. <strong>Process matches in reverse order</strong> ‚Äî iterate matches from last to first to avoid offset invalidation as DOM is mutated. For each match: <br>    a. Map start and end normalized indices to <code>startMap</code> and <code>endMap</code> entries (giving nodeIndex and offsetInNode). <br>    b. Compute exact offsets in the original text nodes; adjust end offset for multi-codepoint characters by testing <code>codePointAt</code>. <br>    c. If the start and end are in the same node, use <code>splitText</code> twice to isolate the middle substring and replace it with a <code>&lt;mark&gt;</code> containing that substring. <br>    d. If spanning multiple nodes, split start and end nodes and move all intermediate nodes / fragments into a new <code>&lt;mark&gt;</code> DOM node inserted at the appropriate parent position. <br>5. <strong>Error resilience</strong> ‚Äî wrap changes in <code>try/catch</code> per-match so a single problematic range doesn‚Äôt abort all highlights. <br><br> <strong>Important subtleties:</strong><br>- Reverse ordering prevents index shifts during DOM writes. <br>- Because the algorithm manipulates text nodes directly, it preserves adjacent element structure and inline semantics. <br><br> <strong>Costs & Limits:</strong> O(T + M) where T is text length and M is number of matches. DOM mutations (splitText, node moves) are the heavy parts and can be expensive if many matches span many nodes. </td></tr><tr><td data-label="Summary"> <strong>clearHighlights</strong><br><br><strong>Purpose</strong>: Remove previously inserted <code>&lt;mark&gt;</code> wrappers and restore original markup. <br><br> <strong>Behavior & Options:</strong><br>1. <strong>Fast restore</strong> ‚Äî if <code>cell.dataset.origHtml</code> exists, set <code>cell.innerHTML = cell.dataset.origHtml</code> and return. This is the cheapest and safest route. <br>2. <strong>Granular restore</strong> ‚Äî otherwise find <code>&lt;mark&gt;</code> elements and replace them with text nodes of their text content (so inline styling not preserved). <br><br> <strong>Why <code>data-origHtml</code> matters</strong>: storing baseline HTML when the table is first processed avoids complex DOM surgery on restore and ensures attributes and inline elements are preserved exactly as originally rendered. But storing <code>origHtml</code> consumes memory (string per cell).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Summary"> <strong>normalizeForSearchLocal</strong><br><br><strong>Role in highlighting pipeline</strong>: This function normalizes both user query and cell text for matching ‚Äî it is used inside <code>buildNormalizedMapForCell</code> logic (conceptually) and also during quick text-only matching to determine whether to call <code>highlightMatches</code>. <br><br> <strong>Key behaviors (recap):</strong><br>1. <code>NFD</code> decomposition and removal of combining diacritics. <br>2. Strip punctuation via Unicode character classes (fallbacks available). <br>3. Collapse whitespace and lower-case. <br><br> <strong>Performance note:</strong> Running this on every cell on every keystroke can be expensive; consider caching normalized forms for cells and invalidating caches only when their content changes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Summary"> <strong>searchTable</strong><br><br><strong>Highlighting integration points</strong>:<br>1. <code>searchTable</code> computes <code>filterNorm</code> once per invocation (debounced) via <code>normalizeForSearchLocal</code>. <br>2. It iterates rows and, when a rowMatches is found by quick string test, it optionally calls <code>highlightMatches</code> per cell depending on <code>tvConfig.highlight</code>. <br><br> <strong>Performance hot spot</strong>: The per-cell normalized mapping and DOM highlight operations are the heaviest parts of <code>searchTable</code>, especially when many rows/cells must be considered. Debouncing reduces frequency, but each run can still be heavy.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Summary"> <strong>debounce</strong><br><br><strong>Mitigating highlight churn</strong>: Wrapping <code>searchTable</code> in <code>debounce</code> reduces the frequency of highlight rebuilds while user types. Proper <code>debounceMs</code> setting (e.g., 150‚Äì300ms) balances responsiveness and CPU work. On very large tables consider a longer debounce value or disabling highlight entirely via <code>tvConfig.highlight = false</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Summary"> <strong>optimizeTableControls / _debouncedOptimize</strong><br><br><strong>Indirect performance role</strong>: While primarily about DOM reflow and toolbar layout, <code>optimizeTableControls</code> and its debounced invocation on resize avoid extra layout thrash during window resizes (which could otherwise trigger re-highlighting or virtualizer updates). Keep it debounced.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Summary"> <strong>window.tableVirtualizer interactions</strong><br><br><strong>Why a virtualizer helps</strong>: If the page integrates a virtual scroller (<code>window.tableVirtualizer</code>), heavy operations should only run on <em>visible</em> rows. The script attempts <code>window.tableVirtualizer.refresh()</code> or <code>.update()</code> after filtering to allow a virtualizer to reconcile its internal state. <br><br> <strong>Recommended flow with a virtualizer:</strong><br>1. <strong>Search</strong> ‚Üí produce a list of matching row indices (or UIDs) instead of highlighting all at once. <br>2. <strong>Virtualizer</strong> receives visible window of rows and only <code>highlightMatches</code> for those visible rows. <br>3. Optionally precompute and cache normalized text per cell and let worker compute which ranges to highlight (see below).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Summary"> <strong>Performance & complexity analysis (high level)</strong><br><br><strong>1. Per-cell cost (buildNormalizedMapForCell):</strong> O(L) time and O(L) extra memory for <code>normStr</code>+<code>map</code> where L = number of chars in that cell‚Äôs visible text. <br><strong>2. Per-row cost:</strong> sum of per-cell costs. <br><strong>3. Per-search invocation cost:</strong> O(total_chars_in_scoped_cells + cost_of_DOM_mutations_for_matches). DOM writes (splitText, replacing nodes) dominate runtime and are not CPU-bound-only ‚Äî they trigger layout/paint. <br><strong>4. Worst-case:</strong> If <code>tvConfig.highlight</code> is on and the whole table matches on every keystroke, you'll rebuild mapping & DOM marks for every visible cell repeatedly ‚Äî a large UI freeze risk.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Summary"> <strong>Practical mitigations & engineering recommendations</strong><br><br><strong>A. Limit highlight scope:</strong><br>1. Only highlight visible rows (use a virtualizer or IntersectionObserver to know what's in view).<br>2. If no virtualizer, chunk processing (see B).<br><br><strong>B. Chunking & yielding:</strong><br>1. Process rows in batches (e.g., 50 rows/chunk). <br>2. Use <code>setTimeout(...,0)</code> or <code>requestIdleCallback</code> between chunks to yield to the main thread and avoid jank. <br><br><strong>C. Precompute & cache normalized forms:</strong><br>1. On initial render (<code>initRenderedContent</code>), compute a <code>data-</code> attribute or a WeakMap cache entry for each cell‚Äôs <code>normStr</code> (or at least <code>textContent</code> normalized). <br>2. On subsequent searches, reuse the cached normalized string to avoid recomputation. <br>3. Invalidate cache if cell content changes. <br><strong>Tradeoff:</strong> increased memory use vs much faster searches. <br><br><strong>D. Use Web Worker for CPU-bound normalization & matching:</strong><br>1. Worker can compute which rows / ranges match and return compact descriptors (tableUid, rowUid, cellIndex, matchRanges in normalized indices). <br>2. The main thread still performs DOM splits & wraps (workers can't touch DOM), but the heavy text normalization and search work happens off-thread. <br>3. This reduces main-thread stall time; still some UI cost remains for DOM mutation but overall latency is improved. <br><br><strong>E. Precompute match ranges server-side when possible:</strong><br>1. If <code>/api/render</code> can produce metadata (e.g., per-cell normalized text or token index), the client can use that to speed searches. <br><br><strong>F. Config toggles & safe defaults:</strong><br>1. Expose <code>tvConfig.highlight</code> (already present) and make default <code>false</code> for extremely large tables or provide <code>tvConfig.maxHighlightRows = 500</code>. <br>2. Provide explicit UI that disables highlight when rows > threshold.                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>Caching strategies (safe approaches)</strong><br><br><strong>1. <code>data-</code> attributes per cell</strong> ‚Äî store <code>data-norm</code> with normalized text. Pros: survives re-renders; accessible from worker? (workers cannot access DOM so they'd need copies). Cons: increases DOM memory and HTML size. <br><strong>2. WeakMap keyed by text node or cell element</strong> ‚Äî store <code>{normStr, map}</code>. Pros: lower DOM pollution, automatically GC when node removed. Cons: must manage invalidation if content changes. <br><strong>3. Hybrid</strong> ‚Äî store lightweight normalized text in data-attribute, keep heavy <code>map</code> cached in WeakMap. Invalidate WeakMap when element receives new content.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Summary"> <strong>Safety & UX fallbacks</strong><br><br><strong>1. If highlight is too slow, disable it automatically</strong> when the number of cells or total characters exceeds a threshold; show a toast explaining ‚ÄúHighlighting disabled for large datasets ‚Äî toggle on if you want it.‚Äù <br><strong>2. Provide an option ‚ÄúHighlight only first N matches‚Äù</strong> so users see immediate feedback without full DOM mutation. <br><strong>3. Respect accessibility ‚Äî ensure <code>&lt;mark&gt;</code> tags are used semantically; avoid generating focus traps.</strong>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Summary"> <strong>Diagnostics & instrumentation</strong><br><br><strong>1. Console timing hooks</strong> ‚Äî run <code>console.time(&#x27;highlight&#x27;)</code> / <code>console.timeEnd(&#x27;highlight&#x27;)</code> around expensive operations to measure. <br><strong>2. Expose counters</strong> ‚Äî number of cells processed, matches found, time spent ‚Äî via debug UI or <code>window.__tv_patch_diag</code> extension. <br><strong>3. Health threshold alerts</strong> ‚Äî warn via <code>showToast</code> when an operation exceeds a duration (e.g., > 800ms).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Summary"> <strong>Summary ‚Äî practical, prioritized plan</strong><br><br><strong>Short-term</strong>: Respect <code>tvConfig.highlight</code>; default to off for huge tables; enable simple caching of normalized cell text (<code>data-norm</code>) during <code>initRenderedContent</code>. <br><strong>Medium-term</strong>: Move text normalization & match-finding to a Web Worker; main thread performs DOM splitting for only the visible rows (integrate with virtualizer). <br><strong>Long-term</strong>: If table sizes are regularly huge, incorporate proper virtualization + server-side indexing to avoid per-client heavy processing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr></tbody></table></div><div class="row-count">Rows: 20</div></div><div class="table-caption" id="Table6" data-table="Book_8025_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>üìå Section: Injection & Convert Overview</strong><br><br><strong>Purpose:</strong> Accept rendered HTML from the server (<code>/api/render</code>), inject it into the page safely and idempotently, reinitialize client behaviors (TOC, handlers, snapshots), and provide resilient UI for the Convert action so it survives DOM replacement, partial failures, and differences in server payload shape. This layer must: <br>1) accept multiple payload shapes (HTML string, JSON with <code>html</code> key, <code>result</code>, or <code>body</code>), <br>2) prefer an application-defined router (<code>routeHtmlToAreas</code>) when present, <br>3) fallback to <code>#tables-viewer</code> injection, and 4) always call <code>initRenderedContent</code> to rewire client features.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Summary"> <strong>processRenderedHtml</strong><br><br><strong>Purpose & Inputs:</strong> Process the response from <code>/api/render</code> before insertion. Accepts either a string or object payload and normalizes to <code>html</code>.  <br><br><strong>Primary responsibilities (stepwise):</strong>  <br>1. <strong>Normalize payload:</strong> If payload is string ‚Üí treat as HTML. If object ‚Üí extract <code>html</code>, <code>result</code>, or <code>body</code> fields; if none, serialize object to string for safety.  <br>2. <strong>Route injection:</strong> If <code>window.PasteToTable.routeHtmlToAreas</code> exists and returns <code>true</code>, treat it as successfully routed; otherwise fallback to placing HTML into <code>#tables-viewer</code>.  <br>3. <strong>Fallback UI handling:</strong> When falling back, hide <code>#page-area</code> if present and ensure <code>#tables-viewer</code> is visible.  <br>4. <strong>Init behaviors after injection:</strong> Schedule <code>initRenderedContent</code> (two time-delayed calls) to let the DOM settle, build TOC, snapshot rows, attach toolbar handlers and compute row counts.  <br>5. <strong>Return contract:</strong> Return <code>true</code> on success or <code>false</code> if injection failed; log error details for diagnostics.  <br><br><strong>Resiliency notes:</strong>  <br>- Accepts several payload shapes to be resilient against server-side variations.  <br>- Uses delayed <code>initRenderedContent</code> calls to tolerate slightly asynchronous element creation by other scripts.  <br>- Catches and logs exceptions to avoid breaking the calling Convert flow.                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Summary"> <strong>routeHtmlToAreas (external contract)</strong><br><br><strong>What it is:</strong> An optional application-provided function (on <code>window.PasteToTable</code>) that allows integrators to control where and how rendered HTML is placed (for example to split content between <code>#page-area</code> and <code>#tables-viewer</code>).  <br><br><strong>Integration contract (expected behavior):</strong>  <br>1. Accepts <code>(html, metadata)</code> and returns <code>true</code> when it handled insertion (so <code>processRenderedHtml</code> should not replace <code>#tables-viewer</code>).  <br>2. If it returns <code>false</code> or throws, <code>processRenderedHtml</code> falls back to <code>#tables-viewer</code> injection.  <br><br><strong>Common failure modes:</strong>  <br>- <code>routeHtmlToAreas</code> may hide the <code>#tocBar</code> or insert content in a different DOM subtree; integrator must call <code>PasteToTable.initRenderedContent()</code> after any manipulations that move or hide the elements this script expects.  <br>- If <code>routeHtmlToAreas</code> returns <code>true</code> but does not expose the expected areas (e.g., the <code>#tables-viewer</code> remains empty), Save/TOC operations may not find content ‚Äî injectors should ensure expected IDs exist or call the re-init exposures.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Summary"> <strong>initRenderedContent (focused on injection-resilience)</strong><br><br><strong>Purpose:</strong> Re-run all table wiring steps after HTML is injected or replaced. It must be idempotent and safe to call multiple times.  <br><br><strong>Key responsibilities (detailed):</strong>  <br>1. <strong>Structural normalization:</strong> Wrap orphan tables in <code>.table-container</code> when missing so other selector logic works uniformly.  <br>2. <strong>Build TOC:</strong> Call <code>buildSingleTableToc()</code> immediately and again after a short delay to support asynchronous row creation.  <br>3. <strong>Row snapshotting:</strong> For each <code>table</code> call <code>_ensureRowUidsAndSnapshot(table, idx)</code> and initialize <code>sortStates[idx]</code>.  <br>4. <strong>Attach handlers:</strong> Attach copy/export/toggle handlers to server-rendered toolbar buttons if they lack explicit <code>onclick</code>. Protect with <code>dataset.tvHandlerAttached</code> to avoid double-binding.  <br>5. <strong>Set <code>data-origHtml</code> on cells:</strong> Ensure highlight restore baseline exists.  <br>6. <strong>Update UI state:</strong> Update header sort UI, toggle button text, backToTop existence, search attachments, and initial <code>updateRowCounts</code>.  <br>7. <strong>Optimize & cleanup:</strong> Call <code>optimizeTableControls()</code>, hide export markdown / reset UI affordances via <code>hideExportMarkdownOption()</code> and <code>hideResetAllTablesOption()</code> for UX parity.  <br><br><strong>Edge cases & best practices:</strong>  <br>- <strong>Timing:</strong> Because <code>initRenderedContent</code> is called multiple times (immediately and delayed), avoid operations that are not idempotent or that rely on one-time global side-effects.  <br>- <strong>Event binding:</strong> Use <code>dataset</code> flags to prevent re-attaching the same event listeners when the DOM is re-initialized.  <br>- <strong>Exposed API:</strong> <code>processRenderedHtml</code> schedules <code>initRenderedContent</code>, but integrators should call <code>window.PasteToTable.initRenderedContent()</code> if they manipulate injection asynchronously. </td></tr><tr><td data-label="Summary"> <strong>convertButtonHandler</strong><br><br><strong>Purpose:</strong> Primary UI handler tied to the Convert button; collects user input (from <code>#paste</code>), sends it to <code>/api/render</code>, and injects resulting HTML using <code>processRenderedHtml</code>.  <br><br><strong>Detailed flow (resilient steps):</strong>  <br>1. <strong>Disable UI:</strong> Disable the Convert button to avoid duplicate submissions.  <br>2. <strong>Input check:</strong> Ensure <code>#paste</code> contains non-empty text; show warn toast and re-enable button if empty.  <br>3. <strong>Fetch:</strong> Attempt <code>fetch(&#x27;/api/render&#x27;, { method: &#x27;POST&#x27;, body: JSON.stringify({text})})</code>.  <br>4. <strong>Form-encoded fallback:</strong> If JSON fetch fails (network), attempt <code>application/x-www-form-urlencoded</code> <code>POST</code> as a second attempt for servers expecting form payloads.  <br>5. <strong>HTTP error handling:</strong> If <code>resp.ok</code> falsy, read text body for diagnostics, show an error toast, set <code>#status</code> text, and re-enable Convert.  <br>6. <strong>Parse response:</strong> If <code>Content-Type</code> is JSON, <code>resp.json()</code>; otherwise treat as HTML text and wrap into <code>{ html: text }</code>.  <br>7. <strong>Injection:</strong> Call <code>processRenderedHtml(payload)</code>; on success show success toast and update <code>#status</code> with metadata (if present).  <br>8. <strong>Finalization:</strong> Re-enable Convert button in <code>finally</code> block to ensure UI stays responsive even on errors.  <br><br><strong>Resiliency design points:</strong>  <br>- <strong>Dual fallback for posting:</strong> Some servers (or reverse-proxies) prefer form-encoded posts ‚Äî the two-step submit increases success rate.  <br>- <strong>Accept multiple response shapes:</strong> Increases compatibility with servers that return either HTML or JSON.  <br>- <strong>Timeouts & UI feedback:</strong> Consider adding explicit timeout handling to show network-timeout toasts if fetch hangs (not present in current script but recommended).                                                                         </td></tr><tr><td data-label="Summary"> <strong>Convert robustness patch ‚Äî __tv_convert_click_ev</strong><br><br><strong>Purpose:</strong> Make Convert resilient to multiple script versions and DOM replacement by delegating to any existing <code>convertButtonHandler</code>, else perform a minimal fallback POST and injection. Designed to be attached by delegation so it triggers even when the Convert button is replaced by new HTML or re-rendered.  <br><br><strong>Behavior & priorities (stepwise):</strong>  <br>1. <strong>Detect existing handler:</strong> If <code>window.convertButtonHandler</code> already exists (the main one), call it and return (preserve original behavior).  <br>2. <strong>Fallback minimal action:</strong> If no existing handler or if it throws, perform a simple POST to <code>/api/render</code> with JSON body and accept either JSON or HTML response.  <br>3. <strong>Injection fallback:</strong> Attempt <code>window.PasteToTable.routeHtmlToAreas(...)</code> if present; else insert into <code>#tables-viewer</code>.  <br>4. <strong>Init call:</strong> Call <code>window.PasteToTable.initRenderedContent()</code> if exposed.  <br>5. <strong>Diagnostics:</strong> Uses safe console helpers to log debug/warn messages; shows user alerts on fatal network errors in the fallback path (simpler UX than complex toasts when existing handler is not present).  <br><br><strong>Why this helps:</strong>  <br>- If the page replaces <code>script.js</code> with a new copy, or the Convert button is re-rendered without wiring, the delegated click listener attached by this patch still catches clicks and runs the fallback handler.  <br>- Because it delegates to any existing <code>convertButtonHandler</code>, it is non-destructive and additive.                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Summary"> <strong>Convert delegation ‚Äî document-level delegated click</strong><br><br><strong>Purpose:</strong> Ensure Convert click handling survives DOM replacements by attaching a document-level delegated click listener that catches elements matching <code>#convertBtn</code> or <code>[data-action=&quot;convert&quot;]</code>.  <br><br><strong>Behavior & resilience:</strong>  <br>1. <strong>Delegation:</strong> Attach a one-time delegation marker (<code>window.__tv_convert_delegation_attached</code>) to avoid duplicate delegation.  <br>2. <strong>Click filter:</strong> On click, find the closest matching convert element; if found, call <code>__tv_convert_click_ev(ev)</code> and <code>preventDefault()</code> / <code>stopPropagation()</code> to centralize handling.  <br>3. <strong>Direct attach attempt:</strong> Also try to attach direct <code>click</code> listener to current <code>#convertBtn</code> for convenience, and mark it <code>dataset.__tv_convert_attached</code> to prevent double-binding.  <br><br><strong>Why this is robust:</strong> Delegation ensures that even if the convert button is removed and reinserted later, clicks still get caught and processed because the document-level handler remains. Direct attach provides lower-latency handling if element persists.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Summary"> <strong>attachHeaderHandlersOnce</strong><br><br><strong>Purpose:</strong> Idempotent wiring of header controls (Convert, Clear, Save, Export All, Render) ‚Äî crucial for Save/Export to function.  <br><br><strong>Behavior & importance:</strong>  <br>1. <strong>Idempotency:</strong> internal flag prevents multiple attachments.  <br>2. <strong>Attach Convert/Clear/Save/ExportAll:</strong> Attaches <code>convertButtonHandler</code>, <code>clearButtonHandler</code>, <code>saveHtmlHandler</code>, and <code>exportAllBtnHandler</code> to their respective header elements if present.  <br>3. <strong>Render button wiring:</strong> Also wires <code>renderBtn</code> to submit a form if present.  <br>4. <strong>Why Save fails if missing:</strong> If <code>#saveBtn</code> exists but <code>attachHeaderHandlersOnce</code> didn't run (e.g., script executed before elements inserted and no later re-init), then clicking Save does nothing because no event listener is bound.  <br><br><strong>Operational recommendation:</strong> Ensure <code>attachHeaderHandlersOnce</code> executes after header markup is in the DOM (the script mounts it on DOMContentLoaded or via delayed <code>setTimeout</code>); if header is generated dynamically, call <code>attachHeaderHandlersOnce()</code> after insertion.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Summary"> <strong>Extra loader & minimalTopicFallback (startExtraLoader / loadExtraSequentially / minimalTopicFallback)</strong><br><br><strong>Purpose:</strong> Robustly try multiple candidate paths for <code>extra.js</code> (an optional enhancement file) and, if not found, perform a minimal fallback that adjusts single-table TOC labels to ‚ÄúTopic‚Äù for mobile UX.  <br><br><strong>Behavior & failure resilience:</strong>  <br>1. <strong>Candidate array:</strong> Build candidate URLs derived from detected script base and common fallbacks (<code>extra.js</code>, <code>assets/extra.js</code>, <code>/assets/extra.js</code>, etc.).  <br>2. <strong>Sequential attempts:</strong> <code>loadExtraSequentially</code> tries each candidate in order, attaching <code>onload</code>/<code>onerror</code> hooks and proceeding to next candidate on error.  <br>3. <strong>Idempotency:</strong> <code>window._tv_extra_loader_attached</code> prevents duplicate starts.  <br>4. <strong>Fallback <code>minimalTopicFallback</code>:</strong> If all extra.js loads fail, attempt to friendly-relabel anchors/heading nodes when there is exactly one TOC anchor or one table wrapper, swapping the visible word ‚ÄúTable‚Äù to ‚ÄúTopic‚Äù to create better single-table mobile labels.  <br>5. <strong>Diagnostics:</strong> Expose <code>__tv_patch_diag</code> that reports whether <code>extra.js</code> loaded and lists detected anchors for debugging.  <br><br><strong>Operational recommendations:</strong>  <br>- Ensure body attributes <code>data-index-url</code> and <code>data-worker-url</code> are present or are set by <code>ensureIndexAndWorkerAttrs</code> (otherwise extra.js may behave unexpectedly).  <br>- If <code>extra.js</code> path differs in your environment, either place the file at one of the candidate paths or set <code>window.__tv_no_auto_extra_load = true</code> and manually load the desired extra file.                                                                                                                                                                                                                       </td></tr><tr><td data-label="Summary"> <strong>loadScriptOnce / attemptLoadExtra / loadExtraSequentially (loader mechanics)</strong><br><br><strong>Loader semantics & safety:</strong>  <br>1. <strong>Load once check:</strong> Avoid injecting duplicate <code>&lt;script&gt;</code> tags for the same src by scanning existing scripts; if already present, treat as success.  <br>2. <strong>Onload / onerror wiring:</strong> Attach <code>onload</code> to signal successful load and call <code>onDone</code>; <code>onerror</code> removes failed tag and tries next candidate.  <br>3. <strong>Non-async for sequential ordering:</strong> Insert scripts with <code>async: false</code> for sequential execution order when required.  <br><br><strong>Why important:</strong> Extra modules may register behavior that <code>initRenderedContent</code> expects; sequential loading ensures dependency ordering.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Summary"> <strong>Diagnostics & developer helpers</strong><br><br><strong>Exposed helpers:</strong> <code>window.__tv_check_convert</code>, <code>window.__tv_patch_diag</code>, <code>window.__tv_trigger_topic_fallback</code> present to help debug Convert wiring, extra.js presence, and topic fallback application.  <br><br><strong>Use cases:</strong>  <br>1. Confirm convert delegation attached and whether <code>#convertBtn</code> exists.  <br>2. Confirm whether <code>extra.js</code> loaded or whether candidate anchors were found.  <br>3. Manually trigger minimal topic fallback if automatic attempts failed.  <br><br><strong>Recommendation:</strong> Keep these helpers in staging environments for debugging; they are safe and non-destructive.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table7" data-table="Book_8025_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>Single TOC container exists (no duplicate nav#toc)</strong><br><br><strong>Expected:</strong> Only one TOC container matching benchmark (#tocBar).  <br> <strong>Actual:</strong> nav#toc was removed; only <code>&lt;div id=&quot;tocBar&quot; ...&gt;</code> remains. ‚úÖ PASS                                                                                                                              </td></tr><tr><td data-label="Summary"> <strong>#tocBar contains an empty <ul> for script population</strong><br><br><strong>Expected:</strong> <code>&lt;div id=&quot;tocBar&quot;&gt;&lt;ul&gt;&lt;/ul&gt;&lt;/div&gt;</code> (no prefilled list items).  <br> <strong>Actual:</strong> Present exactly as <code>&lt;div id=&quot;tocBar&quot; role=&quot;navigation&quot; aria-label=&quot;Table of contents&quot;&gt;&lt;ul&gt;&lt;/ul&gt;&lt;/div&gt;</code>. ‚úÖ PASS                                                                      </td></tr><tr><td data-label="Summary"> <strong>CSS targets the TOC exactly like the benchmark (#tocBar)</strong><br><br><strong>Expected:</strong> Rules using <code>#tocBar ul</code> and <code>#tocBar a.toc-link</code> (or equivalent).  <br> <strong>Actual:</strong> Styles include <code>#tocBar ul { ... }</code> and <code>#tocBar a.toc-link, #tocBar a.pt-toc-link { ... }</code>. ‚úÖ PASS                                                                        </td></tr><tr><td data-label="Summary"> <strong>PTToc initialization points at #tocBar</strong><br><br><strong>Expected:</strong> <code>window.PTToc.init</code> invoked with <code>tocEl</code> or <code>&#x27;#tocBar&#x27;</code>.  <br> <strong>Actual:</strong> <code>tryInitToc()</code> uses <code>document.getElementById(&#x27;tocBar&#x27;)</code> and falls back to <code>window.PTToc.init(&#x27;#tocBar&#x27;, ...)</code>. ‚úÖ PASS                                                                                  </td></tr><tr><td data-label="Summary"> <strong>Legacy alias delegation for copyAllMdBtn ‚Üí visible copyAllTablesBtn present</strong><br><br><strong>Expected:</strong> Delegation code to forward <code>addEventListener</code>/<code>onclick</code>/<code>focus</code> from the legacy id to current id.  <br> <strong>Actual:</strong> Alias delegation script exists and maps <code>copyAllMdBtn</code> to <code>copyAllTablesBtn</code> (graceful if elements appear later). ‚úÖ PASS </td></tr><tr><td data-label="Summary"> <strong>assets/worker.js is included (benchmark requires worker script present)</strong><br><br><strong>Expected:</strong> <code>&lt;script src=&quot;assets/worker.js&quot; defer&gt;&lt;/script&gt;</code> included.  <br> <strong>Actual:</strong> Worker script is present and deferred. ‚úÖ PASS                                                                                                                       </td></tr><tr><td data-label="Summary"> <strong>Other core scripts/libraries present and deferred (XLSX + script.js)</strong><br><br><strong>Expected:</strong> <code>assets/xlsx.full.min.js</code> and <code>assets/script.js</code> included with defer.  <br> <strong>Actual:</strong> Both scripts present with defer. ‚úÖ PASS                                                                                                                     </td></tr><tr><td data-label="Summary"> <strong>routeHtmlToAreas logic intact and compatible with fragment vs full-page routing</strong><br><br><strong>Expected:</strong> Function available globally, decides between full-page HTML and tables fragment and sets <code>tables.innerHTML</code> appropriately.  <br> <strong>Actual:</strong> <code>window.PasteToTable.routeHtmlToAreas</code> is defined and matches the expected behavior. ‚úÖ PASS </td></tr><tr><td data-label="Summary"> <strong>Reveal & MutationObserver for .table-wrapper present</strong><br><br><strong>Expected:</strong> <code>revealWrappers()</code> to set <code>.table-wrapper</code> opacity to 1 and a MutationObserver watching <code>#tables-viewer</code>.  <br> <strong>Actual:</strong> <code>revealWrappers()</code> + MutationObserver are implemented and invoked on DOMContentLoaded / immediate path. ‚úÖ PASS                          </td></tr><tr><td data-label="Summary"> <strong>No leftover IDs/selectors conflicting with benchmark (#tocList, #tocBarList, nav#toc)</strong><br><br><strong>Expected:</strong> No <code>#tocList</code> or <code>#tocBarList</code> or <code>nav#toc</code> elements remain.  <br> <strong>Actual:</strong> None are present; only <code>#tocBar</code> and an inner <code>&lt;ul&gt;</code> exist. ‚úÖ PASS                                                                                  </td></tr><tr><td data-label="Summary"> <strong>‚Äî Conclusion</strong><br><br>The revised <code>index.html</code> matches the benchmark TOC structure and related behaviors required by Tables Viewer v2.1. Focused checks on DOM structure, CSS, scripts, and initialization logic ‚Äî all pass. ‚úÖ PASS                                                                                                             </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table8" data-table="Book_8025_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>1. Single TOC container present</strong><br><br>Only <code>#tocBar</code> exists; removed any <code>nav#toc</code>, <code>#tocList</code>, <code>#tocBarList</code>. ‚úÖ PASS                                                   </td></tr><tr><td data-label="Summary"> <strong>2. <code>#tocBar</code> contains an empty <code>&lt;ul&gt;</code></strong><br><br><code>&lt;div id=&quot;tocBar&quot;&gt;&lt;ul&gt;&lt;/ul&gt;&lt;/div&gt;</code> is exactly present for scripts to populate. ‚úÖ PASS                                       </td></tr><tr><td data-label="Summary"> <strong>3. CSS targets <code>#tocBar</code> selectors</strong><br><br>Styles use <code>#tocBar ul</code> and <code>#tocBar a.toc-link</code> (and pt-toc alias) matching benchmark styling contract. ‚úÖ PASS                </td></tr><tr><td data-label="Summary"> <strong>4. PTToc init points to <code>#tocBar</code></strong><br><br><code>tryInitToc()</code> queries <code>#tocBar</code> and falls back to <code>window.PTToc.init(&#x27;#tocBar&#x27;, ...)</code>. ‚úÖ PASS                                  </td></tr><tr><td data-label="Summary"> <strong>5. Alias delegation present and wired</strong><br><br>Alias delegation script maps <code>copyAllMdBtn</code> ‚Üí <code>copyAllTablesBtn</code> (handles addEventListener/onclick/focus). ‚úÖ PASS           </td></tr><tr><td data-label="Summary"> <strong>6. Alias elements present (visible + hidden)</strong><br><br>Visible <code>#copyAllTablesBtn</code> provided in <code>#tv-header</code>; hidden <code>#copyAllMdBtn</code> present for legacy code. ‚úÖ PASS         </td></tr><tr><td data-label="Summary"> <strong>7. Core scripts included and deferred</strong><br><br><code>assets/xlsx.full.min.js</code>, <code>assets/script.js</code>, and <code>assets/worker.js</code> are included with <code>defer</code>. ‚úÖ PASS                     </td></tr><tr><td data-label="Summary"> <strong>8. routeHtmlToAreas available & fragment handling</strong><br><br><code>window.PasteToTable.routeHtmlToAreas</code> is defined and preserves fragment vs full-page routing behavior. ‚úÖ PASS  </td></tr><tr><td data-label="Summary"> <strong>9. Reveal wrappers + MutationObserver implemented</strong><br><br><code>revealWrappers()</code> and a <code>MutationObserver</code> for <code>#tables-viewer</code> are present and invoked on load. ‚úÖ PASS        </td></tr><tr><td data-label="Summary"> <strong>10. No conflicting leftover IDs/selectors</strong><br><br>Confirmed absence of <code>#tocList</code>, <code>#tocBarList</code>, or <code>nav#toc</code>. File structure aligns with benchmark DOM contract. ‚úÖ PASS </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table9" data-table="Book_8025_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section / Component**&lt;br&gt;&lt;br&gt;Merged ‚Äî left column becomes header"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section / Component</strong><br><br>Merged ‚Äî left column becomes header</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section / ComponentMerged ‚Äî left column becomes header"> <strong>Table Wrapper Structure</strong><br><br>Each table is wrapped in <code>&lt;div class=&quot;table-wrapper&quot; data-table-id=&quot;table-X&quot;&gt;</code>.  <br><br><strong>Inside:</strong>  <br> - <code>&lt;div class=&quot;table-heading-bar&quot;&gt;</code> ‚Äî sticky header for the table.  <br> - <code>&lt;div class=&quot;table-container&quot;&gt;</code> ‚Äî contains table header controls and the <code>&lt;table&gt;</code>.  <br> - <code>&lt;div class=&quot;table-header-wrapper&quot;&gt;</code> ‚Äî flex container for copy/export buttons and toggle button.                                              </td></tr><tr><td data-label="Section / ComponentMerged ‚Äî left column becomes header"> <strong>Buttons</strong><br><br>Include <code>copy-plain-btn</code>, <code>copy-markdown-btn</code>, <code>export-csv-btn</code>, <code>export-json-btn</code>, <code>export-xlsx-btn</code>, <code>export-pdf-btn</code>, optional <code>export-markdown-btn</code>.  <br> Collapse/Expand button: <code>toggle-table-btn</code>.                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Section / ComponentMerged ‚Äî left column becomes header"> <strong>Table Element</strong><br><br><code>&lt;table class=&quot;tv-table&quot;&gt;</code> ‚Äî contains <code>&lt;thead&gt;</code> with sortable <code>&lt;th&gt;</code>s and <code>&lt;tbody&gt;</code> rows.                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Section / ComponentMerged ‚Äî left column becomes header"> <strong>Row Count</strong><br><br><code>&lt;div class=&quot;row-count&quot;&gt;</code> ‚Äî shows number of rows. Updates automatically after rendering or filtering.                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Section / ComponentMerged ‚Äî left column becomes header"> <strong>TOC Links Area</strong><br><br><code>&lt;div id=&quot;tocBar&quot;&gt;</code> ‚Äî contains <code>&lt;ul&gt;</code> of <code>&lt;li&gt;</code> items linking to table IDs, e.g., <code>&lt;a href=&quot;#Table1&quot;&gt;Table 1&lt;/a&gt;</code>.  <br> Each <code>&lt;div class=&quot;table-caption&quot; id=&quot;Table1&quot;&gt;</code> acts as anchor target.                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Section / ComponentMerged ‚Äî left column becomes header"> <strong>Behavior Requirements</strong><br><br> - Buttons must have event handlers attached dynamically if missing.  <br> - TOC links must scroll smoothly to the corresponding table wrapper.  <br> - Toggle buttons must update text dynamically (<code>Collapse Table</code> / <code>Expand Table</code>).  <br> - Copy/export buttons trigger their respective <code>copyTablePlain</code>, <code>copyTableMarkdown</code>, <code>exportTableCSV</code>, etc.  <br> - Row count updates automatically after rendering or filtering. </td></tr><tr><td data-label="Section / ComponentMerged ‚Äî left column becomes header"> <strong>Dynamic Initialization</strong><br><br>After HTML injection, <code>initRenderedContent()</code> runs to:  <br> 1. Attach per-cell original HTML snapshots.  <br> 2. Update header sort UI.  <br> 3. Initialize toggle buttons and toolbar buttons.  <br> 4. Optimize table controls.  <br> 5. Hide or show export options like Markdown.  <br> 6. Scroll first table into view.                                                                                                    </td></tr><tr><td data-label="Section / ComponentMerged ‚Äî left column becomes header"> <strong>Integration with SAMPLE_OUTPUT</strong><br><br> - Every table must replicate the exact DOM and ARIA attributes.  <br> - TOC links must match table-caption IDs.  <br> - Buttons must match event delegation logic from <code>script.js</code>.  <br> ‚úÖ Fully compatible with SAMPLE_OUTPUT benchmark.                                                                                                                                                                              </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table10" data-table="Book_8025_10" style="margin-top:2mm;margin-left:3mm;"><strong>Table 10</strong></div>
<div class="table-wrapper" data-table-id="table-10"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>Only intended change applied</strong><br><br><strong>Expected:</strong> <code>#copyAllTablesBtn</code> hidden by <code>style=&quot;display:none;&quot;</code>. <br> <strong>Actual:</strong> <code>#copyAllTablesBtn</code> includes <code>style=&quot;display:none;&quot;</code>. ‚úÖ PASS                                          </td></tr><tr><td data-label="Summary"> <strong>No other visible UI/button text changed</strong><br><br><strong>Expected:</strong> All header buttons and labels unchanged. <br> <strong>Actual:</strong> Header buttons (Export All, Clear, Convert, Render, Save HTML) are identical to previous file. ‚úÖ PASS    </td></tr><tr><td data-label="Summary"> <strong>Legacy alias button still present and hidden (#copyAllMdBtn)</strong><br><br><strong>Expected:</strong> <code>#copyAllMdBtn</code> remains with <code>display:none</code>. <br> <strong>Actual:</strong> <code>#copyAllMdBtn</code> present and hidden. ‚úÖ PASS                                      </td></tr><tr><td data-label="Summary"> <strong>Alias delegation script unchanged and still correct</strong><br><br><strong>Expected:</strong> Delegation script still maps alias to visible element. <br> <strong>Actual:</strong> Delegation script present and unchanged. ‚úÖ PASS                                </td></tr><tr><td data-label="Summary"> <strong>TOC structure remains benchmark-matching (#tocBar with <code>&lt;ul&gt;</code>)</strong><br><br><strong>Expected:</strong> <code>&lt;div id=&quot;tocBar&quot;&gt;&lt;ul&gt;&lt;/ul&gt;&lt;/div&gt;</code> unchanged. <br> <strong>Actual:</strong> Present exactly. ‚úÖ PASS                                                      </td></tr><tr><td data-label="Summary"> <strong>Core scripts still included and deferred</strong><br><br><strong>Expected:</strong> <code>assets/xlsx.full.min.js</code>, <code>assets/script.js</code>, <code>assets/worker.js</code> all <code>defer</code>. <br> <strong>Actual:</strong> All three script tags present with <code>defer</code>. ‚úÖ PASS                </td></tr><tr><td data-label="Summary"> <strong>routeHtmlToAreas function intact</strong><br><br><strong>Expected:</strong> <code>window.PasteToTable.routeHtmlToAreas</code> remains defined and unchanged. <br> <strong>Actual:</strong> Function present and unchanged. ‚úÖ PASS                                             </td></tr><tr><td data-label="Summary"> <strong>revealWrappers + MutationObserver present and unchanged</strong><br><br><strong>Expected:</strong> <code>revealWrappers()</code> and observer remain in initializer. <br> <strong>Actual:</strong> Present and unchanged. ‚úÖ PASS                                              </td></tr><tr><td data-label="Summary"> <strong>No leftover duplicate TOC IDs or nav elements present</strong><br><br><strong>Expected:</strong> No <code>nav#toc</code>, no <code>#tocList</code>, no <code>#tocBarList</code>. <br> <strong>Actual:</strong> None present. ‚úÖ PASS                                                                 </td></tr><tr><td data-label="Summary"> <strong>File validated for accidental syntax or tag truncation</strong><br><br><strong>Expected:</strong> HTML well-formed with matching tags (head/body) and scripts at end. <br> <strong>Actual:</strong> Document structure intact, tags closed, scripts at end. ‚úÖ PASS </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table11" data-table="Book_8025_11" style="margin-top:2mm;margin-left:3mm;"><strong>Table 11</strong></div>
<div class="table-wrapper" data-table-id="table-11"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Summary**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Summary</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Summary"> <strong>Tables Viewer Area</strong><br><br><code>#tables-viewer</code> exists with hidden <code>#copyAllTablesBtn</code> and legacy alias <code>#copyAllMdBtn</code>.<br>Placeholder <code>#tables-placeholder</code> exists for dynamically injected tables.<br>TOC bar <code>#tocBar</code> contains an empty <code>&lt;ul&gt;</code>; <code>script.js</code> must populate it based on injected tables. </td></tr><tr><td data-label="Summary"> <strong>Copy/Export Buttons</strong><br><br>All per-table buttons must work: <code>copyTablePlain</code>, <code>copyTableMarkdown</code>, <code>exportTableCSV</code>, <code>exportTableJSON</code>, <code>exportTableXLSX</code>, <code>exportTablePDF</code>.                                                                                                                           </td></tr><tr><td data-label="Summary"> <strong>Toggle Table</strong><br><br>Collapsible per-table <code>toggle-table-btn</code> updates text and class dynamically.                                                                                                                                                                                                       </td></tr><tr><td data-label="Summary"> <strong>Row Count</strong><br><br><code>.row-count</code> updates automatically after rendering, filtering, or table changes.                                                                                                                                                                                                      </td></tr><tr><td data-label="Summary"> <strong>TOC Links</strong><br><br>Populate from <code>table-caption</code> IDs and scroll smoothly to corresponding <code>.table-wrapper</code>.                                                                                                                                                                                              </td></tr><tr><td data-label="Summary"> <strong>Wrapper Reveal</strong><br><br><code>.table-wrapper</code> must transition from opacity <code>0 ‚Üí 1</code> when rendered.                                                                                                                                                                                                             </td></tr><tr><td data-label="Summary"> <strong>MutationObserver</strong><br><br>Observe dynamic table injections and automatically reveal <code>.table-wrapper</code>s.                                                                                                                                                                                                   </td></tr><tr><td data-label="Summary"> <strong>Alias Delegation</strong><br><br>Legacy <code>copyAllMdBtn</code> forwards events to <code>copyAllTablesBtn</code> (addEventListener/onclick/focus).                                                                                                                                                                                  </td></tr><tr><td data-label="Summary"> <strong>Integration with PasteToTable</strong><br><br>‚Ä¢ Respect <code>window.PasteToTable.routeHtmlToAreas</code> logic.<br>‚Ä¢ Run safely even if DOM not fully loaded.<br>‚Ä¢ Work with MutationObserver for dynamic table injection.<br>‚Ä¢ Initialize TOC via <code>window.PTToc.init</code> if available.                                      </td></tr><tr><td data-label="Summary"> <strong>Benchmark Compliance</strong><br><br>‚úÖ Matches SAMPLE_OUTPUT behavior for table layout, TOC, accessibility, interactivity, and dynamic updates.                                                                                                                                                                 </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>