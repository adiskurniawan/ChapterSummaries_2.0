<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759919527">
<link rel="stylesheet" href="assets/overrides.css?v=1759919570">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header"><div><h1>Tables Viewer v2.1</h1></div><div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" type="search" placeholder="Search" aria-label="Search tables" style="min-width:420px; width:44ch;"/>
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllMdBtn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)</button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset all tables">Reset All Tables</button>
</div></div>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_9011_01" style="margin-top:2mm;margin-left:3mm;"><strong>Chapter 1 — Scenario A Projections</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **File**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>File</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File"><strong>html_renderer.py</strong> </td><td data-label="Notes"><strong>Purpose</strong><br>Compatibility shim that exposes render_html/render_table/render_page to main.py.<br>Attempts multiple import strategies (render.core_compat, render.core_renderer).<br>Exposes optional helpers and asset utilities when available.<br><br><strong>Key exports & types</strong><br>render_html(list[pd.DataFrame], out_path: str, markdown_to_html: Callable) -> None (may be None)<br>render_table, render_page (optional)<br>prepare_assets, write_overrides_css, convert helpers (optional)<br>get_import_diagnostics() -> dict<br><br><strong>Control / data flow</strong><br>On import: try core_compat, then core_renderer. Record attempts in _try_msgs.<br>main.py imports this module and reads render_html truthiness to decide full render vs fallback.<br>If present, render_html receives parsed tables and markdown_to_html callback from helpers/main.<br><br><strong>Failure modes & behavior</strong><br>render_html is None -> main.py writes minimal fallback HTML.<br>Import errors are non-fatal but logged to stderr; RENDER_DEBUG env var toggles verbose traces.<br>Ambiguity when different versions of render package exist on sys.path.<br><br><strong>High-leverage improvements</strong><br>Add explicit type hints for render_html signature and document expected callback contract.<br>Return a small adapter that validates input (list of DataFrames) before calling real renderer.<br>Make diagnostics machine-readable (JSON) for CI checks.<br><br><strong>Tests / verification</strong><br>Unit: simulate missing render package; assert get_import_diagnostics contains attempts and render_html is None.<br>Integration: with a mock render.core_compat providing a no-op render_html, assert main.py uses it.<br>Edge: conflicting sys.path entries; test precedence.<br><br><strong>Notes</strong><br>Central integration point. Any change to render_html contract requires coordinated updates to main.py and helpers.<br>Keep import side-effects minimal to avoid surprising behavior on module import.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="File"><strong>utils.py</strong>         </td><td data-label="Notes"><strong>Purpose</strong><br>Low-level text and table utilities used across parsing layers.<br>Small pure helpers: whitespace normalization, safe row splitting, separator detection, list extraction, slugging, chunking, comment stripping.<br><br><strong>Key functions & contracts</strong><br>split_table_row(line: Optional[str]) -> List[str] (handles '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="File"><strong>helpers.py</strong>       </td><td data-label="Notes"><strong>Purpose</strong><br>Mid-level parsing and minimal markdown-to-HTML conversions.<br>Handles code stashing (fenced + inline), robust table detection, and conservative markdown formatting.<br><br><strong>Key functions & contracts</strong><br>_stash_fenced_code(text) -> (text_with_placeholders, fenced_map)<br>_stash_inline_code(text) -> (text_with_placeholders, inline_map)<br>_split_row_keep_code(line) -> List[str] (split on unescaped pipes while preserving inline code)<br>_is_divider_line(s) -> bool (detects separator rows)<br>parse_markdown_tables(content) -> List[pd.DataFrame]<br>Normalizes zero-width chars, constructs DataFrame from rows, drops empty columns/rows<br>markdown_to_html(text) -> str (protects code, handles bold/italic via *, inserts <br> before markers)<br><br><strong>Control / data flow</strong><br>parse_markdown_tables:<br>- Normalize text.<br>- Iterate lines, detect table header + divider pattern.<br>- Collect body rows using _split_row_keep_code.<br>- Normalize column counts, build pandas.DataFrame, drop empty cols/rows, append to output list.<br>markdown_to_html stashes code, applies emphasis rules, inserts <br> markers, restores escaped code as HTML-escaped blocks/spans.<br>Returned DataFrames are passed to render_html by main.py.<br><br><strong>Failure modes & edge cases</strong><br>Duplicate logic with utils.split_table_row risks drift and inconsistent behavior.<br>Pandas DataFrame creation may mis-handle mixed column counts or rows with delimiter-rich content.<br>Code stashing must preserve placeholder uniqueness in pathological inputs.<br><br><strong>High-leverage improvements</strong><br>Factor common splitting/escaping logic with utils to a single canonical implementation.<br>Make placeholder tokens cryptographically unlikely (use uuids) to avoid accidental collisions.<br>Use explicit column name normalization strategy (e.g., replace empty header cells with generated names).<br>Add a small validation step that checks DataFrame column types and flags suspicious rows.<br><br><strong>Tests / verification</strong><br>Unit tests for fenced code with language identifiers and nested backticks.<br>Tables with escaped pipes inside fenced blocks (should be ignored).<br>Markdown->HTML transformations: bold, italic, escaped underscores, list markers.<br>Integration tests using representative md files from the project.<br><br><strong>Performance/security notes</strong><br>Avoid executing any content from fenced code. Always HTML-escape.<br>For very large files, parse incrementally to limit memory use. </td></tr><tr><td data-label="File"><strong>main.py</strong>          </td><td data-label="Notes"><strong>Purpose</strong><br>Top-level pipeline orchestration: discover markdown files, group by prefix, parse tables, render output, clean fragments.<br><br><strong>High-level control flow (stepwise)</strong><br>1. Load html_renderer (compat shim). Set render_html variable.<br>2. Discover md files via glob on md_folder.<br>3. Compute book_prefixes (first 9 chars) and build selection_map (numeric-first ordering).<br>4. For each selected_prefix:<br> a. Collect files matching prefix and read content.<br> b. Call parse_markdown_tables(content) from helpers. If none: fallback parse.<br> c. Aggregate parsed tables -> all_tables (list[pd.DataFrame]).<br>5. If render_html available: call render_html(all_tables, output_html, markdown_to_html). Else: write minimal fallback HTML.<br>6. Cleanup: remove .frags_* and .fragments in target dirs.<br><br><strong>Data contracts</strong><br>all_tables: list of pandas.DataFrame with normalized columns and string contents.<br>markdown_to_html passed as callback; renderer expected to call it for cell conversion.<br><br><strong>Failure modes & edge cases</strong><br>Missing renderer -> fallback path exercised.<br>Inconsistent table structures create ragged DataFrames.<br>Pandas warnings/deprecations (applymap) addressed.<br>Files with very large content may cause memory pressure.<br><br><strong>High-leverage improvements</strong><br>Use pathlib.Path.rglob instead of glob for file discovery.<br>Add CLI (argparse) for folder/output selection, verbosity, dry-run.<br>Add logging instead of print; configurable log levels.<br>Validate render_html signature at load time.<br>Consider parallel parsing with ThreadPoolExecutor.<br>Add size limits/sampling for large tables.<br><br><strong>Tests / verification</strong><br>Unit tests for selection_map generation.<br>Integration tests: small md corpus -> expected HTML (golden files).<br>Failure scenarios: missing html_renderer, malformed tables.<br><br><strong>Operational notes</strong><br>Keep writes atomic (tmp → rename).<br>Persist import diagnostics to output for CI debugging.<br>Cleanup conservative — whitelist deletions only.                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr></tbody></table></div><div class="row-count">Rows: 4</div></div><div class="table-caption" id="Table2" data-table="Book_9011_02" style="margin-top:2mm;margin-left:3mm;"><strong>Chapter 2 — Scenario B Projections</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic / Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic / Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Re-exports stable API names from internal modules. Imports <code>render_html</code> from <code>.core_renderer</code> and <code>render_table</code> from <code>.core_table</code>. Defines <code>render_page = render_html</code>. Sets <code>__all__ = [&quot;render_html&quot;,&quot;render_table&quot;,&quot;render_page&quot;]</code>.</strong> </td><td data-label="Conceptual Notes">Acts as an import-time compatibility shim so external callers use stable public names regardless of internal refactoring. Guarantees <code>render_html</code> and <code>render_table</code> are present at import time.                                                                                                                                      </td></tr><tr><td data-label="Logic / Structure"><strong>Import error handling: explicit <code>try/except ImportError</code> blocks that raise <code>ImportError</code> with a clear message if expected symbols are missing.</strong>                                                                                            </td><td data-label="Conceptual Notes">Fail-fast behavior. If internals are absent the package import fails early with a descriptive error. This surfaces configuration/setup problems immediately but makes the package brittle to partial installs or optional backends.                                                                                                    </td></tr><tr><td data-label="Logic / Structure"><strong>Minimal surface area: no runtime logic, no lazy loading, no diagnostics, no type hints.</strong>                                                                                                                                                   </td><td data-label="Conceptual Notes">Lightweight and easy to audit. But lacks runtime validation of function signatures and no machine-readable diagnostics. Assumes caller knows expected <code>render_html</code> signature and behavior.                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"><strong>Data/control flow: consumed by <code>html_renderer.py</code> and <code>main.py</code> as the canonical source of <code>render_html</code>/<code>render_table</code> symbols.</strong>                                                                                                          </td><td data-label="Conceptual Notes">Changes here directly impact callers. Any contract change requires coordinated updates to <code>main.py</code>, <code>html_renderer.py</code>, and tests.                                                                                                                                                                                                    </td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & edge cases</strong>                                                                                                                                                                                                                </td><td data-label="Conceptual Notes">- Import-time exceptions block application startup.<br>- Conflicting module versions on <code>sys.path</code> are not diagnosed here.<br>- No fallback behavior if only partial functionality is available.                                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong>                                                                                                                                                                                                                </td><td data-label="Conceptual Notes">- Consider lazy imports or feature-detection to allow partial operation (non-fatal fallback).<br>- Add a small diagnostic helper (e.g., <code>get_compat_diagnostics()</code>) that returns which symbols loaded and any errors.<br>- Add type hints and a short docstring describing the expected <code>render_html</code> signature and callback contract. </td></tr><tr><td data-label="Logic / Structure"><strong>Tests / verification</strong>                                                                                                                                                                                                                      </td><td data-label="Conceptual Notes">- Unit: simulate missing <code>core_renderer</code> or <code>core_table</code> and assert ImportError message.<br>- Integration: install a mock <code>core_renderer.render_html</code> and assert <code>render_page</code> alias and <code>__all__</code> correctness.                                                                                                                        </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><div class="table-caption" id="Table3" data-table="Book_9011_03" style="margin-top:2mm;margin-left:3mm;"><strong>Chapter 3 — Scenario C Projections</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Logic / Structure"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Logic / Structure</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>: Orchestrates converting parsed table-like inputs into final HTML output. Handles asset preparation, fragment rendering (concurrent), inline fallback rendering, and atomic write of output file.                                                                                   </td><td data-label="Conceptual Notes">Central pipeline entry. Coordinates core_assets, core_fragments, core_table, core_io, core_utils, and sanitize. Contract: <code>render_html(all_tables, out_path, markdown_to_html, ...) -&gt; dict</code>.                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Logic / Structure"><strong>Input normalization</strong>: Accepts heterogeneous <code>all_tables</code> items (DataFrame-like, list-of-rows, dicts, raw markdown/html strings). Detects types with duck-typing and converts string inputs by extracting pipe-markdown or HTML tables.                                                       </td><td data-label="Conceptual Notes">Robust preprocessor. Uses <code>_extract_pipe_tables_from_markdown</code>, <code>markdown_to_html</code> callback, <code>sanitize_html</code>, and HTML table extractors (bs4 if available, regex fallback). Converts rows -> DataFrame-like via <code>_convert_rows_to_df_like</code>.                                                                                                                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"><strong>Fragment pipeline</strong>: Writes fragments into a temp fragment dir using <code>render_fragments_concurrently(parsed_tables, cfg, renderer, tmp_frag_dir, max_workers)</code>. Collects <code>fragments_map</code>, per-frag row counts, total rows, warnings.                                                           </td><td data-label="Conceptual Notes">Heavy-lifting performed by <code>core_fragments</code>. core_renderer only orchestrates and inspects outputs (e.g., <code>_frag_contains_rows</code>) to decide fallback vs full assembly.                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"><strong>Fallback inline rendering</strong>: If no fragments or fragments contain no rows, falls back to <code>render_table</code> per parsed table and includes inline HTML parts and inline sources. Sanitizes pieces with <code>sanitize_html(allow_tables=True)</code>.                                                         </td><td data-label="Conceptual Notes">Ensures graceful output even when fragment pipeline fails. Inline path uses <code>render_table</code> and best-effort title extraction from <code>&lt;h1..h6&gt;</code> or h3 wrapping.                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"><strong>Asset handling</strong>: Calls <code>prepare_assets(cfg, out_dir)</code> to get assets_dir and fallbacks. Supports two modes: embed assets inline or link to assets directory (with cache-busting <code>?v=</code> timestamps). Writes/uses <code>overrides.css</code>, script/worker/xlsx inclusion, and SRI checks via <code>_sri_attr</code>. </td><td data-label="Conceptual Notes">Flexible asset strategy: <code>embed_assets</code> inlines CSS/JS; otherwise references files. Attempts to provide shim if script missing. Records <code>assets_written</code>.                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"><strong>TOC & UI scaffolding</strong>: Builds head_parts and tail_parts arrays for DOCTYPE, header UI, search box, control buttons, noscript, table of contents from fragments or inline parts. Injects client JS (export worker shim, export button handler).                                               </td><td data-label="Conceptual Notes">Produces accessible UI scaffolding and client behavior. Template logic is string-assembly heavy; all HTML assembled server-side then written atomically.                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Logic / Structure"><strong>Output write</strong>: Uses <code>_default_write_atomic</code> (from core_io) if present, else temp file + <code>os.replace</code>, else direct write. Returns result dict with warnings, counts, runtime, and optionally HTML.                                                                                            </td><td data-label="Conceptual Notes">Atomic write strategy reduces partial-write risk. Returns structured status for callers.                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & edge cases</strong>                                                                                                                                                                                                                                                                  </td><td data-label="Conceptual Notes">- Missing/invalid assets cause fallback to fallback CSS/script texts.<br>- bs4 absent -> regex HTML parsing may mis-handle complex tables.<br>- Mixed column counts lead <code>_convert_rows_to_df_like</code> to return dicts or raw rows, which downstream render_table must handle.<br>- Concurrent fragment rendering failures captured to warnings and trigger inline fallback.<br>- Sanitizer not present -> fallback to <code>html.escape</code>, may over-escape legitimate markup. </td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong>                                                                                                                                                                                                                                                                  </td><td data-label="Conceptual Notes">- Validate <code>render_table</code> and fragment outputs shapes early (schema check).<br>- Centralize HTML assembly using a minimal templating function to reduce brittle string concatenation.<br>- Prefer <code>pathlib</code> exclusively and use <code>json.dumps</code> safely for inlined JS data.<br>- Detect and warn if bs4 unavailable and include test coverage for regex extractor parity.<br>- Expose a "dry-run" mode to validate assets and fragment creation without heavy IO.        </td></tr><tr><td data-label="Logic / Structure"><strong>Tests / verification</strong>                                                                                                                                                                                                                                                                        </td><td data-label="Conceptual Notes">- Unit: extraction functions (<code>_extract_pipe_tables_from_markdown</code>, <code>_extract_tables_from_html*</code>, <code>_convert_rows_to_df_like</code>).<br>- Integration: full <code>render_html</code> with mocked <code>render_fragments_concurrently</code> producing fragments and with it failing to assert fallback path.<br>- Edge: very large inline HTML (>2MB) to ensure export rejection path triggers.                                                                                                   </td></tr><tr><td data-label="Logic / Structure"><strong>Performance / operational notes</strong>                                                                                                                                                                                                                                                             </td><td data-label="Conceptual Notes">- Parallel fragment rendering offloads CPU/IO but requires careful max_workers tuning.<br>- In-memory assembly of large HTML may be heavy; consider streaming writer for very large tables.<br>- Cache-busting uses timestamps; consider deterministic versioning for CI reproducibility.                                                                                                                                                                             </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table4" data-table="Book_9011_04" style="margin-top:2mm;margin-left:3mm;"><strong>Chapter 4 — Scenario D Projections</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>                    </td><td data-label="Conceptual Notes">File IO helpers and an atomic streaming write primitive used by render package.                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Logic / Structure"><strong>Core functions</strong>             </td><td data-label="Conceptual Notes"><code>read_file(path)</code> — read UTF-8 file, raises IOError on failure. <code>write_file(path, content)</code> — non-atomic write with parent-dir creation. <code>ensure_dir(path)</code> — create dir or raise if path exists but is not a dir. <code>_atomic_stream_write(path, write_fn)</code> — atomic replace using same-dir tmp, fsync best-effort, os.replace to swap. </td></tr><tr><td data-label="Logic / Structure"><strong>Atomic semantics</strong>           </td><td data-label="Conceptual Notes">Creates tmp via <code>tempfile.mkstemp(dir=target.parent)</code>, writes text, flush+fsync best-effort, then <code>os.replace(tmp, target)</code> for atomicity on same device. Cleans tmp on failure and raises <code>IOError</code>.                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"><strong>Error handling</strong>             </td><td data-label="Conceptual Notes">All functions wrap low-level exceptions and raise <code>IOError</code> with context (read/write/ensure). <code>_atomic_stream_write</code> removes tmp on error.                                                                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"><strong>Guarantees & limits</strong>        </td><td data-label="Conceptual Notes">Guarantees either old or complete new file; relies on same-device tmp creation. fsync is best-effort (may silently fail). Caller-provided <code>write_fn</code> gets text-mode file.                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"><strong>Interop with core_io</strong>       </td><td data-label="Conceptual Notes">Exposes <code>_atomic_stream_write</code> name consumed by <code>core_io.py</code> fallback resolution. <code>io_utils</code> does not export <code>_atomic_write</code>/<code>atomic_write</code> here, so <code>core_io</code> may fall back to its default <code>_default_write_atomic</code>.                                                                                                                  </td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong> </td><td data-label="Conceptual Notes">Add an <code>_atomic_write</code> wrapper that accepts bytes/text for parity with core_io expectations. Expose <code>atomic_write</code> alias to increase compatibility. Add unit tests for cross-device failure and permission errors.                                                                                                                    </td></tr></tbody></table></div><div class="row-count">Rows: 7</div></div><div class="table-caption" id="Table5" data-table="Book_9011_05" style="margin-top:2mm;margin-left:3mm;"><strong>Chapter 5 — Scenario E Projections</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>Purpose</strong>                     </td><td data-label="Conceptual Notes">Parsing and conversion utilities: robust markdown pipe-table parser, list/bullet conversion, left-column heading heuristics, and a consolidated <code>render_table</code> implementation used when project <code>convert</code> is preferred.                                       </td></tr><tr><td data-label="Logic / Structure"><strong>Parsing tables</strong>              </td><td data-label="Conceptual Notes"><code>parse_markdown_tables(text)</code> extracts pipe-style tables. Handles <code>|</code> escapes, inline backticks, leading/trailing pipes, divider detection (<code>:---:</code> / <code>---</code>), and pads uneven rows. Returns list of <code>{&quot;rows&quot;:..., &quot;header&quot;:True, &quot;source&quot;:&quot;pipe_markdown&quot;}</code>. </td></tr><tr><td data-label="Logic / Structure"><strong>Markdown renderer selection</strong> </td><td data-label="Conceptual Notes"><code>_get_default_markdown_renderer()</code> prefers package <code>markdown.get_markdown_renderer</code>; else supplies a small fallback that supports <code>*</code> emphasis and inline code.                                                                                               </td></tr><tr><td data-label="Logic / Structure"><strong>Table renderer</strong>              </td><td data-label="Conceptual Notes"><code>render_table(df, idx, markdown_to_html_func, left_width, right_width)</code> builds accessible HTML fragment. Accepts DataFrame-like, list-of-dicts, list-of-lists, or <code>_SimpleDF</code>. Produces header, controls, table body, and handles sampling of rows.           </td></tr><tr><td data-label="Logic / Structure"><strong>Helpers & features</strong>          </td><td data-label="Conceptual Notes"><code>_apply_left_col_heading</code> (bold-first-segment), <code>_unescape_brackets_outside_code</code>, bullet/list conversion (<code>convert_bullets_to_ul</code>, <code>_normalize_list_markers</code>), numeric type detection (<code>_detect_column_types</code>), small <code>_SimpleDF</code> shim for non-pandas usage. </td></tr><tr><td data-label="Logic / Structure"><strong>Fallbacks & resiliency</strong>      </td><td data-label="Conceptual Notes">Attempts to import utils helpers; if absent it provides conservative fallbacks for tag stripping, markdown lists, and escaping. Heavy use of try/except to avoid hard failures.                                                                               </td></tr><tr><td data-label="Logic / Structure"><strong>Failure modes & edge cases</strong>  </td><td data-label="Conceptual Notes">- Non-uniform row lengths handled by padding but downstream expectations vary.<br>- HTML-in-markdown complexity may alter first-segment detection.<br>- Fallback markdown renderer is minimal; richer markdown features depend on project <code>markdown</code> module.  </td></tr><tr><td data-label="Logic / Structure"><strong>High-leverage improvements</strong>  </td><td data-label="Conceptual Notes">Add unit tests for <code>parse_markdown_tables</code> edge cases (nested backticks, escaped pipes, BOMs). Extract and test <code>_apply_left_col_heading</code> separately. Document expected shapes for <code>df</code> inputs.                                                               </td></tr><tr><td data-label="Logic / Structure"><strong>Public API</strong>                  </td><td data-label="Conceptual Notes"><code>parse_markdown_tables</code>, <code>render_table</code>, <code>extract_tables_debug</code>, <code>_SimpleDF</code>, <code>_SimpleColumns</code>.                                                                                                                                                               </td></tr></tbody></table></div><div class="row-count">Rows: 9</div></div><div class="table-caption" id="Table6" data-table="Book_9011_06" style="margin-top:2mm;margin-left:3mm;"><strong>Chapter 6 — Scenario F Projections</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Area**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Area</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Improvements Made**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Improvements Made</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Area"><strong>Imports & Fallbacks</strong>        </td><td data-label="Improvements Made">Cleaned fallback functions so they gracefully degrade (no crashes if <code>utils</code> missing). Each now has clear error handling and logging.                                                                                                </td></tr><tr><td data-label="Area"><strong>Regex Handling</strong>             </td><td data-label="Improvements Made">Grouped regex constants; corrected overly-permissive patterns; added consistency (e.g., <code>_DIVIDER_PART_RE</code> stricter, bullet patterns unified).                                                                                       </td></tr><tr><td data-label="Area"><strong>Left-Column Headings</strong>       </td><td data-label="Improvements Made">Fixed <code>_apply_left_col_heading</code> to bold <strong>only the first logical segment</strong>, avoiding runaway replacements. Handles <code>&lt;p&gt;</code>, <code>&lt;div&gt;</code>, <code>&lt;ul&gt;</code>, etc. correctly.                                                                           </td></tr><tr><td data-label="Area"><strong>Bullet/List Conversion</strong>     </td><td data-label="Improvements Made">Simplified <code>convert_bullets_to_ul</code> flow: avoids double <code>&lt;ul&gt;</code> wrapping, ignores decorative <code>---</code>, splits inline multiple items more safely, prevents list bleed into normal text.                                                    </td></tr><tr><td data-label="Area"><strong>Markdown Table Parsing</strong>     </td><td data-label="Improvements Made"><code>parse_markdown_tables</code> rewritten to: <br>– handle escaped pipes <code>|</code> and backtick-delimited inline code <br>– normalize uneven row lengths <br>– stricter divider line recognition <br>– preserve whitespace and Unicode correctly. </td></tr><tr><td data-label="Area"><strong>DataFrame Fallback</strong>         </td><td data-label="Improvements Made"><code>_SimpleDF</code> and <code>_SimpleColumns</code> improved to behave closer to Pandas DataFrame (iterable, length, repr). This keeps downstream compatibility without requiring Pandas.                                                               </td></tr><tr><td data-label="Area"><strong>Debug Extraction</strong>           </td><td data-label="Improvements Made"><code>extract_tables_debug</code> now: <br>– normalizes typography (quotes, dashes, ellipsis) <br>– detects divider lines more reliably <br>– pads uneven rows <br>– attempts Pandas, falls back cleanly.                                       </td></tr><tr><td data-label="Area"><strong>Error Resilience</strong>           </td><td data-label="Improvements Made">Every helper wrapped in try/except with safe fallbacks; logging used instead of silent failures. Prevents one bad row from breaking whole parsing.                                                                                   </td></tr><tr><td data-label="Area"><strong>Markdown Renderer Fallback</strong> </td><td data-label="Improvements Made"><code>_get_default_markdown_renderer</code> provides a lightweight inline emphasis + inline-code converter if <code>markdown.py</code> isn’t available. Short-circuits when no Markdown features detected → faster performance.                            </td></tr><tr><td data-label="Area"><strong>Performance</strong>                </td><td data-label="Improvements Made">Small optimizations: <br>– skip regex runs if markers not present <br>– stream rows safely in <code>_take_and_stream</code> <br>– reduce unnecessary string copies.                                                                             </td></tr><tr><td data-label="Area"><strong>Clarity & Documentation</strong>    </td><td data-label="Improvements Made">Each helper now has clear docstring or inline explanation. Logic is grouped into sections: regex, helpers, bullets, tables, debug, renderer.                                                                                         </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table7" data-table="Book_9011_07" style="margin-top:2mm;margin-left:3mm;"><strong>Chapter 7 — Scenario G Projections</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Logic / Structure**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Logic / Structure</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Conceptual notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Conceptual notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Logic / Structure"><strong>File overview</strong>                             </td><td data-label="Conceptual notes">- Primary orchestrator that discovers <code>.md</code> files, groups them by prefix, converts tables to HTML, and writes output.  <br>- Attempts dynamic renderer import and provides a fallback HTML writer.  <br>- Runs work at module import (no <code>if __name__ == &quot;__main__&quot;:</code> guard).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Logic / Structure"><strong>Imports & dynamic import</strong>                  </td><td data-label="Conceptual notes">- Uses <code>importlib.util</code> to load <code>html_renderer.py</code> from project path then falls back to <code>import html_renderer</code>.  <br>- Risks: import errors, silent failures, path assumptions.  <br>- Suggestion: explicit fallback logging, fail-safe behavior, and deterministic import order.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Logic / Structure"><strong>Entrypoint & execution flow</strong>               </td><td data-label="Conceptual notes">- Module-level code enumerates files and performs conversion immediately.  <br>- Problem: side effects on import make testing and reuse hard.  <br>- Suggestion: wrap main loop in <code>if __name__ == &quot;__main__&quot;:</code> and expose a <code>main()</code> function.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Logic / Structure"><strong>Configuration & paths</strong>                     </td><td data-label="Conceptual notes">- <code>md_folder</code> and <code>output_folder</code> are hardcoded to Windows paths.  <br>- Problem: non-portable and fragile across environments.  <br>- Suggestion: accept CLI args or env-vars, fallback to cwd, validate paths early.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Logic / Structure"><strong>File discovery</strong>                            </td><td data-label="Conceptual notes">- Uses <code>glob.glob(&quot;*.md&quot;)</code> in a hardcoded folder.  <br>- Issues: ordering nondeterministic, misses nested content, fragile with hidden files.  <br>- Suggestion: use <code>pathlib.Path.rglob</code>, deterministic sorting, and filename validation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Logic / Structure"><strong>Grouping logic</strong>                            </td><td data-label="Conceptual notes">- Derives <code>book_prefixes</code> from first 9 filename chars and maps numeric suffixes to groups.  <br>- Issues: filenames shorter than 9 chars, inconsistent naming, fragile numeric parsing.  <br>- Suggestion: use a regex to capture <code>&lt;prefix&gt;&lt;sep&gt;&lt;number&gt;</code> and fail fast on unmatched names.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Logic / Structure"><strong>Markdown → HTML (<code>markdown_to_html</code>) — conceptual</strong> </td><td data-label="Conceptual notes">- Intended features: headings (<code>#</code>), bold (<code>**</code>), italic (<code>*</code>), inline code (`<code> </code>code<code> </code><code>), blockquotes (</code>><code>), links (</code>[text](url)<code>), ordered/unordered lists, paragraph wrapping.  &lt;br&gt;- Current issue: invalid/garbled regex (e.g., patterns that raise </code>re.error`).  <br>- Suggestion: implement an ordered substitution pipeline (headings → block elements → lists → inline formatting) with conservative regex and unit tests.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"><strong>Rendering / fallback HTML</strong>                 </td><td data-label="Conceptual notes">- If <code>render_html</code> exists use it; otherwise fallback writes <code>df.to_html(index=False, border=0, escape=False)</code>.  <br>- <code>escape=False</code> allows raw HTML and creates XSS risk.  <br>- Suggestion: default to <code>escape=True</code> and explicitly allow safe HTML only after sanitization.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"><strong>Typography & styling (output)</strong>             </td><td data-label="Conceptual notes">- Goal: improved typography and grey inline-code styling like ChatGPT.  <br>- Quick CSS to include later: <code>code { background:#f5f5f5; padding:2px 4px; border-radius:3px; font-family:monospace; } pre { background:#f5f5f5; padding:8px; border-radius:4px; overflow:auto; }</code>.  <br>- Suggestion: wrap inline tokens in <code>&lt;code&gt;</code> during conversion and include stylesheet in final HTML.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Logic / Structure"><strong>Fragments & cleanup</strong>                       </td><td data-label="Conceptual notes">- <code>_cleanup_fragments_safe</code> removes <code>.frags_*</code> and <code>.fragments</code> directories under targets.  <br>- Risk: currently runs on <code>output_folder</code> and <code>os.getcwd()</code> and may delete unexpected data.  <br>- Suggestion: restrict cleanup to known output subpath, require confirmation flag, and add safe guards.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Logic / Structure"><strong>Error handling & logging</strong>                  </td><td data-label="Conceptual notes">- Error handling currently minimal; exceptions may stop the whole batch.  <br>- Suggestion: add structured logging, wrap per-file processing in try/except, and continue processing other files on non-fatal errors.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Logic / Structure"><strong>Security concerns</strong>                         </td><td data-label="Conceptual notes">- Dynamic import from file path.  <br>- <code>escape=False</code> in <code>to_html</code> allows HTML injection.  <br>- Cleanup can delete directories outside intended scope.  <br>- Suggestion: sanitize HTML outputs, validate renderer source, and implement strict cleanup path checks.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Logic / Structure"><strong>Testing & validation</strong>                      </td><td data-label="Conceptual notes">- Required unit tests: <code>parse_markdown_tables</code> (multiple table shapes), <code>markdown_to_html</code> (each markdown feature + combinations), and end-to-end small sample <code>.md</code> → HTML.  <br>- Suggestion: include sample fixtures and acceptance tests that assert no <code>re.error</code> and produce expected HTML snippets.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"><strong>Upgrade plan (per Prompt_01, conceptual steps)</strong> </td><td data-label="Conceptual notes">1. Add <code>if __name__ == &quot;__main__&quot;: main()</code> and expose <code>main()</code>; acceptance: no work runs on import.  <br>2. Parameterize paths via CLI/env; acceptance: configurable via args and sensible defaults.  <br>3. Harden dynamic import with logging and deterministic fallback; acceptance: clear error messages and consistent renderer selection.  <br>4. Replace <code>parse_markdown_tables</code> with robust pre-clean and tests; acceptance: handles header rows and escaped pipes.  <br>5. Rewrite <code>markdown_to_html</code> with ordered safe regex and tests; acceptance: no regex runtime errors and passes markdown feature tests.  <br>6. Change fallback <code>to_html</code> to <code>escape=True</code> and add optional sanitizer; acceptance: no raw HTML unless explicitly allowed. </td></tr><tr><td data-label="Logic / Structure"><strong>Acceptance criteria for main.py</strong>           </td><td data-label="Conceptual notes">- No side effects on import.  <br>- <code>markdown_to_html</code> runs without <code>re.error</code> and supports listed markdown features.  <br>- File discovery is deterministic and configurable.  <br>- Output HTML is escaped or explicitly sanitized.  <br>- Cleanup only affects intended output paths.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Logic / Structure"><strong>Next files to request</strong>                     </td><td data-label="Conceptual notes">- <code>html_renderer.py</code> (priority).  <br>- <code>convert.py</code> or parser helpers.  <br>- <code>core_fragments.py</code> and <code>core_io.py</code> (cleanup and I/O semantics).  <br>- Any file that <code>main.py</code> dynamically loads.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Logic / Structure"><strong>Project log update (running copy)</strong>         </td><td data-label="Conceptual notes">- Will record: Step 1 planned (conceptual rewrite of <code>markdown_to_html</code>), known bugs from this breakdown, and requested next files.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr></tbody></table></div><div class="row-count">Rows: 17</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>