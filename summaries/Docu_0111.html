<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1769960840">
<link rel="stylesheet" href="assets/overrides.css?v=1771304626">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li>
<li class="toc-item"><a class="toc-link" href="#Table10">Table 10</a></li>
<li class="toc-item"><a class="toc-link" href="#Table11">Table 11</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0111_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî Full Technical Overview"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî Full Technical Overview</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üéØ <strong>Purpose & Scope</strong><br>PasteToTable (PTT) is a hybrid Python + JavaScript application designed to convert pasted text or loaded data groups into fully formatted 2-column tables with ChatGPT-style aesthetics. It is tightly integrated with Tables Viewer 2.1 (TV2.1) for visual parity. The system supports manual paste, Load Group workflows, caption injection, multi-table handling, markdown export, local saving, and optional client-side extras. It is resilient to DOM timing issues, missing data, partial conversion failures, and concurrent events. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> ‚öôÔ∏è <strong>Configuration & Globals</strong><br>- Backend <code>server.py</code> handles requests via <code>/convert</code> and <code>/group</code> endpoints.<br>- Frontend <code>script.core.js</code> initializes <code>window.PTT</code> with configuration defaults, including highlight, debounce, and chunkSize.<br>- Debug flags controlled via <code>TV_DEBUG</code> on frontend; backend logs optional for load/convert actions.<br>- Coordination flags such as <code>window.__tv_skip_scroll</code> prevent scroll conflicts during DOM updates. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üõ† <strong>Backend Utilities</strong><br>- <code>io_utils.py</code>: Atomic read/write, tmp dir handling, file path validation, checksum computation.<br>- <code>core_io.py</code>: Safe atomic writes, temp file handling, path validation for <code>/saved_tables</code>.<br>- <code>core_utils.py</code>: Misc helpers including string normalization, HTML sanitization, streaming helpers, SRI attribute computation.<br>- <code>sanitize.py</code>: Strips disallowed HTML, enforces safe tags (<code>table</code>, <code>tr</code>, <code>td</code>, <code>th</code>, <code>caption</code>), escapes data attributes, and prevents XSS injection from user content. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üíª <strong>Conversion Modules</strong><br>- <code>convert.py</code>: Primary parser converting raw pasted text or group content into structured <code>CaptionBlocks</code> with row/column metadata. Handles multi-line cells, <code>&lt;br&gt;</code> tags, code blocks, inline markdown, and maintains original whitespace for chat fidelity.<br>- <code>markdown.py</code>: Converts table structures into Markdown-compatible lines with optional per-cell formatting. Supports code blocks, inline emphasis, links, and escaped characters. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üèó <strong>Core Table & Renderer</strong><br>- <code>core_table.py</code>: Wraps table generation, ensures table IDs using SHA256 hash of normalized HTML content, computes row counts, enforces consistent <code>data-id</code> and <code>data-caption</code> attributes.<br>- <code>core_renderer.py</code>: Injects captions only if <code>request_ctx.action==&quot;load_group&quot;</code>. Generates full HTML output including <code>&lt;script data-caption-payload&gt;</code> only if metadata indicates injected captions. Handles partial tables gracefully and preserves multi-table layouts. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üß© <strong>Caption Handling & Fragments</strong><br>- <code>core_fragments.py</code>: Creates <code>CaptionFragment</code> objects with stable IDs. Links each caption to table ID, row/column coordinates, and optional labels.<br>- <code>meta.injected=true</code> marks backend-rendered captions as ready for frontend hydration.<br>- Captions stored in <code>labels.json</code> optionally, allowing consistent labeling across sessions. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üîó <strong>Data Flow ‚Äî Manual Paste / Load Group</strong><br>1. User triggers Convert or Load Group.<br>2. Frontend captures event, creates <code>request_ctx</code> with action, source, client_req_id.<br>3. Payload sent to <code>server.py</code> endpoint.<br>4. Backend reads input via <code>io_utils.read_group()</code> or direct POST.<br>5. <code>convert.parse_*()</code> generates <code>CaptionBlocks</code>.<br>6. Metadata annotated (<code>meta.source</code>, <code>meta.sanitized</code>).<br>7. <code>core_fragments.CaptionFragment.create()</code> attaches stable fragment IDs.<br>8. <code>core_table.ensure_table_id()</code> computes deterministic table ID and row counts.<br>9. <code>core_renderer.inject_captions()</code> injects captions only if <code>request_ctx.action==&quot;load_group&quot;</code>.<br>10. <code>html_renderer.render_html()</code> produces final HTML, embedding <code>&lt;script data-caption-payload&gt;</code> if captions are injected.<br>11. Client JS (<code>window.PTT.injectCaptions()</code>) hydrates captions into DOM, updates metadata, triggers toast notifications. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üîç <strong>Frontend Architecture</strong><br>- <strong>script.core.js</strong>: Central controller for conversion, paste handling, toast notifications, table injection, scroll coordination, DOM hydration, and optional extra scripts.<br>- <strong>script.table.js</strong>: Table-level utilities, per-table Markdown export, copy, save, render coordination.<br>- <strong>script.list.js</strong>: Load Group UI, queries backend with <code>{action:&quot;load_group&quot;, group_id}</code>, receives sanitized HTML + metadata, hydrates captions.<br>- <strong>script.save.js</strong>: Handles save operations with atomic write fallback, local download fallback, and toast notifications. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üñ• <strong>DOM Handling & Injection</strong><br>- Tables wrapped in <code>&lt;div class=&quot;table-wrap&quot;&gt;</code> with consistent classing for CSS styling.<br>- <code>&lt;caption&gt;</code> elements injected for each table, linked via <code>data-caption-id</code>.<br>- Backend-generated <code>&lt;script data-caption-payload&gt;</code> ensures captions hydrated after DOM mutation.<br>- Scroll coordination with <code>window.__tv_skip_scroll</code> ensures smooth view insertion without jank. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üìù <strong>Toast & Notification System</strong><br>- Queue-based system: <code>_toastQueue</code>, <code>_activeToast</code> manage sequential messages.<br>- <code>_computeToastDuration(msg,type,optDuration)</code>: duration auto-calculated by message length/type.<br>- <code>showToast(msg,{type,duration})</code>: primary toast function.<br>- <code>showToastOnce(key,msg,opts,cooldownMs)</code>: prevents duplicate messages.<br>- Toasts color-coded by type: success, warning, error.<br>- Queue processor ensures multiple simultaneous messages handled sequentially with fade-in/out transitions. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üñ± <strong>Button Handlers & Event Delegation</strong><br>- Convert button triggers <code>window.__tv_do_convert(opts)</code> with concurrency guard.<br>- Clear button empties paste input, table viewer, page area, and status display.<br>- Save button triggers atomic save via server; fallback to local download.<br>- Export buttons copy per-table or all-table Markdown via clipboard helpers.<br>- All handlers attached once, idempotent, using <code>dataset.attached</code> flags. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> ‚ö° <strong>Debounce & Concurrency</strong><br>- Frontend prevents overlapping conversion/paste events with debounce wrapper.<br>- Backend serializes group load requests to prevent table ID collisions.<br>- Retry mechanisms in frontend: DOM injection retries at 60ms, 420ms, 600ms if elements not ready.<br>- Multiple conversions queued safely without losing metadata. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üîí <strong>Security & Sanitization</strong><br>- Backend enforces HTML tag whitelist: <code>table</code>, <code>tr</code>, <code>td</code>, <code>th</code>, <code>caption</code>.<br>- Inline scripts removed from user content.<br>- Data attributes escaped, ensuring XSS resilience.<br>- Table IDs and caption IDs stable, collision-resistant.<br>- Client side additionally sanitizes content before DOM insertion. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üñå <strong>CSS & Layout</strong><br>- Base <code>style.css</code> locked to match Tables Viewer 2.1 exactly.<br>- <code>overrides.css</code> allows minor tweaks: spacing, caption alignment, flex layout for multi-table scrollable view.<br>- TOC, buttons, table wraps positioned flexibly, responsive to viewport width.<br>- Prevents horizontal overflow, ensures proper caption display even on small screens. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üíæ <strong>Save & Export Workflow</strong><br>- Backend writes sanitized HTML to <code>/saved_tables/</code> using atomic write.<br>- Filenames sanitized with timestamp + caption info.<br>- Local download fallback if backend save fails.<br>- Markdown per-table or all-table export supported.<br>- Clipboard operations supported with fallback to legacy copy for older browsers. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> ‚öôÔ∏è <strong>Group Load & Manual Testing</strong><br>- <code>groups.json</code> maintains saved group metadata.<br>- <code>script.list.js</code> requests group content with <code>{action:&quot;load_group&quot;, group_id}</code>.<br>- Backend sanitizes, generates captions, computes table IDs.<br>- Frontend hydrates tables, injects captions, triggers toast notifications. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üß™ <strong>Testing & Debug Support</strong><br>- CLI (<code>cli.py</code>) allows batch offline testing.<br>- Debug flags in frontend (<code>TV_DEBUG</code>) and optional backend logs.<br>- Safe fallbacks: local download if save fails, alert toast if conversion error.<br>- Partial table rendering does not break subsequent conversions. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üîÑ <strong>Retry & Resilience Mechanisms</strong><br>- Frontend retries DOM injection multiple times for robust behavior.<br>- Optional extra.js loaded sequentially with retry.<br>- Scroll flags prevent conflicts with table-level scrolling.<br>- Captions, TOC, and multi-table rendering resilient to missing DOM elements.<br>- Multiple concurrent conversions queued safely. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üß© <strong>Caption Injection Mechanics</strong><br>- Backend (<code>core_renderer.py</code>) injects captions only for <code>request_ctx.action==&quot;load_group&quot;</code>.<br>- Each <code>CaptionFragment</code> contains <code>table_id</code>, <code>row_index</code>, <code>col_index</code>, <code>label</code>, and optional extra metadata.<br>- Captions attached to table metadata: <code>table_meta.captions = [fragment_id1, fragment_id2‚Ä¶]</code>.<br>- <code>meta.injected=true</code> ensures <code>html_renderer.render_html()</code> emits <code>&lt;script data-caption-payload&gt;</code> block for frontend hydration.<br>- Payload includes JSON of all fragments, table IDs, row/col coordinates, label texts, and sanitized HTML content. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üåê <strong>Client Caption Hydration</strong><br>- <code>window.PTT.injectCaptions()</code> reads <code>&lt;script data-caption-payload&gt;</code>.<br>- Each fragment mapped to corresponding <code>&lt;table&gt;</code> using <code>data-id</code>.<br>- Injects <code>&lt;caption&gt;</code> element if missing, updates text content.<br>- Ensures correct order and alignment with original row/column indices.<br>- Handles multi-table pages, skipping already-injected captions to prevent duplicates.<br>- Triggers optional callback events for downstream features like TOC or save operations. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üìä <strong>Multi-Table Coordination</strong><br>- Tables wrapped in <code>.table-wrap</code> divs, enabling independent scroll and styling.<br>- Table metadata tracked in <code>window.PTT.tablesMeta</code> with keys: <code>table_id</code>, <code>row_count</code>, <code>caption_ids</code>, <code>source_group</code>.<br>- Clipboard & Markdown export functions iterate over <code>tablesMeta</code> to extract consistent cell content including <code>&lt;br&gt;</code> and inline formatting.<br>- All table-level buttons reference specific <code>data-table-id</code> attributes to ensure actions target correct table. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üîß <strong>Frontend Utilities</strong><br>- <code>copyToClipboard(text)</code>: modern Clipboard API with legacy fallback.<br>- <code>downloadBlob(blob, filename)</code>: creates downloadable file with sanitized name.<br>- <code>sanitizeFileName(name)</code>: converts to safe cross-platform filename.<br>- <code>debounce(fn, wait)</code>: prevents rapid repeated executions.<br>- <code>normalizeForSearchLocal(s)</code>: normalizes Unicode, lowercases, strips accents, retains alphanumerics and spaces. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üñ± <strong>Table Button Handlers</strong><br>- Per-table actions: Copy Markdown, Save HTML, Export All.<br>- Button handler reads <code>data-table-id</code>, fetches table HTML, converts to Markdown lines with inline <code>&lt;br&gt;</code> preserved.<br>- Toast notification after action: success/warning/error, color-coded, auto-dismissed.<br>- Prevents multiple simultaneous operations per table. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üóÇ <strong>Group Handling</strong><br>- <code>script.list.js</code> sends <code>{action:&quot;load_group&quot;, group_id}</code> payload to <code>server.py</code>.<br>- Backend reads group files using <code>io_utils.read_group()</code>, computes checksums for consistency.<br>- Converts files into <code>CaptionBlocks</code>, sanitizes HTML, attaches stable fragment IDs.<br>- Table IDs computed deterministically; multi-table groups maintain consistent mapping for captions.<br>- Frontend hydrates all tables and captions, triggers toasts for each table loaded. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> ‚ö° <strong>Concurrency & Queue Management</strong><br>- Conversion requests queued: prevents race conditions, avoids overwriting table metadata.<br>- Frontend queue drains sequentially using <code>requestAnimationFrame</code> or setTimeout fallback.<br>- Captions injection queued if DOM not yet ready.<br>- Multi-table copy/export serialized to ensure consistent content. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üîí <strong>Security & Sanitization (Extended)</strong><br>- Data attributes escaped to prevent injection attacks.<br>- <code>&lt;script&gt;</code> tags from user content removed.<br>- Only whitelisted tags (<code>table</code>, <code>tr</code>, <code>td</code>, <code>th</code>, <code>caption</code>) allowed.<br>- Table IDs and caption IDs deterministic, collision-resistant.<br>- Frontend additionally checks <code>meta.sanitized</code> before injecting content. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üìú <strong>TOC / PTToc Integration</strong><br>- Table of Contents initialized via <code>window.__tv_init_pttoc_from_core(opts)</code>.<br>- MutationObserver watches <code>#tables-viewer</code> for new tables.<br>- Captions metadata used to build TOC entries per table.<br>- Safe retry if DOM not ready: waits up to configurable timeout.<br>- Integrates with multi-table view: ensures TOC scroll links correspond to correct <code>table_id</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üñå <strong>CSS & Layout (Extended)</strong><br>- Flexbox used for horizontal/vertical alignment of table wraps.<br>- Captions styled consistently with TV2.1: padding, font-size, color, alignment.<br>- Scrollable container ensures multiple tables do not overflow viewport.<br>- Overrides applied via <code>overrides.css</code>, locked <code>style.css</code> ensures benchmark parity.<br>- Caption injection respects CSS styling even on delayed hydration. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üíæ <strong>Save & Export (Extended)</strong><br>- <code>script.save.js</code> supports per-table HTML save, all-tables save, and Markdown export.<br>- Backend atomic write ensures consistent file output; temp file swapped to final path.<br>- Local download fallback uses <code>downloadBlob</code> with filename sanitization.<br>- Markdown export preserves multi-line cells with <code>&lt;br&gt;</code>, inline formatting, and table alignment.<br>- Clipboard copy ensures correct row/column order. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üîÑ <strong>Retry & Resilience (Extended)</strong><br>- DOM injection retries at 0ms, 60ms, 250ms, 600ms.<br>- Multiple conversion requests queued to prevent metadata overwrite.<br>- Optional extra.js loaded sequentially, retries if network or script errors.<br>- Captions and TOC hydration resilient to partial failures.<br>- Scroll coordination flags prevent jumpiness or conflict with automatic scroll-to-top. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üß™ <strong>Testing & Debugging (Extended)</strong><br>- CLI (<code>cli.py</code>) allows batch conversion and offline preview.<br>- Debug flags expose table metadata, caption payloads, and fragment IDs.<br>- Frontend <code>TV_DEBUG</code> allows inspection of PTT tablesMeta, fragment IDs, hydration status.<br>- Error handling in <code>showToast</code> ensures user notified even if DOM fails or conversion partially fails.<br>- Failures logged, do not break subsequent operations. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üìå <strong>Edge Cases</strong><br>- Missing <code>#paste</code> textarea gracefully handled with toast warning.<br>- Non-JSON response fallback with alert or toast.<br>- Rapid consecutive conversions serialized.<br>- Missing PTToc or TOC elements do not block table rendering.<br>- Clipboard API fallback for older browsers.<br>- Toast queue handles overlapping calls: max 8s, min 900ms duration.<br>- Scroll coordination prevents conflicts with table-level scroll or multi-table pages. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üìù <strong>Metadata Management</strong><br>- <code>tablesMeta</code> per table: table_id, row_count, caption_ids, source_group, injected_flag.<br>- Fragment metadata: fragment_id, table_id, row_index, col_index, label, sanitized HTML.<br>- Captions and table metadata consistent across reloads for persistent group operations.<br>- Backend ensures stable IDs via SHA256 of normalized HTML. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üß¨ <strong>Data Integrity & Checksums</strong><br>- <code>io_utils.read_group()</code> computes file checksums for consistency validation.<br>- Table ID derived deterministically from normalized HTML ensures repeatable caption mapping.<br>- Prevents duplicate table IDs, preserves caption alignment after reload. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üìä <strong>Performance Considerations</strong><br>- Debounce wrapper prevents flooding backend or DOM with rapid user input.<br>- Chunking and sequential hydration prevent main-thread blocking.<br>- Minimal DOM queries by caching table wrappers and metadata references.<br>- Multi-table operations batched for Markdown export or clipboard copy. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview"> üìù <strong>Summary</strong><br>PasteToTable is a sophisticated Python + JavaScript system integrating backend conversion, sanitization, caption injection, frontend hydration, DOM management, multi-table coordination, TOC integration, robust toast notifications, clipboard and export utilities, save mechanisms, and fail-safe retries. It ensures <strong>consistent table IDs, stable captions, responsive multi-table layouts, safe DOM injection, cross-browser clipboard support, and full integration with Tables Viewer 2.1</strong>. The system is resilient to missing elements, partial failures, rapid user actions, and multi-table concurrency. Its architecture separates responsibilities cleanly: backend parsing/conversion, metadata and caption generation, frontend hydration, DOM injection, button handling, toast notifications, and CSS layout enforcement, providing a maintainable, extensible, and production-ready solution for ChatGPT-style table preservation and export. </td></tr></tbody></table></div><div class="row-count">Rows: 36</div></div><div class="table-caption" id="Table2" data-table="Docu_0111_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî Module Interaction &amp; Data Flow"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî Module Interaction & Data Flow</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>User Action ‚Üí Client Payload</strong><br>- User clicks ‚ÄúLoad Group‚Äù or ‚ÄúConvert‚Äù.<br>- Client sends JSON payload: <code>{action, group_id, client_req_id}</code> to <code>server.py</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>server.py ‚Äî Request Context & Routing</strong><br>- Builds <code>request_ctx</code> object: <code>{action, source, client_req_id}</code>.<br>- Routes action to proper handler: <code>load_group</code> or <code>convert_text</code>.<br>- Sets flags: <code>request_ctx.action=&quot;load_group&quot;</code>, <code>request_ctx.source=&quot;group_load&quot;</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>io_utils.read_group()</strong><br>- Reads files from <code>saved_tables/group_id/</code>.<br>- Computes SHA256 checksums per file for consistency.<br>- Returns raw HTML/text for conversion. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>convert.parse_*()</strong><br>- Parses group files into <code>CaptionBlocks</code> and intermediate table structures.<br>- Assigns logical row/column indices, labels.<br>- Attaches <code>meta.source=&quot;group_load&quot;</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>sanitize.sanitize_caption_html()</strong><br>- Cleans all HTML content.<br>- Removes disallowed tags, unsafe attributes, <code>&lt;script&gt;</code>s.<br>- Sets <code>meta.sanitized = true</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>core_fragments.CaptionFragment.create()</strong><br>- Converts parsed blocks into fragments with <strong>stable IDs</strong>.<br>- Each fragment: <code>{fragment_id, table_id, row_index, col_index, label, sanitized_html}</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>core_table.ensure_table_id()</strong><br>- Assigns deterministic table IDs using normalized HTML + SHA256.<br>- Calculates <code>row_count</code>.<br>- Ensures no collisions; preserves mapping across reloads. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>core_renderer.inject_captions()</strong><br>- Gate: only if <code>request_ctx.action==&quot;load_group&quot;</code>.<br>- Attaches fragment IDs to <code>table_meta.captions</code>.<br>- Sets <code>meta.injected=true</code>.<br>- Payload prepared for frontend injection. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>html_renderer.render_html()</strong><br>- If <code>meta.injected==true</code>:<br>  ‚Ä¢ Emits <code>&lt;script data-caption-payload&gt;</code> block.<br>  ‚Ä¢ JSON payload includes all fragment IDs, table IDs, row/col, label text, sanitized HTML.<br>- Else: omits payload to prevent unnecessary DOM pollution. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Client-side: script.core.js</strong><br>- On payload detection: <code>window.PTT.injectCaptions()</code>.<br>- Reads <code>&lt;script data-caption-payload&gt;</code>.<br>- Matches fragments to <code>&lt;table data-id&gt;</code>.<br>- Injects <code>&lt;caption&gt;</code> elements where missing.<br>- Updates <code>window.PTT.tablesMeta</code> with metadata per table: <code>{table_id, row_count, caption_ids, source_group}</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Client-side Button Handlers</strong><br>- Copy Markdown, Save HTML, Export All, per-table.<br>- Uses <code>data-table-id</code> to reference <code>tablesMeta</code>.<br>- Preserves <code>&lt;br&gt;</code> and inline formatting.<br>- Uses debounced queue to avoid simultaneous overwrites.<br>- Shows toast notifications per operation. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Multi-Table Coordination</strong><br>- All tables wrapped in <code>.table-wrap</code>.<br>- Ensures independent scrolling and layout.<br>- TOC (<code>window.__tv_init_pttoc_from_core</code>) maps captions to correct table IDs.<br>- DOM observers track late-added tables for proper caption injection. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Concurrency & Queue Management</strong><br>- Conversion queue serialized to avoid race conditions.<br>- Hydration queue ensures DOM ready before caption injection.<br>- Multi-table clipboard or export handled sequentially. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Security & Sanitization</strong><br>- All injected HTML sanitized at backend and frontend.<br>- Deterministic IDs prevent injection collisions.<br>- Payload JSON safely encoded. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Save & Export Workflow</strong><br>- Backend atomic writes via <code>core_io</code>.<br>- Local download fallback via <code>downloadBlob()</code>.<br>- Markdown export preserves multi-line cells and table alignment. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Retry & Resilience</strong><br>- DOM injection retries: 0ms, 60ms, 250ms, 600ms.<br>- Captions and TOC hydration resilient to partial failures.<br>- Scroll coordination prevents conflicts with automatic scroll. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Metadata Tracking</strong><br>- <code>tablesMeta</code>: table_id, row_count, caption_ids, source_group, injected_flag.<br>- Fragment metadata: fragment_id, table_id, row_index, col_index, label, sanitized HTML.<br>- Persistent across reloads, ensures consistent caption mapping. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Debug & Testing Hooks</strong><br>- CLI (<code>cli.py</code>) supports batch conversion and offline preview.<br>- TV_DEBUG exposes tablesMeta, fragment IDs, hydration status.<br>- Toast notifications show successes/warnings/errors even if partial failures occur. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>End-to-End Flow Summary</strong><br>1. User clicks ‚Üí Client sends JSON payload.<br>2. <code>server.py</code> builds request context.<br>3. <code>io_utils</code> reads group, computes checksums.<br>4. <code>convert</code> parses files into caption blocks.<br>5. <code>sanitize</code> cleans HTML.<br>6. <code>core_fragments</code> creates fragments with stable IDs.<br>7. <code>core_table</code> ensures deterministic table IDs.<br>8. <code>core_renderer</code> injects captions, sets meta.injected=true.<br>9. <code>html_renderer</code> emits <code>&lt;script data-caption-payload&gt;</code>.<br>10. <code>script.core.js</code> hydrates tables & captions.<br>11. Button actions, TOC, clipboard, save, export operate using hydrated metadata.<br>12. Retry, concurrency, and edge-case handling ensure robust user experience. </td></tr></tbody></table></div><div class="row-count">Rows: 19</div></div><div class="table-caption" id="Table3" data-table="Docu_0111_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî End-to-End Architecture & Data Flow (Detailed)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£ User Interaction & Client Request</strong><br>- User clicks one of: <code>Load Group</code>, <code>Convert</code>, <code>Copy Markdown</code>, <code>Save HTML</code>.<br>- Client forms JSON payload: <code>{action: &quot;load_group&quot; | &quot;convert_text&quot;, group_id?, client_req_id}</code>.<br>- Sends to <code>/api/group</code> or <code>/api/convert</code> endpoint via fetch/XHR.<br>- Payload includes optional metadata for tracking (timestamp, client_req_id). </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>2Ô∏è‚É£ server.py ‚Äî Request Context & Routing</strong><br>- Constructs <code>request_ctx</code> with: <code>{action, source, client_req_id, timestamp}</code>.<br>- Sets <code>source=&quot;group_load&quot;</code> for group loading, <code>source=&quot;convert_text&quot;</code> for conversion.<br>- Calls proper handler function (<code>load_group_handler</code> or <code>convert_text_handler</code>).<br>- Ensures defensive validation: checks <code>group_id</code> existence, file access, payload integrity. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>3Ô∏è‚É£ io_utils.read_group() ‚Äî File Access Layer</strong><br>- Reads all files under <code>saved_tables/{group_id}/</code>.<br>- Computes SHA256 checksums per file for change detection.<br>- Returns raw HTML/text as string array for parsing.<br>- Supports atomic reading via <code>core_io.atomic_read</code> to avoid partial file reads. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>4Ô∏è‚É£ convert.parse_*() ‚Äî Conversion Layer</strong><br>- Parses raw HTML/text into <code>CaptionBlocks</code>.<br>- Detects rows, columns, headers, and cell content.<br>- Attaches logical row/column indices.<br>- Produces intermediate structure for fragments: <code>{table_id, row_index, col_index, cell_text}</code>.<br>- Assigns metadata: <code>meta.source = &quot;group_load&quot;</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>5Ô∏è‚É£ sanitize.sanitize_caption_html() ‚Äî Safety Layer</strong><br>- Cleans all user-generated content.<br>- Removes disallowed tags (<code>&lt;script&gt;</code>, <code>&lt;iframe&gt;</code>) and unsafe attributes (<code>on*</code>, <code>style</code> if risky).<br>- Produces sanitized HTML per cell.<br>- Sets <code>meta.sanitized = true</code> to signal safety downstream.<br>- Ensures deterministic formatting for multi-line cells. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>6Ô∏è‚É£ core_fragments.CaptionFragment.create() ‚Äî Fragment Creation</strong><br>- Converts parsed CaptionBlocks into stable <strong>fragments</strong>.<br>- Each fragment: <code>{fragment_id, table_id, row_index, col_index, label, sanitized_html}</code>.<br>- Ensures <strong>stable, deterministic IDs</strong> across reloads for client-side matching.<br>- Stores fragment metadata in memory for injection. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>7Ô∏è‚É£ core_table.ensure_table_id() ‚Äî Table Identity Layer</strong><br>- Computes deterministic table IDs:<br>  ‚Ä¢ Normalized table HTML ‚Üí SHA256.<br>  ‚Ä¢ Ensures no collisions, consistent mapping across reloads.<br>- Calculates <code>row_count</code> for table.<br>- Attaches table metadata: <code>{table_id, row_count, source_group}</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>8Ô∏è‚É£ core_renderer.inject_captions() ‚Äî Injection Gate</strong><br>- Runs only if <code>request_ctx.action === &quot;load_group&quot;</code>.<br>- Associates fragments with <code>table_meta.captions</code>.<br>- Marks <code>meta.injected = true</code>.<br>- Prepares JSON payload for frontend:<br>  ``<code>json {table_id, row_count, caption_ids: [...], labels: [...], sanitized_html: [...]}</code>`` </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>9Ô∏è‚É£ html_renderer.render_html() ‚Äî HTML Emission</strong><br>- Converts server-side table and fragment data into full HTML response.<br>- If <code>meta.injected==true</code>:<br>  ‚Ä¢ Adds <code>&lt;script data-caption-payload type=&quot;application/json&quot;&gt;...&lt;/script&gt;</code><br>  ‚Ä¢ JSON payload contains all fragment IDs, table IDs, labels, row/col indices, sanitized HTML.<br>- Else: omits script block.<br>- Ensures safe encoding (JSON.stringify + escape sequences) to prevent XSS. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>üîü Client-side Hydration ‚Äî script.core.js</strong><br>- On page load or payload detection: <code>window.PTT.injectCaptions()</code>.<br>- Reads <code>&lt;script data-caption-payload&gt;</code>.<br>- Matches fragments to <code>&lt;table data-id&gt;</code>.<br>- Inserts <code>&lt;caption&gt;</code> elements if missing.<br>- Updates <code>window.PTT.tablesMeta</code>:<br>  <code>{table_id, row_count, caption_ids, source_group, injected_flag}</code>.<br>- Observes DOM mutations for late-added tables. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£1Ô∏è‚É£ Button Handlers & Clipboard</strong><br>- Copy Markdown per table: reads <code>tablesMeta</code> ‚Üí converts to Markdown lines.<br>- Save HTML/export: reads innerHTML + fragments ‚Üí sends to backend or triggers local download.<br>- Preserves <code>&lt;br&gt;</code> and inline formatting.<br>- Uses debounced queue to avoid overwrites.<br>- Shows toast notifications for success/warnings/errors. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£2Ô∏è‚É£ Multi-Table & TOC Coordination</strong><br>- Wraps tables in <code>.table-wrap</code> for independent scroll/layout.<br>- TOC (<code>window.__tv_init_pttoc_from_core</code>) maps captions to table IDs.<br>- DOM observers attach to dynamically added tables to inject missing captions.<br>- Scroll coordination ensures smooth user experience. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Concurrency & Queue Management</strong><br>- Conversion requests serialized per client to avoid race conditions.<br>- Hydration queue ensures DOM ready before caption injection.<br>- Clipboard/export operations queued sequentially. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Security & Sanitization</strong><br>- Backend sanitization: <code>sanitize_caption_html</code>.<br>- Frontend sanitation: fragment content safe-encoded.<br>- Deterministic fragment/table IDs prevent injection collisions.<br>- All JSON payload safely encoded and injected via <code>&lt;script&gt;</code> tag. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£5Ô∏è‚É£ Save & Export Workflow</strong><br>- Backend: atomic writes via <code>core_io</code>.<br>- Frontend: <code>downloadBlob</code> fallback.<br>- Markdown export preserves multi-line cells, tables with captions.<br>- Table metadata ensures exported content matches rendered content. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£6Ô∏è‚É£ Retry & Resilience</strong><br>- DOM injection retries at 0ms, 60ms, 250ms, 600ms intervals.<br>- Hydration resilient to missing tables, delayed DOM, or partial payload failures.<br>- Scroll and toast notifications coordinated to prevent user confusion. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£7Ô∏è‚É£ Metadata Tracking</strong><br>- <code>tablesMeta</code>: <code>{table_id, row_count, caption_ids, source_group, injected_flag}</code>.<br>- <code>fragmentsMeta</code>: <code>{fragment_id, table_id, row_index, col_index, label, sanitized_html}</code>.<br>- Persistent across reloads to ensure consistent caption injection. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£8Ô∏è‚É£ Debug & Testing Hooks</strong><br>- CLI: supports batch conversion, offline preview.<br>- TV_DEBUG exposes tablesMeta, fragment IDs, hydration status.<br>- Toast notifications report success/warnings/errors.<br>- Useful for QA and developer inspection of fragment injection correctness. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£9Ô∏è‚É£ Full End-to-End Flow Summary</strong><br>1. User clicks ‚Üí Client sends JSON payload.<br>2. <code>server.py</code> builds request context.<br>3. <code>io_utils.read_group()</code> reads files, computes checksums.<br>4. <code>convert.parse_*()</code> converts raw content to CaptionBlocks.<br>5. <code>sanitize.sanitize_caption_html()</code> cleans HTML.<br>6. <code>core_fragments.CaptionFragment.create()</code> creates fragments with stable IDs.<br>7. <code>core_table.ensure_table_id()</code> assigns table IDs.<br>8. <code>core_renderer.inject_captions()</code> injects caption metadata.<br>9. <code>html_renderer.render_html()</code> emits tables + <code>&lt;script data-caption-payload&gt;</code>.<br>10. <code>script.core.js</code> hydrates tables and injects captions.<br>11. Button actions (copy, save, export), TOC integration, scroll coordination, and multi-table handling operate using hydrated metadata.<br>12. Retry logic ensures robust DOM hydration and user feedback. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>2Ô∏è‚É£0Ô∏è‚É£ Observations & Edge Cases</strong><br>- Handles missing <code>#paste</code> or empty text gracefully.<br>- Non-JSON server responses handled safely.<br>- Multiple rapid conversions serialized.<br>- Missing TOC or table fragments do not break rendering.<br>- Clipboard API fallback ensures older browser compatibility.<br>- Toast queue handles overlapping messages (min 900ms, max 8s). </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>2Ô∏è‚É£1Ô∏è‚É£ Conclusion</strong><br>- PasteToTable‚Äôs architecture ensures deterministic table IDs, stable caption fragments, secure sanitization, robust client hydration, and seamless Markdown/HTML export.<br>- Designed for multi-table support, delayed DOM hydration, toast feedback, and smooth scroll integration.<br>- Fully resilient: failures in optional steps do not block core functionality.<br>- Ready for both interactive user actions and programmatic batch processing. </td></tr></tbody></table></div><div class="row-count">Rows: 21</div></div><div class="table-caption" id="Table4" data-table="Docu_0111_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî Client Assets & Template Deep-Dive</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>1Ô∏è‚É£ script.core.js ‚Äî Core Client-Side Engine</strong><br>- <strong>Purpose:</strong> Central orchestrator for PasteToTable client.<br>- Handles: clipboard, download, toast, debounce, conversion, hydration of <code>&lt;table&gt;</code> and <code>&lt;caption&gt;</code>, DOM observation, and optional extras.<br>- <strong>Key Globals:</strong><br>  ‚Ä¢ <code>window.PTT</code> ‚Äî main API for injectCaptions(), routeHtmlToAreas(), processRenderedHtml().<br>  ‚Ä¢ <code>__ptt_skip_scroll</code> ‚Äî prevents automatic scroll conflicts.<br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>injectCaptions(payload)</code> ‚Äî hydrates tables with <code>tablesMeta</code> and <code>fragmentsMeta</code> from server.<br>  ‚Ä¢ <code>routeHtmlToAreas(html)</code> ‚Äî places converted HTML in #tables-viewer.<br>  ‚Ä¢ <code>processRenderedHtml(response)</code> ‚Äî wrapper to handle different server response formats.<br>  ‚Ä¢ <code>showToast(msg, opts)</code> ‚Äî notification system with queue and deduplication.<br>  ‚Ä¢ <code>copyToClipboard(text)</code> ‚Äî handles modern and legacy fallback.<br>- <strong>Event Handling:</strong><br>  ‚Ä¢ Listens to custom events for conversion completion.<br>  ‚Ä¢ Safe retries for DOM not ready.<br>- <strong>Integration:</strong><br>  ‚Ä¢ Reads <code>&lt;script data-caption-payload&gt;</code> emitted by server.<br>  ‚Ä¢ Maps <code>table_id</code> ‚Üî <code>&lt;table&gt;</code> for stable caption injection.<br>  ‚Ä¢ Debounced hydration ensures multi-table batch safety. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>2Ô∏è‚É£ script.table.js ‚Äî Table Interaction & Actions</strong><br>- <strong>Purpose:</strong> Table-specific user interaction: copy markdown, export, select rows, highlight.<br>- <strong>Key Functions:</strong><br>  ‚Ä¢ <code>copyMarkdown(tableId)</code> ‚Äî converts table to Markdown preserving <code>&lt;br&gt;</code>.<br>  ‚Ä¢ <code>highlightRows(rows)</code> ‚Äî temporary CSS highlight for user feedback.<br>  ‚Ä¢ <code>exportTableAsHtml(tableId)</code> ‚Äî saves standalone HTML.<br>  ‚Ä¢ <code>attachTableButtons()</code> ‚Äî sets up per-table copy/export buttons.<br>- <strong>Event Delegation:</strong><br>  ‚Ä¢ Uses delegated <code>click</code> listeners for dynamic tables.<br>  ‚Ä¢ Supports rapid addition/removal of tables in #tables-viewer.<br>- <strong>Notes:</strong> Ensures any pasted multi-line content is preserved. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>3Ô∏è‚É£ script.list.js ‚Äî Group Load & Queue</strong><br>- <strong>Purpose:</strong> Manage group list UI and load events.<br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>loadGroup(groupId)</code> ‚Äî triggers <code>/api/group</code> ‚Üí server ‚Üí HTML + caption payload.<br>  ‚Ä¢ <code>queueLoad(groupId)</code> ‚Äî prevents multiple concurrent group loads.<br>  ‚Ä¢ <code>updateGroupUI(groupId, status)</code> ‚Äî visual feedback in sidebar.<br>- <strong>Integration:</strong> Works tightly with <code>server.py</code> load_group workflow. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>4Ô∏è‚É£ script.save.js ‚Äî Save & Export</strong><br>- <strong>Purpose:</strong> Client-side saving of HTML, Markdown, or JSON payloads.<br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>saveHtml(tableId)</code> ‚Äî triggers Blob download.<br>  ‚Ä¢ <code>saveMarkdown(tableId)</code> ‚Äî converts via <code>tableToMarkdownLines</code>.<br>  ‚Ä¢ <code>saveAllGroups()</code> ‚Äî batch save with toast feedback.<br>- <strong>Defensive:</strong> Handles missing or partially loaded tables gracefully. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>5Ô∏è‚É£ script.toc.js ‚Äî Table of Contents (TOC) Handling</strong><br>- <strong>Purpose:</strong> Build & update TOC for PasteToTable tables.<br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>initPTToc(containerSelector)</code> ‚Äî sets up DOM observer on #tables-viewer.<br>  ‚Ä¢ <code>updateTocForTable(tableId)</code> ‚Äî adds/removes TOC entries dynamically.<br>  ‚Ä¢ <code>scrollToTable(tableId)</code> ‚Äî smooth scroll with debounced animation.<br>- <strong>Integration:</strong> Works with <code>script.core.js</code> hydration and dynamic caption injection. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>6Ô∏è‚É£ utils.js ‚Äî Shared Client Utilities</strong><br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>debounce(fn, wait)</code> ‚Äî standard debounce for repeated events.<br>  ‚Ä¢ <code>sanitizeFileName(name)</code> ‚Äî safe filenames for download.<br>  ‚Ä¢ <code>once(fn)</code> ‚Äî ensures a function is executed once.<br>  ‚Ä¢ <code>joinUrl(base, path)</code> ‚Äî safe URL concatenation.<br>- <strong>Notes:</strong> Used across core and table scripts for consistent utility. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>7Ô∏è‚É£ extra.js ‚Äî Optional Enhancements Loader</strong><br>- <strong>Purpose:</strong> Dynamically load optional client features.<br>- <strong>Behavior:</strong><br>  ‚Ä¢ <code>loadExtraSequentially(candidates)</code> ‚Äî loads JS files sequentially.<br>  ‚Ä¢ Retries up to N times per candidate.<br>  ‚Ä¢ Skips already loaded scripts to avoid duplication. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>8Ô∏è‚É£ worker.js ‚Äî Future Client-Side Worker</strong><br>- <strong>Purpose:</strong> Reserved for async/parallel table processing.<br>- <strong>Structure:</strong><br>  ‚Ä¢ Event listener <code>onmessage</code> handles table data chunk processing.<br>  ‚Ä¢ Returns <code>{tableId, fragmentIds, sanitizedHTML}</code>.<br>- <strong>Current:</strong> Not actively used; placeholder for potential future performance optimization. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>9Ô∏è‚É£ overrides.css ‚Äî Custom CSS Adjustments</strong><br>- <strong>Purpose:</strong> PTT-specific visual overrides.<br>- Hides native markdown export buttons initially.<br>- Adds responsive flex for table containers.<br>- Smooth hover effects for rows and caption buttons. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>üîü style.css ‚Äî Core Styling</strong><br>- Locked, byte-identical to Table Viewer 2.1.<br>- Provides all baseline typography, table layout, captions, flex layout, buttons.<br>- Used in combination with <code>overrides.css</code> for small tweaks. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>1Ô∏è‚É£1Ô∏è‚É£ templates/index.html ‚Äî HTML Skeleton</strong><br>- <strong>Structure:</strong><br>  ‚Ä¢ <code>&lt;head&gt;</code>: loads CSS, sets metadata.<br>  ‚Ä¢ <code>&lt;body&gt;</code>: <code>#paste</code> textarea, <code>#tables-viewer</code>, <code>#status</code>, sidebar for groups.<br>  ‚Ä¢ Includes <code>&lt;script&gt;</code> tags for core and table JS.<br>- <strong>Integration:</strong><br>  ‚Ä¢ Expects server to inject <code>&lt;script data-caption-payload&gt;</code> during group load.<br>  ‚Ä¢ Client JS reads payload, hydrates tables, attaches captions, updates TOC.<br>- <strong>Notes:</strong> Fully defensive: missing or delayed elements do not break workflow. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>1Ô∏è‚É£2Ô∏è‚É£ Client Flow Summary</strong><br>- User pastes text ‚Üí <code>script.core.js</code> detects ‚Üí optional conversion ‚Üí sends to server <code>/api/convert</code>.<br>- Server converts, sanitizes, fragments, assigns IDs, injects <code>&lt;script data-caption-payload&gt;</code> ‚Üí returns HTML.<br>- <code>script.core.js</code> reads payload ‚Üí injectCaptions() ‚Üí updates tables + captions.<br>- <code>script.table.js</code> attaches buttons ‚Üí copy/export/markdown.<br>- <code>script.toc.js</code> observes tables ‚Üí updates TOC.<br>- <code>script.save.js</code> handles local export.<br>- Optional extras (<code>extra.js</code>) loaded sequentially for enhanced functionality.<br>- Toast notifications provide feedback at every stage. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Defensive & Edge Case Design</strong><br>- All client scripts wrapped with try/catch for missing DOM or failed server response.<br>- Payload mapping ensures table_id ‚Üî <code>&lt;table&gt;</code> even on reload.<br>- Multi-table paste supported; hydration is idempotent.<br>- Debounced conversion and event handling prevents duplicate inserts.<br>- Clipboard fallback ensures cross-browser support.<br>- Toast queue ensures no message loss and proper sequencing. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Summary</strong><br>- Client assets form a tightly integrated system: core orchestrator (<code>script.core.js</code>), table interactions (<code>script.table.js</code>), group loading (<code>script.list.js</code>), TOC (<code>script.toc.js</code>), save/export (<code>script.save.js</code>), optional enhancements (<code>extra.js</code>), and future parallelization (<code>worker.js</code>).<br>- Works seamlessly with backend caption payload, stable IDs, and fragment hydration.<br>- Fully defensive and designed for rapid paste, multi-table support, Markdown export, and dynamic DOM updates.<br>- Combines CSS (<code>style.css</code>, <code>overrides.css</code>) and template (<code>index.html</code>) to deliver a reliable PasteToTable user experience. </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><div class="table-caption" id="Table5" data-table="Docu_0111_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>PasteToTable ‚Äî Extended Super Detailed Workflow Overview</strong><br><br><strong>1Ô∏è‚É£ User Interaction Layer</strong><br>‚îú‚îÄ <strong>Direct Paste:</strong> Users paste text directly into <code>#paste</code> textarea; immediate validation ensures non-empty content.<br>‚îú‚îÄ <strong>Load Group:</strong> Users select a group from <code>groups.json</code> using <code>script.list.js</code>; the client prepares <code>group_id</code> and <code>client_req_id</code> for server fetch.<br>‚îú‚îÄ <strong>Event Handling:</strong> <code>script.core.js</code> attaches debounced event listeners for paste, click, and keyboard shortcuts; prevents duplicate processing.<br>‚îú‚îÄ <strong>Pre-flight Validation:</strong> Checks for empty text, malformed content, or missing group selection; displays immediate toast warnings.<br>‚îú‚îÄ <strong>Feedback:</strong> Initial toast "Processing tables‚Ä¶" is displayed with duration scaled by text length.<br>‚îî‚îÄ <strong>Routing:</strong> Determines whether conversion is client-side simple render or requires server-side processing (caption injection, parsing, multi-table handling).<br><br><strong>2Ô∏è‚É£ Client-Side Core (<code>script.core.js</code>)</strong><br>‚îú‚îÄ <strong>Configuration:</strong> Default settings include highlight: true, debounceMs: 150, chunkSize: 300; debug flag <code>TV_DEBUG</code> derived from <code>window.tvDebug</code>.<br>‚îú‚îÄ <strong>Base URL Detection:</strong> Uses <code>detectScriptBase()</code> to determine script and asset paths, supporting <code>document.currentScript</code>, <code>/assets/script.core.js</code>, or fallback to <code>location.origin</code>.<br>‚îú‚îÄ <strong>Payload Preparation:</strong> Collects <code>text</code>, <code>group_id</code>, <code>client_req_id</code>, timestamps, user flags; ensures safe JSON encoding.<br>‚îú‚îÄ <strong>Conversion Queue:</strong> Debounced, prevents concurrent conversions; provides toast feedback for long-running operations.<br>‚îú‚îÄ <strong>Server Communication:</strong> Sends JSON or URL-encoded POST to <code>/api/convert</code> or <code>/api/group</code>; handles errors gracefully, displays warning or error toasts.<br>‚îú‚îÄ <strong>Client-Side Optimization:</strong> Small/simple tables may be rendered directly without server round-trip; large or grouped tables always use server-side parsing for consistency and caption injection.<br>‚îî‚îÄ <strong>Optional Extras:</strong> Sequential loading of <code>extra.js</code> handled via <code>loadExtraSequentially()</code>, retries on failure, ensures UI enhancements attach only once.<br><br><strong>3Ô∏è‚É£ Server-Side Handling (<code>server.py</code>)</strong><br>‚îú‚îÄ <strong>Request Context:</strong> <code>request_ctx</code> built with <code>action</code>, <code>source</code>, <code>client_req_id</code> for traceability.<br>‚îú‚îÄ <strong>Group Reading:</strong> Uses <code>io_utils.read_group()</code> to read relevant files, compute checksums, and optionally cache content.<br>‚îú‚îÄ <strong>Parsing & Conversion:</strong> <code>convert.parse_*()</code> produces <code>CaptionBlocks</code> with preliminary metadata including table structure, row counts, and initial captions.<br>‚îú‚îÄ <strong>Sanitization:</strong> <code>sanitize.sanitize_caption_html()</code> ensures HTML safety, prevents XSS, sets <code>meta.sanitized=true</code>.<br>‚îú‚îÄ <strong>Fragment Creation:</strong> <code>core_fragments.CaptionFragment.create()</code> generates stable fragment IDs; ensures deterministic mapping for table ‚Üî caption.<br>‚îú‚îÄ <strong>Table ID Assignment:</strong> <code>core_table.ensure_table_id()</code> guarantees each table has unique <code>table_id</code> and captures row counts for metadata; necessary for multi-table exports and consistent hydration.<br>‚îú‚îÄ <strong>Caption Injection:</strong> <code>core_renderer.inject_captions()</code> runs only for <code>request_ctx.action==&quot;load_group&quot;</code>:<br>‚îÇ  ‚îú‚îÄ Updates <code>table_meta</code> with fragment IDs.<br>‚îÇ  ‚îî‚îÄ Marks <code>fragments.meta.injected=true</code> for downstream processing.<br>‚îî‚îÄ <strong>HTML Rendering:</strong> <code>html_renderer.render_html()</code> outputs final HTML:<br>   ‚îú‚îÄ If captions injected: emits <code>&lt;script data-caption-payload&gt;</code> with serialized metadata for hydration.<br>   ‚îî‚îÄ If no captions: returns sanitized HTML without payload, preventing unnecessary client hydration.<br><br><strong>4Ô∏è‚É£ Client-Side Hydration & Table Interaction</strong><br>‚îú‚îÄ <strong>Hydration:</strong> <code>window.PTT.injectCaptions()</code> maps caption fragments to respective table cells.<br>‚îú‚îÄ <strong>Interactive Buttons (<code>script.table.js</code>):</strong><br>‚îÇ  ‚îú‚îÄ Copy Markdown (preserves <code>&lt;br&gt;</code>, inline HTML, and table structure).<br>‚îÇ  ‚îú‚îÄ Save HTML/JSON/Markdown with server fallback.<br>‚îÇ  ‚îú‚îÄ Highlight / unhighlight cells with CSS toggle.<br>‚îÇ  ‚îî‚îÄ Export all tables sequentially.<br>‚îú‚îÄ <strong>TOC Updates (<code>script.toc.js</code>):</strong> Observes <code>#tables-viewer</code>, updates dynamic Table of Contents, supports nested sections and live refresh.<br>‚îú‚îÄ <strong>Save Handlers (<code>script.save.js</code>):</strong> Supports server save, local download, toast notifications on success/failure.<br>‚îú‚îÄ <strong>Sequential Extras:</strong> Ensures <code>extra.js</code> scripts attach enhancements once per session.<br>‚îú‚îÄ <strong>Worker Integration:</strong> Placeholder <code>worker.js</code> allows future asynchronous parallel table processing for large datasets.<br>‚îî‚îÄ <strong>Scroll & Focus Management:</strong> Maintains user viewport stability during injections and table hydration.<br><br><strong>5Ô∏è‚É£ Data Transformation & Flow</strong><br>1. User input captured ‚Üí client debounced ‚Üí prepares payload.<br>2. Server reads/parses/sanitizes ‚Üí generates caption fragments ‚Üí ensures table IDs ‚Üí injects captions ‚Üí renders HTML + payload.<br>3. Client receives HTML ‚Üí <code>injectCaptions()</code> hydrates tables ‚Üí attaches TOC, interactive buttons, and optional extras.<br>4. Clipboard copy, save, or batch export triggered via table buttons.<br>5. Toast notifications provide continuous feedback: processing, success, warning, error.<br>6. Optional retry mechanisms for DOM not ready, network failures, or partial table failures.<br><br><strong>6Ô∏è‚É£ Defensive Architecture</strong><br>‚Ä¢ <strong>DOM Safety:</strong> All manipulations wrapped in try/catch; retry loops for delayed elements.<br>‚Ä¢ <strong>Event Debouncing:</strong> Prevents concurrent conversions or double-click issues.<br>‚Ä¢ <strong>Multi-Table Support:</strong> Idempotent hydration ensures consistent IDs and caption mapping.<br>‚Ä¢ <strong>Clipboard Fallback:</strong> Uses <code>tryLegacyCopy()</code> for older browser support.<br>‚Ä¢ <strong>Toast Queue:</strong> Sequential handling with auto-duration based on message length; deduplication by key.<br>‚Ä¢ <strong>CSS Overrides:</strong> Ensures PasteToTable styling consistent with Tables Viewer 2.1; prevents flicker, layout shift.<br>‚Ä¢ <strong>Payload Safety:</strong> Serialized metadata escapes HTML entities, preventing XSS.<br>‚Ä¢ <strong>Deterministic IDs:</strong> Server ensures stable table and fragment IDs for repeatable exports.<br>‚Ä¢ <strong>Markdown Export:</strong> Supports multi-table, multi-row, multi-line <code>&lt;br&gt;</code> preservation.<br>‚Ä¢ <strong>Error Resilience:</strong> Optional extras, TOC, and worker scripts fail silently without blocking core logic.<br><br><strong>7Ô∏è‚É£ Observations & Edge Cases</strong><br>‚Ä¢ Handles missing <code>#paste</code> or empty text with graceful toast warning.<br>‚Ä¢ Non-JSON or malformed server response handled with fallback toast and safe HTML rendering.<br>‚Ä¢ Multiple rapid conversions queued and serialized to prevent race conditions.<br>‚Ä¢ Missing TOC or optional extras do not break main workflow.<br>‚Ä¢ Clipboard API fallback ensures wide browser compatibility.<br>‚Ä¢ Scroll and viewport coordination prevents user jank or visual disruption.<br>‚Ä¢ Stable IDs allow table hydration even if server content changes slightly.<br>‚Ä¢ Extensive logging controlled via debug flags; avoids console spam in production.<br><br><strong>8Ô∏è‚É£ Super Note:</strong><br>This end-to-end workflow ensures robust, deterministic handling from user paste or group load, through server-side caption injection, to interactive table hydration and export. All operations are designed for resilience, UX consistency, secure HTML handling, deterministic metadata, and future extensibility (workers, async processing, enhanced exports). PasteToTable is architected for maximal reliability, seamless multi-table handling, and tight integration with Tables Viewer 2.1, ensuring users can copy, save, or export tables confidently without data loss or broken formatting.</td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table6" data-table="Docu_0111_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>PasteToTable ‚Äî Extended Super Detailed Workflow Overview (Batch 2)</strong><br><br><strong>9Ô∏è‚É£ Server-Side Utility Modules</strong><br>‚îú‚îÄ <strong><code>render/core_io.py</code></strong><br>‚îÇ  ‚îú‚îÄ Provides atomic write operations to ensure file integrity.<br>‚îÇ  ‚îú‚îÄ Temporary directories creation (<code>tmp_dir</code>) for intermediate table processing.<br>‚îÇ  ‚îú‚îÄ Path validation utilities prevent directory traversal or invalid writes.<br>‚îÇ  ‚îî‚îÄ Ensures safe cleanup of temporary resources.<br>‚îú‚îÄ <strong><code>render/core_utils.py</code></strong><br>‚îÇ  ‚îú‚îÄ Sanitization helpers for HTML, CSS, and text content.<br>‚îÇ  ‚îú‚îÄ Streaming helpers allow partial content flush for large tables.<br>‚îÇ  ‚îú‚îÄ SRI (<code>subresource integrity</code>) attribute generators for safe asset embedding.<br>‚îÇ  ‚îî‚îÄ Miscellaneous helper functions for consistent internal data processing.<br>‚îú‚îÄ <strong><code>render/core_assets.py</code></strong><br>‚îÇ  ‚îú‚îÄ Discovers assets (CSS, JS) required for table rendering.<br>‚îÇ  ‚îú‚îÄ Embeds assets inline when necessary to minimize HTTP requests.<br>‚îÇ  ‚îú‚îÄ Ensures proper copying of static resources to <code>saved_tables</code> or temporary directories.<br>‚îÇ  ‚îî‚îÄ Resolves paths dynamically based on environment (dev/prod).<br>‚îú‚îÄ <strong><code>render/core_table.py</code></strong><br>‚îÇ  ‚îú‚îÄ <code>render_table()</code> wrapper centralizes table rendering logic.<br>‚îÇ  ‚îú‚îÄ Ensures table metadata consistency (row/column counts, IDs).<br>‚îÇ  ‚îú‚îÄ Provides hooks for caption injection and styling.<br>‚îÇ  ‚îî‚îÄ Handles table-level CSS class management for PasteToTable vs Tables Viewer 2.1 parity.<br>‚îú‚îÄ <strong><code>render/core_renderer.py</code></strong><br>‚îÇ  ‚îú‚îÄ Central caption injection logic: <code>inject_captions()</code> verifies <code>request_ctx.action</code> before processing.<br>‚îÇ  ‚îú‚îÄ Updates table metadata with caption fragment IDs.<br>‚îÇ  ‚îú‚îÄ Marks <code>fragments.meta.injected=true</code> for downstream HTML rendering.<br>‚îÇ  ‚îî‚îÄ Designed to be idempotent, safe to rerun without corrupting table structure.<br>‚îú‚îÄ <strong><code>render/core_fragments.py</code></strong><br>‚îÇ  ‚îú‚îÄ <code>CaptionFragment.create()</code> ensures stable deterministic fragment IDs.<br>‚îÇ  ‚îú‚îÄ Supports multi-line captions and preserves HTML <code>&lt;br&gt;</code> breaks.<br>‚îÇ  ‚îú‚îÄ Maintains mapping table_id ‚Üî fragment_id ‚Üî caption content.<br>‚îÇ  ‚îî‚îÄ Provides fragment metadata (<code>injected</code>, <code>sanitized</code>) for client-side hydration.<br>‚îú‚îÄ <strong><code>render/convert.py</code></strong><br>‚îÇ  ‚îú‚îÄ Parsing logic for multi-table input, both plain text and structured Markdown/HTML.<br>‚îÇ  ‚îú‚îÄ Produces <code>CaptionBlocks</code> and intermediate metadata.<br>‚îÇ  ‚îú‚îÄ Integrates tightly with sanitization and fragment generation.<br>‚îÇ  ‚îî‚îÄ Handles edge cases: empty rows, inconsistent columns, malformed HTML.<br>‚îú‚îÄ <strong><code>render/sanitize.py</code></strong><br>‚îÇ  ‚îú‚îÄ Core HTML sanitization pipeline to prevent XSS.<br>‚îÇ  ‚îú‚îÄ Converts unsafe attributes, strips scripts, normalizes whitespace.<br>‚îÇ  ‚îî‚îÄ Optionally adds safe <code>&lt;br&gt;</code> preservation for multi-line captions.<br>‚îú‚îÄ <strong><code>render/io_utils.py</code></strong><br>‚îÇ  ‚îú‚îÄ File reading/writing helpers for group data and temporary conversion artifacts.<br>‚îÇ  ‚îú‚îÄ Computes checksums for content validation.<br>‚îÇ  ‚îî‚îÄ Supports both JSON and raw text payloads safely.<br>‚îú‚îÄ <strong><code>render/assets.py</code></strong><br>‚îÇ  ‚îú‚îÄ Central asset registry for JS/CSS injection.<br>‚îÇ  ‚îú‚îÄ Resolves dependencies and ensures no duplicate injection.<br>‚îÇ  ‚îî‚îÄ Works with both inline embedding and file-based references.<br>‚îú‚îÄ <strong><code>render/markdown.py</code></strong><br>‚îÇ  ‚îú‚îÄ Converts table HTML/CaptionBlocks into Markdown lines.<br>‚îÇ  ‚îú‚îÄ Handles <code>&lt;br&gt;</code> in cells, multi-line captions, and inline HTML.<br>‚îÇ  ‚îî‚îÄ Supports consistent export format for client-side copy or server save.<br>‚îú‚îÄ <strong><code>render/types.py</code></strong><br>‚îÇ  ‚îú‚îÄ Type definitions for tables, captions, fragments, and request contexts.<br>‚îÇ  ‚îî‚îÄ Ensures static-type safety and predictable property access across modules.<br>‚îú‚îÄ <strong><code>render/cli.py</code></strong><br>‚îÇ  ‚îú‚îÄ Optional command-line interface for testing conversion and rendering.<br>‚îÇ  ‚îú‚îÄ Supports local file input, output to saved_tables, preview HTML.<br>‚îÇ  ‚îî‚îÄ Primarily a developer tool; integrates with the same parsing and injection pipeline as server.py.<br><br><strong>üîß Client-Side Modules & Assets</strong><br>‚îú‚îÄ <strong><code>assets/script.table.js</code></strong><br>‚îÇ  ‚îú‚îÄ Handles table-specific UI: copy, save, highlight, export all.<br>‚îÇ  ‚îú‚îÄ Hydrates tables with injected captions via <code>window.PTT.injectCaptions()</code>.<br>‚îÇ  ‚îú‚îÄ Preserves <code>&lt;br&gt;</code> and inline formatting during Markdown copy.<br>‚îÇ  ‚îú‚îÄ Integrates toast feedback for operations.<br>‚îÇ  ‚îî‚îÄ Defensive: checks DOM availability before attachment.<br>‚îú‚îÄ <strong><code>assets/script.list.js</code></strong><br>‚îÇ  ‚îú‚îÄ Handles group list rendering, selection, and fetch initiation.<br>‚îÇ  ‚îú‚îÄ Prepares payload (<code>group_id</code>, <code>client_req_id</code>) for server.<br>‚îÇ  ‚îî‚îÄ Debounced click handlers to prevent multiple simultaneous group loads.<br>‚îú‚îÄ <strong><code>assets/script.core.js</code></strong><br>‚îÇ  ‚îú‚îÄ Core orchestration for conversion pipeline: paste ‚Üí prepare ‚Üí fetch ‚Üí render.<br>‚îÇ  ‚îú‚îÄ Toast system, debounce, clipboard helpers, download support.<br>‚îÇ  ‚îú‚îÄ Optional extra.js loader, TOC integration.<br>‚îÇ  ‚îî‚îÄ Ensures multi-table handling and consistent user feedback.<br>‚îú‚îÄ <strong><code>assets/script.toc.js</code></strong><br>‚îÇ  ‚îú‚îÄ Table of Contents generation and mutation observer for dynamic updates.<br>‚îÇ  ‚îî‚îÄ Integrates with PasteToTable API for TOC re-rendering.<br>‚îú‚îÄ <strong><code>assets/script.save.js</code></strong><br>‚îÇ  ‚îú‚îÄ Handles server-side save via fetch API.<br>‚îÇ  ‚îú‚îÄ Fallback local download for unsupported environments.<br>‚îÇ  ‚îî‚îÄ Toast feedback for success, warning, error.<br>‚îú‚îÄ <strong><code>assets/worker.js</code></strong><br>‚îÇ  ‚îú‚îÄ Placeholder for future async worker support.<br>‚îÇ  ‚îî‚îÄ Could offload heavy table processing or Markdown generation.<br>‚îú‚îÄ <strong><code>assets/overrides.css</code> & <code>style.css</code></strong><br>‚îÇ  ‚îú‚îÄ Ensures visual parity with Tables Viewer 2.1.<br>‚îÇ  ‚îú‚îÄ Overrides default browser table styles, ensures responsive layouts.<br>‚îÇ  ‚îî‚îÄ Early hide export buttons to prevent flash of unstyled elements.<br>‚îú‚îÄ <strong><code>assets/extra.js</code> & <code>utils.js</code></strong><br>‚îÇ  ‚îú‚îÄ Optional enhancements and helper utilities.<br>‚îÇ  ‚îú‚îÄ Extra DOM helpers, dynamic features.<br>‚îÇ  ‚îî‚îÄ Loaded sequentially to prevent conflicts.<br>‚îú‚îÄ <strong><code>groups.json</code> & <code>labels.json</code></strong><br>‚îÇ  ‚îú‚îÄ Group definitions for Load Group feature.<br>‚îÇ  ‚îî‚îÄ Label metadata for consistent UI naming and sorting.<br><br><strong>üîπ Templates</strong><br>‚îî‚îÄ <strong><code>templates/index.html</code></strong><br>   ‚îú‚îÄ Main entry point; contains <code>&lt;textarea id=&quot;paste&quot;&gt;</code>, <code>&lt;div id=&quot;tables-viewer&quot;&gt;</code>, buttons, and placeholders.<br>   ‚îú‚îÄ Scripts included in order: core ‚Üí table ‚Üí list ‚Üí TOC ‚Üí save ‚Üí extras.<br>   ‚îú‚îÄ CSS injected early to prevent FOUC (Flash of Unstyled Content).<br>   ‚îî‚îÄ Fully supports deferred hydration and dynamic table rendering.<br><br><strong>üîπ Notes & Observations</strong><br>‚Ä¢ Entire system designed for resilience, security, and deterministic behavior.<br>‚Ä¢ Caption IDs, table IDs, fragment metadata ensure consistent multi-table export and hydration.<br>‚Ä¢ Server-side sanitization prevents XSS; client-side sanitization complements it.<br>‚Ä¢ Clipboard, download, toast, TOC, and export operations are fully defensive.<br>‚Ä¢ Multi-layer debouncing and event throttling prevent concurrent operation issues.<br>‚Ä¢ Extensible architecture supports workers, async processing, and future UI enhancements.<br>‚Ä¢ PasteToTable tightly integrated with Tables Viewer 2.1 style, DOM structure, and typography.<br>‚Ä¢ Designed for professional-grade UX: instant feedback, reliable export, multi-table handling, and safe HTML/Markdown preservation.<br>‚Ä¢ All assets, scripts, and modules are modular, maintainable, and safe for iterative development.<br><br><strong>üîπ Super Note:</strong><br>This batch completes the coverage of all server-side utility modules, client-side assets, and template integration. Combined with Batch 1, it represents a comprehensive, deterministic, resilient, and extensible architecture for PasteToTable. The workflow ensures that pasted text or loaded groups are converted into 2-column tables with correct captions, consistent IDs, safe HTML, proper TOC integration, optional extras, robust toast feedback, and full export capabilities. Future enhancements such as async processing, workers, or extended export formats can be integrated seamlessly without disrupting existing deterministic flows. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table7" data-table="Docu_0111_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>PasteToTable Project Full Workflow</strong> ‚Äî End-to-end orchestration: user input ‚Üí server parsing ‚Üí safe caption injection ‚Üí client rendering ‚Üí Markdown/HTML export; robust to missing DOM, delayed scripts, and supports Tables Viewer 2.1. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ User Interaction Layer</strong> ‚Äî Main entry points: front-end buttons (Convert, Load Group, Clear, Save, Export); payloads <code>{ group_id, action, client_req_id }</code> or <code>{ text }</code>; client scripts <code>script.core.js</code>, <code>script.list.js</code>, <code>script.table.js</code>, <code>script.save.js</code> handle event binding, queue management, and DOM interaction. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ Client Payload Routing</strong> ‚Äî <code>script.list.js</code> sends <code>Load Group</code> payload to <code>/load_group</code>; <code>script.core.js</code> / table buttons send <code>Convert</code> to <code>/convert</code>; clipboard/save handled client-side with Markdown generation and download fallback. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ server.py Handling</strong> ‚Äî Build <code>request_ctx</code> (action, source, client_req_id); dispatch actions to handlers; <strong>Load Group Flow:</strong> calls <code>io_utils.read_group()</code> ‚Üí <code>convert.parse_*()</code> to produce <code>CaptionBlocks</code>; attach <code>meta.source=&quot;group_load&quot;</code>; run <code>sanitize.sanitize_caption_html()</code>; <code>core_fragments.CaptionFragment.create()</code> assigns fragment IDs; <code>core_table.ensure_table_id()</code> validates/generates table IDs; <code>core_renderer.inject_captions()</code> (only if <code>action==&quot;load_group&quot;</code>) updates <code>table_meta.caption_ids</code> and sets <code>fragments.meta.injected=true</code>; <code>html_renderer.render_html()</code> emits final HTML and, if <code>meta.injected==true</code>, includes <code>&lt;script data-caption-payload&gt;‚Ä¶&lt;/script&gt;</code>. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ Client Script Processing</strong> ‚Äî <code>window.PTT.injectCaptions()</code> reads <code>&lt;script data-caption-payload&gt;</code>, maps captions to tables, and handles queue draining and deferred DOM readiness. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ HTML Renderer (<code>html_renderer.py</code>)</strong> ‚Äî Wraps tables in consistent container structures, emits metadata and deterministic table IDs (SHA256 of normalized HTML if missing), and supports manual paste, group load, and server-converted HTML initialization paths. </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ Core Renderer (<code>core_renderer.py</code>)</strong> ‚Äî Safely injects caption fragments into the DOM; checks <code>request_ctx.action</code> and <code>meta.injected</code>; ensures idempotent injection for repeated loads. </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ Core Table Utilities (<code>core_table.py</code>)</strong> ‚Äî <code>ensure_table_id()</code> guarantees stable IDs per table; maintains row counts and table-level metadata; supports client-side table lookup and caption mapping. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ Core Fragments (<code>core_fragments.py</code>)</strong> ‚Äî Defines <code>CaptionFragment</code> objects with stable IDs; metadata includes source, sanitized status, injection flag; enables deterministic caption attachment even if tables are reordered or reloaded. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ Sanitization (<code>sanitize.py</code>)</strong> ‚Äî Strips unsafe HTML tags, ensures fragment-safe <code>innerHTML</code>, preserves <code>&lt;br&gt;</code> and basic formatting, and prevents XSS. </td></tr><tr><td data-label="Diagram"> <strong>üîü Conversion Layer (<code>convert.py</code>)</strong> ‚Äî Parses pasted text into two-column structured tables, produces <code>CaptionBlocks</code> and table row objects, and integrates with Markdown export utilities. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£1Ô∏è‚É£ Markdown / Export Utilities (<code>markdown.py</code>)</strong> ‚Äî Converts table arrays into Markdown lines preserving line breaks; handles multi-table exports, safe filenames, and UTF-8 normalization. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£2Ô∏è‚É£ IO Utilities (<code>io_utils.py</code>)</strong> ‚Äî Reads/writes group files atomically, computes checksums, and uses temporary directories for safe operations. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Assets & Client Script Utilities (<code>assets.js</code>, <code>script.*.js</code>)</strong> ‚Äî <code>script.core.js</code>: conversion, toasts, queue, DOM injection, extra script loader; <code>script.table.js</code>: per-table copy/exports/highlight; <code>script.list.js</code>: group load payloads and deferred rendering; <code>script.save.js</code>: save HTML/Markdown and fallback downloads; <code>worker.js</code>: reserved for future client-side/background parsing. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Templates (<code>index.html</code>)</strong> ‚Äî DOM skeleton (<code>#paste</code>, <code>#tables-viewer</code>, <code>#page-area</code>, <code>#status</code>); script injections for core/table/list/save; CSS: <code>overrides.css</code>, <code>style.css</code>. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£5Ô∏è‚É£ Client-Side Notification / Toast System</strong> ‚Äî Queue-based, deduplicated by key; auto-duration based on length; success/warn/error types; prevents overlap (min 900ms, max 8s); smooth fade animations. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£6Ô∏è‚É£ Scroll & TOC Handling</strong> ‚Äî <code>window.__tv_skip_scroll</code> for controlled scroll; PTToc initialization via mutation observers; debounced observers to prevent repeated triggers. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£7Ô∏è‚É£ Conversion & Button Handling</strong> ‚Äî Convert: captures <code>#paste</code>, disables duplicate triggers, shows toast; Save: server save or local download fallback; Clear: resets <code>#paste</code>, <code>#tables-viewer</code>, <code>#page-area</code>, <code>#status</code>; Export all / per-table copy via table scripts. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£8Ô∏è‚É£ Error Handling & Defensive Design</strong> ‚Äî Try/catch wrappers on optional ops; fallbacks for missing DOM elements, TOC, clipboard API; failures in extra scripts/CSS/TOC do not block core functionality. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£9Ô∏è‚É£ Key Notes</strong> ‚Äî Deterministic table IDs via SHA256 normalization; captions injected only when <code>action==&quot;load_group&quot;</code>; multi-table support with per-table metadata and fragment IDs; supports manual paste and group load equally. </td></tr><tr><td data-label="Diagram"> <strong>üìå Summary / Notes</strong> ‚Äî PasteToTable ensures deterministic, stable caption mapping and safe exports; designed for future enhancements (worker.js, extra.js) while preserving core reliability and Tables Viewer 2.1 compatibility. </td></tr></tbody></table></div><div class="row-count">Rows: 21</div></div><div class="table-caption" id="Table8" data-table="Docu_0111_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>PasteToTable Project Full Workflow</strong> ‚Äî End-to-end orchestration: user input ‚Üí server parsing ‚Üí safe caption injection ‚Üí client rendering ‚Üí Markdown/HTML export; robust to missing DOM, delayed scripts, and supports Tables Viewer 2.1. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ User Interaction Layer</strong> ‚Äî Main entry points: front-end buttons (Convert, Load Group, Clear, Save, Export); payloads <code>{ group_id, action, client_req_id }</code> or <code>{ text }</code>; client scripts <code>script.core.js</code>, <code>script.list.js</code>, <code>script.table.js</code>, <code>script.save.js</code> handle event binding, queue management, and DOM interaction. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ Client Payload Routing</strong> ‚Äî <code>script.list.js</code> sends <code>Load Group</code> payload to <code>/load_group</code>; <code>script.core.js</code> / table buttons send <code>Convert</code> to <code>/convert</code>; clipboard/save handled client-side with Markdown generation and download fallback. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ server.py Handling</strong> ‚Äî Build <code>request_ctx</code> (action, source, client_req_id); dispatch actions to handlers; <strong>Load Group Flow:</strong> calls <code>io_utils.read_group()</code> ‚Üí <code>convert.parse_*()</code> to produce <code>CaptionBlocks</code>; attach <code>meta.source=&quot;group_load&quot;</code>; run <code>sanitize.sanitize_caption_html()</code>; <code>core_fragments.CaptionFragment.create()</code> assigns fragment IDs; <code>core_table.ensure_table_id()</code> validates/generates table IDs; <code>core_renderer.inject_captions()</code> (only if <code>action==&quot;load_group&quot;</code>) updates <code>table_meta.caption_ids</code> and sets <code>fragments.meta.injected=true</code>; <code>html_renderer.render_html()</code> emits final HTML and, if <code>meta.injected==true</code>, includes <code>&lt;script data-caption-payload&gt;‚Ä¶&lt;/script&gt;</code>. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ Client Script Processing</strong> ‚Äî <code>window.PTT.injectCaptions()</code> reads <code>&lt;script data-caption-payload&gt;</code>, maps captions to tables, and handles queue draining and deferred DOM readiness. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ HTML Renderer (<code>html_renderer.py</code>)</strong> ‚Äî Wraps tables in consistent container structures, emits metadata and deterministic table IDs (SHA256 of normalized HTML if missing), and supports manual paste, group load, and server-converted HTML initialization paths. </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ Core Renderer (<code>core_renderer.py</code>)</strong> ‚Äî Safely injects caption fragments into the DOM; checks <code>request_ctx.action</code> and <code>meta.injected</code>; ensures idempotent injection for repeated loads. </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ Core Table Utilities (<code>core_table.py</code>)</strong> ‚Äî <code>ensure_table_id()</code> guarantees stable IDs per table; maintains row counts and table-level metadata; supports client-side table lookup and caption mapping. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ Core Fragments (<code>core_fragments.py</code>)</strong> ‚Äî Defines <code>CaptionFragment</code> objects with stable IDs; metadata includes source, sanitized status, injection flag; enables deterministic caption attachment even if tables are reordered or reloaded. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ Sanitization (<code>sanitize.py</code>)</strong> ‚Äî Strips unsafe HTML tags, ensures fragment-safe <code>innerHTML</code>, preserves <code>&lt;br&gt;</code> and basic formatting, and prevents XSS. </td></tr><tr><td data-label="Diagram"> <strong>üîü Conversion Layer (<code>convert.py</code>)</strong> ‚Äî Parses pasted text into two-column structured tables, produces <code>CaptionBlocks</code> and table row objects, and integrates with Markdown export utilities. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£1Ô∏è‚É£ Markdown / Export Utilities (<code>markdown.py</code>)</strong> ‚Äî Converts table arrays into Markdown lines preserving line breaks; handles multi-table exports, safe filenames, and UTF-8 normalization. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£2Ô∏è‚É£ IO Utilities (<code>io_utils.py</code>)</strong> ‚Äî Reads/writes group files atomically, computes checksums, and uses temporary directories for safe operations. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Assets & Client Script Utilities (<code>assets.js</code>, <code>script.*.js</code>)</strong> ‚Äî <code>script.core.js</code>: conversion, toasts, queue, DOM injection, extra script loader; <code>script.table.js</code>: per-table copy/exports/highlight; <code>script.list.js</code>: group load payloads and deferred rendering; <code>script.save.js</code>: save HTML/Markdown and fallback downloads; <code>worker.js</code>: reserved for future client-side/background parsing. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Templates (<code>index.html</code>)</strong> ‚Äî DOM skeleton (<code>#paste</code>, <code>#tables-viewer</code>, <code>#page-area</code>, <code>#status</code>); script injections for core/table/list/save; CSS: <code>overrides.css</code>, <code>style.css</code>. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£5Ô∏è‚É£ Client-Side Notification / Toast System</strong> ‚Äî Queue-based, deduplicated by key; auto-duration based on length; success/warn/error types; prevents overlap (min 900ms, max 8s); smooth fade animations. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£6Ô∏è‚É£ Scroll & TOC Handling</strong> ‚Äî <code>window.__tv_skip_scroll</code> for controlled scroll; PTToc initialization via mutation observers; debounced observers to prevent repeated triggers. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£7Ô∏è‚É£ Conversion & Button Handling</strong> ‚Äî Convert: captures <code>#paste</code>, disables duplicate triggers, shows toast; Save: server save or local download fallback; Clear: resets <code>#paste</code>, <code>#tables-viewer</code>, <code>#page-area</code>, <code>#status</code>; Export all / per-table copy via table scripts. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£8Ô∏è‚É£ Error Handling & Defensive Design</strong> ‚Äî Try/catch wrappers on optional ops; fallbacks for missing DOM elements, TOC, clipboard API; failures in extra scripts/CSS/TOC do not block core functionality. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£9Ô∏è‚É£ Key Notes</strong> ‚Äî Deterministic table IDs via SHA256 normalization; captions injected only when <code>action==&quot;load_group&quot;</code>; multi-table support with per-table metadata and fragment IDs; supports manual paste and group load equally. </td></tr><tr><td data-label="Diagram"> <strong>üìå Summary / Notes</strong> ‚Äî PasteToTable ensures deterministic, stable caption mapping and safe exports; designed for future enhancements (worker.js, extra.js) while preserving core reliability and Tables Viewer 2.1 compatibility. </td></tr><tr><td data-label="Diagram"> <strong>PasteToTable Manual Paste & Caption Injection Workflow</strong> ‚Äî Manual paste path: user ‚Üí client conversion ‚Üí server parse ‚Üí caption fragment creation ‚Üí optional injection ‚Üí client DOM mapping ‚Üí Markdown/export; idempotent and deterministic. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ User Manual Paste Interaction</strong> ‚Äî User pastes raw text or table into <code>#paste</code>; <code>script.core.js</code> captures <code>input</code>/<code>paste</code>/convert click; optional debounce prevents rapid conversions. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ Client Conversion Trigger</strong> ‚Äî <code>window.__tv_do_convert(opts)</code> called; captures <code>opts.text</code> or textarea value; shows toast ‚ÄúProcessing conversion‚Ä¶‚Äù while preparing server request. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ Payload Preparation & Fetch</strong> ‚Äî Constructs JSON POST to <code>/convert</code> with <code>{ text, client_req_id, options }</code> (two-column, markdown, numbering); falls back to URL-encoded form if needed. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ Server-Side Parsing (<code>server.py</code> + <code>convert.py</code>)</strong> ‚Äî <code>/convert</code> POST parsed by <code>convert.parse_*()</code> ‚Üí <code>TableData</code> objects with <code>table_id</code>, rows, columns, row_count, fragment metadata; captions to <code>CaptionBlocks</code>; captions sanitized via <code>sanitize.sanitize_caption_html()</code>. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ Core Fragment Creation (<code>core_fragments.py</code>)</strong> ‚Äî <code>CaptionFragment.create()</code> issues stable IDs, associates fragments with <code>table_id</code> and row indices; metadata: <code>injected=false</code>, <code>sanitized=true</code>, <code>source=&quot;manual_paste&quot;</code>. </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ Table Metadata & ID Assignment (<code>core_table.py</code>)</strong> ‚Äî <code>ensure_table_id()</code> validates/existing ID or generates SHA256 of normalized HTML; computes/stores row counts; sets table meta (<code>table_id</code>, <code>row_count</code>, <code>caption_ids=[]</code>). </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ Caption Injection Gate (<code>core_renderer.py</code>)</strong> ‚Äî Injection runs only if <code>request_ctx.action==&quot;manual_paste&quot;</code> (or forced); matches <code>table_id</code> to fragments, attaches fragment IDs as data attributes on <code>&lt;tr&gt;</code>/<code>&lt;td&gt;</code>, and sets <code>fragments.meta.injected=true</code>. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ HTML Rendering (<code>html_renderer.py</code>)</strong> ‚Äî Renders final HTML string; emits <code>&lt;script data-caption-payload&gt;</code> for each injected table when <code>meta.injected==true</code>; otherwise emits HTML without payloads; supports multiple tables and dynamic IDs. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ Client Caption Handling (<code>script.core.js</code>)</strong> ‚Äî <code>window.PTT.injectCaptions()</code> reads <code>&lt;script data-caption-payload&gt;</code>, maps fragments to rows, updates DOM (caption spans, highlights, notes), and handles missing fragment IDs or reordered tables gracefully. </td></tr><tr><td data-label="Diagram"> <strong>üîü Table Actions Post-Injection (<code>script.table.js</code>)</strong> ‚Äî Enables per-table Markdown copy, per-table save/export, optional highlighting/selection; deferred execution via <code>setTimeout</code> or <code>MutationObserver</code> until DOM ready. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£1Ô∏è‚É£ Toast & Notifications</strong> ‚Äî Toasts report ‚ÄúTable converted successfully‚Äù, ‚ÄúCaptions injected‚Äù, ‚ÄúMarkdown copied‚Äù; messages queued and deduplicated to avoid repeats across multiple tables. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£2Ô∏è‚É£ Scroll & Focus Management</strong> ‚Äî <code>window.__tv_skip_scroll</code> prevents unwanted scroll during injection; focus management keeps textarea and table viewer visible; debounced scroll restore after rendering. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Edge Cases & Fallbacks</strong> ‚Äî Empty paste aborts with toast; non-HTML-safe text sanitized; table reordering preserved via stable <code>table_id</code>; clipboard fallback <code>tryLegacyCopy()</code> if <code>navigator.clipboard</code> unavailable; multi-table paste supported with unique IDs/fragments. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Export & Markdown Conversion (<code>markdown.py</code>, <code>script.save.js</code>)</strong> ‚Äî Converts injected tables to Markdown preserving <code>&lt;br&gt;</code> and line breaks; supports single or batch export; safe filenames via <code>sanitizeFileName()</code>; server save or local download with toasts. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£5Ô∏è‚É£ Developer Notes / Stability</strong> ‚Äî Workflow idempotent; deterministic IDs and SHA256 hashing maintain fragment consistency; defensive design tolerates delayed/missing DOM; modular client scripts (<code>core.js</code>, <code>table.js</code>, <code>list.js</code>, <code>save.js</code>). </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£6Ô∏è‚É£ Summary / Notes</strong> ‚Äî Manual paste mirrors group load but starts client-side; ensures stable, safe caption injection per table and seamless integration with Markdown export, toast system, and DOM scrolling for repeatable two-column ChatGPT-style tables. </td></tr></tbody></table></div><div class="row-count">Rows: 38</div></div><div class="table-caption" id="Table9" data-table="Docu_0111_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>Master PasteToTable Workflow: Group Load + Manual Paste + Caption Injection (Detailed)</strong> ‚Äî Unified workflow covering group load and manual paste paths converging on deterministic TableData ‚Üí CaptionFragment ‚Üí HTML render ‚Üí client inject ‚Üí table actions ‚Üí export; idempotent and extensible. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ User Actions & Initial Triggers</strong> ‚Äî Group Load: <code>script.list.js</code> sends <code>{group_id, action:&quot;load_group&quot;, client_req_id}</code>; Manual Paste: <code>#paste</code> ‚Üí <code>script.core.js</code> (debounced); both build <code>request_ctx</code> with <code>action</code>, <code>source</code>, <code>client_req_id</code>. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ Client-Side Payload Construction & Fetch</strong> ‚Äî POST payload contains group_id or text + client_req_id + options; JSON POST to <code>/convert</code> with URL-encoded fallback; network errors queued/retried gracefully. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ Server-Side Handling (<code>server.py</code>)</strong> ‚Äî Builds <code>request_ctx</code>; group load uses <code>io_utils.read_group()</code> to read files & checksums; manual uses payload text; <code>convert.parse_*()</code> ‚Üí <code>TableData</code> + <code>CaptionBlocks</code>; attach <code>meta.source</code> and <code>meta.sanitized</code>. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ Caption Sanitization (<code>sanitize.py</code>)</strong> ‚Äî <code>sanitize_caption_html()</code> strips dangerous tags, escapes unsafe chars, and marks fragments <code>sanitized=true</code>. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ Fragment Creation (<code>core_fragments.py</code>)</strong> ‚Äî <code>CaptionFragment.create()</code> issues stable IDs per caption, records table_id & row ranges, content, and flags (<code>injected=false</code>, <code>sanitized=true</code>); supports multi-row/multi-table scenarios. </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ Table ID Assignment & Metadata (<code>core_table.py</code>)</strong> ‚Äî <code>ensure_table_id()</code> validates or generates deterministic SHA256 ID from normalized HTML; stores <code>row_count</code>, <code>table_id</code>, and attached caption IDs; ensures consistent fragment-row mapping. </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ Caption Injection Gate (<code>core_renderer.py</code>)</strong> ‚Äî Runs only when <code>request_ctx.action</code> matches injection workflow; injects fragments into <code>&lt;tr&gt;</code>/<code>&lt;td&gt;</code> as data attributes, sets <code>fragments.meta.injected=true</code>, handles missing tables and preserves injection order. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ HTML Rendering (<code>html_renderer.py</code>)</strong> ‚Äî Wraps tables into final HTML; emits <code>&lt;script data-caption-payload&gt;</code> when fragments injected; handles multiple tables, missing IDs, empty fragments, and supports extensible DOM hooks/metadata. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ Client-Side Caption Processing (<code>script.core.js</code>)</strong> ‚Äî <code>window.PTT.injectCaptions()</code> reads caption payloads, maps fragments via stable <code>table_id</code> to rows, updates DOM (spans/highlights/notes), tolerates delayed DOM or reordering, and preserves existing content on failure. </td></tr><tr><td data-label="Diagram"> <strong>üîü Table Interactions (<code>script.table.js</code>)</strong> ‚Äî Per-table controls: copy Markdown, save/export, row/column highlights; deferred until DOM ready; stable IDs prevent collisions; multi-table conversions keep captions mapped. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£1Ô∏è‚É£ Toast / Notifications (<code>script.core.js</code>)</strong> ‚Äî Sequential <code>_toastQueue</code> with <code>_activeToast</code>; <code>showToast(msg, opts)</code> supports success/warn/error; <code>showToastOnce()</code> deduplicates keys; auto-dismiss by click/timeout; durations tuned by length/type; avoids visual overlap. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£2Ô∏è‚É£ Scroll & Focus Management</strong> ‚Äî <code>window.__tv_skip_scroll</code> avoids auto-scroll conflicts; focus keeps textarea/table viewer visible; debounced scroll restore post-render with retries at 0ms/60ms/250ms/600ms for smooth UX. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Edge Cases & Fallbacks</strong> ‚Äî Empty content aborts with toast; non-HTML safe text sanitized; deterministic <code>table_id</code> preserves mapping after reordering; clipboard fallback <code>tryLegacyCopy()</code> for old browsers; partial/missing captions handled without breaking DOM; multi-table supported. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Markdown & Export (<code>markdown.py</code>, <code>script.save.js</code>)</strong> ‚Äî Converts tables + injected captions to Markdown preserving <code>&lt;br&gt;</code> and multi-row content; supports single/batch exports; filenames sanitized via <code>sanitizeFileName()</code>; export via server save or local download with toasts; copied Markdown retains structure. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£5Ô∏è‚É£ Developer Notes / Stability</strong> ‚Äî Workflow is idempotent; deterministic IDs (SHA256) ensure fragment consistency across loads/pastes; defensive design tolerates delayed/missing DOM and network errors; modular scripts (<code>core.js</code>, <code>table.js</code>, <code>list.js</code>, <code>save.js</code>) and fallbacks implemented. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£6Ô∏è‚É£ Summary / Notes</strong> ‚Äî Group load and manual paste converge at TableData + CaptionFragment ‚Üí render ‚Üí inject ‚Üí actions ‚Üí export; ensures deterministic table IDs, safe HTML, stable injection, multi-table/multi-row support, and two-column ChatGPT-style rendering. </td></tr><tr><td data-label="Diagram"> <strong>üìå Notes / Observation</strong> ‚Äî Designed for resilience: safe fallbacks for missing tables, delayed DOM, network errors; modular extensibility (extra scripts, CSS, PTToc); stable IDs and deterministic hashing keep captions mapped across multi-load scenarios; toast queue, scroll coordination, and clipboard fallbacks ensure consistent UX across browsers. </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table10" data-table="Docu_0111_10" style="margin-top:2mm;margin-left:3mm;"><strong>Table 10</strong></div>
<div class="table-wrapper" data-table-id="table-10"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>Master PasteToTable Workflow: Internal Modules & Helpers (Batch 2)</strong> ‚Äî Overview of internal modules and helpers (convert, core_utils, IO, assets, renderer, fragments, sanitize, io_utils, assets, cli, types, templates, scripts) enabling deterministic TableData ‚Üí CaptionFragment ‚Üí render ‚Üí inject ‚Üí export workflows; idempotent and defensive. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ convert.py ‚Äî Conversion & Parsing Core</strong> ‚Äî <code>parse_*()</code> converts raw text/group files into structured <code>TableData</code> and <code>CaptionBlocks</code>; handles multi-row/multi-column, line breaks preserved as <code>&lt;br&gt;</code>, merged-cell approximations, row/column alignment for Markdown/HTML, fragment-ready captions, and fallback for malformed input. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ core_utils.py ‚Äî Misc Helpers</strong> ‚Äî <code>sanitize_text_for_html()</code>, <code>stream_chunks()</code>, <code>compute_sha256()</code>, <code>attach_sri_attr()</code>, <code>safe_json_parse()</code> and other utilities for hashing, chunked processing, SRI, and robust JSON handling. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ core_io.py ‚Äî File & Atomic Operations</strong> ‚Äî <code>atomic_write()</code>, <code>make_temp_dir()</code>, <code>ensure_dir()</code>, <code>path_safety_check()</code>, <code>read_file_with_checksum()</code> for safe atomic writes, temp dirs, permission-aware recursive creation, path traversal protection, and integrity checks. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ core_assets.py ‚Äî Asset Discovery & Embedding</strong> ‚Äî Detects <code>/assets/</code>, copies or embeds JS/CSS/JSON into output, generates integrity hashes, supports <code>extra.js</code> sequential load/retries, and ensures safe inline embedding. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ core_renderer.py ‚Äî Caption Injection Logic</strong> ‚Äî <code>inject_captions()</code> maps <code>CaptionFragments</code>‚Üítables by <code>table_id</code>, checks <code>request_ctx.action</code>, marks <code>meta.injected=true</code>, preserves order on DOM reorder, supports multi-table scenarios, and ensures injected captions remain compatible with Markdown export. </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ core_fragments.py ‚Äî CaptionFragment Model</strong> ‚Äî <code>CaptionFragment.create()</code> produces deterministic <code>fragment_id</code>, stores <code>table_id</code>, <code>row_range</code>, <code>content</code>, <code>meta</code> (sanitized/injected/source), supports multi-row spans and multi-fragment tables, and serializes to/from JSON for <code>&lt;script data-caption-payload&gt;</code>. </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ sanitize.py ‚Äî HTML & Safety</strong> ‚Äî <code>sanitize_caption_html()</code> removes dangerous tags/attributes (<code>&lt;script&gt;</code>, <code>&lt;iframe&gt;</code>), <code>sanitize_table_html()</code> normalizes table structure (closes tags), <code>normalize_text_for_search()</code> strips accents/punctuation for TOC/search, and provides safe fallbacks for malformed HTML. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ io_utils.py ‚Äî Group & Table File Handling</strong> ‚Äî <code>read_group(group_id)</code> returns files, metadata, checksums, and pre-parsed <code>TableData</code>; defensive handling for missing files, empty dirs, and permission errors. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ assets.py ‚Äî Asset Management & Helpers</strong> ‚Äî Exposes core script/CSS mappings, inline embed helpers, SRI hashing, deterministic URL mapping, and fallbacks to avoid runtime JS errors. </td></tr><tr><td data-label="Diagram"> <strong>üîü cli.py ‚Äî Command-Line Interface</strong> ‚Äî CLI hooks for batch/testing (<code>ptt convert --file</code>, <code>ptt load-group --id</code>), with logging, debug/dry-run modes, and path sanitization to avoid malicious input. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£1Ô∏è‚É£ types.py ‚Äî Core Data Structures</strong> ‚Äî Typed models: <code>TableData {table_id, rows, columns, raw_html, metadata}</code>, <code>CaptionBlock {table_id, row_range, content, fragment_id, meta}</code>, <code>FragmentMeta {sanitized,injected,source}</code> for consistent cross-module contracts. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£2Ô∏è‚É£ templates/index.html</strong> ‚Äî Main web app entry: placeholders <code>#paste</code>, <code>#tables-viewer</code>, <code>#status</code>; loads <code>script.core.js</code>, <code>script.list.js</code>, <code>script.table.js</code>, <code>script.save.js</code>; dynamic injection points for <code>&lt;script data-caption-payload&gt;</code> and <code>extra.js</code>; includes <code>style.css</code> and optional <code>overrides.css</code>. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£3Ô∏è‚É£ assets/scripts overview</strong> ‚Äî <code>script.core.js</code> (conversion engine, DOM injection, toast, scroll, clipboard, extra loader), <code>script.list.js</code> (group loader/queue), <code>script.table.js</code> (per-table interactions/copy/export), <code>script.save.js</code> (export/download), <code>script.toc.js</code> (optional TOC), <code>worker.js</code> (future background tasks). </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Workflow Summary & Notes</strong> ‚Äî Manual paste + group load converge to TableData ‚Üí CaptionFragments ‚Üí sanitize ‚Üí inject ‚Üí render ‚Üí client actions ‚Üí export; deterministic <code>table_id</code>+<code>fragment_id</code> ensure stability across reloads, multi-table and reordered DOM; modular extension points and robust fallbacks for network/DOM/asset errors. </td></tr><tr><td data-label="Diagram"> <strong>üìå Super-Detailed Observations / Developer Notes</strong> ‚Äî Rendering preserves row integrity, colspan/rowspan approximations, and <code>&lt;br&gt;</code>; metadata propagation signals <code>sanitized</code>/<code>injected</code> states to client; deterministic hashing ensures consistent fragment mapping; client JS is defensive against delayed DOM, missing tables, or optional extras; modules include logging/debug flags and comprehensive error handling for batch processing, incremental injection, and Markdown export. </td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><div class="table-caption" id="Table11" data-table="Docu_0111_11" style="margin-top:2mm;margin-left:3mm;"><strong>Table 11</strong></div>
<div class="table-wrapper" data-table-id="table-11"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details / Guidelines**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details / Guidelines</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Key Points / Recommendations**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Key Points / Recommendations</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"> <strong>1Ô∏è‚É£ Locked Files in PasteToTable</strong> </td><td data-label="Details / Guidelines"> <strong>Files:</strong> <code>render/</code> folder, <code>assets/style.css</code> <br><strong>Rules:</strong> Cannot modify these files. Any logic/UI adjustments must be done in editable files (<code>server.py</code>, <code>main.py</code>, <code>html_renderer.py</code>, <code>utils.py</code>, <code>assets/*.js</code>, <code>templates/index.html</code>). <br><strong>Reasoning:</strong> All caption injection, table ID fixes, and DOM adjustments are handled via <code>core_renderer.py</code> + JS to avoid touching locked files.                                                                                                                                   </td><td data-label="Key Points / Recommendations"> ‚Ä¢ Locked files remain read-only.<br>‚Ä¢ Refactor or override externally instead of editing locked files.<br>‚Ä¢ Ensures PTT workflow integrity and maintainability.                                                                                            </td></tr><tr><td data-label="Topic"> <strong>2Ô∏è‚É£ Using TV2.1 Assets</strong>           </td><td data-label="Details / Guidelines"> <strong>Assets:</strong> JS, CSS, and HTML templates from TV2.1 can be used. <br><strong>Guidelines:</strong> <br>‚Ä¢ Replace PTT assets only where it doesn‚Äôt interfere with editable JS.<br>‚Ä¢ Keep PTT scripts (<code>script.core.js</code>, <code>script.table.js</code>, <code>script.list.js</code>, <code>script.save.js</code>) intact.<br>‚Ä¢ Keep <code>overrides.css</code> loaded after TV2.1 CSS for PTT-specific fixes.<br>‚Ä¢ Test carefully for caption injection, clipboard, and scroll/interaction logic. <br>‚Ä¢ Ensure server integration works with <code>injectCaptions()</code> reading <code>&lt;script data-caption-payload&gt;</code>. </td><td data-label="Key Points / Recommendations"> ‚Ä¢ Use TV2.1 assets to get full styles and enhancements.<br>‚Ä¢ Maintain editable JS for PTT-specific logic.<br>‚Ä¢ Locked files are never modified.<br>‚Ä¢ Server and client interactivity remain fully functional.                                              </td></tr><tr><td data-label="Topic"> <strong>‚úÖ Recommendation</strong>                 </td><td data-label="Details / Guidelines">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td><td data-label="Key Points / Recommendations"> ‚Ä¢ Keep locked files intact.<br>‚Ä¢ Replace only non-conflicting UI/utility assets from TV2.1.<br>‚Ä¢ Handle all caption, table ID, and injection logic in editable files.<br>‚Ä¢ Achieves full TV2.1 styling and JS features while preserving PTT functionality. </td></tr></tbody></table></div><div class="row-count">Rows: 3</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>