<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1763360824">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li>
<li class="toc-item"><a class="toc-link" href="#Table10">Table 10</a></li>
<li class="toc-item"><a class="toc-link" href="#Table11">Table 11</a></li>
<li class="toc-item"><a class="toc-link" href="#Table12">Table 12</a></li>
<li class="toc-item"><a class="toc-link" href="#Table13">Table 13</a></li>
<li class="toc-item"><a class="toc-link" href="#Table14">Table 14</a></li>
<li class="toc-item"><a class="toc-link" href="#Table15">Table 15</a></li>
<li class="toc-item"><a class="toc-link" href="#Table16">Table 16</a></li>
<li class="toc-item"><a class="toc-link" href="#Table17">Table 17</a></li>
<li class="toc-item"><a class="toc-link" href="#Table18">Table 18</a></li>
<li class="toc-item"><a class="toc-link" href="#Table19">Table 19</a></li>
<li class="toc-item"><a class="toc-link" href="#Table20">Table 20</a></li>
<li class="toc-item"><a class="toc-link" href="#Table21">Table 21</a></li>
<li class="toc-item"><a class="toc-link" href="#Table22">Table 22</a></li>
<li class="toc-item"><a class="toc-link" href="#Table23">Table 23</a></li>
<li class="toc-item"><a class="toc-link" href="#Table24">Table 24</a></li>
<li class="toc-item"><a class="toc-link" href="#Table25">Table 25</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Docu_0111_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî Full Technical Overview (Batch 1/2)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üéØ <strong>Purpose & Scope</strong><br>PasteToTable (PTT) is a hybrid Python + JavaScript application designed to convert pasted text or loaded data groups into fully formatted 2-column tables with ChatGPT-style aesthetics. It is tightly integrated with Tables Viewer 2.1 (TV2.1) for visual parity. The system supports manual paste, Load Group workflows, caption injection, multi-table handling, markdown export, local saving, and optional client-side extras. It is resilient to DOM timing issues, missing data, partial conversion failures, and concurrent events. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> ‚öôÔ∏è <strong>Configuration & Globals</strong><br>- Backend <code>server.py</code> handles requests via <code>/convert</code> and <code>/group</code> endpoints.<br>- Frontend <code>script.core.js</code> initializes <code>window.PTT</code> with configuration defaults, including highlight, debounce, and chunkSize.<br>- Debug flags controlled via <code>TV_DEBUG</code> on frontend; backend logs optional for load/convert actions.<br>- Coordination flags such as <code>window.__tv_skip_scroll</code> prevent scroll conflicts during DOM updates. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üõ† <strong>Backend Utilities</strong><br>- <code>io_utils.py</code>: Atomic read/write, tmp dir handling, file path validation, checksum computation.<br>- <code>core_io.py</code>: Safe atomic writes, temp file handling, path validation for <code>/saved_tables</code>.<br>- <code>core_utils.py</code>: Misc helpers including string normalization, HTML sanitization, streaming helpers, SRI attribute computation.<br>- <code>sanitize.py</code>: Strips disallowed HTML, enforces safe tags (<code>table</code>, <code>tr</code>, <code>td</code>, <code>th</code>, <code>caption</code>), escapes data attributes, and prevents XSS injection from user content. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üíª <strong>Conversion Modules</strong><br>- <code>convert.py</code>: Primary parser converting raw pasted text or group content into structured <code>CaptionBlocks</code> with row/column metadata. Handles multi-line cells, <code>&lt;br&gt;</code> tags, code blocks, inline markdown, and maintains original whitespace for chat fidelity.<br>- <code>markdown.py</code>: Converts table structures into Markdown-compatible lines with optional per-cell formatting. Supports code blocks, inline emphasis, links, and escaped characters. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üèó <strong>Core Table & Renderer</strong><br>- <code>core_table.py</code>: Wraps table generation, ensures table IDs using SHA256 hash of normalized HTML content, computes row counts, enforces consistent <code>data-id</code> and <code>data-caption</code> attributes.<br>- <code>core_renderer.py</code>: Injects captions only if <code>request_ctx.action==&quot;load_group&quot;</code>. Generates full HTML output including <code>&lt;script data-caption-payload&gt;</code> only if metadata indicates injected captions. Handles partial tables gracefully and preserves multi-table layouts. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üß© <strong>Caption Handling & Fragments</strong><br>- <code>core_fragments.py</code>: Creates <code>CaptionFragment</code> objects with stable IDs. Links each caption to table ID, row/column coordinates, and optional labels.<br>- <code>meta.injected=true</code> marks backend-rendered captions as ready for frontend hydration.<br>- Captions stored in <code>labels.json</code> optionally, allowing consistent labeling across sessions. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üîó <strong>Data Flow ‚Äî Manual Paste / Load Group</strong><br>1. User triggers Convert or Load Group.<br>2. Frontend captures event, creates <code>request_ctx</code> with action, source, client_req_id.<br>3. Payload sent to <code>server.py</code> endpoint.<br>4. Backend reads input via <code>io_utils.read_group()</code> or direct POST.<br>5. <code>convert.parse_*()</code> generates <code>CaptionBlocks</code>.<br>6. Metadata annotated (<code>meta.source</code>, <code>meta.sanitized</code>).<br>7. <code>core_fragments.CaptionFragment.create()</code> attaches stable fragment IDs.<br>8. <code>core_table.ensure_table_id()</code> computes deterministic table ID and row counts.<br>9. <code>core_renderer.inject_captions()</code> injects captions only if <code>request_ctx.action==&quot;load_group&quot;</code>.<br>10. <code>html_renderer.render_html()</code> produces final HTML, embedding <code>&lt;script data-caption-payload&gt;</code> if captions are injected.<br>11. Client JS (<code>window.PTT.injectCaptions()</code>) hydrates captions into DOM, updates metadata, triggers toast notifications. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üîç <strong>Frontend Architecture</strong><br>- <strong>script.core.js</strong>: Central controller for conversion, paste handling, toast notifications, table injection, scroll coordination, DOM hydration, and optional extra scripts.<br>- <strong>script.table.js</strong>: Table-level utilities, per-table Markdown export, copy, save, render coordination.<br>- <strong>script.list.js</strong>: Load Group UI, queries backend with <code>{action:&quot;load_group&quot;, group_id}</code>, receives sanitized HTML + metadata, hydrates captions.<br>- <strong>script.save.js</strong>: Handles save operations with atomic write fallback, local download fallback, and toast notifications. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üñ• <strong>DOM Handling & Injection</strong><br>- Tables wrapped in <code>&lt;div class=&quot;table-wrap&quot;&gt;</code> with consistent classing for CSS styling.<br>- <code>&lt;caption&gt;</code> elements injected for each table, linked via <code>data-caption-id</code>.<br>- Backend-generated <code>&lt;script data-caption-payload&gt;</code> ensures captions hydrated after DOM mutation.<br>- Scroll coordination with <code>window.__tv_skip_scroll</code> ensures smooth view insertion without jank. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üìù <strong>Toast & Notification System</strong><br>- Queue-based system: <code>_toastQueue</code>, <code>_activeToast</code> manage sequential messages.<br>- <code>_computeToastDuration(msg,type,optDuration)</code>: duration auto-calculated by message length/type.<br>- <code>showToast(msg,{type,duration})</code>: primary toast function.<br>- <code>showToastOnce(key,msg,opts,cooldownMs)</code>: prevents duplicate messages.<br>- Toasts color-coded by type: success, warning, error.<br>- Queue processor ensures multiple simultaneous messages handled sequentially with fade-in/out transitions. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üñ± <strong>Button Handlers & Event Delegation</strong><br>- Convert button triggers <code>window.__tv_do_convert(opts)</code> with concurrency guard.<br>- Clear button empties paste input, table viewer, page area, and status display.<br>- Save button triggers atomic save via server; fallback to local download.<br>- Export buttons copy per-table or all-table Markdown via clipboard helpers.<br>- All handlers attached once, idempotent, using <code>dataset.attached</code> flags. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> ‚ö° <strong>Debounce & Concurrency</strong><br>- Frontend prevents overlapping conversion/paste events with debounce wrapper.<br>- Backend serializes group load requests to prevent table ID collisions.<br>- Retry mechanisms in frontend: DOM injection retries at 60ms, 420ms, 600ms if elements not ready.<br>- Multiple conversions queued safely without losing metadata. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üîí <strong>Security & Sanitization</strong><br>- Backend enforces HTML tag whitelist: <code>table</code>, <code>tr</code>, <code>td</code>, <code>th</code>, <code>caption</code>.<br>- Inline scripts removed from user content.<br>- Data attributes escaped, ensuring XSS resilience.<br>- Table IDs and caption IDs stable, collision-resistant.<br>- Client side additionally sanitizes content before DOM insertion. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üñå <strong>CSS & Layout</strong><br>- Base <code>style.css</code> locked to match Tables Viewer 2.1 exactly.<br>- <code>overrides.css</code> allows minor tweaks: spacing, caption alignment, flex layout for multi-table scrollable view.<br>- TOC, buttons, table wraps positioned flexibly, responsive to viewport width.<br>- Prevents horizontal overflow, ensures proper caption display even on small screens. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üíæ <strong>Save & Export Workflow</strong><br>- Backend writes sanitized HTML to <code>/saved_tables/</code> using atomic write.<br>- Filenames sanitized with timestamp + caption info.<br>- Local download fallback if backend save fails.<br>- Markdown per-table or all-table export supported.<br>- Clipboard operations supported with fallback to legacy copy for older browsers. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> ‚öôÔ∏è <strong>Group Load & Manual Testing</strong><br>- <code>groups.json</code> maintains saved group metadata.<br>- <code>script.list.js</code> requests group content with <code>{action:&quot;load_group&quot;, group_id}</code>.<br>- Backend sanitizes, generates captions, computes table IDs.<br>- Frontend hydrates tables, injects captions, triggers toast notifications. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üß™ <strong>Testing & Debug Support</strong><br>- CLI (<code>cli.py</code>) allows batch offline testing.<br>- Debug flags in frontend (<code>TV_DEBUG</code>) and optional backend logs.<br>- Safe fallbacks: local download if save fails, alert toast if conversion error.<br>- Partial table rendering does not break subsequent conversions. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 1/2)"> üîÑ <strong>Retry & Resilience Mechanisms</strong><br>- Frontend retries DOM injection multiple times for robust behavior.<br>- Optional extra.js loaded sequentially with retry.<br>- Scroll flags prevent conflicts with table-level scrolling.<br>- Captions, TOC, and multi-table rendering resilient to missing DOM elements.<br>- Multiple concurrent conversions queued safely. </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table2" data-table="Docu_0111_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî Full Technical Overview (Batch 2/2)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üß© <strong>Caption Injection Mechanics</strong><br>- Backend (<code>core_renderer.py</code>) injects captions only for <code>request_ctx.action==&quot;load_group&quot;</code>.<br>- Each <code>CaptionFragment</code> contains <code>table_id</code>, <code>row_index</code>, <code>col_index</code>, <code>label</code>, and optional extra metadata.<br>- Captions attached to table metadata: <code>table_meta.captions = [fragment_id1, fragment_id2‚Ä¶]</code>.<br>- <code>meta.injected=true</code> ensures <code>html_renderer.render_html()</code> emits <code>&lt;script data-caption-payload&gt;</code> block for frontend hydration.<br>- Payload includes JSON of all fragments, table IDs, row/col coordinates, label texts, and sanitized HTML content. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üåê <strong>Client Caption Hydration</strong><br>- <code>window.PTT.injectCaptions()</code> reads <code>&lt;script data-caption-payload&gt;</code>.<br>- Each fragment mapped to corresponding <code>&lt;table&gt;</code> using <code>data-id</code>.<br>- Injects <code>&lt;caption&gt;</code> element if missing, updates text content.<br>- Ensures correct order and alignment with original row/column indices.<br>- Handles multi-table pages, skipping already-injected captions to prevent duplicates.<br>- Triggers optional callback events for downstream features like TOC or save operations. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üìä <strong>Multi-Table Coordination</strong><br>- Tables wrapped in <code>.table-wrap</code> divs, enabling independent scroll and styling.<br>- Table metadata tracked in <code>window.PTT.tablesMeta</code> with keys: <code>table_id</code>, <code>row_count</code>, <code>caption_ids</code>, <code>source_group</code>.<br>- Clipboard & Markdown export functions iterate over <code>tablesMeta</code> to extract consistent cell content including <code>&lt;br&gt;</code> and inline formatting.<br>- All table-level buttons reference specific <code>data-table-id</code> attributes to ensure actions target correct table. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üîß <strong>Frontend Utilities</strong><br>- <code>copyToClipboard(text)</code>: modern Clipboard API with legacy fallback.<br>- <code>downloadBlob(blob, filename)</code>: creates downloadable file with sanitized name.<br>- <code>sanitizeFileName(name)</code>: converts to safe cross-platform filename.<br>- <code>debounce(fn, wait)</code>: prevents rapid repeated executions.<br>- <code>normalizeForSearchLocal(s)</code>: normalizes Unicode, lowercases, strips accents, retains alphanumerics and spaces. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üñ± <strong>Table Button Handlers</strong><br>- Per-table actions: Copy Markdown, Save HTML, Export All.<br>- Button handler reads <code>data-table-id</code>, fetches table HTML, converts to Markdown lines with inline <code>&lt;br&gt;</code> preserved.<br>- Toast notification after action: success/warning/error, color-coded, auto-dismissed.<br>- Prevents multiple simultaneous operations per table. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üóÇ <strong>Group Handling</strong><br>- <code>script.list.js</code> sends <code>{action:&quot;load_group&quot;, group_id}</code> payload to <code>server.py</code>.<br>- Backend reads group files using <code>io_utils.read_group()</code>, computes checksums for consistency.<br>- Converts files into <code>CaptionBlocks</code>, sanitizes HTML, attaches stable fragment IDs.<br>- Table IDs computed deterministically; multi-table groups maintain consistent mapping for captions.<br>- Frontend hydrates all tables and captions, triggers toasts for each table loaded. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> ‚ö° <strong>Concurrency & Queue Management</strong><br>- Conversion requests queued: prevents race conditions, avoids overwriting table metadata.<br>- Frontend queue drains sequentially using <code>requestAnimationFrame</code> or setTimeout fallback.<br>- Captions injection queued if DOM not yet ready.<br>- Multi-table copy/export serialized to ensure consistent content. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üîí <strong>Security & Sanitization (Extended)</strong><br>- Data attributes escaped to prevent injection attacks.<br>- <code>&lt;script&gt;</code> tags from user content removed.<br>- Only whitelisted tags (<code>table</code>, <code>tr</code>, <code>td</code>, <code>th</code>, <code>caption</code>) allowed.<br>- Table IDs and caption IDs deterministic, collision-resistant.<br>- Frontend additionally checks <code>meta.sanitized</code> before injecting content. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üìú <strong>TOC / PTToc Integration</strong><br>- Table of Contents initialized via <code>window.__tv_init_pttoc_from_core(opts)</code>.<br>- MutationObserver watches <code>#tables-viewer</code> for new tables.<br>- Captions metadata used to build TOC entries per table.<br>- Safe retry if DOM not ready: waits up to configurable timeout.<br>- Integrates with multi-table view: ensures TOC scroll links correspond to correct <code>table_id</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üñå <strong>CSS & Layout (Extended)</strong><br>- Flexbox used for horizontal/vertical alignment of table wraps.<br>- Captions styled consistently with TV2.1: padding, font-size, color, alignment.<br>- Scrollable container ensures multiple tables do not overflow viewport.<br>- Overrides applied via <code>overrides.css</code>, locked <code>style.css</code> ensures benchmark parity.<br>- Caption injection respects CSS styling even on delayed hydration. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üíæ <strong>Save & Export (Extended)</strong><br>- <code>script.save.js</code> supports per-table HTML save, all-tables save, and Markdown export.<br>- Backend atomic write ensures consistent file output; temp file swapped to final path.<br>- Local download fallback uses <code>downloadBlob</code> with filename sanitization.<br>- Markdown export preserves multi-line cells with <code>&lt;br&gt;</code>, inline formatting, and table alignment.<br>- Clipboard copy ensures correct row/column order. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üîÑ <strong>Retry & Resilience (Extended)</strong><br>- DOM injection retries at 0ms, 60ms, 250ms, 600ms.<br>- Multiple conversion requests queued to prevent metadata overwrite.<br>- Optional extra.js loaded sequentially, retries if network or script errors.<br>- Captions and TOC hydration resilient to partial failures.<br>- Scroll coordination flags prevent jumpiness or conflict with automatic scroll-to-top. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üß™ <strong>Testing & Debugging (Extended)</strong><br>- CLI (<code>cli.py</code>) allows batch conversion and offline preview.<br>- Debug flags expose table metadata, caption payloads, and fragment IDs.<br>- Frontend <code>TV_DEBUG</code> allows inspection of PTT tablesMeta, fragment IDs, hydration status.<br>- Error handling in <code>showToast</code> ensures user notified even if DOM fails or conversion partially fails.<br>- Failures logged, do not break subsequent operations. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üìå <strong>Edge Cases</strong><br>- Missing <code>#paste</code> textarea gracefully handled with toast warning.<br>- Non-JSON response fallback with alert or toast.<br>- Rapid consecutive conversions serialized.<br>- Missing PTToc or TOC elements do not block table rendering.<br>- Clipboard API fallback for older browsers.<br>- Toast queue handles overlapping calls: max 8s, min 900ms duration.<br>- Scroll coordination prevents conflicts with table-level scroll or multi-table pages. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üìù <strong>Metadata Management</strong><br>- <code>tablesMeta</code> per table: table_id, row_count, caption_ids, source_group, injected_flag.<br>- Fragment metadata: fragment_id, table_id, row_index, col_index, label, sanitized HTML.<br>- Captions and table metadata consistent across reloads for persistent group operations.<br>- Backend ensures stable IDs via SHA256 of normalized HTML. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üß¨ <strong>Data Integrity & Checksums</strong><br>- <code>io_utils.read_group()</code> computes file checksums for consistency validation.<br>- Table ID derived deterministically from normalized HTML ensures repeatable caption mapping.<br>- Prevents duplicate table IDs, preserves caption alignment after reload. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üìä <strong>Performance Considerations</strong><br>- Debounce wrapper prevents flooding backend or DOM with rapid user input.<br>- Chunking and sequential hydration prevent main-thread blocking.<br>- Minimal DOM queries by caching table wrappers and metadata references.<br>- Multi-table operations batched for Markdown export or clipboard copy. </td></tr><tr><td data-label="PasteToTable ‚Äî Full Technical Overview (Batch 2/2)"> üìù <strong>Summary</strong><br>PasteToTable is a sophisticated Python + JavaScript system integrating backend conversion, sanitization, caption injection, frontend hydration, DOM management, multi-table coordination, TOC integration, robust toast notifications, clipboard and export utilities, save mechanisms, and fail-safe retries. It ensures <strong>consistent table IDs, stable captions, responsive multi-table layouts, safe DOM injection, cross-browser clipboard support, and full integration with Tables Viewer 2.1</strong>. The system is resilient to missing elements, partial failures, rapid user actions, and multi-table concurrency. Its architecture separates responsibilities cleanly: backend parsing/conversion, metadata and caption generation, frontend hydration, DOM injection, button handling, toast notifications, and CSS layout enforcement, providing a maintainable, extensible, and production-ready solution for ChatGPT-style table preservation and export. </td></tr></tbody></table></div><div class="row-count">Rows: 18</div></div><div class="table-caption" id="Table3" data-table="Docu_0111_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî Module Interaction &amp; Data Flow"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî Module Interaction & Data Flow</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>User Action ‚Üí Client Payload</strong><br>- User clicks ‚ÄúLoad Group‚Äù or ‚ÄúConvert‚Äù.<br>- Client sends JSON payload: <code>{action, group_id, client_req_id}</code> to <code>server.py</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>server.py ‚Äî Request Context & Routing</strong><br>- Builds <code>request_ctx</code> object: <code>{action, source, client_req_id}</code>.<br>- Routes action to proper handler: <code>load_group</code> or <code>convert_text</code>.<br>- Sets flags: <code>request_ctx.action=&quot;load_group&quot;</code>, <code>request_ctx.source=&quot;group_load&quot;</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>io_utils.read_group()</strong><br>- Reads files from <code>saved_tables/group_id/</code>.<br>- Computes SHA256 checksums per file for consistency.<br>- Returns raw HTML/text for conversion. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>convert.parse_*()</strong><br>- Parses group files into <code>CaptionBlocks</code> and intermediate table structures.<br>- Assigns logical row/column indices, labels.<br>- Attaches <code>meta.source=&quot;group_load&quot;</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>sanitize.sanitize_caption_html()</strong><br>- Cleans all HTML content.<br>- Removes disallowed tags, unsafe attributes, <code>&lt;script&gt;</code>s.<br>- Sets <code>meta.sanitized = true</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>core_fragments.CaptionFragment.create()</strong><br>- Converts parsed blocks into fragments with <strong>stable IDs</strong>.<br>- Each fragment: <code>{fragment_id, table_id, row_index, col_index, label, sanitized_html}</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>core_table.ensure_table_id()</strong><br>- Assigns deterministic table IDs using normalized HTML + SHA256.<br>- Calculates <code>row_count</code>.<br>- Ensures no collisions; preserves mapping across reloads. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>core_renderer.inject_captions()</strong><br>- Gate: only if <code>request_ctx.action==&quot;load_group&quot;</code>.<br>- Attaches fragment IDs to <code>table_meta.captions</code>.<br>- Sets <code>meta.injected=true</code>.<br>- Payload prepared for frontend injection. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>html_renderer.render_html()</strong><br>- If <code>meta.injected==true</code>:<br>  ‚Ä¢ Emits <code>&lt;script data-caption-payload&gt;</code> block.<br>  ‚Ä¢ JSON payload includes all fragment IDs, table IDs, row/col, label text, sanitized HTML.<br>- Else: omits payload to prevent unnecessary DOM pollution. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Client-side: script.core.js</strong><br>- On payload detection: <code>window.PTT.injectCaptions()</code>.<br>- Reads <code>&lt;script data-caption-payload&gt;</code>.<br>- Matches fragments to <code>&lt;table data-id&gt;</code>.<br>- Injects <code>&lt;caption&gt;</code> elements where missing.<br>- Updates <code>window.PTT.tablesMeta</code> with metadata per table: <code>{table_id, row_count, caption_ids, source_group}</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Client-side Button Handlers</strong><br>- Copy Markdown, Save HTML, Export All, per-table.<br>- Uses <code>data-table-id</code> to reference <code>tablesMeta</code>.<br>- Preserves <code>&lt;br&gt;</code> and inline formatting.<br>- Uses debounced queue to avoid simultaneous overwrites.<br>- Shows toast notifications per operation. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Multi-Table Coordination</strong><br>- All tables wrapped in <code>.table-wrap</code>.<br>- Ensures independent scrolling and layout.<br>- TOC (<code>window.__tv_init_pttoc_from_core</code>) maps captions to correct table IDs.<br>- DOM observers track late-added tables for proper caption injection. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Concurrency & Queue Management</strong><br>- Conversion queue serialized to avoid race conditions.<br>- Hydration queue ensures DOM ready before caption injection.<br>- Multi-table clipboard or export handled sequentially. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Security & Sanitization</strong><br>- All injected HTML sanitized at backend and frontend.<br>- Deterministic IDs prevent injection collisions.<br>- Payload JSON safely encoded. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Save & Export Workflow</strong><br>- Backend atomic writes via <code>core_io</code>.<br>- Local download fallback via <code>downloadBlob()</code>.<br>- Markdown export preserves multi-line cells and table alignment. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Retry & Resilience</strong><br>- DOM injection retries: 0ms, 60ms, 250ms, 600ms.<br>- Captions and TOC hydration resilient to partial failures.<br>- Scroll coordination prevents conflicts with automatic scroll. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Metadata Tracking</strong><br>- <code>tablesMeta</code>: table_id, row_count, caption_ids, source_group, injected_flag.<br>- Fragment metadata: fragment_id, table_id, row_index, col_index, label, sanitized HTML.<br>- Persistent across reloads, ensures consistent caption mapping. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>Debug & Testing Hooks</strong><br>- CLI (<code>cli.py</code>) supports batch conversion and offline preview.<br>- TV_DEBUG exposes tablesMeta, fragment IDs, hydration status.<br>- Toast notifications show successes/warnings/errors even if partial failures occur. </td></tr><tr><td data-label="PasteToTable ‚Äî Module Interaction &amp; Data Flow"> <strong>End-to-End Flow Summary</strong><br>1. User clicks ‚Üí Client sends JSON payload.<br>2. <code>server.py</code> builds request context.<br>3. <code>io_utils</code> reads group, computes checksums.<br>4. <code>convert</code> parses files into caption blocks.<br>5. <code>sanitize</code> cleans HTML.<br>6. <code>core_fragments</code> creates fragments with stable IDs.<br>7. <code>core_table</code> ensures deterministic table IDs.<br>8. <code>core_renderer</code> injects captions, sets meta.injected=true.<br>9. <code>html_renderer</code> emits <code>&lt;script data-caption-payload&gt;</code>.<br>10. <code>script.core.js</code> hydrates tables & captions.<br>11. Button actions, TOC, clipboard, save, export operate using hydrated metadata.<br>12. Retry, concurrency, and edge-case handling ensure robust user experience. </td></tr></tbody></table></div><div class="row-count">Rows: 19</div></div><div class="table-caption" id="Table4" data-table="Docu_0111_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî End-to-End Architecture & Data Flow (Detailed)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£ User Interaction & Client Request</strong><br>- User clicks one of: <code>Load Group</code>, <code>Convert</code>, <code>Copy Markdown</code>, <code>Save HTML</code>.<br>- Client forms JSON payload: <code>{action: &quot;load_group&quot; | &quot;convert_text&quot;, group_id?, client_req_id}</code>.<br>- Sends to <code>/api/group</code> or <code>/api/convert</code> endpoint via fetch/XHR.<br>- Payload includes optional metadata for tracking (timestamp, client_req_id). </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>2Ô∏è‚É£ server.py ‚Äî Request Context & Routing</strong><br>- Constructs <code>request_ctx</code> with: <code>{action, source, client_req_id, timestamp}</code>.<br>- Sets <code>source=&quot;group_load&quot;</code> for group loading, <code>source=&quot;convert_text&quot;</code> for conversion.<br>- Calls proper handler function (<code>load_group_handler</code> or <code>convert_text_handler</code>).<br>- Ensures defensive validation: checks <code>group_id</code> existence, file access, payload integrity. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>3Ô∏è‚É£ io_utils.read_group() ‚Äî File Access Layer</strong><br>- Reads all files under <code>saved_tables/{group_id}/</code>.<br>- Computes SHA256 checksums per file for change detection.<br>- Returns raw HTML/text as string array for parsing.<br>- Supports atomic reading via <code>core_io.atomic_read</code> to avoid partial file reads. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>4Ô∏è‚É£ convert.parse_*() ‚Äî Conversion Layer</strong><br>- Parses raw HTML/text into <code>CaptionBlocks</code>.<br>- Detects rows, columns, headers, and cell content.<br>- Attaches logical row/column indices.<br>- Produces intermediate structure for fragments: <code>{table_id, row_index, col_index, cell_text}</code>.<br>- Assigns metadata: <code>meta.source = &quot;group_load&quot;</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>5Ô∏è‚É£ sanitize.sanitize_caption_html() ‚Äî Safety Layer</strong><br>- Cleans all user-generated content.<br>- Removes disallowed tags (<code>&lt;script&gt;</code>, <code>&lt;iframe&gt;</code>) and unsafe attributes (<code>on*</code>, <code>style</code> if risky).<br>- Produces sanitized HTML per cell.<br>- Sets <code>meta.sanitized = true</code> to signal safety downstream.<br>- Ensures deterministic formatting for multi-line cells. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>6Ô∏è‚É£ core_fragments.CaptionFragment.create() ‚Äî Fragment Creation</strong><br>- Converts parsed CaptionBlocks into stable <strong>fragments</strong>.<br>- Each fragment: <code>{fragment_id, table_id, row_index, col_index, label, sanitized_html}</code>.<br>- Ensures <strong>stable, deterministic IDs</strong> across reloads for client-side matching.<br>- Stores fragment metadata in memory for injection. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>7Ô∏è‚É£ core_table.ensure_table_id() ‚Äî Table Identity Layer</strong><br>- Computes deterministic table IDs:<br>  ‚Ä¢ Normalized table HTML ‚Üí SHA256.<br>  ‚Ä¢ Ensures no collisions, consistent mapping across reloads.<br>- Calculates <code>row_count</code> for table.<br>- Attaches table metadata: <code>{table_id, row_count, source_group}</code>. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>8Ô∏è‚É£ core_renderer.inject_captions() ‚Äî Injection Gate</strong><br>- Runs only if <code>request_ctx.action === &quot;load_group&quot;</code>.<br>- Associates fragments with <code>table_meta.captions</code>.<br>- Marks <code>meta.injected = true</code>.<br>- Prepares JSON payload for frontend:<br>  ``<code>json {table_id, row_count, caption_ids: [...], labels: [...], sanitized_html: [...]}</code>`` </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>9Ô∏è‚É£ html_renderer.render_html() ‚Äî HTML Emission</strong><br>- Converts server-side table and fragment data into full HTML response.<br>- If <code>meta.injected==true</code>:<br>  ‚Ä¢ Adds <code>&lt;script data-caption-payload type=&quot;application/json&quot;&gt;...&lt;/script&gt;</code><br>  ‚Ä¢ JSON payload contains all fragment IDs, table IDs, labels, row/col indices, sanitized HTML.<br>- Else: omits script block.<br>- Ensures safe encoding (JSON.stringify + escape sequences) to prevent XSS. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>üîü Client-side Hydration ‚Äî script.core.js</strong><br>- On page load or payload detection: <code>window.PTT.injectCaptions()</code>.<br>- Reads <code>&lt;script data-caption-payload&gt;</code>.<br>- Matches fragments to <code>&lt;table data-id&gt;</code>.<br>- Inserts <code>&lt;caption&gt;</code> elements if missing.<br>- Updates <code>window.PTT.tablesMeta</code>:<br>  <code>{table_id, row_count, caption_ids, source_group, injected_flag}</code>.<br>- Observes DOM mutations for late-added tables. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£1Ô∏è‚É£ Button Handlers & Clipboard</strong><br>- Copy Markdown per table: reads <code>tablesMeta</code> ‚Üí converts to Markdown lines.<br>- Save HTML/export: reads innerHTML + fragments ‚Üí sends to backend or triggers local download.<br>- Preserves <code>&lt;br&gt;</code> and inline formatting.<br>- Uses debounced queue to avoid overwrites.<br>- Shows toast notifications for success/warnings/errors. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£2Ô∏è‚É£ Multi-Table & TOC Coordination</strong><br>- Wraps tables in <code>.table-wrap</code> for independent scroll/layout.<br>- TOC (<code>window.__tv_init_pttoc_from_core</code>) maps captions to table IDs.<br>- DOM observers attach to dynamically added tables to inject missing captions.<br>- Scroll coordination ensures smooth user experience. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Concurrency & Queue Management</strong><br>- Conversion requests serialized per client to avoid race conditions.<br>- Hydration queue ensures DOM ready before caption injection.<br>- Clipboard/export operations queued sequentially. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Security & Sanitization</strong><br>- Backend sanitization: <code>sanitize_caption_html</code>.<br>- Frontend sanitation: fragment content safe-encoded.<br>- Deterministic fragment/table IDs prevent injection collisions.<br>- All JSON payload safely encoded and injected via <code>&lt;script&gt;</code> tag. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£5Ô∏è‚É£ Save & Export Workflow</strong><br>- Backend: atomic writes via <code>core_io</code>.<br>- Frontend: <code>downloadBlob</code> fallback.<br>- Markdown export preserves multi-line cells, tables with captions.<br>- Table metadata ensures exported content matches rendered content. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£6Ô∏è‚É£ Retry & Resilience</strong><br>- DOM injection retries at 0ms, 60ms, 250ms, 600ms intervals.<br>- Hydration resilient to missing tables, delayed DOM, or partial payload failures.<br>- Scroll and toast notifications coordinated to prevent user confusion. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£7Ô∏è‚É£ Metadata Tracking</strong><br>- <code>tablesMeta</code>: <code>{table_id, row_count, caption_ids, source_group, injected_flag}</code>.<br>- <code>fragmentsMeta</code>: <code>{fragment_id, table_id, row_index, col_index, label, sanitized_html}</code>.<br>- Persistent across reloads to ensure consistent caption injection. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£8Ô∏è‚É£ Debug & Testing Hooks</strong><br>- CLI: supports batch conversion, offline preview.<br>- TV_DEBUG exposes tablesMeta, fragment IDs, hydration status.<br>- Toast notifications report success/warnings/errors.<br>- Useful for QA and developer inspection of fragment injection correctness. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>1Ô∏è‚É£9Ô∏è‚É£ Full End-to-End Flow Summary</strong><br>1. User clicks ‚Üí Client sends JSON payload.<br>2. <code>server.py</code> builds request context.<br>3. <code>io_utils.read_group()</code> reads files, computes checksums.<br>4. <code>convert.parse_*()</code> converts raw content to CaptionBlocks.<br>5. <code>sanitize.sanitize_caption_html()</code> cleans HTML.<br>6. <code>core_fragments.CaptionFragment.create()</code> creates fragments with stable IDs.<br>7. <code>core_table.ensure_table_id()</code> assigns table IDs.<br>8. <code>core_renderer.inject_captions()</code> injects caption metadata.<br>9. <code>html_renderer.render_html()</code> emits tables + <code>&lt;script data-caption-payload&gt;</code>.<br>10. <code>script.core.js</code> hydrates tables and injects captions.<br>11. Button actions (copy, save, export), TOC integration, scroll coordination, and multi-table handling operate using hydrated metadata.<br>12. Retry logic ensures robust DOM hydration and user feedback. </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>2Ô∏è‚É£0Ô∏è‚É£ Observations & Edge Cases</strong><br>- Handles missing <code>#paste</code> or empty text gracefully.<br>- Non-JSON server responses handled safely.<br>- Multiple rapid conversions serialized.<br>- Missing TOC or table fragments do not break rendering.<br>- Clipboard API fallback ensures older browser compatibility.<br>- Toast queue handles overlapping messages (min 900ms, max 8s). </td></tr><tr><td data-label="PasteToTable ‚Äî End-to-End Architecture &amp; Data Flow (Detailed)"> <strong>2Ô∏è‚É£1Ô∏è‚É£ Conclusion</strong><br>- PasteToTable‚Äôs architecture ensures deterministic table IDs, stable caption fragments, secure sanitization, robust client hydration, and seamless Markdown/HTML export.<br>- Designed for multi-table support, delayed DOM hydration, toast feedback, and smooth scroll integration.<br>- Fully resilient: failures in optional steps do not block core functionality.<br>- Ready for both interactive user actions and programmatic batch processing. </td></tr></tbody></table></div><div class="row-count">Rows: 21</div></div><div class="table-caption" id="Table5" data-table="Docu_0111_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî Internal Module Deep-Dive &amp; Function Breakdown (Batch 2)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî Internal Module Deep-Dive & Function Breakdown (Batch 2)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî Internal Module Deep-Dive &amp; Function Breakdown (Batch 2)"> <strong>1Ô∏è‚É£ main.py ‚Äî Entry Point & App Bootstrap</strong><br>- Initializes server and endpoints.<br>- Defines <code>/api/group</code> and <code>/api/convert</code>.<br>- Passes request to <code>server.py</code> handlers with structured <code>request_ctx</code>.<br>- Minimal logic: primarily orchestrates request flow, sets logging and debug flags. </td></tr><tr><td data-label="PasteToTable ‚Äî Internal Module Deep-Dive &amp; Function Breakdown (Batch 2)"> <strong>2Ô∏è‚É£ server.py ‚Äî API Request Handlers</strong><br>- Handlers: <code>load_group_handler(request_ctx)</code>, <code>convert_text_handler(request_ctx)</code>.<br>- Constructs <code>request_ctx</code> with: <code>{action, source, client_req_id, timestamp, group_id}</code>.<br>- Calls: <code>io_utils.read_group()</code> ‚Üí <code>convert.parse_*()</code> ‚Üí <code>sanitize.sanitize_caption_html()</code> ‚Üí <code>core_fragments.CaptionFragment.create()</code> ‚Üí <code>core_table.ensure_table_id()</code> ‚Üí <code>core_renderer.inject_captions()</code> ‚Üí <code>html_renderer.render_html()</code>.<br>- Returns JSON or HTML payload depending on request type.<br>- Defensive: ensures missing group, invalid payloads, or exceptions do not crash server. </td></tr><tr><td data-label="PasteToTable ‚Äî Internal Module Deep-Dive &amp; Function Breakdown (Batch 2)"> <strong>3Ô∏è‚É£ html_renderer.py ‚Äî HTML Rendering & Payload Emission</strong><br>- <code>render_html(tables, fragments, request_ctx)</code>:<br>  ‚Ä¢ Converts server-side table + fragment data to final HTML string.<br>  ‚Ä¢ Injects <code>&lt;script data-caption-payload&gt;</code> if <code>meta.injected == true</code>.<br>  ‚Ä¢ Uses <code>json.dumps()</code> + escape sequences to prevent XSS.<br>  ‚Ä¢ Ensures table DOM structure aligns with <code>script.core.js</code> hydration expectations. </td></tr></tbody></table></div><div class="row-count">Rows: 3</div></div><div class="table-caption" id="Table6" data-table="Docu_0111_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations**&lt;br&gt;-  CODE0  ensures complete write or rollback.&lt;br&gt;-  CODE1  provides ephemeral workspace for conversions.&lt;br&gt;- Used in group save/load to prevent partial content corruption."><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations</strong><br>-  CODE0  ensures complete write or rollback.<br>-  CODE1  provides ephemeral workspace for conversions.<br>- Used in group save/load to prevent partial content corruption.</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>üîü core_assets.py ‚Äî Asset Discovery & Embedding</strong><br>- Scans <code>assets/</code> folder.<br>- Embeds CSS/JS inline for preview if requested.<br>- Supports deterministic versioning for caching via <code>sri_attr</code>. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>1Ô∏è‚É£1Ô∏è‚É£ core_utils.py ‚Äî Misc Helpers</strong><br>- <code>sanitize_filename(name)</code> ‚Äî safe cross-platform filename.<br>- <code>stream_read(generator)</code> ‚Äî supports large tables without full memory load.<br>- <code>sri_attr(url)</code> ‚Äî computes Subresource Integrity hash for embedded assets. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>1Ô∏è‚É£2Ô∏è‚É£ io_utils.py ‚Äî Group I/O</strong><br>- <code>read_group(group_id)</code> ‚Üí reads all files, computes checksums, returns <code>{file_path, content, checksum}</code>.<br>- Supports atomic batch read. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>1Ô∏è‚É£3Ô∏è‚É£ markdown.py ‚Äî Markdown Conversion</strong><br>- <code>table_to_markdown_lines(table_html, captions_meta)</code><br>- Converts sanitized HTML tables + fragment captions ‚Üí Markdown array.<br>- Preserves multi-line cells with <code>&lt;br&gt;</code> ‚Üí <code>\\n</code>. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>1Ô∏è‚É£4Ô∏è‚É£ assets.py ‚Äî Asset Utilities</strong><br>- <code>embed_js(js_path)</code> inline scripts.<br>- <code>embed_css(css_path)</code> inline styles.<br>- Used by <code>html_renderer</code> to generate self-contained preview HTML. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>1Ô∏è‚É£5Ô∏è‚É£ cli.py ‚Äî Command-Line Interface</strong><br>- <code>ptt convert --input file --output folder</code><br>- Batch conversion of saved tables.<br>- Supports debug flags and offline rendering. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>1Ô∏è‚É£6Ô∏è‚É£ types.py ‚Äî Shared Data Types</strong><br>- <code>CaptionBlock</code>, <code>Fragment</code>, <code>TableMeta</code> types.<br>- Ensures typing consistency between parse, sanitize, fragment, and render stages.<br>- Used for both runtime and server-side validation. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>1Ô∏è‚É£7Ô∏è‚É£ Integration Flow Examples</strong><br>- <strong>Load Group Example:</strong><br>  1. Client sends <code>{action:&quot;load_group&quot;, group_id:&quot;g123&quot;}</code>.<br>  2. Server builds <code>request_ctx</code>.<br>  3. <code>io_utils.read_group()</code> reads HTML.<br>  4. <code>convert.parse_html_table()</code> ‚Üí CaptionBlocks.<br>  5. <code>sanitize.sanitize_caption_html()</code> cleans content.<br>  6. <code>CaptionFragment.create()</code> ‚Üí fragments.<br>  7. <code>ensure_table_id()</code> assigns table IDs.<br>  8. <code>inject_captions()</code> attaches payload.<br>  9. <code>render_html()</code> emits HTML + <code>&lt;script data-caption-payload&gt;</code>.<br>  10. <code>script.core.js</code> hydrates tables, inserts <code>&lt;caption&gt;</code>, updates <code>tablesMeta</code>. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>1Ô∏è‚É£8Ô∏è‚É£ Defensive Design & Observations</strong><br>- All stages wrapped in try/catch.<br>- Missing group or invalid table handled gracefully.<br>- Multiple tables handled with independent hydration.<br>- Frontend uses <code>tablesMeta</code> and <code>fragmentsMeta</code> to reliably map tables to captions.<br>- Sanitization ensures no XSS from user-pasted HTML.<br>- Atomic write/read prevents corrupted data.<br>- Stable IDs ensure persistent caption injection across reloads. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>1Ô∏è‚É£9Ô∏è‚É£ Batch Conversion & Testing</strong><br>- CLI + server APIs allow batch conversion.<br>- QA can inspect <code>tablesMeta</code> and <code>fragmentsMeta</code> JSON payloads.<br>- Payload can be replayed offline with <code>script.core.js</code> hydration for preview. </td></tr><tr><td data-label="9Ô∏è‚É£ core_io.py ‚Äî Atomic File Operations-  CODE0  ensures complete write or rollback.-  CODE1  provides ephemeral workspace for conversions.- Used in group save/load to prevent partial content corruption."> <strong>2Ô∏è‚É£0Ô∏è‚É£ Summary</strong><br>- Internal modules work in strict sequence: parse ‚Üí sanitize ‚Üí fragment ‚Üí table_id ‚Üí inject ‚Üí render.<br>- Data flows through typed structures with stable IDs and metadata flags.<br>- Server emits hydrated HTML with JSON payloads.<br>- Client consumes payload, hydrates tables, injects captions, supports Markdown/export.<br>- Architecture fully resilient to missing DOM elements, delayed hydration, rapid conversions, and multi-table operations.<br>- Ready for integration with dynamic web pages, batch CLI conversions, and offline rendering. </td></tr></tbody></table></div><div class="row-count">Rows: 11</div></div><div class="table-caption" id="Table7" data-table="Docu_0111_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PasteToTable ‚Äî Client Assets & Template Deep-Dive (Batch 3)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>1Ô∏è‚É£ script.core.js ‚Äî Core Client-Side Engine</strong><br>- <strong>Purpose:</strong> Central orchestrator for PasteToTable client.<br>- Handles: clipboard, download, toast, debounce, conversion, hydration of <code>&lt;table&gt;</code> and <code>&lt;caption&gt;</code>, DOM observation, and optional extras.<br>- <strong>Key Globals:</strong><br>  ‚Ä¢ <code>window.PTT</code> ‚Äî main API for injectCaptions(), routeHtmlToAreas(), processRenderedHtml().<br>  ‚Ä¢ <code>__ptt_skip_scroll</code> ‚Äî prevents automatic scroll conflicts.<br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>injectCaptions(payload)</code> ‚Äî hydrates tables with <code>tablesMeta</code> and <code>fragmentsMeta</code> from server.<br>  ‚Ä¢ <code>routeHtmlToAreas(html)</code> ‚Äî places converted HTML in #tables-viewer.<br>  ‚Ä¢ <code>processRenderedHtml(response)</code> ‚Äî wrapper to handle different server response formats.<br>  ‚Ä¢ <code>showToast(msg, opts)</code> ‚Äî notification system with queue and deduplication.<br>  ‚Ä¢ <code>copyToClipboard(text)</code> ‚Äî handles modern and legacy fallback.<br>- <strong>Event Handling:</strong><br>  ‚Ä¢ Listens to custom events for conversion completion.<br>  ‚Ä¢ Safe retries for DOM not ready.<br>- <strong>Integration:</strong><br>  ‚Ä¢ Reads <code>&lt;script data-caption-payload&gt;</code> emitted by server.<br>  ‚Ä¢ Maps <code>table_id</code> ‚Üî <code>&lt;table&gt;</code> for stable caption injection.<br>  ‚Ä¢ Debounced hydration ensures multi-table batch safety. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>2Ô∏è‚É£ script.table.js ‚Äî Table Interaction & Actions</strong><br>- <strong>Purpose:</strong> Table-specific user interaction: copy markdown, export, select rows, highlight.<br>- <strong>Key Functions:</strong><br>  ‚Ä¢ <code>copyMarkdown(tableId)</code> ‚Äî converts table to Markdown preserving <code>&lt;br&gt;</code>.<br>  ‚Ä¢ <code>highlightRows(rows)</code> ‚Äî temporary CSS highlight for user feedback.<br>  ‚Ä¢ <code>exportTableAsHtml(tableId)</code> ‚Äî saves standalone HTML.<br>  ‚Ä¢ <code>attachTableButtons()</code> ‚Äî sets up per-table copy/export buttons.<br>- <strong>Event Delegation:</strong><br>  ‚Ä¢ Uses delegated <code>click</code> listeners for dynamic tables.<br>  ‚Ä¢ Supports rapid addition/removal of tables in #tables-viewer.<br>- <strong>Notes:</strong> Ensures any pasted multi-line content is preserved. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>3Ô∏è‚É£ script.list.js ‚Äî Group Load & Queue</strong><br>- <strong>Purpose:</strong> Manage group list UI and load events.<br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>loadGroup(groupId)</code> ‚Äî triggers <code>/api/group</code> ‚Üí server ‚Üí HTML + caption payload.<br>  ‚Ä¢ <code>queueLoad(groupId)</code> ‚Äî prevents multiple concurrent group loads.<br>  ‚Ä¢ <code>updateGroupUI(groupId, status)</code> ‚Äî visual feedback in sidebar.<br>- <strong>Integration:</strong> Works tightly with <code>server.py</code> load_group workflow. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>4Ô∏è‚É£ script.save.js ‚Äî Save & Export</strong><br>- <strong>Purpose:</strong> Client-side saving of HTML, Markdown, or JSON payloads.<br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>saveHtml(tableId)</code> ‚Äî triggers Blob download.<br>  ‚Ä¢ <code>saveMarkdown(tableId)</code> ‚Äî converts via <code>tableToMarkdownLines</code>.<br>  ‚Ä¢ <code>saveAllGroups()</code> ‚Äî batch save with toast feedback.<br>- <strong>Defensive:</strong> Handles missing or partially loaded tables gracefully. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>5Ô∏è‚É£ script.toc.js ‚Äî Table of Contents (TOC) Handling</strong><br>- <strong>Purpose:</strong> Build & update TOC for PasteToTable tables.<br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>initPTToc(containerSelector)</code> ‚Äî sets up DOM observer on #tables-viewer.<br>  ‚Ä¢ <code>updateTocForTable(tableId)</code> ‚Äî adds/removes TOC entries dynamically.<br>  ‚Ä¢ <code>scrollToTable(tableId)</code> ‚Äî smooth scroll with debounced animation.<br>- <strong>Integration:</strong> Works with <code>script.core.js</code> hydration and dynamic caption injection. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>6Ô∏è‚É£ utils.js ‚Äî Shared Client Utilities</strong><br>- <strong>Functions:</strong><br>  ‚Ä¢ <code>debounce(fn, wait)</code> ‚Äî standard debounce for repeated events.<br>  ‚Ä¢ <code>sanitizeFileName(name)</code> ‚Äî safe filenames for download.<br>  ‚Ä¢ <code>once(fn)</code> ‚Äî ensures a function is executed once.<br>  ‚Ä¢ <code>joinUrl(base, path)</code> ‚Äî safe URL concatenation.<br>- <strong>Notes:</strong> Used across core and table scripts for consistent utility. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>7Ô∏è‚É£ extra.js ‚Äî Optional Enhancements Loader</strong><br>- <strong>Purpose:</strong> Dynamically load optional client features.<br>- <strong>Behavior:</strong><br>  ‚Ä¢ <code>loadExtraSequentially(candidates)</code> ‚Äî loads JS files sequentially.<br>  ‚Ä¢ Retries up to N times per candidate.<br>  ‚Ä¢ Skips already loaded scripts to avoid duplication. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>8Ô∏è‚É£ worker.js ‚Äî Future Client-Side Worker</strong><br>- <strong>Purpose:</strong> Reserved for async/parallel table processing.<br>- <strong>Structure:</strong><br>  ‚Ä¢ Event listener <code>onmessage</code> handles table data chunk processing.<br>  ‚Ä¢ Returns <code>{tableId, fragmentIds, sanitizedHTML}</code>.<br>- <strong>Current:</strong> Not actively used; placeholder for potential future performance optimization. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>9Ô∏è‚É£ overrides.css ‚Äî Custom CSS Adjustments</strong><br>- <strong>Purpose:</strong> PTT-specific visual overrides.<br>- Hides native markdown export buttons initially.<br>- Adds responsive flex for table containers.<br>- Smooth hover effects for rows and caption buttons. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>üîü style.css ‚Äî Core Styling</strong><br>- Locked, byte-identical to Table Viewer 2.1.<br>- Provides all baseline typography, table layout, captions, flex layout, buttons.<br>- Used in combination with <code>overrides.css</code> for small tweaks. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>1Ô∏è‚É£1Ô∏è‚É£ templates/index.html ‚Äî HTML Skeleton</strong><br>- <strong>Structure:</strong><br>  ‚Ä¢ <code>&lt;head&gt;</code>: loads CSS, sets metadata.<br>  ‚Ä¢ <code>&lt;body&gt;</code>: <code>#paste</code> textarea, <code>#tables-viewer</code>, <code>#status</code>, sidebar for groups.<br>  ‚Ä¢ Includes <code>&lt;script&gt;</code> tags for core and table JS.<br>- <strong>Integration:</strong><br>  ‚Ä¢ Expects server to inject <code>&lt;script data-caption-payload&gt;</code> during group load.<br>  ‚Ä¢ Client JS reads payload, hydrates tables, attaches captions, updates TOC.<br>- <strong>Notes:</strong> Fully defensive: missing or delayed elements do not break workflow. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>1Ô∏è‚É£2Ô∏è‚É£ Client Flow Summary</strong><br>- User pastes text ‚Üí <code>script.core.js</code> detects ‚Üí optional conversion ‚Üí sends to server <code>/api/convert</code>.<br>- Server converts, sanitizes, fragments, assigns IDs, injects <code>&lt;script data-caption-payload&gt;</code> ‚Üí returns HTML.<br>- <code>script.core.js</code> reads payload ‚Üí injectCaptions() ‚Üí updates tables + captions.<br>- <code>script.table.js</code> attaches buttons ‚Üí copy/export/markdown.<br>- <code>script.toc.js</code> observes tables ‚Üí updates TOC.<br>- <code>script.save.js</code> handles local export.<br>- Optional extras (<code>extra.js</code>) loaded sequentially for enhanced functionality.<br>- Toast notifications provide feedback at every stage. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Defensive & Edge Case Design</strong><br>- All client scripts wrapped with try/catch for missing DOM or failed server response.<br>- Payload mapping ensures table_id ‚Üî <code>&lt;table&gt;</code> even on reload.<br>- Multi-table paste supported; hydration is idempotent.<br>- Debounced conversion and event handling prevents duplicate inserts.<br>- Clipboard fallback ensures cross-browser support.<br>- Toast queue ensures no message loss and proper sequencing. </td></tr><tr><td data-label="PasteToTable ‚Äî Client Assets &amp; Template Deep-Dive (Batch 3)"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Summary</strong><br>- Client assets form a tightly integrated system: core orchestrator (<code>script.core.js</code>), table interactions (<code>script.table.js</code>), group loading (<code>script.list.js</code>), TOC (<code>script.toc.js</code>), save/export (<code>script.save.js</code>), optional enhancements (<code>extra.js</code>), and future parallelization (<code>worker.js</code>).<br>- Works seamlessly with backend caption payload, stable IDs, and fragment hydration.<br>- Fully defensive and designed for rapid paste, multi-table support, Markdown export, and dynamic DOM updates.<br>- Combines CSS (<code>style.css</code>, <code>overrides.css</code>) and template (<code>index.html</code>) to deliver a reliable PasteToTable user experience. </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><div class="table-caption" id="Table8" data-table="Docu_0111_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>PasteToTable ‚Äî Extended Super Detailed Workflow Overview</strong><br><br><strong>1Ô∏è‚É£ User Interaction Layer</strong><br>‚îú‚îÄ <strong>Direct Paste:</strong> Users paste text directly into <code>#paste</code> textarea; immediate validation ensures non-empty content.<br>‚îú‚îÄ <strong>Load Group:</strong> Users select a group from <code>groups.json</code> using <code>script.list.js</code>; the client prepares <code>group_id</code> and <code>client_req_id</code> for server fetch.<br>‚îú‚îÄ <strong>Event Handling:</strong> <code>script.core.js</code> attaches debounced event listeners for paste, click, and keyboard shortcuts; prevents duplicate processing.<br>‚îú‚îÄ <strong>Pre-flight Validation:</strong> Checks for empty text, malformed content, or missing group selection; displays immediate toast warnings.<br>‚îú‚îÄ <strong>Feedback:</strong> Initial toast "Processing tables‚Ä¶" is displayed with duration scaled by text length.<br>‚îî‚îÄ <strong>Routing:</strong> Determines whether conversion is client-side simple render or requires server-side processing (caption injection, parsing, multi-table handling).<br><br><strong>2Ô∏è‚É£ Client-Side Core (<code>script.core.js</code>)</strong><br>‚îú‚îÄ <strong>Configuration:</strong> Default settings include highlight: true, debounceMs: 150, chunkSize: 300; debug flag <code>TV_DEBUG</code> derived from <code>window.tvDebug</code>.<br>‚îú‚îÄ <strong>Base URL Detection:</strong> Uses <code>detectScriptBase()</code> to determine script and asset paths, supporting <code>document.currentScript</code>, <code>/assets/script.core.js</code>, or fallback to <code>location.origin</code>.<br>‚îú‚îÄ <strong>Payload Preparation:</strong> Collects <code>text</code>, <code>group_id</code>, <code>client_req_id</code>, timestamps, user flags; ensures safe JSON encoding.<br>‚îú‚îÄ <strong>Conversion Queue:</strong> Debounced, prevents concurrent conversions; provides toast feedback for long-running operations.<br>‚îú‚îÄ <strong>Server Communication:</strong> Sends JSON or URL-encoded POST to <code>/api/convert</code> or <code>/api/group</code>; handles errors gracefully, displays warning or error toasts.<br>‚îú‚îÄ <strong>Client-Side Optimization:</strong> Small/simple tables may be rendered directly without server round-trip; large or grouped tables always use server-side parsing for consistency and caption injection.<br>‚îî‚îÄ <strong>Optional Extras:</strong> Sequential loading of <code>extra.js</code> handled via <code>loadExtraSequentially()</code>, retries on failure, ensures UI enhancements attach only once.<br><br><strong>3Ô∏è‚É£ Server-Side Handling (<code>server.py</code>)</strong><br>‚îú‚îÄ <strong>Request Context:</strong> <code>request_ctx</code> built with <code>action</code>, <code>source</code>, <code>client_req_id</code> for traceability.<br>‚îú‚îÄ <strong>Group Reading:</strong> Uses <code>io_utils.read_group()</code> to read relevant files, compute checksums, and optionally cache content.<br>‚îú‚îÄ <strong>Parsing & Conversion:</strong> <code>convert.parse_*()</code> produces <code>CaptionBlocks</code> with preliminary metadata including table structure, row counts, and initial captions.<br>‚îú‚îÄ <strong>Sanitization:</strong> <code>sanitize.sanitize_caption_html()</code> ensures HTML safety, prevents XSS, sets <code>meta.sanitized=true</code>.<br>‚îú‚îÄ <strong>Fragment Creation:</strong> <code>core_fragments.CaptionFragment.create()</code> generates stable fragment IDs; ensures deterministic mapping for table ‚Üî caption.<br>‚îú‚îÄ <strong>Table ID Assignment:</strong> <code>core_table.ensure_table_id()</code> guarantees each table has unique <code>table_id</code> and captures row counts for metadata; necessary for multi-table exports and consistent hydration.<br>‚îú‚îÄ <strong>Caption Injection:</strong> <code>core_renderer.inject_captions()</code> runs only for <code>request_ctx.action==&quot;load_group&quot;</code>:<br>‚îÇ  ‚îú‚îÄ Updates <code>table_meta</code> with fragment IDs.<br>‚îÇ  ‚îî‚îÄ Marks <code>fragments.meta.injected=true</code> for downstream processing.<br>‚îî‚îÄ <strong>HTML Rendering:</strong> <code>html_renderer.render_html()</code> outputs final HTML:<br>   ‚îú‚îÄ If captions injected: emits <code>&lt;script data-caption-payload&gt;</code> with serialized metadata for hydration.<br>   ‚îî‚îÄ If no captions: returns sanitized HTML without payload, preventing unnecessary client hydration.<br><br><strong>4Ô∏è‚É£ Client-Side Hydration & Table Interaction</strong><br>‚îú‚îÄ <strong>Hydration:</strong> <code>window.PTT.injectCaptions()</code> maps caption fragments to respective table cells.<br>‚îú‚îÄ <strong>Interactive Buttons (<code>script.table.js</code>):</strong><br>‚îÇ  ‚îú‚îÄ Copy Markdown (preserves <code>&lt;br&gt;</code>, inline HTML, and table structure).<br>‚îÇ  ‚îú‚îÄ Save HTML/JSON/Markdown with server fallback.<br>‚îÇ  ‚îú‚îÄ Highlight / unhighlight cells with CSS toggle.<br>‚îÇ  ‚îî‚îÄ Export all tables sequentially.<br>‚îú‚îÄ <strong>TOC Updates (<code>script.toc.js</code>):</strong> Observes <code>#tables-viewer</code>, updates dynamic Table of Contents, supports nested sections and live refresh.<br>‚îú‚îÄ <strong>Save Handlers (<code>script.save.js</code>):</strong> Supports server save, local download, toast notifications on success/failure.<br>‚îú‚îÄ <strong>Sequential Extras:</strong> Ensures <code>extra.js</code> scripts attach enhancements once per session.<br>‚îú‚îÄ <strong>Worker Integration:</strong> Placeholder <code>worker.js</code> allows future asynchronous parallel table processing for large datasets.<br>‚îî‚îÄ <strong>Scroll & Focus Management:</strong> Maintains user viewport stability during injections and table hydration.<br><br><strong>5Ô∏è‚É£ Data Transformation & Flow</strong><br>1. User input captured ‚Üí client debounced ‚Üí prepares payload.<br>2. Server reads/parses/sanitizes ‚Üí generates caption fragments ‚Üí ensures table IDs ‚Üí injects captions ‚Üí renders HTML + payload.<br>3. Client receives HTML ‚Üí <code>injectCaptions()</code> hydrates tables ‚Üí attaches TOC, interactive buttons, and optional extras.<br>4. Clipboard copy, save, or batch export triggered via table buttons.<br>5. Toast notifications provide continuous feedback: processing, success, warning, error.<br>6. Optional retry mechanisms for DOM not ready, network failures, or partial table failures.<br><br><strong>6Ô∏è‚É£ Defensive Architecture</strong><br>‚Ä¢ <strong>DOM Safety:</strong> All manipulations wrapped in try/catch; retry loops for delayed elements.<br>‚Ä¢ <strong>Event Debouncing:</strong> Prevents concurrent conversions or double-click issues.<br>‚Ä¢ <strong>Multi-Table Support:</strong> Idempotent hydration ensures consistent IDs and caption mapping.<br>‚Ä¢ <strong>Clipboard Fallback:</strong> Uses <code>tryLegacyCopy()</code> for older browser support.<br>‚Ä¢ <strong>Toast Queue:</strong> Sequential handling with auto-duration based on message length; deduplication by key.<br>‚Ä¢ <strong>CSS Overrides:</strong> Ensures PasteToTable styling consistent with Tables Viewer 2.1; prevents flicker, layout shift.<br>‚Ä¢ <strong>Payload Safety:</strong> Serialized metadata escapes HTML entities, preventing XSS.<br>‚Ä¢ <strong>Deterministic IDs:</strong> Server ensures stable table and fragment IDs for repeatable exports.<br>‚Ä¢ <strong>Markdown Export:</strong> Supports multi-table, multi-row, multi-line <code>&lt;br&gt;</code> preservation.<br>‚Ä¢ <strong>Error Resilience:</strong> Optional extras, TOC, and worker scripts fail silently without blocking core logic.<br><br><strong>7Ô∏è‚É£ Observations & Edge Cases</strong><br>‚Ä¢ Handles missing <code>#paste</code> or empty text with graceful toast warning.<br>‚Ä¢ Non-JSON or malformed server response handled with fallback toast and safe HTML rendering.<br>‚Ä¢ Multiple rapid conversions queued and serialized to prevent race conditions.<br>‚Ä¢ Missing TOC or optional extras do not break main workflow.<br>‚Ä¢ Clipboard API fallback ensures wide browser compatibility.<br>‚Ä¢ Scroll and viewport coordination prevents user jank or visual disruption.<br>‚Ä¢ Stable IDs allow table hydration even if server content changes slightly.<br>‚Ä¢ Extensive logging controlled via debug flags; avoids console spam in production.<br><br><strong>8Ô∏è‚É£ Super Note:</strong><br>This end-to-end workflow ensures robust, deterministic handling from user paste or group load, through server-side caption injection, to interactive table hydration and export. All operations are designed for resilience, UX consistency, secure HTML handling, deterministic metadata, and future extensibility (workers, async processing, enhanced exports). PasteToTable is architected for maximal reliability, seamless multi-table handling, and tight integration with Tables Viewer 2.1, ensuring users can copy, save, or export tables confidently without data loss or broken formatting.</td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table9" data-table="Docu_0111_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>PasteToTable ‚Äî Extended Super Detailed Workflow Overview (Batch 2)</strong><br><br><strong>9Ô∏è‚É£ Server-Side Utility Modules</strong><br>‚îú‚îÄ <strong><code>render/core_io.py</code></strong><br>‚îÇ  ‚îú‚îÄ Provides atomic write operations to ensure file integrity.<br>‚îÇ  ‚îú‚îÄ Temporary directories creation (<code>tmp_dir</code>) for intermediate table processing.<br>‚îÇ  ‚îú‚îÄ Path validation utilities prevent directory traversal or invalid writes.<br>‚îÇ  ‚îî‚îÄ Ensures safe cleanup of temporary resources.<br>‚îú‚îÄ <strong><code>render/core_utils.py</code></strong><br>‚îÇ  ‚îú‚îÄ Sanitization helpers for HTML, CSS, and text content.<br>‚îÇ  ‚îú‚îÄ Streaming helpers allow partial content flush for large tables.<br>‚îÇ  ‚îú‚îÄ SRI (<code>subresource integrity</code>) attribute generators for safe asset embedding.<br>‚îÇ  ‚îî‚îÄ Miscellaneous helper functions for consistent internal data processing.<br>‚îú‚îÄ <strong><code>render/core_assets.py</code></strong><br>‚îÇ  ‚îú‚îÄ Discovers assets (CSS, JS) required for table rendering.<br>‚îÇ  ‚îú‚îÄ Embeds assets inline when necessary to minimize HTTP requests.<br>‚îÇ  ‚îú‚îÄ Ensures proper copying of static resources to <code>saved_tables</code> or temporary directories.<br>‚îÇ  ‚îî‚îÄ Resolves paths dynamically based on environment (dev/prod).<br>‚îú‚îÄ <strong><code>render/core_table.py</code></strong><br>‚îÇ  ‚îú‚îÄ <code>render_table()</code> wrapper centralizes table rendering logic.<br>‚îÇ  ‚îú‚îÄ Ensures table metadata consistency (row/column counts, IDs).<br>‚îÇ  ‚îú‚îÄ Provides hooks for caption injection and styling.<br>‚îÇ  ‚îî‚îÄ Handles table-level CSS class management for PasteToTable vs Tables Viewer 2.1 parity.<br>‚îú‚îÄ <strong><code>render/core_renderer.py</code></strong><br>‚îÇ  ‚îú‚îÄ Central caption injection logic: <code>inject_captions()</code> verifies <code>request_ctx.action</code> before processing.<br>‚îÇ  ‚îú‚îÄ Updates table metadata with caption fragment IDs.<br>‚îÇ  ‚îú‚îÄ Marks <code>fragments.meta.injected=true</code> for downstream HTML rendering.<br>‚îÇ  ‚îî‚îÄ Designed to be idempotent, safe to rerun without corrupting table structure.<br>‚îú‚îÄ <strong><code>render/core_fragments.py</code></strong><br>‚îÇ  ‚îú‚îÄ <code>CaptionFragment.create()</code> ensures stable deterministic fragment IDs.<br>‚îÇ  ‚îú‚îÄ Supports multi-line captions and preserves HTML <code>&lt;br&gt;</code> breaks.<br>‚îÇ  ‚îú‚îÄ Maintains mapping table_id ‚Üî fragment_id ‚Üî caption content.<br>‚îÇ  ‚îî‚îÄ Provides fragment metadata (<code>injected</code>, <code>sanitized</code>) for client-side hydration.<br>‚îú‚îÄ <strong><code>render/convert.py</code></strong><br>‚îÇ  ‚îú‚îÄ Parsing logic for multi-table input, both plain text and structured Markdown/HTML.<br>‚îÇ  ‚îú‚îÄ Produces <code>CaptionBlocks</code> and intermediate metadata.<br>‚îÇ  ‚îú‚îÄ Integrates tightly with sanitization and fragment generation.<br>‚îÇ  ‚îî‚îÄ Handles edge cases: empty rows, inconsistent columns, malformed HTML.<br>‚îú‚îÄ <strong><code>render/sanitize.py</code></strong><br>‚îÇ  ‚îú‚îÄ Core HTML sanitization pipeline to prevent XSS.<br>‚îÇ  ‚îú‚îÄ Converts unsafe attributes, strips scripts, normalizes whitespace.<br>‚îÇ  ‚îî‚îÄ Optionally adds safe <code>&lt;br&gt;</code> preservation for multi-line captions.<br>‚îú‚îÄ <strong><code>render/io_utils.py</code></strong><br>‚îÇ  ‚îú‚îÄ File reading/writing helpers for group data and temporary conversion artifacts.<br>‚îÇ  ‚îú‚îÄ Computes checksums for content validation.<br>‚îÇ  ‚îî‚îÄ Supports both JSON and raw text payloads safely.<br>‚îú‚îÄ <strong><code>render/assets.py</code></strong><br>‚îÇ  ‚îú‚îÄ Central asset registry for JS/CSS injection.<br>‚îÇ  ‚îú‚îÄ Resolves dependencies and ensures no duplicate injection.<br>‚îÇ  ‚îî‚îÄ Works with both inline embedding and file-based references.<br>‚îú‚îÄ <strong><code>render/markdown.py</code></strong><br>‚îÇ  ‚îú‚îÄ Converts table HTML/CaptionBlocks into Markdown lines.<br>‚îÇ  ‚îú‚îÄ Handles <code>&lt;br&gt;</code> in cells, multi-line captions, and inline HTML.<br>‚îÇ  ‚îî‚îÄ Supports consistent export format for client-side copy or server save.<br>‚îú‚îÄ <strong><code>render/types.py</code></strong><br>‚îÇ  ‚îú‚îÄ Type definitions for tables, captions, fragments, and request contexts.<br>‚îÇ  ‚îî‚îÄ Ensures static-type safety and predictable property access across modules.<br>‚îú‚îÄ <strong><code>render/cli.py</code></strong><br>‚îÇ  ‚îú‚îÄ Optional command-line interface for testing conversion and rendering.<br>‚îÇ  ‚îú‚îÄ Supports local file input, output to saved_tables, preview HTML.<br>‚îÇ  ‚îî‚îÄ Primarily a developer tool; integrates with the same parsing and injection pipeline as server.py.<br><br><strong>üîß Client-Side Modules & Assets</strong><br>‚îú‚îÄ <strong><code>assets/script.table.js</code></strong><br>‚îÇ  ‚îú‚îÄ Handles table-specific UI: copy, save, highlight, export all.<br>‚îÇ  ‚îú‚îÄ Hydrates tables with injected captions via <code>window.PTT.injectCaptions()</code>.<br>‚îÇ  ‚îú‚îÄ Preserves <code>&lt;br&gt;</code> and inline formatting during Markdown copy.<br>‚îÇ  ‚îú‚îÄ Integrates toast feedback for operations.<br>‚îÇ  ‚îî‚îÄ Defensive: checks DOM availability before attachment.<br>‚îú‚îÄ <strong><code>assets/script.list.js</code></strong><br>‚îÇ  ‚îú‚îÄ Handles group list rendering, selection, and fetch initiation.<br>‚îÇ  ‚îú‚îÄ Prepares payload (<code>group_id</code>, <code>client_req_id</code>) for server.<br>‚îÇ  ‚îî‚îÄ Debounced click handlers to prevent multiple simultaneous group loads.<br>‚îú‚îÄ <strong><code>assets/script.core.js</code></strong><br>‚îÇ  ‚îú‚îÄ Core orchestration for conversion pipeline: paste ‚Üí prepare ‚Üí fetch ‚Üí render.<br>‚îÇ  ‚îú‚îÄ Toast system, debounce, clipboard helpers, download support.<br>‚îÇ  ‚îú‚îÄ Optional extra.js loader, TOC integration.<br>‚îÇ  ‚îî‚îÄ Ensures multi-table handling and consistent user feedback.<br>‚îú‚îÄ <strong><code>assets/script.toc.js</code></strong><br>‚îÇ  ‚îú‚îÄ Table of Contents generation and mutation observer for dynamic updates.<br>‚îÇ  ‚îî‚îÄ Integrates with PasteToTable API for TOC re-rendering.<br>‚îú‚îÄ <strong><code>assets/script.save.js</code></strong><br>‚îÇ  ‚îú‚îÄ Handles server-side save via fetch API.<br>‚îÇ  ‚îú‚îÄ Fallback local download for unsupported environments.<br>‚îÇ  ‚îî‚îÄ Toast feedback for success, warning, error.<br>‚îú‚îÄ <strong><code>assets/worker.js</code></strong><br>‚îÇ  ‚îú‚îÄ Placeholder for future async worker support.<br>‚îÇ  ‚îî‚îÄ Could offload heavy table processing or Markdown generation.<br>‚îú‚îÄ <strong><code>assets/overrides.css</code> & <code>style.css</code></strong><br>‚îÇ  ‚îú‚îÄ Ensures visual parity with Tables Viewer 2.1.<br>‚îÇ  ‚îú‚îÄ Overrides default browser table styles, ensures responsive layouts.<br>‚îÇ  ‚îî‚îÄ Early hide export buttons to prevent flash of unstyled elements.<br>‚îú‚îÄ <strong><code>assets/extra.js</code> & <code>utils.js</code></strong><br>‚îÇ  ‚îú‚îÄ Optional enhancements and helper utilities.<br>‚îÇ  ‚îú‚îÄ Extra DOM helpers, dynamic features.<br>‚îÇ  ‚îî‚îÄ Loaded sequentially to prevent conflicts.<br>‚îú‚îÄ <strong><code>groups.json</code> & <code>labels.json</code></strong><br>‚îÇ  ‚îú‚îÄ Group definitions for Load Group feature.<br>‚îÇ  ‚îî‚îÄ Label metadata for consistent UI naming and sorting.<br><br><strong>üîπ Templates</strong><br>‚îî‚îÄ <strong><code>templates/index.html</code></strong><br>   ‚îú‚îÄ Main entry point; contains <code>&lt;textarea id=&quot;paste&quot;&gt;</code>, <code>&lt;div id=&quot;tables-viewer&quot;&gt;</code>, buttons, and placeholders.<br>   ‚îú‚îÄ Scripts included in order: core ‚Üí table ‚Üí list ‚Üí TOC ‚Üí save ‚Üí extras.<br>   ‚îú‚îÄ CSS injected early to prevent FOUC (Flash of Unstyled Content).<br>   ‚îî‚îÄ Fully supports deferred hydration and dynamic table rendering.<br><br><strong>üîπ Notes & Observations</strong><br>‚Ä¢ Entire system designed for resilience, security, and deterministic behavior.<br>‚Ä¢ Caption IDs, table IDs, fragment metadata ensure consistent multi-table export and hydration.<br>‚Ä¢ Server-side sanitization prevents XSS; client-side sanitization complements it.<br>‚Ä¢ Clipboard, download, toast, TOC, and export operations are fully defensive.<br>‚Ä¢ Multi-layer debouncing and event throttling prevent concurrent operation issues.<br>‚Ä¢ Extensible architecture supports workers, async processing, and future UI enhancements.<br>‚Ä¢ PasteToTable tightly integrated with Tables Viewer 2.1 style, DOM structure, and typography.<br>‚Ä¢ Designed for professional-grade UX: instant feedback, reliable export, multi-table handling, and safe HTML/Markdown preservation.<br>‚Ä¢ All assets, scripts, and modules are modular, maintainable, and safe for iterative development.<br><br><strong>üîπ Super Note:</strong><br>This batch completes the coverage of all server-side utility modules, client-side assets, and template integration. Combined with Batch 1, it represents a comprehensive, deterministic, resilient, and extensible architecture for PasteToTable. The workflow ensures that pasted text or loaded groups are converted into 2-column tables with correct captions, consistent IDs, safe HTML, proper TOC integration, optional extras, robust toast feedback, and full export capabilities. Future enhancements such as async processing, workers, or extended export formats can be integrated seamlessly without disrupting existing deterministic flows. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table10" data-table="Docu_0111_10" style="margin-top:2mm;margin-left:3mm;"><strong>Table 10</strong></div>
<div class="table-wrapper" data-table-id="table-10"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>PasteToTable Project Full Workflow</strong> </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ User Interaction Layer</strong> </td></tr><tr><td data-label="Diagram"> - <strong>Main entry points:</strong> User clicks buttons in the front-end interface (DOM): Convert, Load Group, Clear, Save, Export. </td></tr><tr><td data-label="Diagram"> - <strong>Payloads:</strong> { group_id, action, client_req_id } or { text } depending on action. </td></tr><tr><td data-label="Diagram"> - <strong>Client-side scripts:</strong> script.core.js, script.list.js, script.table.js, script.save.js handle event binding, queue management, and DOM interaction. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ Client Payload Routing</strong> </td></tr><tr><td data-label="Diagram"> - <strong>Load Group:</strong> script.list.js constructs payload and sends to <code>/load_group</code> or equivalent server endpoint. </td></tr><tr><td data-label="Diagram"> - <strong>Convert:</strong> script.core.js or table-level buttons capture text or table content and send to <code>/convert</code>. </td></tr><tr><td data-label="Diagram"> - <strong>Clipboard / Save:</strong> script.core.js handles Markdown generation, copy, and download fallback. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ server.py Handling</strong> </td></tr><tr><td data-label="Diagram"> - <strong>Request context:</strong> Build <code>request_ctx</code> with action, source, client_req_id. </td></tr><tr><td data-label="Diagram"> - <strong>Dispatch:</strong> route actions like "load_group" or "convert" to corresponding internal handlers. </td></tr><tr><td data-label="Diagram"> - <strong>Load Group Flow:</strong> </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Calls <code>io_utils.read_group()</code> to fetch files, metadata, compute checksums. </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Calls <code>convert.parse_*()</code> functions to produce <code>CaptionBlocks</code>. </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Attaches metadata: meta.source="group_load". </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Calls <code>sanitize.sanitize_caption_html()</code> to ensure HTML safety and inject minimal structure for captions. </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Calls <code>core_fragments.CaptionFragment.create()</code> to assign stable fragment IDs. </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Calls <code>core_table.ensure_table_id()</code> to generate or validate table IDs. </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Calls <code>core_renderer.inject_captions()</code> with a gate: only runs if action=="load_group". </td></tr><tr><td data-label="Diagram">     - Updates <code>table_meta.caption_ids</code>. </td></tr><tr><td data-label="Diagram">     - Marks <code>fragments.meta.injected = true</code>. </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Calls <code>html_renderer.render_html()</code> to produce final HTML: </td></tr><tr><td data-label="Diagram">     - If meta.injected==true, emits <code>&lt;script data-caption-payload&gt;‚Ä¶&lt;/script&gt;</code> to include caption metadata. </td></tr><tr><td data-label="Diagram">     - If meta.injected==false, emits HTML without caption payloads. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ Client Script Processing</strong> </td></tr><tr><td data-label="Diagram"> - <code>window.PTT.injectCaptions()</code> reads <code>&lt;script data-caption-payload&gt;</code> and maps captions to tables. </td></tr><tr><td data-label="Diagram"> - Handles queue draining and deferred DOM readiness. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ HTML Renderer (<code>html_renderer.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Wraps tables in consistent container structures. </td></tr><tr><td data-label="Diagram"> - Emits metadata and deterministic table IDs (SHA256 of normalized HTML if missing). </td></tr><tr><td data-label="Diagram"> - Compatible with multiple initialization paths: manual paste, group load, and server-converted HTML. </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ Core Renderer (<code>core_renderer.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Responsible for safely injecting caption fragments into the DOM structure. </td></tr><tr><td data-label="Diagram"> - Checks <code>request_ctx.action</code> and <code>meta.injected</code>. </td></tr><tr><td data-label="Diagram"> - Ensures idempotent injection for repeated loads. </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ Core Table Utilities (<code>core_table.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - <code>ensure_table_id()</code> guarantees stable IDs per table. </td></tr><tr><td data-label="Diagram"> - Maintains row counts and table-level metadata. </td></tr><tr><td data-label="Diagram"> - Supports client-side table lookup and caption mapping. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ Core Fragments (<code>core_fragments.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Defines <code>CaptionFragment</code> objects with stable IDs. </td></tr><tr><td data-label="Diagram"> - Metadata includes source, sanitized status, injection flag. </td></tr><tr><td data-label="Diagram"> - Enables deterministic caption attachment even if tables are reordered or reloaded. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ Sanitization (<code>sanitize.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Strips unsafe HTML tags. </td></tr><tr><td data-label="Diagram"> - Ensures fragment-safe innerHTML. </td></tr><tr><td data-label="Diagram"> - Prevents XSS while keeping line breaks (<code>&lt;br&gt;</code>) and basic formatting. </td></tr><tr><td data-label="Diagram"> <strong>üîü Conversion Layer (<code>convert.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Parses pasted text into 2-column structured tables. </td></tr><tr><td data-label="Diagram"> - Produces <code>CaptionBlocks</code> and table row objects. </td></tr><tr><td data-label="Diagram"> - Integrates with Markdown export utilities. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£1Ô∏è‚É£ Markdown / Export Utilities (<code>markdown.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Converts table arrays into Markdown lines preserving line breaks. </td></tr><tr><td data-label="Diagram"> - Handles multi-table exports, ensures safe filenames, UTF-8 normalization. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£2Ô∏è‚É£ IO Utilities (<code>io_utils.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Reads/writes group files atomically. </td></tr><tr><td data-label="Diagram"> - Computes checksums and temporary directories for safe operations. </td></tr><tr><td data-label="Diagram"> **1Ô∏è‚É£3Ô∏è‚É£ Assets & Client Script Utilities (<code>assets.js</code>, script.*.js<code>)**   - </code>script.core.js<code>: Handles conversion, toast notifications, queue management, DOM injection, extra script loader.   - </code>script.table.js<code>: Handles per-table actions like copy Markdown, highlight, and per-table export.   - </code>script.list.js<code>: Handles group load actions, builds client payloads, manages deferred rendering.   - </code>script.save.js<code>: Manages saving HTML/Markdown, fallback downloads, toast notifications.   - </code>worker.js<code>: Reserved for future client-side processing or background parsing.   **1Ô∏è‚É£4Ô∏è‚É£ Templates (</code>index.html<code>)**   - Provides DOM skeleton: #paste textarea, #tables-viewer, #page-area, #status elements.   - Script injections for core, table, list, save scripts.   - CSS injection: overrides.css, style.css for consistent formatting.   **1Ô∏è‚É£5Ô∏è‚É£ Client-Side Notification / Toast System**   - Queue-based, deduplicated by key.   - Auto-duration based on message length.   - Handles success/warn/error types with smooth fade-in/out.   - Prevents message overlap, max 8s, min 900ms.   **1Ô∏è‚É£6Ô∏è‚É£ Scroll &amp; TOC Handling**   - </code>window.__tv_skip_scroll<code> ensures controlled scroll.   - PTToc initialization via mutation observers for dynamic content.   - Debounced observers prevent repeated DOM mutation triggers.   **1Ô∏è‚É£7Ô∏è‚É£ Conversion &amp; Button Handling**   - Convert button: captures #paste content, disables multiple triggers, shows toast during conversion.   - Save button: attempts server save or local download fallback.   - Clear button: resets #paste, #tables-viewer, #page-area, #status.   - Export all / per-table copy handled via table scripts.   **1Ô∏è‚É£8Ô∏è‚É£ Error Handling &amp; Defensive Design**   - Try/catch wrappers on all optional operations.   - Missing DOM elements, TOC, or clipboard API fallbacks handled gracefully.   - Failures in extra scripts, CSS injection, or TOC do not block core functionality.   **1Ô∏è‚É£9Ô∏è‚É£ Key Notes**   - Deterministic table IDs via SHA256 normalization ensure stable caption mapping.   - Captions injected only when </code>action=="load_group"` to prevent accidental overwrite. </td></tr><tr><td data-label="Diagram"> - Multi-table support with per-table metadata and fragment IDs. </td></tr><tr><td data-label="Diagram"> - Supports manual paste workflow and group load workflow equivalently. </td></tr><tr><td data-label="Diagram"> - Fully compatible with Tables Viewer 2.1 typography and interaction. </td></tr><tr><td data-label="Diagram"> <strong>üìå Summary / Notes</strong> </td></tr><tr><td data-label="Diagram"> - PasteToTable orchestrates end-to-end: user input ‚Üí server parsing ‚Üí safe caption injection ‚Üí client rendering ‚Üí Markdown/HTML export. </td></tr><tr><td data-label="Diagram"> - Robust against missing DOM, multiple triggers, delayed scripts. </td></tr><tr><td data-label="Diagram"> - Captions are deterministic, stable, and mapped to correct table IDs. </td></tr><tr><td data-label="Diagram"> - Workflow ensures full integration with Tables Viewer 2.1, supporting two-column ChatGPT-style tables. </td></tr><tr><td data-label="Diagram"> - Defensive design allows future enhancements like worker.js, extra.js, and advanced table manipulation without breaking core features. </td></tr></tbody></table></div><div class="row-count">Rows: 68</div></div><div class="table-caption" id="Table11" data-table="Docu_0111_11" style="margin-top:2mm;margin-left:3mm;"><strong>Table 11</strong></div>
<div class="table-wrapper" data-table-id="table-11"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>PasteToTable Manual Paste & Caption Injection Workflow</strong> </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ User Manual Paste Interaction</strong> </td></tr><tr><td data-label="Diagram"> - User pastes raw text or table content into the <code>#paste</code> textarea. </td></tr><tr><td data-label="Diagram"> - Event captured by <code>script.core.js</code> via <code>input</code>, <code>paste</code>, or convert button click. </td></tr><tr><td data-label="Diagram"> - Optional debounce prevents multiple rapid conversions. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ Client Conversion Trigger</strong> </td></tr><tr><td data-label="Diagram"> - <code>window.__tv_do_convert(opts)</code> is called. </td></tr><tr><td data-label="Diagram"> - Captures <code>opts.text</code> or falls back to textarea value. </td></tr><tr><td data-label="Diagram"> - Shows a toast: ‚ÄúProcessing conversion‚Ä¶‚Äù while server request is prepared. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ Payload Preparation & Fetch</strong> </td></tr><tr><td data-label="Diagram"> - Constructs JSON POST payload to <code>/convert</code> endpoint. </td></tr><tr><td data-label="Diagram"> - Includes: { text, client_req_id, options } where options may include: two-column mode, markdown export, table numbering. </td></tr><tr><td data-label="Diagram"> - Fallback: URL-encoded form POST if fetch or JSON fails. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ Server-Side Parsing (<code>server.py</code> + <code>convert.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Receives <code>/convert</code> POST with text content. </td></tr><tr><td data-label="Diagram"> - Calls <code>convert.parse_*()</code> functions to generate structured <code>TableData</code> objects. </td></tr><tr><td data-label="Diagram"> - Each table includes: table_id (deterministic if missing), rows, columns, row_count, optional fragment metadata. </td></tr><tr><td data-label="Diagram"> - Captions parsed into <code>CaptionBlocks</code>. </td></tr><tr><td data-label="Diagram"> - <code>sanitize.sanitize_caption_html()</code> ensures safe HTML for each caption. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ Core Fragment Creation (<code>core_fragments.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - <code>CaptionFragment.create()</code> generates stable IDs for each caption. </td></tr><tr><td data-label="Diagram"> - Associates fragments with table_id and row indices. </td></tr><tr><td data-label="Diagram"> - Metadata includes: injected=false, sanitized=true, source="manual_paste". </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ Table Metadata & ID Assignment (<code>core_table.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - <code>ensure_table_id()</code> checks existing ID, generates SHA256 of normalized table HTML if missing. </td></tr><tr><td data-label="Diagram"> - Row counts computed and stored for client-side reference. </td></tr><tr><td data-label="Diagram"> - Table meta object updated: table_id, row_count, caption_ids=[] initially. </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ Caption Injection Gate (<code>core_renderer.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Only injects if <code>request_ctx.action==&quot;manual_paste&quot;</code> or optionally if forced by opts. </td></tr><tr><td data-label="Diagram"> - Iterates over tables in HTML: </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Matches table_id with fragments. </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Attaches fragment IDs as data attributes on <code>&lt;tr&gt;</code> or <code>&lt;td&gt;</code> elements. </td></tr><tr><td data-label="Diagram">   ‚Ä¢ Marks <code>fragments.meta.injected=true</code>. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ HTML Rendering (<code>html_renderer.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Renders tables into final HTML string. </td></tr><tr><td data-label="Diagram"> - Emits <code>&lt;script data-caption-payload&gt;</code> for each injected table if meta.injected==true. </td></tr><tr><td data-label="Diagram"> - If no captions injected, emits HTML only without payloads. </td></tr><tr><td data-label="Diagram"> - Handles multiple tables, dynamic IDs, and missing DOM gracefully. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ Client Caption Handling (<code>script.core.js</code>)</strong> </td></tr><tr><td data-label="Diagram"> - <code>window.PTT.injectCaptions()</code> reads <code>&lt;script data-caption-payload&gt;</code>. </td></tr><tr><td data-label="Diagram"> - Maps caption fragments to correct table rows. </td></tr><tr><td data-label="Diagram"> - Updates table DOM: adds caption spans, highlights, or notes. </td></tr><tr><td data-label="Diagram"> - Handles fallback if some fragment IDs are missing or table re-ordered. </td></tr><tr><td data-label="Diagram"> <strong>üîü Table Actions Post-Injection (<code>script.table.js</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Enables per-table copy Markdown buttons. </td></tr><tr><td data-label="Diagram"> - Supports per-table save/export. </td></tr><tr><td data-label="Diagram"> - Optional table highlighting and selection. </td></tr><tr><td data-label="Diagram"> - Deferred execution ensures DOM is fully ready: retries via <code>setTimeout</code> or <code>MutationObserver</code>. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£1Ô∏è‚É£ Toast & Notifications</strong> </td></tr><tr><td data-label="Diagram"> - Toast system ensures feedback: ‚ÄúTable converted successfully‚Äù, ‚ÄúCaptions injected‚Äù, ‚ÄúMarkdown copied‚Äù. </td></tr><tr><td data-label="Diagram"> - Handles multiple tables: queues messages sequentially. </td></tr><tr><td data-label="Diagram"> - Automatic deduplication avoids repeated messages for the same table. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£2Ô∏è‚É£ Scroll & Focus Management</strong> </td></tr><tr><td data-label="Diagram"> - <code>window.__tv_skip_scroll</code> prevents unwanted automatic scroll during injection. </td></tr><tr><td data-label="Diagram"> - Focused conversion ensures textarea and table viewer stay in view. </td></tr><tr><td data-label="Diagram"> - Debounced scroll restores are executed after table rendering. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Edge Cases & Fallbacks</strong> </td></tr><tr><td data-label="Diagram"> - Missing or empty paste content: shows toast, aborts conversion. </td></tr><tr><td data-label="Diagram"> - Non-HTML-safe text: sanitized by <code>sanitize_caption_html()</code>. </td></tr><tr><td data-label="Diagram"> - Table reordering or re-rendering: stable table_id ensures captions remain mapped correctly. </td></tr><tr><td data-label="Diagram"> - Clipboard fallback: legacy <code>tryLegacyCopy()</code> if navigator.clipboard unavailable. </td></tr><tr><td data-label="Diagram"> - Multi-table manual paste: each table gets unique table_id and caption fragments. </td></tr><tr><td data-label="Diagram"> **1Ô∏è‚É£4Ô∏è‚É£ Export & Markdown Conversion (<code>markdown.py</code>, script.save.js<code>)**   - Converts injected tables into Markdown lines, preserving </code><br><code> and line breaks.   - Supports single table or batch export.   - Safe filenames generated via </code>sanitizeFileName()`. </td></tr><tr><td data-label="Diagram"> - Optional server save or local download with toast notifications. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£5Ô∏è‚É£ Developer Notes / Stability</strong> </td></tr><tr><td data-label="Diagram"> - Workflow is idempotent: repeated conversions do not overwrite or break captions. </td></tr><tr><td data-label="Diagram"> - Deterministic IDs and SHA256 hashing maintain fragment consistency. </td></tr><tr><td data-label="Diagram"> - Defensive design ensures minimal risk if DOM elements are delayed or missing. </td></tr><tr><td data-label="Diagram"> - Modular client scripts: core.js for main workflow, table.js for per-table interactions, list.js for group handling, save.js for export. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£6Ô∏è‚É£ Summary / Notes</strong> </td></tr><tr><td data-label="Diagram"> - Manual paste workflow fully mirrors group load workflow but initiates from client-side pasted content. </td></tr><tr><td data-label="Diagram"> - Ensures stable, safe caption injection per table. </td></tr><tr><td data-label="Diagram"> - Integrates seamlessly with Markdown export, toast system, and DOM scrolling. </td></tr><tr><td data-label="Diagram"> - Designed for robust, deterministic, and repeatable two-column ChatGPT-style table rendering. </td></tr></tbody></table></div><div class="row-count">Rows: 74</div></div><div class="table-caption" id="Table12" data-table="Docu_0111_12" style="margin-top:2mm;margin-left:3mm;"><strong>Table 12</strong></div>
<div class="table-wrapper" data-table-id="table-12"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>Master PasteToTable Workflow: Group Load + Manual Paste + Caption Injection (Detailed)</strong> </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ User Actions & Initial Triggers</strong> </td></tr><tr><td data-label="Diagram"> - <strong>Group Load:</strong> User clicks ‚ÄúLoad Group‚Äù ‚Üí triggers <code>script.list.js</code>. Payload: <code>{group_id, action:&quot;load_group&quot;, client_req_id}</code>. This initiates server-side group reading. </td></tr><tr><td data-label="Diagram"> - <strong>Manual Paste:</strong> User pastes text in <code>#paste</code> ‚Üí triggers <code>script.core.js</code> ‚Üí optional debounce prevents rapid conversions. </td></tr><tr><td data-label="Diagram"> - <strong>Shared Logic:</strong> Both workflows construct <code>request_ctx</code> including: <code>action</code>, <code>source</code>, <code>client_req_id</code>. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ Client-Side Payload Construction & Fetch</strong> </td></tr><tr><td data-label="Diagram"> - Constructs POST payload: group_id or pasted text + client_req_id + options. </td></tr><tr><td data-label="Diagram"> - JSON POST sent to <code>/convert</code> endpoint. Fallback: URL-encoded POST. </td></tr><tr><td data-label="Diagram"> - Handles network errors gracefully and queues for retry if necessary. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ Server-Side Handling (<code>server.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Builds <code>request_ctx</code> with <code>action</code>, <code>source</code>, <code>client_req_id</code>. </td></tr><tr><td data-label="Diagram"> - For group load: calls <code>io_utils.read_group()</code> ‚Üí reads stored table files, computes checksums. </td></tr><tr><td data-label="Diagram"> - For manual paste: uses payload text. </td></tr><tr><td data-label="Diagram"> - Calls <code>convert.parse_*()</code> ‚Üí produces structured <code>TableData</code> objects and <code>CaptionBlocks</code>. </td></tr><tr><td data-label="Diagram"> - Metadata attached: <code>meta.source</code>, <code>meta.sanitized</code>. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ Caption Sanitization (<code>sanitize.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - <code>sanitize_caption_html()</code> ensures HTML safety. </td></tr><tr><td data-label="Diagram"> - Strips dangerous tags, escapes unsafe characters. </td></tr><tr><td data-label="Diagram"> - Updates fragment metadata: <code>sanitized=true</code>. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ Fragment Creation (<code>core_fragments.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - <code>CaptionFragment.create()</code> generates <strong>stable IDs</strong> for each caption. </td></tr><tr><td data-label="Diagram"> - Each fragment: table_id, row range, content, meta flags (<code>injected=false</code>, <code>sanitized=true</code>). </td></tr><tr><td data-label="Diagram"> - Supports multi-row captions, multi-table paste/load scenarios. </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ Table ID Assignment & Metadata (<code>core_table.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - <code>ensure_table_id()</code> checks table; if missing, generates deterministic ID via SHA256 of normalized table HTML. </td></tr><tr><td data-label="Diagram"> - Stores row_count, table_id, attached caption IDs. </td></tr><tr><td data-label="Diagram"> - Ensures consistent mapping of fragments to table rows. </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ Caption Injection Gate (<code>core_renderer.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Runs only if <code>request_ctx.action</code> matches injection workflow. </td></tr><tr><td data-label="Diagram"> - Iterates tables ‚Üí injects caption fragments into <code>&lt;tr&gt;</code>/<code>&lt;td&gt;</code> with stable IDs. </td></tr><tr><td data-label="Diagram"> - Marks <code>fragments.meta.injected=true</code>. </td></tr><tr><td data-label="Diagram"> - Handles missing tables gracefully and preserves order of injection. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ HTML Rendering (<code>html_renderer.py</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Wraps each table in final HTML string. </td></tr><tr><td data-label="Diagram"> - Emits <code>&lt;script data-caption-payload&gt;</code> if fragments injected. </td></tr><tr><td data-label="Diagram"> - Handles multiple tables, missing table IDs, and ensures fallback for empty fragments. </td></tr><tr><td data-label="Diagram"> - Supports future-proof extensibility for extra DOM hooks or metadata. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ Client-Side Caption Processing (<code>script.core.js</code>)</strong> </td></tr><tr><td data-label="Diagram"> - <code>window.PTT.injectCaptions()</code> reads <code>&lt;script data-caption-payload&gt;</code> from HTML. </td></tr><tr><td data-label="Diagram"> - Maps fragments to table rows using stable table_id and fragment IDs. </td></tr><tr><td data-label="Diagram"> - Updates DOM with spans, highlights, or caption notes. </td></tr><tr><td data-label="Diagram"> - Handles delayed DOM or table reordering without losing mapping. </td></tr><tr><td data-label="Diagram"> - Defensive: preserves existing table content if injection fails. </td></tr><tr><td data-label="Diagram"> <strong>üîü Table Interactions (<code>script.table.js</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Each table gets: copy Markdown button, save/export button, optional row/column highlights. </td></tr><tr><td data-label="Diagram"> - Supports deferred execution until table DOM fully ready. </td></tr><tr><td data-label="Diagram"> - Ensures stable IDs prevent collisions when multiple tables exist. </td></tr><tr><td data-label="Diagram"> - Handles multi-table conversion: captions remain correctly mapped. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£1Ô∏è‚É£ Toast / Notifications (<code>script.core.js</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Sequential toast queue: _toastQueue & _activeToast. </td></tr><tr><td data-label="Diagram"> - showToast(msg, opts) displays messages: success, warn, error. </td></tr><tr><td data-label="Diagram"> - Deduplication by key using <code>showToastOnce()</code>. </td></tr><tr><td data-label="Diagram"> - Auto-dismiss via click or timeout; duration computed based on length/type. </td></tr><tr><td data-label="Diagram"> - Ensures multiple toasts do not overlap visually or block workflow. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£2Ô∏è‚É£ Scroll & Focus Management</strong> </td></tr><tr><td data-label="Diagram"> - <code>window.__tv_skip_scroll</code> prevents auto-scroll conflicts during injection. </td></tr><tr><td data-label="Diagram"> - Focused conversion ensures textarea or table viewer remains in view. </td></tr><tr><td data-label="Diagram"> - Debounced scroll restoration executed post-table render. </td></tr><tr><td data-label="Diagram"> - Scroll retries at 0ms, 60ms, 250ms, 600ms to ensure smooth UX. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£3Ô∏è‚É£ Edge Cases & Fallbacks</strong> </td></tr><tr><td data-label="Diagram"> - Empty/missing content ‚Üí conversion abort + toast warning. </td></tr><tr><td data-label="Diagram"> - Non-HTML safe text ‚Üí sanitized. </td></tr><tr><td data-label="Diagram"> - Table reordering ‚Üí deterministic table_id ensures fragment mapping intact. </td></tr><tr><td data-label="Diagram"> - Clipboard fallback: <code>tryLegacyCopy()</code> ensures older browser support. </td></tr><tr><td data-label="Diagram"> - Multi-table paste/load ‚Üí each table assigned unique table_id + fragments. </td></tr><tr><td data-label="Diagram"> - Handles partial or missing captions without breaking DOM. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Markdown & Export (<code>markdown.py</code>, <code>script.save.js</code>)</strong> </td></tr><tr><td data-label="Diagram"> - Converts tables + injected captions to Markdown. </td></tr><tr><td data-label="Diagram"> - Preserves <code>&lt;br&gt;</code> line breaks and multi-row content. </td></tr><tr><td data-label="Diagram"> - Supports single table or batch export. </td></tr><tr><td data-label="Diagram"> - Filenames sanitized via <code>sanitizeFileName()</code>. </td></tr><tr><td data-label="Diagram"> - Export via server save or local download; toast confirms success/failure. </td></tr><tr><td data-label="Diagram"> - Ensures copied Markdown retains original table structure & formatting. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£5Ô∏è‚É£ Developer Notes / Stability</strong> </td></tr><tr><td data-label="Diagram"> - Idempotent: repeated conversions do not break captions. </td></tr><tr><td data-label="Diagram"> - Deterministic table IDs maintain fragment consistency across loads/pastes. </td></tr><tr><td data-label="Diagram"> - Defensive: minimal risk if DOM elements delayed or missing. </td></tr><tr><td data-label="Diagram"> - Modular client scripts: core.js (workflow engine), table.js (table interactions), list.js (group loader), save.js (export). </td></tr><tr><td data-label="Diagram"> - Fallbacks implemented for network errors, DOM delays, and missing elements. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£6Ô∏è‚É£ Summary / Notes</strong> </td></tr><tr><td data-label="Diagram"> - Unified workflow: group load and manual paste converge at TableData + CaptionFragment ‚Üí HTML render ‚Üí client inject ‚Üí table actions ‚Üí export. </td></tr><tr><td data-label="Diagram"> - Ensures deterministic table IDs, safe HTML, stable caption injection. </td></tr><tr><td data-label="Diagram"> - Full integration with Markdown export, toast notifications, scroll management, and per-table actions. </td></tr><tr><td data-label="Diagram"> - Supports multi-table, multi-row captions, stable fragment IDs, and two-column ChatGPT-style table rendering. </td></tr><tr><td data-label="Diagram"> <strong>üìå Notes / Observation</strong> </td></tr><tr><td data-label="Diagram"> - Designed for full PasteToTable resilience: safe fallback on missing tables, delayed DOM, or network errors. </td></tr><tr><td data-label="Diagram"> - Modular architecture allows future extensions: extra scripts, custom CSS, PTToc integration. </td></tr><tr><td data-label="Diagram"> - Stable IDs and deterministic hash ensure captions are always mapped correctly, even with multi-load scenarios. </td></tr><tr><td data-label="Diagram"> - Toast queue, scroll coordination, and clipboard fallback ensure smooth UX across browsers and sessions. </td></tr></tbody></table></div><div class="row-count">Rows: 89</div></div><div class="table-caption" id="Table13" data-table="Docu_0111_13" style="margin-top:2mm;margin-left:3mm;"><strong>Table 13</strong></div>
<div class="table-wrapper" data-table-id="table-13"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> <strong>Master PasteToTable Workflow: Internal Modules & Helpers (Batch 2)</strong> </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ convert.py ‚Äî Conversion & Parsing Core</strong> </td></tr><tr><td data-label="Diagram"> - Functions parse_*(): convert raw text or group file content into <strong>structured TableData</strong> and <strong>CaptionBlocks</strong>. </td></tr><tr><td data-label="Diagram"> - Handles multi-row tables, multi-column text, and line breaks. </td></tr><tr><td data-label="Diagram"> - Ensures <strong>row/column alignment</strong> for Markdown export and HTML rendering. </td></tr><tr><td data-label="Diagram"> - Generates preliminary metadata: table_id (if available), row_count, source type (paste/group). </td></tr><tr><td data-label="Diagram"> - Supports detection of empty cells, merged cells (span simulation), and preserves line breaks as <code>&lt;br&gt;</code> in HTML. </td></tr><tr><td data-label="Diagram"> - Works with core_fragments to produce fragment-ready captions. </td></tr><tr><td data-label="Diagram"> - Defensive: fallback on irregular separators or malformed table content. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ core_utils.py ‚Äî Misc Helpers</strong> </td></tr><tr><td data-label="Diagram"> - sanitize_text_for_html(text): escapes <code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code>, quotes to prevent XSS. </td></tr><tr><td data-label="Diagram"> - stream_chunks(iterable, chunk_size): generator for batch processing large tables. </td></tr><tr><td data-label="Diagram"> - compute_sha256(str): deterministic hash for table_id generation. </td></tr><tr><td data-label="Diagram"> - attach_sri_attr(script_url, integrity_hash): ensures subresource integrity when injecting scripts dynamically. </td></tr><tr><td data-label="Diagram"> - safe_json_parse(text, fallback={}): robust JSON parsing with fallback. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ core_io.py ‚Äî File & Atomic Operations</strong> </td></tr><tr><td data-label="Diagram"> - atomic_write(path, data): writes temp file then renames ‚Üí avoids partial writes. </td></tr><tr><td data-label="Diagram"> - make_temp_dir(prefix): creates safe temporary directories for intermediate table storage. </td></tr><tr><td data-label="Diagram"> - ensure_dir(path): recursive creation with permission checks. </td></tr><tr><td data-label="Diagram"> - path_safety_check(path): prevents directory traversal attacks when loading group files. </td></tr><tr><td data-label="Diagram"> - read_file_with_checksum(path): returns content + hash for cache/integrity. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ core_assets.py ‚Äî Asset Discovery & Embedding</strong> </td></tr><tr><td data-label="Diagram"> - Detects assets in <code>/assets/</code> folder (JS, CSS, JSON). </td></tr><tr><td data-label="Diagram"> - Copies assets to output directories safely. </td></tr><tr><td data-label="Diagram"> - Embeds assets into rendered HTML via <code>&lt;script&gt;</code> or <code>&lt;style&gt;</code> tags. </td></tr><tr><td data-label="Diagram"> - Generates integrity hashes for all embedded scripts. </td></tr><tr><td data-label="Diagram"> - Supports optional <code>extra.js</code> injection with sequential load and retries. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ core_renderer.py ‚Äî Caption Injection Logic</strong> </td></tr><tr><td data-label="Diagram"> - inject_captions(): maps CaptionFragments ‚Üí target tables using table_id. </td></tr><tr><td data-label="Diagram"> - Checks request_ctx.action to run only on relevant workflows. </td></tr><tr><td data-label="Diagram"> - Marks fragment.meta.injected=true after successful DOM injection. </td></tr><tr><td data-label="Diagram"> - Handles multi-table scenarios with correct mapping to each <code>&lt;table&gt;</code> element. </td></tr><tr><td data-label="Diagram"> - Ensures order preservation even when tables reordered in DOM. </td></tr><tr><td data-label="Diagram"> - Compatible with Markdown export: injected captions do not break cell alignment. </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ core_fragments.py ‚Äî CaptionFragment Model</strong> </td></tr><tr><td data-label="Diagram"> - CaptionFragment.create(): generates object with fields: table_id, row_range, fragment_id, content, meta flags. </td></tr><tr><td data-label="Diagram"> - Ensures deterministic fragment_id for stable client-side injection. </td></tr><tr><td data-label="Diagram"> - Supports multi-row spanning captions and multi-fragment tables. </td></tr><tr><td data-label="Diagram"> - Provides methods to serialize/deserialize to JSON for embedding in <code>&lt;script data-caption-payload&gt;</code>. </td></tr><tr><td data-label="Diagram"> - Tracks injection state (<code>meta.injected</code>) and sanitation state (<code>meta.sanitized</code>). </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ sanitize.py ‚Äî HTML & Safety</strong> </td></tr><tr><td data-label="Diagram"> - sanitize_caption_html(): removes dangerous tags (<code>&lt;script&gt;</code>, <code>&lt;iframe&gt;</code>), escapes unsafe attributes. </td></tr><tr><td data-label="Diagram"> - sanitize_table_html(): ensures valid <code>&lt;table&gt;</code> structure, closes missing tags. </td></tr><tr><td data-label="Diagram"> - normalize_text_for_search(): removes accents, lowercases, strips punctuation ‚Üí supports TOC/search indexing. </td></tr><tr><td data-label="Diagram"> - Supports safe fallback for malformed HTML or user-pasted content. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ io_utils.py ‚Äî Group & Table File Handling</strong> </td></tr><tr><td data-label="Diagram"> - read_group(group_id): reads all files in group folder. </td></tr><tr><td data-label="Diagram"> - Computes checksums for integrity verification. </td></tr><tr><td data-label="Diagram"> - Returns list of files, metadata, and pre-parsed TableData structures. </td></tr><tr><td data-label="Diagram"> - Defensive: handles missing files, empty directories, permission errors. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ assets.py ‚Äî Asset Management & Helpers</strong> </td></tr><tr><td data-label="Diagram"> - Exposes mapping for core scripts, CSS, and optional extras. </td></tr><tr><td data-label="Diagram"> - Functions to embed inline <code>&lt;script&gt;</code> and <code>&lt;style&gt;</code> safely. </td></tr><tr><td data-label="Diagram"> - Provides SRI hashing and deterministic URL mapping. </td></tr><tr><td data-label="Diagram"> - Ensures fallback for missing assets to prevent runtime JS errors. </td></tr><tr><td data-label="Diagram"> <strong>üîü cli.py ‚Äî Command-Line Interface</strong> </td></tr><tr><td data-label="Diagram"> - Provides CLI hooks for batch conversion or testing outside browser. </td></tr><tr><td data-label="Diagram"> - Example commands: <code>ptt convert --file table.txt</code>, <code>ptt load-group --id GROUP_ID</code>. </td></tr><tr><td data-label="Diagram"> - Handles logging, debug flags, and dry-run modes. </td></tr><tr><td data-label="Diagram"> - Ensures file paths are sanitized to prevent malicious input. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£1Ô∏è‚É£ types.py ‚Äî Core Data Structures</strong> </td></tr><tr><td data-label="Diagram"> - TableData: {table_id, rows, columns, raw_html, metadata}. </td></tr><tr><td data-label="Diagram"> - CaptionBlock: {table_id, row_range, content, fragment_id, meta}. </td></tr><tr><td data-label="Diagram"> - FragmentMeta: tracks <code>sanitized</code>, <code>injected</code>, <code>source</code>. </td></tr><tr><td data-label="Diagram"> - Provides typed structure for consistent parsing, injection, and export. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£2Ô∏è‚É£ templates/index.html</strong> </td></tr><tr><td data-label="Diagram"> - Main entry point for PasteToTable web app. </td></tr><tr><td data-label="Diagram"> - Includes placeholders: <code>#paste</code>, <code>#tables-viewer</code>, <code>#status</code>. </td></tr><tr><td data-label="Diagram"> - Scripts loaded: <code>script.core.js</code>, <code>script.list.js</code>, <code>script.table.js</code>, <code>script.save.js</code>. </td></tr><tr><td data-label="Diagram"> - Dynamic injection points for <code>&lt;script data-caption-payload&gt;</code> and optional extra.js. </td></tr><tr><td data-label="Diagram"> - Styles: includes <code>style.css</code> + optional <code>overrides.css</code>. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£3Ô∏è‚É£ assets/scripts overview</strong> </td></tr><tr><td data-label="Diagram"> - <strong>script.core.js:</strong> conversion engine, DOM injection, toast, scroll, clipboard, extra script loader. </td></tr><tr><td data-label="Diagram"> - <strong>script.list.js:</strong> group load handler, queue drain, client payload builder. </td></tr><tr><td data-label="Diagram"> - <strong>script.table.js:</strong> per-table interactions, copy Markdown, save/export, button attachment. </td></tr><tr><td data-label="Diagram"> - <strong>script.save.js:</strong> handles export & download of HTML/Markdown. </td></tr><tr><td data-label="Diagram"> - <strong>script.toc.js:</strong> optional TOC integration (PTToc). </td></tr><tr><td data-label="Diagram"> - <strong>worker.js:</strong> placeholder for future client-side background processing. </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£4Ô∏è‚É£ Workflow Summary & Notes</strong> </td></tr><tr><td data-label="Diagram"> - Two main workflows converge: <strong>manual paste</strong> & <strong>group load</strong>. </td></tr><tr><td data-label="Diagram"> - Both produce TableData ‚Üí parse into CaptionFragments ‚Üí sanitize ‚Üí inject ‚Üí render ‚Üí client actions. </td></tr><tr><td data-label="Diagram"> - Deterministic table_id + fragment_id ensures stability across reloads, multi-table scenarios, or DOM reordering. </td></tr><tr><td data-label="Diagram"> - Modular design allows extensions: extra.js, PTToc, Markdown export, multi-group batch processing. </td></tr><tr><td data-label="Diagram"> - Defensive design: missing tables, empty content, malformed HTML, network errors all handled gracefully. </td></tr><tr><td data-label="Diagram"> - Toast notifications, scroll coordination, clipboard fallbacks, and debounce ensure smooth UX. </td></tr><tr><td data-label="Diagram"> - All conversions and injections idempotent: repeated runs do not corrupt table or caption state. </td></tr><tr><td data-label="Diagram"> - Full support for multi-row, multi-column tables, ChatGPT-style two-column rendering, and Markdown export preserving <code>&lt;br&gt;</code> and formatting. </td></tr><tr><td data-label="Diagram"> - All modules interact via clearly defined structures: TableData, CaptionBlock, CaptionFragment, FragmentMeta. </td></tr><tr><td data-label="Diagram"> - Ensures safe, predictable, reproducible output for both manual and automated workflows. </td></tr><tr><td data-label="Diagram"> <strong>üìå Super-Detailed Observations / Developer Notes</strong> </td></tr><tr><td data-label="Diagram"> - HTML rendering preserves table integrity: rows, colspan/rowspan approximations, line breaks. </td></tr><tr><td data-label="Diagram"> - Metadata propagation ensures client knows which fragments injected, which sanitized. </td></tr><tr><td data-label="Diagram"> - Deterministic hashing enables consistent fragment mapping for client JS injection. </td></tr><tr><td data-label="Diagram"> - Client JS is fully defensive: delayed DOM, missing tables, or optional extras do not break functionality. </td></tr><tr><td data-label="Diagram"> - All modules include internal logging, debug flags, and error handling for safer debugging and development. </td></tr><tr><td data-label="Diagram"> - Supports batch group processing, multi-table pastes, incremental table injection, and Markdown export. </td></tr><tr><td data-label="Diagram"> - Scroll coordination ensures minimal visual jank and user focus retention. </td></tr><tr><td data-label="Diagram"> - Full integration between server.py, convert.py, sanitize.py, core_fragments.py, core_table.py, core_renderer.py, html_renderer.py, and client JS ensures end-to-end reliable workflow. </td></tr></tbody></table></div><div class="row-count">Rows: 98</div></div><div class="table-caption" id="Table14" data-table="Docu_0111_14" style="margin-top:2mm;margin-left:3mm;"><strong>Table 14</strong></div>
<div class="table-wrapper" data-table-id="table-14"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details / Guidelines**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details / Guidelines</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Key Points / Recommendations**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Key Points / Recommendations</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Topic"> <strong>1Ô∏è‚É£ Locked Files in PasteToTable</strong> </td><td data-label="Details / Guidelines"> <strong>Files:</strong> <code>render/</code> folder, <code>assets/style.css</code> <br><strong>Rules:</strong> Cannot modify these files. Any logic/UI adjustments must be done in editable files (<code>server.py</code>, <code>main.py</code>, <code>html_renderer.py</code>, <code>utils.py</code>, <code>assets/*.js</code>, <code>templates/index.html</code>). <br><strong>Reasoning:</strong> All caption injection, table ID fixes, and DOM adjustments are handled via <code>core_renderer.py</code> + JS to avoid touching locked files.                                                                                                                                   </td><td data-label="Key Points / Recommendations"> ‚Ä¢ Locked files remain read-only.<br>‚Ä¢ Refactor or override externally instead of editing locked files.<br>‚Ä¢ Ensures PTT workflow integrity and maintainability.                                                                                            </td></tr><tr><td data-label="Topic"> <strong>2Ô∏è‚É£ Using TV2.1 Assets</strong>           </td><td data-label="Details / Guidelines"> <strong>Assets:</strong> JS, CSS, and HTML templates from TV2.1 can be used. <br><strong>Guidelines:</strong> <br>‚Ä¢ Replace PTT assets only where it doesn‚Äôt interfere with editable JS.<br>‚Ä¢ Keep PTT scripts (<code>script.core.js</code>, <code>script.table.js</code>, <code>script.list.js</code>, <code>script.save.js</code>) intact.<br>‚Ä¢ Keep <code>overrides.css</code> loaded after TV2.1 CSS for PTT-specific fixes.<br>‚Ä¢ Test carefully for caption injection, clipboard, and scroll/interaction logic. <br>‚Ä¢ Ensure server integration works with <code>injectCaptions()</code> reading <code>&lt;script data-caption-payload&gt;</code>. </td><td data-label="Key Points / Recommendations"> ‚Ä¢ Use TV2.1 assets to get full styles and enhancements.<br>‚Ä¢ Maintain editable JS for PTT-specific logic.<br>‚Ä¢ Locked files are never modified.<br>‚Ä¢ Server and client interactivity remain fully functional.                                              </td></tr><tr><td data-label="Topic"> <strong>‚úÖ Recommendation</strong>                 </td><td data-label="Details / Guidelines">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td><td data-label="Key Points / Recommendations"> ‚Ä¢ Keep locked files intact.<br>‚Ä¢ Replace only non-conflicting UI/utility assets from TV2.1.<br>‚Ä¢ Handle all caption, table ID, and injection logic in editable files.<br>‚Ä¢ Achieves full TV2.1 styling and JS features while preserving PTT functionality. </td></tr></tbody></table></div><div class="row-count">Rows: 3</div></div><div class="table-caption" id="Table15" data-table="Docu_0111_15" style="margin-top:2mm;margin-left:3mm;"><strong>Table 15</strong></div>
<div class="table-wrapper" data-table-id="table-15"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by PTT + TV2.1 Asset Overlay Plan"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">PTT + TV2.1 Asset Overlay Plan</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="PTT + TV2.1 Asset Overlay Plan"> üéØ PurposeThis table maps your PasteToTable (PTT) project assets against Tables Viewer 2.1 (TV2.1) assets, showing exactly which files can be replaced, which must be kept, and integration notes to ensure captions, table IDs, toast notifications, and other PTT-specific logic continue to work seamlessly. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table16" data-table="Docu_0111_16" style="margin-top:2mm;margin-left:3mm;"><strong>Table 16</strong></div>
<div class="table-wrapper" data-table-id="table-16"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by -  CODE0  ‚Äî core Table Viewer 2.1 CSS. Cannot modify directly; override via  CODE1 ."><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">-  CODE0  ‚Äî core Table Viewer 2.1 CSS. Cannot modify directly; override via  CODE1 .</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="-  CODE0  ‚Äî core Table Viewer 2.1 CSS. Cannot modify directly; override via  CODE1 ."> üìù Editable Files (PTT logic)These files contain your custom logic and <strong>must remain your source of truth</strong>. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table17" data-table="Docu_0111_17" style="margin-top:2mm;margin-left:3mm;"><strong>Table 17</strong></div>
<div class="table-wrapper" data-table-id="table-17"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by - `server.py` ‚Äî caption injection"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">- <code>server.py</code> ‚Äî caption injection</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by table ID assignment"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">table ID assignment</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by group load/save handling."><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">group load/save handling.</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="- server.py ‚Äî caption injection"> <code>utils.py</code> ‚Äî core Python helpers for table processing</td><td data-label="table ID assignment"> HTML wrapping</td><td data-label="group load/save handling."> caption meta.  </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table18" data-table="Docu_0111_18" style="margin-top:2mm;margin-left:3mm;"><strong>Table 18</strong></div>
<div class="table-wrapper" data-table-id="table-18"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by - `script.core.js` ‚Äî main conversion"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">- <code>script.core.js</code> ‚Äî main conversion</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by DOM injection"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">DOM injection</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by caption processing"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">caption processing</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="- script.core.js ‚Äî main conversion">  - <code>script.table.js</code> ‚Äî table-level UI</td><td data-label="DOM injection"> copy/Markdown/export</td><td data-label="caption processing"> row/column handling.  </td></tr><tr><td data-label="- script.core.js ‚Äî main conversion">  - <code>script.list.js</code> ‚Äî group load/list UI</td><td data-label="DOM injection"> client payload coordination.  </td><td data-label="caption processing"></td></tr></tbody></table></div><div class="row-count">Rows: 2</div></div><div class="table-caption" id="Table19" data-table="Docu_0111_19" style="margin-top:2mm;margin-left:3mm;"><strong>Table 19</strong></div>
<div class="table-wrapper" data-table-id="table-19"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by -  CODE0  ‚Äî main HTML template for PTT interface."><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">-  CODE0  ‚Äî main HTML template for PTT interface.</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="-  CODE0  ‚Äî main HTML template for PTT interface."> üÜó TV2.1 Assets Safe Replacement These are TV2.1 front-end/UI assets that <strong>can be swapped in</strong>, provided your PTT JS remains intact and runs after them. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table20" data-table="Docu_0111_20" style="margin-top:2mm;margin-left:3mm;"><strong>Table 20</strong></div>
<div class="table-wrapper" data-table-id="table-20"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by - `assets/overrides.css` ‚Äî optional"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">- <code>assets/overrides.css</code> ‚Äî optional</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by merge or extend with PTT-specific overrides. TV2.1 CSS can load first."><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">merge or extend with PTT-specific overrides. TV2.1 CSS can load first.</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="- assets/overrides.css ‚Äî optional"> e.g.</td><td data-label="merge or extend with PTT-specific overrides. TV2.1 CSS can load first."> <code>tv.utils.js</code> ‚Äî safe as long as it doesn‚Äôt conflict with <code>script.core.js</code> or <code>script.table.js</code>. |</td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table21" data-table="Docu_0111_21" style="margin-top:2mm;margin-left:3mm;"><strong>Table 21</strong></div>
<div class="table-wrapper" data-table-id="table-21"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Unnamed: 1"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Unnamed: 1</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Unnamed: 1"> ‚ö° Optional Enhancements with TV2.1- TOC: if replacing <code>script.toc.js</code>, ensure PTT observer still waits for DOM readiness.  </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table22" data-table="Docu_0111_22" style="margin-top:2mm;margin-left:3mm;"><strong>Table 22</strong></div>
<div class="table-wrapper" data-table-id="table-22"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Unnamed: 1"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Unnamed: 1</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Unnamed: 1"> ‚úÖ Summary- <strong>Locked files</strong>: untouched.  </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table23" data-table="Docu_0111_23" style="margin-top:2mm;margin-left:3mm;"><strong>Table 23</strong></div>
<div class="table-wrapper" data-table-id="table-23"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by - **TV2.1 assets**: safely overlayable for UI"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">- <strong>TV2.1 assets</strong>: safely overlayable for UI</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by styling"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">styling</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by and optional JS utilities."><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">and optional JS utilities.</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="- TV2.1 assets: safely overlayable for UI"> toast/scroll</td><td data-label="styling"> Markdown export</td><td data-label="and optional JS utilities."> group save/load) always runs after any TV2.1 UI/utility scripts.  </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table24" data-table="Docu_0111_24" style="margin-top:2mm;margin-left:3mm;"><strong>Table 24</strong></div>
<div class="table-wrapper" data-table-id="table-24"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by - **Benefit**: Seamlessly use TV2.1 styling and UX improvements while retaining PTT-specific functionality and your workflow integrity."><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">- <strong>Benefit</strong>: Seamlessly use TV2.1 styling and UX improvements while retaining PTT-specific functionality and your workflow integrity.</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="- Benefit: Seamlessly use TV2.1 styling and UX improvements while retaining PTT-specific functionality and your workflow integrity."> üìù Note- This plan ensures you can adopt TV2.1 assets without touching core PTT renderers or breaking the caption workflow. All client-side features (captions, copy/export, toast notifications, table scroll coordination) remain intact. Testing after overlay is required, particularly for multi-table pages and manual paste workflows. </td></tr></tbody></table></div><div class="row-count">Rows: 1</div></div><div class="table-caption" id="Table25" data-table="Docu_0111_25" style="margin-top:2mm;margin-left:3mm;"><strong>Table 25</strong></div>
<div class="table-wrapper" data-table-id="table-25"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Diagram"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Diagram</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Diagram"> üóÇ <strong>Master PTT + TV2.1 Workflow Diagram</strong> </td></tr><tr><td data-label="Diagram"> <strong>1Ô∏è‚É£ Page Load Sequence</strong><br>- Browser requests <code>index.html</code> (PTT template).<br>- <code>&lt;link&gt;</code> loads TV2.1 <code>style.css</code> first ‚Üí ensures base UI styles.<br>- <code>&lt;link&gt;</code> loads <code>overrides.css</code> (PTT) ‚Üí overrides TV2.1 styles for captions, buttons, table layouts.<br>- <code>&lt;script&gt;</code> loads TV2.1 optional JS utilities (e.g., <code>tv.utils.js</code>) ‚Üí safe, provides clipboard, download, debounce helpers.<br>- <code>&lt;script&gt;</code> loads PTT client scripts in order: <code>script.core.js</code> ‚Üí <code>script.table.js</code> ‚Üí <code>script.list.js</code> ‚Üí <code>script.save.js</code> ‚Üí optional <code>extra.js</code> / <code>worker.js</code>. </td></tr><tr><td data-label="Diagram"> <strong>2Ô∏è‚É£ PTT Initialization</strong><br>- <code>script.core.js</code> initializes <code>window.PTT</code> namespace.<br>- Detects DOM readiness (<code>#paste</code>, <code>#tables-viewer</code>, <code>#page-area</code>).<br>- Sets global flags: <code>window.__tv_skip_scroll = false</code>.<br>- Initializes toast queue: <code>_toastQueue</code> and <code>_activeToast</code>.<br>- Initializes utility functions: copy to clipboard, downloadBlob, sanitizeFileName, debounce, normalizeForSearchLocal. </td></tr><tr><td data-label="Diagram"> <strong>3Ô∏è‚É£ User Actions: Paste / Convert</strong><br>- User pastes text ‚Üí <code>script.core.js</code> captures via textarea or drag/drop.<br>- <code>window.__tv_do_convert(opts)</code> reads pasted text.<br>- Conversion options: Markdown or HTML.<br>- Conversion POST to <code>/convert</code> endpoint (server.py).<br>- Server-side Python (<code>server.py</code>) invokes <code>convert.parse_*()</code> ‚Üí produces <code>CaptionBlocks</code>.<br>- Sanitization via <code>sanitize.sanitize_caption_html()</code>.<br>- Table IDs assigned via <code>core_table.ensure_table_id()</code>. </td></tr><tr><td data-label="Diagram"> <strong>4Ô∏è‚É£ Caption Injection (Critical PTT Logic)</strong><br>- <code>core_renderer.inject_captions()</code> runs <strong>only if request_ctx.action=="load_group"</strong>.<br>- Adds caption fragments to tables, marks <code>meta.injected=true</code>.<br>- <code>html_renderer.render_html()</code> emits <code>&lt;script data-caption-payload&gt;</code> if <code>meta.injected==true</code>.<br>- Client <code>script.core.js</code> drains payload queue ‚Üí <code>window.PTT.injectCaptions()</code> attaches captions to DOM tables. </td></tr><tr><td data-label="Diagram"> <strong>5Ô∏è‚É£ Table Handling & Export</strong><br>- <code>script.table.js</code> enhances table rows/columns: copy buttons, Markdown export, hover highlights.<br>- Maintains stable IDs for tables and rows to sync with caption fragments.<br>- Copy Markdown respects <code>&lt;br&gt;</code>, inline HTML, and multi-line cells.<br>- Save/export buttons: <code>script.save.js</code> handles HTML/Markdown server save or local download. </td></tr><tr><td data-label="Diagram"> <strong>6Ô∏è‚É£ Group Management</strong><br>- <code>script.list.js</code> handles group load: sends <code>{group_id, action:&quot;load_group&quot;, client_req_id}</code> ‚Üí server.<br>- Server builds <code>request_ctx</code> ‚Üí reads files via <code>io_utils.read_group()</code> ‚Üí computes checksums ‚Üí returns HTML with captions.<br>- Ensures table metadata and fragment IDs remain consistent across reloads. </td></tr><tr><td data-label="Diagram"> <strong>7Ô∏è‚É£ TV2.1 Asset Overlay & Integration</strong><br>- TV2.1 assets (CSS/JS utilities) are <strong>safe overlays</strong>:<br>  ‚Ä¢ <code>style.css</code> ‚Üí base UI<br>  ‚Ä¢ <code>tv.utils.js</code> ‚Üí clipboard, download, debounce helpers<br>  ‚Ä¢ <code>script.toc.js</code> ‚Üí optional TOC integration<br>- PTT scripts run <strong>after</strong> TV2.1 scripts to preserve caption, toast, scroll, and export logic.<br>- Captions, table IDs, toast queues are fully PTT-controlled; TV2.1 only provides base UI/utility support. </td></tr><tr><td data-label="Diagram"> <strong>8Ô∏è‚É£ Toast / Notification Lifecycle</strong><br>- <code>_processToastQueue()</code> ensures sequential notifications.<br>- <code>_computeToastDuration(msg, type, optDuration)</code> auto-scales by message length/type.<br>- <code>showToast(msg, {type,duration})</code> displays main toast; <code>showToastOnce(key, msg, opts, cooldownMs)</code> deduplicates.<br>- Toasts fade in/out smoothly; user click or auto dismiss handled. </td></tr><tr><td data-label="Diagram"> <strong>9Ô∏è‚É£ Scroll / Layout Coordination</strong><br>- <code>window.__tv_skip_scroll</code> flag prevents table auto-scroll conflicts.<br>- DOM mutation observer ensures TOC updates, table highlights, and caption positions after conversion.<br>- Debounce applied to window resize, table mutations, and paste events. </td></tr><tr><td data-label="Diagram"> <strong>üîü Optional / Future Features</strong><br>- <code>extra.js</code> ‚Üí sequential extra features.<br>- <code>worker.js</code> ‚Üí optional background processing (e.g., large table parsing).<br>- Multi-table paste supported with fragment-level IDs and consistent metadata. </td></tr><tr><td data-label="Diagram"> <strong>üìå Notes</strong><br>- Locked Python files (<code>render/</code>) are <strong>never modified</strong>; all caption logic and table processing originates there.<br>- PTT editable files manage client-side behavior and integration points.<br>- TV2.1 assets can enhance UI and utilities but <strong>never override PTT core logic</strong>.<br>- Load order is critical: TV2.1 CSS ‚Üí TV2.1 JS ‚Üí PTT scripts ‚Üí TOC ‚Üí caption injection ‚Üí table enhancements ‚Üí toast ‚Üí scroll coordination.<br>- Workflow ensures <strong>stable table IDs, consistent caption injection, reliable toast notifications, multi-table paste/export, and full TV2.1 styling</strong>.<br>- Manual paste workflow, group loading, and server-side conversion all funnel through this sequence, ensuring predictable results across browsers and devices. </td></tr></tbody></table></div><div class="row-count">Rows: 12</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>