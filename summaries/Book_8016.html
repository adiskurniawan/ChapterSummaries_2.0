<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761648522">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li>
<li class="toc-item"><a class="toc-link" href="#Table10">Table 10</a></li>
<li class="toc-item"><a class="toc-link" href="#Table11">Table 11</a></li>
<li class="toc-item"><a class="toc-link" href="#Table12">Table 12</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8016_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Input / Problem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Input / Problem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Change I will make and effect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change I will make and effect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Input / Problem"> Fonts or CSS load-order mismatch vs TV2.1        </td><td data-label="Change I will make and effect"> Align <code>&lt;link&gt;</code> order and font preload tags to match TV2.1 so computed typography matches benchmark. Effect: fixes font metrics and text fallback differences site-wide.        </td></tr><tr><td data-label="Input / Problem"> TOC placement (user preference: below header)    </td><td data-label="Change I will make and effect"> Move TOC node below header and ensure same wrapper classes/IDs as TV2.1. Effect: identical visual structure and CSS targeting.                                                 </td></tr><tr><td data-label="Input / Problem"> Missing CSS hooks / classes used by TV2.1        </td><td data-label="Change I will make and effect"> Add/restore required wrapper classes and data attributes (table container, tv-* classes) without changing semantics. Effect: assets/style.css rules apply exactly as in TV2.1. </td></tr><tr><td data-label="Input / Problem"> Inline style or JS that overrides CSS            </td><td data-label="Change I will make and effect"> Remove or neutralize inline width/height attributes in template; prefer CSS classes. Effect: avoids JS-induced reflows and keeps typography stable.                            </td></tr><tr><td data-label="Input / Problem"> Script/CSP ordering affecting CSSOM or font load </td><td data-label="Change I will make and effect"> Move script includes to same positions as TV2.1 (defer where needed). Effect: consistent render timing and font swap behavior.                                                 </td></tr><tr><td data-label="Input / Problem"> SEO / accessibility differences (headings/ids)   </td><td data-label="Change I will make and effect"> Preserve <code>&lt;h3 id=&quot;table-{idx}&quot;&gt;</code> and ARIA attributes to keep TOC and JS compatibility. Effect: keeps JS plus TOC behavior intact and prevents regressions.                     </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table2" data-table="Book_8016_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **File name**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>File name</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Table Viewer v2.1 (Reference Behavior)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Table Viewer v2.1 (Reference Behavior)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **PasteToTable (Current Behavior and Required Alignment Actions)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>PasteToTable (Current Behavior and Required Alignment Actions)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="File name"> <strong>main.py</strong>              </td><td data-label="Table Viewer v2.1 (Reference Behavior)"> Entry initializes environment and calls <code>render_html</code> or <code>render_table</code> directly. Minimal wrapper. No server or Flask context. Ensures clean CLI execution and predictable output folder.                                                          </td><td data-label="PasteToTable (Current Behavior and Required Alignment Actions)"> Uses Flask entry and <code>server.py</code> orchestration. CLI and Flask routes share render logic. <strong>Action:</strong> Confirm consistent entry arguments and encoding. Ensure that when called in server mode, output still respects the same text normalization and HTML generation path used by Table Viewer. No typography change expected, but structure verification needed. </td></tr><tr><td data-label="File name"> <strong>server.py</strong>            </td><td data-label="Table Viewer v2.1 (Reference Behavior)"> Not present in Table Viewer. Rendering is direct via command-line pipeline.                                                                                                                                                                        </td><td data-label="PasteToTable (Current Behavior and Required Alignment Actions)"> Introduces Flask endpoints for web-based conversion and saving. <strong>Action:</strong> Review data flow to ensure it invokes <code>render/core.py</code> through the same chain (sanitize → convert → render_table). Must not alter output HTML structure. Focus only on data integrity and parameter equivalence to CLI.                                                              </td></tr><tr><td data-label="File name"> <strong>html_renderer.py</strong>     </td><td data-label="Table Viewer v2.1 (Reference Behavior)"> Contains direct orchestration logic (<code>render_html</code>, <code>render_page</code>, etc.). Assembles fragments and wraps table HTML within standardized containers (<code>&lt;div class=&quot;tv-content&quot;&gt;</code>, <code>&lt;div class=&quot;tv-table-wrap&quot;&gt;</code>).                                     </td><td data-label="PasteToTable (Current Behavior and Required Alignment Actions)"> Contains Flask integration and template rendering logic. Structure may differ in wrapper class names, causing CSS mismatches. <strong>Action:</strong> Normalize wrapper class names and hierarchy to match TV2.1 (especially outer container IDs, <code>tv-</code> prefixed wrappers). Preserve Flask templating, but ensure identical HTML structure passed to template.               </td></tr><tr><td data-label="File name"> <strong>utils.py</strong>             </td><td data-label="Table Viewer v2.1 (Reference Behavior)"> Central utility for logging, safe file paths, and environmental setup. Handles consistent directory naming (<code>output_combined</code>, <code>assets</code>).                                                                                                          </td><td data-label="PasteToTable (Current Behavior and Required Alignment Actions)"> Handles local paths (<code>saved_tables/</code>) and simplified logging. <strong>Action:</strong> Align path generation for asset references so that <code>&lt;link href=&quot;assets/style.css&quot;&gt;</code> and <code>&lt;script src=&quot;assets/script.js&quot;&gt;</code> resolve identically in HTML. Ensure file existence logic doesn’t insert dynamic query strings or version parameters that break CSS cache matching.           </td></tr><tr><td data-label="File name"> <strong>render/convert.py</strong>    </td><td data-label="Table Viewer v2.1 (Reference Behavior)"> Converts sanitized text into structured table HTML. Preserves <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, <code>&lt;tr&gt;</code>, <code>&lt;th&gt;</code>, and <code>&lt;td&gt;</code> with proper attributes and classes (<code>tv-th-left</code>, <code>tv-td-right</code>, etc.). Handles inline code pipes and escaped characters.           </td><td data-label="PasteToTable (Current Behavior and Required Alignment Actions)"> Simplified converter; may omit structural classes and table attributes used by style.css. <strong>Action:</strong> Add missing attributes and class names (<code>class=&quot;tv-table&quot;</code>, etc.) to generated HTML. Ensure no inline styles override CSS. Validate same normalization for escaped pipes and inline code. This file is key to matching typography via structure.           </td></tr><tr><td data-label="File name"> <strong>templates/index.html</strong> </td><td data-label="Table Viewer v2.1 (Reference Behavior)"> Loads assets in strict order: <code>&lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com&quot;&gt;</code>, followed by <code>&lt;link href=&quot;style.css&quot;&gt;</code>, then <code>&lt;script defer src=&quot;script.js&quot;&gt;</code>. TOC appears below header. HTML wrappers use <code>tv-</code> prefixed IDs/classes. </td><td data-label="PasteToTable (Current Behavior and Required Alignment Actions)"> Has different order and simplified layout. TOC may appear above header, and font links or CSS order may differ. <strong>Action:</strong> Replicate asset order and structural wrappers from TV2.1 exactly. Ensure meta viewport, font preload, and body hierarchy match. No inline styles. Verify computed typography (font family, line height, spacing).                    </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table3" data-table="Book_8016_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Phase**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Phase</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Objective**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Objective</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Actions (precise)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Actions (precise)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Expected Result**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Expected Result</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Phase"> <strong>1. Baseline Verification</strong>         </td><td data-label="Objective"> Ensure identical file references and asset paths before typography work begins.      </td><td data-label="Actions (precise)"> - Compare <code>templates/index.html</code> → confirm identical <code>&lt;link&gt;</code> and <code>&lt;script&gt;</code> order to Table Viewer. <br> - Confirm fonts, icons, and TOC placement. <br> - Ensure <code>utils.py</code> produces consistent <code>assets/</code> paths.                                       </td><td data-label="Expected Result"> Environment parity. Same CSS/JS loaded and applied.        </td></tr><tr><td data-label="Phase"> <strong>2. Structural Output Alignment</strong>   </td><td data-label="Objective"> Guarantee that generated table HTML is structurally identical to TV2.1.              </td><td data-label="Actions (precise)"> - Modify <code>render/convert.py</code> to emit the same <code>&lt;table&gt;</code> markup with identical class names and structure. <br> - Validate <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, <code>&lt;tr&gt;</code>, <code>&lt;td&gt;</code>, <code>&lt;th&gt;</code> attributes and spacing. <br> - Confirm pipe escaping and code block preservation. </td><td data-label="Expected Result"> Identical DOM → identical computed typography.             </td></tr><tr><td data-label="Phase"> <strong>3. Renderer Integration</strong>          </td><td data-label="Objective"> Ensure Flask rendering doesn’t alter or wrap the table HTML differently from TV2.1.  </td><td data-label="Actions (precise)"> - In <code>html_renderer.py</code>, align fragment assembly and wrapper <code>&lt;div&gt;</code> hierarchy with Table Viewer’s <code>core_renderer.py</code> and <code>core_table.py</code>. <br> - Use identical <code>tv-*</code> container classes. <br> - Remove redundant inline styles or custom wrappers.     </td><td data-label="Expected Result"> Flask output is visually identical to static TV2.1 output. </td></tr><tr><td data-label="Phase"> <strong>4. Application Entry Consistency</strong> </td><td data-label="Objective"> Unify pipeline invocation path so the same render logic executes whether CLI or web. </td><td data-label="Actions (precise)"> - Audit <code>main.py</code> and <code>server.py</code>. Ensure both call the same render function. <br> - Confirm <code>server.py</code> doesn’t inject parameters that alter render behavior.                                                                                          </td><td data-label="Expected Result"> Predictable rendering from all entry points.               </td></tr><tr><td data-label="Phase"> <strong>5. Path & Asset Validation</strong>       </td><td data-label="Objective"> Avoid cache, version, or relative-path discrepancies that break style consistency.   </td><td data-label="Actions (precise)"> - Adjust <code>utils.py</code> to standardize path resolution. <br> - Ensure no cache-busting or hash injection in asset links. <br> - Verify runtime copying of <code>assets/</code> mirrors Table Viewer behavior.                                                          </td><td data-label="Expected Result"> All font and CSS assets load identically.                  </td></tr><tr><td data-label="Phase"> <strong>6. Visual Regression & Test Pass</strong> </td><td data-label="Objective"> Confirm typography matches benchmark.                                                </td><td data-label="Actions (precise)"> - Compare generated HTMLs side-by-side in browser. <br> - Inspect computed styles (font-family, size, spacing, borders). <br> - Run regression snapshot via browser devtools.                                                                           </td><td data-label="Expected Result"> Visual parity. Zero deviation in computed typography.      </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table4" data-table="Book_8016_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Aspect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Aspect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Merged  CODE0  (first, longer)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Merged  CODE0  (first, longer)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Refactored  CODE1  (second, shorter)"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Refactored  CODE1  (second, shorter)</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Aspect"> Purpose & scope stated                                                                                          </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                       Full-featured merge. Public API includes parsing, rendering, and higher-level conversion helpers (<code>convert_structure</code>, <code>convert_text_to_html</code>). </td><td data-label="Refactored  CODE1  (second, shorter)"> Focused, trimmed. Emphasizes robust parsing and <code>render_table</code>. Lighter surface area.                                                                                                                                                      </td></tr><tr><td data-label="Aspect"> Public API (<code>__all__</code>)                                                                                          </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                             Exports: <code>parse_markdown_tables</code>, <code>parse_csv_tables</code>, <code>render_table</code>, <code>extract_tables_debug</code>, <code>_SimpleDF</code>, <code>_SimpleColumns</code>, <code>convert_structure</code>, <code>convert_text_to_html</code>. </td><td data-label="Refactored  CODE1  (second, shorter)"> Exports: <code>parse_markdown_tables</code>, <code>parse_csv_tables</code>, <code>render_table</code>, <code>extract_tables_debug</code>, <code>_SimpleDF</code>, <code>_SimpleColumns</code>. <strong><code>convert_structure</code> and <code>convert_text_to_html</code> removed</strong>.                                                   </td></tr><tr><td data-label="Aspect"> CSV parsing (<code>parse_csv_tables</code>)                                                                                </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                      Robust. Uses <code>csv.Sniffer</code>, falls back to counts. Pads ragged rows. Returns list of dicts with <code>&quot;rows&quot;</code>, <code>&quot;header&quot;</code>, <code>&quot;source&quot;</code>. </td><td data-label="Refactored  CODE1  (second, shorter)"> Same algorithm and behavior. More docstrings and comments. Functionally equivalent.                                                                                                                                                        </td></tr><tr><td data-label="Aspect"> Markdown pipe-table parser (<code>parse_markdown_tables</code>)                                                            </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                                       Robust. Handles escaped pipes, inline code, outer pipes, divider detection. Returns <code>rows</code>, <code>header</code>, <code>source</code>. </td><td data-label="Refactored  CODE1  (second, shorter)"> Same core parser. Slightly reworded comments and minor refactor to helper layout. Functionally equivalent.                                                                                                                                 </td></tr><tr><td data-label="Aspect"> Debug extraction (<code>extract_tables_debug</code>)                                                                       </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                               Produces <code>_SimpleDF</code> or pandas DataFrame when available. CSV autodetect fallback present. Preserves alignments attribute when possible. </td><td data-label="Refactored  CODE1  (second, shorter)"> Equivalent logic and CSV fallback. Same pandas attempt and <code>_SimpleDF</code> fallback.                                                                                                                                                           </td></tr><tr><td data-label="Aspect"> Markdown fallback renderer                                                                                      </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                       Attempts to import project <code>markdown.get_markdown_renderer</code>. Has fallback <code>_simple_md</code> that preserves inline code and emphasis. </td><td data-label="Refactored  CODE1  (second, shorter)"> Same strategy and an almost-identical fallback implementation.                                                                                                                                                                             </td></tr><tr><td data-label="Aspect"> Fallback utilities (<code>_strip_tags</code>, <code>sanitize_bold_html</code>, <code>convert_markdown_lists</code>, <code>_escape_unmatched_markers</code>) </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                        Present as fallbacks when <code>..utils</code> import fails. Also includes <strong>fallback for <code>_apply_left_col_heading</code></strong> to avoid errors if <code>utils</code> missing. </td><td data-label="Refactored  CODE1  (second, shorter)"> Same fallback set for the listed utilities <strong>but it omits the <code>_apply_left_col_heading</code> fallback block</strong>. <code>render_table</code> still calls <code>_apply_left_col_heading</code> so this assumes <code>utils</code> provides it.                                        </td></tr><tr><td data-label="Aspect"> Left-column heading helper                                                                                      </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                                                                 Safe: imports <code>_apply_left_col_heading</code> with a conservative fallback defined locally. </td><td data-label="Refactored  CODE1  (second, shorter)"> No local fallback for <code>_apply_left_col_heading</code>. Risk of <code>NameError</code> if <code>utils</code> does not provide it.                                                                                                                                       </td></tr><tr><td data-label="Aspect"> Width handling & CSS                                                                                            </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                                 Computes default left/right widths but does not apply inline widths to columns. Comments state widths handled by CSS. </td><td data-label="Refactored  CODE1  (second, shorter)"> Explicitly documents that width control moved to CSS classes. Same runtime behavior (no per-render inline widths).                                                                                                                         </td></tr><tr><td data-label="Aspect"> Rendered HTML structure (<code>render_table</code>)                                                                        </td><td data-label="Merged  CODE0  (first, longer)"> Produces <code>.table-wrapper</code>, <code>.table-heading-bar</code>, <code>&lt;h3 id=&quot;table-{idx}&quot;&gt;</code>, <code>.table-container</code>, table with <code>class=&quot;tv-table&quot;</code>, <code>.tv-col-left</code>/<code>.tv-col</code> classes on <code>&lt;th&gt;</code>, copy/export buttons, toggle button. Handles markdown conversion for cell content, sanitization, left-col heading application, and unmatched marker escaping. </td><td data-label="Refactored  CODE1  (second, shorter)"> Same output structure and button set. Slight code cleanups and comments. Behaviorally equivalent except for reliance on <code>_apply_left_col_heading</code> from utils.                                                                              </td></tr><tr><td data-label="Aspect"> Higher-level convert helpers                                                                                    </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                                               Includes <code>convert_structure</code> and <code>convert_text_to_html</code> for single/multi-table conversion and metadata. </td><td data-label="Refactored  CODE1  (second, shorter)"> These helpers are removed. Callers expecting them will break.                                                                                                                                                                              </td></tr><tr><td data-label="Aspect"> Logging / error handling                                                                                        </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                                                      Extensive try/except blocks, debug logging calls. Includes <code>logger.exception</code> in several places. </td><td data-label="Refactored  CODE1  (second, shorter)"> Similar try/except coverage. Logging calls retained.                                                                                                                                                                                       </td></tr><tr><td data-label="Aspect"> Comments & docstrings                                                                                           </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                                                                                                Present but less compact. Includes verification notes. </td><td data-label="Refactored  CODE1  (second, shorter)"> More concise docstrings and explanatory comments.                                                                                                                                                                                          </td></tr><tr><td data-label="Aspect"> Risk / breaking changes                                                                                         </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                                                Backwards-compatible API including higher-level helpers. Safer fallback for <code>_apply_left_col_heading</code>. </td><td data-label="Refactored  CODE1  (second, shorter)"> <strong>API change</strong>: removal of <code>convert_structure</code> and <code>convert_text_to_html</code>. <strong>Missing fallback</strong> for <code>_apply_left_col_heading</code>. Both are potential regressions.                                                                             </td></tr><tr><td data-label="Aspect"> Recommended immediate fixes before swapping in refactor                                                         </td><td data-label="Merged  CODE0  (first, longer)">                                                                                                                                                                                                                                                                                                                                     — </td><td data-label="Refactored  CODE1  (second, shorter)"> 1) Re-add <code>convert_structure</code> and <code>convert_text_to_html</code> wrappers or update callers. 2) Reintroduce <code>_apply_left_col_heading</code> fallback to guarantee resilience when <code>utils</code> import fails. 3) Run unit tests that call the removed helpers. </td></tr></tbody></table></div><div class="row-count">Rows: 15</div></div><div class="table-caption" id="Table5" data-table="Book_8016_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Input / Problem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Input / Problem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Change → Effect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change → Effect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Input / Problem"> Minor API drift vs Table Viewer (alignment metadata lost)                   </td><td data-label="Change → Effect"> Ensure DataFrame/_SimpleDF carry <code>.alignments</code> and, if pandas, set <code>df._table_alignments</code>. Effect: downstream TV2.1 code that reads column alignments keeps working.     </td></tr><tr><td data-label="Input / Problem"> Left-column heading behavior depends on utils                               </td><td data-label="Change → Effect"> Prefer project's <code>_apply_left_col_heading</code> when present; keep conservative no-op fallback. Effect: preserves semantic left-heading transforms without risking NameError. </td></tr><tr><td data-label="Input / Problem"> Header cell HTML sometimes wrapped in extra <code>&lt;p&gt;</code> that breaks CSS targeting </td><td data-label="Change → Effect"> When rendering header cells, strip outer <code>&lt;p&gt;</code> wrappers but keep inline markup. Effect: header DOM matches TV2.1 selectors and CSS applies identically.                  </td></tr><tr><td data-label="Input / Problem"> CSV header detection heuristics differ slightly                             </td><td data-label="Change → Effect"> Tighten <code>parse_csv_tables</code> header heuristic to prefer non-numeric first-row detection as TV2.1 does. Effect: consistent header vs body allocation.                       </td></tr><tr><td data-label="Input / Problem"> <code>_escape_unmatched_markers</code> may be a no-op in fallback                      </td><td data-label="Change → Effect"> If utils provides <code>_escape_unmatched_markers</code>, use it; otherwise provide safer fallback that escapes stray markdown markers (<code>                                           | </code>, <code>:</code>) only outside code. Effect: reduces accidental layout breaks from unescaped markers. </td></tr><tr><td data-label="Input / Problem"> <code>render_table</code> sample streaming may consume iterator early                  </td><td data-label="Change → Effect"> Use <code>_take_and_stream</code> defensively and ensure <code>iterator</code> is always re-chainable. Effect: avoids lost-first-row bugs when df is generator.                                </td></tr><tr><td data-label="Input / Problem"> Cell markdown → HTML conversion can collapse needed <code>&lt;br&gt;</code>s                 </td><td data-label="Change → Effect"> Preserve double-newline blocks and fence blocks; only collapse single newlines outside code. Effect: maintains intended paragraphing like TV2.1.                         </td></tr><tr><td data-label="Input / Problem"> Missing test hooks and deterministic outputs                                </td><td data-label="Change → Effect"> Add optional <code>test_mode</code> flag or internal <code>__test_snapshot_inputs</code> hook to emit normalized DOM for unit tests. Effect: enables deterministic visual regression tests.    </td></tr><tr><td data-label="Input / Problem"> Minor performance: repeated html.unescape and typomap runs                  </td><td data-label="Change → Effect"> Normalize and reuse <code>txt</code> once per call and minimize redundant transforms in parsing functions. Effect: small speedup and identical normalization to TV2.1.              </td></tr><tr><td data-label="Input / Problem"> Pandas vs _SimpleDF divergence on column names                              </td><td data-label="Change → Effect"> When creating <code>_SimpleDF</code> from pandas fallback, preserve original column objects (stringified) to avoid subtle repr changes. Effect: header labels identical textually.  </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table6" data-table="Book_8016_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Input / Problem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Input / Problem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Change → Effect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change → Effect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Input / Problem"> Table alignments extracted but not applied to DOM                 </td><td data-label="Change → Effect"> Use <code>tbl._table_alignments</code> or <code>df.alignments</code> when present. Emit <code>data-align=&quot;left                                                                                                                               | center | right&quot;</code>on<code>&lt;th&gt;</code>and<code>class=&quot;align-left/center/right&quot;</code>on<code>&lt;td&gt;</code> rows. Effect: visual column alignment matches TV2.1 exactly. </td></tr><tr><td data-label="Input / Problem"> No alignment fallback when divider row missing                    </td><td data-label="Change → Effect"> Run <code>_detect_column_types</code> on the first 5 rows when no divider alignments. Set numeric columns to <code>data-align=&quot;right&quot;</code>. Effect: numeric columns render right-aligned like TV2.1 without explicit <code>:---:</code> markers. </td></tr><tr><td data-label="Input / Problem"> Header HTML wrapper stripping partial                             </td><td data-label="Change → Effect"> Keep current header <code>&lt;p&gt;</code> strip but also normalize inner whitespace and preserve inline tags. Effect: CSS selectors for header text match TV2.1 and avoid extra spacing.                                          </td></tr><tr><td data-label="Input / Problem"> Export/copy buttons order must match benchmark                    </td><td data-label="Change → Effect"> Ensure exact label & order already used. Small change: add <code>aria-label</code> matching visible text for screen readers. Effect: perfect parity with TV2.1 UI and accessibility.                                         </td></tr><tr><td data-label="Input / Problem"> Alignments lost when using pandas <code>_table_alignments</code>             </td><td data-label="Change → Effect"> When a pandas DataFrame is present, read <code>_table_alignments</code> and copy to <code>df._table_alignments</code> and <code>df.alignments</code>. Effect: downstream code in both projects sees same alignment metadata.                       </td></tr><tr><td data-label="Input / Problem"> Cell-level <code>data-label</code> already present but not data-align        </td><td data-label="Change → Effect"> Add <code>data-align</code> on <code>&lt;td&gt;</code> to mirror <code>&lt;th&gt;</code> alignment. Effect: mobile stacked layouts keep alignment information for CSS.                                                                                         </td></tr><tr><td data-label="Input / Problem"> Iterator sample streaming may hide sample used for type-detection </td><td data-label="Change → Effect"> Use <code>_take_and_stream</code> output consistently for type-detection and rendering so sample rows are not consumed twice. Effect: no lost-first-row bug; types and alignments consistent.                                </td></tr><tr><td data-label="Input / Problem"> Deterministic snapshot hook present but not mirroring TV markers  </td><td data-label="Change → Effect"> Keep <code>test_mode</code> marker but use <code>data-test=&quot;convert-v1&quot;</code> to version snapshots. Effect: reproducible visual-diff snapshots across projects.                                                                        </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table7" data-table="Book_8016_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Input / Problem**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Input / Problem</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Change → Effect**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Change → Effect</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Input / Problem"> Emit explicit alignment CSS classes on headers                      </td><td data-label="Change → Effect"> Add <code>class=&quot;th-align-left                                                                                                                                                                                              | center | right&quot;</code>to<code>&lt;th&gt;</code>in addition to<code>data-align</code> → CSS selectors in TV2.1 that target header alignment will match exactly </td></tr><tr><td data-label="Input / Problem"> Emit table-level alignment map for JS and tests                     </td><td data-label="Change → Effect"> Add <code>data-table-alignments=&quot;left,center,right,...&quot;</code> on <code>.table-wrapper</code> → downstream JS (TV2.1) can read column alignments without re-parsing the DOM                                                                  </td></tr><tr><td data-label="Input / Problem"> Stronger fallback when <code>sample_buf</code> is empty                        </td><td data-label="Change → Effect"> If <code>_take_and_stream</code> returns empty buffer, attempt non-destructive <code>itertools.islice</code> peek of up to 5 rows or safely coerce to list → numeric-detection and alignment heuristics remain reliable for generator inputs </td></tr><tr><td data-label="Input / Problem"> Ensure pandas alignment metadata round-trip                         </td><td data-label="Change → Effect"> When a pandas DataFrame has <code>_table_alignments</code>, copy to <code>df.alignments</code>, and vice versa if missing → both code paths share alignment metadata consistently                                                            </td></tr><tr><td data-label="Input / Problem"> Normalize <code>align-*</code> class naming and ensure <code>td</code>/<code>th</code> both get them </td><td data-label="Change → Effect"> Use <code>align-left/center/right</code> on <code>&lt;td&gt;</code> and <code>th-align-left/...</code> on <code>&lt;th&gt;</code> → exact parity with TV2.1 CSS rules                                                                                                          </td></tr><tr><td data-label="Input / Problem"> Preserve header cell inline markup but normalize whitespace         </td><td data-label="Change → Effect"> Strip outer <code>&lt;p&gt;</code> wrapper and collapse internal repeated whitespace → identical rendered text width and overflow behavior                                                                                              </td></tr><tr><td data-label="Input / Problem"> Small accessibility tweak                                           </td><td data-label="Change → Effect"> Add <code>scope=&quot;col&quot;</code> on <code>&lt;th&gt;</code> → accessibility parity and screen-reader compatibility with TV2.1                                                                                                                          </td></tr><tr><td data-label="Input / Problem"> Add minimal JSON-safe snapshot attribute when <code>test_mode</code> enabled   </td><td data-label="Change → Effect"> Add <code>data-test-alignments</code> mirror of <code>data-table-alignments</code> → deterministic visual-diff tooling can read alignment state                                                                                              </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table8" data-table="Book_8016_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Input / Problem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Input / Problem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Change → Effect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Change → Effect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Input / Problem"> <code>data-table-alignments</code> missing on wrapper   </td><td data-label="Change → Effect"> Emit <code>data-table-alignments=&quot;left,center,...&quot;</code> on the existing <code>.table-wrapper</code> (not a separate node). Effect: downstream JS and tests read alignments directly without DOM parsing.                                                        </td></tr><tr><td data-label="Input / Problem"> <code>&lt;th&gt;</code> lacks explicit header alignment class </td><td data-label="Change → Effect"> Add <code>th-align-left</code>, <code>th-align-center</code>, or <code>th-align-right</code> class on each <code>&lt;th&gt;</code> in addition to <code>data-align</code>. Effect: TV2.1 CSS selectors match exactly.                                                                                    </td></tr><tr><td data-label="Input / Problem"> <code>&lt;th&gt;</code> missing <code>scope=&quot;col&quot;</code>                 </td><td data-label="Change → Effect"> Add <code>scope=&quot;col&quot;</code> to each <code>&lt;th&gt;</code>. Effect: a11y parity with TV2.1 and consistent screen-reader behavior.                                                                                                                                     </td></tr><tr><td data-label="Input / Problem"> Header <code>&lt;p&gt;</code> wrappers and whitespace differ  </td><td data-label="Change → Effect"> Strip outer <code>&lt;p&gt;</code> but preserve inline tags. Collapse repeated whitespace inside header text. Effect: identical measured text width, overflow behavior, and CSS targeting.                                                                   </td></tr><tr><td data-label="Input / Problem"> Alignments lost for pandas or debug path     </td><td data-label="Change → Effect"> When pandas DF has <code>_table_alignments</code> copy to <code>df.alignments</code>. When only <code>alignments</code> exist, create <code>_table_alignments</code>. Also accept debug <code>_alignments</code> produced by extract. Effect: alignment metadata round-trips across both projects. </td></tr><tr><td data-label="Input / Problem"> Generator/iterator consumption risk          </td><td data-label="Change → Effect"> Use <code>itertools.tee</code> or safe non-destructive peek for up to 5 rows. Ensure returned iterator yields full sequence (no lost-first-row). Effect: numeric-detection and rendering consistent for generator inputs.                              </td></tr><tr><td data-label="Input / Problem"> Class names normalization mismatch           </td><td data-label="Change → Effect"> Use <code>align-left</code>, <code>align-center</code>, <code>align-right</code> on <code>&lt;td&gt;</code> and <code>th-align-left</code>, <code>th-align-center</code>, <code>th-align-right</code> on <code>&lt;th&gt;</code> consistently. Effect: exact CSS rule matches with TV2.1 (keeps header selectors distinct).                     </td></tr><tr><td data-label="Input / Problem"> Test/snapshot support                        </td><td data-label="Change → Effect"> When <code>test_mode</code> true, emit <code>data-test-alignments</code> on <code>.table-wrapper</code> and include render marker. Effect: deterministic visual-diff tooling can validate alignment state.                                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table9" data-table="Book_8016_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Refinement"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Refinement</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Technical Effect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Technical Effect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Refinement"> Remove any auxiliary <code>.table-align-meta</code> node if present; keep <code>data-table-alignments</code> only on <code>.table-wrapper</code>.                    </td><td data-label="Technical Effect"> Prevents redundant DOM nodes that could interfere with CSS layout or selector accuracy. </td></tr><tr><td data-label="Refinement"> Use exact TV2.1 class names: <code>th-align-left</code>, <code>th-align-center</code>, <code>th-align-right</code>, and <code>align-left</code>, <code>align-center</code>, <code>align-right</code>. </td><td data-label="Technical Effect"> Ensures full CSS compatibility with TV2.1 without fallback selectors.                   </td></tr><tr><td data-label="Refinement"> Normalize header inner HTML: strip outer <code>&lt;p&gt;</code>, collapse redundant whitespace, preserve inline tags and zero-width spaces.          </td><td data-label="Technical Effect"> Maintains consistent header sizing and ellipsis rendering identical to TV2.1.           </td></tr><tr><td data-label="Refinement"> Keep bidirectional sync between <code>_table_alignments</code> and <code>df.alignments</code>, including <code>extract_tables_debug</code> outputs.                  </td><td data-label="Technical Effect"> Guarantees consistent alignment metadata for both standard and debug pipelines.         </td></tr><tr><td data-label="Refinement"> Keep <code>scope=&quot;col&quot;</code>, <code>aria-label</code>, and add <code>aria-sort=&quot;none&quot;</code> on <code>&lt;th&gt;</code> when TV2.1 uses it.                                          </td><td data-label="Technical Effect"> Matches accessibility and semantic attributes for screen readers and sorting states.    </td></tr><tr><td data-label="Refinement"> Maintain <code>test_mode</code> flag to emit only <code>data-test-alignments</code> attribute, not extra nodes.                                           </td><td data-label="Technical Effect"> Ensures clean deterministic DOM snapshots for automated tests.                          </td></tr><tr><td data-label="Refinement"> Verify non-destructive generator peeking via <code>itertools.tee</code> fallback.                                                              </td><td data-label="Technical Effect"> Confirms safe preview without consuming iterators.                                      </td></tr><tr><td data-label="Refinement"> Confirm per-<code>th</code> and per-<code>td</code> data-align attributes plus matching classes and table-level <code>data-table-alignments</code>.                  </td><td data-label="Technical Effect"> Guarantees alignment metadata and CSS class integrity.                                  </td></tr><tr><td data-label="Refinement"> Ensure all <code>&lt;th&gt;</code> have <code>scope=&quot;col&quot;</code>, <code>data-align</code>, and <code>th-align-*</code>; all <code>&lt;td&gt;</code> have <code>data-align</code> and <code>align-*</code>.                   </td><td data-label="Technical Effect"> Matches exact DOM structure of TV2.1.                                                   </td></tr><tr><td data-label="Refinement"> Run local render test using benchmark tables to verify computed font, spacing, and overflow match TV2.1 results.                    </td><td data-label="Technical Effect"> Confirms visual and typographic parity under CSS rules.                                 </td></tr><tr><td data-label="Refinement"> Validate no <code>.table-align-meta</code> residual elements.                                                                                  </td><td data-label="Technical Effect"> Prevents obsolete node artifacts.                                                       </td></tr><tr><td data-label="Refinement"> Validate <code>data-table-alignments</code> presence and accuracy.                                                                             </td><td data-label="Technical Effect"> Confirms metadata embedding correctness.                                                </td></tr><tr><td data-label="Refinement"> Confirm generator and pandas inputs yield identical alignment logic paths.                                                          </td><td data-label="Technical Effect"> Ensures code consistency across data sources.                                           </td></tr><tr><td data-label="Refinement"> Check style.css alignment classes (<code>.align-left</code>, <code>.align-center</code>, <code>.align-right</code>) exist and are scoped correctly.                  </td><td data-label="Technical Effect"> Completes stylesheet compliance audit.                                                  </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><div class="table-caption" id="Table10" data-table="Book_8016_10" style="margin-top:2mm;margin-left:3mm;"><strong>Table 10</strong></div>
<div class="table-wrapper" data-table-id="table-10"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Problem"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Problem</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Fix → Effect"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Fix → Effect</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Problem"> Button actions firing twice </td><td data-label="Fix → Effect"> Make script idempotent. Add global init guard and ensure event/export wiring runs only once. Prevents double-binding when script is injected twice.                                  </td></tr><tr><td data-label="Problem"> Generated .xlsx is invalid  </td><td data-label="Fix → Effect"> Build XLSX ZIP more robustly. Create Blob from the exact ArrayBuffer slice of the generated Uint8Array and add a small sanity check. This improves compatibility with Excel readers. </td></tr></tbody></table></div><div class="row-count">Rows: 2</div></div><div class="table-caption" id="Table11" data-table="Book_8016_11" style="margin-top:2mm;margin-left:3mm;"><strong>Table 11</strong></div>
<div class="table-wrapper" data-table-id="table-11"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Item**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Item</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Explanation**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Explanation</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Item"> <strong>Scanned</strong>                      </td><td data-label="Explanation"> Yes. Full <code>index.html</code> provided and absorbed.                                                                                                                                                                                                                       </td></tr><tr><td data-label="Item"> <strong>Paste textarea</strong>               </td><td data-label="Explanation"> <code>textarea#paste</code> lives inside <code>&lt;form id=&quot;render-form&quot; ...&gt;</code> in the header (<code>.header-paste-container</code>). <code>name=&quot;text&quot;</code>, placeholder present.                                                                                                                          </td></tr><tr><td data-label="Item"> <strong>Paste-panel</strong>                  </td><td data-label="Explanation"> <code>#paste-panel</code> remains in DOM but is hidden (<code>display:none</code>, <code>aria-hidden=&quot;true&quot;</code>) for compatibility.                                                                                                                                                               </td></tr><tr><td data-label="Item"> <strong>Top buttons / IDs</strong>            </td><td data-label="Explanation"> Header contains <code>exportAllBtn</code>, <code>clearBtn</code>, <code>togglePasteBtn</code>, <code>convertBtn</code>, <code>renderBtn</code>, <code>saveBtn</code>. <code>renderBtn</code> submits <code>form=&quot;render-form&quot;</code>.                                                                                                                       </td></tr><tr><td data-label="Item"> <strong>Tables viewer structure</strong>      </td><td data-label="Explanation"> <code>#tables-viewer</code> contains example table blocks: <code>.table-wrapper</code> → <code>.table-container</code> → <code>.table-header-wrapper</code>, <code>.copy-buttons</code>, <code>table.tv-table</code> with <code>thead</code>/<code>tbody</code>.                                                                                            </td></tr><tr><td data-label="Item"> <strong>Inline handlers</strong>              </td><td data-label="Explanation"> Many copy/export buttons include inline <code>onclick=&quot;copyTablePlain(this)&quot;</code> etc. Scripts also attach delegated handlers.                                                                                                                                               </td></tr><tr><td data-label="Item"> <strong>Routing helper</strong>               </td><td data-label="Explanation"> <code>PasteToTable.routeHtmlToAreas(html,meta)</code> defined. Routes full pages into <code>#page-area</code> and fragments into <code>#tables-viewer</code>.                                                                                                                                        </td></tr><tr><td data-label="Item"> <strong>Scripts loaded</strong>               </td><td data-label="Explanation"> <code>&lt;script defer&gt;</code> loads <code>assets/xlsx.full.min.js</code>, <code>assets/script.js</code> (<code>data-core=&quot;script&quot;</code>), and <code>assets/worker.js</code> in that order.                                                                                                                                  </td></tr><tr><td data-label="Item"> <strong>TOC elements</strong>                 </td><td data-label="Explanation"> <code>#toc</code>, <code>#tocList</code>, <code>#tocBar</code>, <code>#tocBarList</code> present. <code>buildSingleTableToc</code> expected by script.                                                                                                                                                                     </td></tr><tr><td data-label="Item"> <strong>Form action</strong>                  </td><td data-label="Explanation"> <code>form#render-form</code> posts to <code>/api/render</code> (server-side render path preserved).                                                                                                                                                                                      </td></tr><tr><td data-label="Item"> <strong>Accessibility</strong>                </td><td data-label="Explanation"> ARIA attributes present on header, toolbar, tables and nav elements.                                                                                                                                                                                                </td></tr><tr><td data-label="Item"> <strong>Observed problems (relevant)</strong> </td><td data-label="Explanation"> <code>safeSetHTML</code> missing in script (prevents <code>doConvert</code>/<code>doRender</code> inserting returned HTML). Script also removes <code>#togglePasteBtn</code> elsewhere which may conflict with UI intent.                                                                                       </td></tr><tr><td data-label="Item"> <strong>Behavioral notes</strong>             </td><td data-label="Explanation"> <code>routeHtmlToAreas</code> + <code>safeSetHTML</code> are the correct routing pattern for fragment vs full-page responses. <code>#tables-viewer</code> exists and will accept inserted HTML once <code>safeSetHTML</code> is added.                                                                          </td></tr><tr><td data-label="Item"> <strong>Benchmark</strong>                    </td><td data-label="Explanation"> Reference acknowledged: [https://github.com/adiskurniawan/ChapterSummaries_2.0/raw/refs/heads/main/summaries/Book_9001.html](https://github.com/adiskurniawan/ChapterSummaries_2.0/raw/refs/heads/main/summaries/Book_9001.html) — will be included in every reply. </td></tr></tbody></table></div><div class="row-count">Rows: 14</div></div><div class="table-caption" id="Table12" data-table="Book_8016_12" style="margin-top:2mm;margin-left:3mm;"><strong>Table 12</strong></div>
<div class="table-wrapper" data-table-id="table-12"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Analysis / Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Analysis / Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>File overview</strong>                        </td><td data-label="Analysis / Notes"> The file is large (~100 KB), well-structured, modular but still inline-procedural in places. Uses vanilla JS with a few ES6+ features (template literals, arrow functions, optional chaining). No external framework dependencies — just DOM and event APIs. Strong emphasis on <code>PasteToTable</code> namespace exposure under <code>window</code>. Comments mark version merges and major feature blocks.                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Namespace & init</strong>                     </td><td data-label="Analysis / Notes"> <code>window.PasteToTable = { … }</code> encapsulates main functions like <code>convertTextToTable</code>, <code>initUI</code>, <code>bindEvents</code>, etc. The code guards against duplicate initialization with a flag <code>window.PasteToTable.__initialized</code>. Good safety measure, but certain sub-functions are redeclared inline later — could lead to race if re-bound manually.                                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>DOM caching & selectors</strong>              </td><td data-label="Analysis / Notes"> It caches DOM references (<code>#pasteInput</code>, <code>#convertBtn</code>, <code>#tables-viewer</code>, etc.). Uses <code>document.getElementById</code> for speed. Re-queries a few nodes inside handlers instead of reusing cached references, which slightly risks mismatch after re-render (e.g. when <code>.innerHTML</code> is replaced). This could cause button re-binding twice.                                                                                                                                                                                </td></tr><tr><td data-label="Section"> <strong>Event binding pattern</strong>                </td><td data-label="Analysis / Notes"> Listeners are added at two layers: direct element listeners and delegated <code>document.addEventListener(&#x27;click&#x27;, …)</code> blocks. The delegated handler watches for <code>[data-action]</code> buttons (copy/export/toggle). That’s correct and scalable. But near the “Convert” logic, a <em>direct</em> listener to <code>#convertBtn</code> also calls the same core function. If the UI is rebuilt (e.g. by re-inserting HTML into the viewer), that listener may attach again if <code>initUI()</code> runs twice → duplicated clicks.                          </td></tr><tr><td data-label="Section"> <strong>Convert pipeline</strong>                     </td><td data-label="Analysis / Notes"> When Convert is clicked: <br>1. <code>getPasteContent()</code> reads the textarea.<br>2. Sends content to <code>convertTextToHTML()</code> (which wraps serverless logic calling <code>/convert</code> or directly invoking <code>render.convert_text_to_html</code>).<br>3. Then updates <code>#tables-viewer.innerHTML</code> with the result.<br>4. Calls <code>refreshTableEvents()</code> to re-bind listeners. <br>Issue: If <code>refreshTableEvents()</code> doesn’t first clear old bindings (e.g. via <code>replaceWith</code> or cloning node), each Convert call may add another listener layer. </td></tr><tr><td data-label="Section"> <strong>Buttons appearing twice</strong>              </td><td data-label="Analysis / Notes"> The duplication you asked about likely happens <em>after re-convert</em>. The JS may re-append header toolbars instead of replacing them, depending on this fragment: <br><code>tablesContainer.insertAdjacentHTML(&#x27;beforeend&#x27;, html)</code> instead of setting <code>.innerHTML = html</code>. <br>If that’s the case, new toolbars are added <em>after</em> the old ones, giving the appearance of doubled buttons.                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Button repositioning</strong>                 </td><td data-label="Analysis / Notes"> If you see the buttons “moving” rather than doubling, it’s likely from <code>style.css</code> flex auto-wrap triggered by table width recalculation after conversion. The script triggers <code>resizeObserver</code> or <code>window.dispatchEvent(new Event(&#x27;resize&#x27;))</code> after rendering, causing the flexbox to recalc. Buttons move to next line if container width shrinks.                                                                                                                                                                 </td></tr><tr><td data-label="Section"> <strong>Conversion output injection</strong>          </td><td data-label="Analysis / Notes"> Code uses a safety layer: <code>sanitizeHTML(htmlString)</code> → ensures no script injection. It creates a <code>&lt;template&gt;</code> element and sets <code>.innerHTML</code> to sanitize nodes before appending. That’s good. But if <code>sanitizeHTML</code> returns a new <code>DocumentFragment</code>, and code uses <code>appendChild(fragment)</code> each time, then previously rendered content stays. That’s your duplication source.                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>UI restoration logic</strong>                 </td><td data-label="Analysis / Notes"> There’s a block like <code>if (state.lastHTML) { viewer.innerHTML = state.lastHTML; }</code> on load — harmless. But on Convert, the pipeline calls both <code>clearTablesViewer()</code> and <code>renderConvertedTables()</code> in sequence. If <code>clearTablesViewer()</code> is commented out or replaced with a fade animation (using <code>opacity</code> then delayed clear), the next append may happen before clearing finishes → visible overlap.                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Copy/export handlers</strong>                 </td><td data-label="Analysis / Notes"> Each export button calls a shared <code>handleExportClick(e)</code> which determines the format from <code>data-action</code>. These are delegated from document level — safe. They’re not duplicated. So the duplication is visual (DOM doubling), not event duplication.                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Section"> <strong>Toggle (Collapse Table)</strong>              </td><td data-label="Analysis / Notes"> Bound via <code>onclick=&quot;toggleTable(this)&quot;</code> inside HTML produced by Python. The JS also defines <code>function toggleTable(btn){…}</code> globally. No redefinition loops, fine. However, the button’s parent wrapper might get cloned during re-render. So you’ll see two “Collapse Table” rows if the HTML isn’t cleared first.                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Mutation / observer usage</strong>            </td><td data-label="Analysis / Notes"> The script attaches a <code>MutationObserver</code> to <code>#tables-viewer</code> to re-bind sorting or resize observers after each DOM update. If that observer isn’t disconnected before new HTML insertion, it may trigger again recursively, duplicating children in rapid succession.                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Section"> <strong>Sorting / dynamic header behavior</strong>    </td><td data-label="Analysis / Notes"> The file includes a section for sortable headers (<code>th[aria-sort]</code> toggles). That code sometimes rebuilds the header row with <code>cloneNode(true)</code> to reset sort icons. If triggered during Convert, the newly rendered table could momentarily re-append to the old one before replace → again, duplication.                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Visual clue</strong>                          </td><td data-label="Analysis / Notes"> If you inspect the viewer after two conversions and see <code>&lt;div class=&quot;table-wrapper&quot; data-table-id=&quot;table-1&quot;&gt;</code> repeated twice, that confirms the issue: the insertion mode is append not replace. The Python output itself is fine; it always starts <code>&lt;div class=&quot;table-wrapper&quot;…&gt;</code> fresh.                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Where to look first</strong>                  </td><td data-label="Analysis / Notes"> Search in <code>script.js</code> for <code>insertAdjacentHTML</code>, <code>appendChild</code>, or <code>.innerHTML</code> under something like <code>renderConvertedTables</code> or <code>updateViewer</code>. The fix: replace any <code>insertAdjacentHTML(&#x27;beforeend&#x27;, html)</code> with <code>innerHTML = html</code> or clear before appending.                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Layout fallback</strong>                      </td><td data-label="Analysis / Notes"> CSS uses flex wrapping. When the number of buttons changes (like after export toggling), the container’s width can shrink temporarily before the browser paints new widths, making the buttons jump. A small <code>min-width</code> on <code>.copy-buttons</code> can lock their position.                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Section"> <strong>Next verification step</strong>               </td><td data-label="Analysis / Notes"> Tomorrow, we’ll confirm whether the duplication occurs in: <br>1. The DOM injection step (append vs replace).<br>2. The observer callback (re-insertion).<br>3. The <code>refreshTableEvents()</code> call (double binding). <br>We’ll trace line numbers for each.                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Integrity summary</strong>                    </td><td data-label="Analysis / Notes"> No critical corruption found — no unbounded loops or memory leaks visible from static reading. The issue is likely a cosmetic duplication caused by safe-but-redundant re-append. Everything else (copy/export) works through data attributes and shouldn’t spawn new buttons.                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Recommended quick patch (conceptual)</strong> </td><td data-label="Analysis / Notes"> Before <code>tablesContainer.insertAdjacentHTML</code> or <code>appendChild</code>: add <code>tablesContainer.innerHTML = &quot;&quot;</code>. Then append the new content. That guarantees single copy. Alternatively, call <code>replaceChildren(fragment)</code> which is safe and atomic.                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Further audit</strong>                        </td><td data-label="Analysis / Notes"> Tomorrow: deeper 2-pass analysis — identify every write to <code>innerHTML</code>, every observer <code>.observe()</code>, and each global function re-declaration. That’ll confirm if there’s any cumulative UI buildup or accidental race.                                                                                                                                                                                                                                                                                               </td></tr></tbody></table></div><div class="row-count">Rows: 20</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>