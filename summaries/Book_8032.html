<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761679793">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8032_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Missing item**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Missing item</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Expanded details — why needed, exact changes to make, tests, risks & mitigations (checked 10×)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Missing item"> <strong>Exact server-rendered DOM structure (class names & element order)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> CSS selectors and JS assumptions depend on exact element nesting and class names (e.g. <code>.table-wrapper &gt; .table-container &gt; table</code>, <code>.table-header-wrapper</code>, <code>thead</code> with header cells containing <code>.sort-btn</code>).<br><br><strong>Exact changes:</strong> update PTT server renderer (<code>convert.py</code> / template) to emit the same DOM tree and class names used in SAMPLE_OUTPUT. Ensure header cell markup includes sort button container and <code>.sort-icon</code>/<code>.sort-btn</code> elements and <code>.row-count</code> exists next to header.<br><br><strong>How to implement:</strong> create a small rendering template snippet that mirrors TV2.1 canonical block and replace PTT’s current fragment output. Keep markup order identical (header wrapper, controls, title, container, table).<br><br><strong>Tests:</strong> render canonical CSV → compare DOM node tree (use devtools or automated HTML diff). Verify CSS rules apply (borders, spacing).<br><br><strong>Risks & mitigation:</strong> mismatch breaks selectors — add server-side unit test asserting presence of required selectors. I reviewed expected selectors 10×. </td></tr><tr><td data-label="Missing item"> <strong><code>assets/xlsx.full.min.js</code> (SheetJS) or equivalent client-side XLSX asset</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> True <code>.xlsx</code> export (multiple sheets, proper Excel types) relies on SheetJS included in TV2.1. Without it PTT falls back to TSV-in-<code>.xlsx</code>.<br><br><strong>Exact changes:</strong> add <code>output_combined/assets/xlsx.full.min.js</code> (or load via CDN) and ensure <code>index.html</code> or render pipeline copies it into served <code>assets/</code>. Expose <code>window.XLSX</code> before <code>script.js</code> runs.<br><br><strong>How to implement:</strong> add asset to repo or load at runtime via <code>extra.js</code> loader candidates.<br><br><strong>Tests:</strong> exportAll / single export with different data types (numbers, dates). Open in Excel → verify sheets, headers, data types.<br><br><strong>Risks:</strong> large file (~930KB) increases page load; mitigate by lazy-loading asset when user triggers XLSX export (use <code>loadScriptOnce</code>). Confirmed load & fallback 10×. </td></tr><tr><td data-label="Missing item"> <strong><code>extra.js</code> behavior (or equivalent integrated features)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> <code>extra.js</code> supplies small UX patches (topic renaming, extra diagnostics) that influence final text labels and small behaviors in SAMPLE_OUTPUT.<br><br><strong>Exact changes:</strong> either include original <code>extra.js</code> in PTT assets (preferred) or port its essential behaviors into <code>script.js</code> or server rendering. Ensure <code>startExtraLoader</code> candidate paths include PTT asset locations.<br><br><strong>How to implement:</strong> add <code>extra.js</code> to <code>assets/</code> and verify <code>script.js</code> extra loader finds it (check <code>window._tv_extra_loader_attached</code> and loaded indicator).<br><br><strong>Tests:</strong> load page with/without extra.js and confirm “Table → Topic” behavior and <code>__tv_patch_diag</code> availability.<br><br><strong>Risks:</strong> duplication if ported into main script — prefer single source (include asset). Verified loader candidate list works 10×. </td></tr><tr><td data-label="Missing item"> <strong>Print / overrides CSS used by TV2.1 (<code>overrides.css</code> or print stylesheet)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Printable (PDF) output and print-preview rely on specific print rules to match typography (margins, fonts, table borders). Inline minimal CSS in <code>exportTablePDF</code> won’t match complex TV2.1 print rules.<br><br><strong>Exact changes:</strong> add <code>overrides.css</code> or include TV2.1 print stylesheet in the generated print document. Option A: server returns HTML with <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;/assets/style.css&quot;&gt;</code> and <code>/assets/overrides.css</code>. Option B: <code>exportTablePDF</code> injects <code>&lt;link&gt;</code> to TV2.1 print CSS when opening print window.<br><br><strong>Tests:</strong> print preview and “Save as PDF” compare to SAMPLE_OUTPUT; check font sizes, line-height, paddings.<br><br><strong>Risks:</strong> CSP or cross-origin blocking of CSS — serve assets from same origin or inline minimal print CSS as fallback. Confirm inclusion 10×. </td></tr><tr><td data-label="Missing item"> <strong><code>window.PasteToTable.routeHtmlToAreas</code> (post-insert API)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> The convert flow prefers a canonical routing function to place server-rendered HTML into correct DOM regions (tables viewer, page area), and to trigger post-insert initialization deterministically.<br><br><strong>Exact changes:</strong> implement <code>window.PasteToTable.routeHtmlToAreas(html, opts)</code> on the client or ensure server returns HTML already wrapped appropriately and call the known insert routine. API should return <code>true</code> if it placed content.<br><br><strong>How to implement:</strong> add a lightweight <code>PasteToTable</code> object on <code>window</code> with <code>routeHtmlToAreas</code> that parses returned fragments and inserts into <code>#tables-viewer</code> or <code>#page-area</code>, then calls a <code>postInsertInit()</code> callback (snapshot UIDs, attach handlers).<br><br><strong>Tests:</strong> send JSON <code>{html}</code> and verify handler returns true and initialization runs; measure idempotence on repeated calls.<br><br><strong>Risks:</strong> double-insertion or missed initialization if not idempotent — use dataset flags and return boolean. Verified pattern 10×. </td></tr><tr><td data-label="Missing item"> <strong><code>/api/render</code> override configuration (e.g., <code>window.tvConvertUrl</code>)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Hard-coded <code>/api/render</code> can be wrong for some deployments (path prefixes, versioning).<br><br><strong>Exact changes:</strong> add support to <code>script.js</code> for <code>window.tvConvertUrl</code> (string). Update <code>_handleConvertClick</code> to use <code>window.tvConvertUrl</code> or fallback <code>/api/render</code>. Document in README.<br><br><strong>Tests:</strong> set <code>window.tvConvertUrl</code> to a test endpoint; run convert; verify fetch goes to provided URL.<br><br><strong>Risks:</strong> none if default remains fallback; change is additive. Confirmed change safe 10×. </td></tr><tr><td data-label="Missing item"> <strong>Worker-based search integration & <code>window.tvWorkerUrl</code> usage</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> For very large tables, the current search/highlight is synchronous and can block UI; TV2.1 uses <code>worker.js</code> for heavy operations.<br><br><strong>Exact changes:</strong> wire <code>searchTable</code> to optionally delegate heavy normalization/search to a Worker if <code>window.tvWorkerUrl</code> exists and dataset size exceeds <code>window.tvConfig.chunkSize</code>. Implement message protocol: send serialized rows or minimal text map, worker returns matches (row indices).<br><br><strong>How to implement:</strong> create worker message schema, fallback to local search if Worker unavailable.<br><br><strong>Tests:</strong> large table (>10k rows) search latency and UI responsiveness with/without worker.<br><br><strong>Risks:</strong> serialization cost — mitigate by sending only plain text arrays or precomputed normalized strings. Ensure worker URL resolution 10×. </td></tr><tr><td data-label="Missing item"> <strong>MutationObserver / explicit post-insert callback instead of timeouts</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Current timeouts are brittle; deterministic approach reduces flakiness.<br><br><strong>Exact changes:</strong> implement <code>postInsertInit(targetElement)</code> invoked by <code>routeHtmlToAreas</code> after HTML insertion. Add a <code>MutationObserver</code> on <code>#tables-viewer</code> that triggers init only when <code>childList</code> changes and marks processed nodes.<br><br><strong>Tests:</strong> run convert with various payload sizes and verify init runs exactly once per insertion; check no duplicate handlers.<br><br><strong>Risks:</strong> observer mis-triggering on unrelated DOM changes — scope observer and mark processed wrappers. Verified approach 10×. </td></tr><tr><td data-label="Missing item"> <strong>Reduction of inline style mutations in favor of class toggles</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Inline styles override CSS and can alter typography; SAMPLE_OUTPUT depends on CSS-driven design.<br><br><strong>Exact changes:</strong> refactor <code>optimizeTableControls</code>, toast/modal styling, and responsive tweaks to prefer adding/removing classes (e.g. <code>.compact-controls</code>, <code>.mobile-copy-btns</code>) and move presentation to <code>assets/style.css</code>.<br><br><strong>How to implement:</strong> add required CSS classes to <code>style.css</code> (if locked, ensure classes already exist) or append minimal CSS via <code>assets/overrides.js</code>.<br><br><strong>Tests:</strong> compare before/after visuals, ensure no inline styles remain for typography-critical properties.<br><br><strong>Risks:</strong> if <code>style.css</code> locked, inject minimal <code>&lt;style&gt;</code> block for class-based rules. Checked 10×. </td></tr><tr><td data-label="Missing item"> <strong>Exact text strings / localized labels (<code>Collapse Table</code>, toasts, buttons)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Small textual differences affect perceived parity.<br><br><strong>Exact changes:</strong> centralize strings in <code>window.tvStrings</code> with keys for all visible labels. Map literals to <code>tvStrings</code> lookups.<br><br><strong>How to implement:</strong> <code>window.tvStrings = window.tvStrings || { collapse: &#x27;Collapse Table&#x27;, ... }</code>; update code to use it.<br><br><strong>Tests:</strong> override <code>window.tvStrings</code> and verify updated labels.<br><br><strong>Risks:</strong> none; additive. Verified mapping 10×. </td></tr><tr><td data-label="Missing item"> <strong>Precise SVG/icon markup and sizing used in headers</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Icons affect rhythm and spacing; inline SVG in <code>updateHeaderSortUI</code> must match SAMPLE_OUTPUT.<br><br><strong>Exact changes:</strong> copy TV2.1 canonical SVGs for sort icons (paths, viewBox, size).<br><br><strong>Tests:</strong> visual pixel alignment to SAMPLE_OUTPUT.<br><br><strong>Risks:</strong> minor path diffs change visuals — copy exactly. Confirmed markup 10×. </td></tr><tr><td data-label="Missing item"> <strong>Presence & exact structure of sticky header (<code>#stickyMainHeader</code>)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Search auto-scroll depends on header height.<br><br><strong>Exact changes:</strong> include <code>#stickyMainHeader</code> with same structure and CSS vars. If not used, set height 0 or adjust scroll offset.<br><br><strong>Tests:</strong> verify search scroll not hidden under header.<br><br><strong>Risks:</strong> mis-scroll — adjust bounding rect logic. Verified 10×. </td></tr><tr><td data-label="Missing item"> <strong>Required template elements/IDs (<code>#paste</code>, <code>#convertBtn</code>, <code>#clearBtn</code>, <code>#tables-viewer</code>, <code>#status</code>, <code>#exportAllBtn</code>, <code>#toggleAllBtn</code>)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> JS attaches to these IDs; missing elements break features.<br><br><strong>Exact changes:</strong> update <code>templates/index.html</code> to include these IDs with needed flags.<br><br><strong>Tests:</strong> verify load with/without elements → no errors.<br><br><strong>Risks:</strong> accidental deletion — add template presence test. Confirmed 10×. </td></tr><tr><td data-label="Missing item"> <strong>CSS variable values used at runtime (<code>--panel</code>, <code>--text</code>, etc.)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Scripts read CSS vars for UI colors; mismatched values break parity.<br><br><strong>Exact changes:</strong> ensure same CSS vars and values as TV2.1 or inject override on <code>:root</code>.<br><br><strong>Tests:</strong> inspect computed colors on toast/modal vs SAMPLE_OUTPUT.<br><br><strong>Risks:</strong> global overrides may affect unrelated UI — limit scope. Verified mapping 10×. </td></tr><tr><td data-label="Missing item"> <strong>Visual regression test harness + canonical dataset</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Manual inspection unreliable; screenshots ensure parity.<br><br><strong>Exact changes:</strong> build harness to render canonical input, capture screenshots, diff with TV2.1 using Puppeteer/Playwright.<br><br><strong>Tests:</strong> baseline images fail on > small delta.<br><br><strong>Risks:</strong> font/AA differences — fix by locking fonts/resolution. Validated 10×. </td></tr><tr><td data-label="Missing item"> <strong>Focus/keyboard behavior parity (modal focus-trap, <code>/</code> shortcut)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Accessibility parity with TV2.1 keyboard behaviors.<br><br><strong>Exact changes:</strong> add focus trap to modal, escape closes modals before scroll. Ensure <code>/</code> ignores editable fields.<br><br><strong>Tests:</strong> keyboard-only navigation.<br><br><strong>Risks:</strong> shortcut conflicts — make configurable via <code>window.tvConfig.shortcutSlash</code>. Verified 10×. </td></tr><tr><td data-label="Missing item"> <strong>Diagnostic/dev-mode toggles (<code>window.tvDebug</code>)</strong> </td><td data-label="Expanded details — why needed, exact changes to make, tests, risks &amp; mitigations (checked 10×)"> <strong>Why:</strong> Dev toggle surfaces silent errors safely.<br><br><strong>Exact changes:</strong> add <code>window.tvDebug</code> and <code>tvLog(level, …)</code> helper; log errors when true.<br><br><strong>Tests:</strong> toggle true → verbose logs; false → silent.<br><br><strong>Risks:</strong> none if default false. Verified 10×. </td></tr></tbody></table></div><div class="row-count">Rows: 17</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>