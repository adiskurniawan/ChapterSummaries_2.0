<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761793624">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li>
<li class="toc-item"><a class="toc-link" href="#Table9">Table 9</a></li>
<li class="toc-item"><a class="toc-link" href="#Table10">Table 10</a></li>
<li class="toc-item"><a class="toc-link" href="#Table11">Table 11</a></li>
<li class="toc-item"><a class="toc-link" href="#Table12">Table 12</a></li>
<li class="toc-item"><a class="toc-link" href="#Table13">Table 13</a></li>
<li class="toc-item"><a class="toc-link" href="#Table14">Table 14</a></li>
<li class="toc-item"><a class="toc-link" href="#Table15">Table 15</a></li>
<li class="toc-item"><a class="toc-link" href="#Table16">Table 16</a></li>
<li class="toc-item"><a class="toc-link" href="#Table17">Table 17</a></li>
<li class="toc-item"><a class="toc-link" href="#Table18">Table 18</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8043_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1 — Overview</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details / Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details / Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown"> tables_viewer_v2_1<br>├─ render<br>│  ├─ core_assets.py<br>│  ├─ core_fragments.py<br>│  ├─ core_io.py<br>│  ├─ core_renderer.py<br>│  ├─ core_table.py<br>│  ├─ core_utils.py<br>│  ├─ core_compat.py<br>│  ├─ convert.py<br>│  ├─ markdown.py<br>│  ├─ io_utils.py<br>│  ├─ sanitize.py<br>│  ├─ types.py<br>│  ├─ assets.py<br>│  ├─ cli.py<br>│  └─ <strong>init</strong>.py<br>├─ assets<br>│  ├─ style.css<br>│  ├─ script.js<br>│  ├─ worker.js<br>├─ output_combined<br>│  └─ assets<br>│     ├─ style.css<br>│     ├─ script.js<br>│     ├─ worker.js<br>│     ├─ overrides.css<br>│     ├─ extra.js<br>│     └─ xlsx.full.min.js<br>├─ html_renderer.py<br>├─ utils.py<br>├─ helpers.py<br>└─ main.py </td><td data-label="Details / Notes"> Project structure for table viewer v2.1: <br><code>render/</code> handles modular rendering, table helpers, sanitization, conversion, assets, and CLI; <br><code>assets/</code> holds core CSS/JS; <br><code>output_combined/</code> stores generated HTML and copied runtime assets including SheetJS for Excel export; <br>root scripts handle main entry point, HTML rendering, utilities, and helper functions. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Project Purpose (main.py focus)</strong> </td><td data-label="Details / Notes"> Orchestrates the PasteToTable pipeline: input table acquisition, processing via <code>render/convert.py</code> and <code>core_table.py</code>, optional HTML rendering (<code>html_renderer.py</code>), asset handling (<code>core_assets.py</code>), and output to <code>saved_tables/</code>. Ensures end-to-end non-destructive, recoverable, and testable workflow. </td></tr><tr><td data-label="Technical Breakdown"> <strong>High-Level Workflow</strong> </td><td data-label="Details / Notes"> 1. Acquire source tables (manual paste, uploaded file, or programmatic input).<br>2. Normalize data structures (<code>_coalesce_multiline_rows</code>, list detection).<br>3. Convert Markdown or plain text to structured HTML cells using <code>convert.render_table</code>.<br>4. Sanitize content (<code>sanitize.py</code>) preserving safe tags (<code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code>, <code>&lt;ol&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;strong&gt;</code>).<br>5. Ensure required assets (<code>style.css</code>, <code>script.js</code>, <code>worker.js</code>) are available via <code>core_assets.py</code>.<br>6. Output final HTML table pages to <code>saved_tables/</code>. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Entry Point: <code>main.py</code></strong> </td><td data-label="Details / Notes"> Handles CLI and optional GUI triggers. Responsible for initializing configuration objects, loading user or project settings, invoking asset preparation (<code>core_assets.prepare_assets</code>), table conversion (<code>render_table</code>), and optional HTML rendering (<code>html_renderer.render_page</code>). Implements robust logging and error capture to prevent pipeline interruption. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Configuration Management</strong> </td><td data-label="Details / Notes"> <code>main.py</code> parses command-line arguments or default config files to determine:<br>• Input/output directories (<code>saved_tables/</code> default)<br>• Asset fingerprinting & manifest options<br>• Markdown vs HTML source<br>• Optional sanitizer flags and logging levels<br>• Max asset copy sizes and whitelist/blacklist filters </td></tr><tr><td data-label="Technical Breakdown"> <strong>Integration with <code>render/core_table.py</code></strong> </td><td data-label="Details / Notes"> - <code>main.py</code> calls <code>render_table</code> for each table object.<br>- Relies on <code>_coalesce_multiline_rows</code> to merge single-value rows.<br>- Supports ordered and nested lists (<code>&lt;ol&gt;</code>, <code>&lt;ul&gt;</code>), fenced code, inline math, and nested HTML blocks.<br>- Ensures each cell is normalized for safe rendering before passing downstream. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Asset Handling (<code>render/core_assets.py</code>)</strong> </td><td data-label="Details / Notes"> - Discovers candidate <code>assets/</code> directories, prioritizing repo-root, CWD, and package sibling folders.<br>- Copies assets to output directory with optional fingerprinting (<code>sha256</code> short hash).<br>- Generates manifests and diagnostics (<code>assets-info.json</code>) to track size, modification times, and SRI integrity hashes.<br>- Ensures placeholder files exist for required assets if source missing.<br>- Optional <code>fingerprint_assets</code> and <code>generate_manifest</code> flags support CI/CD asset validation. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Atomic File Operations (<code>render/core_io.py</code>)</strong> </td><td data-label="Details / Notes"> - <code>_atomic_write_dispatch</code> and <code>_atomic_copy_dispatch</code> provide project-preferred atomic write/copy routines or fallback implementations.<br>- <code>_ensure_dir_dispatch</code> ensures output directories exist without race conditions.<br>- Temporary files created in same directory and replaced via <code>os.replace</code> to avoid partial writes.<br>- Supports fallback mechanisms to prevent pipeline interruption in case of filesystem errors.<br>- <code>safe_write_text</code> ensures UTF-8 encoding and flushing with best-effort <code>fsync</code>. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Sanitization (<code>render/sanitize.py</code>)</strong> </td><td data-label="Details / Notes"> - Cleans HTML while preserving safe elements: <code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code>, <code>&lt;strong&gt;</code>, <code>&lt;ol&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code>.<br>- Escapes unsafe characters post list detection to avoid double-escaping.<br>- Provides optional rich media gates for inline SVG or math.<br>- Supports flags to preserve KaTeX/math wrappers inside table cells.<br>- Maintains ordered list numbering, nested lists, and inline code spans. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Markdown/HTML Conversion (<code>render/convert.py</code>, <code>render/markdown.py</code>)</strong> </td><td data-label="Details / Notes"> - Converts table cells from Markdown to HTML safely.<br>- Preserves inline code, fenced code, math blocks, and ASCII diagrams.<br>- Normalizes lists and numbering; <code>&lt;ol&gt;</code> elements receive sequential <code>&lt;li&gt;</code> items.<br>- Ensures nested content is preserved for accurate downstream rendering.<br>- <code>_coalesce_multiline_rows</code> merges rows where all but one cell is empty to reduce fragmentation. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Renderer Helpers (<code>html_renderer.py</code>)</strong> </td><td data-label="Details / Notes"> - Wraps <code>render_table</code> output in full HTML templates (<code>templates/index.html</code>).<br>- Includes <code>&lt;link&gt;</code> and <code>&lt;script&gt;</code> tags referencing resolved assets, with <code>integrity</code> and <code>crossorigin</code> attributes for SRI.<br>- Allows fallback inline style/script when asset not available.<br>- Supports optional math/diagram rendering wrappers for complex cell content. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Utility Functions (<code>utils.py</code>)</strong> </td><td data-label="Details / Notes"> - General-purpose helpers for string manipulation, path normalization, logging enhancements, and timing.<br>- Often used by <code>main.py</code> for CLI argument parsing and error message formatting.<br>- Provides safe defaults for missing environment variables and fallback values. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Server Integration (<code>server.py</code>)</strong> </td><td data-label="Details / Notes"> - Provides optional HTTP interface to serve saved tables or live-render pasted tables.<br>- Integrates with <code>html_renderer.py</code> and <code>core_assets.py</code> to serve HTML pages with correct asset links.<br>- Handles concurrent requests safely using atomic file operations.<br>- Supports configurable port and host binding, optional SSL via middleware, and JSON API for dynamic table data. </td></tr><tr><td data-label="Technical Breakdown"> <strong>CLI & Automation (<code>render/cli.py</code>)</strong> </td><td data-label="Details / Notes"> - Exposes key <code>main.py</code> operations via command-line interface.<br>- Supports batch processing of multiple tables, output directory specification, and asset manifest generation.<br>- Ensures dry-run and verbose logging modes for safe automation.<br>- Supports optional flags for fingerprinting, SRI computation, and asset override paths. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Type Safety (<code>render/types.py</code>)</strong> </td><td data-label="Details / Notes"> - Central definitions for table cells, rows, and metadata objects.<br>- Used across <code>convert.py</code>, <code>core_table.py</code>, and <code>html_renderer.py</code> to ensure consistent type handling.<br>- Supports type hints for <code>Optional</code>, <code>List</code>, <code>Dict</code>, and union types to prevent runtime type errors. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Misc Helpers (<code>core_utils.py</code>, <code>io_utils.py</code>)</strong> </td><td data-label="Details / Notes"> - <code>core_utils.py</code>: streaming reads/writes, SRI attribute generation, minor sanitization helpers, number normalization.<br>- <code>io_utils.py</code>: low-level file system helpers for copy, stat, path inspection, and safe deletion.<br>- Used across the pipeline to reduce boilerplate and ensure consistent handling of I/O errors. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Pipeline Guarantees</strong> </td><td data-label="Details / Notes"> - Non-destructive: existing output files preserved unless explicitly forced.<br>- Safe fallbacks: missing assets are replaced with embedded defaults.<br>- Atomic writes: avoids partial file corruption.<br>- Consistent HTML output: tables retain inline code, math, and list formatting.<br>- Logging & diagnostics: verbose information for debug and CI/CD pipelines.<br>- Idempotent operations: repeated runs do not alter stable outputs. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Error Handling</strong> </td><td data-label="Details / Notes"> - Non-fatal logging for recoverable errors (e.g., missing optional assets).<br>- Fallback functions ensure placeholder generation to maintain pipeline continuity.<br>- Critical failures halt operation with clear messages; stack traces captured for debugging.<br>- Logs include input file, output paths, and operation context for reproducibility. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Performance Considerations</strong> </td><td data-label="Details / Notes"> - Streaming operations for large table or asset files to minimize memory footprint.<br>- Max asset copy sizes prevent accidental oversized file copying.<br>- Fingerprinting optional to reduce rebuild cost during iterative dev.<br>- Concurrent asset preparation is safe; avoids race conditions with temp files. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Extensibility Points</strong> </td><td data-label="Details / Notes"> - Project-provided overrides for <code>_copy_assets_impl</code> or <code>_write_overrides_impl</code>.<br>- Optional rich media gate for math or inline SVG.<br>- Modular table cell converters allow adding new formatting rules without affecting core pipeline.<br>- Custom renderer hooks allow integration with external HTML templates. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Testing & Verification</strong> </td><td data-label="Details / Notes"> - Unit tests for atomic writes, fallback asset creation, <code>resolve_asset_name</code>.<br>- Integration tests for <code>render_table</code> producing valid HTML.<br>- CI scripts validate manifest generation, SRI hashes, and placeholder asset presence.<br>- Regression tests ensure Markdown-to-HTML fidelity, list numbering, and cell merging correctness. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Documentation & Developer Guidance</strong> </td><td data-label="Details / Notes"> - <code>main.py</code> serves as reference for full pipeline orchestration.<br>- Clear separation between assets, core rendering, and table normalization.<br>- Developers can inject custom behavior via project hooks without touching core logic.<br>- Inline docstrings describe function contracts, expected inputs/outputs, and error modes. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Asset Management Summary</strong> </td><td data-label="Details / Notes"> - All required assets (<code>style.css</code>, <code>script.js</code>, <code>worker.js</code>, <code>overrides.css</code>) ensured.<br>- Optional extra assets included if present.<br>- Supports fingerprinting and SRI manifest creation.<br>- Embedded fallbacks used when project assets are missing or too small (<10 bytes). </td></tr><tr><td data-label="Technical Breakdown"> <strong>HTML Rendering Flow</strong> </td><td data-label="Details / Notes"> 1. <code>main.py</code> invokes <code>render_table</code> → produces safe HTML for each table.<br>2. <code>html_renderer.render_page</code> wraps tables in full HTML <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code>.<br>3. Asset references resolved via <code>core_assets.resolve_asset_name</code>.<br>4. SRI hashes applied to <code>&lt;link&gt;</code> / <code>&lt;script&gt;</code> tags if computed.<br>5. Inline fallbacks inserted when asset missing. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Pipeline Safety Guarantees</strong> </td><td data-label="Details / Notes"> - Atomic file writes for table HTML and assets.<br>- No zero-byte required files.<br>- Non-fatal errors logged, pipeline continues.<br>- Consistent handling across CLI, server, and programmatic invocation.<br>- Markdown-to-HTML conversion preserves original formatting, nested structures, and code blocks. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Security & Integrity</strong> </td><td data-label="Details / Notes"> - Optional SRI on assets ensures client-side integrity.<br>- Sanitization prevents unsafe HTML injections.<br>- Inline math/code preserved safely.<br>- Manifest files avoid absolute paths, only logical→physical mappings included. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Operational Recommendations</strong> </td><td data-label="Details / Notes"> - Prefer project hooks for asset copying and overrides to centralize policy.<br>- Enable <code>generate_manifest</code> in production builds.<br>- Use fingerprinting during build/deploy; lock length 8–12 chars.<br>- Keep <code>max_asset_copy_size</code> reasonable; whitelist approved large bundles.<br>- Run <code>_demo_run</code> in temp directory to validate pipeline without touching repo. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Demo / Example Harness</strong> </td><td data-label="Details / Notes"> - <code>_demo_run(temp_out)</code> demonstrates typical config.<br>- Runs <code>prepare_assets</code>, prints asset manifest contents.<br>- Safe: only writes to temp directory, safe for CI/CD demos. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Failure Modes & Fallbacks</strong> </td><td data-label="Details / Notes"> - Missing project <code>.assets</code> → fallback copy from candidates.<br>- No candidate assets → placeholders written (style/script/worker/overrides).<br>- Atomic write/copy exceptions → logged, attempt fallback; placeholders remain to avoid empty files.<br>- Manifest generation failure → logged; <code>assets-info.json</code> still written. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Reviewer Checklist</strong> </td><td data-label="Details / Notes"> 1. <code>_ensure_dir_dispatch</code> maps to project <code>core_io</code> when present.<br>2. Validate placeholder content & minimal size threshold (10 bytes).<br>3. Ensure <code>fingerprint_len</code> default acceptable.<br>4. Verify <code>max_asset_copy_size</code> default suits project.<br>5. Confirm <code>compute_sri</code> algorithm (<code>sha384</code>) acceptable for target browsers.<br>6. Run <code>_demo_run</code> in isolated tempdir to inspect files. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Minimal Unit Tests</strong> </td><td data-label="Details / Notes"> - Candidate discovery returns expected list.<br>- <code>_fallback_atomic_copy</code> produces identical file.<br>- <code>_ensure_non_empty_file</code> populates small/absent files.<br>- <code>prepare_assets</code> with stub returns <code>assets_written=True</code>.<br>- <code>resolve_asset_name</code> finds fingerprinted names and falls back. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Short Summary / Decision Points</strong> </td><td data-label="Details / Notes"> - Safe, conservative asset deployment.<br>- Prefer project hooks, attempt discovery, be non-destructive.<br>- Produce manifest + SRI when requested.<br>- Always ensure non-empty required assets.<br>- Configuration knobs let teams tune CI vs dev behavior.<br>- Modular, testable, safe, and performance-conscious design. </td></tr></tbody></table></div><div class="row-count">Rows: 32</div></div><div class="table-caption" id="Table2" data-table="Book_8043_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2 — main.py</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section / Topic**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section / Topic</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details / Explanation**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details / Explanation</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section / Topic"> <strong>Summary / Purpose</strong>              </td><td data-label="Details / Explanation"> Provide a complete, safe, production-ready pipeline for <code>main.py</code>. Handles project initialization, configuration parsing, CLI arguments, logging setup, temporary directories, and orchestrates rendering workflows. Ensures deterministic, recoverable behavior with minimal side effects. </td></tr><tr><td data-label="Section / Topic"> <strong>High-Level Guarantees</strong>          </td><td data-label="Details / Explanation"> • Deterministic order of execution.<br>• Non-destructive to source files.<br>• CLI errors reported without crashing.<br>• Logging is centralized and configurable.<br>• Temporary and output directories managed safely.                                                                    </td></tr><tr><td data-label="Section / Topic"> <strong>Entry Point</strong>                    </td><td data-label="Details / Explanation"> <code>if __name__ == &quot;__main__&quot;:</code> ensures script is executable as standalone or importable module. Centralized orchestration occurs here.                                                                                                                                                        </td></tr><tr><td data-label="Section / Topic"> <strong>Argument Parsing</strong>               </td><td data-label="Details / Explanation"> Uses <code>argparse</code> for CLI arguments: <code>--config</code>, <code>--output</code>, <code>--verbose</code>, <code>--dry-run</code>, <code>--log-level</code>. Provides type checking, defaults, and help text.                                                                                                                                        </td></tr><tr><td data-label="Section / Topic"> <strong>Configuration Loader</strong>           </td><td data-label="Details / Explanation"> Reads configuration file (<code>YAML</code>/<code>JSON</code>), validates keys, applies defaults. Merges CLI overrides into configuration object. Ensures required keys exist: <code>assets_dir</code>, <code>out_dir</code>, <code>fingerprint_assets</code>, <code>generate_manifest</code>.                                                                </td></tr><tr><td data-label="Section / Topic"> <strong>Logging Setup</strong>                  </td><td data-label="Details / Explanation"> Configures Python <code>logging</code> module:<br>• Console handler with <code>INFO</code>/<code>DEBUG</code> based on CLI.<br>• Optional file handler.<br>• Timestamped format, module name, level.<br>• Ensures log propagation controlled for clarity.                                                                    </td></tr><tr><td data-label="Section / Topic"> <strong>Temporary Directory Management</strong> </td><td data-label="Details / Explanation"> Creates temp working directories using <code>tempfile.TemporaryDirectory()</code> for ephemeral processing. Ensures cleanup even on exceptions using context managers.                                                                                                                                 </td></tr><tr><td data-label="Section / Topic"> <strong>Assets Preparation</strong>             </td><td data-label="Details / Explanation"> Invokes <code>prepare_assets(cfg, out_dir)</code>:<br>• Resolves candidate <code>assets/</code> dirs.<br>• Applies fingerprinting, manifest, placeholders.<br>• Ensures atomic writes.<br>• Returns tuple <code>(assets_dir, style_fallback, script_fallback, assets_written)</code>.                                        </td></tr><tr><td data-label="Section / Topic"> <strong>Renderer Initialization</strong>        </td><td data-label="Details / Explanation"> Initializes renderers (<code>HTMLRenderer</code>, <code>MarkdownRenderer</code>) with:<br>• Safe CSS/JS paths.<br>• Inline fallbacks if assets missing.<br>• Sanitization flags.<br>• Optional KaTeX/math support.                                                                                                </td></tr><tr><td data-label="Section / Topic"> <strong>Input Data Handling</strong>            </td><td data-label="Details / Explanation"> Accepts input file paths (Markdown, CSV, HTML). Validates existence, encoding (UTF-8), and type.<br>Supports multi-file batch mode.                                                                                                                                                         </td></tr><tr><td data-label="Section / Topic"> <strong>Table Extraction / Conversion</strong>  </td><td data-label="Details / Explanation"> For each input:<br>• Detect tables or blocks.<br>• Apply <code>convert.render_table</code> or project-specific <code>core_table.render_table</code>.<br>• Normalizes multi-line cells, preserves code/math diagrams, escapes unsafe HTML after processing lists.                                                  </td></tr><tr><td data-label="Section / Topic"> <strong>List & Markdown Handling</strong>       </td><td data-label="Details / Explanation"> Detects ordered lists (<code>^\s*\d+\.</code>) and converts to <code>&lt;ol&gt;&lt;li&gt;</code> blocks.<br>Preserves nested <code>&lt;ul&gt;/&lt;ol&gt;</code>.<br>Escapes content after list detection to avoid sanitizer conflicts.                                                                                                               </td></tr><tr><td data-label="Section / Topic"> <strong>Sanitization</strong>                   </td><td data-label="Details / Explanation"> Runs post-render sanitizer:<br>• Strips scripts, event handlers (<code>on*</code>).<br>• Keeps <code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code>, <code>&lt;ol&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code>, <code>&lt;strong&gt;</code>, <code>&lt;em&gt;</code>.<br>• Optional <code>allow_rich_media</code> gate.                                                                                                   </td></tr><tr><td data-label="Section / Topic"> <strong>HTML Assembly</strong>                  </td><td data-label="Details / Explanation"> Combines <code>&lt;head&gt;</code>, <code>&lt;style&gt;</code>, <code>&lt;body&gt;</code>, <code>&lt;script&gt;</code> into final HTML page.<br>• Embeds placeholders if assets missing.<br>• Ensures <code>&lt;link&gt;</code> and <code>&lt;script&gt;</code> tags include SRI when fingerprinted.                                                                                              </td></tr><tr><td data-label="Section / Topic"> <strong>Export / Save</strong>                  </td><td data-label="Details / Explanation"> Writes output to <code>cfg.out_dir</code>:<br>• HTML files named consistently.<br>• Atomic writes using dispatcher (<code>_atomic_write_dispatch</code>).<br>• Generates diagnostic <code>assets-info.json</code>.<br>• Logs summary of files written.                                                                       </td></tr><tr><td data-label="Section / Topic"> <strong>Dry-Run Mode</strong>                   </td><td data-label="Details / Explanation"> If <code>--dry-run</code> enabled:<br>• No disk writes occur.<br>• Prints planned operations.<br>• Validates configuration and asset resolution.                                                                                                                                                       </td></tr><tr><td data-label="Section / Topic"> <strong>Error Handling</strong>                 </td><td data-label="Details / Explanation"> All steps wrapped in try/except:<br>• Non-fatal errors logged at <code>DEBUG</code> or <code>INFO</code>.<br>• Critical failures fallback to safe defaults.<br>• Ensures temp directories and placeholders are always left in consistent state.                                                                   </td></tr><tr><td data-label="Section / Topic"> <strong>Exit Codes</strong>                     </td><td data-label="Details / Explanation"> Standardized exit codes:<br>• <code>0</code> = success.<br>• <code>1</code> = CLI/config errors.<br>• <code>2</code> = file processing errors.<br>• Ensures deterministic scripting behavior.                                                                                                                                </td></tr><tr><td data-label="Section / Topic"> <strong>Unit Test Hooks</strong>                </td><td data-label="Details / Explanation"> Exposes testable functions:<br>• <code>parse_config</code>, <code>prepare_assets</code>, <code>render_table</code>, <code>resolve_asset_name</code>.<br>• Facilitates CI pipeline integration.                                                                                                                                          </td></tr><tr><td data-label="Section / Topic"> <strong>Performance Considerations</strong>     </td><td data-label="Details / Explanation"> • Stream large files to avoid memory spikes.<br>• Avoid redundant asset copying using fingerprint checks.<br>• Skip unnecessary render passes if output unchanged.<br>• Batch processing optimized for multiple tables or chapters.                                                         </td></tr><tr><td data-label="Section / Topic"> <strong>Security / Integrity</strong>           </td><td data-label="Details / Explanation"> • Sanitizes input to prevent XSS.<br>• Uses SRI for fingerprinted assets.<br>• Inline fallbacks maintain integrity when assets unavailable.<br>• Avoids absolute paths in manifest.                                                                                                         </td></tr><tr><td data-label="Section / Topic"> <strong>Operational Notes</strong>              </td><td data-label="Details / Explanation"> • Supports project-provided hooks for <code>copy_assets</code> and <code>write_overrides_css</code>.<br>• Configurable fingerprinting, manifest generation, max asset size.<br>• Safe defaults ensure reproducibility across environments.                                                                        </td></tr><tr><td data-label="Section / Topic"> <strong>Demo / CLI Safety</strong>              </td><td data-label="Details / Explanation"> <code>_demo_run(temp_out)</code> provides reproducible test harness:<br>• Runs main workflow in isolated temp dir.<br>• Prints diagnostics without touching repo assets.<br>• Safe for CI/CD validation.                                                                                               </td></tr><tr><td data-label="Section / Topic"> <strong>Fallback & Recovery Matrix</strong>     </td><td data-label="Details / Explanation"> • Missing project <code>.assets</code> → copies from candidates.<br>• Missing tables or input files → logs and continues.<br>• Atomic write/copy errors → fallback ensures placeholders remain.<br>• Manifest generation failure → logs only, does not block output.                                   </td></tr><tr><td data-label="Section / Topic"> <strong>Reviewer Checklist (pre-merge)</strong> </td><td data-label="Details / Explanation"> 1. Confirm logging propagation and levels.<br>2. Validate atomic write/copy dispatchers.<br>3. Ensure temp directories cleaned up reliably.<br>4. Verify asset fingerprinting and SRI integrity.<br>5. Test dry-run mode.<br>6. Ensure large file streaming works.                          </td></tr><tr><td data-label="Section / Topic"> <strong>Minimal Unit Tests</strong>             </td><td data-label="Details / Explanation"> • Config parsing with valid and invalid inputs.<br>• Asset preparation with/without project hooks.<br>• Table rendering preserves code/math blocks.<br>• Sanitization strips unsafe HTML but keeps allowed tags.<br>• Fingerprinted assets correctly resolved by <code>resolve_asset_name</code>.      </td></tr><tr><td data-label="Section / Topic"> <strong>Advanced Error Handling</strong>      </td><td data-label="Details / Explanation"> • Wraps each processing stage in fine-grained try/except.<br>• Logs traceback on <code>DEBUG</code> level, user-friendly summary on <code>INFO</code>.<br>• Ensures temp directories and placeholders remain consistent even on exceptions.<br>• Uses context managers to enforce cleanup.                                           </td></tr><tr><td data-label="Section / Topic"> <strong>Input Validation</strong>             </td><td data-label="Details / Explanation"> • Checks file paths exist and readable.<br>• Verifies file types (Markdown, CSV, HTML).<br>• Validates configuration keys and types.<br>• Applies default values for missing optional keys.                                                                                                                    </td></tr><tr><td data-label="Section / Topic"> <strong>Configuration Merging</strong>        </td><td data-label="Details / Explanation"> • Merges CLI arguments into config file values.<br>• Overrides defaults only when explicitly passed.<br>• Preserves backward compatibility with legacy config formats.                                                                                                                                         </td></tr><tr><td data-label="Section / Topic"> <strong>Asset Fallback Policy</strong>        </td><td data-label="Details / Explanation"> • Uses embedded CSS/JS fallbacks if physical assets missing.<br>• Ensures <code>style.css</code>, <code>script.js</code>, <code>worker.js</code>, <code>overrides.css</code> always ≥10 bytes.<br>• Supports fingerprinting when enabled.                                                                                                                  </td></tr><tr><td data-label="Section / Topic"> <strong>Logging Best Practices</strong>       </td><td data-label="Details / Explanation"> • Central logger avoids duplicate entries.<br>• Configurable log levels per CLI or config.<br>• Consistent format for timestamps, module names, levels.<br>• Debug logs include resolved paths, asset fingerprints, and temporary directories.                                                                 </td></tr><tr><td data-label="Section / Topic"> <strong>Atomic File Operations</strong>       </td><td data-label="Details / Explanation"> • Uses <code>_atomic_write_dispatch</code> and <code>_atomic_copy_dispatch</code>.<br>• Fallbacks with <code>NamedTemporaryFile</code> and <code>os.replace</code> ensure atomicity.<br>• Prevents zero-byte or partially written files.<br>• Handles permission errors gracefully.                                                                        </td></tr><tr><td data-label="Section / Topic"> <strong>Renderer Configuration</strong>       </td><td data-label="Details / Explanation"> • HTML renderer initialized with asset paths and fallbacks.<br>• Markdown renderer handles fenced code blocks, math, diagrams.<br>• Sanitizers configured post-render, preserves <code>&lt;ol&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code>.<br>• Optional rich media gate via <code>allow_rich_media</code>.                              </td></tr><tr><td data-label="Section / Topic"> <strong>Table Normalization</strong>          </td><td data-label="Details / Explanation"> • <code>_coalesce_multiline_rows(df)</code> merges rows with single non-empty cells.<br>• Ordered lists detected via <code>^\s*\d+\.</code> regex.<br>• Escaping applied after list detection.<br>• Preserves inline code, fenced code, diagrams, LaTeX/KaTeX.                                                                       </td></tr><tr><td data-label="Section / Topic"> <strong>Sanitization Rules</strong>           </td><td data-label="Details / Explanation"> • Strips <code>&lt;script&gt;</code> and all <code>on*</code> attributes.<br>• Preserves safe tags: <code>&lt;pre&gt;</code>, <code>&lt;code&gt;</code>, <code>&lt;strong&gt;</code>, <code>&lt;em&gt;</code>, <code>&lt;ol&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code>.<br>• Optional allowlist for rich media or SVGs.                                                                                                                         </td></tr><tr><td data-label="Section / Topic"> <strong>HTML Assembly Workflow</strong>       </td><td data-label="Details / Explanation"> • Head section includes <code>&lt;meta&gt;</code> and optional CSS <code>&lt;link&gt;</code> tags.<br>• Inline fallbacks included if assets missing.<br>• Body section constructed with sanitized tables and blocks.<br>• Script tags appended at end with optional SRI attributes.                                                              </td></tr><tr><td data-label="Section / Topic"> <strong>Dry-Run Behavior</strong>             </td><td data-label="Details / Explanation"> • Logs intended file writes without performing them.<br>• Checks asset existence, fingerprint computation, and manifest creation.<br>• Helps validate CI/CD pipelines safely.                                                                                                                                  </td></tr><tr><td data-label="Section / Topic"> <strong>Temporary File Management</strong>    </td><td data-label="Details / Explanation"> • Uses context managers for automatic deletion.<br>• Temp dirs isolated per run to avoid conflicts.<br>• Ensures cross-platform compatibility (Windows, Linux, macOS).                                                                                                                                         </td></tr><tr><td data-label="Section / Topic"> <strong>Fingerprinting & SRI</strong>         </td><td data-label="Details / Explanation"> • Computes SHA256 or SHA384 as configured.<br>• Inserts hash into filename before extension: <code>file.&lt;hash&gt;.js</code>.<br>• Updates manifest mapping logical → fingerprinted name.<br>• Optional, enabled via <code>cfg.fingerprint_assets</code>.                                                                                </td></tr><tr><td data-label="Section / Topic"> <strong>Manifest Generation</strong>          </td><td data-label="Details / Explanation"> • Produces <code>assets-manifest.json</code> with <code>{generated, files, mapping}</code>.<br>• Stores size, mtime, and SRI per file.<br>• Optional logical mapping for fingerprinted assets.<br>• Errors logged; generation failure does not block main workflow.                                                                  </td></tr><tr><td data-label="Section / Topic"> <strong>Assets Diagnostic</strong>            </td><td data-label="Details / Explanation"> • <code>assets-info.json</code> written always.<br>• Contains file names, sizes, mtimes, <code>assets_written</code> flag.<br>• Lightweight, intended for debugging.                                                                                                                                                                 </td></tr><tr><td data-label="Section / Topic"> <strong>File Output Policy</strong>           </td><td data-label="Details / Explanation"> • Ensures all required files ≥10 bytes.<br>• Avoid overwriting existing ≥10-byte files unless forced.<br>• Atomic writes for safety.<br>• Supports multi-file output with consistent naming.                                                                                                                   </td></tr><tr><td data-label="Section / Topic"> <strong>Performance Optimization</strong>     </td><td data-label="Details / Explanation"> • Streams large files to avoid memory spikes.<br>• Avoids redundant asset copying via fingerprint checks.<br>• Batches input processing to minimize repeated renderer initialization.<br>• Supports multi-threaded reading if needed.                                                                          </td></tr><tr><td data-label="Section / Topic"> <strong>Security & Integrity</strong>         </td><td data-label="Details / Explanation"> • Sanitization prevents XSS.<br>• SRI ensures fingerprinted assets integrity.<br>• Inline fallbacks maintain safety if assets unavailable.<br>• Manifest paths relative, no absolute exposure.                                                                                                                 </td></tr><tr><td data-label="Section / Topic"> <strong>Operational Recommendations</strong>  </td><td data-label="Details / Explanation"> 1. Enable <code>generate_manifest</code> in production.<br>2. Use fingerprinting for cache-busting.<br>3. Keep <code>max_asset_copy_size</code> reasonable.<br>4. CI validation with <code>_demo_run</code> to prevent side effects.<br>5. Validate logs for anomalies.                                                                         </td></tr><tr><td data-label="Section / Topic"> <strong>Demo & CI Integration</strong>        </td><td data-label="Details / Explanation"> • <code>_demo_run(temp_out)</code> tests workflow in isolated temp dir.<br>• Prints assets written, manifest contents, HTML preview info.<br>• Ensures safe evaluation in automated pipelines.                                                                                                                            </td></tr><tr><td data-label="Section / Topic"> <strong>Edge Cases & Recovery Matrix</strong> </td><td data-label="Details / Explanation"> • Missing project assets → fallback copy from candidates.<br>• Missing input files → logs error, continues.<br>• Partial writes → temp file cleanup ensures no corrupted outputs.<br>• Manifest failure → logged only, does not stop output generation.<br>• Invalid configuration → exits with proper code.   </td></tr><tr><td data-label="Section / Topic"> <strong>Reviewer Checklist</strong>           </td><td data-label="Details / Explanation"> 1. Validate logging setup and propagation.<br>2. Ensure temp directories reliably cleaned.<br>3. Confirm asset fingerprinting & SRI correctness.<br>4. Test dry-run mode functionality.<br>5. Review atomic write/copy dispatchers.<br>6. Confirm sanitization preserves allowed tags.                         </td></tr><tr><td data-label="Section / Topic"> <strong>Unit Tests Recommendations</strong>   </td><td data-label="Details / Explanation"> • Config parsing (valid/invalid).<br>• Asset preparation with/without project hooks.<br>• Table rendering preserves code/math.<br>• Sanitization strips unsafe content.<br>• Fingerprinted assets resolved via manifest.<br>• Dry-run verifies intended operations without file writes.                        </td></tr><tr><td data-label="Section / Topic"> <strong>Performance Notes</strong>            </td><td data-label="Details / Explanation"> • Streaming large tables avoids memory spikes.<br>• Skip asset copying if fingerprint unchanged.<br>• Batch renderer initialization reduces overhead.<br>• Temp directory reuse per run reduces overhead.                                                                                                      </td></tr><tr><td data-label="Section / Topic"> <strong>Fallback & Recovery Logic</strong>    </td><td data-label="Details / Explanation"> • Uses embedded CSS/JS placeholders if assets missing.<br>• Atomic write fallbacks prevent partial outputs.<br>• Logs non-fatal errors and continues pipeline.<br>• Ensures deterministic exit codes per scenario.                                                                                             </td></tr><tr><td data-label="Section / Topic"> <strong>Security Observations</strong>        </td><td data-label="Details / Explanation"> • XSS prevention via sanitization.<br>• SRI provides integrity verification.<br>• Inline fallbacks allow safe rendering even when assets missing.<br>• No absolute paths in manifest; relative only.                                                                                                           </td></tr><tr><td data-label="Section / Topic"> <strong>Decision Points</strong>              </td><td data-label="Details / Explanation"> • Prefer project hooks (<code>copy_assets</code>, <code>write_overrides_css</code>) for custom behavior.<br>• Enable fingerprinting for cache control.<br>• Enable manifest generation for asset mapping.<br>• Validate <code>max_asset_copy_size</code> for large bundles.<br>• Use <code>_demo_run</code> in CI for reproducible testing.                </td></tr><tr><td data-label="Section / Topic"> <strong>Short Summary</strong>                </td><td data-label="Details / Explanation"> <code>main.py</code> orchestrates project asset preparation, configuration, rendering, sanitization, and output generation. It ensures atomic writes, fingerprinting, SRI, safe defaults, fallback mechanisms, logging, and robust error handling. Designed for safe production execution and repeatable CI/CD workflows. </td></tr></tbody></table></div><div class="row-count">Rows: 54</div></div><div class="table-caption" id="Table3" data-table="Book_8043_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3 — html_renderer.py</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>File Purpose / Summary</strong> </td><td data-label="Details"> This file serves as a compatibility wrapper exposing <code>render_html</code>, <code>render_table</code>, and <code>render_page</code> from the local <code>render</code> package. The production-ready revision includes robust features for enterprise-level rendering workflows. Key capabilities: <br> - Precompiled regexes for performance on large pages <br> - Safe, idempotent callable wrapping that preserves return types <br> - Runtime-configurable behavior via environment variables or <code>set_renderer_config()</code> <br> - Conservative HTML minification preserving <code>&lt;script&gt;</code>, <code>&lt;style&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;textarea&gt;</code>, <code>&lt;code&gt;</code>, and HTML comments <br> - Bounded import diagnostics with <code>_try_msgs</code> deque <br> - Clear logging hooks and non-throwing behavior <br> - Backwards-compatible exports for downstream consumers </td></tr><tr><td data-label="Section"> <strong>Public Exports</strong> </td><td data-label="Details"> The wrapper exports <code>render_html</code>, <code>render_table</code>, <code>render_page</code>. These may remain <code>None</code> if imports fail. Additional optional helpers: <code>convert_bullets_to_ul</code>, <code>_normalize_list_markers</code>, <code>_unescape_brackets_outside_code</code>. Asset utilities provided: <code>prepare_assets</code>, <code>write_overrides_css</code>. These optional functions provide safe fallbacks but do not block the main render functionality. </td></tr><tr><td data-label="Section"> <strong>Diagnostics Setup</strong> </td><td data-label="Details"> <code>_MAX_TRY_MSGS</code> limits the deque <code>_try_msgs</code> to 200 entries for import and runtime messages. <code>_debug</code> is set via <code>RENDER_DEBUG</code> environment variable. <code>_logger</code> is configured for <code>&quot;html_renderer&quot;</code> to handle exception logging during wrapper execution, minification, and fallback operations. </td></tr><tr><td data-label="Section"> <strong>Config Defaults</strong> </td><td data-label="Details"> <code>_DEFAULTS</code> provides baseline configuration: <br> - <code>&quot;ensure_title&quot;</code>: adds class/id to the first <code>&lt;h1&gt;</code> <br> - <code>&quot;minify_html&quot;</code>: enables conservative minification <br> - <code>&quot;process_path_outputs&quot;</code>: optional processing for pathlib.Path outputs <br> - <code>&quot;page_title_class&quot;</code> and <code>&quot;page_title_id&quot;</code> derived from environment variables with fallback defaults <br> <code>_renderer_config</code> is a mutable dictionary allowing runtime updates via <code>set_renderer_config()</code>. </td></tr><tr><td data-label="Section"> <strong>Precompiled Regexes</strong> </td><td data-label="Details"> - <code>_H1_RE</code>: detects <code>&lt;h1&gt;</code> tags with optional attributes <br> - <code>_CLASS_ATTR_RE</code>: parses <code>class</code> attribute values for augmentation <br> - <code>_MINIFY_TOKEN_RE</code>: tokenizes HTML to protect <code>&lt;script&gt;</code>, <code>&lt;style&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;textarea&gt;</code>, <code>&lt;code&gt;</code> blocks, comments, and generic tags for conservative minification. These regexes improve efficiency and reliability, especially on pages with thousands of lines of HTML. </td></tr><tr><td data-label="Section"> <strong>Utility: _record</strong> </td><td data-label="Details"> <code>_record(msg)</code> appends diagnostic messages to <code>_try_msgs</code> safely, avoiding exceptions. Used extensively during imports, fallback detection, wrapper application, and file writes. Ensures import errors are non-fatal but traceable. </td></tr><tr><td data-label="Section"> <strong>Runtime Config Functions</strong> </td><td data-label="Details"> - <code>set_renderer_config(**kwargs)</code>: accepts keys <code>&quot;ensure_title&quot;</code>, <code>&quot;minify_html&quot;</code>, <code>&quot;process_path_outputs&quot;</code>, <code>&quot;page_title_class&quot;</code>, <code>&quot;page_title_id&quot;</code>. Unknown keys are ignored with debug log. <br> - <code>get_renderer_config()</code>: returns shallow copy of active configuration for inspection. <br> - <code>get_import_diagnostics()</code>: returns a structured dictionary of import attempts, helper availability, and current configuration. </td></tr><tr><td data-label="Section"> <strong>Imports with Fallbacks</strong> </td><td data-label="Details"> Import strategy: <br> 1. Attempt <code>render.core_compat</code> (primary, full feature) <br> 2. Attempt <code>render.core_renderer</code> if core_compat fails <br> Optional helpers: <code>convert_bullets_to_ul</code>, <code>_normalize_list_markers</code> from <code>render.convert</code>; <code>_unescape_brackets_outside_code</code> from <code>render.sanitize</code>; <code>prepare_assets</code>, <code>write_overrides_css</code> from <code>render.core_assets</code>. <br> All failures are recorded to <code>_try_msgs</code>. <code>_debug</code> enables full traceback capture. </td></tr><tr><td data-label="Section"> <strong>Fallback Messaging</strong> </td><td data-label="Details"> If <code>render_html</code> is still <code>None</code>, a minimal warning is printed to <code>sys.stderr</code> including all import attempts. Full traceback available if <code>_debug</code> is set. Prevents silent failure while providing diagnostic transparency. </td></tr><tr><td data-label="Section"> <strong>Title Postprocess Helpers</strong> </td><td data-label="Details"> - <code>_add_class_to_existing(class_content, class_name)</code>: safely merges class names, avoiding duplicates. <br> - <code>_ensure_title_in_h1_fragment(fragment)</code>: ensures class and id attributes are present in <code>&lt;h1&gt;</code> fragments. <br> - <code>_ensure_title_attrs_in_str(html)</code>: applies first <code>&lt;h1&gt;</code> updates to full HTML string, non-throwing and conservative. Handles malformed HTML gracefully. </td></tr><tr><td data-label="Section"> <strong>Conservative HTML Minifier</strong> </td><td data-label="Details"> <code>_minify_html_str(html)</code> performs whitespace collapsing outside protected blocks and preserves content of <code>&lt;script&gt;</code>, <code>&lt;style&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;textarea&gt;</code>, <code>&lt;code&gt;</code>, and HTML comments. Uses <code>_MINIFY_TOKEN_RE</code> for tokenization. Robust to malformed HTML and empty strings. Non-throwing, suitable for large pages. </td></tr><tr><td data-label="Section"> <strong>Bytes Helper</strong> </td><td data-label="Details"> <code>_process_bytes(b)</code> decodes bytes using UTF-8 or Latin1 fallback. Applies <code>_ensure_title_attrs_in_str()</code> and <code>_minify_html_str()</code> according to <code>_renderer_config</code>. Re-encodes as UTF-8. Returns original bytes on error. Handles <code>bytes</code> and <code>bytearray</code> consistently. </td></tr><tr><td data-label="Section"> <strong>Wrapper Factory</strong> </td><td data-label="Details"> <code>_wrap_callable(fn)</code> wraps any callable to automatically post-process outputs according to <code>_renderer_config</code>. Handles: <br> - <code>str</code>: applies title and minification <br> - <code>bytes</code> / <code>bytearray</code>: processes through <code>_process_bytes</code> <br> - <code>pathlib.Path</code>: optionally processes string path <br> Preserves introspection: <code>__name__</code>, <code>__doc__</code>, <code>__wrapped__</code>, and marks <code>__tv_wrapped__ = True</code>. Non-throwing. Idempotent to prevent double wrapping. </td></tr><tr><td data-label="Section"> <strong>Apply Wrappers</strong> </td><td data-label="Details"> All imported or fallback functions are wrapped using <code>_wrap_callable</code>. Ensures consistent postprocessing across <code>render_html</code>, <code>render_table</code>, <code>render_page</code>. Wrappers applied conditionally if functions are not <code>None</code>. </td></tr><tr><td data-label="Section"> <strong>Diagnostic Helper</strong> </td><td data-label="Details"> <code>generate_diagnostic_report(html_sample=None)</code> returns a dictionary including: <br> - Import attempts and helper availability <br> - Wrapped status of callables <br> - Runtime notes (<code>_debug</code>, <code>_logger.level</code>) <br> - Optional HTML before/after snippet processed with <code>_ensure_title_attrs_in_str()</code> and <code>_minify_html_str()</code> <br> - Truncated snippets up to 2048 characters, enabling comparison without excessive memory usage. </td></tr><tr><td data-label="Section"> <strong>Fallback Minimal Renderer</strong> </td><td data-label="Details"> Provides safe, non-throwing rendering when core modules are unavailable. Functions: <br> - <code>_fallback_render_html(tables, output_path, inline_formatter=None, page_title=None)</code>: generates HTML page with inline CSS, H1 title, optional Table headings, preserves inline code. Handles list of DataFrames, strings, dicts, or sequences. Writes UTF-8 safely. <br> - <code>_fallback_render_table(df)</code>: returns minimal HTML or placeholder <code>&lt;pre&gt;</code>. <br> - <code>_fallback_render_page(html_str, output_path=None)</code>: writes HTML to disk or returns string/bytes with postprocessing. </td></tr><tr><td data-label="Section"> <strong>Fallback Table Helper</strong> </td><td data-label="Details"> <code>_df_to_html_preserve_code(df)</code> converts DataFrame to HTML while preserving inline backtick code. Generates unique token keys for replacements, ensures index=False and border=0, robust to NaNs and malformed content. </td></tr><tr><td data-label="Section"> <strong>Fallback Page Renderer</strong> </td><td data-label="Details"> <code>_fallback_render_html()</code> builds minimal HTML page: <br> - DOCTYPE, meta charset, viewport <br> - Inline CSS for readable fallback page <br> - H1 page title using <code>_renderer_config</code> class/id <br> - Tables rendered with headings <code>&lt;h3&gt;</code> sequentially <br> - Inline code preserved using <code>&lt;code&gt;</code> tags <br> - Non-table content wrapped in <code>&lt;pre&gt;</code> <br> Writes safely with parent directories creation. </td></tr><tr><td data-label="Section"> <strong>Fallback Single Table</strong> </td><td data-label="Details"> <code>_fallback_render_table(df)</code> detects if <code>df</code> is a DataFrame and uses <code>_df_to_html_preserve_code</code>. Returns <code>&lt;pre&gt;(not a table)&lt;/pre&gt;</code> if invalid. </td></tr><tr><td data-label="Section"> <strong>Fallback Page Postprocessor</strong> </td><td data-label="Details"> <code>_fallback_render_page(html_str, output_path=None)</code> converts string/bytes, applies <code>_process_bytes()</code>, writes to disk if path provided, otherwise returns UTF-8 string. Non-throwing. </td></tr><tr><td data-label="Section"> <strong>Assign Fallbacks</strong> </td><td data-label="Details"> <code>_wrap_callable()</code> applied to all fallback functions, ensuring consistent interface. <code>_record()</code> logs fallback assignment. Guarantees <code>render_html</code>, <code>render_table</code>, <code>render_page</code> are always callable. </td></tr><tr><td data-label="Section"> <strong>Final Exports List</strong> </td><td data-label="Details"> <code>__all__</code> ensures public API includes: <br> <code>render_html</code>, <code>render_table</code>, <code>render_page</code>, <code>prepare_assets</code>, <code>write_overrides_css</code>, <code>convert_bullets_to_ul</code>, <code>_normalize_list_markers</code>, <code>_unescape_brackets_outside_code</code>, <code>get_import_diagnostics</code>, <code>set_renderer_config</code>, <code>get_renderer_config</code>, <code>generate_diagnostic_report</code>. </td></tr><tr><td data-label="Section"> <strong>Content Safety & Non-Throwing Guarantees</strong> </td><td data-label="Details"> All wrappers and fallback functions are non-throwing. HTML and byte processing is conservative. Import failures are recorded in <code>_try_msgs</code> without stopping execution. Fallback HTML ensures minimal renderable output. </td></tr><tr><td data-label="Section"> <strong>Large Page Handling</strong> </td><td data-label="Details"> Precompiled regexes, tokenized minification, and deque diagnostics allow handling of large HTML pages efficiently. <code>_MINIFY_TOKEN_RE</code> ensures protected blocks remain intact even with thousands of lines of HTML. </td></tr><tr><td data-label="Section"> <strong>Runtime Config Application</strong> </td><td data-label="Details"> <code>_renderer_config</code> flags (<code>ensure_title</code>, <code>minify_html</code>, <code>process_path_outputs</code>) are consistently applied during all postprocessing stages. Ensures predictable output regardless of input type or origin. </td></tr><tr><td data-label="Section"> <strong>Logging & Debug</strong> </td><td data-label="Details"> <code>_logger</code> handles exceptions during title postprocess, minifier, wrapper, and byte processor. <code>_debug</code> triggers full traceback logging to <code>_try_msgs</code> for analysis. </td></tr><tr><td data-label="Section"> <strong>Atomicity / Idempotence</strong> </td><td data-label="Details"> <code>_wrap_callable</code> ensures a callable is wrapped only once. Existing attributes <code>__tv_wrapped__</code> prevent double wrapping. Original function attributes preserved for introspection. </td></tr><tr><td data-label="Section"> <strong>Safety in Fallback HTML</strong> </td><td data-label="Details"> Minimal page fallback writes valid UTF-8, inline CSS for readability, preserves code and string content. Inline <code>&lt;code&gt;</code> tags are used to protect DataFrame inline code. Non-table content uses <code>&lt;pre&gt;</code> tags. </td></tr><tr><td data-label="Section"> <strong>Compatibility Notes</strong> </td><td data-label="Details"> Designed to maintain backwards compatibility for <code>main.py</code> and other consumers. Ensures rendering works even if core modules fail. Provides consistent interface and output types. </td></tr><tr><td data-label="Section"> <strong>Error Handling Philosophy</strong> </td><td data-label="Details"> Import errors, post-processing exceptions, minification failures, and fallback writes are non-fatal. All errors recorded with <code>_record()</code> to maintain traceability. Ensures robust operation under degraded conditions. </td></tr><tr><td data-label="Section"> <strong>Sample HTML Diagnostics</strong> </td><td data-label="Details"> <code>generate_diagnostic_report(html_sample)</code> truncates before/after HTML snippets to 2048 characters. Allows inspection of <code>_ensure_title_attrs_in_str</code> and <code>_minify_html_str</code> effects. Provides safe, controlled view into processing results. </td></tr><tr><td data-label="Section"> <strong>Markdown-Safe Table Implementation</strong> </td><td data-label="Details"> Documentation enforces strict 2-column format: Column 1 for section name, Column 2 for details. Long sections split into multiple rows with continuation marker <code>&quot;&quot;</code> in Column 1. Ensures GitHub, VSCode, and browser Markdown renderers correctly display structure. </td></tr><tr><td data-label="Section"> <strong>Nested List Preservation</strong> </td><td data-label="Details"> Bullet points, numbered steps, and nested explanations preserved in Column 2 using <code>&lt;br&gt;</code> or literal newlines. Supports multiple levels without creating extra columns. </td></tr><tr><td data-label="Section"> <strong>Final Verification Steps</strong> </td><td data-label="Details"> After table generation: <br> - Confirm all rows = 2 columns <br> - Markdown renders correctly in VSCode, GitHub, browsers <br> - All fallback paths tested <br> - All wrapped callables confirmed <br> - Configuration flags applied consistently <br> - No content lost in merges or fallback processing </td></tr><tr><td data-label="Section"> <strong>World-Class Safety Measures</strong> </td><td data-label="Details"> - Protected HTML blocks preserved during minification <br> - Inline <code>&lt;code&gt;</code> preserved in DataFrames <br> - Safe UTF-8 writes with directory creation <br> - Non-empty HTML output guaranteed even if core modules fail <br> - Fallback functions provide minimal but valid HTML pages </td></tr><tr><td data-label="Section"> <strong>Performance Considerations</strong> </td><td data-label="Details"> Precompiled regexes, tokenized minification, and deque diagnostics optimize performance on large pages. String operations minimized, streaming writes for fallback HTML improve efficiency. </td></tr><tr><td data-label="Section"> <strong>Reviewer Checklist</strong> </td><td data-label="Details"> 1. Confirm <code>_wrap_callable</code> wrappers applied correctly <br> 2. Validate <code>_ensure_title_attrs_in_str</code> updates only first <code>&lt;h1&gt;</code> <br> 3. Check <code>_minify_html_str</code> preserves scripts/styles/pre/code/textarea <br> 4. Test <code>_fallback_render_html</code> with multiple DataFrames <br> 5. Verify <code>_process_bytes</code> handles str, bytes, bytearray <br> 6. Inspect <code>_try_msgs</code> for all import/fallback logs <br> 7. Check <code>generate_diagnostic_report</code> outputs correctly </td></tr><tr><td data-label="Section"> <strong>Unit Testing Recommendations</strong> </td><td data-label="Details"> - Test imports with modules present and missing <br> - Render strings, DataFrames, and mixed sequences <br> - Verify postprocessing preserves title, minification, and byte encoding <br> - Test fallback write to disk with invalid paths <br> - Validate diagnostic report completeness <br> - Test <code>_df_to_html_preserve_code</code> with NaNs, code, and special characters </td></tr><tr><td data-label="Section"> <strong>Documentation / Operational Notes</strong> </td><td data-label="Details"> Documents which functions are optional, fallback mechanisms, runtime configuration via environment or <code>set_renderer_config()</code>, and safe HTML rendering strategies even in degraded environments. </td></tr><tr><td data-label="Section"> <strong>Security & Robustness</strong> </td><td data-label="Details"> Minimal XSS risk in fallback rendering. DataFrame content escaped. Inline code preserved. Non-throwing handling prevents crashes. Logging provides traceable record for analysis. </td></tr><tr><td data-label="Section"> <strong>Extensibility</strong> </td><td data-label="Details"> Wrappers designed to support future extensions: additional postprocessing, logging, output transformation. Can wrap new renderers without altering original logic. </td></tr><tr><td data-label="Section"> <strong>Summary / Takeaway</strong> </td><td data-label="Details"> This <code>html_renderer</code> wrapper provides production-safe, fully wrapped rendering functions, conservative minification, diagnostics, asset utilities, and fallback mechanisms. Guarantees non-throwing behavior, preserves input/output types, applies runtime configuration consistently, and produces minimal safe HTML even when core modules fail. Ensures maintainability, extensibility, and operational transparency for enterprise rendering workflows. </td></tr></tbody></table></div><div class="row-count">Rows: 42</div></div><div class="table-caption" id="Table4" data-table="Book_8043_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4 — utils.py</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Function / Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Function / Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details / Behavior**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details / Behavior</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Function / Section"> <code>normalize_whitespace(text: str)</code> </td><td data-label="Details / Behavior"> Collapses multiple spaces, tabs, and newlines into single spaces. Strips leading/trailing whitespace. Useful for consistent parsing of Markdown table cells, slugs, or any text normalization. </td></tr><tr><td data-label="Function / Section"> <code>split_table_row(line: str, delimiter: str = &#x27;|&#x27;)</code> </td><td data-label="Details / Behavior"> Safely splits a Markdown table row into a list of cell strings. Handles escaped delimiters (<code>\|</code>) and preserves pipes inside backtick-enclosed inline code. Trims leading/trailing whitespace while keeping underscores intact. Returns empty list for <code>None</code> input. </td></tr><tr><td data-label="Function / Section"> <strong>Splitting logic</strong> </td><td data-label="Details / Behavior"> If line has no backticks or escapes and delimiter is <code>|</code>, simple split/strip is performed. Otherwise, iterates character by character, tracks backtick state to avoid splitting inside inline code, handles escaped delimiters, and collects parts into a list. Removes leading/trailing empty cells caused by outer pipes. </td></tr><tr><td data-label="Function / Section"> <code>is_table_separator(line: str)</code> </td><td data-label="Details / Behavior"> Detects Markdown table separator lines (e.g., <code>| --- | ---: | :---:</code>). Accepts optional leading/trailing pipes, dashes with optional colons. Rejects empty lines and lines with em-dashes. Splits line with <code>split_table_row</code> and ensures each part matches regex <code>:?-{1,}:?</code>. </td></tr><tr><td data-label="Function / Section"> <code>parse_table(lines: List[str])</code> </td><td data-label="Details / Behavior"> Converts a list of Markdown lines into a 2D list of table cells. Ignores blank lines and separator lines. Calls <code>split_table_row</code> for each row, preserving underscores and inline text. </td></tr><tr><td data-label="Function / Section"> <code>is_list_item(line: str)</code> </td><td data-label="Details / Behavior"> Detects unordered (<code>-</code>, <code>*</code>, <code>+</code>) and ordered (<code>1.</code>) Markdown list items. Uses regex <code>^\s*(?:[-*+]|\d+\.)\s+</code>. Returns <code>True</code> if line matches a list item pattern. </td></tr><tr><td data-label="Function / Section"> <code>extract_list(lines: List[str])</code> </td><td data-label="Details / Behavior"> Extracts only list items from given lines. Iterates through lines, calls <code>is_list_item</code>, strips leading/trailing whitespace, and returns a list of list strings. Preserves underscores and other characters. </td></tr><tr><td data-label="Function / Section"> <code>safe_slug(name: str)</code> </td><td data-label="Details / Behavior"> Generates a URL/HTML-safe slug from input string. Normalizes whitespace first. Replaces non-alphanumeric characters except underscore <code>_</code> with hyphens. Strips leading/trailing hyphens. Converts to lowercase. Suitable for IDs, anchors, and HTML element references. </td></tr><tr><td data-label="Function / Section"> <code>chunk_lines(lines: List[str], marker: str)</code> </td><td data-label="Details / Behavior"> Splits a list of lines into multiple chunks using a marker line. Each occurrence of the marker starts a new chunk. Preserves line order. Returns a list of line lists. Useful for segmenting Markdown sections or table blocks. </td></tr><tr><td data-label="Function / Section"> <code>strip_comments(line: str, comment_markers: Optional[List[str]] = None)</code> </td><td data-label="Details / Behavior"> Removes inline comments safely. Defaults to <code>#</code> and <code>//</code>. Avoids stripping URL schemes containing <code>://</code>. For <code>#</code>, skips cutting if appears after <code>://</code>. Trims trailing spaces after comment removal. Returns cleaned line or empty string if input is <code>None</code>. </td></tr><tr><td data-label="Function / Section"> <strong>Edge handling / safety</strong> </td><td data-label="Details / Behavior"> <code>None</code> inputs return empty list or string. Escaped delimiters, backtick code spans, and URLs are preserved. Leading/trailing empty cells in Markdown tables are removed to prevent parsing errors. </td></tr><tr><td data-label="Function / Section"> <strong>Use cases</strong> </td><td data-label="Details / Behavior"> Preparing Markdown tables for strict 2-column workflows, detecting lists for formatting, cleaning text for slugs/IDs, chunking text for processing, safely stripping inline comments in Markdown or code-like input, normalizing whitespace for consistent rendering. </td></tr><tr><td data-label="Function / Section"> <strong>Integration notes</strong> </td><td data-label="Details / Behavior"> Can be combined with table normalizers to enforce strict 2-column structures. <code>split_table_row</code> and <code>parse_table</code> handle row consistency. <code>extract_list</code> supports multi-line Markdown list conversion. <code>safe_slug</code> ensures compatibility with HTML/JS anchor references. <code>strip_comments</code> ensures lines can be safely displayed without accidental truncation of URLs. </td></tr><tr><td data-label="Function / Section"> <strong>Performance considerations</strong> </td><td data-label="Details / Behavior"> Iterative character parsing in <code>split_table_row</code> is linear with line length. Regex operations for list detection, slug creation, and separator matching are lightweight and suitable for typical Markdown file sizes. Escaped delimiters and backtick checks ensure correctness at minor performance cost. </td></tr><tr><td data-label="Function / Section"> <strong>Limitations</strong> </td><td data-label="Details / Behavior"> Does not fully parse nested tables inside cells or fenced code blocks. Separator detection assumes minimal Markdown compliance (<code>---</code>, <code>:---:</code>). List detection does not parse nested indent levels beyond first-level marker recognition. </td></tr><tr><td data-label="Function / Section"> <strong>Robustness</strong> </td><td data-label="Details / Behavior"> Functions handle edge cases like <code>None</code>, empty lines, escaped characters, and inline code. Designed for preprocessing Markdown for further strict 2-column transformations, list normalization, and slug generation. </td></tr><tr><td data-label="Function / Section"> <strong>Recommended next steps</strong> </td><td data-label="Details / Behavior"> Integrate with row coalescing and multi-line cell normalization functions. Use <code>normalize_whitespace</code> before slug or table operations. Validate with sample tables containing pipes, inline code, and escaped characters. Combine with refined workflow rules for strict 2-column Markdown tables. </td></tr></tbody></table></div><div class="row-count">Rows: 17</div></div><div class="table-caption" id="Table5" data-table="Book_8043_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5 — assets.py</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details / Implementation Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details / Implementation Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown"> <strong>Module Imports</strong> </td><td data-label="Details / Implementation Notes"> Imports <code>os</code> and <code>shutil</code> to handle filesystem operations, directory creation, and file copying. No third-party dependencies. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Fallback Embedded Assets</strong> </td><td data-label="Details / Implementation Notes"> <code>_EMBED_STYLE</code> contains minimal CSS fallback for light-mode table rendering; <code>_EMBED_SCRIPT</code> is a no-op fallback script. Both are used if project assets are missing or inaccessible. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Function: <code>copy_assets(output_dir: str)</code></strong> </td><td data-label="Details / Implementation Notes"> Ensures <code>output_dir/assets</code> exists, copies <code>style.css</code> and <code>script.js</code> from project <code>assets/</code> directory if available, otherwise writes fallback content. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Output Directory Setup</strong> </td><td data-label="Details / Implementation Notes"> <code>out_assets = os.path.join(output_dir, &quot;assets&quot;)</code><br><code>os.makedirs(out_assets, exist_ok=True)</code> ensures directory exists safely. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Project Assets Detection</strong> </td><td data-label="Details / Implementation Notes"> <code>project_assets_dir</code> calculated as parent directory <code>../assets</code> relative to current file; normalized for cross-platform compatibility. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Copy Loop</strong> </td><td data-label="Details / Implementation Notes"> Iterates <code>(&quot;style.css&quot;, &quot;script.js&quot;)</code>; checks if source exists:<br>• If yes, <code>shutil.copy2(src, dst)</code> to preserve metadata.<br>• If no, writes fallback content (<code>_EMBED_STYLE</code> or <code>_EMBED_SCRIPT</code>). </td></tr><tr><td data-label="Technical Breakdown"> <strong>Error Handling During Copy</strong> </td><td data-label="Details / Implementation Notes"> Wrapped in <code>try-except</code>: on any exception, fallback content is written to ensure assets are always present, preventing broken table styles or scripts. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Fallback When Project Assets Missing</strong> </td><td data-label="Details / Implementation Notes"> If <code>project_assets_dir</code> does not exist, writes <code>_EMBED_STYLE</code> and <code>_EMBED_SCRIPT</code> directly to <code>out_assets</code>. Guarantees non-empty fallback files. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Function: <code>write_overrides_css(output_dir: str, left_width: float, right_width: float) -&gt; str</code></strong> </td><td data-label="Details / Implementation Notes"> Writes <code>overrides.css</code> into <code>output_dir/assets</code> with dynamically calculated column widths. Returns CSS string. Ensures atomic creation of assets directory. </td></tr><tr><td data-label="Technical Breakdown"> <strong>CSS Theme Variables</strong> </td><td data-label="Details / Implementation Notes"> Defines light mode defaults (<code>--header-bg</code>, <code>--text</code>, row colors). Dark mode overrides included with <code>data-theme=&quot;dark&quot;</code> or <code>body.dark-mode</code>. Header highlight colors and row hover colors adjusted for visibility in dark mode. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Table Layout Enforcement</strong> </td><td data-label="Details / Implementation Notes"> Table set to <code>table-layout: fixed</code>, width 100%, border-collapse for consistent rendering.<br>Header cells (<code>th</code>) vertically aligned, flex wrappers ensure content centering. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Sticky First Column</strong> </td><td data-label="Details / Implementation Notes"> First column <code>th</code> and <code>td</code> use <code>position: sticky</code> with appropriate <code>z-index</code>. Shadows and explicit background colors ensure correct stacking and zebra row alignment. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Zebra Row Styling</strong> </td><td data-label="Details / Implementation Notes"> Odd/even row background colors applied to all cells, including sticky first column cells, with <code>!important</code> to prevent override from other stylesheets. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Hover Highlight</strong> </td><td data-label="Details / Implementation Notes"> Row hover highlights applied to entire row including sticky first column. Dark mode hover also handled. Ensures clear visual feedback without breaking sticky behavior. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Header Hover / Active States</strong> </td><td data-label="Details / Implementation Notes"> Dark-mode header hover/focus/active states have explicit background and color (<code>--header-highlight-bg</code> / <code>--header-highlight-color</code>). Transition applied for smooth visual feedback. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Column Width Variables</strong> </td><td data-label="Details / Implementation Notes"> <code>left_width</code> and <code>right_width</code> parameters used for first column and remaining columns. Widths applied consistently to <code>th</code> and <code>td</code> to maintain table proportionality. </td></tr><tr><td data-label="Technical Breakdown"> <strong>List Styling in Table Cells</strong> </td><td data-label="Details / Implementation Notes"> Top-level <code>&lt;ul&gt;</code>/<code>&lt;ol&gt;</code> reset, margin/padding normalized.<br>• <code>&lt;ul&gt;</code> uses en-dash <code>–</code><br>• Nested <code>&lt;ul&gt;</code> uses bullet <code>•</code> with muted color.<br>• <code>&lt;ol&gt;</code> uses <code>counter-reset</code> with numeric markers.<br>Ensures consistent list rendering across all cells. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Nested Lists and Debug Fallback</strong> </td><td data-label="Details / Implementation Notes"> Forces list markers with <code>!important</code> for <code>&lt;ul&gt;</code> and <code>&lt;ol&gt;</code> to override heavy project styles. Nested bullets (<code>•</code>) slightly smaller, muted color. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Writing Overrides CSS</strong> </td><td data-label="Details / Implementation Notes"> Writes the assembled CSS string to <code>overrides.css</code> under <code>assets_dir</code>. Uses <code>try-except</code> to ignore failures silently, aligning with fallback philosophy. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Return Value</strong> </td><td data-label="Details / Implementation Notes"> Returns the complete CSS string. Useful for inline embedding or further inspection. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Operational Guarantees</strong> </td><td data-label="Details / Implementation Notes"> • Assets always exist: <code>style.css</code>, <code>script.js</code>, <code>overrides.css</code>.<br>• Fallbacks prevent broken table layouts.<br>• Dark/light mode themes supported automatically.<br>• First column sticky and zebra row behavior robust against external CSS. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Resilience</strong> </td><td data-label="Details / Implementation Notes"> Non-fatal handling ensures that missing project assets do not prevent table rendering. All write operations best-effort, consistent with production-ready conservative asset management. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Scalability Notes</strong> </td><td data-label="Details / Implementation Notes"> The approach supports variable table widths dynamically and multiple table instances per page. CSS variables allow easy theming without changing base CSS. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Cross-Platform Path Safety</strong> </td><td data-label="Details / Implementation Notes"> Uses <code>os.path.join</code> and <code>os.path.normpath</code> for platform-independent path handling. Works on Windows, Linux, and macOS. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Summary / Purpose</strong> </td><td data-label="Details / Implementation Notes"> This file provides fallback asset management and CSS overrides for table rendering.<br>• Guarantees consistent table appearance.<br>• Ensures first column sticky behavior, row zebra striping, hover highlights.<br>• Supports dark and light mode themes.<br>• Handles nested lists in table cells consistently.<br>• Provides non-destructive fail-safe fallbacks if project assets are missing. </td></tr></tbody></table></div><div class="row-count">Rows: 25</div></div><div class="table-caption" id="Table6" data-table="Book_8043_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6 — cli.py</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section / Component**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section / Component</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Detailed Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Detailed Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section / Component"> <strong>File Purpose / Overview</strong>               </td><td data-label="Detailed Technical Breakdown"> Minimal, robust CLI for <code>tables_viewer_v2_1</code>. Provides a command-line interface to render table sources into HTML output. Designed to gracefully handle missing internal modules or optional configuration objects. Ensures fallback strategies for both imports and function signatures.                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Section / Component"> <strong>Imports: Standard Library</strong>             </td><td data-label="Detailed Technical Breakdown"> <code>argparse</code> – command-line argument parsing. <br> <code>sys</code> – access to <code>argv</code> and exit functions. <br> <code>pathlib.Path</code> – consistent filesystem path handling.                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section / Component"> <strong>Imports: Internal Modules</strong>             </td><td data-label="Detailed Technical Breakdown"> Tries explicit internal imports to prevent package re-export issues. <br> - <code>render.core_compat.render_html</code> preferred. <br> - Fallback: <code>from render import render_html</code>. <br> Resolves <code>RenderConfig</code> from likely locations with multiple fallbacks: <code>render.types.RenderConfig</code>, <code>render.RenderConfig</code>, else <code>None</code>.                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Section / Component"> <strong>Function: parse_args</strong>                  </td><td data-label="Detailed Technical Breakdown"> Parses CLI arguments. <br> <strong>Arguments:</strong> <code>argv</code> (list of strings). <br> <strong>Parser setup:</strong> <br> - Positional <code>source</code>: input path (file or directory). <br> - Optional <code>-o/--output</code>: output directory (default <code>&quot;output_combined&quot;</code>). <br> - Optional <code>--embed-assets</code>: boolean flag to embed assets into output. <br> Returns: <code>argparse.Namespace</code> with parsed values.                                                                                                                                                                                            </td></tr><tr><td data-label="Section / Component"> <strong>Function: _make_config</strong>                </td><td data-label="Detailed Technical Breakdown"> Constructs a <code>RenderConfig</code> object if available. <br> <strong>Arguments:</strong> <code>output_path: Path</code>, <code>embed_assets: bool</code>. <br> <strong>Strategy:</strong> Attempts multiple common constructor signatures to maximize compatibility: <br> 1. <code>output_dir=str(output_path), embed_assets=embed_assets</code> <br> 2. <code>output_path=str(output_path), embed_assets=embed_assets</code> <br> 3. <code>output=str(output_path), embed_assets=embed_assets</code> <br> 4. No-argument constructor. <br> Returns: <code>RenderConfig</code> instance or <code>None</code>.                                                                     </td></tr><tr><td data-label="Section / Component"> <strong>Function: main</strong>                        </td><td data-label="Detailed Technical Breakdown"> Primary CLI entrypoint. <br> <strong>Arguments:</strong> optional <code>argv</code> list; defaults to <code>sys.argv[1:]</code>. <br> <strong>Workflow:</strong> <br> 1. Parse arguments with <code>parse_args</code>. <br> 2. Convert <code>source</code> and <code>output</code> to <code>Path</code> objects. <br> 3. Create <code>RenderConfig</code> via <code>_make_config</code>. <br> 4. Attempt rendering: <br>   - If <code>cfg</code> available, call <code>render_html(str(src), config=cfg)</code>; fallback: <code>render_html(str(src), str(out), config=cfg)</code>. <br>   - Else fallback to <code>render_html(str(src), str(out))</code> or <code>render_html(str(src))</code>. <br> Returns the result of <code>render_html</code>. </td></tr><tr><td data-label="Section / Component"> <strong>Import Fallback Strategy</strong>              </td><td data-label="Detailed Technical Breakdown"> Handles missing internal modules gracefully. <br> - Uses <code>try/except</code> chains to prefer project/core implementations first. <br> - Avoids crashes if modules or classes (<code>RenderConfig</code>) are absent. <br> - Enables CLI to work even with partial library availability.                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section / Component"> <strong>RenderConfig Compatibility Handling</strong>   </td><td data-label="Detailed Technical Breakdown"> <code>_make_config</code> ensures CLI works across different versions or variations of <code>RenderConfig</code>. <br> - Attempts all common constructor parameter names. <br> - Avoids positional-parameter mismatches. <br> - Returns <code>None</code> if no compatible constructor is found.                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section / Component"> <strong>Path Normalization</strong>                    </td><td data-label="Detailed Technical Breakdown"> Converts <code>source</code> and <code>output</code> to <code>Path</code> objects early. <br> - Ensures consistent filesystem operations across OSes. <br> - Simplifies later calls to <code>render_html</code> that expect string paths.                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section / Component"> <strong>Render Function Fallbacks</strong>             </td><td data-label="Detailed Technical Breakdown"> <code>main</code> includes layered fallback for calling <code>render_html</code>: <br> 1. With <code>config</code> keyword. <br> 2. With <code>config</code> + explicit output path. <br> 3. With output path only. <br> 4. With source only. <br> Ensures CLI works regardless of function signature variations in different library versions.                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Section / Component"> <strong>CLI Exit Behavior</strong>                     </td><td data-label="Detailed Technical Breakdown"> <code>if __name__ == &quot;__main__&quot;</code> block: <br> - Calls <code>main()</code> and raises <code>SystemExit</code> with its return value. <br> - Ensures proper shell exit codes propagate.                                                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Section / Component"> <strong>Error Handling Philosophy</strong>             </td><td data-label="Detailed Technical Breakdown"> - Uses <code>try/except</code> liberally for import and constructor fallbacks. <br> - Avoids crashing the CLI on missing optional components. <br> - Prioritizes graceful degradation and maximum compatibility.                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section / Component"> <strong>Keyword Safety / Positional Avoidance</strong> </td><td data-label="Detailed Technical Breakdown"> Prefers keyword arguments (<code>config=cfg</code>) to avoid positional mismatches, particularly when calling <code>render_html</code>. <br> Improves forward compatibility with future changes in function signature.                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Section / Component"> <strong>Embed Assets Option</strong>                   </td><td data-label="Detailed Technical Breakdown"> CLI argument <code>--embed-assets</code> toggles embedding of CSS/JS assets into the rendered output. <br> Passed to <code>_make_config</code> to propagate into <code>RenderConfig</code>.                                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Section / Component"> <strong>Output Directory Default</strong>              </td><td data-label="Detailed Technical Breakdown"> Default <code>&quot;output_combined&quot;</code> ensures predictable behavior when no <code>-o</code> is provided. <br> Can be overridden via CLI argument.                                                                                                                                                                                                                                                                                                                                                                                                                                         </td></tr><tr><td data-label="Section / Component"> <strong>Graceful None Handling</strong>                </td><td data-label="Detailed Technical Breakdown"> <code>RenderConfig</code> may be <code>None</code>. <br> <code>_make_config</code> ensures downstream calls to <code>render_html</code> still execute using signature fallbacks.                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Section / Component"> <strong>Summary / Technical Guarantees</strong>        </td><td data-label="Detailed Technical Breakdown"> - CLI works even if internal modules are missing. <br> - Config object is optional but leveraged when available. <br> - Multiple constructor and function signature fallbacks provide robustness. <br> - Minimal, robust, production-ready CLI for rendering tables to HTML.                                                                                                                                                                                                                                                                                        </td></tr></tbody></table></div><div class="row-count">Rows: 17</div></div><div class="table-caption" id="Table7" data-table="Book_8043_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7 — convert.py</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Component / Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Component / Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Description, Behavior, Notes, Edge Cases, Design Decisions**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Description, Behavior, Notes, Edge Cases, Design Decisions</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Component / Section"> <strong>Imports & Logging</strong>             </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>typing, re, html, logging, itertools, csv, io, collections.Counter</code> — Provides type hints, regex parsing, HTML escaping, CSV handling, iterator utilities, and frequency counting. Logging uses <code>NullHandler</code> by default to avoid spurious output. Ensures module can run silently in production or debug-enabled with minimal configuration.                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Component / Section"> <strong>Regex Constants</strong>               </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>_BULLET_LEADING_RE</code> detects leading bullet numbers (<code>^\s*\d+\.</code>). <code>_BULLET_LINE_RE</code> captures lines that are likely list items. <code>_INLINE_HEADING_RE</code> detects inline headings for left-column bold formatting. <code>_DIV_SPLIT_RE</code> splits <code>&lt;div&gt;</code> blocks safely. <code>_STRONG_TAG_RE</code> captures <code>&lt;strong&gt;</code> tags for bold sanitization. <code>_LEFT_COL_BOLD_DETECT_RE</code> identifies bold in left-column headers. <code>_PRE_RE</code> and <code>_CODE_RE</code> match <code>&lt;pre&gt;</code> and <code>&lt;code&gt;</code> for code block preservation. <code>_DIVIDER_PART_RE</code> identifies Markdown header divider rows. Centralizing regexes improves performance and maintainability while allowing consistent parsing behavior.                             </td></tr><tr><td data-label="Component / Section"> <strong>Fallback Utilities</strong>            </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>_strip_tags(html_text)</code> removes HTML tags for safe text extraction. <code>sanitize_bold_html(html_text)</code> ensures only valid <code>&lt;strong&gt;</code> tags remain. <code>convert_markdown_lists(text)</code> converts Markdown-style numeric lists into HTML <code>&lt;ol&gt;&lt;li&gt;</code> while handling nested numbering safely. <code>_escape_unmatched_markers(text)</code> ensures unmatched Markdown markers (<code>*</code>, <code>_</code>) are safely escaped. Design ensures module functions even when external utilities or project-specific modules are unavailable.                                                                                                                                                                                    </td></tr><tr><td data-label="Component / Section"> <strong>Line and Text Helpers</strong>         </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>_normalize_leading_bullet(line)</code> trims leading numeric bullets. <code>_escape_markdown_list_markers(text)</code> prevents misinterpretation of numeric bullets as actual lists. <code>_unescape_brackets_outside_code(html_text)</code> restores brackets outside <code>&lt;code&gt;</code> blocks. <code>_take_and_stream(rows_iterable, n)</code> streams the first <code>n</code> rows safely without exhausting generator objects. <code>_detect_column_types(sample_rows, cols)</code> infers numeric, percentage, or text types, ensuring correct HTML formatting. <code>_clean_label_for_datalabel(s)</code> sanitizes column headers for safe HTML ID/data-label attributes. Helpers are robust to <code>None</code> inputs, malformed text, and mixed-type columns.    </td></tr><tr><td data-label="Component / Section"> <strong>CSV Detection & Parsing</strong>       </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>_looks_like_csv(lines)</code> uses heuristic scoring to detect likely CSV content by counting delimiter frequency consistency. <code>parse_csv_tables(text, delimiter=None, assume_header=None)</code> handles CSV parsing with optional delimiter and automatic header detection. Includes padding of ragged rows, multi-pass delimiter sniffing, and fallback naive splitting. Edge cases handled: CSVs with missing values, quoted delimiters inside fields, numeric-only rows, empty lines.                                                                                                                                                                                                    </td></tr><tr><td data-label="Component / Section"> <strong>Markdown Table Parser</strong>         </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>parse_markdown_tables(text)</code> extracts pipe-style Markdown tables robustly. Handles escaped pipes (<code>\|</code>), inline code within cells, leading/trailing pipes, and uneven row lengths. Internal <code>_split_row_keep_code(row_line)</code> preserves backtick-enclosed text. <code>_is_divider_line(row_line)</code> identifies valid Markdown header dividers. Normalization ensures padded rows align with header count. Edge cases include single-column tables, tables with mixed inline code and bold, and malformed pipes.                                                                                                                                                                           </td></tr><tr><td data-label="Component / Section"> <strong>DataFrame Shims</strong>               </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>_SimpleColumns</code> and <code>_SimpleDF</code> provide lightweight DataFrame-like objects. Preserve column access, row iteration, length, and tuple conversion. Used as fallback when pandas is unavailable. Simplified interface: column names list, row iteration as tuples. Supports basic indexing (<code>df[col]</code>) and row iteration. Limits: no groupby, aggregation, or multi-index support.                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Component / Section"> <strong>Debug Extraction</strong>              </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>extract_tables_debug(text)</code> returns Markdown pipe tables and detected HTML tables for inspection. Uses local versions of <code>_split_row_keep_code_local</code> and <code>_is_divider_line_local</code> to avoid global conflicts. Returns results as <code>_SimpleDF</code> objects if pandas is missing, otherwise real DataFrames. Edge handling: malformed tables, empty cells, missing headers. Useful for logging and development debugging pipelines.                                                                                                                                                                                                                                                      </td></tr><tr><td data-label="Component / Section"> <strong>Markdown Renderer Selector</strong>    </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>_get_default_markdown_renderer()</code> returns a callable to convert Markdown to HTML. Prefers project <code>markdown.py</code> if available. Fallback: inline replacement supporting bold (<code>**</code>), italics (<code>*</code>), inline code (`<code> </code> ``). Handles simple nested formatting. Design choice ensures rendering works even if the full Markdown library is missing. Edge cases: unbalanced markers are escaped safely.                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Component / Section"> <strong>Main Table Renderer</strong>           </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>render_table(df, idx=1, markdown_to_html_func=None, left_width=None, right_width=None, total_tables=None, title=None, with_tools=True)</code> — Converts a DataFrame or compatible object to fully structured HTML table. Steps: 1) Detect column types and count. 2) Build <code>&lt;thead&gt;</code> with optional title. 3) Iterate rows: escape HTML, convert Markdown, preserve code blocks. 4) Handle left-column bold if first column. 5) Handle unmatched markers and bracket unescaping. 6) Generate <code>&lt;tbody&gt;</code> row-by-row with optional row indexing. 7) Optional tool buttons (<code>Copy</code>, <code>Export</code>). Designed for large datasets via streaming. Ensures accessibility via proper ARIA attributes. </td></tr><tr><td data-label="Component / Section"> <strong>Column & Row Handling</strong>         </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> Column widths are configurable. Left column can be styled separately via <code>.tv-col-left</code>. Row iteration ensures <code>&lt;td&gt;</code> and <code>&lt;th&gt;</code> are aligned. Numeric, percentage, and text columns are detected for proper HTML class application (<code>.tv-col-num</code>, <code>.tv-col-text</code>). Handles merged multi-line rows via coalescing helper <code>_coalesce_multiline_rows(df)</code>. Edge cases: single-column tables, empty rows, HTML inside cells.                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Component / Section"> <strong>Markdown & HTML Normalization</strong> </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> Within <code>render_table</code>: Markdown converted to HTML first. Then sanitization applied: bold, <code>&lt;strong&gt;</code> tags, unmatched markers escaped, brackets unescaped outside <code>&lt;code&gt;</code>. Lists detected using regex (<code>r&#x27;^\s*\d+\.&#x27;</code>) and converted to <code>&lt;ol&gt;&lt;li&gt;</code> structure. Ensures safe output for copy/export, preserves inline HTML where needed.                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Component / Section"> <strong>Streaming & Memory Efficiency</strong> </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> <code>_take_and_stream</code> used for initial row preview in debug. Large tables are processed row-by-row for HTML generation. Avoids holding entire table in memory unnecessarily. Enables faster rendering of massive tables (>10k rows) without memory spikes.                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Component / Section"> <strong>Sanitization & Safety</strong>         </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> Escapes HTML entities where appropriate. Preserves safe inline HTML like <code>&lt;strong&gt;</code>, <code>&lt;code&gt;</code>, <code>&lt;pre&gt;</code>, <code>&lt;ol&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code>. Unmatched Markdown markers escaped. Brackets inside text safely rendered unless inside <code>&lt;code&gt;</code>. Optional sanitization pipeline ensures HTML output cannot break rendering or introduce XSS vectors.                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Component / Section"> <strong>Fallback Mechanisms</strong>           </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> Module designed to operate with: <br>1) pandas installed → full DataFrame support, <br>2) pandas missing → <code>_SimpleDF</code> fallback. <br>Markdown rendering: <br>1) project renderer, <br>2) inline fallback. <br>CSV parsing: <br>1) <code>csv.Sniffer</code>, <br>2) heuristic delimiter counting. <br>Robust to missing dependencies, malformed input, mixed types, empty tables, or uneven rows.                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Component / Section"> <strong>HTML Table Features</strong>           </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> Supports optional <code>title</code> row. <code>&lt;thead&gt;</code> generated separately from <code>&lt;tbody&gt;</code>. CSS classes for styling: <code>.tv-table</code>, <code>.tv-col-left</code>, <code>.tv-col</code>. Row indices optionally shown. Optional interactive buttons for copy/export. Produces fully valid HTML5 tables suitable for web, email, or offline export.                                                                                                                                                                                                                                                                                                                                                                           </td></tr><tr><td data-label="Component / Section"> <strong>Edge Case Handling</strong>            </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> - Single-column tables gracefully handled.  <br> - Multi-line content in single cell coalesced. <br> - Uneven Markdown rows padded. <br> - Numeric, percentage, and text columns auto-classed. <br> - Inline code blocks preserved. <br> - Escaped Markdown characters respected. <br> - Fallback when pandas or project Markdown renderer missing. <br> - Safe handling of empty or missing cells. <br> - Robust to malformed CSV/Markdown combinations.                                                                                                                                                                                                                          </td></tr><tr><td data-label="Component / Section"> <strong>Public API & Exports</strong>          </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> Exposes: <code>parse_markdown_tables</code>, <code>parse_csv_tables</code>, <code>render_table</code>, <code>extract_tables_debug</code>, <code>_SimpleDF</code>, <code>_SimpleColumns</code>. All helpers prefixed <code>_</code> to indicate internal use. Ensures minimal surface API for integration while retaining testability and fallback.                                                                                                                                                                                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Component / Section"> <strong>Design Philosophy</strong>             </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> Modular separation: parsing, normalization, rendering, and sanitization. Explicit handling of edge cases. Robust fallback strategy ensures operational continuity without external dependencies. Prioritizes safe, consistent HTML output with minimal assumptions about input structure. Logging enables silent failure tracing.                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Component / Section"> <strong>Strengths</strong>                     </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> - Robust Markdown, CSV, and HTML table parsing. <br> - Fallback for pandas absence. <br> - Streaming for memory efficiency. <br> - Sanitization preserves safe HTML. <br> - Configurable left column width, optional tools. <br> - Handles multi-line rows, nested lists, inline code, and bold text. <br> - Predictable output for export and web integration.                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Component / Section"> <strong>Limitations / Considerations</strong>  </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> - Minimal inline Markdown renderer may miss complex nested formatting. <br> - CSV detection heuristic may misclassify unusual text. <br> - <code>_SimpleDF</code> limited compared to pandas. <br> - Row streaming debug preview limited to first 5 rows. <br> - Advanced Markdown features (nested tables, embedded HTML) partially supported.                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Component / Section"> <strong>Overall Assessment</strong>            </td><td data-label="Description, Behavior, Notes, Edge Cases, Design Decisions"> Production-ready module with strong resilience to malformed inputs, optional pandas integration, Markdown/CSV parsing, safe HTML output, streaming-friendly design, and comprehensive sanitization. Designed for backward compatibility and integration into table-heavy web applications or export pipelines. Balances robustness, performance, and maintainability.                                                                                                                                                                                                                                                                                                              </td></tr></tbody></table></div><div class="row-count">Rows: 22</div></div><div class="table-caption" id="Table8" data-table="Book_8043_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8 — core_assets.py</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Component / Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Component / Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Explanation / Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Explanation / Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Component / Section"> <strong>Module Purpose</strong> </td><td data-label="Explanation / Notes"> <code>core_assets.py</code> handles safe discovery, copying, embedding, and manifest management of assets. It prioritizes atomic operations, non-destructive behavior, optional fingerprinting, SRI calculation, and safe fallbacks. </td></tr><tr><td data-label="Component / Section"> <strong>Author / Checks</strong> </td><td data-label="Explanation / Notes"> Automated careful assistant. ~35 focused passes on logic paths, edge cases, and failure modes. Ensures robustness across missing directories, permission errors, atomic writes, and fallback behaviors. </td></tr><tr><td data-label="Component / Section"> <strong>Primary Goals</strong> </td><td data-label="Explanation / Notes"> 1. Safe atomic writes/copies (core_io preferred).<br>2. Non-destructive copying; skip non-empty unless forced.<br>3. Placeholders for missing files.<br>4. Optional manifest with SRI.<br>5. Optional fingerprinting.<br>6. Sensible copy policy (max size, whitelist/blacklist).<br>7. Fallback embedding of CSS/JS.<br>8. All advanced behaviors opt-in via cfg flags. </td></tr><tr><td data-label="Component / Section"> <strong>Public API</strong> </td><td data-label="Explanation / Notes"> - <code>prepare_assets(cfg: Optional[Any], out_dir: Path) -&gt; Tuple[Path, str, str, bool]</code><br>- <code>write_overrides_css(out_dir: Path, left_width: float, right_width: Optional[float])</code><br>- <code>compute_sri(path: Path, algo: str = &quot;sha384&quot;) -&gt; str</code><br>- <code>write_assets_manifest(...)</code><br>- <code>resolve_asset_name(logical_name: str, assets_dir: Path) -&gt; str | None</code> </td></tr><tr><td data-label="Component / Section"> <strong>Logger Initialization</strong> </td><td data-label="Explanation / Notes"> Uses module-level <code>logging.getLogger(&quot;render.core_assets&quot;)</code>. Adds <code>NullHandler</code> if no handlers exist. Default log level INFO; avoids double handlers. </td></tr><tr><td data-label="Component / Section"> <strong>Optional Project Helpers</strong> </td><td data-label="Explanation / Notes"> Tries to import <code>_copy_assets_impl</code>, <code>_write_overrides_impl</code>, <code>_EMBED_STYLE</code>, <code>_EMBED_SCRIPT</code> from <code>.assets</code>. Fallback to None/empty string if unavailable. </td></tr><tr><td data-label="Component / Section"> <strong>Core IO Integration</strong> </td><td data-label="Explanation / Notes"> Attempts import of <code>_atomic_write</code>, <code>_atomic_stream_write</code>, <code>_ensure_dir</code> from <code>.core_io</code>. Sets <code>_HAS_CORE_IO</code> flag. Graceful fallback if missing. </td></tr><tr><td data-label="Component / Section"> <strong>Fallback Atomic Write</strong> </td><td data-label="Explanation / Notes"> <code>_fallback_atomic_write</code> uses same-directory <code>NamedTemporaryFile</code> then <code>os.replace</code> for atomicity. Writer receives UTF-8 text file-like object. Handles directory creation robustly. </td></tr><tr><td data-label="Component / Section"> <strong>Fallback Atomic Copy</strong> </td><td data-label="Explanation / Notes"> <code>_fallback_atomic_copy</code> uses temporary file in target directory, copies binary content with <code>shutil.copyfileobj</code>, preserves permissions, <code>os.replace</code> for atomic swap. Returns boolean success. </td></tr><tr><td data-label="Component / Section"> <strong>Dispatcher Functions</strong> </td><td data-label="Explanation / Notes"> <code>_atomic_write_dispatch</code>, <code>_atomic_copy_dispatch</code>, <code>_ensure_dir_dispatch</code> prefer core_io if present, else fall back. Handles exceptions and logs debug info. </td></tr><tr><td data-label="Component / Section"> <strong>High-Level Safe Writes</strong> </td><td data-label="Explanation / Notes"> <code>_safe_write_text</code> writes text atomically and returns success boolean. <code>_ensure_non_empty_file</code> ensures file exists and has ≥10 bytes, writing fallback if missing or too small. </td></tr><tr><td data-label="Component / Section"> <strong>Hashing and SRI</strong> </td><td data-label="Explanation / Notes"> <code>_compute_hash_hex</code> returns hex digest; <code>compute_sri</code> returns base64-encoded SRI string. <code>_insert_hash_before_ext</code> inserts fingerprint before file extension. </td></tr><tr><td data-label="Component / Section"> <strong>Asset Discovery</strong> </td><td data-label="Explanation / Notes"> <code>_discover_candidate_asset_dirs</code> returns candidate directories in order: repo root, cwd/assets, package sibling, package assets. Resilient to missing directories. </td></tr><tr><td data-label="Component / Section"> <strong>Copy from Source Assets</strong> </td><td data-label="Explanation / Notes"> <code>_copy_from_source_assets</code> iterates candidate dirs:<br>- Enforces whitelist/blacklist, max_size.<br>- Optionally fingerprints.<br>- Uses atomic copy.<br>- Fills logical_map for fingerprinted names.<br>- Returns True if at least one file copied. </td></tr><tr><td data-label="Component / Section"> <strong>Manifest Generation</strong> </td><td data-label="Explanation / Notes"> <code>write_assets_manifest</code> writes JSON manifest with:<br>- generated timestamp<br>- files metadata (<code>size</code>, <code>mtime</code>, <code>sri</code>)<br>- optional logical->physical mapping<br>Uses <code>_safe_write_text</code>. </td></tr><tr><td data-label="Component / Section"> <strong>Assets Info</strong> </td><td data-label="Explanation / Notes"> <code>write_assets_info</code> writes lightweight JSON for diagnostics: files list, sizes, mtimes, assets_written flag. Non-blocking, logs debug on failure. </td></tr><tr><td data-label="Component / Section"> <strong>Resolve Asset Name</strong> </td><td data-label="Explanation / Notes"> <code>resolve_asset_name</code> maps logical name to actual physical filename using manifest mapping, fallback direct existence, or pattern match (<code>name.&lt;hash&gt;.ext</code>). Returns <code>None</code> if unresolved. </td></tr><tr><td data-label="Component / Section"> <strong>Overrides CSS Generation</strong> </td><td data-label="Explanation / Notes"> <code>write_overrides_css</code>:<br>- Prefers project <code>_write_overrides_impl</code> if present.<br>- Fallback generates responsive CSS with customizable left/right width, sticky headers, dark mode, collapse helper. </td></tr><tr><td data-label="Component / Section"> <strong>Prepare Assets Entrypoint</strong> </td><td data-label="Explanation / Notes"> <code>prepare_assets(cfg, out_dir)</code>:<br>1. Determine target assets_dir.<br>2. Collect embedded fallbacks.<br>3. Use project <code>_copy_assets_impl</code> or <code>_copy_from_source_assets</code>.<br>4. Ensure placeholders/non-empty files (<code>style.css</code>, <code>script.js</code>, <code>worker.js</code>, <code>overrides.css</code>).<br>5. Optional manifest generation.<br>6. Write assets-info.json.<br>Returns <code>(assets_dir, style_fallback, script_fallback, assets_written_flag)</code>. </td></tr><tr><td data-label="Component / Section"> <strong>Inlining Helpers</strong> </td><td data-label="Explanation / Notes"> <code>inline_style_fallback</code> wraps CSS in <code>&lt;style&gt;</code> tag.<br><code>inline_script_fallback</code> wraps JS in <code>&lt;script&gt;</code> tag.<br><code>make_link_tag_for_css</code> and <code>make_script_tag_for_js</code> produce HTML tags with optional SRI. </td></tr><tr><td data-label="Component / Section"> <strong>CLI / Demo Harness</strong> </td><td data-label="Explanation / Notes"> <code>_demo_run</code> creates temporary directory, runs <code>prepare_assets</code> with example cfg, prints summary and manifest. <code>__main__</code> entry ensures non-destructive demo. </td></tr><tr><td data-label="Component / Section"> <strong>Error Handling Philosophy</strong> </td><td data-label="Explanation / Notes"> Extensive try/except wrapping across all operations.<br>Non-fatal failures logged as debug.<br>All filesystem writes and copies atomic or safe. </td></tr><tr><td data-label="Component / Section"> <strong>Design Principles</strong> </td><td data-label="Explanation / Notes"> - Robust fallback to ensure assets present.<br>- Optional advanced features via cfg flags.<br>- Logging for debugging without breaking workflow.<br>- Minimal assumptions about project environment.<br>- Non-destructive, safe, idempotent operations.<br>- Resilient to missing files, directories, permissions, and partial asset availability. </td></tr><tr><td data-label="Component / Section"> <strong>Performance Considerations</strong> </td><td data-label="Explanation / Notes"> - Chunked reads for hashing/SRI.<br>- Skip copying large files unless whitelisted.<br>- Avoid overwriting existing non-empty files unless forced.<br>- Sorting of directories/files for deterministic manifests. </td></tr><tr><td data-label="Component / Section"> <strong>Security / Integrity</strong> </td><td data-label="Explanation / Notes"> - SRI calculation (<code>sha384</code> default) for included assets.<br>- Fingerprinting optional to prevent caching issues.<br>- No zero-byte placeholder files; avoids silent failures. </td></tr><tr><td data-label="Component / Section"> <strong>Observability</strong> </td><td data-label="Explanation / Notes"> - Logs at INFO/DEBUG.<br>- Manifest & info JSON provide reproducible metadata.<br>- Returns explicit flags for assets written. </td></tr><tr><td data-label="Component / Section"> <strong>Extensibility</strong> </td><td data-label="Explanation / Notes"> - Configurable via <code>cfg</code> object.<br>- Supports project overrides for copy/write CSS.<br>- Supports embedding of style/script fallbacks.<br>- Easily extended for new asset types or directories. </td></tr><tr><td data-label="Component / Section"> <strong>Summary</strong> </td><td data-label="Explanation / Notes"> <code>core_assets.py</code> is a robust, production-grade asset manager designed to ensure safe, consistent, and optionally fingerprinted/cached asset deployment with full diagnostics and fallback support. All functions are idempotent, atomic, and resilient to filesystem or environment anomalies. </td></tr></tbody></table></div><div class="row-count">Rows: 28</div></div><div class="table-caption" id="Table9" data-table="Book_8043_09" style="margin-top:2mm;margin-left:3mm;"><strong>Table 9 — core_fragments.py</strong></div>
<div class="table-wrapper" data-table-id="table-9"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Concept / Mechanism"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Concept / Mechanism</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Technical Notes &amp; Observations"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Technical Notes & Observations</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Concept / Mechanism"> <strong>Module Purpose</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>core_fragments.py</code> provides robust fragment rendering for tabular data from various sources (Markdown, HTML, CSV, TSV, DataFrame-like objects), supporting concurrency-safe atomic writes, optional external parsers, and asset detection. It abstracts the table extraction and rendering workflow with multiple fallback strategies. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Imports & Dependencies</strong> </td><td data-label="Technical Notes &amp; Observations"> Uses standard Python libraries (<code>os</code>, <code>re</code>, <code>csv</code>, <code>html</code>, <code>unicodedata</code>, <code>time</code>, <code>io</code>, <code>pickle</code>, <code>logging</code>, <code>pathlib</code>, <code>concurrent.futures</code>). Optional dependencies: <code>pandas</code> for DataFrame conversion, <code>BeautifulSoup</code> for HTML table extraction, and <code>io_utils._atomic_stream_write</code> for atomic file writing. Optional bridges to <code>convert</code> and <code>core_table</code>. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Logger Initialization</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>logger = logging.getLogger(&quot;render.core_fragments&quot;)</code> ensures consistent logging for all fragment operations. Exceptions within each function are captured and logged for debug purposes. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Atomic Write Helpers</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_atomic_write_text(path, text)</code>: Ensures atomic writes using a <code>.tmp</code> file then <code>os.replace</code>. Fallback for cases when <code>_atomic_stream_write</code> is unavailable. Guarantees concurrency-safe writes in multi-thread/process rendering. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Normalization of Table Text</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_normalize_table_text(s)</code>: Unicode normalization (<code>NFKC</code>), standardizes line endings, removes zero-width and BOM characters, replaces non-breaking spaces, converts hyphen variants to ASCII <code>-</code>, trims trailing spaces. Used before any table detection or parsing to reduce false negatives. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Markdown Row Splitting</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_split_row_keep_code(s)</code> parses Markdown table rows, preserving pipe characters inside backticks and escaped pipes (<code>\|</code>). Leading/trailing outer pipes are removed. <code>_split_pipe_cells(line)</code> wraps this with a naive fallback. This ensures correct handling of inline code. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Divider Detection</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_is_divider_line(s)</code> checks for Markdown pipe-table dividers (e.g., <code>| --- | :---: |</code>). Uses regex <code>^:?-{1,}\:?\s*$</code> for each column. Essential to identify header rows in Markdown tables. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Markdown Table Extraction</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_extract_pipe_tables_from_markdown(md_text)</code> iterates lines, detects header dividers, builds row arrays <code>(rows, header_flag)</code>. Handles multiple tables per Markdown input. Fallback and exception-safe. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>HTML Table Parsing (Regex)</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_parse_table_html_regex(table_html)</code> provides lightweight table extraction when <code>BeautifulSoup</code> is unavailable. Detects <code>&lt;th&gt;</code> and <code>&lt;thead&gt;</code>, extracts <code>&lt;tr&gt;</code> and <code>&lt;td&gt;/&lt;th&gt;</code> content, converts <code>&lt;br&gt;</code> to <code>\n</code>, strips other tags, unescapes HTML. Returns <code>(rows, header_flag)</code>. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>HTML Table Extraction (BS4 or Regex)</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_extract_table_blocks_from_html(html_text)</code> prioritizes <code>BeautifulSoup</code> for robust parsing, falls back to regex if BS4 not installed or fails. Detects multiple tables, identifies headers, collects row text, ensures each table returns <code>(rows, header_flag)</code>. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Conversion to DataFrame-like Objects</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_convert_rows_to_df_like(rows, header)</code>: Converts row lists to <code>pandas.DataFrame</code> if available; otherwise, returns list-of-dicts (header=True) or list-of-lists (header=False). Handles mismatched row lengths and provides fallback. Ensures downstream renderers get uniform data structures. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Simple HTML Table Renderer</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_simple_render_table(df, idx, markdown_to_html, left_width, right_width)</code>: Fallback renderer when <code>core_table.render_table</code> unavailable. Supports <code>DataFrame</code>, list-of-dicts, list-of-lists, or single objects. Generates <code>&lt;table&gt;</code> with <code>&lt;tr&gt;</code> and <code>&lt;td&gt;</code>. Returns <code>&lt;h3&gt;</code> header with table ID. Handles exceptions gracefully. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Process Worker Function</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_process_simple_render_job(args)</code> is picklable for <code>ProcessPoolExecutor</code>. Executes <code>_simple_render_table</code> in isolation. Returns <code>(idx, html_str, render_time_ms)</code>. Ensures safe multi-process execution even with unpicklable main objects. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>CSV/TSV Detection</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_is_probable_csv(text)</code>: Heuristic detection by line delimiter counts. Considers <code>,</code>, <code>\t</code>, <code>;</code> as candidates. Checks line consistency and minimum rows. Returns <code>(is_csv, suggested_delimiter)</code>. Prevents false positives from HTML or Markdown. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>CSV Parsing</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_parse_csv_text_to_rows(text, delimiter)</code>: Parses CSV-like text into rows. Uses <code>csv.Sniffer</code> for delimiter autodetect and header inference. Fallback logic for numeric/non-numeric heuristic if Sniffer fails. Returns <code>(rows, has_header)</code>. Handles malformed CSVs gracefully. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Concurrent Fragment Renderer</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>render_fragments_concurrently(...)</code> orchestrates multi-thread or process rendering of arbitrary tables. Converts all inputs to normalized <code>DataFrame</code>-like objects, detects types (Markdown, CSV, HTML, DataFrame, dict), and stores metadata. Supports <code>max_workers</code>, <code>tmp_frag_dir</code>, optional <code>use_process</code>. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Input Normalization</strong> </td><td data-label="Technical Notes &amp; Observations"> Converts raw inputs (bytes, file paths, DataFrames, lists, dicts, strings) into unified internal representation. Detects type via heuristics, keeps preview, source, detected type. Decodes bytes (<code>utf-8</code>/<code>latin-1</code>) and reads files with encoding fallback. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Markdown/CSV/HTML Parsing Pipeline</strong> </td><td data-label="Technical Notes &amp; Observations"> 1) External <code>convert</code> parser for Markdown tables.<br>2) Local <code>_extract_pipe_tables_from_markdown</code>.<br>3) Fenced CSV detection using regex.<br>4) Raw CSV/TSV detection and parse.<br>5) Render to HTML and extract tables from <code>&lt;table&gt;</code> blocks.<br>Each step ensures fallback, metadata enrichment, and failure isolation. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Table Fragment Metadata</strong> </td><td data-label="Technical Notes &amp; Observations"> Each fragment stores: <code>path</code>, <code>content</code>, <code>title_id</code>, <code>title_text</code>, <code>sections</code>, <code>assets_required</code>, <code>render_time_ms</code>, <code>write_time_ms</code>, <code>detected_type</code>, <code>source</code>, <code>original_preview</code>. Enables tracking and downstream processing. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>HTML Asset Detection</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_detect_assets_from_html(html_text)</code>: Detects <code>xlsx</code>, <code>PrismJS</code>, <code>virtualize</code>, and <code>data-requires-*</code>. Returns sorted unique list. Supports dynamic script inclusion in rendering pipelines. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Title & Section Extraction</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_ensure_unique_title_id(proposed)</code>: Generates unique table IDs. Regex searches extract <code>&lt;h3 id=...&gt;</code> for titles and <code>&lt;div class=&quot;section-heading&quot;&gt;</code> for sections. Sanitizes HTML to plain text for downstream usage. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Thread-Based Render Execution</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_render_job(idx, df, meta)</code> executes rendering in threads. Measures render and write times, collects assets, handles exceptions, writes fragments atomically. Returns tuple of metadata. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Process-Based Render Execution</strong> </td><td data-label="Technical Notes &amp; Observations"> Uses <code>_process_simple_render_job</code> with <code>ProcessPoolExecutor</code> for picklable objects. Ensures multi-process isolation. Writes fragments atomically post-process. Fallbacks to threads if pickling fails. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Concurrency Safety</strong> </td><td data-label="Technical Notes &amp; Observations"> Atomic writes (<code>_atomic_write_text</code>), <code>ThreadPoolExecutor</code>, <code>ProcessPoolExecutor</code>, picklable job design, and isolated try/except blocks prevent partial or corrupt output. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fragment Row Counting</strong> </td><td data-label="Technical Notes &amp; Observations"> Extracts <code>&lt;tr&gt;</code> counts from <code>&lt;tbody&gt;</code> if present, otherwise from full table HTML. Stores <code>frag_row_counts[idx]</code> for each fragment. Ensures accurate statistics on table size. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Warnings & Logging</strong> </td><td data-label="Technical Notes &amp; Observations"> Warnings collected in <code>warnings</code> list with <code>level</code> and <code>msg</code>. Per-fragment errors include <code>table</code> index. All exceptions logged via <code>logger.exception</code> with traceback for debugging. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Renderer Fallbacks</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_call_render_table(df, idx)</code> attempts:<br>1) <code>core_table.render_table</code> if available.<br>2) Renderer object with <code>.render()</code>.<br>3) <code>_simple_render_table</code> as ultimate fallback. Ensures no table fails silently. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Public API Functions</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>normalize_table_text</code>, <code>extract_pipe_tables_from_markdown</code>, <code>extract_table_blocks_from_html</code>, <code>convert_rows_to_df_like</code>, <code>simple_render_table</code>, <code>render_fragments_concurrently</code>. Encapsulate core helpers and pipelines while keeping internal functions private. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Error Resilience</strong> </td><td data-label="Technical Notes &amp; Observations"> Almost every parsing or rendering step is wrapped in try/except. Ensures single malformed input does not break the entire rendering process. Logs errors and returns fallback content where needed. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Performance Considerations</strong> </td><td data-label="Technical Notes &amp; Observations"> Uses <code>ThreadPoolExecutor</code> by default, <code>ProcessPoolExecutor</code> optional for picklable renderers. Limits <code>max_workers</code> to input size or user-specified cap. Measures render/write time per fragment. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Unicode & HTML Safety</strong> </td><td data-label="Technical Notes &amp; Observations"> All content normalized via <code>_normalize_table_text</code>, HTML escaped when generating fallback tables. Preserves inline code, special characters, and line breaks. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fallback Table Rendering Flow</strong> </td><td data-label="Technical Notes &amp; Observations"> 1) Detect type (DataFrame, list-of-dicts, CSV, Markdown, HTML).<br>2) Convert to DataFrame-like object.<br>3) Call <code>_call_render_table</code>.<br>4) <code>_simple_render_table</code> fallback ensures HTML output.<br>5) Write atomically. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Atomic Write Strategies</strong> </td><td data-label="Technical Notes &amp; Observations"> Primary: <code>_atomic_stream_write</code> if available.<br>Secondary: <code>_atomic_write_text</code> using <code>.tmp</code> file.<br>Guarantees fragment persistence even if thread/process crashes. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Preview and Metadata Tracking</strong> </td><td data-label="Technical Notes &amp; Observations"> Keeps <code>raw_preview</code> for inputs, truncated to 200 chars. Metadata aids debugging, analytics, and potential error reporting. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Dynamic Asset Inclusion</strong> </td><td data-label="Technical Notes &amp; Observations"> Auto-detects dependencies (JS, Prism, virtualize) per fragment. Enables front-end scripts to include only required assets, optimizing page load. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fallback CSV Header Detection</strong> </td><td data-label="Technical Notes &amp; Observations"> Uses numeric/non-numeric heuristic if <code>csv.Sniffer.has_header</code> fails. Ensures proper header recognition in malformed or inconsistent CSVs. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fallback for Markdown Fenced CSVs</strong> </td><td data-label="Technical Notes &amp; Observations"> Regex detection for ``<code>csv, </code>``tsv blocks with optional external parser. Ensures CSV extraction even if table lacks explicit Markdown formatting. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Renderer Agnostic Design</strong> </td><td data-label="Technical Notes &amp; Observations"> Supports external renderer objects (<code>renderer.render</code>) or callable passed to <code>_call_render_table</code>. Maintains flexibility for integration with custom Markdown engines. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fragment Identification</strong> </td><td data-label="Technical Notes &amp; Observations"> Each fragment assigned unique <code>title_id</code>. Ensures no duplicate IDs for HTML anchors, supports multiple tables with same name. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Thread Safety</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>used_title_ids</code> dictionary updated in thread-safe way because it only increments counts per base ID; minimal contention due to GIL. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Pickle Safety</strong> </td><td data-label="Technical Notes &amp; Observations"> Before using processes, <code>pickle.dumps(renderer)</code> tests picklability. Non-picklable renderers fall back to threads. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fallback Table Parsing Priority</strong> </td><td data-label="Technical Notes &amp; Observations"> Markdown > Pipe tables > Fenced CSV > Raw CSV/TSV > HTML table > Raw object. Ensures most structured formats are preferred. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Input Iterability Safety</strong> </td><td data-label="Technical Notes &amp; Observations"> Converts <code>all_tables</code> to iterator with fallback to empty list to prevent runtime exceptions. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Row Count Extraction Robustness</strong> </td><td data-label="Technical Notes &amp; Observations"> Regex search for <code>&lt;tbody&gt;</code> ensures accurate row counts even for incomplete HTML. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fragment Warnings Granularity</strong> </td><td data-label="Technical Notes &amp; Observations"> Stores per-fragment warnings (<code>level</code>, <code>msg</code>, <code>table</code>) to isolate errors. Supports multi-fragment debugging. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fragment Asset Deduplication</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_detect_assets_from_html</code> returns sorted <code>set</code> to avoid duplicates. Merges with explicit assets returned by renderers. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fallback String Rendering</strong> </td><td data-label="Technical Notes &amp; Observations"> Any unknown object type passed as string to <code>_simple_render_table</code>. Prevents failure for arbitrary non-table objects. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Concurrency Metrics</strong> </td><td data-label="Technical Notes &amp; Observations"> Records <code>render_time_ms</code> and <code>write_time_ms</code> for performance profiling. Can be used for identifying bottlenecks. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Extensibility</strong> </td><td data-label="Technical Notes &amp; Observations"> Optional integration with external <code>convert</code> parsers allows future extensions (rich Markdown, advanced CSV). </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Code Modularity</strong> </td><td data-label="Technical Notes &amp; Observations"> Internal functions prefixed <code>_</code> to indicate private API. Public wrappers (<code>__all__</code>) provide clean, minimal API surface. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Atomicity in Multi-Fragment Context</strong> </td><td data-label="Technical Notes &amp; Observations"> Each fragment written independently, reducing risk of partial failure affecting other fragments. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Logging Levels & Debugging</strong> </td><td data-label="Technical Notes &amp; Observations"> Uses <code>logger.debug</code> for recoverable issues, <code>logger.exception</code> for unhandled exceptions. Supports verbose diagnostics. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Multi-format Fallback Priority</strong> </td><td data-label="Technical Notes &amp; Observations"> Pipeline ensures that HTML > Markdown > CSV > DataFrame-like > Raw object for consistency. Prevents table loss. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Unicode Line Breaks & Escapes</strong> </td><td data-label="Technical Notes &amp; Observations"> All line breaks normalized to <code>\n</code>. Escaped pipe symbols (<code>\|</code>) preserved. Special whitespace removed. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fragment Row Preview</strong> </td><td data-label="Technical Notes &amp; Observations"> Captures first N rows for preview without exposing entire content. Supports UI and logging. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Cross-Platform File Paths</strong> </td><td data-label="Technical Notes &amp; Observations"> Uses <code>pathlib.Path</code> for consistent path handling across Windows, Linux, macOS. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fallback Render HTML Sanitization</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_simple_render_table</code> escapes <code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code>, and quotes to prevent accidental HTML injection. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Concurrent Writes Safety</strong> </td><td data-label="Technical Notes &amp; Observations"> Atomic writes and per-fragment handling ensure no race conditions during multi-threaded execution. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>External Renderer Integration</strong> </td><td data-label="Technical Notes &amp; Observations"> Renderer object passed as argument must support <code>render(df, **kwargs)</code> for custom table processing. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>High-Level Render Flow Summary</strong> </td><td data-label="Technical Notes &amp; Observations"> 1) Normalize all inputs<br>2) Detect type and parse<br>3) Convert to DataFrame-like<br>4) Assign title ID<br>5) Render with concurrency<br>6) Detect assets<br>7) Write atomically<br>8) Collect metadata, row counts, warnings </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Failure Isolation Strategy</strong> </td><td data-label="Technical Notes &amp; Observations"> Each parsing/rendering step uses try/except. Failures logged, fallbacks executed, pipeline continues for other fragments. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>HTML & Markdown Consistency</strong> </td><td data-label="Technical Notes &amp; Observations"> Ensures <code>&lt;td&gt;</code> content aligns with Markdown columns. Handles inline code, <code>&lt;br&gt;</code>, escapes. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Metadata Completeness</strong> </td><td data-label="Technical Notes &amp; Observations"> All fragment metadata includes <code>source_type</code>, <code>input_preview</code>, <code>render_time_ms</code>, <code>write_time_ms</code>, <code>row_count</code>, <code>assets_required</code>, <code>title_id</code>, <code>sections</code>. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Pipeline Resilience</strong> </td><td data-label="Technical Notes &amp; Observations"> Even if a single fragment fails due to bad CSV or malformed HTML, the rest continue rendering. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Thread vs Process Decision Logic</strong> </td><td data-label="Technical Notes &amp; Observations"> Checks picklability of renderer. If unpicklable, uses threads. Otherwise, can use <code>ProcessPoolExecutor</code> for CPU-bound tasks. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Safe String Coercion</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>_simple_render_table</code> and CSV/Markdown parsers coerce all non-str cell values to strings safely, preserving numeric, date, or None values as displayable text. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Fallback for Empty Tables</strong> </td><td data-label="Technical Notes &amp; Observations"> If no rows detected, returns <code>&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Empty&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</code> to prevent pipeline errors. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Documentation Coverage</strong> </td><td data-label="Technical Notes &amp; Observations"> Docstrings for main functions explain parameters, return types, and fallback behavior. Internal functions rely on naming conventions for clarity. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Preview Sanitization</strong> </td><td data-label="Technical Notes &amp; Observations"> Truncated <code>raw_preview</code> removes newlines for log display but keeps meaningful content. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Comprehensive Metadata Return</strong> </td><td data-label="Technical Notes &amp; Observations"> <code>render_fragments_concurrently</code> returns <code>(fragments_map, frag_row_counts, total_rows, warnings)</code>, enabling downstream pipelines to access every fragment’s metadata, row counts, and any issues. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Edge Case Handling</strong> </td><td data-label="Technical Notes &amp; Observations"> Covers empty strings, <code>None</code> inputs, malformed HTML, invalid CSVs, inconsistent Markdown rows, duplicate IDs, missing headers, missing <code>BeautifulSoup</code>, and unpicklable renderers. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>High-Performance Design</strong> </td><td data-label="Technical Notes &amp; Observations"> Concurrent execution, atomic writes, selective asset detection, and fallback pipelines minimize blocking and ensure large batch rendering is performant. </td></tr><tr><td data-label="Concept / Mechanism"> <strong>Final Notes</strong> </td><td data-label="Technical Notes &amp; Observations"> The module prioritizes resilience, concurrency safety, robust detection, multi-format parsing, fallback rendering, metadata tracking, asset inclusion, and atomic persistence. Designed for integration with larger table rendering frameworks while maintaining isolation for each fragment. </td></tr></tbody></table></div><div class="row-count">Rows: 73</div></div><div class="table-caption" id="Table10" data-table="Book_8043_10" style="margin-top:2mm;margin-left:3mm;"><strong>Table 10 — core_io.py</strong></div>
<div class="table-wrapper" data-table-id="table-10"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Summary / Purpose</strong>                                                                                           </td><td data-label="Technical Breakdown"> Provides atomic write utilities, safer directory creation, and CSV/table extraction helpers. Supports integration with project-provided <code>io_utils</code> if available. Ensures atomicity, reproducible temp dirs, safe CSV preview, and optional hashing for verification.                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>High-level guarantees</strong>                                                                                       </td><td data-label="Technical Breakdown"> • Atomic writes via same-directory temp + <code>os.replace</code>.<br>• Race-condition resistant directory creation.<br>• CSV extraction with encoding/dialect detection.<br>• Optional SHA-256 hashing.<br>• Falls back safely if project-provided implementations unavailable.                                                                                                                                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Project integration detection</strong>                                                                               </td><td data-label="Technical Breakdown"> Tries to import <code>_atomic_write</code>, <code>_atomic_stream_write</code>, <code>_ensure_dir</code> from <code>render.io_utils</code>. If import fails, uses default internal implementations.                                                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Section"> <strong>Directory creation helper: <code>_ensure_dir_path(p: Path)</code></strong>                                                      </td><td data-label="Technical Breakdown"> Ensures directory <code>p</code> exists.<br>Tries <code>p.mkdir(parents=True, exist_ok=True)</code>.<br>If fails, attempts <code>os.makedirs(str(p), exist_ok=True)</code>.<br>Logs failures at debug level; non-fatal.                                                                                                                                                                                                                                                                                                 </td></tr><tr><td data-label="Section"> <strong>Default atomic write: <code>_default_write_atomic(path, writer)</code></strong>                                                 </td><td data-label="Technical Breakdown"> Writes atomically using temp file in same directory.<br>Steps:<br>1. Ensure parent directory exists.<br>2. Create <code>tempfile.NamedTemporaryFile</code> with <code>.tmp_write_</code> prefix and <code>.tmp</code> suffix.<br>3. Call <code>writer(tf)</code> callback.<br>4. Flush and attempt <code>os.fsync</code>.<br>5. Use <code>os.replace(tmp, path)</code> for atomic commit.<br>6. Cleanup temp on failure, raise exception.                                                                                                                </td></tr><tr><td data-label="Section"> <strong>Streaming atomic write: <code>_default_stream_write(path, stream_writer)</code></strong>                                        </td><td data-label="Technical Breakdown"> Identical wrapper to <code>_default_write_atomic</code>; provides semantic clarity for stream-based writes.                                                                                                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>File validation: <code>_is_valid_file(p: Path)</code></strong>                                                                  </td><td data-label="Technical Breakdown"> Returns True if path exists, is a file, and size > 0. Exception-safe; returns False on error.                                                                                                                                                                                                                                                                                                                                                                                          </td></tr><tr><td data-label="Section"> <strong>Temporary fragment directories: <code>tmp_frag_dir_for(out_dir)</code></strong>                                                 </td><td data-label="Technical Breakdown"> Creates <code>.frags_&lt;timestamp_ms&gt;_&lt;pid&gt;_&lt;uuid4&gt;</code> inside <code>out_dir</code>.<br>Steps:<br>1. Generate timestamp (ms), process id, short UUID suffix.<br>2. Combine into directory name.<br>3. Ensure directory exists via <code>_ensure_dir_path</code>.<br>4. Fallback to <code>out_dir</code> on failure; logs debug.                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Re-export atomic/directory functions</strong>                                                                        </td><td data-label="Technical Breakdown"> <code>_atomic_write = _atomic_write_impl or _default_write_atomic</code><br><code>_atomic_stream_write = _atomic_stream_write_impl or _default_stream_write</code><br><code>_ensure_dir = _ensure_dir_impl or _ensure_dir_path</code><br>Centralizes usage of project-provided or fallback implementations.                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Encoding detection: <code>_detect_encoding_from_bytes(sample: bytes)</code></strong>                                            </td><td data-label="Technical Breakdown"> Detects text encoding from a byte sample.<br>Logic:<br>• BOM <code>\xef\xbb\xbf</code> → "utf-8-sig".<br>• Try <code>&quot;utf-8&quot;</code>, <code>&quot;utf-8-sig&quot;</code>, <code>&quot;latin-1&quot;</code> sequentially.<br>• Fallback → <code>&quot;latin-1&quot;</code>.                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>CSV dialect detection: <code>_detect_csv_dialect(sample_text: str)</code></strong>                                              </td><td data-label="Technical Breakdown"> Uses <code>csv.Sniffer().sniff</code> with delimiters <code>[&quot;,&quot;,&quot;\t&quot;,&quot;;&quot;, &quot;                                                                                                                                                                                                                                                                                                                                                                                                                           | &quot;, &quot;:&quot;]</code>.<br>Retries with decreasing lengths (full, 16k, 1k, 256).<br>Fallback to conservative <code>_Fallback</code> dialect: comma delimiter, doublequote, minimal quoting, skip initial space. </td></tr><tr><td data-label="Section"> <strong>Table extraction: <code>extract_table_source(source, sample_size=32768, max_sample_rows=10, compute_hash=False)</code></strong> </td><td data-label="Technical Breakdown"> Extracts CSV metadata and sample rows.<br>Supports source types: <code>str</code>, <code>Path</code>, <code>bytes</code>, <code>io.IOBase</code>.<br>Returns dict:<br>• source_path, exists, size<br>• encoding, delimiter, quotechar<br>• headers, sample_rows<br>• sha256 hash (optional)<br>Steps:<br>1. Read sample bytes (size <code>sample_size</code>).<br>2. Detect encoding.<br>3. Decode sample text.<br>4. Detect dialect.<br>5. Sniffer header detection.<br>6. Read up to <code>max_sample_rows</code>.<br>7. Optional SHA-256 computation. </td></tr><tr><td data-label="Section"> <strong>CSV row reading: <code>read_csv_rows(path, encoding=None, delimiter=None, max_rows=None)</code></strong>                        </td><td data-label="Technical Breakdown"> Memory-safe read of CSV up to <code>max_rows</code>.<br>Steps:<br>1. Detect encoding if None.<br>2. Detect dialect if delimiter not provided; fallback to <code>&quot;excel&quot;</code>.<br>3. Open file with newline="", decode errors="replace".<br>4. Append rows to list up to <code>max_rows</code>.                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>Error handling & logging</strong>                                                                                    </td><td data-label="Technical Breakdown"> • Directory or write failures logged at debug/exception level.<br>• Atomic write failure cleans up temp files.<br>• CSV sniff failures fall back silently.<br>• Non-fatal unless source missing completely.                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Security & integrity notes</strong>                                                                                  </td><td data-label="Technical Breakdown"> • SHA-256 optional hash allows integrity checks.<br>• Atomic write prevents partial writes.<br>• Temporary fragment directories avoid collisions via timestamp+pid+UUID.                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>Performance considerations</strong>                                                                                  </td><td data-label="Technical Breakdown"> • Streaming writes avoid large memory copies.<br>• CSV extraction reads only sample bytes (<code>sample_size</code>), limiting memory overhead.<br>• Max sample rows ensures fast previews.                                                                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Operational recommendations</strong>                                                                                 </td><td data-label="Technical Breakdown"> • Prefer project-provided <code>_atomic_write</code> or <code>_ensure_dir</code> for centralized policy.<br>• Use <code>tmp_frag_dir_for</code> for temporary storage in table processing pipelines.<br>• Enable <code>compute_hash</code> when verifying CSV sources.                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Fallback matrix</strong>                                                                                             </td><td data-label="Technical Breakdown"> • Missing project implementations → defaults used.<br>• Atomic write failure → cleanup + raise.<br>• CSV sniff failure → fallback dialect.<br>• Encoding detection fails → defaults to <code>&quot;latin-1&quot;</code>.                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Reviewer checklist</strong>                                                                                          </td><td data-label="Technical Breakdown"> 1. Validate <code>_atomic_write</code>, <code>_atomic_stream_write</code>, <code>_ensure_dir</code> correctly resolve project overrides.<br>2. Confirm temp file atomicity across OSes.<br>3. Verify <code>_detect_encoding_from_bytes</code> and <code>_detect_csv_dialect</code> handle edge cases.<br>4. Test <code>extract_table_source</code> with small/large files, with/without headers.<br>5. Confirm fragment dirs naming is unique and safe.                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Minimal unit tests</strong>                                                                                          </td><td data-label="Technical Breakdown"> • <code>_default_write_atomic</code> writes non-zero file atomically.<br>• <code>_is_valid_file</code> correctly validates files.<br>• <code>tmp_frag_dir_for</code> produces valid, unique directories.<br>• <code>_detect_encoding_from_bytes</code> handles BOM, UTF-8, Latin-1.<br>• <code>_detect_csv_dialect</code> returns usable dialect.<br>• <code>extract_table_source</code> reads sample rows correctly.<br>• <code>read_csv_rows</code> obeys <code>max_rows</code>.                                                                                             </td></tr><tr><td data-label="Section"> <strong>Short summary / decision points</strong>                                                                             </td><td data-label="Technical Breakdown"> Module provides safe atomic file writes, directory creation with race-condition handling, CSV sampling, encoding/dialect detection, and optional hashing. Prefers project helpers when available, falls back internally otherwise. Designed for robustness, predictable temp paths, and safe integration into table processing workflows.                                                                                                                                              </td></tr></tbody></table></div><div class="row-count">Rows: 21</div></div><div class="table-caption" id="Table11" data-table="Book_8043_11" style="margin-top:2mm;margin-left:3mm;"><strong>Table 11 — core_utils.py</strong></div>
<div class="table-wrapper" data-table-id="table-11"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Module Purpose</strong>                                                        </td><td data-label="Technical Breakdown"> <code>render/core_utils.py</code> provides low-level utility functions for sanitization, HTML safety, fragment analysis, streaming iterables, and Subresource Integrity (SRI) handling. Designed as a defensive, production-safe foundation for higher-level renderers without external dependencies beyond Python stdlib.                                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Logging</strong>                                                               </td><td data-label="Technical Breakdown"> Uses a dedicated logger <code>render.core_utils</code> for all internal debug events. Errors in utility functions do not raise exceptions but are logged for diagnostics.                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Section"> <strong>ID Sanitization: <code>_sanitize_id(x, idx=None)</code></strong>                          </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Produce HTML-safe <code>id</code> attributes. <br><strong>Steps:</strong> 1. Convert input to string; fallback <code>&quot;&quot;</code> if None. 2. Replace all non-alphanumeric, underscore, dash characters with <code>-</code>. 3. Collapse consecutive <code>-</code> into single <code>-</code>. 4. Trim leading/trailing <code>-</code>. 5. Fallback to <code>id-{idx}</code> if empty. <br><strong>Robustness:</strong> Catches exceptions; logs debug; guarantees non-empty string. <br><strong>Return:</strong> string safe for HTML <code>id</code>.                                                                          </td></tr><tr><td data-label="Section"> <strong>Output Path Sanitization: <code>_sanitize_output_path(x)</code></strong>                  </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Ensure output path is stringifiable. <br><strong>Behavior:</strong> Convert any object to string. <br><strong>Fallback:</strong> <code>&quot;output.html&quot;</code> if conversion fails. <br><strong>Logging:</strong> Captures conversion errors.                                                                                                                                                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>HTML Whitelist Pass-through: <code>_sanitize_html_whitelist(s)</code></strong>            </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Minimal HTML sanitization placeholder. <br><strong>Behavior:</strong> Converts input to string, empty string if None. <br><strong>Integration:</strong> Real sanitization is expected in <code>sanitize.py</code>. <br><strong>Logging:</strong> Captures exceptions. <br><strong>Use Case:</strong> Lightweight passthrough for fragments known safe.                                                                                                                                                                                                         </td></tr><tr><td data-label="Section"> <strong>Subresource Integrity Attribute: <code>_sri_attr(url, cdn_integrity=None)</code></strong> </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Return HTML <code>integrity</code> and <code>crossorigin</code> attributes for CDN URLs. <br><strong>Behavior:</strong> Lookup URL in optional mapping; if found, produce: <code>&lt;attr&gt; integrity=&quot;{hash}&quot; crossorigin=&quot;anonymous&quot;</code>. <br><strong>Fallback:</strong> Empty string if no mapping or error. <br><strong>Logging:</strong> Debug any exceptions. <br><strong>Use:</strong> Embed SRI in <code>&lt;script&gt;</code> or <code>&lt;link&gt;</code> safely.                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Fragment Row Detection: <code>_frag_contains_rows(content)</code></strong>                </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Determine if HTML fragment contains <code>&lt;tbody&gt;&lt;tr&gt;</code> elements. <br><strong>Behavior:</strong> Regex search for <code>&lt;tbody&gt;\s*&lt;tr</code> ignoring case. <br><strong>Fallback:</strong> Returns <code>False</code> if content missing or regex fails. <br><strong>Logging:</strong> Captures exceptions during search. <br><strong>Use Case:</strong> Detect fragments that represent full table rows for downstream processing.                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Iterable Chunking: <code>_take_and_stream(rows_iterable, n)</code></strong>               </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Safely take first <code>n</code> elements from an iterable, return <code>(list, remainder_iterable)</code>. <br><strong>Steps:</strong> 1. Convert input to iterator. 2. Take up to <code>n</code> elements into buffer. 3. Return buffer and iterator for remainder. <br><strong>Defensive Handling:</strong> If iterable broken, converts to list as fallback; logs any exceptions. <br><strong>Edge Cases:</strong> Handles <code>n&lt;=0</code>, empty iterable, or non-iterable input. <br><strong>Return:</strong> <code>(list_of_first_n, remaining_iterable)</code> suitable for streaming pipelines. </td></tr><tr><td data-label="Section"> <strong>Defensive Programming Pattern</strong>                                         </td><td data-label="Technical Breakdown"> All utility functions use try/except around main logic. Ensures: <br>• No exceptions propagate to caller. <br>• Fallback default values returned. <br>• All failures logged at debug level. <br>• Guarantees predictable, safe outputs for rendering pipelines.                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Regex Usage</strong>                                                           </td><td data-label="Technical Breakdown"> Central in <code>_sanitize_id</code> and <code>_frag_contains_rows</code>. <br>• <code>_sanitize_id</code> uses <code>[^a-zA-Z0-9\-_]+</code> to replace illegal characters. <br>• <code>_frag_contains_rows</code> uses <code>&lt;tbody&gt;\s*&lt;tr</code> to detect table rows. <br><strong>Notes:</strong> Regex compiled at call-time; exceptions logged defensively.                                                                                                                                                                                                                           </td></tr><tr><td data-label="Section"> <strong>Type Hints & Generics</strong>                                                 </td><td data-label="Technical Breakdown"> Function signatures include <code>Optional[str]</code>, <code>Any</code>, <code>Iterable[Any]</code>, <code>List[Any]</code>, <code>Tuple[...]</code> for clarity. <br><strong>Benefit:</strong> Static type checking support; improves IDE inspection and integration safety.                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>HTML/JS Integration Considerations</strong>                                    </td><td data-label="Technical Breakdown"> <code>_sanitize_id</code> and <code>_sri_attr</code> are essential for embedding safe HTML IDs and SRI attributes. Ensures downstream renderers can insert elements safely without collision or security issues.                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Error Logging Strategy</strong>                                                </td><td data-label="Technical Breakdown"> Debug-level logging for all caught exceptions. <br>• No function raises. <br>• Each error context clearly identified in log message. <br>• Helps trace edge-case failures during large HTML render pipelines.                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Section"> <strong>Fallback Philosophy</strong>                                                   </td><td data-label="Technical Breakdown"> Each function defines a clear fallback: <br>• <code>_sanitize_id</code> → <code>id-{idx}</code> <br>• <code>_sanitize_output_path</code> → <code>&quot;output.html&quot;</code> <br>• <code>_sanitize_html_whitelist</code> → <code>&quot;&quot;</code> <br>• <code>_sri_attr</code> → <code>&quot;&quot;</code> <br>• <code>_frag_contains_rows</code> → <code>False</code> <br>• <code>_take_and_stream</code> → <code>([], iter([]))</code> <br><strong>Rationale:</strong> Prevents pipeline crashes from malformed inputs or missing data.                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Use Case Summary</strong>                                                      </td><td data-label="Technical Breakdown"> Core utilities support rendering systems: <br>• Sanitized HTML IDs for table elements. <br>• Safe file output paths. <br>• Safe minimal HTML fragments. <br>• Subresource Integrity embedding. <br>• Table fragment row detection. <br>• Chunked streaming for large row iterables. <br><strong>Design Goal:</strong> Minimal dependencies, predictable outputs, fully defensive, production-ready foundation.                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Performance Considerations</strong>                                            </td><td data-label="Technical Breakdown"> Functions are lightweight: <br>• Regex applied on small strings. <br>• Iterators buffered only up to <code>n</code> elements. <br>• No heavy computation or disk I/O. <br><strong>Effect:</strong> Can be used in real-time table render pipelines without noticeable latency.                                                                                                                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Integration Guidance</strong>                                                  </td><td data-label="Technical Breakdown"> Designed for internal use by renderers: <br>• <code>_sanitize_id</code> ensures DOM-safe IDs. <br>• <code>_sri_attr</code> used in <code>make_script_tag_for_js</code> or <code>make_link_tag_for_css</code>. <br>• <code>_take_and_stream</code> supports paginated or lazy table rendering. <br>• <code>_frag_contains_rows</code> allows conditional rendering logic based on fragment content.                                                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Unit Testing Notes</strong>                                                    </td><td data-label="Technical Breakdown"> Minimal yet critical tests: <br>• <code>_sanitize_id</code> replaces illegal characters, collapses dashes, handles None input. <br>• <code>_sanitize_output_path</code> returns string for arbitrary inputs. <br>• <code>_frag_contains_rows</code> correctly detects <code>&lt;tbody&gt;&lt;tr&gt;</code> and empty content. <br>• <code>_take_and_stream</code> returns correct first <code>n</code> elements and remainder iterable; handles broken iterables gracefully. <br><strong>Objective:</strong> Ensure safe and predictable outputs in all edge cases.                                     </td></tr><tr><td data-label="Section"> <strong>Security Considerations</strong>                                               </td><td data-label="Technical Breakdown"> Utilities enforce DOM and HTML safety: <br>• IDs sanitized to prevent collisions or invalid attributes. <br>• SRI attributes embedded when known. <br>• Minimal HTML whitelist prevents accidental injection points. <br><strong>Defensive Design:</strong> No function trusts input; always sanitizes and logs unexpected cases.                                                                                                                                                                                         </td></tr><tr><td data-label="Section"> <strong>Logging & Debugging Utility</strong>                                           </td><td data-label="Technical Breakdown"> Provides detailed context in logs for developers to diagnose issues in table rendering pipelines. <br>• Function name and error message included. <br>• Helps pinpoint input that may break rendering or streaming logic.                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Extensibility</strong>                                                         </td><td data-label="Technical Breakdown"> Utilities are simple, isolated, and reusable: <br>• Can be wrapped or extended by higher-level renderers. <br>• <code>_take_and_stream</code> can be used for any iterable, not just table rows. <br>• <code>_sri_attr</code> can be adapted to CDN mapping for multiple asset types.                                                                                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>Module Invariants</strong>                                                     </td><td data-label="Technical Breakdown"> - All string-returning functions never return <code>None</code>. <br>- <code>_take_and_stream</code> always returns tuple <code>(list, iterable)</code>. <br>- Logging never throws exceptions. <br>- Inputs may be any type; outputs always predictable.                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Section"> <strong>Summary / Decision Points</strong>                                             </td><td data-label="Technical Breakdown"> <code>core_utils.py</code> provides defensive, minimal, reliable utilities for rendering: safe IDs, HTML outputs, SRI embedding, fragment detection, iterable streaming. Functions are highly robust, logging-aware, and ensure pipeline continuity even with malformed inputs. Supports safe, production-grade table rendering and asset referencing.                                                                                                                                                                  </td></tr><tr><td data-label="Section"> <strong>Iterable Safety</strong>                  </td><td data-label="Technical Breakdown"> <code>_take_and_stream</code> ensures no exceptions propagate from broken or non-standard iterables. Even if input is not an iterable, returns empty buffer and empty iterator. Guarantees downstream processing can safely continue.                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Fallback Hierarchy</strong>               </td><td data-label="Technical Breakdown"> Every function defines a primary logic path, then fallback on error. This reduces dependency on external validation or pre-processing. Example: <code>_sanitize_id</code> → regex sanitization → fallback <code>id-{idx}</code>.                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Regex Robustness</strong>                 </td><td data-label="Technical Breakdown"> Regular expressions are used defensively: wrapped in try/except. Handles unexpected input types (None, numbers, objects). Logs errors at debug level without interrupting execution.                                                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>HTML Safety Pattern</strong>              </td><td data-label="Technical Breakdown"> <code>_sanitize_id</code>, <code>_sanitize_html_whitelist</code>, <code>_sri_attr</code> all implement a strict contract: return valid strings safe for inclusion in HTML attributes or content. Minimizes risk of broken DOM or XSS injection.                                                                                                                                                   </td></tr><tr><td data-label="Section"> <strong>Defensive Casting</strong>                </td><td data-label="Technical Breakdown"> <code>_sanitize_output_path</code> and <code>_sanitize_html_whitelist</code> cast input to string using <code>str()</code>. Ensures any object type can be handled. Fallback values guarantee functional continuity.                                                                                                                                                                              </td></tr><tr><td data-label="Section"> <strong>SRI Integration Use Cases</strong>        </td><td data-label="Technical Breakdown"> <code>_sri_attr</code> is compatible with dynamic asset URLs. Mapping allows centralized control of integrity hashes for scripts/styles. Supports automatic inclusion in renderers generating HTML <code>&lt;script&gt;</code> or <code>&lt;link&gt;</code> tags.                                                                                                                                             </td></tr><tr><td data-label="Section"> <strong>Fragment Analysis Pattern</strong>        </td><td data-label="Technical Breakdown"> <code>_frag_contains_rows</code> supports conditional rendering logic. Detects presence of table rows in a fragment before integrating into full table. Enables safe concatenation or transformation of partial HTML.                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Streaming Pattern</strong>                </td><td data-label="Technical Breakdown"> <code>_take_and_stream</code> supports chunked processing of large datasets. Prevents high memory usage by iterating lazily and buffering only necessary elements. Ideal for paginated tables or progressive rendering.                                                                                                                                                     </td></tr><tr><td data-label="Section"> <strong>Error Resilience</strong>                 </td><td data-label="Technical Breakdown"> All utilities catch all exceptions internally. Ensures no single failure stops the rendering pipeline. Critical for production-grade HTML generation where inputs can be unpredictable.                                                                                                                                                                          </td></tr><tr><td data-label="Section"> <strong>Logging Discipline</strong>               </td><td data-label="Technical Breakdown"> Debug messages include function context and exception detail. Enables developers to trace which input caused fallback behavior. Ensures observability without affecting runtime behavior.                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>Minimal Dependencies</strong>             </td><td data-label="Technical Breakdown"> Only standard Python libraries (<code>re</code>, <code>html</code>, <code>logging</code>, <code>typing</code>) are used. Simplifies deployment, reduces security surface, and ensures portability across environments.                                                                                                                                                                                       </td></tr><tr><td data-label="Section"> <strong>Function Contract Guarantees</strong>     </td><td data-label="Technical Breakdown"> <code>_sanitize_id</code> → always returns non-empty string. <br> <code>_sanitize_output_path</code> → always returns string. <br> <code>_frag_contains_rows</code> → always returns boolean. <br> <code>_take_and_stream</code> → always returns <code>(list, iterator)</code>. Consistent contracts simplify caller logic.                                                                                            </td></tr><tr><td data-label="Section"> <strong>Production Reliability</strong>           </td><td data-label="Technical Breakdown"> Design prioritizes fault tolerance over strict input validation. Even malformed, None, or unexpected types are handled gracefully. Ensures large-scale rendering jobs do not fail due to isolated bad inputs.                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Unit Testing Implications</strong>        </td><td data-label="Technical Breakdown"> Functions can be tested in isolation due to deterministic fallbacks. Tests include: None input, invalid types, empty iterables, and malformed HTML fragments. Allows CI/CD pipelines to validate robustness.                                                                                                                                                     </td></tr><tr><td data-label="Section"> <strong>Performance Profile</strong>              </td><td data-label="Technical Breakdown"> Lightweight: no heavy computation. Regex operates on small strings. Iterable streaming avoids full materialization. Logging is debug-level; negligible impact unless enabled.                                                                                                                                                                                    </td></tr><tr><td data-label="Section"> <strong>Extensibility Pattern</strong>            </td><td data-label="Technical Breakdown"> Functions are small, pure (stateless), and composable. Can be reused in other modules or pipelines. Encourages building higher-level renderers with predictable behavior.                                                                                                                                                                                        </td></tr><tr><td data-label="Section"> <strong>Consistency Across Utilities</strong>     </td><td data-label="Technical Breakdown"> Naming convention <code>_sanitize_*</code> or <code>_frag_*</code> denotes internal defensive utilities. All share patterns: try/catch, logging, fallback return. Simplifies understanding and maintenance.                                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Security Considerations</strong>          </td><td data-label="Technical Breakdown"> ID sanitization prevents invalid HTML IDs. SRI integration mitigates integrity risks for external resources. Minimal HTML whitelist reduces injection risk. Pipeline assumes higher-level sanitization in <code>sanitize.py</code>.                                                                                                                                         </td></tr><tr><td data-label="Section"> <strong>Integration With Render Pipeline</strong> </td><td data-label="Technical Breakdown"> Core utilities are foundational for table rendering: <br>• IDs for table elements (<code>_sanitize_id</code>) <br>• Safe fragment insertion (<code>_frag_contains_rows</code>) <br>• Safe output paths (<code>_sanitize_output_path</code>) <br>• SRI attributes for assets (<code>_sri_attr</code>) <br>• Iterable streaming for row processing (<code>_take_and_stream</code>)                                        </td></tr><tr><td data-label="Section"> <strong>Design Philosophy</strong>                </td><td data-label="Technical Breakdown"> Defensive, predictable, low-dependency, production-ready. Prioritizes safety over performance optimizations that could compromise fault tolerance. Logging ensures visibility without raising errors.                                                                                                                                                            </td></tr><tr><td data-label="Section"> <strong>Decision Points for Developers</strong>   </td><td data-label="Technical Breakdown"> - Prefer using <code>_sanitize_id</code> for any dynamic DOM element ID. <br> - Always use <code>_sri_attr</code> when embedding external scripts/styles. <br> - Use <code>_take_and_stream</code> for large tables to avoid memory spikes. <br> - Combine with <code>sanitize.py</code> for full HTML safety.                                                                                               </td></tr><tr><td data-label="Section"> <strong>Summary / Recommendation</strong>         </td><td data-label="Technical Breakdown"> <code>core_utils.py</code> is a highly robust utility layer. Ensures safe IDs, output paths, fragment inspection, SRI integration, and iterable chunking. All functions are defensive, logging-aware, predictable, and minimal in dependencies. Suitable for production-grade rendering pipelines and safe integration with <code>render_table</code> or other higher-level functions. </td></tr><tr><td data-label="Section"> <strong>Next Steps / Integration Notes</strong>   </td><td data-label="Technical Breakdown"> When integrating: <br>• Wrap table generation with <code>_frag_contains_rows</code> checks. <br>• Sanitize all dynamic IDs with <code>_sanitize_id</code>. <br>• Embed assets using <code>_sri_attr</code>. <br>• Stream row data with <code>_take_and_stream</code> to maintain memory efficiency. <br>• Use <code>_sanitize_output_path</code> for all file writes to ensure fallback safety.                         </td></tr></tbody></table></div><div class="row-count">Rows: 46</div></div><div class="table-caption" id="Table12" data-table="Book_8043_12" style="margin-top:2mm;margin-left:3mm;"><strong>Table 12 — io_utils.py</strong></div>
<div class="table-wrapper" data-table-id="table-12"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Module Overview & Purpose</strong> </td><td data-label="Technical Breakdown"> <code>io_utils.py</code> is a core utility module designed to provide safe, robust, and production-ready file I/O operations in Python. It centralizes reading, writing, and directory management with a particular emphasis on atomic write semantics. Its goal is to ensure that critical data updates are either fully applied or not applied at all, preventing partial writes or corrupted files. The module distinguishes between non-critical convenience functions (<code>read_file</code> / <code>write_file</code>) and critical atomic operations (<code>_atomic_stream_write</code>). This design allows developers to make informed choices about which function to use based on the required durability and safety guarantees. </td></tr><tr><td data-label="Section"> <strong>Imports & Dependencies</strong> </td><td data-label="Technical Breakdown"> Relies solely on the Python Standard Library: <br>• <code>os</code> for filesystem operations and atomic replacement.<br>• <code>tempfile</code> for temporary file creation with controlled location and naming.<br>• <code>shutil</code> imported but not currently used; potentially for future file copy/backup utilities.<br>• <code>Path</code> from <code>pathlib</code> for object-oriented path manipulation.<br>• <code>Callable</code>, <code>Union</code>, <code>IO</code> from <code>typing</code> for type hinting, improving readability and static analysis support.<br>No external dependencies ensures portability and ease of integration. </td></tr><tr><td data-label="Section"> <strong>Read File Function: <code>read_file(path)</code></strong> </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Safely reads an entire text file encoded in UTF-8. <br><strong>Behavior:</strong> Uses Python's context manager (<code>with open(...)</code>) to ensure file handles are automatically closed, preventing resource leaks. <br><strong>Error Handling:</strong> Any exception during open or read is caught and re-raised as <code>IOError</code> with descriptive context, including the target file path. <br><strong>Use Cases:</strong> Reading configuration files, templates, or small to moderate text data files. Not optimized for very large files, as it reads the entire content into memory. <br><strong>Guarantees:</strong> Returns fully decoded UTF-8 content. </td></tr><tr><td data-label="Section"> <strong>Write File Function: <code>write_file(path, content)</code></strong> </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Writes a UTF-8 string to a specified path, creating parent directories as needed. <br><strong>Behavior:</strong> Checks for parent directory existence and creates it recursively if missing (<code>mkdir(parents=True, exist_ok=True)</code>). Opens file in write mode with UTF-8 encoding and writes the provided content. <br><strong>Atomicity:</strong> Non-atomic; if a crash occurs during writing, partial data may be left on disk. <br><strong>Error Handling:</strong> Exceptions during directory creation or writing are caught and re-raised as <code>IOError</code> with context. <br><strong>Intended Use:</strong> Suitable for logs, temporary files, or non-critical data where partial write does not compromise application integrity. </td></tr><tr><td data-label="Section"> <strong>Directory Creation: <code>ensure_dir(path)</code></strong> </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Ensures that a given path exists and is a directory. <br><strong>Behavior:</strong> Converts path to <code>Path</code> object. Checks existence; if path exists but is not a directory, raises <code>IOError</code>. Otherwise, recursively creates directories using <code>mkdir(parents=True, exist_ok=True)</code>. <br><strong>Error Handling:</strong> Wraps OS exceptions in <code>IOError</code> with descriptive messages. <br><strong>Use Cases:</strong> Prepare directories for outputs, logs, cache, or atomic write targets. Provides a uniform interface for safe directory management. </td></tr><tr><td data-label="Section"> <strong>Atomic Write: <code>_atomic_stream_write(path, write_fn)</code></strong> </td><td data-label="Technical Breakdown"> <strong>Purpose:</strong> Provides atomic write semantics for critical file updates. Ensures that either the old version remains fully intact or the new version is fully written, preventing partial writes. <br><strong>Mechanism:</strong> 1. Create a temporary file in the same directory as the target file using <code>tempfile.mkstemp</code>. Ensures same-device location for atomic replacement. <br>2. Close the low-level file descriptor to reopen in text mode. <br>3. Pass a writable file object to <code>write_fn</code> to stream content. <br>4. Flush the buffer and perform <code>fsync</code> (best-effort) to commit data to disk. <br>5. Atomically replace the target using <code>os.replace(tmp_path, target)</code>. <br>6. On exception, remove temporary file if it exists and re-raise as <code>IOError</code>. <br><strong>Guarantees:</strong> File content is either fully old or fully new. Uses OS-level atomic replace. </td></tr><tr><td data-label="Section"> <strong>Temporary File Handling Details</strong> </td><td data-label="Technical Breakdown"> Temporary files are named with a prefix <code>.{target.name}.</code> and suffix <code>.tmp</code>. Placement in the target's parent directory ensures atomic <code>os.replace</code>. File descriptor returned by <code>mkstemp</code> is immediately closed and reopened in text mode for compatibility with text writes. Temporary files are cleaned up on exceptions to prevent stale files. This mechanism is cross-platform, working on POSIX and Windows, with the limitation that atomic replacement requires the same device. </td></tr><tr><td data-label="Section"> <strong>Write Function Interface (<code>write_fn</code>)</strong> </td><td data-label="Technical Breakdown"> <code>write_fn</code> is a callable provided by the caller, accepting a writable <code>IO[str]</code>. This design allows flexibility: the caller can stream arbitrary content (line by line, from another file, or dynamically generated content) into the temporary file. Decouples the actual content generation from atomic write logic, making <code>_atomic_stream_write</code> reusable for diverse scenarios. </td></tr><tr><td data-label="Section"> <strong>Exception Handling & Logging</strong> </td><td data-label="Technical Breakdown"> All functions wrap underlying OS or Python exceptions into <code>IOError</code> with contextual messages. In <code>_atomic_stream_write</code>, exceptions during temporary file removal are silently ignored to avoid masking the primary error. Guarantees that no stale temporary files remain after failure. Provides clear, debuggable messages for troubleshooting production failures. </td></tr><tr><td data-label="Section"> <strong>Cross-Platform Considerations</strong> </td><td data-label="Technical Breakdown"> Relies on <code>os.replace</code> for atomic file replacement, which works on Windows (Python ≥3.3) and POSIX systems. Temporary files are created in the same directory as the target to ensure atomicity. Limitation: atomic replace fails if temp file is on a different device; users must ensure same-volume temp placement. </td></tr><tr><td data-label="Section"> <strong>FSync & Durability Guarantees</strong> </td><td data-label="Technical Breakdown"> <code>_atomic_stream_write</code> calls <code>f.flush()</code> and <code>os.fsync(f.fileno())</code> to push data to disk. Exceptions during <code>fsync</code> are ignored (best-effort) because some filesystems or OS configurations may not support it. Guarantees durability to the extent the underlying filesystem allows. Critical in environments where data loss on crash is unacceptable. </td></tr><tr><td data-label="Section"> <strong>Safety Considerations</strong> </td><td data-label="Technical Breakdown"> Non-atomic writes (<code>write_file</code>) should only be used for non-critical data. Atomic writes provide durability guarantees, but the module does not include file locking for concurrent processes. Users should avoid simultaneous writes from multiple processes unless external locking is applied. </td></tr><tr><td data-label="Section"> <strong>Design Philosophy</strong> </td><td data-label="Technical Breakdown"> Separation of concerns: <br>1. <code>read_file</code> / <code>write_file</code> for simple convenience. <br>2. <code>ensure_dir</code> for directory safety. <br>3. <code>_atomic_stream_write</code> for robust, critical updates. <br>Promotes readability, maintainability, and safe error handling without introducing external dependencies. </td></tr><tr><td data-label="Section"> <strong>Intended Usage Patterns</strong> </td><td data-label="Technical Breakdown"> 1. Use <code>read_file</code> for reading configuration, templates, or cache files. <br>2. Use <code>write_file</code> for temporary logs or non-critical updates. <br>3. Use <code>_atomic_stream_write</code> for configuration files, critical assets, or any file where partial writes would be unacceptable. <br>4. Always call <code>ensure_dir</code> before targeting nested directories for writes. </td></tr><tr><td data-label="Section"> <strong>Performance Considerations</strong> </td><td data-label="Technical Breakdown"> 1. <code>_atomic_stream_write</code> streams content to avoid holding large files in memory. <br>2. <code>write_file</code> writes content in-memory and is faster for small, non-critical writes. <br>3. <code>fsync</code> may add latency; suitable for critical writes where durability outweighs performance. <br>4. Temporary file creation and <code>os.replace</code> are efficient, O(1) on most filesystems. </td></tr><tr><td data-label="Section"> <strong>Error Propagation Strategy</strong> </td><td data-label="Technical Breakdown"> Consistently raises <code>IOError</code> with context. Ensures calling code can catch a single exception type for all file-related operations. Includes target path in error messages for rapid debugging. Best-effort cleanup ensures no leftover temp files remain after failed atomic writes. </td></tr><tr><td data-label="Section"> <strong>Extension & Future Enhancements</strong> </td><td data-label="Technical Breakdown"> Module can be extended with: <br>• Binary atomic writes (for non-text data). <br>• Optional retries for transient filesystem errors. <br>• File locking mechanisms for multi-process safety. <br>• Context manager wrappers for safe, high-level atomic operations. <br>• Logging hooks for audit trails of critical writes. </td></tr><tr><td data-label="Section"> <strong>Security & Integrity Notes</strong> </td><td data-label="Technical Breakdown"> Atomic write mechanism reduces risk of partial writes and data corruption. Temporary files are hidden (dot-prefixed) to reduce accidental exposure. Users should ensure that <code>write_fn</code> content is properly validated if sourced from untrusted input. </td></tr><tr><td data-label="Section"> <strong>Operational Recommendations</strong> </td><td data-label="Technical Breakdown"> 1. Prefer <code>_atomic_stream_write</code> for configuration files or files critical to application integrity. <br>2. Use <code>write_file</code> for logs or non-critical outputs. <br>3. Always verify directory existence using <code>ensure_dir</code> before performing writes. <br>4. Consider wrapping <code>_atomic_stream_write</code> in higher-level utilities if repeated patterns occur in the application. </td></tr><tr><td data-label="Section"> <strong>Reviewer Checklist</strong> </td><td data-label="Technical Breakdown"> 1. Verify <code>read_file</code> handles file not found and permission errors gracefully. <br>2. Confirm <code>write_file</code> creates parent directories as expected. <br>3. Ensure <code>_atomic_stream_write</code> performs atomic replacement correctly across platforms. <br>4. Check that temporary files are cleaned up on exceptions. <br>5. Validate that <code>fsync</code> is invoked and best-effort failure does not raise. <br>6. Review that type hints are consistent and accurate for static analysis. </td></tr><tr><td data-label="Section"> <strong>Minimal Unit Tests to Include</strong> </td><td data-label="Technical Breakdown"> • <code>read_file</code> returns expected content and raises <code>IOError</code> for missing files. <br>• <code>write_file</code> successfully writes small files, creates parent directories, and raises <code>IOError</code> for permission-denied paths. <br>• <code>ensure_dir</code> creates missing directories, raises <code>IOError</code> if path exists as file. <br>• <code>_atomic_stream_write</code> writes content atomically: verify file content before and after. <br>• <code>_atomic_stream_write</code> cleans up temp files on failure. <br>• Cross-platform tests: Windows and POSIX path handling. </td></tr><tr><td data-label="Section"> <strong>Decision Points & Summary</strong> </td><td data-label="Technical Breakdown"> <code>io_utils.py</code> is designed to be a foundational I/O layer for Python projects. It separates convenience and critical operations, providing atomic guarantees where necessary, robust error handling, and cross-platform safety. Developers can integrate these utilities to simplify file operations while minimizing the risk of data corruption, partial writes, or inconsistent states. This module is suitable for CI/CD pipelines, configuration management, asset deployment, and other scenarios where file integrity is crucial. It is lightweight, dependency-free, and easily testable. </td></tr></tbody></table></div><div class="row-count">Rows: 22</div></div><div class="table-caption" id="Table13" data-table="Book_8043_13" style="margin-top:2mm;margin-left:3mm;"><strong>Table 13 — markdown.py</strong></div>
<div class="table-wrapper" data-table-id="table-13"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by Component / Logic"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Component / Logic</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by Conceptual &amp; Technical Notes"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Conceptual & Technical Notes</div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Component / Logic"> <strong>Module docstring / header</strong> </td><td data-label="Conceptual &amp; Technical Notes"> Fully revised markdown-to-HTML converter. Conservatively handles underscores, inline emphasis, tables, fenced and inline code, and light HTML sanitization. Optional in-memory LRU cache for repeated renders. Designed as a single-file drop-in replacement. Emphasis on safety and conservative rendering. </td></tr><tr><td data-label="Component / Logic"> <strong>Imports</strong> </td><td data-label="Conceptual &amp; Technical Notes"> Uses standard library modules: <code>typing</code> for type hints, <code>re</code> for regex, <code>html</code> for escaping, <code>logging</code> for debug output, <code>threading</code> for concurrency safety, <code>collections.OrderedDict</code> for LRU cache, <code>hashlib</code> for cache keys, <code>csv</code> and <code>io</code> for CSV table parsing. Designed to minimize external dependencies; <code>markdown</code> imported locally in class. </td></tr><tr><td data-label="Component / Logic"> <strong>logger</strong> </td><td data-label="Conceptual &amp; Technical Notes"> Module-level logger initialized as <code>render.markdown</code>. All debug information and exceptions logged via <code>logger.debug</code> or <code>logger.exception</code>. Supports non-disruptive fallback handling. </td></tr><tr><td data-label="Component / Logic"> <strong>_is_safe_url(url: str) -> bool</strong> </td><td data-label="Conceptual &amp; Technical Notes"> Determines if a URL is safe for <code>href</code>. Rejects <code>javascript:</code> scheme. Allows <code>http://</code>, <code>https://</code>, <code>mailto:</code>, <code>/</code>, <code>#</code>, <code>//</code>. Regex ensures only safe characters present. Edge cases handled conservatively; <code>None</code> or empty string returns <code>False</code>. </td></tr><tr><td data-label="Component / Logic"> <strong>_sanitize_html(unsafe_html: str) -> str</strong> </td><td data-label="Conceptual &amp; Technical Notes"> Light HTML sanitizer. Strips dangerous tags: <code>&lt;script&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;embed&gt;</code>, <code>&lt;object&gt;</code>, <code>&lt;form&gt;</code>, <code>&lt;input&gt;</code>, <code>&lt;button&gt;</code>, <code>&lt;svg&gt;</code>, <code>&lt;meta&gt;</code>, <code>&lt;link&gt;</code>. Removes <code>on*</code> event attributes. Allows only limited tags (<code>div</code>, <code>p</code>, <code>strong</code>, <code>em</code>, etc.) and attributes (<code>class</code>, <code>id</code>, <code>data-*</code>). Escapes all other tags. Handles raw attribute quoting (<code>&quot;</code>, <code>&#x27;</code>, unquoted). Uses regex cautiously with <code>(?is)</code> and <code>(?i)</code> flags. </td></tr><tr><td data-label="Component / Logic"> <strong>_enforce_link_rel(html_text: str) -> str</strong> </td><td data-label="Conceptual &amp; Technical Notes"> Adds <code>rel=&quot;noopener noreferrer&quot;</code> to external links lacking <code>rel</code>. Operates on sanitized HTML. Matches <code>&lt;a ... href=&quot;...&quot;&gt;</code>. Protocol-relative (<code>//</code>) links treated as external. Conservatively leaves existing <code>rel</code> untouched. </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table14" data-table="Book_8043_14" style="margin-top:2mm;margin-left:3mm;"><strong>Table 14 — sanitize.py</strong></div>
<div class="table-wrapper" data-table-id="table-14"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown"> <strong>Module Purpose</strong> </td><td data-label="Details"> Provides HTML sanitization utilities for the renderer. Primary export: <code>sanitize_html(html_text: str, allow_tables: bool = False) -&gt; str</code>. Ensures safe HTML, prevents XSS, neutralizes script injection outside of literal code blocks, and optionally allows table-related HTML. Designed for robust rendering in complex content pipelines. </td></tr><tr><td data-label="Technical Breakdown"> <strong>High-Level Strategy</strong> </td><td data-label="Details"> Two-layered cleaning system: optional Bleach-based sanitizer for high-performance environments and a fallback <code>HTMLParser</code>-based cleaner if Bleach is unavailable. Attribute filtering is primary defense against inline JS and style injection. <code>&lt;script&gt;</code> tags neutralized post-cleaning outside <code>&lt;code&gt;</code>/<code>&lt;pre&gt;</code> blocks. Tables allowed conditionally using <code>allow_tables</code> flag. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Allowed Tags</strong> </td><td data-label="Details"> <code>ALLOWED_TAGS</code> defines permitted tags. Omits <code>&lt;br&gt;</code> to prevent break injection in table cells. Includes: structural (<code>p</code>, <code>ul</code>, <code>ol</code>, <code>li</code>, <code>details</code>, <code>summary</code>), inline formatting (<code>b</code>, <code>strong</code>, <code>i</code>, <code>em</code>, <code>u</code>, <code>mark</code>), headings (<code>h1</code>-<code>h6</code>), code (<code>code</code>, <code>pre</code>), tables (<code>table</code>, <code>thead</code>, <code>tbody</code>, <code>tr</code>, <code>th</code>, <code>td</code>, <code>figure</code>, <code>figcaption</code>), and images (<code>img</code>). All tags chosen for safe rendering without allowing script execution or layout-breaking injections. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Allowed Attributes</strong> </td><td data-label="Details"> <code>ALLOWED_ATTRIBUTES</code> controls which attributes are allowed per tag. Global attributes (<code>*</code>) include <code>id</code>, <code>dir</code>, <code>scope</code>, <code>class</code>, <code>title</code>, <code>role</code>, <code>aria-*</code>, <code>aria-hidden</code>, and <code>data-*</code>. Specific tag allowances: <code>a</code> (<code>href</code>, <code>title</code>, <code>rel</code>, <code>target</code>), <code>img</code> (<code>src</code>, <code>alt</code>, <code>title</code>, <code>width</code>, <code>height</code>). Wildcard suffixes supported for <code>aria-*</code> and <code>data-*</code>. All attributes validated for safety, ignoring inline event handlers (<code>on*</code>) and style to prevent XSS. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Allowed Protocols</strong> </td><td data-label="Details"> <code>ALLOWED_PROTOCOLS</code> enforces safe link and image schemes: <code>http</code>, <code>https</code>, <code>mailto</code>, and <code>data</code> (with strict base64 validation for PNG, JPEG, JPG, GIF, WEBP via <code>IMG_DATA_MIME</code>). Protects against <code>javascript:</code> or other unsafe URIs in <code>href</code> or <code>src</code>. </td></tr><tr><td data-label="Technical Breakdown"> <strong>URL Safety Check</strong> </td><td data-label="Details"> Function <code>is_safe_url(url: Optional[str]) -&gt; bool</code> validates URLs. Relative URLs allowed. Absolute URLs must use <code>http</code>, <code>https</code>, <code>mailto</code>, or match <code>IMG_DATA_MIME</code> for data images. Rejects any unsafe schemes. Ensures <code>href</code>/<code>src</code> cannot execute scripts. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Attribute Filtering Function</strong> </td><td data-label="Details"> <code>_attr_allowed_for_tag(attr_name: str, tag: str) -&gt; bool</code> determines if a given attribute is allowed for a tag. Normalizes names to lowercase, supports wildcard suffixes, and merges global <code>*</code> and tag-specific attributes. Drops all event handlers (<code>on*</code>) and style attributes defensively. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Bleach-Based Cleaning</strong> </td><td data-label="Details"> <code>bleach_clean(html_text: str, allowed_tags: Optional[List[str]] = None) -&gt; str</code> cleans HTML using Bleach if installed. Options: <code>tags</code>, <code>attributes</code>, <code>protocols</code>, <code>strip=True</code>. Performs linkification for plain URLs. Regex-based post-processing ensures attribute values are safe and escaped. Fallback: returns input unchanged if Bleach missing. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Bleach Attribute Post-Processing</strong> </td><td data-label="Details"> After Bleach, <code>START_TAG_RE</code> regex captures start tags. Attributes parsed conservatively, unsafe attributes dropped. <code>href</code> and <code>src</code> validated with <code>is_safe_url</code>. Values escaped with <code>html.escape</code>. Maintains tag self-closing syntax if present. Ensures Bleach does not allow unsafe injections via attributes. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Fallback Cleaner Class</strong> </td><td data-label="Details"> <code>FallbackCleaner(HTMLParser)</code> provides a fully Python-standard fallback. Takes <code>allowed_tags</code> and <code>allowed_attrs</code>. Normalizes attribute sets. Handles start/end tags, text, and entities. Escapes all textual content. Rejects disallowed tags and attributes, including event handlers and styles. Preserves only safe, validated HTML. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Fallback Clean Function</strong> </td><td data-label="Details"> <code>fallback_clean(html_text: str, allowed_tags: Optional[List[str]] = None) -&gt; str</code> instantiates <code>FallbackCleaner</code>, feeds HTML, and returns cleaned HTML. On parse failure, returns fully escaped HTML. Ensures consistent safety when Bleach is unavailable. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Script Neutralization Outside Code/Pre</strong> </td><td data-label="Details"> <code>_neutralize_script_tags_outside_code(text: str) -&gt; str</code> splits HTML into <code>&lt;pre&gt;</code>/<code>&lt;code&gt;</code> blocks and non-code segments. Only non-code segments have <code>&lt;script&gt;</code> and <code>&lt;/script&gt;</code> replaced with <code>&amp;lt;script</code> and <code>&amp;lt;/script</code>. Preserves literal code while preventing execution in rendered content. Regex applied with case-insensitive matching. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Top-Level Sanitizer Function</strong> </td><td data-label="Details"> <code>sanitize_html(html_text: str, allow_tables: bool = False) -&gt; str</code> workflow: 1) Validate input type. 2) Determine allowed tags, excluding table-related tags if <code>allow_tables=False</code>. 3) First pass: Bleach or fallback clean. 4) Second pass: neutralize scripts outside code/pre blocks. Returns fully sanitized HTML string, or empty string for invalid input. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Exception Safety</strong> </td><td data-label="Details"> All functions wrapped with try-except blocks to handle edge cases without raising. Bleach linkify failures ignored, regex failures fallback to conservative defaults, parser exceptions return escaped HTML. Guarantees sanitizer never crashes even on malformed or malicious input. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Tables Handling</strong> </td><td data-label="Details"> <code>TABLE_TAGS</code> group controls table-related tags. When <code>allow_tables=False</code>, these tags are removed from allowed set. Ensures safety while preserving textual content. Allows controlled enabling of table support without compromising security. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Image Handling</strong> </td><td data-label="Details"> <code>img</code> tags allowed only if protocol is safe. Base64 images validated against strict regex (<code>IMG_DATA_MIME</code>) for common MIME types. Prevents data URI injection attacks. Attribute <code>src</code> sanitized. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Unicode & Entity Handling</strong> </td><td data-label="Details"> <code>FallbackCleaner</code> handles <code>handle_entityref</code> and <code>handle_charref</code>. All textual content escaped with <code>html.escape</code> to prevent injection. Supports multilingual content, special characters, and RTL scripts. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Attribute Escaping</strong> </td><td data-label="Details"> All attributes values escaped using <code>html.escape(val, quote=True)</code>. Prevents injection via attribute context. Ensures safe inclusion of <code>href</code>, <code>src</code>, <code>title</code>, <code>alt</code>, and <code>data-*</code> attributes. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Pre/Code Safety</strong> </td><td data-label="Details"> Content inside <code>&lt;pre&gt;</code> and <code>&lt;code&gt;</code> preserved verbatim. Script neutralization skips these blocks. Supports display of literal examples including <code>&lt;script&gt;</code> code safely. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Regex-Based Postprocessing</strong> </td><td data-label="Details"> Regex <code>START_TAG_RE</code> identifies start tags. <code>_sanitize_tag</code> processes attributes, dropping unsafe entries. Maintains valid HTML structure and prevents injection vectors. Lightweight and efficient. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Self-Test / Smoke Check</strong> </td><td data-label="Details"> <code>__main__</code> block demonstrates sample input with: safe HTML, unsafe JS, data images, table content, RTL text, and literal code blocks. Prints sanitized output with tables allowed and disallowed. Ensures developer can verify functionality quickly. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Defensive Design Decisions</strong> </td><td data-label="Details"> - <code>&lt;br&gt;</code> omitted to prevent table-cell-breaking. <br>- Event handlers (<code>on*</code>) and style dropped defensively. <br>- Script neutralization only outside code/pre. <br>- Conservative fallback when Bleach unavailable. <br>- Regex used cautiously with exception handling. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Extensibility & Configuration</strong> </td><td data-label="Details"> Allowed tags, attributes, and protocols can be customized by passing lists/mappings. <code>allow_tables</code> flag allows runtime control. Future attributes or custom protocols can be added without changing core logic. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Performance Considerations</strong> </td><td data-label="Details"> Bleach used if available for faster, tested sanitization. Fallback parser avoids external dependencies. Regex post-processing lightweight and only applied when Bleach present. HTMLParser feed allows incremental processing for large HTML content. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Security Guarantees</strong> </td><td data-label="Details"> Attribute filtering and URL validation prevent XSS. Base64 image validation prevents malicious data URIs. Script neutralization protects from inline JS. Literal code preserved safely. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Integration Notes</strong> </td><td data-label="Details"> Designed for renderer pipeline. Sanitized HTML safe for table cells, content blocks, and inline rendering. Use <code>allow_tables=True</code> only for safe table rendering. Can be applied as first step in content processing to prevent unsafe HTML propagation. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Fallback Strategy</strong> </td><td data-label="Details"> Bleach present → <code>bleach_clean</code> + regex post-processing. <br> Bleach absent → <code>fallback_clean</code> with <code>FallbackCleaner</code>. <br> In both cases, <code>_neutralize_script_tags_outside_code</code> applied. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Testing / Verification Recommendations</strong> </td><td data-label="Details"> - Test with HTML containing scripts, images, links, tables, and code blocks. <br> - Verify correct escaping of unsafe content. <br> - Check script neutralization outside <code>&lt;pre&gt;</code>/<code>&lt;code&gt;</code>. <br> - Validate that allowed tags and attributes are correctly preserved. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Limitations & Caveats</strong> </td><td data-label="Details"> <code>&lt;br&gt;</code> tags stripped intentionally. Complex malformed HTML may be partially normalized. Bleach linkify may alter URLs silently. Data URI limited to common image types. Large deeply nested structures may require performance tuning. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Documentation & Comments</strong> </td><td data-label="Details"> Functions include docstrings explaining purpose, parameters, and decisions. Inline comments highlight defensive coding practices and reasoning behind tag/attribute choices. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Key Regex Patterns</strong> </td><td data-label="Details"> <code>IMG_DATA_MIME</code> validates base64 images. <code>START_TAG_RE</code> captures start tags. <code>_neutralize_script_tags_outside_code</code> splits content for safe script replacement. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Operational Advice</strong> </td><td data-label="Details"> Test with representative content containing literal code, scripts, links, images, tables, and RTL text. Integrate sanitizer early in pipeline. Enable tables only when rendering safe HTML tables is required. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Reviewer Checklist</strong> </td><td data-label="Details"> 1. Confirm <code>&lt;br&gt;</code> omission intentional. <br> 2. Verify <code>ALLOWED_ATTRIBUTES</code> suffices for project use. <br> 3. Test <code>is_safe_url</code> with multiple URL types. <br> 4. Validate fallback clean behavior without Bleach. <br> 5. Ensure script neutralization does not alter <code>&lt;pre&gt;</code>/<code>&lt;code&gt;</code>. <br> 6. Run sample smoke test and inspect output. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Function: is_safe_url</strong> </td><td data-label="Details"> Checks URL safety: relative URLs allowed; absolute URLs must be <code>http</code>, <code>https</code>, <code>mailto</code>, or strict <code>data:image</code> base64. Returns boolean. Rejects any potentially unsafe schemes. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Function: _attr_allowed_for_tag</strong> </td><td data-label="Details"> Determines allowed attributes per tag. Considers global (<code>*</code>) and tag-specific lists. Supports wildcard suffixes. Defensive: drops event handlers and style. Case-insensitive. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Function: bleach_clean</strong> </td><td data-label="Details"> Cleans HTML using Bleach. Configurable allowed tags/attributes/protocols. Strips disallowed tags. Performs linkification. Post-processes attributes for extra safety. Returns sanitized HTML. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Function: fallback_clean</strong> </td><td data-label="Details"> Uses <code>FallbackCleaner</code> to parse and sanitize HTML. Escapes data, entities, and attributes. Ensures safe output even without Bleach. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Class: FallbackCleaner</strong> </td><td data-label="Details"> Subclass of <code>HTMLParser</code>. Normalizes allowed tags and attributes. Escapes textual data. Drops disallowed tags and attributes. Handles start/end tags, data, entity, and char references. Produces sanitized HTML string. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Function: _neutralize_script_tags_outside_code</strong> </td><td data-label="Details"> Replaces <code>&lt;script&gt;</code> and <code>&lt;/script&gt;</code> outside <code>&lt;pre&gt;</code>/<code>&lt;code&gt;</code> blocks with escaped equivalents. Preserves literal code. Uses regex split + replacement. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Function: sanitize_html</strong> </td><td data-label="Details"> Combines all steps: chooses allowed tags, runs bleach_clean or fallback_clean, neutralizes scripts outside code/pre. Returns sanitized HTML string. Ensures safe content rendering. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Self-Test</strong> </td><td data-label="Details"> Demonstrates sanitization on sample input containing safe HTML, unsafe JS, data images, table content, RTL text, and code. Prints sanitized output with tables allowed and disallowed. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Security Guarantees Summary</strong> </td><td data-label="Details"> XSS prevention via attribute filtering and URL validation. Script neutralization protects execution. Base64 image restriction. Literal code preserved safely. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Performance Notes</strong> </td><td data-label="Details"> Bleach preferred for efficiency. Fallback parser ensures functionality without dependencies. Regex post-processing minimal overhead. Scalable for large HTML documents. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Extensibility Notes</strong> </td><td data-label="Details"> Allowed tags, attributes, protocols configurable. Additional safe attributes or protocols can be added. <code>allow_tables</code> flag controls table rendering. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Integration Recommendations</strong> </td><td data-label="Details"> Use as first sanitizer in renderer pipeline. Always test with content containing code, images, links, and scripts. Enable <code>allow_tables</code> only when needed. </td></tr></tbody></table></div><div class="row-count">Rows: 45</div></div><div class="table-caption" id="Table15" data-table="Book_8043_15" style="margin-top:2mm;margin-left:3mm;"><strong>Table 15 — worker.js</strong></div>
<div class="table-wrapper" data-table-id="table-15"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Details**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown"> <strong>File Overview</strong> </td><td data-label="Details"> <code>/static/worker.js</code> is a lightweight, non-blocking Web Worker that handles table indexing and searching. It operates independently of the DOM, suitable for large datasets, and supports multiple input formats (arrays of tables, raw HTML, or URLs). The worker uses <code>DOMParser</code> when available and falls back to regex-based parsing in minimal environments. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Primary Responsibilities</strong> </td><td data-label="Details"> 1. Build structured index from tables.<br>2. Perform text-based searches over indexed tables.<br>3. Provide results with row snippets.<br>4. Support cancellation of in-progress searches.<br>5. Handle errors gracefully and return structured messages. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Message Types</strong> </td><td data-label="Details"> The worker communicates using structured messages:<br>- <code>index</code>: builds or rebuilds the table index.<br>- <code>search</code>: searches the index for a query.<br>- <code>clear</code>: resets the index.<br>- <code>status</code>: returns readiness and current table count.<br>- <code>ping</code>: simple heartbeat.<br>- Unknown types: trigger error response. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Index Store Structure</strong> </td><td data-label="Details"> <code>indexStore</code> maintains an array of tables: <code>indexStore.tables = []</code>.<br>Each table object contains:<br>- <code>id</code>: unique table identifier.<br>- <code>headers</code>: array of column headers.<br>- <code>rows</code>: array of row arrays, each row is <code>[cell0, cell1,...]</code>.<br>- <code>rowsText</code>: each row joined as <code>&quot;cell0 | cell1 | ...&quot;</code>, for display or snippet extraction.<br>- <code>rowsTextLc</code>: lowercase, sanitized version of <code>rowsText</code> for fast search matching. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Constants and Globals</strong> </td><td data-label="Details"> - <code>CHUNK_YIELD = 500</code>: number of rows processed before yielding to the event loop to prevent worker freeze.<br>- <code>currentSearchToken = 0</code>: integer token to manage search cancellation.<br>- <code>indexStore</code>: persistent storage for all indexed tables. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Text Sanitization</strong> </td><td data-label="Details"> <code>sanitize(text)</code> performs:<br>1. Null-safe handling: converts <code>null</code>/<code>undefined</code> to empty string.<br>2. Whitespace collapse: multiple spaces replaced with a single space.<br>3. Trim: leading and trailing spaces removed.<br>4. Lowercase conversion: enables case-insensitive search.<br>Ensures consistent query matching. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Array Comparison Utility</strong> </td><td data-label="Details"> <code>arraysEqual(a, b)</code> checks deep equality:<br>- Returns false if either array is null, lengths differ, or any element mismatches.<br>- Used primarily for detecting if the first row matches headers in fallback parsing. </td></tr><tr><td data-label="Technical Breakdown"> <strong>HTML Parsing Function</strong> </td><td data-label="Details"> <code>parseHtmlTables(html)</code> extracts tables from HTML input:<br>1. If <code>DOMParser</code> is present:<br>   - Parse HTML string into <code>document</code>.<br>   - Select all <code>&lt;table&gt;</code> elements.<br>   - For each table:<br>     • Extract headers from <code>&lt;thead th&gt;</code> or fallback to first <code>&lt;tr&gt;</code> cells.<br>     • Extract body rows from <code>&lt;tbody tr&gt;</code>; if missing, fallback to all <code>&lt;tr&gt;</code> excluding header row.<br>     • Store as <code>{id, headers, rows}</code>.<br>2. If <code>DOMParser</code> unavailable, regex fallback:<br>   - Match <code>&lt;table&gt;</code> blocks.<br>   - Extract <code>&lt;thead&gt;</code> if present, otherwise first row as headers.<br>   - Extract <code>&lt;tr&gt;</code> → <code>&lt;td&gt;/&lt;th&gt;</code> for rows.<br>   - Strip HTML tags, trim text.<br>   - Avoid crashes by returning empty tables on parse errors. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Table Addition to Index</strong> </td><td data-label="Details"> <code>addTableToIndex(id, headers, rows)</code>:<br>1. Normalize rows: all entries coerced to strings.<br>2. Build <code>rowsText</code>: row content joined with <code>&quot; | &quot;</code> for display.<br>3. Build <code>rowsTextLc</code>: lowercase, sanitized version for search.<br>4. Assign <code>id</code> if missing: <code>table_${indexStore.tables.length + 1}</code>.<br>5. Append table to <code>indexStore.tables</code>. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Index Building Workflow</strong> </td><td data-label="Details"> <code>buildIndex(msg)</code> handles input sources:<br>- <code>msg.tables</code>: direct table array input.<br>- <code>msg.html</code>: raw HTML input.<br>- <code>msg.url</code>: fetch HTML via <code>fetch</code> and parse.<br>Steps:<br>1. Reset <code>indexStore.tables</code> to empty.<br>2. Iterate over tables/html, parse, and normalize.<br>3. Add tables via <code>addTableToIndex</code>.<br>4. Post status <code>{type:&#x27;status&#x27;, status:&#x27;indexed&#x27;, tables: &lt;count&gt;}</code>.<br>5. Errors caught and posted via <code>{type:&#x27;error&#x27;, error: &#x27;parse_html_failed&#x27;}</code> or <code>fetch_failed</code>. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Search Functionality</strong> </td><td data-label="Details"> <code>handleSearch(msg)</code> performs query searches across indexed tables:<br>1. Increment <code>currentSearchToken</code> for cancellation control.<br>2. Sanitize query.<br>3. Determine <code>perTableLimit</code> from <code>msg.limit</code> (default 200).<br>4. Iterate <code>indexStore.tables</code> and <code>rowsTextLc</code>:<br>   - For each row containing the query, store index and snippet.<br>   - Snippets capture ±40 characters around query, max 160 chars.<br>   - Yield to event loop every <code>CHUNK_YIELD</code> rows to avoid blocking.<br>5. If token mismatch detected, post <code>{type:&#x27;searchCanceled&#x27;}</code>.<br>6. Post final <code>{type:&#x27;searchResults&#x27;}</code> with matches. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Snippet Extraction</strong> </td><td data-label="Details"> - Extract relevant context around matched term for UI display.<br>- Avoids overlong snippets by enforcing max length.<br>- Associates snippet with row index for reconstruction. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Search Cancellation</strong> </td><td data-label="Details"> - Uses <code>currentSearchToken</code> to track the latest search.<br>- Any older searches detect token mismatch and stop immediately.<br>- Ensures no race conditions for rapid search inputs. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Async Yielding</strong> </td><td data-label="Details"> Worker yields control using <code>await new Promise(r =&gt; setTimeout(r,0))</code> every <code>CHUNK_YIELD</code> rows.<br>Prevents UI lock-up and keeps worker responsive for large datasets. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Event Handling</strong> </td><td data-label="Details"> <code>self.addEventListener(&#x27;message&#x27;, async ev =&gt; {...})</code>:<br>- Switches on <code>msg.type</code>.<br>- <code>index</code> → <code>buildIndex</code>.<br>- <code>search</code> → <code>handleSearch</code> (async, not awaited to allow cancellation).<br>- <code>clear</code> → reset <code>indexStore</code>.<br>- <code>status</code> → post readiness.<br>- <code>ping</code> → post <code>&#x27;pong&#x27;</code>.<br>- Default → post error for unknown types. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Clear Index</strong> </td><td data-label="Details"> On <code>&#x27;clear&#x27;</code> message:<br>- <code>indexStore.tables = []</code>.<br>- Post <code>{type:&#x27;status&#x27;, status:&#x27;cleared&#x27;}</code>.<br>- Ensures previous data removed safely. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Status Query</strong> </td><td data-label="Details"> On <code>&#x27;status&#x27;</code> message:<br>- Returns <code>{status:&#x27;ready&#x27;, tables:&lt;count&gt;}</code>.<br>- Allows main thread to check worker readiness. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Ping/Pong Heartbeat</strong> </td><td data-label="Details"> <code>&#x27;ping&#x27;</code> message triggers <code>&#x27;pong&#x27;</code> response.<br>Used for liveness check and simple connectivity verification. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Error Handling Strategy</strong> </td><td data-label="Details"> - All parsing, fetching, and search operations wrapped in try/catch.<br>- Errors reported via <code>postMessage({type:&#x27;error&#x27;, error, details})</code>.<br>- Worker remains alive after error; non-fatal. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Fallback Parsing</strong> </td><td data-label="Details"> - Regex fallback for environments without <code>DOMParser</code>.<br>- Uses non-greedy patterns to safely capture <code>&lt;table&gt;</code> content.<br>- Strips inner tags and trims text.<br>- Prevents crashes on malformed HTML. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Headers Detection Strategy</strong> </td><td data-label="Details"> - Prefer <code>&lt;thead th&gt;</code>.<br>- Fallback to first <code>&lt;tr&gt;</code> <code>&lt;th&gt;</code> cells.<br>- If absent, header may be empty.<br>- Ensures consistent <code>headers</code> array for each table. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Row Normalization & Safety</strong> </td><td data-label="Details"> - All rows coerced to string arrays.<br>- Empty or missing rows handled gracefully.<br>- Ensures <code>rowsText</code> and <code>rowsTextLc</code> arrays remain aligned. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Memory & Performance Considerations</strong> </td><td data-label="Details"> - Chunked processing avoids blocking event loop.<br>- Limits per-table search results via <code>perTableLimit</code>.<br>- Lowercased row text precomputed for fast comparisons.<br>- Snippets generated lazily, only for matched rows. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Worker Safety</strong> </td><td data-label="Details"> - Does not manipulate DOM.<br>- Operates purely on data structures.<br>- Safe for multi-threaded execution.<br>- Compatible with minimal environments. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Data Contracts</strong> </td><td data-label="Details"> Every <code>postMessage</code> includes <code>type</code> and relevant fields:<br>- <code>&#x27;status&#x27;</code>, <code>&#x27;searchResults&#x27;</code>, <code>&#x27;searchCanceled&#x27;</code>, <code>&#x27;error&#x27;</code>, <code>&#x27;pong&#x27;</code>.<br>- Ensures predictable communication with main thread. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Extensibility & Maintainability</strong> </td><td data-label="Details"> - Message handling can be extended for new types.<br>- Parsing strategy supports DOM-based and regex-based methods.<br>- Index and search logic modular and isolated. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Security Considerations</strong> </td><td data-label="Details"> - Sanitizes all text for search matching.<br>- Regex parsing strips HTML tags safely.<br>- No execution of HTML or scripts from indexed content.<br>- Safe even with untrusted HTML input. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Operational Notes</strong> </td><td data-label="Details"> - Suitable for large table datasets.<br>- Non-blocking, memory-efficient.<br>- Can be used in multi-threaded UI environments for search functionality.<br>- Supports cancellation, responsive search, and large table indexing without freezes. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Edge Case Handling</strong> </td><td data-label="Details"> - Empty tables or rows handled gracefully.<br>- Missing headers do not break indexing.<br>- Fetch failures reported without crashing worker.<br>- Token-based cancellation ensures old searches do not interfere with new ones. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Developer Utilities</strong> </td><td data-label="Details"> - <code>sanitize(text)</code> for text normalization.<br>- <code>arraysEqual(a,b)</code> for header verification.<br>- <code>addTableToIndex</code> centralizes table addition logic.<br>- All utilities isolated and reusable. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Fetch-Based Indexing</strong> </td><td data-label="Details"> - Supports <code>msg.url</code> input.<br>- Fetches HTML via <code>fetch</code>.<br>- Parses returned HTML and adds tables to index.<br>- Errors caught and reported if network or parsing fails. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Search Result Format</strong> </td><td data-label="Details"> - Array of objects: <code>{ tableId, tableIndex, matches: [rowIndices], snippets: [{rowIndex, snippet}] }</code>.<br>- Provides structured data for rendering UI search results. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Snippet Extraction Rules</strong> </td><td data-label="Details"> - ±40 characters before query, max 160 characters total.<br>- Captures enough context for UI previews.<br>- Handles start/end bounds of text safely. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Worker Concurrency Model</strong> </td><td data-label="Details"> - Async functions with yielding prevent blocking main thread.<br>- <code>currentSearchToken</code> prevents race conditions.<br>- Worker remains responsive under heavy load. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Logging & Debugging</strong> </td><td data-label="Details"> - Errors and parsing issues posted as messages.<br>- Allows main thread to log or handle worker-side issues.<br>- No silent failures; all exceptions propagated. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Fallback Robustness</strong> </td><td data-label="Details"> - Dual parsing strategies (DOM + regex) ensure high table capture rate.<br>- Handles malformed or minimal HTML gracefully.<br>- No dependency on external libraries. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Consistency Guarantees</strong> </td><td data-label="Details"> - <code>rowsText</code> and <code>rowsTextLc</code> arrays align with <code>rows</code> arrays.<br>- Headers preserved for every table.<br>- Search results match index structure exactly. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Resource Management</strong> </td><td data-label="Details"> - Indexing clears previous tables to free memory.<br>- Chunked processing avoids blocking event loop.<br>- Snippets generated on demand. </td></tr><tr><td data-label="Technical Breakdown"> <strong>Final Guarantees</strong> </td><td data-label="Details"> - Safe, consistent indexing of tables from multiple sources.<br>- Non-blocking search over large datasets.<br>- Cancellation support.<br>- Predictable, structured messaging for main thread consumption.<br>- DOM-free operation; minimal memory footprint. </td></tr></tbody></table></div><div class="row-count">Rows: 39</div></div><div class="table-caption" id="Table16" data-table="Book_8043_16" style="margin-top:2mm;margin-left:3mm;"><strong>Table 16 — toc_manager.py</strong></div>
<div class="table-wrapper" data-table-id="table-16"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Summary / Purpose</strong> </td><td data-label="Technical Breakdown"> Provides a complete utility for automatically injecting captions above tables and generating a Table of Contents (TOC) in rendered HTML files. Designed for static HTML reports, notebooks, or exports, this function allows consistent labeling and navigable TOC creation without manual edits. Supports repeatable, idempotent operations. </td></tr><tr><td data-label="Section"> <strong>Primary Function</strong> </td><td data-label="Technical Breakdown"> <code>apply_toc_and_captions(html_path: str, labels_path: str)</code> — main entrypoint that reads HTML and labels JSON, updates captions, rebuilds TOC, and writes modified HTML back to disk. </td></tr><tr><td data-label="Section"> <strong>Dependencies</strong> </td><td data-label="Technical Breakdown"> - <code>BeautifulSoup</code> (<code>bs4</code>) for parsing and manipulating HTML DOM.<br>- <code>Pathlib.Path</code> for platform-independent file handling.<br>- <code>json</code> for loading structured table label data. </td></tr><tr><td data-label="Section"> <strong>Input Parameters</strong> </td><td data-label="Technical Breakdown"> - <code>html_path</code>: Path to the HTML file to be updated.<br>- <code>labels_path</code>: Path to <code>labels.json</code> containing table IDs and captions. Both must exist; otherwise, function exits gracefully. </td></tr><tr><td data-label="Section"> <strong>File Validation</strong> </td><td data-label="Technical Breakdown"> 1. Converts <code>html_path</code> to <code>Path</code> object; checks if file exists.<br>2. Converts <code>labels_path</code> to <code>Path</code> object; checks if file exists.<br>3. Logs missing files via <code>print</code> statements and returns early to prevent exceptions. </td></tr><tr><td data-label="Section"> <strong>HTML Parsing</strong> </td><td data-label="Technical Breakdown"> - Reads HTML file using UTF-8 encoding.<br>- Parses content with <code>BeautifulSoup(html_file.read_text(), &quot;html.parser&quot;)</code>.<br>- Ensures full DOM representation for safe insertion of captions and TOC elements. </td></tr><tr><td data-label="Section"> <strong>Loading Captions</strong> </td><td data-label="Technical Breakdown"> - Reads <code>labels.json</code> file into a Python dictionary mapping <code>table_id</code> → <code>caption_text</code>.<br>- Validates JSON parsing implicitly; assumes well-formed JSON.<br>- Captions dictionary drives both caption insertion and TOC generation. </td></tr><tr><td data-label="Section"> <strong>Caption Injection</strong> </td><td data-label="Technical Breakdown"> - Iterates through <code>captions.items()</code>.<br>- Locates table in HTML with <code>soup.find(id=table_id)</code>.<br>- Checks for existing caption: <code>table_tag.find_previous_sibling(&quot;caption&quot;)</code> and compares text to avoid duplicates.<br>- Creates new <code>&lt;caption&gt;</code> tag using <code>soup.new_tag(&quot;caption&quot;)</code>, sets <code>.string = caption_text</code>, assigns class <code>&quot;table-caption&quot;</code>.<br>- Inserts caption before table using <code>table_tag.insert_before(cap)</code>. </td></tr><tr><td data-label="Section"> <strong>TOC Generation</strong> </td><td data-label="Technical Breakdown"> - Creates a new <code>&lt;ul&gt;</code> element with <code>id=&quot;toc&quot;</code>: <code>soup.new_tag(&quot;ul&quot;, id=&quot;toc&quot;)</code>.<br>- Iterates captions dictionary:<br>  • For each entry, creates <code>&lt;li&gt;</code> and <code>&lt;a&gt;</code> with <code>href=&quot;#table_id&quot;</code>.<br>  • Sets anchor text to caption.<br>  • Appends anchor to <code>&lt;li&gt;</code>, then <code>&lt;li&gt;</code> to <code>&lt;ul&gt;</code>.<br>- Ensures TOC reflects all tables in order defined by <code>labels.json</code>. </td></tr><tr><td data-label="Section"> <strong>Existing TOC Replacement</strong> </td><td data-label="Technical Breakdown"> - Searches for existing TOC using <code>soup.find(id=&quot;toc&quot;)</code>.<br>- If found, replaces it with newly generated <code>&lt;ul&gt;</code> via <code>replace_with</code>.<br>- Else inserts TOC at beginning of <code>&lt;body&gt;</code> if <code>&lt;body&gt;</code> exists. </td></tr><tr><td data-label="Section"> <strong>HTML Output Writing</strong> </td><td data-label="Technical Breakdown"> - Serializes <code>soup</code> to string using <code>str(soup)</code>.<br>- Writes modified content back to <code>html_path</code> using UTF-8 encoding.<br>- In-place update ensures file reflects current captions and TOC. </td></tr><tr><td data-label="Section"> <strong>Logging & Feedback</strong> </td><td data-label="Technical Breakdown"> - Uses <code>print</code> to report:<br>  • Missing HTML or labels files.<br>  • Successful TOC and caption application.<br>- Provides lightweight user feedback; can be replaced with proper logging in production. </td></tr><tr><td data-label="Section"> <strong>Idempotency / Safe Re-runs</strong> </td><td data-label="Technical Breakdown"> - Checks for existing captions to prevent duplicates.<br>- Running multiple times does not add multiple <code>&lt;caption&gt;</code> tags.<br>- Replaces existing TOC, maintaining a single authoritative TOC element. </td></tr><tr><td data-label="Section"> <strong>Robustness / Error Handling</strong> </td><td data-label="Technical Breakdown"> - Skips tables not present in HTML; no exception raised.<br>- TOC insertion is conditional on <code>&lt;body&gt;</code> presence.<br>- Missing files logged and processing halted gracefully.<br>- UTF-8 encoding assumed; malformed HTML may affect BeautifulSoup parsing. </td></tr><tr><td data-label="Section"> <strong>Performance Considerations</strong> </td><td data-label="Technical Breakdown"> - Single-pass iteration over captions for both caption insertion and TOC generation.<br>- Efficient for moderate HTML file sizes; large documents may have increased parse time.<br>- Minimal memory footprint; uses streaming reads only via <code>Path.read_text()</code>. </td></tr><tr><td data-label="Section"> <strong>Usage Scenarios</strong> </td><td data-label="Technical Breakdown"> - Post-processing for HTML reports generated by notebooks, Pandoc, or static site generators.<br>- Automation of table captions for technical documentation.<br>- Creation of navigable TOC for lengthy HTML content containing multiple tables. </td></tr><tr><td data-label="Section"> <strong>Best Practices</strong> </td><td data-label="Technical Breakdown"> - Ensure all tables have unique <code>id</code> attributes corresponding to <code>labels.json</code>.<br>- Keep <code>labels.json</code> up-to-date with current HTML tables.<br>- Backup HTML files before running function in production pipelines.<br>- Optionally integrate with CI/CD to auto-generate TOC on build. </td></tr><tr><td data-label="Section"> <strong>Security Considerations</strong> </td><td data-label="Technical Breakdown"> - Only modifies DOM elements; does not execute JavaScript.<br>- Input JSON should be trusted to avoid malicious injection of HTML attributes.<br>- Avoid untrusted HTML or JSON inputs in production. </td></tr><tr><td data-label="Section"> <strong>Extensibility</strong> </td><td data-label="Technical Breakdown"> - Could support nested TOC (multi-level <code>&lt;ul&gt;</code> for sub-tables).<br>- Could style TOC or captions dynamically via additional class attributes.<br>- Can extend to handle tables without IDs by auto-generating IDs. </td></tr><tr><td data-label="Section"> <strong>Limitations</strong> </td><td data-label="Technical Breakdown"> - Overwrites HTML file in-place; no rollback mechanism.<br>- Does not support tables without <code>id</code> attributes.<br>- Assumes UTF-8 encoded HTML and JSON.<br>- TOC outside <code>&lt;body&gt;</code> is ignored.<br>- No concurrency or multi-thread support. </td></tr><tr><td data-label="Section"> <strong>Integration Points</strong> </td><td data-label="Technical Breakdown"> - Callable from build scripts or post-processing pipelines.<br>- Can be integrated into static site generation workflows.<br>- Suitable for automated documentation generation tools. </td></tr><tr><td data-label="Section"> <strong>Maintenance / Future Improvements</strong> </td><td data-label="Technical Breakdown"> - Add optional logging module with verbosity levels.<br>- Introduce error handling for invalid HTML or malformed JSON.<br>- Support for alternative HTML parsers for performance.<br>- Option to insert TOC at custom location in the document. </td></tr><tr><td data-label="Section"> <strong>Operational Notes</strong> </td><td data-label="Technical Breakdown"> - Recommended to run after all HTML generation is complete.<br>- Verify unique table IDs to avoid collisions.<br>- Validate that <code>labels.json</code> covers all intended tables.<br>- Confirm successful insertion by visually inspecting HTML. </td></tr><tr><td data-label="Section"> <strong>Testing Recommendations</strong> </td><td data-label="Technical Breakdown"> - Unit test with HTML containing multiple tables, some with existing captions.<br>- Test behavior with missing labels or HTML files.<br>- Validate idempotency by running function twice and checking for duplicates.<br>- Test TOC insertion in <code>&lt;body&gt;</code> absent scenario. </td></tr><tr><td data-label="Section"> <strong>Performance Tips</strong> </td><td data-label="Technical Breakdown"> - For large HTML files, consider streaming parsing techniques if performance is critical.<br>- Minimize re-parsing the HTML multiple times; reuse <code>soup</code> object. </td></tr><tr><td data-label="Section"> <strong>Operational Guarantees</strong> </td><td data-label="Technical Breakdown"> - Guarantees insertion of captions where table IDs match labels.<br>- Guarantees a single TOC element exists at <code>&lt;body&gt;</code> start.<br>- Does not remove unrelated DOM elements. </td></tr><tr><td data-label="Section"> <strong>Error / Edge Cases</strong> </td><td data-label="Technical Breakdown"> - HTML file missing → logs and returns.<br>- Labels file missing → logs and returns.<br>- Table ID missing in HTML → skipped silently.<br>- <code>&lt;body&gt;</code> missing → TOC not inserted. </td></tr><tr><td data-label="Section"> <strong>Idempotency Strategy</strong> </td><td data-label="Technical Breakdown"> - Checks existing caption text to avoid duplication.<br>- Replaces TOC rather than appending; ensures a single authoritative TOC.<br>- Safe to run multiple times. </td></tr><tr><td data-label="Section"> <strong>Output Characteristics</strong> </td><td data-label="Technical Breakdown"> - Modified HTML contains:<br>  • Captions for each labeled table.<br>  • Ordered <code>&lt;ul&gt;</code> TOC linking to table IDs.<br>- UTF-8 encoded output. </td></tr><tr><td data-label="Section"> <strong>Integration / Automation</strong> </td><td data-label="Technical Breakdown"> - Can be run as part of post-processing script in build pipelines.<br>- Useful for generating static documentation with consistent navigation.<br>- Works in automated CI/CD environments. </td></tr><tr><td data-label="Section"> <strong>Documentation Strategy</strong> </td><td data-label="Technical Breakdown"> - Encourage commenting HTML where tables are generated.<br>- Maintain <code>labels.json</code> with clear mapping of table IDs to captions.<br>- Use consistent ID naming conventions. </td></tr><tr><td data-label="Section"> <strong>Maintenance Strategy</strong> </td><td data-label="Technical Breakdown"> - Update captions and TOC after HTML structure changes.<br>- Regularly validate that all table IDs in <code>labels.json</code> exist in HTML.<br>- Backup prior versions before automated updates. </td></tr><tr><td data-label="Section"> <strong>Logging & Debugging</strong> </td><td data-label="Technical Breakdown"> - Current implementation prints messages; for production, replace with logging module.<br>- Verify output by inspecting HTML structure and TOC element. </td></tr><tr><td data-label="Section"> <strong>Security Notes</strong> </td><td data-label="Technical Breakdown"> - Avoid using untrusted HTML or JSON inputs.<br>- Ensure no script injection through captions or table IDs. </td></tr><tr><td data-label="Section"> <strong>Performance Notes</strong> </td><td data-label="Technical Breakdown"> - Full DOM parsing with BeautifulSoup may be slower on very large files.<br>- Avoid repeated reads/writes for performance-critical pipelines. </td></tr><tr><td data-label="Section"> <strong>Extensibility / Customization</strong> </td><td data-label="Technical Breakdown"> - Allow CSS class customization for captions.<br>- Support multiple TOC insertion points.<br>- Extend for other HTML elements like figures or images. </td></tr><tr><td data-label="Section"> <strong>Operational Recommendations</strong> </td><td data-label="Technical Breakdown"> - Keep <code>labels.json</code> synchronized with table IDs.<br>- Run after all HTML content generation to avoid missing tables.<br>- Integrate into documentation build pipelines. </td></tr><tr><td data-label="Section"> <strong>Future Enhancements</strong> </td><td data-label="Technical Breakdown"> - Add optional logging level parameter.<br>- Support nested TOC for subsections.<br>- Handle tables missing <code>id</code> by generating unique IDs dynamically.<br>- Add undo or backup capability for HTML files. </td></tr><tr><td data-label="Section"> <strong>Unit Test Ideas</strong> </td><td data-label="Technical Breakdown"> - HTML with existing captions.<br>- HTML missing <code>&lt;body&gt;</code> element.<br>- Empty or missing <code>labels.json</code>.<br>- Duplicate table IDs.<br>- Large HTML with multiple tables and captions. </td></tr><tr><td data-label="Section"> <strong>Failure Modes</strong> </td><td data-label="Technical Breakdown"> - HTML file not found → logged and function returns.<br>- Labels file not found → logged and function returns.<br>- Table ID not present → skipped.<br>- <code>&lt;body&gt;</code> absent → TOC not inserted. </td></tr><tr><td data-label="Section"> <strong>Reviewer Checklist</strong> </td><td data-label="Technical Breakdown"> 1. Confirm unique table IDs match <code>labels.json</code>.<br>2. Check idempotency by running twice.<br>3. Verify <code>&lt;ul id=&quot;toc&quot;&gt;</code> insertion at correct location.<br>4. Validate captions correctly inserted above tables.<br>5. Confirm UTF-8 encoding for output. </td></tr><tr><td data-label="Section"> <strong>Summary</strong> </td><td data-label="Technical Breakdown"> <code>toc_manager.py</code> offers safe, automated caption insertion and TOC generation, suitable for static HTML documentation workflows. It is idempotent, lightweight, and easily integrated into pipelines while maintaining readability and navigability of HTML content. </td></tr></tbody></table></div><div class="row-count">Rows: 42</div></div><div class="table-caption" id="Table17" data-table="Book_8043_17" style="margin-top:2mm;margin-left:3mm;"><strong>Table 17 — types.py</strong></div>
<div class="table-wrapper" data-table-id="table-17"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Technical Breakdown**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section"> <strong>Module Purpose</strong> </td><td data-label="Technical Breakdown"> The <code>render/types.py</code> module centralizes type definitions, configuration structures, and default behaviors for the rendering system. It is designed to ensure consistent usage of configuration objects, type hints, and aliases across the rendering pipeline. By defining <code>RenderConfig</code> and general type aliases, it allows all downstream modules to rely on well-typed inputs and outputs, which reduces runtime errors, improves IDE auto-completion, and ensures maintainability. The module intentionally avoids performing any I/O or side effects, making it safe to import anywhere in the project. </td></tr><tr><td data-label="Section"> <strong>General Aliases: RenderResult</strong> </td><td data-label="Technical Breakdown"> <code>RenderResult</code> is defined as <code>Dict[str, Any]</code>. It standardizes the expected output from render operations. Keys typically include <code>html</code>, <code>metadata</code>, <code>tables</code>, or <code>errors</code>. This allows functions to return a predictable dictionary structure while remaining flexible to store additional auxiliary data. Downstream modules can rely on type hints to validate or inspect content programmatically. Example usage:<br>``<code>python&lt;br&gt;result: RenderResult = {&quot;html&quot;: &quot;&lt;table&gt;...&lt;/table&gt;&quot;, &quot;metadata&quot;: {&quot;rows&quot;: 10}}&lt;br&gt;</code>``<br>- Ensures consistent result handling across renderers. </td></tr><tr><td data-label="Section"> <strong>General Aliases: TableLike</strong> </td><td data-label="Technical Breakdown"> <code>TableLike</code> is a placeholder for any object that can be interpreted as a table. This includes pandas DataFrames, lists of lists, NumPy arrays, or custom table-like objects. Using a broad <code>Any</code> type allows the rendering system to accept diverse input sources while still communicating intent through alias naming. Example:<br>``<code>python&lt;br&gt;def render_table(tbl: TableLike) -&gt; RenderResult:&lt;br&gt;    ...&lt;br&gt;</code>``<br>- Improves readability and static analysis while supporting flexible inputs. </td></tr><tr><td data-label="Section"> <strong>Imports & Dependencies</strong> </td><td data-label="Technical Breakdown"> - <code>logging</code>: Provides the default logging levels and framework; critical for consistent debug, info, warning, and error reporting.<br>- <code>dataclasses.dataclass</code>: Enables concise definition of <code>RenderConfig</code> with automatic <code>__init__</code>, <code>__repr__</code>, and equality comparison. Simplifies default value handling.<br>- <code>pathlib.Path</code>: Cross-platform path abstraction; ensures that all file and directory paths are handled safely and consistently.<br>- <code>typing.Optional</code>, <code>Callable</code>, <code>Any</code>, <code>Dict</code>: Supports type annotations for better linting, static type checks, and IDE tooling.<br>- <code>threading.Event</code>: Supports cancelable operations for long-running table rendering tasks; allows graceful shutdown or user interruptions. </td></tr><tr><td data-label="Section"> <strong>RenderConfig Dataclass</strong> </td><td data-label="Technical Breakdown"> <code>RenderConfig</code> is the main configuration container for the renderer. It provides default values for logging, asset management, caching, rendering limits, threading, and output options. By using a dataclass with type hints, it guarantees consistency and clarity in how render operations consume and mutate configuration state. Fields include both simple types (int, bool) and complex types (Optional[Path], Callable, Event). The dataclass design also allows easy extension without breaking existing pipelines. </td></tr><tr><td data-label="Section"> <strong>Logging Configuration</strong> </td><td data-label="Technical Breakdown"> <code>log_level: int = logging.INFO</code> — establishes a default logging verbosity.<br>- Users can override this with <code>DEBUG</code> for development or <code>WARNING</code>/<code>ERROR</code> for production.<br>- Downstream modules can reference <code>cfg.log_level</code> to configure their own loggers.<br>- Guarantees uniform logging behavior across threads and worker pools. </td></tr><tr><td data-label="Section"> <strong>Asset Management Fields</strong> </td><td data-label="Technical Breakdown"> - <code>assets_dir: Optional[Path | str] = None</code> — explicit output location for assets.<br>- <code>embed_assets: bool = False</code> — controls whether CSS/JS assets are inlined in HTML outputs.<br>- <code>bundle_assets: bool = True</code> — concatenates assets into a single bundle when true; leaves separate otherwise.<br>- Provides flexibility for different deployment strategies: local disk, CDN, or inline HTML. </td></tr><tr><td data-label="Section"> <strong>Caching & Worker Configuration</strong> </td><td data-label="Technical Breakdown"> - <code>cache_size: int = 100</code> — limits number of cached render results to avoid excessive memory usage.<br>- <code>max_workers: int = 4</code> — controls parallelism for table rendering; avoids oversubscription of CPU cores.<br>- <code>table_render_timeout_ms: Optional[int] = 500</code> — per-table timeout ensures that slow or malformed tables do not block the pipeline indefinitely.<br>- These defaults are tuned for mid-size workloads and can be adjusted for larger or smaller datasets. </td></tr><tr><td data-label="Section"> <strong>Table Rendering Limits</strong> </td><td data-label="Technical Breakdown"> - <code>split_threshold: int = 0</code> — defines row count at which large tables should be split; 0 disables splitting.<br>- <code>table_row_limit: int = 0</code> — maximum number of rows to render; truncates tables if necessary. <br>- These safeguards prevent excessive memory usage or excessively large HTML outputs, maintaining predictable performance. </td></tr><tr><td data-label="Section"> <strong>Cancellation & Progress Hooks</strong> </td><td data-label="Technical Breakdown"> - <code>cancel_event: Optional[Event]</code> — allows long-running render operations to be cancelled by setting the event externally.<br>- <code>progress_callback: Optional[Callable[[int, int], None]]</code> — allows the renderer to report progress for UI feedback or logging; receives <code>(processed_rows, total_rows)</code>. <br>- Both features enhance responsiveness for interactive or multi-threaded environments. </td></tr><tr><td data-label="Section"> <strong>Output Options</strong> </td><td data-label="Technical Breakdown"> - <code>gzip_out: bool = False</code> — enables gzip compression of output files or streams. Reduces disk and network usage at the cost of CPU compression time. Typically used for production pipelines that serve HTML or assets over HTTP. </td></tr><tr><td data-label="Section"> <strong>Method: resolved_assets_dir</strong> </td><td data-label="Technical Breakdown"> Provides canonical path resolution for assets directory:<br>1. If <code>assets_dir</code> is provided (str or Path), converts to <code>Path</code> and returns.<br>2. Else returns <code>&lt;out_dir&gt;/assets</code> as default.<br>- Guarantees downstream modules receive a valid <code>Path</code> object.<br>- Avoids repeated conditional logic in renderers. </td></tr><tr><td data-label="Section"> <strong>Behavioral Guarantees of resolved_assets_dir</strong> </td><td data-label="Technical Breakdown"> - Always returns a <code>Path</code> object.<br>- No side effects: directories are not created automatically.<br>- Safe to call multiple times; deterministic output based on <code>assets_dir</code> and <code>out_dir</code>. </td></tr><tr><td data-label="Section"> <strong>Usage Example</strong> </td><td data-label="Technical Breakdown"> ``<code>python&lt;br&gt;cfg = RenderConfig(assets_dir=&quot;build_assets&quot;)&lt;br&gt;final_dir = cfg.resolved_assets_dir(Path(&quot;/tmp/output&quot;))&lt;br&gt;print(final_dir)&lt;br&gt;</code>``<br>- Simplifies downstream rendering code by providing consistent access to the assets path. </td></tr><tr><td data-label="Section"> <strong>Integration Pattern</strong> </td><td data-label="Technical Breakdown"> - Import <code>RenderConfig</code> in main renderer module.<br>- Instantiate with custom parameters or use defaults.<br>- Pass <code>cfg</code> to all render functions for consistent behavior.<br>- Use <code>resolved_assets_dir</code> to determine where to read/write CSS/JS/assets. </td></tr><tr><td data-label="Section"> <strong>Extensibility Notes</strong> </td><td data-label="Technical Breakdown"> - Additional fields can be added (e.g., template paths, theme configuration) without changing core behavior.<br>- New types or aliases can be introduced for specialized table formats. </td></tr><tr><td data-label="Section"> <strong>Thread Safety & Concurrency</strong> </td><td data-label="Technical Breakdown"> - <code>cancel_event</code> allows multi-threaded operations to exit cleanly.<br>- <code>max_workers</code> enforces parallelism limits to avoid race conditions or resource exhaustion.<br>- Designed for safe operation in both single-threaded and multi-threaded pipelines. </td></tr><tr><td data-label="Section"> <strong>Safety & Security</strong> </td><td data-label="Technical Breakdown"> - No I/O performed on import; module is safe to load anywhere.<br>- All path operations are deferred; downstream code handles creation.<br>- Type hints prevent accidental misuse of configuration fields. </td></tr><tr><td data-label="Section"> <strong>Documentation & Readability</strong> </td><td data-label="Technical Breakdown"> - Docstrings describe purpose, arguments, and return values for <code>RenderConfig</code> and methods.<br>- Type hints enable static analysis, improving code quality.<br>- Defaults provide sensible production-ready behavior without further configuration. </td></tr><tr><td data-label="Section"> <strong>Unit Test Recommendations</strong> </td><td data-label="Technical Breakdown"> - Validate that <code>resolved_assets_dir</code> returns correct <code>Path</code> for <code>None</code>, string, and Path input.<br>- Test defaults of all <code>RenderConfig</code> fields.<br>- Ensure <code>cancel_event</code> triggers graceful cancellation.<br>- Confirm <code>RenderResult</code> can store expected keys and content types. </td></tr><tr><td data-label="Section"> <strong>Performance Considerations</strong> </td><td data-label="Technical Breakdown"> - Lightweight dataclass; instantiation is fast.<br>- Path resolution is trivial and non-blocking.<br>- Caching fields prevent unnecessary re-rendering.<br>- Threaded workers respect CPU limits to avoid oversubscription. </td></tr><tr><td data-label="Section"> <strong>Recommended Pipeline Usage</strong> </td><td data-label="Technical Breakdown"> 1. Create <code>RenderConfig</code> with optional overrides.<br>2. Resolve assets directory at pipeline start.<br>3. Configure logging according to <code>log_level</code>.<br>4. Provide <code>cancel_event</code> and <code>progress_callback</code> in long-running renders.<br>5. Respect <code>cache_size</code> and <code>table_row_limit</code> to avoid memory spikes. </td></tr><tr><td data-label="Section"> <strong>Extensibility / Future-Proofing</strong> </td><td data-label="Technical Breakdown"> - Supports additional rendering output formats (HTML, PDF, CSV).<br>- Easily integrates with new table types or external rendering engines.<br>- Field defaults allow safe upgrades without breaking downstream code. </td></tr><tr><td data-label="Section"> <strong>Final Summary</strong> </td><td data-label="Technical Breakdown"> <code>types.py</code> serves as the backbone for configuration and type safety in the rendering system. It provides consistent defaults, flexible asset handling, and threading support, ensuring that the entire pipeline behaves predictably and is easy to maintain. Downstream modules benefit from typed interfaces, clear defaults, and safe path resolution, forming the foundation of a world-class, production-ready rendering framework. </td></tr></tbody></table></div><div class="row-count">Rows: 24</div></div><div class="table-caption" id="Table18" data-table="Book_8043_18" style="margin-top:2mm;margin-left:3mm;"><strong>Table 18 — style.css</strong></div>
<div class="table-wrapper" data-table-id="table-18"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Section / Selector**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Section / Selector</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th><th class="tv-col" role="button" aria-label="Sort by **Technical Breakdown &amp; Notes**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown & Notes</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Section / Selector"> <code>:root { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Defines CSS custom properties (variables) for colors, typography, spacing, transitions, code styles, and responsive helpers. Variables enable theme management (light/dark/high-contrast) and consistent reuse across multiple selectors. Key variables include <code>--bg</code>, <code>--text</code>, <code>--panel</code>, <code>--border</code>, <code>--row-hover</code>, <code>--highlight</code>, <code>--current-row</code> for table theming, and <code>--button-bg</code>, <code>--button-text</code> for consistent button styling. Motion and transition variables (<code>--trans-duration</code>, <code>--easing</code>) allow unified animation adjustments. <code>--font-sans</code> and <code>--font-mono</code> support readable and monospace typography. Accessibility and measurement variables (<code>--focus-ring</code>, <code>--focus-bg</code>, <code>--measure</code>) improve legibility and interaction feedback. </td></tr><tr><td data-label="Section / Selector"> <code>@media (prefers-contrast: more)</code> </td><td data-label="Technical Breakdown &amp; Notes"> High contrast additive mode. Overrides base colors to enhance visibility. Borders, text, button backgrounds, and TOC links are adjusted to higher contrast values to meet accessibility standards. Muted text darkened for legibility. Focus-ring opacity increased to emphasize keyboard navigation. </td></tr><tr><td data-label="Section / Selector"> <code>@media (prefers-color-scheme: dark)</code> </td><td data-label="Technical Breakdown &amp; Notes"> Dark mode overrides for all major colors including background, panel, text, borders, row hover, highlight, buttons, TOC links, and code blocks. Ensures high contrast and readability in low-light environments. Dark theme variables are separate from explicit <code>data-theme=&quot;dark&quot;</code> to allow dynamic theme switching. </td></tr><tr><td data-label="Section / Selector"> <code>[data-theme=&quot;dark&quot;] { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Explicit dark mode override for users or scripts applying <code>data-theme=&quot;dark&quot;</code>. Mirrors prefers-color-scheme dark values. Ensures consistent rendering even if the system does not signal dark preference. </td></tr><tr><td data-label="Section / Selector"> <code>*, *::before, *::after { box-sizing: border-box; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Global normalization of box-sizing. Prevents unexpected sizing when padding and borders are applied. Essential for tables, buttons, containers, and responsive elements. </td></tr><tr><td data-label="Section / Selector"> <code>html, body { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sets global layout, typography, and base responsive scaling. Uses <code>clamp()</code> for fluid font sizing (<code>15px</code> min, <code>16px</code> max) with a viewport relative unit for scalability. Line-height, text rendering, and font smoothing optimized for readability. Transitions added for background and color to support smooth theme changes. </td></tr><tr><td data-label="Section / Selector"> <code>a { color: inherit; text-decoration: none; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Neutral link styling to inherit text color and remove default underlines. Transition added for hover effects when needed. Later overridden for content-specific links. </td></tr><tr><td data-label="Section / Selector"> <code>img, video, svg { max-width: 100%; height: auto; display: block; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Responsive media handling. Prevents overflow in containers and maintains aspect ratio. </td></tr><tr><td data-label="Section / Selector"> <code>code, pre, kbd { font-family: var(--font-mono); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Enforces monospace font for code-related elements for consistent alignment and readability. </td></tr><tr><td data-label="Section / Selector"> <code>button { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Base button styling with background, border, color, padding, border-radius, and hover/active states. Transforms and box-shadow used for tactile feedback. <code>will-change: transform</code> hints for GPU acceleration. Focus-visible support with outline and background for keyboard users. </td></tr><tr><td data-label="Section / Selector"> <code>.table-container { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Horizontal scroll container for tables. Supports mobile touch scrolling via <code>-webkit-overflow-scrolling: touch</code>. Rounded corners applied. Ensures tables remain responsive without breaking layout. </td></tr><tr><td data-label="Section / Selector"> <code>table { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Base table styling. Fixed table-layout, word-wrap, and min-width enforced for responsiveness. Collapsed borders and consistent font stack ensure visual uniformity. <code>font-size</code> set to 15px with <code>min-width</code> fallback. </td></tr><tr><td data-label="Section / Selector"> <code>thead th, th { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sticky header styling with padding, alignment, background, font weight, and z-index. <code>scroll-margin-top</code> ensures anchor navigation does not hide headers. Position sticky enables persistence while scrolling. </td></tr><tr><td data-label="Section / Selector"> <code>tbody td, td { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Table cell styling. Breaks long words and wraps text for readability. Vertical alignment ensures consistency with variable content heights. </td></tr><tr><td data-label="Section / Selector"> <code>table strong, table b { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Emphasized text in tables uses slightly heavier font-weight and subtle letter-spacing adjustment for readability. </td></tr><tr><td data-label="Section / Selector"> <code>tr:nth-child(even) { background: var(--bg); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Alternating row color for visual distinction. </td></tr><tr><td data-label="Section / Selector"> <code>tr:hover td { background: var(--row-hover); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Hover state highlighting. Improves row selection visibility. </td></tr><tr><td data-label="Section / Selector"> <code>.highlight { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Temporary highlighting for dynamic row interactions, e.g., search results. </td></tr><tr><td data-label="Section / Selector"> <code>.current-row td { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Persistent row highlighting, often used for active selection or focus tracking. </td></tr><tr><td data-label="Section / Selector"> <code>thead th:first-child, td:first-child { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sticky first column. Maintains visibility while horizontally scrolling. <code>z-index</code> ensures stacking above other cells. Box-shadow for subtle separation. Min-width ensures content readability. </td></tr><tr><td data-label="Section / Selector"> <code>.sort-btn { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sorting button for table headers. Flex layout with gap, subtle opacity when inactive, transitions for hover and focus. Supports accessibility via focus-visible outlines. </td></tr><tr><td data-label="Section / Selector"> <code>#stickyMainHeader { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sticky page header with shadow and background transitions. Flex layout supports multiple child elements and spacing. Optimized for both desktop and mobile. </td></tr><tr><td data-label="Section / Selector"> <code>#tv-header { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Top-level header container with flexible layout. Supports responsive wrapping and alignment for logo, buttons, and inputs. <code>gap</code> ensures consistent spacing. </td></tr><tr><td data-label="Section / Selector"> <code>#tv-header button, #tv-header .btn, #stickyMainHeader button { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Smaller buttons in header area. Compact sizing for mobile compatibility. Min-height/width ensures touch-friendly targets. </td></tr><tr><td data-label="Section / Selector"> <code>#tv-header input[type=&quot;search&quot;], #tv-header input[type=&quot;text&quot;], ...</code> </td><td data-label="Technical Breakdown &amp; Notes"> Flexible input fields in headers. <code>flex: 1 1</code> allows scaling. Min-width ensures usability on small screens. Transitions for focus highlight. </td></tr><tr><td data-label="Section / Selector"> <code>#tocBar { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Table of contents bar. Horizontal scrolling for overflow. Flex layout with gap for individual link items. Hover background and color transitions for user feedback. </td></tr><tr><td data-label="Section / Selector"> <code>.th-with-sort, thead th[role=&quot;button&quot;] { cursor: pointer; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Explicit pointer cursor for interactive header cells. Improves affordance. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper .table-header-wrapper { gap: 8px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Header wrapper inside table container ensures spacing between controls and labels. </td></tr><tr><td data-label="Section / Selector"> <code>.table-controls { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Flexible container for all table control buttons, links, and toggle elements. Supports wrapping and consistent alignment across varying table markup. </td></tr><tr><td data-label="Section / Selector"> <code>.table-controls a, .table-controls button, ...</code> </td><td data-label="Technical Breakdown &amp; Notes"> Unified button styling across <code>&lt;a&gt;</code>, <code>&lt;button&gt;</code>, <code>&lt;summary&gt;</code>, and custom elements. Ensures visual consistency, padding, and alignment. Transitions applied for hover and focus. </td></tr><tr><td data-label="Section / Selector"> <code>.table-controls summary { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Removes default details marker and enforces consistent padding, cursor, and list-style removal. </td></tr><tr><td data-label="Section / Selector"> <code>.table-controls .toggle-table-btn { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Table collapse toggle with transform for rotation upon collapse. Transitions ensure smooth animation. Responsive overrides reduce padding and enforce icon-only display on mobile. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper.table-collapsed .table-container table tbody { display: none; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Hides table body when collapsed. Complementary to toggle button rotation. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-buttons { display:flex; gap:8px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Layout for copy/export buttons. Ensures proper spacing and alignment with tables. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-button-output pre, .copy-button-table pre { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Preformatted output styling. Ensures monospace rendering, scrollable overflow, and proper padding for copied content. </td></tr><tr><td data-label="Section / Selector"> <code>.table-caption { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Caption styling for accessibility and print-friendliness. Fallback margin ensures consistent spacing. Strong tags inherit font weight to prevent over-emphasis. </td></tr><tr><td data-label="Section / Selector"> <code>td[data-col-type=&quot;numeric&quot;], th[data-col-type=&quot;numeric&quot;] { text-align: right; font-variant-numeric: tabular-nums; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Numeric column alignment and tabular number variant for precise layout. </td></tr><tr><td data-label="Section / Selector"> <code>td[data-col-type=&quot;code&quot;], th[data-col-type=&quot;code&quot;] { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Code columns enforce monospace font, nowrap, and slightly reduced font-size. Ensures code readability. </td></tr><tr><td data-label="Section / Selector"> <code>td[data-col-type=&quot;date&quot;], th[data-col-type=&quot;date&quot;] { text-align: center; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Center-aligns date columns. Improves readability and consistency. </td></tr><tr><td data-label="Section / Selector"> <code>@media (prefers-reduced-motion: reduce) { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Reduces motion and disables transitions/animations for users with accessibility preferences. Applies to buttons, hover effects, and global animations. </td></tr><tr><td data-label="Section / Selector"> <code>#backToTop { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Back-to-top floating button. Positioned fixed with transition on hover for smooth visual feedback. Hidden by default; displayed via JS when needed. </td></tr><tr><td data-label="Section / Selector"> <code>td ul, td ol { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Styling for lists within table cells. Removes native bullets, adds custom markers (<code>–</code> or numeric counters), supports nested lists with adjusted margin/padding and smaller bullets for readability. </td></tr><tr><td data-label="Section / Selector"> <code>code, pre code, td code { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Comprehensive code styling. Background color varies by context (inline vs table). Preformatted code uses block display, padding, and scrollable overflow. Dark mode overrides ensure contrast. </td></tr><tr><td data-label="Section / Selector"> <code>kbd { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Keyboard input representation. Consistent monospace font, background, border, padding, and subtle inset shadow. Dark mode adapts background and border opacity. </td></tr><tr><td data-label="Section / Selector"> <code>sup, sub { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Superscript and subscript styling. Adjusted font-size and vertical alignment. </td></tr><tr><td data-label="Section / Selector"> <code>.small, .footnote { font-size: .85em; color: var(--muted); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Auxiliary text styling for footnotes and minor labels. </td></tr><tr><td data-label="Section / Selector"> <code>a { color: var(--accent); text-decoration: underline; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Stronger link affordance for readable content, differentiating links in markdown and content areas. Hover states underline for interaction feedback. </td></tr><tr><td data-label="Section / Selector"> <code>thead th a, th a { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Neutralizes anchor styles inside table headers. Prevents default focus outline, tap highlight, background, and box-shadow. Maintains inherited color for header readability. </td></tr><tr><td data-label="Section / Selector"> <code>::selection { background: rgba(37,99,235,0.25); color: var(--text); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Custom text selection color. Maintains readability and accessibility. </td></tr><tr><td data-label="Section / Selector"> <code>.emoji { font-family: var(--emoji-fonts); font-size: 1em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Emoji fallback fonts to ensure consistent display across platforms. </td></tr><tr><td data-label="Section / Selector"> <code>.markdown, .content, p, li, td { hyphens: auto; word-break: break-word; overflow-wrap: anywhere; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Handles long words and hyphenation, improves multi-language support and prevents layout overflow. </td></tr><tr><td data-label="Section / Selector"> <code>.katex, .MathJax { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Math rendering support with display block for block math, inline adjustments, scrollable overflow, and centered alignment. </td></tr><tr><td data-label="Section / Selector"> <code>.table-heading-bar, .table-heading { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Styling for table headings outside of <code>&lt;thead&gt;</code>. Includes background, padding, font-weight, alignment, and sticky behavior. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper .collapse-indicator { transition: transform var(--trans-duration) var(--easing); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Rotating indicator for collapsed tables. Smooth transform animation. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper .cell-highlight { background: var(--highlight); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Cell-specific highlight for search or selection. </td></tr><tr><td data-label="Section / Selector"> <code>@media (max-width: 900px) { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Responsive adjustments for smaller screens. Font-size reduction, padding reduction, table controls stacked vertically, icon-only enforcement. Sticky headers adapt. </td></tr><tr><td data-label="Section / Selector"> <code>@media (max-width: 600px) { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Stronger responsive enforcement. Hide less-important header elements, table caption adjustments, minimal padding on buttons, enforce icon-only toggle. </td></tr><tr><td data-label="Section / Selector"> <code>@media (max-width: 420px) { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Ultra-small screens. Horizontal scroll for table controls, hide non-essential elements, force mobile-friendly layout. </td></tr><tr><td data-label="Section / Selector"> <code>@media print { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Print optimizations. Light theme enforced, sticky headers disabled, first-column sticky removed, table borders and background solid for clarity. Pre/code wraps preserved. </td></tr><tr><td data-label="Section / Selector"> <code>.visually-hidden, .sr-only { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Accessibility helpers. Hidden from layout but readable by screen readers. </td></tr><tr><td data-label="Section / Selector"> <code>.content, .chat, article, #mainContent { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Chat/markdown content container styling. Max-width via <code>--measure</code>, margin auto, hyphens auto, line-height 1.5 for readability. Supports text blocks, lists, tables. </td></tr><tr><td data-label="Section / Selector"> <code>h1,h2,h3,h4,h5,h6 { scroll-margin-top: 6rem; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Anchor scrolling adjustment for sticky headers. Ensures headings not obscured. </td></tr><tr><td data-label="Section / Selector"> <code>blockquote { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Blockquote styling with left border, background color, padding, and italic font style for visual distinction. </td></tr><tr><td data-label="Section / Selector"> <code>pre { white-space: pre; overflow-x: auto; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Preformatted blocks scrollable horizontally. Preserves whitespace and code layout. </td></tr><tr><td data-label="Section / Selector"> <code>strong { font-weight: 600; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Unified strong emphasis across content. </td></tr><tr><td data-label="Section / Selector"> <code>table tr td code, table tr th code { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Code inside tables inherits font, background, padding, border-radius, scrollable overflow. Dark mode adjusted for contrast. </td></tr><tr><td data-label="Section / Selector"> <code>a:focus-visible, button:focus-visible, input:focus-visible { outline: 2px solid var(--focus-ring); outline-offset: 2px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Accessibility: keyboard focus indicator for all interactive elements. </td></tr><tr><td data-label="Section / Selector"> <code>.toggle-table-btn svg { width: 1em; height: 1em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Icon sizing enforcement for toggle buttons, scales with font-size. </td></tr><tr><td data-label="Section / Selector"> <code>.table-controls .btn-icon-only { width: 36px; height: 36px; min-width:36px; min-height:36px; padding:0; display:flex; justify-content:center; align-items:center; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Mobile optimization: enforce square icon-only buttons. Prevents accidental text overflow. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper.table-collapsed tbody { display: none; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Body hidden when collapsed. Maintains DOM for accessibility and screen readers. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-buttons button.copy-btn { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Copy buttons styled to match main button theme. Hover, focus, and active states match UI. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-button-output pre { max-height: 400px; overflow-y: auto; padding: 8px; background: var(--panel); border-radius: 4px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Limits height for long copied blocks. Scrollable overflow ensures layout stability. </td></tr><tr><td data-label="Section / Selector"> <code>.content pre code, .table-container pre code { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Fenced code blocks styled for readability, with background, padding, border-radius, tabular numbers. </td></tr><tr><td data-label="Section / Selector"> <code>.th-with-sort .sort-icon { width: 1em; height: 1em; vertical-align: middle; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sorting icon sizing and alignment with text. Ensures consistent table header alignment. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody tr td:first-child, th:first-child { position: sticky; left:0; z-index: 2; background: var(--panel); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sticky first column for better horizontal navigation. Ensures content visibility while scrolling horizontally. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody tr:hover td:first-child { box-shadow: inset -2px 0 0 rgba(0,0,0,0.1); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Subtle shadow for sticky first column on hover for depth cue. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td ul, .table-wrapper table tbody td ol { padding-left: 16px; margin:0; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Inner cell list padding to maintain readability. Nested lists increase padding by 8px. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td ol li::marker { content: counter(li) &quot;. &quot;; font-weight: 500; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Numbered list inside table cell uses CSS counters for semantic numbering. Supports multi-line list items. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td ul li::before { content: &quot;– &quot;; font-weight: 500; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Custom bullet for unordered lists inside table cells. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td code { font-family: var(--font-mono); background: rgba(220,220,220,0.2); padding: 1px 4px; border-radius:2px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Inline code inside table cells visually distinct from surrounding text. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td pre code { display:block; padding:8px; background: var(--panel); border-radius:4px; overflow-x:auto; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Block code inside table cells scrollable and visually separated. </td></tr><tr><td data-label="Section / Selector"> <code>.table-caption { font-weight: 600; font-size:0.95em; margin-top:0.5em; margin-bottom:0.5em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Table captions styled for prominence without overpowering table content. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper .collapse-indicator { transition: transform 0.2s ease-in-out; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Rotating indicator animation smooth. Ensures user sees collapse state. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper .cell-highlight { background: var(--highlight); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Cell-level highlight for search or selection. Can be animated for transient attention cues. </td></tr><tr><td data-label="Section / Selector"> <code>.content .footnote { font-size:0.85em; color:var(--muted); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Footnotes rendered smaller with muted color for distinction without distraction. </td></tr><tr><td data-label="Section / Selector"> <code>@media print { body { background: #fff; color: #000; } table { border-collapse: collapse; } thead th { position: static; } th, td { border:1px solid #000; } pre, code { white-space: pre-wrap; word-wrap: break-word; } }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Print mode ensures all content visible, sticky headers disabled, borders reinforced for clarity. Pre/code blocks wrap to avoid overflow. </td></tr><tr><td data-label="Section / Selector"> <code>*::selection { background: rgba(37,99,235,0.25); color: var(--text); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Selection highlight consistent across browsers. </td></tr><tr><td data-label="Section / Selector"> <code>.emoji { font-family: &quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;,sans-serif; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Emoji fallback stack ensures cross-platform consistency. </td></tr><tr><td data-label="Section / Selector"> <code>.content, .chat, #mainContent article { max-width: var(--measure); margin:auto; hyphens:auto; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Centralizes main content, limits line width for readability, supports responsive typography and wrapping. </td></tr><tr><td data-label="Section / Selector"> <code>.chat p, .chat li, .chat td { line-height:1.5; margin-bottom:0.5em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Chat text spacing optimized for reading, avoiding cramped layout. </td></tr><tr><td data-label="Section / Selector"> <code>h1,h2,h3,h4,h5,h6 { scroll-margin-top:6rem; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sticky header offset ensures anchor scrolling does not obscure headings. </td></tr><tr><td data-label="Section / Selector"> <code>blockquote { padding:8px 16px; border-left:4px solid var(--accent); background: rgba(0,0,0,0.03); font-style:italic; margin:8px 0; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Blockquotes visually distinct. Left border and background cue separation from content. </td></tr><tr><td data-label="Section / Selector"> <code>pre { white-space: pre; overflow-x:auto; padding:8px; background: var(--panel); border-radius:4px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Preformatted blocks scrollable, with padding and background to distinguish code blocks. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td code, .table-wrapper table tbody td pre code { font-size:0.9em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Slightly smaller code in table cells for compact layout. </td></tr><tr><td data-label="Section / Selector"> <code>.th-with-sort .sort-icon { margin-left:4px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Spacing between header text and sort icon improves readability. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody tr:hover td:first-child { box-shadow: inset -2px 0 0 rgba(0,0,0,0.1); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Visual cue for sticky first column during row hover for UX depth. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td ul, ol { margin:0; padding-left:16px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Cell lists are padded and margin reset for consistency. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td ul li::before, ol li::marker { font-weight:500; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Visual differentiation for list markers. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td pre code { overflow-x:auto; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Horizontal scroll ensures no content clipping. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td[data-col-type=&quot;numeric&quot;] { text-align:right; font-variant-numeric:tabular-nums; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Numeric columns aligned for readability and layout precision. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td[data-col-type=&quot;code&quot;] { font-family: var(--font-mono); white-space:nowrap; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Enforces monospace and prevents wrapping for inline code columns. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td[data-col-type=&quot;date&quot;] { text-align:center; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Dates centered for consistency and aesthetic balance. </td></tr><tr><td data-label="Section / Selector"> <code>.table-controls .btn-icon-only { width:36px;height:36px;display:flex;align-items:center;justify-content:center; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Mobile-first design, ensures square touch targets for icon-only buttons. </td></tr><tr><td data-label="Section / Selector"> <code>@media (max-width:420px) { .table-controls a, button, summary { padding:0; min-width:36px; min-height:36px; } }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Enforces minimal touch-friendly dimensions for ultra-small devices. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-buttons { display:flex; gap:8px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Copy/export button container maintains spacing and alignment. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-buttons button.copy-btn { padding:4px 8px; border-radius:4px; background:var(--button-bg); color:var(--button-text); transition: all 0.2s ease-in-out; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Styled to match main buttons. Hover/focus state consistent with theme. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-button-output pre { max-height:400px; overflow-y:auto; background:var(--panel); border-radius:4px; padding:8px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Ensures long code blocks or copied content remain contained and scrollable. </td></tr><tr><td data-label="Section / Selector"> <code>.content pre code, .table-container pre code { background:var(--panel); padding:8px; border-radius:4px; overflow-x:auto; display:block; font-family:var(--font-mono); font-size:0.95em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Code blocks styled consistently, with padding, scroll, and monospace font. </td></tr><tr><td data-label="Section / Selector"> <code>.table-caption { font-weight:600; font-size:0.95em; margin:0.5em 0; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Caption styled to be visually separated but not overpowering. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper .collapse-indicator { transition:transform 0.2s ease-in-out; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Smooth visual cue for collapsed/expanded tables. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper .cell-highlight { background:var(--highlight); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Cell-level highlighting for search or selection. Supports transient animation if needed. </td></tr><tr><td data-label="Section / Selector"> <code>.content .footnote { font-size:0.85em; color:var(--muted); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Footnotes smaller and muted for minimal distraction. </td></tr><tr><td data-label="Section / Selector"> <code>@media print { body { background:#fff;color:#000; } table { border-collapse:collapse; } thead th { position:static; } th, td { border:1px solid #000; } pre, code { white-space:pre-wrap; word-wrap:break-word; } }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Print-friendly overrides: light background, border enforcement, sticky headers disabled, pre/code blocks wrap. </td></tr><tr><td data-label="Section / Selector"> <code>*::selection { background: rgba(37,99,235,0.25); color: var(--text); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Text selection visual feedback consistent across browsers. </td></tr><tr><td data-label="Section / Selector"> <code>.emoji { font-family:&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;,sans-serif; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Cross-platform emoji font stack. </td></tr><tr><td data-label="Section / Selector"> <code>.content, .chat, #mainContent article { max-width: var(--measure); margin:auto; hyphens:auto; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Centered content, readable width, responsive hyphenation. </td></tr><tr><td data-label="Section / Selector"> <code>.chat p, .chat li, .chat td { line-height:1.5; margin-bottom:0.5em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Text spacing optimized for chat and markdown content. </td></tr><tr><td data-label="Section / Selector"> <code>h1,h2,h3,h4,h5,h6 { scroll-margin-top:6rem; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sticky header offset for anchor navigation. </td></tr><tr><td data-label="Section / Selector"> <code>blockquote { padding:8px 16px; border-left:4px solid var(--accent); background: rgba(0,0,0,0.03); font-style:italic; margin:8px 0; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Blockquotes visually distinct, improved readability. </td></tr><tr><td data-label="Section / Selector"> <code>pre { white-space:pre; overflow-x:auto; padding:8px; background:var(--panel); border-radius:4px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Preformatted code blocks scrollable horizontally. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td code, .table-wrapper table tbody td pre code { font-size:0.9em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Slightly smaller code in table cells for compactness. </td></tr><tr><td data-label="Section / Selector"> <code>.th-with-sort .sort-icon { margin-left:4px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sorting icon spacing improves visual separation from header text. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody tr:hover td:first-child { box-shadow: inset -2px 0 0 rgba(0,0,0,0.1); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Depth cue for sticky first column hover. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td ul, ol { margin:0; padding-left:16px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> List padding inside cells ensures proper alignment. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td ul li::before, ol li::marker { font-weight:500; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Visual marker styling for lists inside table cells. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td pre code { overflow-x:auto; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Ensures no code content clipping in table cells. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td[data-col-type=&quot;numeric&quot;] { text-align:right; font-variant-numeric:tabular-nums; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Numeric columns aligned and use tabular numbers. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td[data-col-type=&quot;code&quot;] { font-family:var(--font-mono); white-space:nowrap; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Monospace and no-wrap enforced for code columns. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td[data-col-type=&quot;date&quot;] { text-align:center; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Dates centered for clarity. </td></tr><tr><td data-label="Section / Selector"> <code>.table-controls .btn-icon-only { width:36px;height:36px; display:flex; justify-content:center; align-items:center; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Mobile-friendly square buttons for icon-only controls. </td></tr><tr><td data-label="Section / Selector"> <code>@media (max-width:420px) { .table-controls a, button, summary { padding:0; min-width:36px; min-height:36px; } }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Ultra-small screen enforcement for touch targets. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-buttons { display:flex; gap:8px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Copy/export button container. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-buttons button.copy-btn { padding:4px 8px; border-radius:4px; background:var(--button-bg); color:var(--button-text); transition: all 0.2s ease-in-out; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Buttons visually match main UI. Hover and focus states aligned with theme. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-button-output pre { max-height:400px; overflow-y:auto; background:var(--panel); border-radius:4px; padding:8px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Scrollable container for copied content. </td></tr><tr><td data-label="Section / Selector"> <code>.content pre code, .table-container pre code { background:var(--panel); padding:8px; border-radius:4px; overflow-x:auto; display:block; font-family:var(--font-mono); font-size:0.95em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Block code styling consistent for tables and markdown. </td></tr><tr><td data-label="Section / Selector"> <code>.table-caption { font-weight:600; font-size:0.95em; margin:0.5em 0; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Table caption prominence controlled. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper .collapse-indicator { transition:transform 0.2s ease-in-out; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Smooth rotation indicator for collapsed tables. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper .cell-highlight { background:var(--highlight); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Cell highlight support for search and selection. </td></tr><tr><td data-label="Section / Selector"> <code>.content .footnote { font-size:0.85em; color:var(--muted); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Footnote rendering with muted styling. </td></tr><tr><td data-label="Section / Selector"> <code>@media print { ... }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Print mode enforces light theme, disables sticky positioning, ensures table borders, wraps pre/code content. </td></tr><tr><td data-label="Section / Selector"> <code>*::selection { background: rgba(37,99,235,0.25); color: var(--text); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Selection highlight. </td></tr><tr><td data-label="Section / Selector"> <code>.emoji { font-family:&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;,sans-serif; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Emoji font stack for cross-platform support. </td></tr><tr><td data-label="Section / Selector"> <code>.content, .chat, #mainContent article { max-width: var(--measure); margin:auto; hyphens:auto; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Centralized content with readable line length and hyphenation. </td></tr><tr><td data-label="Section / Selector"> <code>.chat p, .chat li, .chat td { line-height:1.5; margin-bottom:0.5em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Chat and content spacing optimized for readability. </td></tr><tr><td data-label="Section / Selector"> <code>h1,h2,h3,h4,h5,h6 { scroll-margin-top:6rem; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sticky header offset for anchor navigation. </td></tr><tr><td data-label="Section / Selector"> <code>blockquote { padding:8px 16px; border-left:4px solid var(--accent); background: rgba(0,0,0,0.03); font-style:italic; margin:8px 0; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Blockquote visual distinction. </td></tr><tr><td data-label="Section / Selector"> <code>pre { white-space:pre; overflow-x:auto; padding:8px; background:var(--panel); border-radius:4px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Scrollable pre blocks. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td code, .table-wrapper table tbody td pre code { font-size:0.9em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Slightly smaller code in table cells. </td></tr><tr><td data-label="Section / Selector"> <code>.th-with-sort .sort-icon { margin-left:4px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Header icon spacing. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody tr:hover td:first-child { box-shadow: inset -2px 0 0 rgba(0,0,0,0.1); }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Sticky column hover cue. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td ul, ol { margin:0; padding-left:16px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> List padding in cells. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td ul li::before, ol li::marker { font-weight:500; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> List markers in cells styled. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td pre code { overflow-x:auto; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Ensures scrollable code. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td[data-col-type=&quot;numeric&quot;] { text-align:right; font-variant-numeric:tabular-nums; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Numeric alignment. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td[data-col-type=&quot;code&quot;] { font-family:var(--font-mono); white-space:nowrap; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Code column styling. </td></tr><tr><td data-label="Section / Selector"> <code>.table-wrapper table tbody td[data-col-type=&quot;date&quot;] { text-align:center; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Date column centering. </td></tr><tr><td data-label="Section / Selector"> <code>.table-controls .btn-icon-only { width:36px;height:36px; display:flex; justify-content:center; align-items:center; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Icon-only buttons mobile enforcement. </td></tr><tr><td data-label="Section / Selector"> <code>@media (max-width:420px) { .table-controls a, button, summary { padding:0; min-width:36px; min-height:36px; } }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Ultra-small screen touch target adjustment. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-buttons { display:flex; gap:8px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Copy/export buttons container. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-buttons button.copy-btn { padding:4px 8px; border-radius:4px; background:var(--button-bg); color:var(--button-text); transition: all 0.2s ease-in-out; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Copy button style. </td></tr><tr><td data-label="Section / Selector"> <code>.copy-button-output pre { max-height:400px; overflow-y:auto; background:var(--panel); border-radius:4px; padding:8px; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Scrollable copy output. </td></tr><tr><td data-label="Section / Selector"> <code>.content pre code, .table-container pre code { background:var(--panel); padding:8px; border-radius:4px; overflow-x:auto; display:block; font-family:var(--font-mono); font-size:0.95em; }</code> </td><td data-label="Technical Breakdown &amp; Notes"> Consistent code block styling. </td></tr></tbody></table></div><div class="row-count">Rows: 162</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>