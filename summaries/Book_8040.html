<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1761383178">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      // Delegate addEventListener/removeEventListener to visible button
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      // Delegate onclick assignments
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      // Delegate focus/blur
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
      // If legacy code used direct addEventListener earlier than this script, listeners would already exist
      // on alias element; attempt to re-dispatch those by cloning them to visible button is non-trivial.
      // This approach covers the common case where legacy scripts query the alias and bind after DOM ready.
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Book_8040_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th class="tv-col-left" role="button" aria-label="Sort by **Technical Breakdown — `script.core.js` (PasteToTable / Tables Viewer v2.1 Core)**"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Technical Breakdown — <code>script.core.js</code> (PasteToTable / Tables Viewer v2.1 Core)</strong></div><button class="sort-btn sort-state-0" title="Toggle sort" aria-label="Toggle sort"><span class="sort-icon" aria-hidden="true"></span></button></div></th></tr></thead><tbody><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Summary / Purpose</strong><br><br><code>script.core.js</code> is the centralized client-side runtime for PasteToTable + Tables Viewer v2.1. It provides: robust UI handlers (Convert, Clear, Save, Export), safe injection of rendered HTML, lightweight asset/feature detection (extra loader, worker/index URL), a defensive toast/modal UX system, copy/download utilities, and a minimal integration surface so other modules (assets scripts, PTToc, worker.js, server endpoints) can plug in. The file favors non-destructive behavior, progressive enhancement, and maximum runtime resilience across varied hosting environments (local file://, dev server, production).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>High-level guarantees</strong><br><br>• Idempotent event wiring (handlers attached once).<br>• No silent data-loss: server save failures fall back to local download. <br>• Defensive DOM interactions: tolerates missing elements and partial DOM readiness. <br>• Graceful integration: respects existing global handlers (delegation to project hooks) and never clobbers them. <br>• Low-noise production behavior: debug logging gated by <code>window.tvDebug</code>.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Top-level structure & exports</strong><br><br>• IIFE encapsulation — local scope for helpers and state.<br>• Exposes: <code>window.__tv_base</code>, <code>window.tvConfig</code>, <code>window.tvUtils</code> / <code>window.__tv_utils</code>, <code>window.insertHtmlPreserve</code>, <code>window.convertButtonHandler</code> (alias), <code>window.__tv_convert_click</code>, <code>window.__tv_check_convert</code>, <code>window.__tv_init_pttoc_from_core</code>, <code>window.PasteToTable.processRenderedHtml</code>, and common UI helpers (<code>showToast</code>, <code>showCopyModal</code>, <code>downloadBlob</code>, <code>copyToClipboard</code>, <code>sanitizeFileName</code>). These are the stable integration points.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Main responsibilities (concise)</strong><br><br>1. Base path & asset discovery (<code>detectScriptBase</code>, <code>ensureIndexAndWorkerAttrs</code>).<br>2. Extra loader — sequentially attempt candidate <code>extra.js</code> paths (<code>loadExtraSequentially</code>).<br>3. Lightweight CSS injection for TOC & export MD early-hide to reduce flicker.<br>4. Toast & modal UX primitives, copy helpers, file download helper (<code>downloadBlob</code>).<br>5. Safe HTML insertion (<code>insertHtmlPreserve</code>) with attribute whitelist and atomic replace semantics.<br>6. Convert pipeline and delegation (convert button wiring, safe fallback <code>__tv_convert_click_ev</code>).<br>7. Save flow with server attempts + client download fallback (<code>saveHtmlHandler</code>).<br>8. Header button attachment and global data-action dispatcher.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Key functions (detailed)</strong><br><br><strong>detectScriptBase()</strong> — robust algorithm to deduce base URL: uses <code>document.currentScript.src</code> if available; falls back to scanning <code>&lt;script&gt;</code> tags for <code>script.js</code> patterns; final fallback constructs from <code>location.origin + pathname</code>.<br><br><strong>ensureIndexAndWorkerAttrs(base)</strong> — ensures <code>data-index-url</code> and <code>data-worker-url</code> on <code>&lt;body&gt;</code> and sets <code>window.tvIndexUrl</code>/<code>window.tvWorkerUrl</code>. Defers to DOMContentLoaded if <code>document.body</code> missing.<br><br><strong>loadExtraSequentially(candidates, onDone, onAllFailed)</strong> — sequential script injection with per-path retry and graceful fallback; useful for optional feature injection (<code>extra.js</code>).<br><br><strong>insertHtmlPreserve(targetEl, html)</strong> — creates a contextual fragment, strips attributes not in a safe whitelist (<code>id, class, role, title, style, onclick, tabindex, aria-*, data-*</code>), and performs an atomic replace (<code>targetEl.innerHTML = &#x27;&#x27;</code> then append fragment). Best-effort attribute filtering to avoid unwanted inline attributes while preserving necessary hooks. Falls back to direct <code>innerHTML</code> assignment if fragment building fails.<br><br><strong>ensureRowCount(wrapper)</strong> — discovers <code>&lt;table&gt;</code> inside wrapper and updates/creates <code>.row-count</code> element with <code>Rows: N</code> (robust to table structure differences — <code>tBodies</code> vs direct rows).<br><br><strong>processRenderedHtml(responseData)</strong> — canonical pipeline to accept <code>string</code> or <code>{ html, result, body, metadata }</code> payloads. Uses <code>PasteToTable.routeHtmlToAreas</code> if present; otherwise inserts into <code>#tables-viewer</code> via <code>insertHtmlPreserve</code>. Then triggers content init hooks (<code>PasteToTable.initRenderedContent</code>) and TOC init (<code>__tv_init_pttoc_from_core</code> / <code>PTToc.build</code>). Designed to be resilient (multiple retries scheduled) and idempotent. Returns boolean success (true/false).<br><br><strong>convertButtonHandler(ev)</strong> — orchestrates: UI guard (<code>__tv_convert_in_progress</code>), read <code>#paste</code> textarea, POST to <code>/api/render</code> with fallback form-encoded request if primary fails, robust parsing of JSON/plain responses, delegates to <code>PasteToTable.processRenderedHtml</code> or inline injection, user feedback via <code>showToast</code>, and sets <code>status</code> text when possible. Ensures button re-enable and clears in-progress flag in finally block.<br><br><strong>__tv_convert_click_ev(ev)</strong> — delegation wrapper used by delegated click detection (see global delegation). Falls back to <code>existingHandler</code> if present. Implements same-post-to-<code>/api/render</code> fallback path as <code>convertButtonHandler</code>, but designed to be used by delegated global click listener and for direct button binding. Includes defensive logging and user notifications.<br><br><strong>saveHtmlHandler()</strong> — multi-tier save: detects content (<code>#page-area</code> vs <code>#tables-viewer</code>), produces full HTML using <code>window._buildStandaloneHTML</code> if available else minimal doc, timestamps filename <code>tables-YYYYMMDD_HHMMSS.html</code>, attempts sequential saves to <code>/api/save_html</code>, <code>/save</code>, <code>/api/save</code> (POST JSON <code>{ filename, html }</code>), parses a variety of server response shapes via <code>parseSaveResponse</code> (handles <code>{ saved: true }</code>, <code>{ ok: true }</code>, <code>{ saved: false }</code>, plain text), stops early if server indicates <code>storage_not_writable</code>, otherwise if all endpoints fail it falls back to <code>downloadBlob</code> to save locally and notifies user. Robust to network errors and server malformations. </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Event & action dispatch model</strong><br><br>• Delegated convert click: global <code>document.addEventListener(&#x27;click&#x27;)</code> checks `.closest('#convertBtn'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>UX primitives (toasts, modal, copy)</strong><br><br><strong>Toast system</strong> — queue-based UI with dedupe (<code>showToastOnce</code>), contextual durations computed by message length and type, accessible container (<code>role=status</code>, <code>aria-live</code>), safe focus behavior, visual dismiss button, and color-coding for <code>success</code>, <code>warn</code>, <code>error</code>. Non-blocking and self-cleaning.<br><br><strong>showCopyModal</strong> — lightweight overlay with selectable text area, Copy / Download / Select All controls, uses <code>copyToClipboard</code> and <code>downloadBlob</code>. Accessible (<code>role=dialog</code>, <code>aria-modal=true</code>).<br><br><strong>copyToClipboard</strong> — modern clipboard API with legacy <code>execCommand(&#x27;copy&#x27;)</code> fallback via hidden textarea. Returns a Promise.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Defensive patterns & invariants</strong><br><br>• <code>TV_DEBUG</code> gating avoids verbose console in prod.<br>• <code>safe()</code> wrapper and extensive try/catch blocks protect higher-level flows from lower-level exceptions. <br>• <code>once()</code> helper used for idempotent callbacks.<br>• <code>window.__tv_convert_in_progress</code> prevents reentrancy and double submissions.<br>• Boundaries between injected HTML and script execution are preserved — attribute whitelist reduces XSS surface from server-provided HTML.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Integration & extension points</strong><br><br>• <code>window._buildStandaloneHTML</code> — optional hook for richer server-provided full-doc builds (used by <code>saveHtmlHandler</code>).<br>• <code>window.PasteToTable.routeHtmlToAreas</code> — if present, used to route parts of HTML to different page areas.<br>• <code>window.PasteToTable.initRenderedContent</code> — post-insert initializer for table-level plugins.<br>• <code>window.exportAllBtnHandler</code> — table-level override for global Export All button.<br>• <code>window.PTToc</code> / <code>window.__tv_init_pttoc_from_core</code> — TOC integration for dynamic content.<br>These hooks let server or other assets extend behavior without changing core.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Security considerations</strong><br><br>• Attribute whitelisting in <code>insertHtmlPreserve</code> prevents mass injection of unexpected <code>data-</code> attributes? — note: <code>onclick</code> is included in whitelist for legacy compatibility (risky). If security posture requires stricter rules, remove <code>onclick</code> from whitelist and rely on delegated <code>data-action</code> attributes only.<br>• <code>downloadBlob</code> uses blob URLs — safe browser sandboxed download. <br>• <code>saveHtmlHandler</code> serializes HTML; if saved to server, backend must sanitize/validate before publishing to avoid user-supplied XSS on hosted pages. The client intentionally preserves behavior while delegating final security to server policies.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Performance & resource considerations</strong><br><br>• Small footprint; no dependency on frameworks. <br>• <code>insertHtmlPreserve</code> does DOM fragmentation which is efficient for larger inserts vs repeated innerHTML ops; still rewrites <code>targetEl.innerHTML = &#x27;&#x27;</code> which is unavoidable for atomic replace semantics.<br>• Fetch usage is asynchronous and non-blocking; retries are sequential but limited to small candidate set. <br>• Toast queue is capped by natural UX pacing (no busy-loop).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Edge cases & behavior notes</strong><br><br>• If both <code>#page-area</code> and <code>#tables-viewer</code> empty, <code>saveHtmlHandler</code> warns and returns early.<br>• If backend returns non-JSON but <code>resp.ok</code>, <code>parseSaveResponse</code> treats it as success and returns client filename (fallback behavior).<br>• If <code>document.body</code> missing at script runtime, several init steps defer until <code>DOMContentLoaded</code>. <br>• <code>insertHtmlPreserve</code> attempts to remove non-whitelisted attributes — but if new attributes are required, extension hooks must re-enable them explicitly. <br>• <code>__tv_convert_click_ev</code> will prefer an existing <code>window.convertButtonHandler</code> implementation (delegation) — good for backward compatibility but requires care to ensure existing handler returns / resolves properly.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Testing recommendations (unit + integration)</strong><br><br>Minimal recommended tests: <br>• <code>insertHtmlPreserve</code> — preserve whitelisted attributes, strip others, and ensure resulting DOM valid.<br>• <code>processRenderedHtml</code> — with payload shapes: string, { html }, { result }, { body }, and null — ensure correct routing and <code>initRenderedContent</code> call.<br>• <code>convertButtonHandler</code> / <code>__tv_convert_click_ev</code> — simulate success JSON, non-JSON ok, and various error statuses; assert <code>showToast</code> calls and <code>status</code> text updates; ensure <code>__tv_convert_in_progress</code> toggling works.<br>• <code>saveHtmlHandler.parseSaveResponse</code> — feed multiple JSON shapes and text; assert parsed outcomes (ok/filename/reason).<br>• Delegation: set <code>window.exportAllBtnHandler</code> stub and confirm <code>exportAllBtnHandler</code> delegates and returns the stub result.<br>• Event idempotence: repeatedly call <code>attachHeaderHandlersOnce</code> and check no duplicate listeners.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Reviewer checklist (pre-merge / deployment)</strong><br><br>1. Confirm <code>onclick</code> preservation is acceptable — consider removing for stricter CSP/XSS posture. <br>2. Validate server endpoints exist or adjust <code>serverEndpoints</code> list. <br>3. Verify <code>window._buildStandaloneHTML</code> signature matches server-provided implementation if used.<br>4. Ensure <code>PasteToTable.initRenderedContent</code> exists when table scripts expect it; otherwise confirm graceful behavior.<br>5. Consider tuning <code>parseSaveResponse</code> to accept additional server shapes your backend may emit. <br>6. Run integration tests simulating offline environment (no endpoints) to validate fallback download.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Operational recommendations</strong><br><br>• Production: keep <code>window.tvDebug = false</code> (default). Enable debug only for staging. <br>• For higher security, remove <code>onclick</code> from whitelist, rely on <code>data-action</code> delegated handlers. <br>• Ensure the backend sanitizes HTML saved via <code>/api/save</code> (server-side responsibility). <br>• Hook <code>window._buildStandaloneHTML</code> server-side for better saved output (assets paths, manifest embedding). <br>• Monitor save endpoint responses and extend <code>parseSaveResponse</code> with your server’s canonical response shape for more robust client messaging.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </td></tr><tr><td data-label="Technical Breakdown — script.core.js (PasteToTable / Tables Viewer v2.1 Core)"> <strong>Short summary / decision points</strong><br><br><code>script.core.js</code> is a durable, defensive core runtime that prioritizes: (1) safe injection and rendering of server-generated HTML, (2) non-destructive save/export flows with server-first then client-fallback behavior, and (3) unobtrusive integration with project-level overrides. It is ready for production as-is; recommended hardening steps are removing <code>onclick</code> preservation (for XSS/CSP policies) and matching <code>parseSaveResponse</code> to your backend response contract.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </td></tr></tbody></table></div><div class="row-count">Rows: 16</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>