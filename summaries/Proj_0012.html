<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Tables Viewer v2.1</title>
<style>:root{--main-header-height:56px;} .table-wrapper{opacity:0;min-height:24px;transition:opacity .12s linear}</style>
<link rel="stylesheet" href="assets/style.css?v=1759925496">
<link rel="stylesheet" href="assets/overrides.css?v=1764618938">
</head><body>
<div id="tables-viewer" role="region" aria-label="Tables viewer">
<div id="stickyMainHeader">
<div id="tv-header">
<div><h1>Tables Viewer v2.1</h1></div>
<div style="display:flex;gap:8px;align-items:center;">
<input id="searchBox" class="tv-search" type="search" placeholder="Search" aria-label="Search tables" />
<button id="modeBtn" type="button" onclick="toggleMode()" aria-label="Toggle theme">Theme</button>
<button id="toggleAllBtn" type="button" aria-label="Toggle all" onclick="toggleAllTables()">Collapse All Tables</button>
<button id="copyAllPlainBtn" class="copy-btn" type="button" onclick="copyAllTablesPlain()" aria-label="Copy all tables as plain text">Copy All Tables (Plain Text)</button>
<button id="copyAllTablesBtn" class="copy-all-btn" type="button" onclick="copyAllTablesMarkdown()" aria-label="Copy All Tables (Markdown)">Copy All Tables (Markdown)</button>
<button id="copyAllMdBtn" style="display:none" aria-hidden="true"></button>
<button id="resetAllBtn" type="button" onclick="resetAllTables()" aria-label="Reset All Tables">Reset All Tables</button>
</div></div>
<script>
(function(){
  function ensureDelegation(){
    try {
      var vis = document.getElementById('copyAllTablesBtn');
      var alias = document.getElementById('copyAllMdBtn');
      if(!vis || !alias) return;
      alias.addEventListener = function(type, listener, options){
        vis.addEventListener(type, listener, options);
      };
      alias.removeEventListener = function(type, listener, options){
        vis.removeEventListener(type, listener, options);
      };
      Object.defineProperty(alias, 'onclick', {
        set: function(fn){ vis.onclick = fn; },
        get: function(){ return vis.onclick; },
        configurable: true
      });
      alias.focus = function(){ vis.focus(); };
      alias.blur = function(){ vis.blur(); };
    } catch(e) {
      try{ console && console.warn && console.warn('alias delegation failed', e); }catch(_){} 
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', ensureDelegation);
  } else {
    ensureDelegation();
  }
})();
</script>
<noscript><div style='color:#b91c1c'>JavaScript is disabled. Tables will be shown statically. For large tables enable JS for virtualization.</div></noscript>
<div id="tocBar" role="navigation" aria-label="Table of contents"><ul><li class="toc-item"><a class="toc-link" href="#Table1">Table 1</a></li>
<li class="toc-item"><a class="toc-link" href="#Table2">Table 2</a></li>
<li class="toc-item"><a class="toc-link" href="#Table3">Table 3</a></li>
<li class="toc-item"><a class="toc-link" href="#Table4">Table 4</a></li>
<li class="toc-item"><a class="toc-link" href="#Table5">Table 5</a></li>
<li class="toc-item"><a class="toc-link" href="#Table6">Table 6</a></li>
<li class="toc-item"><a class="toc-link" href="#Table7">Table 7</a></li>
<li class="toc-item"><a class="toc-link" href="#Table8">Table 8</a></li></ul></div></div>
<div class="table-caption" id="Table1" data-table="Proj_0012_01" style="margin-top:2mm;margin-left:3mm;"><strong>Table 1</strong></div>
<div class="table-wrapper" data-table-id="table-1"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Adjustment / Requirement" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Adjustment / Requirement</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Implemented?" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Implemented?</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Evidence found in session files (checked 10×)" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Evidence found in session files (checked 10×)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Recommended next action (one-at-a-time)" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Recommended next action (one-at-a-time)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-content">Detect TER and, when present, calculate using TER (period gross × TER_rate) instead of annualize→progressive.</div></div></td><td data-label="Implemented?"> PARTIAL                               </td><td data-label="Evidence found in session files (checked 10×)"> <code>modMain.bas</code> collects TER tables into <code>terTables</code> and calls <code>Application.Run "modCalc.SetTERTables", terTables</code>. (<code>modMain</code> lines ingest TER_* tables and attempt <code>modCalc.SetTERTables</code>.) </td><td data-label="Recommended next action (one-at-a-time)"> Revise <strong>modCalc</strong> to implement detection + TER calculation path and to honor injected TER tables. </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading">Allow <code>use_TER = True/False</code> (or auto</div><div class="left-col-content">detect) and, when TER applies for employees/pensioners, use period gross (not annual net) as withholding base.</div></div></td><td data-label="Implemented?"> NOT FULLY IMPLEMENTED                 </td><td data-label="Evidence found in session files (checked 10×)"> No <code>modCalc</code> source provided in session; plumbing exists (TER tables injection) but no confirmation of <code>use_TER</code> flag or auto-detect logic in available modules.                                 </td><td data-label="Recommended next action (one-at-a-time)"> Implement <code>use_TER</code> flag and detection inside <strong>modCalc</strong>; add settings param and unit tests. </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-content">Keep progressive annual calculation as fallback (final period or when TER not applicable).</div></div></td><td data-label="Implemented?"> PARTIAL                               </td><td data-label="Evidence found in session files (checked 10×)"> <code>modMain</code> reads <code>tblBrackets</code> and normalizes bracket arrays and calls <code>ProcessRow</code> for per-row compute — fallback progressive path likely belongs to <code>modCalc</code> but <code>modCalc</code> not present.       </td><td data-label="Recommended next action (one-at-a-time)"> Ensure <strong>modCalc</strong> retains progressive path and clearly documents fallback rules; add a dry-run trace. </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading">Non</div><div class="left-col-content">employees: tax base = 50% of gross, taxed progressively.</div></div></td><td data-label="Implemented?"> NOT CONFIRMED                         </td><td data-label="Evidence found in session files (checked 10×)"> No explicit non-employee DPP rule present in posted modules. Input parsing/utilities exist (<code>modIO.ParseRateToFraction</code>, numeric helpers) but computation rule location is <code>modCalc</code> (not posted). </td><td data-label="Recommended next action (one-at-a-time)"> Add/verify non-employee DPP handling in <strong>modCalc</strong> and add test vectors. </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading">TER categories depend on PTKP/status</div><div class="left-col-content">module must resolve PTKP category because TER rates vary by PTKP/status.</div></div></td><td data-label="Implemented?"> PARTIAL (loader present; resolver missing) </td><td data-label="Evidence found in session files (checked 10×)"> <code>modIO.ReadParams</code> / <code>ReadBrackets</code> / <code>ReadTableToDicts</code> exist and TER tables are parsed, but no PTKP→TER resolution logic is visible in posted modules.                                   </td><td data-label="Recommended next action (one-at-a-time)"> Implement PTKP→TER category resolver inside <strong>modCalc</strong> (use <code>tblParams</code>/PTKP map from <code>Rules</code>). </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading">Add TER per</div><div class="left-col-content">month (or per-day) computation path; monthly withholding = <code>period_gross × TER_rate</code> (not <code>annual_tax/12</code>).</div></div></td><td data-label="Implemented?"> PARTIAL                               </td><td data-label="Evidence found in session files (checked 10×)"> TER tables ingestion present; <code>modIO.ParseRateToFraction</code> supports percent parsing; calculation path not visible without <code>modCalc</code>.                                                              </td><td data-label="Recommended next action (one-at-a-time)"> Implement TER monthly/daily path in <strong>modCalc</strong>, and add unit tests for monthly vs daily TER. </td></tr></tbody></table></div><div class="row-count">Rows: 6</div></div><div class="table-caption" id="Table2" data-table="Proj_0012_02" style="margin-top:2mm;margin-left:3mm;"><strong>Table 2</strong></div>
<div class="table-wrapper" data-table-id="table-2"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Adjustment / Requirement**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Adjustment / Requirement</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Status &amp; detailed evidence from  CODE0  (checked thoroughly)**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Status &amp; detailed evidence from  CODE0  (checked thoroughly)</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Recommended next action (one-at-a-time, actionable)**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Recommended next action (one-at-a-time, actionable)</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Detect TER and, when present, calculate using TER (period gross × TER_rate) instead of annualize→progressive.</strong><br/></div></div></td><td data-label="Status &amp; detailed evidence from  CODE0  (checked thoroughly)"> <strong>Status:</strong> Implemented.<br/><strong>Evidence:</strong> <code>SetTERTables</code> normalizes/loads TER rows into module-level <code>g_TERtables</code>; <code>LookupTERRow(category, grossTotal)</code> searches those tables and returns the matching interval; top bucket handled; <code>ResolveTERRateFromRow</code> picks best rate (<code>TER_period</code>, then <code>TER_monthly</code>, <code>TER_percent</code>), converts monthly↔daily using <code>periodDays</code>. In <code>CalcRow</code>, when <code>terApplied</code> is True, <code>monthlyWithholding = gross * terRate</code>, implied <code>annualTax</code> computed via <code>DeterminePeriodsPerYear</code>. Defensive coercion and logging included. </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Run a focused test suite that: <br/>(1) injects TER via <code>SetTERTables</code>; <br/>(2) call <code>CalcRow</code> for rows whose <code>annualGross</code> sits inside TER bands; <br/>(3) confirm <code>ter_applied = True</code> and <code>monthly_withholding = gross × terRate</code>; <br/>(4) test open-ended bands. Capture logs.                   </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Allow <code>use_TER = True/False</code> (or auto-detect) and, when TER applies for employees/pensioners, use period gross (not annual net) as withholding base.</strong><br/></div></div></td><td data-label="Status &amp; detailed evidence from  CODE0  (checked thoroughly)"> <strong>Status:</strong> Partially implemented but inconsistent.<br/><strong>Evidence:</strong> <code>GetConfig</code> parses <code>USE_TER</code> reliably. <code>CalcRow</code> mixes checks across <code>cfg("USE_TER")</code>, row-level <code>use_TER</code>, and a local <code>useTER</code> default. Logic branches in multiple places, producing possible mismatches (global=True but <code>useTER</code> still False, etc.).                                                                                                                                                                                                                                     </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Refactor <code>CalcRow</code> start block to compute a <strong>single</strong> canonical variable <code>useTERMode</code> (True / False / "auto"), resolving row override cleanly. Replace all scattered checks with this. Add unit tests for all combinations.                                                       </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Keep progressive annual calculation as fallback (final period or when TER not applicable).</strong><br/></div></div></td><td data-label="Status &amp; detailed evidence from  CODE0  (checked thoroughly)"> <strong>Status:</strong> Implemented.<br/><strong>Evidence:</strong> When <code>terApplied</code> is False or rate invalid, <code>CalcRow</code> annualizes gross, applies PTKP, applies deductions, computes <code>taxableAnnual</code>, floors to thousand, calls <code>ComputeTaxFromBrackets</code>, then <code>monthlyWithholding = annualTax / 12</code>. Bracket functions include defensive fallbacks.                                                                                                                                                                                                                                      </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Add a clear <code>VERBOSECALC</code> trace line identifying progressive fallback and listing all inputs: annualGross, ptkp, deductions, taxable before/after floor, bracket tier, output. Test cases: no TER table, missing TER rate, TER disabled.                                           </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Non-employees: tax base = 50% of gross, taxed progressively.</strong><br/></div></div></td><td data-label="Status &amp; detailed evidence from  CODE0  (checked thoroughly)"> <strong>Status:</strong> Implemented.<br/><strong>Evidence:</strong> <code>CalcRow</code> identifies non-employee via flexible flags and applies: taxableAnnual = (annualGross × 0.5) – ptkp – deductions → floor → brackets.                                                                                                                                                                                                                                                                                                                                                                           </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Add targeted non-employee tests across period types; confirm DPP=50% of annualGross, PTKP subtraction, thousand-flooring, correct bracket output, zero-clamp when negative.                                                                                                        </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>TER categories depend on PTKP/status — module must resolve PTKP category because TER rates vary by PTKP/status.</strong><br/></div></div></td><td data-label="Status &amp; detailed evidence from  CODE0  (checked thoroughly)"> <strong>Status:</strong> Partially implemented.<br/><strong>Evidence:</strong> <code>CalcRow</code> copies raw <code>ptkp_status</code> to <code>ter_category</code> when missing. <code>LookupTERRow</code> matches raw strings but no canonical mapping exists. Variant names (“tk”, “TK”, “0”, “single”) may not align with TER table keys.                                                                                                                                                                                                                                                                                           </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Implement a normalization helper (e.g., <code>ResolveTERCategoryFromPTKP</code>). Standardize variants → canonical categories; trim; lowercase; map numeric aliases. Apply when calling <code>LookupTERRow</code>. Ensure <code>SetTERTables</code> stores normalized keys. Add multi-variant tests.                </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Add TER per-month (or per-day) computation path; monthly withholding = <code>period_gross × TER_rate</code> (not <code>annual_tax/12</code>).</strong><br/></div></div></td><td data-label="Status &amp; detailed evidence from  CODE0  (checked thoroughly)"> <strong>Status:</strong> Implemented.<br/><strong>Evidence:</strong> <code>ResolveTERRateFromRow</code> supports <code>TER_monthly</code>, <code>TER_daily</code>, <code>TER_period</code>, <code>TER_percent</code> with correct conversions. <code>CalcRow</code> uses resolved TER rate to compute withholding. <code>DeterminePeriodsPerYear</code> covers monthly/daily/weekly/annual.                                                                                                                                                                                                                                                                               </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Add tests for: (a) monthly rate; (b) daily rate scaled by <code>period_days</code>; (c) percent-based TER; (d) nonstandard <code>period_days</code>. Test fallback when rate ≤ 0.                                                                                                                        </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>General robustness: header validation, masking, deep-clone, numeric coercion, and logging.</strong><br/></div></div></td><td data-label="Status &amp; detailed evidence from  CODE0  (checked thoroughly)"> <strong>Status:</strong> Implemented.<br/><strong>Evidence:</strong> <code>ValidateHeaders</code>, <code>MaskSensitiveForLog</code>, <code>CloneDict</code>, <code>DeepCloneDict</code>, <code>NzNumericSafe</code>, <code>ParseRateToFractionLocal</code>, and logging via <code>modUtils.LogMsg</code> are used throughout TER, BPJS, and bracket handling.                                                                                                                                                                                                                                                                                                             </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Run an integration test with malformed input: missing headers, messy numeric formats, deep objects, IDs requiring masking. Review logs to confirm graceful degradation.                                                                                                            </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Consistency &amp; clarity: single-source decision making and diagnostic output.</strong><br/></div></div></td><td data-label="Status &amp; detailed evidence from  CODE0  (checked thoroughly)"> <strong>Status:</strong> Partially implemented.<br/><strong>Evidence:</strong> Defensive primitives exist and <code>VERBOSECALC</code> is available, but there is no unified diagnostic summary and some duplicated branching (notably TER detection).                                                                                                                                                                                                                                                                                                                                                  </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Add a diagnostic dictionary assembled at the start of <code>CalcRow</code> capturing canonical TER decision, category, row key, rate, annualGross, deductions, taxable (pre/post floor), computed annualTax, monthlyWithholding, and final path. Emit summary under <code>VERBOSECALC</code>. Add tests. </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table3" data-table="Proj_0012_03" style="margin-top:2mm;margin-left:3mm;"><strong>Table 3</strong></div>
<div class="table-wrapper" data-table-id="table-3"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Adjustment / Requirement**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Adjustment / Requirement</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Status &amp; concise evidence from  CODE0  (checked thoroughly)**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Status &amp; concise evidence from  CODE0  (checked thoroughly)</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Recommended next action (one-at-a-time, actionable)**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Recommended next action (one-at-a-time, actionable)</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Detect TER and, when present, calculate using TER (period gross × TER_rate) instead of annualize→progressive.</strong></div></div></td><td data-label="Status &amp; concise evidence from  CODE0  (checked thoroughly)"> <strong>Implemented.</strong> <code>SetTERTables</code> → <code>g_TERtables</code>; <code>LookupTERRow(category,gross)</code> selects interval (open-ended top bucket handled); <code>ResolveTERRateFromRow</code> picks period rate; <code>CalcRow</code> uses <code>monthlyWithholding = gross * terRate</code> and derives implied <code>annualTax</code> using <code>DeterminePeriodsPerYear</code>. </td><td data-label="Recommended next action (one-at-a-time, actionable)"> <strong>Run focused TER unit tests</strong>: inject TER tables via <code>SetTERTables</code>, call <code>CalcRow</code> for rows inside bands, assert <code>ter_applied = True</code> and <code>monthly_withholding = gross * terRate</code>. (See test plan below.) </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Allow <code>use_TER = True/False</code> (or auto-detect) and use period gross as withholding base.</strong></div></div></td><td data-label="Status &amp; concise evidence from  CODE0  (checked thoroughly)"> <strong>Implemented (canonicalized).</strong> <code>GetConfig</code> parses <code>USE_TER</code>; <code>CalcRow</code> computes a single canonical <code>useTERMode</code> (True/False/"auto") with row-level override and uses it consistently thereafter.                                                                                                  </td><td data-label="Recommended next action (one-at-a-time, actionable)"> After TER tests, add tests for <code>USE_TER</code> modes: global True, global False, global "auto" with matching and non-matching TER rows, and row-level overrides.                                                  </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Keep progressive annual calculation as fallback.</strong></div></div></td><td data-label="Status &amp; concise evidence from  CODE0  (checked thoroughly)"> <strong>Implemented.</strong> When <code>terApplied</code> false or <code>terRate</code> invalid, <code>CalcRow</code> annualizes, computes <code>ptkp</code> via <code>ComputePTKP</code>, aggregates deductions, floors via <code>FloorToThousand</code>, then <code>ComputeTaxFromBrackets</code> → <code>monthlyWithholding = annualTax/12</code>.                                                   </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Enable <code>VERBOSECALC</code> and run fallback scenarios (no TER table, TER disabled, invalid TER rate) to capture a verbose trace.                                                                                  </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Non-employees: tax base = 50% of gross, taxed progressively.</strong></div></div></td><td data-label="Status &amp; concise evidence from  CODE0  (checked thoroughly)"> <strong>Implemented.</strong> Non-employee detected via several flags; <code>taxableAnnual = (annualGross * 0.5) - ptkp - deductions</code> → floored → bracket tax.                                                                                                                                                        </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Create targeted non-employee vectors (monthly/yearly/daily) and assert taxable base, floor, and tax outcome.                                                                                                </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>TER categories depend on PTKP/status — resolver required.</strong></div></div></td><td data-label="Status &amp; concise evidence from  CODE0  (checked thoroughly)"> <strong>Implemented.</strong> <code>ResolveTERCategoryFromPTKP</code> present and used as fallback when <code>ter_category</code> missing; <code>LookupTERRow</code> matches normalized keys.                                                                                                                                                     </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Validate mapping permutations: <code>"tk","0","single" → "TK"</code>, <code>"k1","1" → "K1"</code>, numeric inputs, whitespace/case variants. Ensure TER table keys use matching canonical forms or normalize when loading.       </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Add TER per-month / per-day path; monthly withholding = period_gross × TER_rate.</strong></div></div></td><td data-label="Status &amp; concise evidence from  CODE0  (checked thoroughly)"> <strong>Implemented.</strong> <code>ResolveTERRateFromRow</code> supports <code>TER_monthly</code>, <code>TER_daily</code>, <code>TER_period</code>, <code>TER_percent</code> and converts monthly↔daily using <code>periodDays</code>; <code>CalcRow</code> applies the resolved rate to period gross.                                                                                       </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Test cases: monthly rate, daily rate with <code>period_days</code>, percent-based entries, nonstandard <code>period_days</code>. Check fallback when <code>terRate &lt;= 0</code>.                                                              </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>General robustness: header validation, masking, deep-clone, numeric coercion, logging.</strong></div></div></td><td data-label="Status &amp; concise evidence from  CODE0  (checked thoroughly)"> <strong>Implemented.</strong> <code>ValidateHeaders</code>, <code>MaskSensitiveForLog</code>, <code>CloneDict</code>, <code>DeepCloneDict</code>, <code>NzNumericSafe</code>, <code>ParseRateToFractionLocal</code>, and <code>modUtils.LogMsg</code> usage present across code paths.                                                                                                        </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Run integration tests with malformed inputs (missing headers, currency strings, deep objects, large IDs) and inspect logs for graceful handling and masked outputs.                                         </td></tr><tr><td data-label="Adjustment / Requirement"><div class="tv-left-col"><div class="left-col-heading"><strong>Consistency &amp; diagnostic output (single-source decision + diag).</strong></div></div></td><td data-label="Status &amp; concise evidence from  CODE0  (checked thoroughly)"> <strong>Implemented.</strong> <code>useTERMode</code> canonicalized; <code>diag</code> dictionary assembled and emitted under <code>VERBOSECALC</code> with <code>path</code>, <code>terCat</code>, <code>terApplied</code>, <code>terRateResolved</code>, <code>taxableBeforeFloor</code>, <code>taxableAfterFloor</code>, <code>monthlyWithholding</code>, etc.                                                              </td><td data-label="Recommended next action (one-at-a-time, actionable)"> Enable <code>VERBOSECALC</code>, run representative rows (TER &amp; progressive), collect <code>diag</code> for each, and confirm fields are complete and accurate.                                                                   </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table4" data-table="Proj_0012_04" style="margin-top:2mm;margin-left:3mm;"><strong>Table 4</strong></div>
<div class="table-wrapper" data-table-id="table-4"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Suggested quick test vectors (input rows) — copy/paste ready**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Suggested quick test vectors (input rows) — copy/paste ready</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Reason / expected**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Reason / expected</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">1,"category":"TK","gross":3000000,"period_type":"monthly"}</div></div></td><td data-label="Reason / expected"> matches TK row 2 → TER 0.005.                                            </td></tr><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">2,"category":"TK","gross":5000001,"period_type":"monthly"}</div></div></td><td data-label="Reason / expected"> matches TK row 3 → TER 0.02.                                             </td></tr><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">3,"category":"K1","gross":20000000,"period_type":"monthly"}</div></div></td><td data-label="Reason / expected"> matches K1 row 7 → parse <code>"1.5%"</code>.                                       </td></tr><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">4,"category":"K2","gross":2500000,"period_type":"monthly"}</div></div></td><td data-label="Reason / expected"> overlap test between rows 10 &amp; 11.                                       </td></tr><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">5,"category":"K3","gross":10000000,"period_type":"monthly"}</div></div></td><td data-label="Reason / expected"> zero-rate/force progressive.                                             </td></tr><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">6,"category":"UNK","gross":1000000,"period_type":"monthly"}</div></div></td><td data-label="Reason / expected"> category not found → progressive.                                        </td></tr><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">7,"category":"TK","gross":50000000,"period_type":"annual"}</div></div></td><td data-label="Reason / expected"> annual case → should match TK top/open bucket when converted or checked. </td></tr><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">8,"category":"K1","gross":9000000000,"period_type":"monthly"}</div></div></td><td data-label="Reason / expected"> very large → should match large GrossHigh row.                           </td></tr><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">9,"category":"K1","gross":15000001,"period_type":"monthly"}</div></div></td><td data-label="Reason / expected"> matches K1 split row (15,000,001–40,000,000) → percent string/normalize. </td></tr><tr><td data-label="Suggested quick test vectors (input rows) — copy/paste ready"><div class="tv-left-col"><div class="left-col-heading"><code>{"id"</code></div><div class="left-col-content">10,"category":"TK","gross":0,"period_type":"monthly"}</div></div></td><td data-label="Reason / expected"> zero gross safety check.                                                 </td></tr></tbody></table></div><div class="row-count">Rows: 10</div></div><div class="table-caption" id="Table5" data-table="Proj_0012_05" style="margin-top:2mm;margin-left:3mm;"><strong>Table 5</strong></div>
<div class="table-wrapper" data-table-id="table-5"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Expanded TER table examples (15 sample rows)**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Expanded TER table examples (15 sample rows)</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Expanded TER table examples (15 sample rows)"><div class="tv-left-col"><div class="left-col-heading"><strong>1 — TK very low</strong></div></div></td><td data-label="Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)"> <code>TK</code> — <code>0</code>, <code>1,000,000</code> — <code>0.002</code> — <code>0.2%</code> </td></tr><tr><td data-label="Expanded TER table examples (15 sample rows)"><div class="tv-left-col"><div class="left-col-heading"><strong>2 — TK mid</strong></div></div></td><td data-label="Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)"> <code>TK</code> — <code>1,000,001</code>, <code>5,000,000</code> — <code>0.005</code> — <code>0.5%</code> </td></tr><tr><td data-label="Expanded TER table examples (15 sample rows)"><div class="tv-left-col"><div class="left-col-heading"><strong>3 — TK high</strong></div></div></td><td data-label="Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)"> <code>TK</code> — <code>5,000,001</code>, <code>50,000,000</code> — <code>0.02</code> — <code>2%</code> </td></tr><tr><td data-label="Expanded TER table examples (15 sample rows)"><div class="tv-left-col"><div class="left-col-heading"><strong>4 — TK top open</strong></div></div></td><td data-label="Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)"> <code>TK</code> — <code>50,000,001</code>, <code>≤0 (open)</code> — <code>0.03</code> — <code>3%</code> </td></tr><tr><td data-label="Expanded TER table examples (15 sample rows)"><div class="tv-left-col"><div class="left-col-heading"><strong>5 — K1 low</strong></div></div></td><td data-label="Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)"> <code>K1</code> — <code>0</code>, <code>8,000,000</code> — <code>0.01</code> — <code>1%</code> </td></tr><tr><td data-label="Expanded TER table examples (15 sample rows)"><div class="tv-left-col"><div class="left-col-heading"><strong>6 — K1 split</strong></div></div></td><td data-label="Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)"> <code>K1</code> — <code>8,000,001</code>, <code>15,000,000</code> — <code>0.0125</code> — <code>1.25%</code> </td></tr><tr><td data-label="Expanded TER table examples (15 sample rows)"><div class="tv-left-col"><div class="left-col-heading"><strong>7 — K1 percent-string</strong></div></div></td><td data-label="Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)"> <code>K1</code> — <code>15,000,001</code>, <code>40,000,000</code> — `<code> (blank) — </code>"1.5%"<code> (string)                           **8 — K1 malformed percent**                     | </code>K1<code> — </code>40,000,001<code>, </code>100,000,000<code> — </code>0<code> — </code>"1,75%"<code> (comma decimal)                         **9 — K2 single open**                           | </code>K2<code> — </code>0<code>, </code>≤0 (open)<code> — </code>0.025<code> — </code>2.5%<code>                                                   **10 — K2 extra rows**                           | </code>K2<code> — </code>0<code>, </code>2,000,000<code> — </code>0.01<code> — </code>1%<code>                                                      **11 — K2 overlapping (test)**                   | </code>K2<code> — </code>1,500,000<code>, </code>3,000,000<code> — </code>0.015<code> — </code>1.5%<code> (overlaps row 10)                         **12 — K3 zero-rate (force progressive)**        | </code>K3<code> — </code>0<code>, </code>50,000,000<code> — </code>0<code> — </code>0%<code> (explicit zeros)                                       **13 — K3 percent with spaces**                  | </code>K3<code> — </code>50,000,001<code>, </code>≤0 (open)<code> — </code><code> — </code>" 2.0 % "` (leading/trailing spaces)              </td></tr><tr><td data-label="Expanded TER table examples (15 sample rows)"><div class="tv-left-col"><div class="left-col-heading"><strong>14 — Bad numeric fields</strong></div></div></td><td data-label="Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)"> <code>TK</code> — <code>abc</code>, <code>5,000,000</code> — <code>"0,02"</code> (string with comma) — <code>"2%"</code> (requires normalization) </td></tr><tr><td data-label="Expanded TER table examples (15 sample rows)"><div class="tv-left-col"><div class="left-col-heading"><strong>15 — Huge numbers</strong></div></div></td><td data-label="Details (GrossLow, GrossHigh, TER_monthly, TER_percent — varied formats &amp; edge cases)"> <code>K1</code> — <code>0</code>, <code>9,999,999,999</code> — <code>0.018</code> — <code>"1.8%"</code> (verify large GrossHigh handling)         </td></tr></tbody></table></div><div class="row-count">Rows: 9</div></div><div class="table-caption" id="Table6" data-table="Proj_0012_06" style="margin-top:2mm;margin-left:3mm;"><strong>Table 6</strong></div>
<div class="table-wrapper" data-table-id="table-6"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Expanded test cases &amp; validation checks**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Expanded test cases &amp; validation checks</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Expected behavior / check details**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Expected behavior / check details</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T1 — TER direct monthly hit</strong></div></div></td><td data-label="Expected behavior / check details"> gross=3,000,000, ptkp_status=<code>TK</code>, period_type=<code>monthly</code> → match row 2, ter_applied=True, withholding=3,000,000×0.005.                                                                        </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T2 — TER direct percent-string parsing</strong></div></div></td><td data-label="Expected behavior / check details"> gross=20,000,000, ptkp_status=<code>K1</code>, period_type=<code>monthly</code> → match row 7, parse <code>"1.5%"</code>→0.015, withholding=gross×0.015.                                                                       </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T3 — TER open-ended top bucket</strong></div></div></td><td data-label="Expected behavior / check details"> gross=200,000,000, ptkp_status=<code>TK</code> → match row 4 (open-ended), ter_applied=True.                                                                                                             </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T4 — TER fallback due to zero-rates</strong></div></div></td><td data-label="Expected behavior / check details"> gross=10,000,000, ptkp_status=<code>K3</code> → row 12 has zeros → ter_applied=False → route to progressive calculation.                                                                                 </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T5 — Overlap resolution</strong></div></div></td><td data-label="Expected behavior / check details"> gross=1,750,000, ptkp_status=<code>K2</code> → rows 10 and 11 overlap; verify selection rule (prefer exact boundary/first-match/highest-specificity). Document which row chosen.                         </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T6 — Boundary lower equal to GrossLow</strong></div></div></td><td data-label="Expected behavior / check details"> gross exactly <code>1,500,000</code>, ptkp_status=<code>K2</code> and bucket starts at <code>1,500,000</code> → must match that bucket.                                                                                        </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T7 — Boundary upper equal to GrossHigh</strong></div></div></td><td data-label="Expected behavior / check details"> gross exactly <code>2,000,000</code>, ptkp_status=<code>K2</code> where GrossHigh=<code>2,000,000</code> → must match that bucket, not next.                                                                                   </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T8 — Case-insensitive status match</strong></div></div></td><td data-label="Expected behavior / check details"> ptkp_status=<code>tk</code>, <code>Tk</code>, <code>TK</code> → all should match <code>TK</code>.                                                                                                                                         </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T9 — Whitespace-tolerant parsing</strong></div></div></td><td data-label="Expected behavior / check details"> TER <code>" 2.0 % "</code> or <code>" 0.02 "</code> → trimmed → numeric parse ok.                                                                                                                                   </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T10 — Locale decimals</strong></div></div></td><td data-label="Expected behavior / check details"> TER <code>"1,75%"</code> or <code>"0,02"</code> → treat comma as decimal if present; parse to 0.0175 / 0.02 respectively (normalize).                                                                               </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T11 — Thousands separators</strong></div></div></td><td data-label="Expected behavior / check details"> Inputs <code>"2,500,000"</code> or <code>"1.000.000"</code> → normalize to numeric 2500000 / 1000000.                                                                                                               </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T12 — String numeric conversion</strong></div></div></td><td data-label="Expected behavior / check details"> TER_monthly stored as <code>"0.02"</code> should convert to 0.02 reliably.                                                                                                                               </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T13 — Malformed GrossLow</strong></div></div></td><td data-label="Expected behavior / check details"> row with GrossLow=<code>abc</code> → skip row with warning; ensure system doesn’t crash; document fallback.                                                                                              </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T14 — Zero gross regression</strong></div></div></td><td data-label="Expected behavior / check details"> gross=0, ptkp_status=<code>TK</code> → handle safely; withholding=0 if TER applies or progressive path as configured.                                                                                    </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T15 — Forced global disable</strong></div></div></td><td data-label="Expected behavior / check details"> config <code>TER_ENABLED=False</code> → ter_applied=False regardless of table.                                                                                                                           </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T16 — Multiple rows same category</strong></div></div></td><td data-label="Expected behavior / check details"> <code>TK</code> with many rows; gross in each bucket → verify correct bucket selection by numeric range, not insertion order.                                                                            </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T17 — Annual vs monthly selection</strong></div></div></td><td data-label="Expected behavior / check details"> period_type=<code>annual</code> with TER entries present only as monthly → ensure code either converts or falls back explicitly; define expected mapping (e.g., TER_annual = TER_monthly×12 if allowed). </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T18 — Mixed missing fields</strong></div></div></td><td data-label="Expected behavior / check details"> row missing TER_monthly but has TER_percent → parse percent and derive monthly based on period_type.                                                                                          </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T19 — Edge-case huge gross</strong></div></div></td><td data-label="Expected behavior / check details"> gross=50,000,000,000 → must match open-ended bucket, not overflow.                                                                                                                            </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T20 — Multiple invalid rate forms</strong></div></div></td><td data-label="Expected behavior / check details"> TER values present as <code>"-"</code>, <code>"n/a"</code>, empty → treat as invalid → route progressive.                                                                                                           </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T21 — Diagnostic verbosity</strong></div></div></td><td data-label="Expected behavior / check details"> With <code>VERBOSECALC=True</code> capture: table load, normalization steps, matched row id, parsed numeric rates, decision (TER vs progressive), computed withholding, and any parsing warnings.        </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T22 — Race/atomicity test</strong></div></div></td><td data-label="Expected behavior / check details"> Concurrent table reload + lookup → ensure lookups use consistent snapshot (no partial reads).                                                                                                 </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T23 — Persistence test</strong></div></div></td><td data-label="Expected behavior / check details"> After <code>SetTERTables</code>, reload app/process → table persists or fail-open as design requires; test behavior.                                                                                     </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T24 — Export/import fidelity</strong></div></div></td><td data-label="Expected behavior / check details"> Export table to CSV/JSON and re-import → verify identical numeric normalization.                                                                                                              </td></tr><tr><td data-label="Expanded test cases &amp; validation checks"><div class="tv-left-col"><div class="left-col-heading"><strong>T25 — Audit trail</strong></div></div></td><td data-label="Expected behavior / check details"> For each withholding decision write audit record: input key (employee id/gross/period), matched row key, parsed rate, result, timestamp.                                                      </td></tr></tbody></table></div><div class="row-count">Rows: 25</div></div><div class="table-caption" id="Table7" data-table="Proj_0012_07" style="margin-top:2mm;margin-left:3mm;"><strong>Table 7</strong></div>
<div class="table-wrapper" data-table-id="table-7"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by **Implementation notes &amp; quick normalization rules to enforce**" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Implementation notes &amp; quick normalization rules to enforce</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by **Required behavior**" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"><strong>Required behavior</strong></div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Implementation notes &amp; quick normalization rules to enforce"><div class="tv-left-col"><div class="left-col-heading"><strong>Normalizing gross &amp; bounds</strong></div></div></td><td data-label="Required behavior"> Strip thousands separators (<code>,</code>/<code>.</code>), allow comma or dot decimals, coerce to integer/float. Invalid numeric → skip row with warning.                                                        </td></tr><tr><td data-label="Implementation notes &amp; quick normalization rules to enforce"><div class="tv-left-col"><div class="left-col-heading"><strong>TER field normalization</strong></div></div></td><td data-label="Required behavior"> Trim whitespace; accept <code>"1.5%"</code>, <code>"0.015"</code>, <code>"1,5%"</code>; convert comma→dot, remove <code>%</code> and divide by 100 when necessary.                                                                      </td></tr><tr><td data-label="Implementation notes &amp; quick normalization rules to enforce"><div class="tv-left-col"><div class="left-col-heading"><strong>Open-ended top bucket convention</strong></div></div></td><td data-label="Required behavior"> Use <code>GrossHigh ≤ 0</code> or explicit <code>NULL</code>/<code>OPEN</code> marker. Treat as match when gross ≥ GrossLow or when GrossHigh missing.                                                                       </td></tr><tr><td data-label="Implementation notes &amp; quick normalization rules to enforce"><div class="tv-left-col"><div class="left-col-heading"><strong>Matching precedence</strong></div></div></td><td data-label="Required behavior"> Define and document: exact numeric range match wins; if overlaps exist, choose highest specificity (smallest range width) or explicit priority field — implement deterministic tie-breaker. </td></tr><tr><td data-label="Implementation notes &amp; quick normalization rules to enforce"><div class="tv-left-col"><div class="left-col-heading"><strong>Invalid/zero TER handling</strong></div></div></td><td data-label="Required behavior"> If numeric TER_rate ≤ 0 or parse failed → treat as invalid and route to progressive. Log reason.                                                                                            </td></tr><tr><td data-label="Implementation notes &amp; quick normalization rules to enforce"><div class="tv-left-col"><div class="left-col-heading"><strong>Period mapping</strong></div></div></td><td data-label="Required behavior"> Decide explicit rule for <code>monthly</code> vs <code>annual</code> TER fields (prefer explicit field; if missing, either convert or require table to include both). Document behavior.                          </td></tr><tr><td data-label="Implementation notes &amp; quick normalization rules to enforce"><div class="tv-left-col"><div class="left-col-heading"><strong>Logging</strong></div></div></td><td data-label="Required behavior"> VERBOSECALC must log: raw input, normalized input, matched row id, chosen rate numeric, calculation performed, final amount, and warnings/errors.                                           </td></tr><tr><td data-label="Implementation notes &amp; quick normalization rules to enforce"><div class="tv-left-col"><div class="left-col-heading"><strong>Unit tests</strong></div></div></td><td data-label="Required behavior"> Create unit tests for each test vector above; assert ter_applied flag, rate used, and withholding value within rounding tolerance.                                                          </td></tr></tbody></table></div><div class="row-count">Rows: 8</div></div><div class="table-caption" id="Table8" data-table="Proj_0012_08" style="margin-top:2mm;margin-left:3mm;"><strong>Table 8</strong></div>
<div class="table-wrapper" data-table-id="table-8"><div class="table-heading-bar" aria-label="Table heading"></div><div class="table-container"><div class="table-header-wrapper" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;"><div class="copy-buttons"><button type="button" class="copy-plain-btn" data-action="copy-plain" onclick="copyTablePlain(this)">Copy Plain Table</button><button type="button" class="copy-markdown-btn" data-action="copy-markdown" onclick="copyTableMarkdown(this)">Copy Markdown Table</button><button type="button" class="export-csv-btn" data-action="export-csv" onclick="exportTableCSV(this)">Export CSV</button><button type="button" class="export-json-btn" data-action="export-json" onclick="exportTableJSON(this)">Export JSON</button><button type="button" class="export-xlsx-btn" data-action="export-xlsx" onclick="exportTableXLSX(this)">Export XLSX</button><button type="button" class="export-pdf-btn" data-action="export-pdf" onclick="exportTablePDF(this)">Export PDF</button><button type="button" class="export-markdown-btn export-markdown-initial" data-action="export-markdown" onclick="exportTableMarkdown(this)" style="display:none" data-initial-hidden="1">Export Markdown</button></div><div style="display:flex; align-items:center;"><button type="button" class="toggle-table-btn" data-action="toggle-collapse" onclick="toggleTable(this)">Collapse Table</button></div></div><table class="tv-table" role="table"><thead><tr><th aria-label="Sort by Adjustment (merged)" class="tv-col-left" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Adjustment (merged)</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Explanation" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Explanation</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th><th aria-label="Sort by Validation &amp; risk checks" class="tv-col" role="button"><div class="th-with-sort"><div style="flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Validation &amp; risk checks</div><button aria-label="Toggle sort" class="sort-btn sort-state-0" title="Toggle sort"><span aria-hidden="true" class="sort-icon"></span></button></div></th></tr></thead><tbody><tr><td data-label="Adjustment (merged)"><div class="tv-left-col"><div class="left-col-heading"><strong>Auto-detect TER vs progressive by employee type</strong></div></div></td><td data-label="Explanation"> Automatically determines whether <strong>TER</strong> or <strong>progressive annual taxation</strong> applies on a per-row basis, without relying solely on manual flags.<br/><br/>The decision logic evaluates:<br/>• recipient classification (employee, non-employee, pensioner)<br/>• presence of <code>ter_category</code><br/>• availability of TER tables (A/B/C/D)<br/>• <code>period_type</code> (monthly / daily / annual)<br/>• global overrides such as <code>CALC_MODE</code> or <code>USE_TER</code> flags<br/><br/>Effective behavior:<br/>• Permanent employees &amp; pensioners → TER when applicable<br/>• Non-employees / freelancers → progressive (50% DPP rule preserved)<br/>• Explicit overrides always win and are logged </td><td data-label="Validation &amp; risk checks"> <strong>Risk level: Low–Medium</strong><br/><br/>Checks to run:<br/>• Mixed employee/non-employee sample rows<br/>• Log entries showing why TER or progressive was chosen<br/>• Compare output versus explicit <code>USE_TER</code> override </td></tr><tr><td data-label="Adjustment (merged)"><div class="tv-left-col"><div class="left-col-heading"><strong>Hard-error if TER requested but rate missing</strong></div></div></td><td data-label="Explanation"> Ensures <strong>no silent fallback</strong> occurs when TER is explicitly requested but cannot be calculated.<br/><br/>If <code>USE_TER = TRUE</code> or <code>CALC_MODE = TER</code> and any of the following occur:<br/>• TER table missing<br/>• No matching TER slab for gross<br/>• TER percent invalid or unparsable<br/><br/>The system immediately raises <strong>ERROR/FATAL</strong>, halting processing.<br/><br/>This enforces full regulatory and audit compliance by preventing unintended progressive calculations. </td><td data-label="Validation &amp; risk checks"> <strong>Risk level: Medium</strong><br/><br/>Checks to run:<br/>• Remove or corrupt TER table row intentionally<br/>• Confirm run aborts cleanly<br/>• Verify error message includes category, gross range, and reason </td></tr><tr><td data-label="Adjustment (merged)"><div class="tv-left-col"><div class="left-col-heading"><strong>Final-period (December / termination) progressive override</strong></div></div></td><td data-label="Explanation"> Enables TER during regular periods but forces <strong>progressive annual reconciliation</strong> for the final tax period.<br/><br/>Trigger conditions may include:<br/>• December payroll (<code>period = 12</code>)<br/>• explicit final-period flag<br/>• employee termination indicator<br/><br/>Effective behavior:<br/>• TER explicitly bypassed<br/>• Full annualization applied<br/>• Progressive brackets used<br/>• Withholding calculated as final adjustment (difference-based) </td><td data-label="Validation &amp; risk checks"> <strong>Risk level: Medium–High</strong><br/><br/>Checks to run:<br/>• November vs December comparison<br/>• Termination-month scenario<br/>• Validate cumulative tax equals annual obligation </td></tr></tbody></table></div><div class="row-count">Rows: 3</div></div><script src="assets/xlsx.full.min.js?v=1758605028" defer></script>
<script src="assets/script.js?v=1759748863" defer></script>
<script src="assets/worker.js?v=1758331710" defer></script>
<script>
(function(){
  const template = "{table}_{date}";
  const userVal = "";
  const hrefPrefix = "assets";
  function formatName(tableName) {
    const date = (new Date()).toISOString().slice(0,10);
    return template.replace('{table}', tableName).replace('{date}', date).replace('{user}', userVal);
  }
  const btn = document.getElementById('exportBtn');
  if(btn) {
    btn.addEventListener('click', async function() {
      try {
        const html = document.documentElement.outerHTML;
        if(html.length > 2000000) { alert('Export refused: html too large'); return; }
        if(window.Worker) {
          const workerUrl = (function(){ try{ return hrefPrefix + '/worker.js'; }catch(e){ return null; } })();
          if(workerUrl) {
            try {
              const worker = new Worker(workerUrl);
              worker.postMessage({html: html, format: 'pdf'});
              worker.onmessage = function(e) { console.log('worker:', e.data); alert('Worker replied: '+(e.data.msg||e.data.status)); };
            } catch(err) { console.warn('Worker create failed', err); alert('Worker not available'); }
          } else { alert('Worker not available'); }
        } else { alert('Export worker not supported in this environment.'); }
      } catch(err) { console.warn('Export failed', err); alert('Export worker not available. See console for details.'); }
    });
  }
})();
window.addEventListener('load', function(){ try{ document.querySelectorAll('.table-wrapper').forEach(function(e){ e.style.opacity='1'; }); }catch(e){} });
</script>
</div>
</body>
</html>